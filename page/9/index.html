<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
  <meta name="theme-color" content="#222">
  <meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>
  <script id="hexo-configurations">
    var NexT = window.NexT ||
    {};
    var CONFIG = {
      "hostname": "cuiqingcai.com",
      "root": "/",
      "scheme": "Pisces",
      "version": "7.8.0",
      "exturl": false,
      "sidebar":
      {
        "position": "right",
        "width": 360,
        "display": "post",
        "padding": 18,
        "offset": 12,
        "onmobile": false,
        "widgets": [
          {
            "type": "image",
            "name": "阿布云",
            "enable": false,
            "url": "https://www.abuyun.com/http-proxy/introduce.html",
            "src": "https://cdn.cuiqingcai.com/88au8.jpg",
            "width": "100%"
      },
          {
            "type": "image",
            "name": "爬虫书",
            "url": "https://item.jd.com/13527222.html",
            "src": "https://cdn.cuiqingcai.com/ei5og.jpg",
            "width": "100%",
            "enable": true
      },
          {
            "type": "categories",
            "name": "分类",
            "enable": true
      },
          {
            "type": "image",
            "name": "IPIDEA",
            "url": "http://www.ipidea.net/?utm-source=cqc&utm-keyword=?cqc",
            "src": "https://cdn.cuiqingcai.com/0ywun.png",
            "width": "100%",
            "enable": false
      },
          {
            "type": "image",
            "name": "Storm Proxies",
            "src": "https://cdn.cuiqingcai.com/a2zad8.png",
            "url": "https://www.stormproxies.cn/?keyword=jingmi",
            "width": "100%",
            "enable": false
      },
          {
            "type": "friends",
            "name": "友情链接",
            "enable": true
      },
          {
            "type": "hot",
            "name": "猜你喜欢",
            "enable": true
      },
          {
            "type": "tags",
            "name": "标签云",
            "enable": true
      }]
      },
      "copycode":
      {
        "enable": true,
        "show_result": true,
        "style": "mac"
      },
      "back2top":
      {
        "enable": true,
        "sidebar": false,
        "scrollpercent": true
      },
      "bookmark":
      {
        "enable": false,
        "color": "#222",
        "save": "auto"
      },
      "fancybox": false,
      "mediumzoom": false,
      "lazyload": false,
      "pangu": true,
      "comments":
      {
        "style": "tabs",
        "active": "gitalk",
        "storage": true,
        "lazyload": false,
        "nav": null,
        "activeClass": "gitalk"
      },
      "algolia":
      {
        "hits":
        {
          "per_page": 10
        },
        "labels":
        {
          "input_placeholder": "Search for Posts",
          "hits_empty": "We didn't find any results for the search: ${query}",
          "hits_stats": "${hits} results found in ${time} ms"
        }
      },
      "localsearch":
      {
        "enable": true,
        "trigger": "auto",
        "top_n_per_article": 10,
        "unescape": false,
        "preload": false
      },
      "motion":
      {
        "enable": false,
        "async": false,
        "transition":
        {
          "post_block": "bounceDownIn",
          "post_header": "slideDownIn",
          "post_body": "slideDownIn",
          "coll_header": "slideLeftIn",
          "sidebar": "slideUpIn"
        }
      },
      "path": "search.xml"
    };

  </script>
  <meta name="keywords" content="爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书,静觅,崔庆才">
  <meta name="robots" content="index,follow">
  <meta name="GOOGLEBOT" content="index,follow">
  <meta name="author" content="静觅丨崔庆才的个人站点">
  <meta name="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  <meta property="og:type" content="website">
  <meta property="og:title" content="静觅">
  <meta property="og:url" content="https://cuiqingcai.com/page/9/index.html">
  <meta property="og:site_name" content="静觅">
  <meta property="og:description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  <meta property="og:locale" content="zh_CN">
  <meta property="article:author" content="崔庆才">
  <meta property="article:tag" content="爬虫教程">
  <meta property="article:tag" content="爬虫">
  <meta property="article:tag" content="Python">
  <meta property="article:tag" content="Python爬虫">
  <meta property="article:tag" content="Python爬虫教程">
  <meta property="article:tag" content="爬虫书">
  <meta property="article:tag" content="静觅">
  <meta property="article:tag" content="崔庆才">
  <meta name="twitter:card" content="summary">
  <link rel="canonical" href="https://cuiqingcai.com/page/9/">
  <script id="page-configurations">
    // https://hexo.io/docs/variables.html
    CONFIG.page = {
      sidebar: "",
      isHome: true,
      isPost: false,
      lang: 'zh-CN'
    };

  </script>
  <title>静觅丨崔庆才的个人站点 - Python爬虫教程</title>
  <meta name="google-site-verification" content="p_bIcnvirkFzG2dYKuNDivKD8-STet5W7D-01woA2fc" />
  <meta name="sogou_site_verification" content="kBOV53NQqT" />
  <noscript>
    <style>
      .use-motion .brand,
      .use-motion .menu-item,
      .sidebar-inner,
      .use-motion .post-block,
      .use-motion .pagination,
      .use-motion .comments,
      .use-motion .post-header,
      .use-motion .post-body,
      .use-motion .collection-header
      {
        opacity: initial;
      }

      .use-motion .site-title,
      .use-motion .site-subtitle
      {
        opacity: initial;
        top: initial;
      }

      .use-motion .logo-line-before i
      {
        left: initial;
      }

      .use-motion .logo-line-after i
      {
        right: initial;
      }

    </style>
  </noscript>
  <link rel="alternate" href="/atom.xml" title="静觅" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner">
        <div class="site-brand-container">
          <div class="site-nav-toggle">
            <div class="toggle" aria-label="切换导航栏">
              <span class="toggle-line toggle-line-first"></span>
              <span class="toggle-line toggle-line-middle"></span>
              <span class="toggle-line toggle-line-last"></span>
            </div>
          </div>
          <div class="site-meta">
            <a href="/" class="brand" rel="start">
              <span class="logo-line-before"><i></i></span>
              <h1 class="site-title">静觅 <span class="site-subtitle"> 崔庆才的个人站点 - Python爬虫教程 </span>
              </h1>
              <span class="logo-line-after"><i></i></span>
            </a>
          </div>
          <div class="site-nav-right">
            <div class="toggle popup-trigger">
              <i class="fa fa-search fa-fw fa-lg"></i>
            </div>
          </div>
        </div>
        <nav class="site-nav">
          <ul id="menu" class="main-menu menu">
            <li class="menu-item menu-item-home">
              <a href="/" rel="section">首页</a>
            </li>
            <li class="menu-item menu-item-archives">
              <a href="/archives/" rel="section">文章列表</a>
            </li>
            <li class="menu-item menu-item-tags">
              <a href="/tags/" rel="section">文章标签</a>
            </li>
            <li class="menu-item menu-item-categories">
              <a href="/categories/" rel="section">文章分类</a>
            </li>
            <li class="menu-item menu-item-about">
              <a href="/about/" rel="section">关于博主</a>
            </li>
            <li class="menu-item menu-item-message">
              <a href="/message/" rel="section">给我留言</a>
            </li>
            <li class="menu-item menu-item-search">
              <a role="button" class="popup-trigger">搜索 </a>
            </li>
          </ul>
        </nav>
        <div class="search-pop-overlay">
          <div class="popup search-popup">
            <div class="search-header">
              <span class="search-icon">
                <i class="fa fa-search"></i>
              </span>
              <div class="search-input-container">
                <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input">
              </div>
              <span class="popup-btn-close">
                <i class="fa fa-times-circle"></i>
              </span>
            </div>
            <div id="search-result">
              <div id="no-result">
                <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>
    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
      <span>0%</span>
    </div>
    <div class="reading-progress-bar"></div>
    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div class="content index posts-expand">
            <div class="carousel">
              <div id="wowslider-container">
                <div class="ws_images">
                  <ul>
                    <li><a target="_blank" href="https://item.jd.com/13527222.html"><img title="Python3网络爬虫开发实战（第二版）上市了！" src="https://cdn.cuiqingcai.com/prwgs.png" /></a></li>
                    <li><a target="_blank" href="https://t.lagou.com/fRCBRsRCSN6FA"><img title="52讲轻松搞定网络爬虫" src="https://cdn.cuiqingcai.com/fqq5e.png" /></a></li>
                    <li><a target="_blank" href="https://cuiqingcai.com/4320.html"><img title="Python3网络爬虫开发视频教程" src="https://cdn.cuiqingcai.com/bjrny.jpg" /></a></li>
                    <li><a target="_blank" href="https://cuiqingcai.com/5094.html"><img title="爬虫代理哪家强？十大付费代理详细对比评测出炉！" src="https://cdn.cuiqingcai.com/nifs6.jpg" /></a></li>
                  </ul>
                </div>
                <div class="ws_thumbs">
                  <div>
                    <a target="_blank" href="#"><img src="https://cdn.cuiqingcai.com/prwgs.png" /></a>
                    <a target="_blank" href="#"><img src="https://cdn.cuiqingcai.com/fqq5e.png" /></a>
                    <a target="_blank" href="#"><img src="https://cdn.cuiqingcai.com/bjrny.jpg" /></a>
                    <a target="_blank" href="#"><img src="https://cdn.cuiqingcai.com/nifs6.jpg" /></a>
                  </div>
                </div>
                <div class="ws_shadow"></div>
              </div>
            </div>
            <link rel="stylesheet" href="/lib/wowslide/slide.css">
            <script src="/lib/wowslide/jquery.min.js"></script>
            <script src="/lib/wowslide/slider.js"></script>
            <script>
              jQuery("#wowslider-container").wowSlider(
              {
                effect: "cube",
                prev: "",
                next: "",
                duration: 20 * 100,
                delay: 100 * 100,
                width: 716,
                height: 297,
                autoPlay: true,
                playPause: true,
                stopOnHover: false,
                loop: false,
                bullets: 0,
                caption: true,
                captionEffect: "slide",
                controls: true,
                onBeforeStep: 0,
                images: 0
              });

            </script>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/7842.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 技术杂谈 <i class="label-arrow"></i>
                  </a>
                  <a href="/7842.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 9.4-ADSL 拨号代理</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>我们尝试维护过一个代理池。代理池可以挑选出许多可用代理，但是常常其稳定性不高、响应速度慢，而且这些代理通常是公共代理，可能不止一人同时使用，其 IP 被封的概率很大。另外，这些代理可能有效时间比较短，虽然代理池一直在筛选，但如果没有及时更新状态，也有可能获取到不可用的代理。 如果要追求更加稳定的代理，就需要购买专有代理或者自己搭建代理服务器。但是服务器一般都是固定的 IP，我们总不能搭建 100 个代理就用 100 台服务器吧，这显然是不现实的。 所以，ADSL 动态拨号主机就派上用场了。下面我们来了解一下 ADSL 拨号代理服务器的相关设置。</p>
                  <h3 id="1-什么是-ADSL"><a href="#1-什么是-ADSL" class="headerlink" title="1. 什么是 ADSL"></a>1. 什么是 ADSL</h3>
                  <p>ADSL（Asymmetric Digital Subscriber Line，非对称数字用户环路），它的上行和下行带宽不对称，它采用频分复用技术把普通的电话线分成了电话、上行和下行 3 个相对独立的信道，从而避免了相互之间的干扰。 ADSL 通过拨号的方式上网，需要输入 ADSL 账号和密码，每次拨号就更换一个 IP。IP 分布在多个 A 段，如果 IP 都能使用，则意味着 IP 量级可达千万。如果我们将 ADSL 主机作为代理，每隔一段时间主机拨号就换一个 IP，这样可以有效防止 IP 被封禁。另外，主机的稳定性很好，代理响应速度很快。</p>
                  <h3 id="2-准备工作"><a href="#2-准备工作" class="headerlink" title="2. 准备工作"></a>2. 准备工作</h3>
                  <p>首先需要成功安装 Redis 数据库并启动服务，另外还需要安装 requests、redis-py、Tornado 库。如果没有安装，读者可以参考第一章的安装说明。</p>
                  <h3 id="3-购买主机"><a href="#3-购买主机" class="headerlink" title="3. 购买主机"></a>3. 购买主机</h3>
                  <p>我们先购买一台动态拨号 VPS 主机，这样的主机服务商相当多。在这里使用了云立方，官方网站：<a href="http://www.yunlifang.cn/dynamicvps.asp" target="_blank" rel="noopener">http://www.yunlifang.cn/dynamicvps.asp</a>。 建议选择电信线路。可以自行选择主机配置，主要考虑带宽是否满足需求。 然后进入拨号主机的后台，预装一个操作系统，如图 9-10 所示。 <img src="https://cdn.cuiqingcai.com/2019-10-20-052822.jpg" alt=""> 图 9-10 预装操作系统 推荐安装 CentOS 7 系统。 然后找到远程管理面板  远程连接的用户名和密码，也就是 SSH 远程连接服务器的信息。比如我使用的 IP 和端口是 153.36.65.214:20063，用户名是 root。命令行下输入如下内容：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">ssh <span class="symbol">root@</span><span class="number">153.36</span><span class="number">.65</span><span class="number">.214</span> -p <span class="number">20063</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>输入管理密码，就可以连接上远程服务器了。 进入之后，我们发现一个可用的脚本文件 ppp.sh，这是拨号初始化的脚本。运行此脚本会提示输入拨号的用户名和密码，然后它就开始各种拨号配置。一次配置成功，后面拨号就不需要重复输入用户名和密码。 运行 ppp.sh 脚本，输入用户名、密码等待它的配置完成，如图 9-11 所示。 <img src="https://cdn.cuiqingcai.com/2019-10-20-052827.jpg" alt=""> 图 9-11 配置页面 提示成功之后就可以进行拨号了。注意，在拨号之前测试 ping 任何网站都是不通的，因为当前网络还没联通。输入如下拨号命令：</p>
                  <figure class="highlight crmsh">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">adsl-<span class="literal">start</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>拨号命令成功运行，没有报错信息，耗时约几秒。接下来再去 ping 外网就可以通了。 如果要停止拨号，可以输入如下命令：</p>
                  <figure class="highlight arduino">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">adsl-<span class="built_in">stop</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>之后，可以发现又连不通网络了，如图 9-12 所示。 <img src="https://cdn.cuiqingcai.com/2019-10-20-052841.jpg" alt=""> 图 9-12 拨号建立连接 断线重播的命令就是二者组合起来，先执行 adsl-stop，再执行 adsl-start。每次拨号，ifconfig 命令观察主机的 IP，发现主机的 IP 一直在变化，网卡名称叫作 ppp0，如图 9-13 所示。 <img src="https://cdn.cuiqingcai.com/2019-10-20-052851.jpg" alt=""> 图 9-13 网络设备信息 接下来，我们要做两件事：一是怎样将主机设置为代理服务器，二是怎样实时获取拨号主机的 IP。</p>
                  <h3 id="4-设置代理服务器"><a href="#4-设置代理服务器" class="headerlink" title="4. 设置代理服务器"></a>4. 设置代理服务器</h3>
                  <p>在 Linux 下搭建 HTTP 代理服务器，推荐 TinyProxy 和 Squid，配置都非常简单。在这里我们以 TinyProxy 为例来讲解一下怎样搭建代理服务器。</p>
                  <h4 id="安装-TinyProxy"><a href="#安装-TinyProxy" class="headerlink" title="安装 TinyProxy"></a>安装 TinyProxy</h4>
                  <p>第一步就是安装 TinyProxy 软件。在这里我使用的系统是 CentOS，所以使用 yum 来安装。如果是其他系统，如 Ubuntu，可以选择 apt-get 等命令安装。 命令行执行 yum 安装指令：</p>
                  <figure class="highlight sql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">yum <span class="keyword">install</span> -y epel-<span class="keyword">release</span></span><br><span class="line">yum <span class="keyword">update</span> -y</span><br><span class="line">yum <span class="keyword">install</span> -y tinyproxy</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行完成之后就可以完成 tinyproxy 的安装了。</p>
                  <h4 id="配置-TinyProxy"><a href="#配置-TinyProxy" class="headerlink" title="配置 TinyProxy"></a>配置 TinyProxy</h4>
                  <p>TinyProxy 安装完成之后还要配置一下才可以用作代理服务器。我们需要编辑配置文件，此文件一般的路径是 /etc/tinyproxy/tinyproxy.conf。 可以看到有一行</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Port <span class="number">8888</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里可以设置代理的端口，默认是 8888。 继续向下找到如下代码：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Allow <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这行代码表示被允许连接的主机 IP。如果希望连接任何主机，那就直接将这行代码注释即可。在这里我们选择直接注释，也就是任何主机都可以使用这台主机作为代理服务器。 修改为如下代码：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"># Allow <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>设置完成之后重启 TinyProxy 即可：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">systemctl</span> <span class="selector-tag">enable</span> <span class="selector-tag">tinyproxy</span><span class="selector-class">.service</span></span><br><span class="line"><span class="selector-tag">systemctl</span> <span class="selector-tag">restart</span> <span class="selector-tag">tinyproxy</span><span class="selector-class">.service</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>防火墙开放该端口：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">iptables -I <span class="keyword">INPUT</span> -p tcp <span class="comment">--dport 8888 -j ACCEPT</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>当然如果想直接关闭防火墙也可以：</p>
                  <figure class="highlight arduino">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">systemctl <span class="built_in">stop</span> firewalld.service</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们就完成了 TinyProxy 的配置了。</p>
                  <h4 id="验证-TinyProxy"><a href="#验证-TinyProxy" class="headerlink" title="验证 TinyProxy"></a>验证 TinyProxy</h4>
                  <p>首先，用 ifconfig 查看当前主机的 IP。比如，当前我的主机拨号 IP 为 112.84.118.216，在其他的主机运行测试一下。 用 curl 命令设置代理请求 httpbin，检测代理是否生效。</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl -x <span class="number">112.84</span><span class="number">.118</span><span class="number">.216</span>:<span class="number">8888</span> httpbin.org/<span class="keyword">get</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如图 9-14 所示： <img src="https://cdn.cuiqingcai.com/2019-10-20-052902.jpg" alt=""> 图 9-14 运行结果 如果有正常的结果输出，并且 origin 的值为代理 IP 的地址，就证明 TinyProxy 配置成功了。</p>
                  <h3 id="5-动态获取-IP"><a href="#5-动态获取-IP" class="headerlink" title="5. 动态获取 IP"></a>5. 动态获取 IP</h3>
                  <p>现在可以执行命令让主机动态切换 IP，也在主机上搭建了代理服务器。我们只需要知道拨号后的 IP 就可以使用代理。 我们考虑到，在一台主机拨号切换 IP 的间隙代理是不可用的，在这拨号的几秒时间内如果有第二台主机顶替第一台主机，那就可以解决拨号间隙代理无法使用的问题了。所以我们要设计的架构必须要考虑支持多主机的问题。 假如有 10 台拨号主机同时需要维护，而爬虫需要使用这 10 台主机的代理，那么在爬虫端维护的开销是非常大的。如果爬虫在不同的机器上运行，那么每个爬虫必须要获得这 10 台拨号主机的配置，这显然是不理想的。 为了更加方便地使用代理，我们可以像上文的代理池一样定义一个统一的代理接口，爬虫端只需要配置代理接口即可获取可用代理。要搭建一个接口，就势必需要一台服务器，而接口的数据从哪里获得呢，当然最理想的还是选择数据库。 比如我们需要同时维护 10 台拨号主机，每台拨号主机都会定时拨号，那这样每台主机在某个时刻可用的代理只有一个，所以我们没有必要存储之前的拨号代理，因为重新拨号之后之前的代理已经不能用了，所以只需要将之前的代理更新其内容就好了。数据库要做的就是定时对每台主机的代理进行更新，而更新时又需要拨号主机的唯一标识，根据主机标识查出这条数据，然后将这条数据对应的代理更新。 所以数据库端就需要存储一个主机标识到代理的映射关系。那么很自然地我们就会想到关系型数据库，如 MySQL 或者 Redis 的 Hash 存储，只需存储一个映射关系，不需要很多字段，而且 Redis 比 MySQL 效率更高、使用更方便，所以最终选定的存储方式就是 Redis 的 Hash。</p>
                  <h3 id="6-存储模块"><a href="#6-存储模块" class="headerlink" title="6. 存储模块"></a>6. 存储模块</h3>
                  <p>那么接下来我们要做可被远程访问的 Redis 数据库，各个拨号机器只需要将各自的主机标识和当前 IP 和端口（也就是代理）发送给数据库就好了。 先定义一个操作 Redis 数据库的类，示例如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="comment"># Redis 数据库 IP</span></span><br><span class="line">REDIS_HOST = <span class="string">'remoteaddress'</span></span><br><span class="line"><span class="comment"># Redis 数据库密码，如无则填 None</span></span><br><span class="line">REDIS_PASSWORD = <span class="string">'foobared'</span></span><br><span class="line"><span class="comment"># Redis 数据库端口</span></span><br><span class="line">REDIS_PORT = <span class="number">6379</span></span><br><span class="line"><span class="comment"># 代理池键名</span></span><br><span class="line">PROXY_KEY = <span class="string">'adsl'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RedisClient</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, host=REDIS_HOST, port=REDIS_PORT, password=REDIS_PASSWORD, proxy_key=PROXY_KEY)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        初始化 Redis 连接</span></span><br><span class="line"><span class="string">        :param host: Redis 地址</span></span><br><span class="line"><span class="string">        :param port: Redis 端口</span></span><br><span class="line"><span class="string">        :param password: Redis 密码</span></span><br><span class="line"><span class="string">        :param proxy_key: Redis 哈希表名</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.db = redis.StrictRedis(host=host, port=port, password=password, decode_responses=<span class="literal">True</span>)</span><br><span class="line">        self.proxy_key = proxy_key</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set</span><span class="params">(self, name, proxy)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        设置代理</span></span><br><span class="line"><span class="string">        :param name: 主机名称</span></span><br><span class="line"><span class="string">        :param proxy: 代理</span></span><br><span class="line"><span class="string">        :return: 设置结果</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> self.db.hset(self.proxy_key, name, proxy)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        获取代理</span></span><br><span class="line"><span class="string">        :param name: 主机名称</span></span><br><span class="line"><span class="string">        :return: 代理</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> self.db.hget(self.proxy_key, name)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">count</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        获取代理总数</span></span><br><span class="line"><span class="string">        :return: 代理总数</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> self.db.hlen(self.proxy_key)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">remove</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        删除代理</span></span><br><span class="line"><span class="string">        :param name: 主机名称</span></span><br><span class="line"><span class="string">        :return: 删除结果</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> self.db.hdel(self.proxy_key, name)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">names</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        获取主机名称列表</span></span><br><span class="line"><span class="string">        :return: 获取主机名称列表</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> self.db.hkeys(self.proxy_key)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">proxies</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        获取代理列表</span></span><br><span class="line"><span class="string">        :return: 代理列表</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> self.db.hvals(self.proxy_key)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">random</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        随机获取代理</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        proxies = self.proxies()</span><br><span class="line">        <span class="keyword">return</span> random.choice(proxies)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">all</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        获取字典</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span><span class="keyword">return</span> self.db.hgetall(self.proxy_key)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里定义了一个 RedisClient 类，在<strong>init</strong>() 方法中初始化了 Redis 连接，其中 REDIS_HOST 就是远程 Redis 的地址，REDIS_PASSWORD 是密码，REDIS_PORT 是端口，PROXY_KEY 是存储代理的散列表的键名。 接下来定义了一个 set() 方法，这个方法用来向散列表添加映射关系。映射是从主机标识到代理的映射，比如一台主机的标识为 adsl1，当前的代理为 118.119.111.172:8888，那么散列表中就会存储一个 key 为 adsl1、value 为 118.119.111.172:8888 的映射，Hash 结构如图 9-15 所示。 <img src="https://cdn.cuiqingcai.com/2019-10-20-052948.jpg" alt=""> 图 9-15 Hash 结构 如果有多台主机，只需要向 Hash 中添加映射即可。 另外，get() 方法就是从散列表中取出某台主机对应的代理。remove() 方法则是从散列表中移除对应的主机的代理。还有 names()、proxies()、all() 方法则是分别获取散列表中的主机列表、代理列表及所有主机代理映射。count() 方法则是返回当前散列表的大小，也就是可用代理的数目。 最后还有一个比较重要的方法 random()，它随机从散列表中取出一个可用代理，类似前面代理池的思想，确保每个代理都能被取到。 如果要对数据库进行操作，只需要初始化 RedisClient 对象，然后调用它的 set() 或者 remove() 方法，即可对散列表进行设置和删除。</p>
                  <h3 id="7-拨号模块"><a href="#7-拨号模块" class="headerlink" title="7. 拨号模块"></a>7. 拨号模块</h3>
                  <p>接下来要做的就是拨号，并把新的 IP 保存到 Redis 散列表里。 首先是拨号定时，它分为定时拨号和非定时拨号两种选择。 非定时拨号：最好的方法就是向该主机发送一个信号，然后主机就启动拨号，但这样做的话，我们首先要搭建一个重新拨号的接口，如搭建一个 Web 接口，请求该接口即进行拨号，但开始拨号之后，此时主机的状态就从在线转为离线，而此时的 Web 接口也就相应失效了，拨号过程无法再连接，拨号之后接口的 IP 也变了，所以我们无法通过接口来方便地控制拨号过程和获取拨号结果，下次拨号还得改变拨号请求接口，所以非定时拨号的开销还是比较大的。 定时拨号：我们只需要在拨号主机上运行定时脚本即可，每隔一段时间拨号一次，更新 IP，然后将 IP 在 Redis 散列表中更新即可，非常简单易用，另外可以适当将拨号频率调高一点，减少短时间内 IP 被封的可能性。 在这里选择定时拨号。 接下来就是获取 IP。获取拨号后的 IP 非常简单，只需要调用 ifconfig 命令，然后解析出对应网卡的 IP 即可。 获取了 IP 之后，我们还需要进行有效性检测。拨号主机可以自己检测，比如可以利用 requests 设置自身的代理请求外网，如果成功，那么证明代理可用，然后再修改 Redis 散列表，更新代理。 需要注意，由于在拨号的间隙拨号主机是离线状态，而此时 Redis 散列表中还存留了上次的代理，一旦这个代理被取用了，该代理是无法使用的。为了避免这个情况，每台主机在拨号之前还需要将自身的代理从 Redis 散列表中移除。 这样基本的流程就理顺了，我们用如下代码实现：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import re</span><br><span class="line">import time</span><br><span class="line">import requests</span><br><span class="line"><span class="keyword">from</span> requests.exceptions import ConnectionError, ReadTimeout</span><br><span class="line"><span class="keyword">from</span> db import RedisClient</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拨号网卡</span></span><br><span class="line">ADSL_IFNAME = <span class="string">'ppp0'</span></span><br><span class="line"><span class="comment"># 测试 URL</span></span><br><span class="line">TEST_URL = <span class="string">'http://www.baidu.com'</span></span><br><span class="line"><span class="comment"># 测试超时时间</span></span><br><span class="line">TEST_TIMEOUT = 20</span><br><span class="line"><span class="comment"># 拨号间隔</span></span><br><span class="line">ADSL_CYCLE = 100</span><br><span class="line"><span class="comment"># 拨号出错重试间隔</span></span><br><span class="line">ADSL_ERROR_CYCLE = 5</span><br><span class="line"><span class="comment"># ADSL 命令</span></span><br><span class="line">ADSL_BASH = <span class="string">'adsl-stop;adsl-start'</span></span><br><span class="line"><span class="comment"># 代理运行端口</span></span><br><span class="line">PROXY_PORT = 8888</span><br><span class="line"><span class="comment"># 客户端唯一标识</span></span><br><span class="line">CLIENT_NAME = <span class="string">'adsl1'</span></span><br><span class="line"></span><br><span class="line">class Sender():</span><br><span class="line">    def get_ip(self, <span class="attribute">ifname</span>=ADSL_IFNAME):</span><br><span class="line">        <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">        获取本机 IP</span></span><br><span class="line"><span class="string">        :param ifname: 网卡名称</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        "</span><span class="string">""</span></span><br><span class="line">        (status, output) = subprocess.getstatusoutput(<span class="string">'ifconfig'</span>)</span><br><span class="line">        <span class="keyword">if</span> status == 0:</span><br><span class="line">            pattern = re.compile(ifname + <span class="string">'.*?inet.*?(d+.d+.d+.d+).*?netmask'</span>, re.S)</span><br><span class="line">            result = re.search(pattern, output)</span><br><span class="line">            <span class="keyword">if</span> result:</span><br><span class="line">               <span class="built_in"> ip </span>= result.group(1)</span><br><span class="line">                return ip</span><br><span class="line"></span><br><span class="line">    def test_proxy(self, proxy):</span><br><span class="line">        <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">        测试代理</span></span><br><span class="line"><span class="string">        :param proxy: 代理</span></span><br><span class="line"><span class="string">        :return: 测试结果</span></span><br><span class="line"><span class="string">        "</span><span class="string">""</span></span><br><span class="line">        try:</span><br><span class="line">            response = requests.<span class="builtin-name">get</span>(TEST_URL, proxies=&#123;</span><br><span class="line">                <span class="string">'http'</span>: <span class="string">'http://'</span> + proxy,</span><br><span class="line">                <span class="string">'https'</span>: <span class="string">'https://'</span> + proxy</span><br><span class="line">            &#125;, <span class="attribute">timeout</span>=TEST_TIMEOUT)</span><br><span class="line">            <span class="keyword">if</span> response.status_code == 200:</span><br><span class="line">                return <span class="literal">True</span></span><br><span class="line">        except (ConnectionError, ReadTimeout):</span><br><span class="line">            return <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    def remove_proxy(self):</span><br><span class="line">        <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">        移除代理</span></span><br><span class="line"><span class="string">        :return: None</span></span><br><span class="line"><span class="string">        "</span><span class="string">""</span></span><br><span class="line">        self.redis = RedisClient()</span><br><span class="line">        self.redis.<span class="builtin-name">remove</span>(CLIENT_NAME)</span><br><span class="line">        <span class="builtin-name">print</span>(<span class="string">'Successfully Removed Proxy'</span>)</span><br><span class="line"></span><br><span class="line">    def set_proxy(self, proxy):</span><br><span class="line">        <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">        设置代理</span></span><br><span class="line"><span class="string">        :param proxy: 代理</span></span><br><span class="line"><span class="string">        :return: None</span></span><br><span class="line"><span class="string">        "</span><span class="string">""</span></span><br><span class="line">        self.redis = RedisClient()</span><br><span class="line">        <span class="keyword">if</span> self.redis.<span class="builtin-name">set</span>(CLIENT_NAME, proxy):</span><br><span class="line">            <span class="builtin-name">print</span>(<span class="string">'Successfully Set Proxy'</span>, proxy)</span><br><span class="line"></span><br><span class="line">    def adsl(self):</span><br><span class="line">        <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">        拨号主进程</span></span><br><span class="line"><span class="string">        :return: None</span></span><br><span class="line"><span class="string">        "</span><span class="string">""</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="builtin-name">print</span>(<span class="string">'ADSL Start, Remove Proxy, Please wait'</span>)</span><br><span class="line">            self.remove_proxy()</span><br><span class="line">            (status, output) = subprocess.getstatusoutput(ADSL_BASH)</span><br><span class="line">            <span class="keyword">if</span> status == 0:</span><br><span class="line">                <span class="builtin-name">print</span>(<span class="string">'ADSL Successfully'</span>)</span><br><span class="line">               <span class="built_in"> ip </span>= self.get_ip()</span><br><span class="line">                <span class="keyword">if</span> ip:</span><br><span class="line">                    <span class="builtin-name">print</span>(<span class="string">'Now IP'</span>, ip)</span><br><span class="line">                    <span class="builtin-name">print</span>(<span class="string">'Testing Proxy, Please Wait'</span>)</span><br><span class="line">                   <span class="built_in"> proxy </span>= <span class="string">'&#123;ip&#125;:&#123;port&#125;'</span>.format(<span class="attribute">ip</span>=ip, <span class="attribute">port</span>=PROXY_PORT)</span><br><span class="line">                    <span class="keyword">if</span> self.test_proxy(proxy):</span><br><span class="line">                        <span class="builtin-name">print</span>(<span class="string">'Valid Proxy'</span>)</span><br><span class="line">                        self.set_proxy(proxy)</span><br><span class="line">                        <span class="builtin-name">print</span>(<span class="string">'Sleeping'</span>)</span><br><span class="line">                        time.sleep(ADSL_CYCLE)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="builtin-name">print</span>(<span class="string">'Invalid Proxy'</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="builtin-name">print</span>(<span class="string">'Get IP Failed, Re Dialing'</span>)</span><br><span class="line">                    time.sleep(ADSL_ERROR_CYCLE)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="builtin-name">print</span>(<span class="string">'ADSL Failed, Please Check'</span>)</span><br><span class="line">                time.sleep(ADSL_ERROR_CYCLE)</span><br><span class="line">def <span class="builtin-name">run</span>():</span><br><span class="line">    sender = Sender()</span><br><span class="line">    sender.adsl()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里定义了一个 Sender 类，它的主要作用是执行定时拨号，并将新的 IP 测试通过之后更新到远程 Redis 散列表里。 主方法是 adsl() 方法，它首先是一个无限循环，循环体内就是拨号的逻辑。 adsl() 方法首先调用了 remove_proxy() 方法，将远程 Redis 散列表中本机对应的代理移除，避免拨号时本主机的残留代理被取到。 接下来利用 subprocess 模块来执行拨号脚本，拨号脚本很简单，就是 stop 之后再 start，这里将拨号的命令直接定义成了 ADSL_BASH。 随后程序又调用 get_ip() 方法，通过 subprocess 模块执行获取 IP 的命令 ifconfig，然后根据网卡名称获取了当前拨号网卡的 IP 地址，即拨号后的 IP。 再接下来就需要测试代理有效性了。程序首先调用了 test_proxy() 方法，将自身的代理设置好，使用 requests 库来用代理连接 TEST_URL。在此 TEST_URL 设置为百度，如果请求成功，则证明代理有效。 如果代理有效，再调用 set_proxy() 方法将 Redis 散列表中本机对应的代理更新，设置时需要指定本机唯一标识和本机当前代理。本机唯一标识可随意配置，其对应的变量为 CLIENT_NAME，保证各台拨号主机不冲突即可。本机当前代理则由拨号后的新 IP 加端口组合而成。通过调用 RedisClient 的 set() 方法，参数 name 为本机唯一标识，proxy 为拨号后的新代理，执行之后便可以更新散列表中的本机代理了。 建议至少配置两台主机，这样在一台主机的拨号间隙还有另一台主机的代理可用。拨号主机的数量不限，越多越好。 在拨号主机上执行拨号脚本，示例输出如图 9-16 所示。 <img src="https://cdn.cuiqingcai.com/2019-10-20-052912.jpg" alt=""> 图 9-16 示例输出 首先移除了代理，再进行拨号，拨号完成之后获取新的 IP，代理检测成功之后就设置到 Redis 散列表中，然后等待一段时间再重新进行拨号。 我们添加了多台拨号主机，这样就有多个稳定的定时更新的代理可用了。Redis 散列表会实时更新各台拨号主机的代理，如图 9-17 所示。 <img src="https://cdn.cuiqingcai.com/2019-10-20-053042.jpg" alt=""> 图 9-17 Hash 结构 图中所示是四台 ADSL 拨号主机配置并运行后的散列表的内容，表中的代理都是可用的。</p>
                  <h3 id="8-接口模块"><a href="#8-接口模块" class="headerlink" title="8. 接口模块"></a>8. 接口模块</h3>
                  <p>目前为止，我们已经成功实时更新拨号主机的代理。不过还缺少一个模块，那就是接口模块。像之前的代理池一样，我们也定义一些接口来获取代理，如 random 获取随机代理、count 获取代理个数等。 我们选用 Tornado 来实现，利用 Tornado 的 Server 模块搭建 Web 接口服务，示例如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> tornado.ioloop</span><br><span class="line"><span class="keyword">import</span> tornado.web</span><br><span class="line"><span class="keyword">from</span> tornado.web <span class="keyword">import</span> RequestHandler, Application</span><br><span class="line"></span><br><span class="line"><span class="comment"># API 端口</span></span><br><span class="line">API_PORT = <span class="number">8000</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainHandler</span><span class="params">(RequestHandler)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">initialize</span><span class="params">(self, redis)</span>:</span></span><br><span class="line">        self.redis = redis</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, api=<span class="string">''</span>)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> api:</span><br><span class="line">            links = [<span class="string">'random'</span>, <span class="string">'proxies'</span>, <span class="string">'names'</span>, <span class="string">'all'</span>, <span class="string">'count'</span>]</span><br><span class="line">            self.write(<span class="string">'&lt;h4&gt;Welcome to ADSL Proxy API&lt;/h4&gt;'</span>)</span><br><span class="line">            <span class="keyword">for</span> link <span class="keyword">in</span> links:</span><br><span class="line">                self.write(<span class="string">'&lt;a href='</span> + link + <span class="string">'&gt;'</span> + link + <span class="string">'&lt;/a&gt;&lt;br&gt;'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> api == <span class="string">'random'</span>:</span><br><span class="line">            result = self.redis.random()</span><br><span class="line">            <span class="keyword">if</span> result:</span><br><span class="line">                self.write(result)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> api == <span class="string">'names'</span>:</span><br><span class="line">            result = self.redis.names()</span><br><span class="line">            <span class="keyword">if</span> result:</span><br><span class="line">                self.write(json.dumps(result))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> api == <span class="string">'proxies'</span>:</span><br><span class="line">            result = self.redis.proxies()</span><br><span class="line">            <span class="keyword">if</span> result:</span><br><span class="line">                self.write(json.dumps(result))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> api == <span class="string">'all'</span>:</span><br><span class="line">            result = self.redis.all()</span><br><span class="line">            <span class="keyword">if</span> result:</span><br><span class="line">                self.write(json.dumps(result))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> api == <span class="string">'count'</span>:</span><br><span class="line">            self.write(str(self.redis.count()))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">server</span><span class="params">(redis, port=API_PORT, address=<span class="string">''</span>)</span>:</span></span><br><span class="line">    application = Application([(<span class="string">r'/'</span>, MainHandler, dict(redis=redis)),</span><br><span class="line">        (<span class="string">r'/(.*)'</span>, MainHandler, dict(redis=redis)),</span><br><span class="line">    ])</span><br><span class="line">    application.listen(port, address=address)</span><br><span class="line">    print(<span class="string">'ADSL API Listening on'</span>, port)</span><br><span class="line">    tornado.ioloop.IOLoop.instance().start()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里定义了 5 个接口，random 获取随机代理，names 获取主机列表，proxies 获取代理列表，all 获取代理映射，count 获取代理数量。 程序启动之后便会在 API_PORT 端口上运行 Web 服务，主页面如图 9-18 所示。 <img src="https://cdn.cuiqingcai.com/2019-10-20-053047.jpg" alt=""> 图 9-18 主页面 访问 proxies 接口可以获得所有代理列表，如图 9-19 所示。 <img src="https://cdn.cuiqingcai.com/2019-10-20-053052.jpg" alt=""> 图 9-19 代理列表 访问 random 接口可以获取随机可用代理，如图 9-20 所示。 <img src="https://cdn.cuiqingcai.com/2019-10-20-053057.jpg" alt=""> 图 9-20 随机代理 我们只需将接口部署到服务器上，即可通过 Web 接口获取可用代理，获取方式和代理池类似。</p>
                  <h3 id="9-本节代码"><a href="#9-本节代码" class="headerlink" title="9. 本节代码"></a>9. 本节代码</h3>
                  <p>本节代码地址为：<a href="https://github.com/Python3WebSpider/AdslProxy" target="_blank" rel="noopener">https://github.com/Python3WebSpider/AdslProxy</a>。</p>
                  <h3 id="10-结语"><a href="#10-结语" class="headerlink" title="10. 结语"></a>10. 结语</h3>
                  <p>本节介绍了 ADSL 拨号代理的搭建过程。通过这种代理，我们可以无限次更换 IP，而且线路非常稳定，抓取效果好很多。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-10-20 13:36:03" itemprop="dateCreated datePublished" datetime="2019-10-20T13:36:03+08:00">2019-10-20</time>
                </span>
                <span id="/7842.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 9.4-ADSL 拨号代理" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>10k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>9 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/7820.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 技术杂谈 <i class="label-arrow"></i>
                  </a>
                  <a href="/7820.html" class="post-title-link" itemprop="url">来了来了！爬虫工程师最想要的手把手 JS 逆向系列教程！</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>爬虫是大数据时代不可或缺的数据获取手段，它是综合技术的应用体现。</p>
                  <p>​有取就有失，有攻就有防。开发者为了保护数据，不得已想出了很多办法来限制爬虫对数据的获取。WEB 网站的构成使得 JavaScript 成为了开发者阻挡爬虫的最佳选择。</p>
                  <p>作为一名爬虫工程师，解决目标网站设置的反爬虫手段是职责所在。大家遇到的问题都很相似：</p>
                  <blockquote>
                    <p>1、遇到加密的内容就无从下手，一片迷茫……！</p>
                    <p>2、会一点 JS 语法，能解一些简单的，但复杂的就不行了！</p>
                    <p>3、抠代码太繁杂了，根本不知道怎么办，一早上都定位不到函数入口！</p>
                    <p>4、混淆过后的代码，看得头都痛！</p>
                    <p>5、咦，这串加密的字符串怎么搞？</p>
                  </blockquote>
                  <p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g83b4kc8cwj307g07uwet.jpg" alt=""></p>
                  <p>需求又如何呢？</p>
                  <p>爬虫工程师真的需要学习逆向吗？</p>
                  <p>在此之前我们在多个爬虫工程师群做了调查，投票结果如下：</p>
                  <p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g83b74ney7j30ku112ad7.jpg" alt=""> <img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g83b6m63t0j30ku112go7.jpg" alt=""></p>
                  <p><strong>在招聘方面</strong></p>
                  <p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g83b80c3xpj30u0084t9i.jpg" alt=""> 很多岗位都要求有逆向或者解决反爬虫的能力 <img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g83b8bg88cj30u006jt9d.jpg" alt=""> 甚至作为优先选择的条件 <img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g83b8ltjhqj30u00gxmyv.jpg" alt=""></p>
                  <p><strong>显然，拥有逆向能力的爬虫工程师的职业等级会变得更高、团队地位更高，薪资自然也更高。</strong></p>
                  <p>本课程将主要从原理和技巧两个角度来为大家讲解 JavaScript 反爬虫绕过的相关知识。课程从反爬虫原理、工具介绍和使用、JavaScript 基础语法入手，结合常见的反爬虫现象及其绕过实战操作，帮助你掌握中级爬虫工程师必备的 JavaScript 逆向知识，向更高的职级迈进!</p>
                  <h3 id="你将从本课程中收获什么"><a href="#你将从本课程中收获什么" class="headerlink" title="你将从本课程中收获什么?"></a><strong>你将从本课程中收获什么?</strong></h3>
                  <p>序号</p>
                  <p>内容</p>
                  <p>重要程度</p>
                  <p>1</p>
                  <p>深入理解 JavaScript 反爬虫的根本原因</p>
                  <p>A+</p>
                  <p>2</p>
                  <p>了解工作中常用的 JavaScript 语法和知识</p>
                  <p>B</p>
                  <p>3</p>
                  <p>掌握各种逆向神器的基本使用和骚操作</p>
                  <p>A</p>
                  <p>4</p>
                  <p>深入理解 JavaScript 代码混淆的原理</p>
                  <p>A+</p>
                  <p>5</p>
                  <p>掌握 JavaScript 中常见的编码和加密方法</p>
                  <p>A</p>
                  <p>6</p>
                  <p>拥有快速定位加密代码位置的能力</p>
                  <p>A</p>
                  <p>7</p>
                  <p>轻松面对各种各样的加密字符串</p>
                  <p>A</p>
                  <p>学习案例的制作思路均来自实际网站在用的反爬虫手段，当你学习完整套课程后就可以独立面对前端反爬虫问题，平时的苦恼也将迎刃而解。</p>
                  <h3 id="课程大纲设计"><a href="#课程大纲设计" class="headerlink" title="课程大纲设计"></a>课程大纲设计</h3>
                  <p>序号</p>
                  <p>标签</p>
                  <p>课程标题</p>
                  <p>1</p>
                  <p>追根究底</p>
                  <p>探寻 JavaScript 反爬虫的根本原因</p>
                  <p>2</p>
                  <p>浮沙之上</p>
                  <p>课程中用到的 JavaScript 语法和知识</p>
                  <p>3</p>
                  <p>奇门遁甲</p>
                  <p>使用 Python 执行 JavaScript</p>
                  <p>4</p>
                  <p>蓄势待发</p>
                  <p>浏览器开发者工具的介绍和使用技巧</p>
                  <p>5</p>
                  <p>磨刀霍霍</p>
                  <p>抓包和拦截工具的介绍和使用技巧</p>
                  <p>6</p>
                  <p>初窥门径</p>
                  <p>阻挠爬虫工程师的无限 debug</p>
                  <p>7</p>
                  <p>火眼金睛</p>
                  <p>定位加密参数对应代码位置的方法</p>
                  <p>8</p>
                  <p>拨开云雾</p>
                  <p>代码混淆的原理</p>
                  <p>9</p>
                  <p>一击即中</p>
                  <p>处理代码混淆的方法</p>
                  <p>10</p>
                  <p>知己知彼</p>
                  <p>掌握常见的编码和加密</p>
                  <p>11</p>
                  <p>长枪直入</p>
                  <p>轻松解决反人类的混淆代码</p>
                  <p>12</p>
                  <p>一叶障目</p>
                  <p>服务端返回的神秘字符串</p>
                  <p>13</p>
                  <p>螳臂当车</p>
                  <p>解密！AES 并不是每次都奏效</p>
                  <p>14</p>
                  <p>插翅难逃</p>
                  <p>纵然 CSS 加身也难逃命运的安排</p>
                  <p>15</p>
                  <p>真假猴王</p>
                  <p>Base64 竟有如此威力</p>
                  <p>16</p>
                  <p>过眼云烟</p>
                  <p>历练半生 归来仍是少年</p>
                  <p>备注：具体开课时的目录有可能与现在的大纲存在差异，但改动不大。 这课程大纲预售放出来，我们都不怕别的机构抄，随便它们模仿。</p>
                  <h3 id="课程特色和内容制作团队介绍"><a href="#课程特色和内容制作团队介绍" class="headerlink" title="课程特色和内容制作团队介绍"></a>课程特色和内容制作团队介绍</h3>
                  <p>自研练习平台，不触碰法律红线、练习案例不会过期。</p>
                  <p>我们没有xx顶级讲师，也没有国外xx计算机硕士博士，不存在的。</p>
                  <p>我们只有一线爬虫工程师，讲最实用的内容，做最有效的练习。团队成员包括：崔庆才、韦世东、陈祥安、张冶青、唐轶飞、蔡晋、冯威、戴煌金、周子淇。</p>
                  <p>不像在线课平台，加群后讲师根本没空回答问题。我们会持续跟进与交流，制作良心内容，恶心营销狗?干的事我们才不会干。</p>
                  <p>团队成员有图书出版经历，例如崔庆才的 IT 畅销书《Python3 网络爬虫开发实战》、韦世东即将出版的《Python3 反爬虫原理与绕过实战》。</p>
                  <p>团队水平如何请大家自行斟酌，这里我就不吹嘘什么了。</p>
                  <p><img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g83b920xd7j30sg0lcq51.jpg" alt=""></p>
                  <h3 id="预售活动"><a href="#预售活动" class="headerlink" title="预售活动"></a>预售活动</h3>
                  <p>课程在准备当中，现在开放预售。完整课程售价 399，预售 50 元抵正式课程 100 元，且可提前进入视频教程的微信交流群，甚至可以提出想看的内容，团队会酌情考虑加课。</p>
                  <p>预售目标为 1000 人，不足 1000 人预售取消，逐个退款。</p>
                  <p>预售成功后，开课之前可以申请退课退款，支持全额退款。</p>
                  <p>参与预售的朋友还可以参与开课前的营销活动。</p>
                  <p>未参与预售的朋友，只能在开课时按原价或活动价购买课程。</p>
                  <p>预售活动截止日期为 2019年10月31日。</p>
                  <p><img src="https://mmbiz.qpic.cn/mmbiz_gif/a0YItejHaTD9aGmhbl6ib32VXibhNicvNqrUWoUEzprvG69eFlbbNuslsrP6vqtpUWAFApeBQak4yYRPanEQXKjDA/640?wx_fmt=gif" alt=""></p>
                  <h3 id="开课时间"><a href="#开课时间" class="headerlink" title="开课时间"></a>开课时间</h3>
                  <p>课程在准备当中，预计 2 个月左右可看，最迟 2020年01月20日 你就能看到了！</p>
                  <p>不过可以肯定的是，报名人数越多，内容制作越快。</p>
                  <h3 id="如何报名"><a href="#如何报名" class="headerlink" title="如何报名"></a>如何报名</h3>
                  <p>添加微信号：Domfreez，或者扫描下方二维码，与夜幕韦世东聊一聊。 我为粉丝争取到了额外的 50 元优惠，预售期间内主动出示优惠码：GERMEY01 即可在活动基础上再减 50 元！ 相信我没错的，现在你只需要花 50 元预订，399 元的课程就抵扣了 150，正式开售的时候只需要再付 249 即可学习，从此前端反爬虫不再是烦恼！ <img src="https://tva1.sinaimg.cn/large/006y8mN6gy1g83b9pswf8j30iq0owq49.jpg" alt=""> 声明： 本次活动最终解释权归内容制作方夜幕团队所有。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/韦世东学算法和反爬虫" class="author" itemprop="url" rel="index">韦世东学算法和反爬虫</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-10-19 08:44:48" itemprop="dateCreated datePublished" datetime="2019-10-19T08:44:48+08:00">2019-10-19</time>
                </span>
                <span id="/7820.html" class="post-meta-item leancloud_visitors" data-flag-title="来了来了！爬虫工程师最想要的手把手 JS 逆向系列教程！" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.9k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/7778.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 技术杂谈 <i class="label-arrow"></i>
                  </a>
                  <a href="/7778.html" class="post-title-link" itemprop="url">JSON-RPC 2.0 的一些规范</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>本文为转载文章，旨在记录一些有用的知识点。</p>
                  <ul>
                    <li>作者: <a href="https://groups.google.com/forum/#!forum/json-rpc" target="_blank" rel="noopener">JSON-RPC 工作组</a>&lt; json-rpc@googlegroups.com &gt;</li>
                    <li>原文链接: <a href="http://www.jsonrpc.org/specification" target="_blank" rel="noopener">http://www.jsonrpc.org/specification</a></li>
                    <li>翻译: <a href="http://geekdream.com/" target="_blank" rel="noopener">leozvc</a> &lt; xxfs91@gmail.com &gt;</li>
                  </ul>
                  <h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h2>
                  <p>JSON-RPC 是一个无状态且轻量级的远程过程调用 (RPC) 协议。 本规范主要定义了一些数据结构及其相关的处理规则。它允许运行在基于 socket, http 等诸多不同消息传输环境的同一进程中。其使用 <a href="http://www.json.org/" target="_blank" rel="noopener">JSON</a>（<a href="http://www.ietf.org/rfc/rfc4627.txt" target="_blank" rel="noopener">RFC 4627</a>）作为数据格式。 它为简单而生！</p>
                  <h2 id="2-约定"><a href="#2-约定" class="headerlink" title="2. 约定"></a>2. 约定</h2>
                  <p>文档中关键字 “MUST”、”MUST NOT”、”REQUIRED”、”SHALL”、”SHALL NOT”、”SHOULD”、”SHOULD NOT”、”RECOMMENDED”、”MAY” 和 “OPTIONAL” 将在 <a href="http://www.ietf.org/rfc/rfc2119.txt" target="_blank" rel="noopener">RFC 2119</a> 中得到详细的解释及描述。 由于 JSON-RPC 使用 JSON，它具有与其相同的类型系统 (见 <a href="http://www.json.org" target="_blank" rel="noopener">http://www.json.org</a> 或 <a href="http://www.ietf.org/rfc/rfc4627.txt" target="_blank" rel="noopener">RFC 4627</a>)。JSON 可以表示四个基本类型 (String、Numbers、Booleans 和 Null) 和两个结构化类型 (Objects 和 Arrays)。 规范中，术语 “Primitive” 标记那 4 种原始类型，“Structured” 标记两种结构化类型。任何时候文档涉及 JSON 数据类型，第一个字母都必须大写：Object，Array，String，Number，Boolean，Null。包括 True 和 False 也要大写。 在客户端与任何被匹配到的服务端之间交换的所有成员名字应是区分大小写的。 函数、方法、过程都可以认为是可以互换的。 客户端被定义为请求对象的来源及响应对象的处理程序。 服务端被定义为响应对象的起源和请求对象的处理程序。 该规范的一种实现为可以轻而易举的填补这两个角色，即使是在同一时间，同一客户端或其他不相同的客户端。 该规范不涉及复杂层。</p>
                  <h2 id="3-兼容性"><a href="#3-兼容性" class="headerlink" title="3. 兼容性"></a>3. 兼容性</h2>
                  <p>JSON-RPC 2.0 的请求对象和响应对象可能无法在现用的 JSON-RPC 1.0 客户端或服务端工作，然而我们可以很容易在两个版本间区分出 2.0，总会包含一个成员命名为 “jsonrpc” 且值为 “2.0”， 而 1.0 版本是不包含的。大部分的 2.0 实现应该考虑尝试处理 1.0 的对象，即使不是对等的也应给其相关提示。</p>
                  <h2 id="4-请求对象"><a href="#4-请求对象" class="headerlink" title="4. 请求对象"></a>4. 请求对象</h2>
                  <p>发送一个请求对象至服务端代表一个 rpc 调用， 一个请求对象包含下列成员： <strong>jsonrpc</strong></p>
                  <blockquote>
                    <p>指定 JSON-RPC 协议版本的字符串，必须准确写为 “2.0”</p>
                  </blockquote>
                  <p><strong>method</strong></p>
                  <blockquote>
                    <p>包含所要调用方法名称的字符串，以 rpc 开头的方法名，用英文句号（U+002E or ASCII 46）连接的为预留给 rpc 内部的方法名及扩展名，且不能在其他地方使用。</p>
                  </blockquote>
                  <p><strong>params</strong></p>
                  <blockquote>
                    <p>调用方法所需要的结构化参数值，该成员参数可以被省略。</p>
                  </blockquote>
                  <p><strong>id</strong></p>
                  <blockquote>
                    <p>已建立客户端的唯一标识 id，值必须包含一个字符串、数值或 NULL 空值。如果不包含该成员则被认定为是一个通知。该值一般不为 NULL <a href="http://wiki.geekdream.com/Specification/json-rpc_2.0.html#id1" target="_blank" rel="noopener">[1]</a>，若为数值则不应该包含小数 <a href="http://wiki.geekdream.com/Specification/json-rpc_2.0.html#id2" target="_blank" rel="noopener">[2]</a>。</p>
                  </blockquote>
                  <p>服务端必须回答相同的值如果包含在响应对象。 这个成员用来两个对象之间的关联上下文。 [1] 在请求对象中不建议使用 NULL 作为 id 值，因为该规范将使用空值认定为未知 id 的请求。另外，由于 JSON-RPC 1.0 的通知使用了空值，这可能引起处理上的混淆。 [2] 使用小数是不确定性的，因为许多十进制小数不能精准的表达为二进制小数。</p>
                  <h3 id="4-1-通知"><a href="#4-1-通知" class="headerlink" title="4.1 通知"></a>4.1 通知</h3>
                  <p>没有包含 “id” 成员的请求对象为通知， 作为通知的请求对象表明客户端对相应的响应对象并不感兴趣，本身也没有响应对象需要返回给客户端。服务端必须不回复一个通知，包含那些批量请求中的。 由于通知没有返回的响应对象，所以通知不确定是否被定义。同样，客户端不会意识到任何错误（例如参数缺省，内部错误）。</p>
                  <h3 id="4-2-参数结构"><a href="#4-2-参数结构" class="headerlink" title="4.2 参数结构"></a>4.2 参数结构</h3>
                  <p>rpc 调用如果存在参数则必须为基本类型或结构化类型的参数值，要么为索引数组，要么为关联数组对象。</p>
                  <ul>
                    <li>索引：参数必须为数组，并包含与服务端预期顺序一致的参数值。</li>
                    <li>关联名称：参数必须为对象，并包含与服务端相匹配的参数成员名称。没有在预期中的成员名称可能会引起错误。名称必须完全匹配，包括方法的预期参数名以及大小写。</li>
                  </ul>
                  <h2 id="5-响应对象"><a href="#5-响应对象" class="headerlink" title="5. 响应对象"></a>5. 响应对象</h2>
                  <p>当发起一个 rpc 调用时，除通知之外，服务端都必须回复响应。响应表示为一个 JSON 对象，使用以下成员： <strong>jsonrpc</strong></p>
                  <blockquote>
                    <p>指定 JSON-RPC 协议版本的字符串，必须准确写为 “2.0”</p>
                  </blockquote>
                  <p><strong>result</strong></p>
                  <blockquote>
                    <p>该成员在成功时必须包含。 当调用方法引起错误时必须不包含该成员。 服务端中的被调用方法决定了该成员的值。</p>
                  </blockquote>
                  <p><strong>error</strong></p>
                  <blockquote>
                    <p>该成员在失败是必须包含。 当没有引起错误的时必须不包含该成员。 该成员参数值必须为 5.1 中定义的对象。</p>
                  </blockquote>
                  <p><strong>id</strong></p>
                  <blockquote>
                    <p>该成员必须包含。 该成员值必须于请求对象中的 id 成员值一致。 若在检查请求对象 id 时错误（例如参数错误或无效请求），则该值必须为空值。</p>
                  </blockquote>
                  <p>响应对象必须包含 result 或 error 成员，但两个成员必须不能同时包含。</p>
                  <h3 id="5-1-错误对象"><a href="#5-1-错误对象" class="headerlink" title="5.1 错误对象"></a>5.1 错误对象</h3>
                  <p>当一个 rpc 调用遇到错误时，返回的响应对象必须包含错误成员参数，并且为带有下列成员参数的对象： <strong>code</strong></p>
                  <blockquote>
                    <p>使用数值表示该异常的错误类型。 必须为整数。</p>
                  </blockquote>
                  <p><strong>message</strong></p>
                  <blockquote>
                    <p>对该错误的简单描述字符串。 该描述应尽量限定在简短的一句话。</p>
                  </blockquote>
                  <p><strong>data</strong></p>
                  <blockquote>
                    <p>包含关于错误附加信息的基本类型或结构化类型。该成员可忽略。 该成员值由服务端定义（例如详细的错误信息，嵌套的错误等）。</p>
                  </blockquote>
                  <p>-32768 至 - 32000 为保留的预定义错误代码。在该范围内的错误代码不能被明确定义，保留下列以供将来使用。错误代码基本与 XML-RPC 建议的一样，url： <a href="http://xmlrpc-epi.sourceforge.net/specs/rfc.fault_codes.php" target="_blank" rel="noopener">http://xmlrpc-epi.sourceforge.net/specs/rfc.fault_codes.php</a></p>
                  <p>code</p>
                  <p>message</p>
                  <p>meaning</p>
                  <p>-32700</p>
                  <p>Parse error 语法解析错误</p>
                  <p>服务端接收到无效的 json。该错误发送于服务器尝试解析 json 文本</p>
                  <p>-32600</p>
                  <p>Invalid Request 无效请求</p>
                  <p>发送的 json 不是一个有效的请求对象。</p>
                  <p>-32601</p>
                  <p>Method not found 找不到方法</p>
                  <p>该方法不存在或无效</p>
                  <p>-32602</p>
                  <p>Invalid params 无效的参数</p>
                  <p>无效的方法参数。</p>
                  <p>-32603</p>
                  <p>Internal error 内部错误</p>
                  <p>JSON-RPC 内部错误。</p>
                  <p>-32000 to -32099</p>
                  <p>Server error 服务端错误</p>
                  <p>预留用于自定义的服务器错误。</p>
                  <p>除此之外剩余的错误类型代码可供应用程序作为自定义错误。</p>
                  <h2 id="6-批量调用"><a href="#6-批量调用" class="headerlink" title="6. 批量调用"></a>6. 批量调用</h2>
                  <p>当需要同时发送多个请求对象时，客户端可以发送一个包含所有请求对象的数组。 当批量调用的所有请求对象处理完成时，服务端则需要返回一个包含相对应的响应对象数组。每个响应对象都应对应每个请求对象，除非是通知的请求对象。服务端可以并发的，以任意顺序和任意宽度的并行性来处理这些批量调用。 这些相应的响应对象可以任意顺序的包含在返回的数组中，而客户端应该是基于各个响应对象中的 id 成员来匹配对应的请求对象。 若批量调用的 rpc 操作本身非一个有效 json 或一个至少包含一个值的数组，则服务端返回的将单单是一个响应对象而非数组。若批量调用没有需要返回的响应对象，则服务端不需要返回任何结果且必须不能返回一个空数组给客户端。</p>
                  <h2 id="7-示例"><a href="#7-示例" class="headerlink" title="7. 示例"></a>7. 示例</h2>
                  <p><strong>语法:</strong></p>
                  <blockquote>
                    <p>--&gt; data sent to Server data sent to Client</p>
                  </blockquote>
                  <p>带索引数组参数的rpc调用:</p>
                  <figure class="highlight clean">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">\--&gt; &#123;<span class="string">"jsonrpc"</span>: <span class="string">"2.0"</span>, <span class="string">"method"</span>: <span class="string">"subtract"</span>, <span class="string">"params"</span>: [<span class="number">42</span>, <span class="number">23</span>], <span class="string">"id"</span>: <span class="number">1</span>&#125;</span><br><span class="line"> &#123;<span class="string">"jsonrpc"</span>: <span class="string">"2.0"</span>, <span class="string">"result"</span>: <span class="number">19</span>, <span class="string">"id"</span>: <span class="number">1</span>&#125;</span><br><span class="line"></span><br><span class="line">--&gt; &#123;<span class="string">"jsonrpc"</span>: <span class="string">"2.0"</span>, <span class="string">"method"</span>: <span class="string">"subtract"</span>, <span class="string">"params"</span>: [<span class="number">23</span>, <span class="number">42</span>], <span class="string">"id"</span>: <span class="number">2</span>&#125;</span><br><span class="line"> &#123;<span class="string">"jsonrpc"</span>: <span class="string">"2.0"</span>, <span class="string">"result"</span>: <span class="number">-19</span>, <span class="string">"id"</span>: <span class="number">2</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>带关联数组参数的rpc调用:</p>
                  <figure class="highlight clean">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">\--&gt; &#123;<span class="string">"jsonrpc"</span>: <span class="string">"2.0"</span>, <span class="string">"method"</span>: <span class="string">"subtract"</span>, <span class="string">"params"</span>: &#123;<span class="string">"subtrahend"</span>: <span class="number">23</span>, <span class="string">"minuend"</span>: <span class="number">42</span>&#125;, <span class="string">"id"</span>: <span class="number">3</span>&#125;</span><br><span class="line"> &#123;<span class="string">"jsonrpc"</span>: <span class="string">"2.0"</span>, <span class="string">"result"</span>: <span class="number">19</span>, <span class="string">"id"</span>: <span class="number">3</span>&#125;</span><br><span class="line"></span><br><span class="line">--&gt; &#123;<span class="string">"jsonrpc"</span>: <span class="string">"2.0"</span>, <span class="string">"method"</span>: <span class="string">"subtract"</span>, <span class="string">"params"</span>: &#123;<span class="string">"minuend"</span>: <span class="number">42</span>, <span class="string">"subtrahend"</span>: <span class="number">23</span>&#125;, <span class="string">"id"</span>: <span class="number">4</span>&#125;</span><br><span class="line"> &#123;<span class="string">"jsonrpc"</span>: <span class="string">"2.0"</span>, <span class="string">"result"</span>: <span class="number">19</span>, <span class="string">"id"</span>: <span class="number">4</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通知:</p>
                  <figure class="highlight clean">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">\--&gt; &#123;<span class="string">"jsonrpc"</span>: <span class="string">"2.0"</span>, <span class="string">"method"</span>: <span class="string">"update"</span>, <span class="string">"params"</span>: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]&#125;</span><br><span class="line">--&gt; &#123;<span class="string">"jsonrpc"</span>: <span class="string">"2.0"</span>, <span class="string">"method"</span>: <span class="string">"foobar"</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>不包含调用方法的rpc调用:</p>
                  <figure class="highlight clean">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">\--&gt; &#123;<span class="string">"jsonrpc"</span>: <span class="string">"2.0"</span>, <span class="string">"method"</span>: <span class="string">"foobar"</span>, <span class="string">"id"</span>: <span class="string">"1"</span>&#125;</span><br><span class="line"> &#123;<span class="string">"jsonrpc"</span>: <span class="string">"2.0"</span>, <span class="string">"error"</span>: &#123;<span class="string">"code"</span>: <span class="number">-32601</span>, <span class="string">"message"</span>: <span class="string">"Method not found"</span>&#125;, <span class="string">"id"</span>: <span class="string">"1"</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>包含无效json的rpc调用:</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">\--&gt; &#123;<span class="string">"jsonrpc"</span>: <span class="string">"2.0"</span>, <span class="string">"method"</span>: <span class="string">"foobar, "</span>params<span class="string">": "</span>ba<span class="string">r", "</span>baz]</span><br><span class="line"> &#123;<span class="string">"jsonrpc"</span>: <span class="string">"2.0"</span>, <span class="string">"error"</span>: &#123;<span class="string">"code"</span>: -<span class="number">32700</span>, <span class="string">"message"</span>: <span class="string">"Parse error"</span>&#125;, <span class="string">"id"</span>: null&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>包含无效请求对象的rpc调用:</p>
                  <figure class="highlight livescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="string">\--&gt;</span> &#123;<span class="string">"jsonrpc"</span>: <span class="string">"2.0"</span>, <span class="string">"method"</span>: <span class="number">1</span>, <span class="string">"params"</span>: <span class="string">"bar"</span>&#125;</span><br><span class="line"> &#123;<span class="string">"jsonrpc"</span>: <span class="string">"2.0"</span>, <span class="string">"error"</span>: &#123;<span class="string">"code"</span>: -<span class="number">32600</span>, <span class="string">"message"</span>: <span class="string">"Invalid Request"</span>&#125;, <span class="string">"id"</span>: <span class="literal">null</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>包含无效json的rpc批量调用:</p>
                  <figure class="highlight livescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="string">\--&gt;</span> [</span><br><span class="line">        &#123;<span class="string">"jsonrpc"</span>: <span class="string">"2.0"</span>, <span class="string">"method"</span>: <span class="string">"sum"</span>, <span class="string">"params"</span>: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>], <span class="string">"id"</span>: <span class="string">"1"</span>&#125;,</span><br><span class="line">        &#123;<span class="string">"jsonrpc"</span>: <span class="string">"2.0"</span>, <span class="string">"method"</span></span><br><span class="line">    ]</span><br><span class="line"> &#123;<span class="string">"jsonrpc"</span>: <span class="string">"2.0"</span>, <span class="string">"error"</span>: &#123;<span class="string">"code"</span>: -<span class="number">32700</span>, <span class="string">"message"</span>: <span class="string">"Parse error"</span>&#125;, <span class="string">"id"</span>: <span class="literal">null</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>包含空数组的rpc调用:</p>
                  <figure class="highlight livescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="string">\--&gt;</span> []</span><br><span class="line"> &#123;<span class="string">"jsonrpc"</span>: <span class="string">"2.0"</span>, <span class="string">"error"</span>: &#123;<span class="string">"code"</span>: -<span class="number">32600</span>, <span class="string">"message"</span>: <span class="string">"Invalid Request"</span>&#125;, <span class="string">"id"</span>: <span class="literal">null</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>非空且无效的rpc批量调用:</p>
                  <figure class="highlight livescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="string">\--&gt;</span> [<span class="number">1</span>]</span><br><span class="line"> [</span><br><span class="line">    &#123;<span class="string">"jsonrpc"</span>: <span class="string">"2.0"</span>, <span class="string">"error"</span>: &#123;<span class="string">"code"</span>: -<span class="number">32600</span>, <span class="string">"message"</span>: <span class="string">"Invalid Request"</span>&#125;, <span class="string">"id"</span>: <span class="literal">null</span>&#125;</span><br><span class="line">    ]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>无效的rpc批量调用:</p>
                  <figure class="highlight livescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="string">\--&gt;</span> [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"> [</span><br><span class="line">    &#123;<span class="string">"jsonrpc"</span>: <span class="string">"2.0"</span>, <span class="string">"error"</span>: &#123;<span class="string">"code"</span>: -<span class="number">32600</span>, <span class="string">"message"</span>: <span class="string">"Invalid Request"</span>&#125;, <span class="string">"id"</span>: <span class="literal">null</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"jsonrpc"</span>: <span class="string">"2.0"</span>, <span class="string">"error"</span>: &#123;<span class="string">"code"</span>: -<span class="number">32600</span>, <span class="string">"message"</span>: <span class="string">"Invalid Request"</span>&#125;, <span class="string">"id"</span>: <span class="literal">null</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"jsonrpc"</span>: <span class="string">"2.0"</span>, <span class="string">"error"</span>: &#123;<span class="string">"code"</span>: -<span class="number">32600</span>, <span class="string">"message"</span>: <span class="string">"Invalid Request"</span>&#125;, <span class="string">"id"</span>: <span class="literal">null</span>&#125;</span><br><span class="line">    ]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>rpc批量调用:</p>
                  <figure class="highlight prolog">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">\--&gt; [</span><br><span class="line">    &#123;<span class="string">"jsonrpc"</span>: <span class="string">"2.0"</span>, <span class="string">"method"</span>: <span class="string">"sum"</span>, <span class="string">"params"</span>: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>], <span class="string">"id"</span>: <span class="string">"1"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"jsonrpc"</span>: <span class="string">"2.0"</span>, <span class="string">"method"</span>: <span class="string">"notify_hello"</span>, <span class="string">"params"</span>: [<span class="number">7</span>]&#125;,</span><br><span class="line">    &#123;<span class="string">"jsonrpc"</span>: <span class="string">"2.0"</span>, <span class="string">"method"</span>: <span class="string">"subtract"</span>, <span class="string">"params"</span>: [<span class="number">42</span>,<span class="number">23</span>], <span class="string">"id"</span>: <span class="string">"2"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"foo"</span>: <span class="string">"boo"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"jsonrpc"</span>: <span class="string">"2.0"</span>, <span class="string">"method"</span>: <span class="string">"foo.get"</span>, <span class="string">"params"</span>: &#123;<span class="string">"name"</span>: <span class="string">"myself"</span>&#125;, <span class="string">"id"</span>: <span class="string">"5"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"jsonrpc"</span>: <span class="string">"2.0"</span>, <span class="string">"method"</span>: <span class="string">"get_data"</span>, <span class="string">"id"</span>: <span class="string">"9"</span>&#125; </span><br><span class="line">    ]</span><br><span class="line"> [</span><br><span class="line">    &#123;<span class="string">"jsonrpc"</span>: <span class="string">"2.0"</span>, <span class="string">"result"</span>: <span class="number">7</span>, <span class="string">"id"</span>: <span class="string">"1"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"jsonrpc"</span>: <span class="string">"2.0"</span>, <span class="string">"result"</span>: <span class="number">19</span>, <span class="string">"id"</span>: <span class="string">"2"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"jsonrpc"</span>: <span class="string">"2.0"</span>, <span class="string">"error"</span>: &#123;<span class="string">"code"</span>: <span class="number">-32600</span>, <span class="string">"message"</span>: <span class="string">"Invalid Request"</span>&#125;, <span class="string">"id"</span>: null&#125;,</span><br><span class="line">    &#123;<span class="string">"jsonrpc"</span>: <span class="string">"2.0"</span>, <span class="string">"error"</span>: &#123;<span class="string">"code"</span>: <span class="number">-32601</span>, <span class="string">"message"</span>: <span class="string">"Method not found"</span>&#125;, <span class="string">"id"</span>: <span class="string">"5"</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"jsonrpc"</span>: <span class="string">"2.0"</span>, <span class="string">"result"</span>: [<span class="string">"hello"</span>, <span class="number">5</span>], <span class="string">"id"</span>: <span class="string">"9"</span>&#125;</span><br><span class="line">    ]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>所有都为通知的rpc批量调用:</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">\<span class="comment">--&gt; [</span></span><br><span class="line">    &#123;"jsonrpc": "2.0", "method": "notify_sum", "params": [<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>]&#125;,</span><br><span class="line">    &#123;"jsonrpc": "2.0", "method": "notify_hello", "params": [<span class="number">7</span>]&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"> //<span class="keyword">Nothing</span> <span class="keyword">is</span> returned <span class="keyword">for</span> <span class="keyword">all</span> notification batches</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="8-扩展"><a href="#8-扩展" class="headerlink" title="8. 扩展"></a>8. 扩展</h2>
                  <p>以 rpc 开头的方法名预留作为系统扩展，且必须不能用于其他地方。每个系统扩展都应该有相关规范文档，所有系统扩展都应是可选的。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-10-17 10:54:01" itemprop="dateCreated datePublished" datetime="2019-10-17T10:54:01+08:00">2019-10-17</time>
                </span>
                <span id="/7778.html" class="post-meta-item leancloud_visitors" data-flag-title="JSON-RPC 2.0 的一些规范" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>6.1k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>6 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/7776.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 技术杂谈 <i class="label-arrow"></i>
                  </a>
                  <a href="/7776.html" class="post-title-link" itemprop="url">Python 中更优雅的日志记录方案 loguru</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>在 Python 中，一般情况下我们可能直接用自带的 logging 模块来记录日志，包括我之前的时候也是一样。在使用时我们需要配置一些 Handler、Formatter 来进行一些处理，比如把日志输出到不同的位置，或者设置一个不同的输出格式，或者设置日志分块和备份。但其实个人感觉 logging 用起来其实并不是那么好用，其实主要还是配置较为繁琐。</p>
                  <h2 id="常见使用"><a href="#常见使用" class="headerlink" title="常见使用"></a>常见使用</h2>
                  <p>首先看看 logging 常见的解决方案吧，我一般会配置输出到文件、控制台和 Elasticsearch。输出到控制台就仅仅是方便直接查看的；输出到文件是方便直接存储，保留所有历史记录的备份；输出到 Elasticsearch，直接将 Elasticsearch 作为存储和分析的中心，使用 Kibana 可以非常方便地分析和查看运行情况。 所以在这里我基本会对 logging 做如下的封装写法：</p>
                  <figure class="highlight nix">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">import</span> logging</span><br><span class="line"><span class="built_in">import</span> sys</span><br><span class="line">from os <span class="built_in">import</span> makedirs</span><br><span class="line">from os.path <span class="built_in">import</span> dirname, exists</span><br><span class="line"></span><br><span class="line">from cmreslogging.handlers <span class="built_in">import</span> CMRESHandler</span><br><span class="line"></span><br><span class="line"><span class="attr">loggers</span> = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="attr">LOG_ENABLED</span> = True  <span class="comment"># 是否开启日志</span></span><br><span class="line"><span class="attr">LOG_TO_CONSOLE</span> = True  <span class="comment"># 是否输出到控制台</span></span><br><span class="line"><span class="attr">LOG_TO_FILE</span> = True  <span class="comment"># 是否输出到文件</span></span><br><span class="line"><span class="attr">LOG_TO_ES</span> = True  <span class="comment"># 是否输出到 Elasticsearch</span></span><br><span class="line"></span><br><span class="line"><span class="attr">LOG_PATH</span> = './runtime.log'  <span class="comment"># 日志文件路径</span></span><br><span class="line"><span class="attr">LOG_LEVEL</span> = 'DEBUG'  <span class="comment"># 日志级别</span></span><br><span class="line"><span class="attr">LOG_FORMAT</span> = '%(levelname)s - %(asctime)s - process: %(process)d - %(filename)s - %(name)s - %(lineno)d - %(module)s - %(message)s'  <span class="comment"># 每条日志输出格式</span></span><br><span class="line"><span class="attr">ELASTIC_SEARCH_HOST</span> = 'eshost'  <span class="comment"># Elasticsearch Host</span></span><br><span class="line"><span class="attr">ELASTIC_SEARCH_PORT</span> = <span class="number">9200</span>  <span class="comment"># Elasticsearch Port</span></span><br><span class="line"><span class="attr">ELASTIC_SEARCH_INDEX</span> = 'runtime'  <span class="comment"># Elasticsearch Index Name</span></span><br><span class="line"><span class="attr">APP_ENVIRONMENT</span> = 'dev'  <span class="comment"># 运行环境，如测试环境还是生产环境</span></span><br><span class="line"></span><br><span class="line">def get_logger(<span class="attr">name=None):</span></span><br><span class="line">    <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">    get logger by name</span></span><br><span class="line"><span class="string">    :param name: name of logger</span></span><br><span class="line"><span class="string">    :return: logger</span></span><br><span class="line"><span class="string">    "</span><span class="string">""</span></span><br><span class="line">    global loggers</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> not name: <span class="attr">name</span> = __name__</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> loggers.get(name):</span><br><span class="line">        return loggers.get(name)</span><br><span class="line"></span><br><span class="line">    <span class="attr">logger</span> = logging.getLogger(name)</span><br><span class="line">    logger.setLevel(LOG_LEVEL)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 输出到控制台</span></span><br><span class="line">    <span class="keyword">if</span> LOG_ENABLED <span class="literal">and</span> LOG_TO_CONSOLE:</span><br><span class="line">        <span class="attr">stream_handler</span> = logging.StreamHandler(sys.stdout)</span><br><span class="line">        stream_handler.setLevel(<span class="attr">level=LOG_LEVEL)</span></span><br><span class="line">        <span class="attr">formatter</span> = logging.Formatter(LOG_FORMAT)</span><br><span class="line">        stream_handler.setFormatter(formatter)</span><br><span class="line">        logger.addHandler(stream_handler)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 输出到文件</span></span><br><span class="line">    <span class="keyword">if</span> LOG_ENABLED <span class="literal">and</span> LOG_TO_FILE:</span><br><span class="line">        <span class="comment"># 如果路径不存在，创建日志文件文件夹</span></span><br><span class="line">        <span class="attr">log_dir</span> = dirname(log_path)</span><br><span class="line">        <span class="keyword">if</span> not exists(log_dir): makedirs(log_dir)</span><br><span class="line">        <span class="comment"># 添加 FileHandler</span></span><br><span class="line">        <span class="attr">file_handler</span> = logging.FileHandler(log_path, <span class="attr">encoding='utf-8')</span></span><br><span class="line">        file_handler.setLevel(<span class="attr">level=LOG_LEVEL)</span></span><br><span class="line">        <span class="attr">formatter</span> = logging.Formatter(LOG_FORMAT)</span><br><span class="line">        file_handler.setFormatter(formatter)</span><br><span class="line">        logger.addHandler(file_handler)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 输出到 Elasticsearch</span></span><br><span class="line">    <span class="keyword">if</span> LOG_ENABLED <span class="literal">and</span> LOG_TO_ES:</span><br><span class="line">        <span class="comment"># 添加 CMRESHandler</span></span><br><span class="line">        <span class="attr">es_handler</span> = CMRESHandler(<span class="attr">hosts=[&#123;'host':</span> ELASTIC_SEARCH_HOST, 'port': ELASTIC_SEARCH_PORT&#125;],</span><br><span class="line">                                  <span class="comment"># 可以配置对应的认证权限</span></span><br><span class="line">                                  <span class="attr">auth_type=CMRESHandler.AuthType.NO_AUTH,</span></span><br><span class="line">                                  <span class="attr">es_index_name=ELASTIC_SEARCH_INDEX,</span></span><br><span class="line">                                  <span class="comment"># 一个月分一个 Index</span></span><br><span class="line">                                  <span class="attr">index_name_frequency=CMRESHandler.IndexNameFrequency.MONTHLY,</span></span><br><span class="line">                                  <span class="comment"># 额外增加环境标识</span></span><br><span class="line">                                  <span class="attr">es_additional_fields=&#123;'environment':</span> APP_ENVIRONMENT&#125;</span><br><span class="line">                                  )</span><br><span class="line">        es_handler.setLevel(<span class="attr">level=LOG_LEVEL)</span></span><br><span class="line">        <span class="attr">formatter</span> = logging.Formatter(LOG_FORMAT)</span><br><span class="line">        es_handler.setFormatter(formatter)</span><br><span class="line">        logger.addHandler(es_handler)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 保存到全局 loggers</span></span><br><span class="line">    loggers[name] = logger</span><br><span class="line">    return logger</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>定义完了怎么使用呢？只需要使用定义的方法获取一个 logger，然后 log 对应的内容即可：</p>
                  <figure class="highlight gcode">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">logger = get_logger<span class="comment">()</span></span><br><span class="line">logger.debug<span class="comment">('this is a message')</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">DEBUG - <span class="number">2019</span><span class="number">-10</span><span class="number">-11</span> <span class="number">22</span>:<span class="number">27</span>:<span class="number">35</span>,<span class="number">923</span> - process: <span class="number">99490</span> - logger.py - __main__ - <span class="number">81</span> - logger - <span class="keyword">this</span> <span class="keyword">is</span> a message</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们看看这个定义的基本实现吧。首先这里一些常量是用来定义 logging 模块的一些基本属性的，比如 <code>LOG_ENABLED</code> 代表是否开启日志功能，<code>LOG_TO_ES</code> 代表是否将日志输出到 Elasticsearch，另外还有很多其他的日志基本配置，如 <code>LOG_FORMAT</code> 配置了日志每个条目输出的基本格式，另外还有一些连接的必要信息。这些变量可以和运行时的命令行或环境变量对接起来，可以方便地实现一些开关和配置的更换。 然后定义了这么一个 get_logger 方法，接收一个参数 name。首先该方法拿到 name 之后，会到全局的 loggers 变量里面查找，loggers 变量是一个全局字典，如果有已经声明过的 logger，直接将其获取返回即可，不用再将其二次初始化。如果 loggers 里面没有找到 name 对应的 logger，那就进行创建即可。创建 logger 之后，可以为其添加各种对应的 Handler，如输出到控制台就用 StreamHandler，输出到文件就用 FileHandler 或 RotatingFileHandler，输出到 Elasticsearch 就用 CMRESHandler，分别配置好对应的信息即可。 最后呢，将新建的 logger 保存到全局的 loggers 里面并返回即可，这样如果有同名的 logger 便可以直接查找 loggers 直接返回了。 在这里依赖了额外的输出到 Elasticsearch 的包，叫做 CMRESHandler，它可以支持将日志输出到 Elasticsearch 里面，如果要使用的话可以安装一下：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip <span class="keyword">install</span> CMRESHandler</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其 GitHub 地址是：<a href="https://github.com/cmanaha/python-elasticsearch-logger，具体的使用方式可以看看它的官方说明，如配置认证信息，配置" target="_blank" rel="noopener">https://github.com/cmanaha/python-elasticsearch-logger，具体的使用方式可以看看它的官方说明，如配置认证信息，配置</a> Index 分隔信息等等。 好，上面就是我之前常用的 logging 配置，通过如上的配置，我就可以实现将 logging 输出到三个位置，并可以实现对应的效果。比如输出到 Elasticsearch 之后，我就可以非常方便地使用 Kibana 来查看当前运行情况，ERROR Log 的比例等等，如图所示： <img src="https://cdn.cuiqingcai.com/2019-10-13-143457.png" alt=""> 也可以在它的基础上做更进一步的统计分析。</p>
                  <h2 id="loguru"><a href="#loguru" class="headerlink" title="loguru"></a>loguru</h2>
                  <p>上面的实现方式已经是一个较为可行的配置方案了。然而，我还是会感觉到有些 Handler 配起来麻烦，尤其是新建一个项目的很多时候懒得去写一些配置。即使是不用上文的配置，用最基本的几行 logging 配置，像如下的通用配置：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import logging</span><br><span class="line">logging.basicConfig(level = logging.INFO,format = <span class="string">'%(asctime)s - %(name)s - %(levelname)s - %(message)s'</span>)</span><br><span class="line">logger = logging.getLogger(__name__)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我也懒得去写，感觉并不是一个优雅的实现方式。 有需求就有动力啊，这不，就有人实现了这么一个库，叫做 loguru，可以将 log 的配置和使用更加简单和方便。 下面我们来看看它到底是怎么用的吧。</p>
                  <h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2>
                  <p>首先，这个库的安装方式很简单，就用基本的 pip 安装即可，Python 3 版本的安装如下：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> loguru</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>安装完毕之后，我们就可以在项目里使用这个 loguru 库了。</p>
                  <h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2>
                  <p>那么这个库怎么来用呢？我们先用一个实例感受下：</p>
                  <figure class="highlight moonscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> loguru <span class="keyword">import</span> logger</span><br><span class="line"></span><br><span class="line">logger.<span class="built_in">debug</span>(<span class="string">'this is a debug message'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>看到了吧，不需要配置什么东西，直接引入一个 logger，然后调用其 debug 方法即可。 在 loguru 里面有且仅有一个主要对象，那就是 logger，loguru 里面有且仅有一个 logger，而且它已经被提前配置了一些基础信息，比如比较友好的格式化、文本颜色信息等等。 上面的代码运行结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-13</span> <span class="number">22</span>:<span class="number">46</span>:<span class="number">12.367</span> | DEBUG    | __main__:&lt;module&gt;:<span class="number">4</span> - <span class="keyword">this</span> <span class="keyword">is</span> a debug message</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到其默认的输出格式是上面的内容，有时间、级别、模块名、行号以及日志信息，不需要手动创建 logger，直接使用即可，另外其输出还是彩色的，看起来会更加友好。 以上的日志信息是直接输出到控制台的，并没有输出到其他的地方，如果想要输出到其他的位置，比如存为文件，我们只需要使用一行代码声明即可。 例如将结果同时输出到一个 runtime.log 文件里面，可以这么写：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> loguru import logger</span><br><span class="line"></span><br><span class="line">logger.<span class="builtin-name">add</span>(<span class="string">'runtime.log'</span>)</span><br><span class="line">logger.<span class="builtin-name">debug</span>(<span class="string">'this is a debug'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>很简单吧，我们也不需要再声明一个 FileHandler 了，就一行 add 语句搞定，运行之后会发现目录下 runtime.log 里面同样出现了刚刚控制台输出的 DEBUG 信息。 上面就是一些基本的使用，但这还远远不够，下面我们来详细了解下它的一些功能模块。</p>
                  <h2 id="详细使用"><a href="#详细使用" class="headerlink" title="详细使用"></a>详细使用</h2>
                  <p>既然是日志，那么最常见的就是输出到文件了。loguru 对输出到文件的配置有非常强大的支持，比如支持输出到多个文件，分级别分别输出，过大创建新文件，过久自动删除等等。 下面我们分别看看这些怎样来实现，这里基本上就是 add 方法的使用介绍。因为这个 add 方法就相当于给 logger 添加了一个 Handler，它给我们暴露了许多参数来实现 Handler 的配置，下面我们来详细介绍下。 首先看看它的方法定义吧：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">def <span class="builtin-name">add</span>(</span><br><span class="line">        self,</span><br><span class="line">        sink,</span><br><span class="line">        *,</span><br><span class="line">        <span class="attribute">level</span>=_defaults.LOGURU_LEVEL,</span><br><span class="line">        <span class="attribute">format</span>=_defaults.LOGURU_FORMAT,</span><br><span class="line">        <span class="attribute">filter</span>=_defaults.LOGURU_FILTER,</span><br><span class="line">        <span class="attribute">colorize</span>=_defaults.LOGURU_COLORIZE,</span><br><span class="line">        <span class="attribute">serialize</span>=_defaults.LOGURU_SERIALIZE,</span><br><span class="line">        <span class="attribute">backtrace</span>=_defaults.LOGURU_BACKTRACE,</span><br><span class="line">        <span class="attribute">diagnose</span>=_defaults.LOGURU_DIAGNOSE,</span><br><span class="line">        <span class="attribute">enqueue</span>=_defaults.LOGURU_ENQUEUE,</span><br><span class="line">        <span class="attribute">catch</span>=_defaults.LOGURU_CATCH,</span><br><span class="line">        **kwargs</span><br><span class="line">    ):</span><br><span class="line">    pass</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>看看它的源代码，它支持这么多的参数，如 level、format、filter、color 等等，另外我们还注意到它有个非常重要的参数 sink，我们看看官方文档：<a href="https://loguru.readthedocs.io/en/stable/api/logger.html#sink，可以了解到通过" target="_blank" rel="noopener">https://loguru.readthedocs.io/en/stable/api/logger.html#sink，可以了解到通过</a> sink 我们可以传入多种不同的数据结构，汇总如下：</p>
                  <ul>
                    <li>sink 可以传入一个 file 对象，例如 <code>sys.stderr</code> 或者 <code>open(&#39;file.log&#39;, &#39;w&#39;)</code> 都可以。</li>
                    <li>sink 可以直接传入一个 <code>str</code> 字符串或者 <code>pathlib.Path</code> 对象，其实就是代表文件路径的，如果识别到是这种类型，它会自动创建对应路径的日志文件并将日志输出进去。</li>
                    <li>sink 可以是一个方法，可以自行定义输出实现。</li>
                    <li>sink 可以是一个 logging 模块的 Handler，比如 FileHandler、StreamHandler 等等，或者上文中我们提到的 CMRESHandler 照样也是可以的，这样就可以实现自定义 Handler 的配置。</li>
                    <li>sink 还可以是一个自定义的类，具体的实现规范可以参见官方文档。</li>
                  </ul>
                  <p>所以说，刚才我们所演示的输出到文件，仅仅给它传了一个 str 字符串路径，他就给我们创建了一个日志文件，就是这个原理。</p>
                  <h3 id="基本参数"><a href="#基本参数" class="headerlink" title="基本参数"></a>基本参数</h3>
                  <p>下面我们再了解下它的其他参数，例如 format、filter、level 等等。 其实它们的概念和格式和 logging 模块都是基本一样的了，例如这里使用 format、filter、level 来规定输出的格式：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">logger.<span class="builtin-name">add</span>(<span class="string">'runtime.log'</span>, <span class="attribute">format</span>=<span class="string">"&#123;time&#125; &#123;level&#125; &#123;message&#125;"</span>, <span class="attribute">filter</span>=<span class="string">"my_module"</span>, <span class="attribute">level</span>=<span class="string">"INFO"</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="删除-sink"><a href="#删除-sink" class="headerlink" title="删除 sink"></a>删除 sink</h3>
                  <p>另外添加 sink 之后我们也可以对其进行删除，相当于重新刷新并写入新的内容。 删除的时候根据刚刚 add 方法返回的 id 进行删除即可，看下面的例子：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> loguru import logger</span><br><span class="line"></span><br><span class="line">trace = logger.<span class="builtin-name">add</span>(<span class="string">'runtime.log'</span>)</span><br><span class="line">logger.<span class="builtin-name">debug</span>(<span class="string">'this is a debug message'</span>)</span><br><span class="line">logger.<span class="builtin-name">remove</span>(trace)</span><br><span class="line">logger.<span class="builtin-name">debug</span>(<span class="string">'this is another debug message'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>看这里，我们首先 add 了一个 sink，然后获取它的返回值，赋值为 trace。随后输出了一条日志，然后将 trace 变量传给 remove 方法，再次输出一条日志，看看结果是怎样的。 控制台输出如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-13</span> <span class="number">23</span>:<span class="number">18</span>:<span class="number">26.469</span> | DEBUG    | __main__:&lt;module&gt;:<span class="number">4</span> - <span class="keyword">this</span> <span class="keyword">is</span> a debug message</span><br><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-13</span> <span class="number">23</span>:<span class="number">18</span>:<span class="number">26.469</span> | DEBUG    | __main__:&lt;module&gt;:<span class="number">6</span> - <span class="keyword">this</span> <span class="keyword">is</span> another debug message</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>日志文件 runtime.log 内容如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">2019</span><span class="number">-10</span><span class="number">-13</span> <span class="number">23</span>:<span class="number">18</span>:<span class="number">26.469</span> | DEBUG    | __main__:&lt;module&gt;:<span class="number">4</span> - <span class="keyword">this</span> <span class="keyword">is</span> a debug message</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以发现，在调用 remove 方法之后，确实将历史 log 删除了。但实际上这并不是删除，只不过是将 sink 对象移除之后，在这之前的内容不会再输出到日志中。 这样我们就可以实现日志的刷新重新写入操作。</p>
                  <h3 id="rotation-配置"><a href="#rotation-配置" class="headerlink" title="rotation 配置"></a>rotation 配置</h3>
                  <p>用了 loguru 我们还可以非常方便地使用 rotation 配置，比如我们想一天输出一个日志文件，或者文件太大了自动分隔日志文件，我们可以直接使用 add 方法的 rotation 参数进行配置。 我们看看下面的例子：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">logger.<span class="builtin-name">add</span>(<span class="string">'runtime_&#123;time&#125;.log'</span>, <span class="attribute">rotation</span>=<span class="string">"500 MB"</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过这样的配置我们就可以实现每 500MB 存储一个文件，每个 log 文件过大就会新创建一个 log 文件。我们在配置 log 名字时加上了一个 time 占位符，这样在生成时可以自动将时间替换进去，生成一个文件名包含时间的 log 文件。 另外我们也可以使用 rotation 参数实现定时创建 log 文件，例如：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">logger.<span class="builtin-name">add</span>(<span class="string">'runtime_&#123;time&#125;.log'</span>, <span class="attribute">rotation</span>=<span class="string">'00:00'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就可以实现每天 0 点新创建一个 log 文件输出了。 另外我们也可以配置 log 文件的循环时间，比如每隔一周创建一个 log 文件，写法如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">logger.<span class="builtin-name">add</span>(<span class="string">'runtime_&#123;time&#125;.log'</span>, <span class="attribute">rotation</span>=<span class="string">'1 week'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们就可以实现一周创建一个 log 文件了。</p>
                  <h3 id="retention-配置"><a href="#retention-配置" class="headerlink" title="retention 配置"></a>retention 配置</h3>
                  <p>很多情况下，一些非常久远的 log 对我们来说并没有什么用处了，它白白占据了一些存储空间，不清除掉就会非常浪费。retention 这个参数可以配置日志的最长保留时间。 比如我们想要设置日志文件最长保留 10 天，可以这么来配置：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">logger.<span class="builtin-name">add</span>(<span class="string">'runtime.log'</span>, <span class="attribute">retention</span>=<span class="string">'10 days'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样 log 文件里面就会保留最新 10 天的 log，妈妈再也不用担心 log 沉积的问题啦。</p>
                  <h3 id="compression-配置"><a href="#compression-配置" class="headerlink" title="compression 配置"></a>compression 配置</h3>
                  <p>loguru 还可以配置文件的压缩格式，比如使用 zip 文件格式保存，示例如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">logger.<span class="builtin-name">add</span>(<span class="string">'runtime.log'</span>, <span class="attribute">compression</span>=<span class="string">'zip'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样可以更加节省存储空间。</p>
                  <h3 id="字符串格式化"><a href="#字符串格式化" class="headerlink" title="字符串格式化"></a>字符串格式化</h3>
                  <p>loguru 在输出 log 的时候还提供了非常友好的字符串格式化功能，像这样：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">logger.<span class="builtin-name">info</span>(<span class="string">'If you are using Python &#123;&#125;, prefer &#123;feature&#125; of course!'</span>, 3.6, <span class="attribute">feature</span>=<span class="string">'f-strings'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样在添加参数就非常方便了。</p>
                  <h3 id="Traceback-记录"><a href="#Traceback-记录" class="headerlink" title="Traceback 记录"></a>Traceback 记录</h3>
                  <p>在很多情况下，如果遇到运行错误，而我们在打印输出 log 的时候万一不小心没有配置好 Traceback 的输出，很有可能我们就没法追踪错误所在了。 但用了 loguru 之后，我们用它提供的装饰器就可以直接进行 Traceback 的记录，类似这样的配置即可：</p>
                  <figure class="highlight ruby">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">@logger.catch</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_function</span><span class="params">(x, y, z)</span></span><span class="symbol">:</span></span><br><span class="line">    <span class="comment"># An error? It's caught anyway!</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span> / (x + y + z)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们做个测试，我们在调用时三个参数都传入 0，直接引发除以 0 的错误，看看会出现什么情况：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">my_function(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行完毕之后，可以发现 log 里面就出现了 Traceback 信息，而且给我们输出了当时的变量值，真的是不能再赞了！结果如下：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="string">\&gt;</span> <span class="string">File</span> <span class="string">"run.py"</span><span class="string">,</span> <span class="string">line</span> <span class="number">15</span><span class="string">,</span> <span class="string">in</span> <span class="string">&lt;module&gt;</span></span><br><span class="line">    <span class="string">my_function(0,</span> <span class="number">0</span><span class="string">,</span> <span class="number">0</span><span class="string">)</span></span><br><span class="line">    <span class="string">└</span> <span class="string">&lt;function</span> <span class="string">my_function</span> <span class="string">at</span> <span class="number">0x1171dd510</span><span class="string">&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="string">File</span> <span class="string">"/private/var/py/logurutest/demo5.py"</span><span class="string">,</span> <span class="string">line</span> <span class="number">13</span><span class="string">,</span> <span class="string">in</span> <span class="string">my_function</span></span><br><span class="line">    <span class="string">return</span> <span class="number">1</span> <span class="string">/</span> <span class="string">(x</span> <span class="string">+</span> <span class="string">y</span> <span class="string">+</span> <span class="string">z)</span></span><br><span class="line">                <span class="string">│</span>   <span class="string">│</span>   <span class="string">└</span> <span class="number">0</span></span><br><span class="line">                <span class="string">│</span>   <span class="string">└</span> <span class="number">0</span></span><br><span class="line">                <span class="string">└</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="attr">ZeroDivisionError:</span> <span class="string">division</span> <span class="string">by</span> <span class="string">zero</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>因此，用 loguru 可以非常方便地实现日志追踪，debug 效率可能要高上十倍了？ 另外 loguru 还有很多很多强大的功能，这里就不再一一展开讲解了，更多的内容大家可以看看 loguru 的官方文档详细了解一下：<a href="https://loguru.readthedocs.io/en/stable/index.html" target="_blank" rel="noopener">https://loguru.readthedocs.io/en/stable/index.html</a>。 看完之后，是时候把自己的 logging 模块替换成 loguru 啦！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-10-17 10:52:49" itemprop="dateCreated datePublished" datetime="2019-10-17T10:52:49+08:00">2019-10-17</time>
                </span>
                <span id="/7776.html" class="post-meta-item leancloud_visitors" data-flag-title="Python 中更优雅的日志记录方案 loguru" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>8.5k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>8 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/7712.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> JavaScript <i class="label-arrow"></i>
                  </a>
                  <a href="/7712.html" class="post-title-link" itemprop="url">书籍《Python3 反爬虫原理与绕过实战》详细目录和最新消息</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>在夜幕读者群和算法反爬虫群的朋友都知道，我的新书《Python3 反爬虫原理与绕过实战》很快就要印刷出版了。 出版社的小姐姐们为本书设计了很多款封面 <img src="http://q0revehsm.bkt.clouddn.com/sfhfpc/20191118122456.png" alt=""></p>
                  <blockquote>
                    <p>但目前暂未选定封面</p>
                  </blockquote>
                  <p>之前我也有放出大章目录和配套代码，但详细目录和最新进展一直没机会公开。配套代码放在 <a href="https://github.com/asyncins/antispider" target="_blank" rel="noopener">GitHub 仓库</a>，大章目录也在。 <img src="http://q0revehsm.bkt.clouddn.com/sfhfpc/20191118122620.jpg" alt=""> 这次将详细目录呈现给大家。请大家先阅读《Python3 反爬虫原理与绕过实战》的内容提要</p>
                  <blockquote>
                    <p>本书描述了爬虫技术与反爬虫技术的对抗过程，并详细介绍了这其中的原理和具体实现方法。首先讲 解开发环境的配置、Web 网站的构成、页面渲染以及动态网页和静态网页对爬虫造成的影响。然后介绍了 不同类型的反爬虫原理、具体实现和绕过方法，另外还涉及常见验证码的实现过程，并使用深度学习技术 完成了验证。最后介绍了常见的编码和加密原理、JavaScript 代码混淆知识、前端禁止事件以及与爬虫相 关的法律知识和风险点。 本书既适合需要储备反爬虫知识的前端工程师和后端工程师，也适合需要储备绕过知识的爬虫工程师、 爬虫爱好者以及 Python 程序员。</p>
                  </blockquote>
                  <h1 id="作者是谁"><a href="#作者是谁" class="headerlink" title="作者是谁"></a>作者是谁</h1>
                  <p>这本书谁写的？靠不靠谱呢？ 这个靓仔就是我，韦世东。 <img src="http://q0revehsm.bkt.clouddn.com/sfhfpc/20191118122657.jpeg" alt=""> 作者韦世东是资深爬虫工程师，2019年华为云认证云享专家、掘金社区优秀作者、GitChat认证作者、搜狐产品技术约稿作者、夜幕团队成员。拥有七年互联网从业经验，擅长反爬虫的设计和绕过技巧。</p>
                  <h1 id="详细目录"><a href="#详细目录" class="headerlink" title="详细目录"></a>详细目录</h1>
                  <p>以下放出的章节目录为改版前的目录，大部分章和节都配套实战环节，实际上新版目录与这里的略有差异。 <img src="http://q0revehsm.bkt.clouddn.com/sfhfpc/20191118122853.jpg" alt=""> <img src="http://q0revehsm.bkt.clouddn.com/sfhfpc/20191118122912.jpg" alt=""> <img src="http://q0revehsm.bkt.clouddn.com/sfhfpc/20191118122926.jpg" alt=""> <img src="http://q0revehsm.bkt.clouddn.com/sfhfpc/20191118122946.jpg" alt=""></p>
                  <h1 id="什么时候可以买到？"><a href="#什么时候可以买到？" class="headerlink" title="什么时候可以买到？"></a>什么时候可以买到？</h1>
                  <p>审核、校对和排版工作早已进行，按照正常流程来说月底送印，双十一之前会在各大在线书城（如京东、当当等）跟大家见面。 同时也会开启直播送书、抽奖送书等活动。想要参与活动的朋友可以添加我好友，微信号：Domfreez。加好友进群以获得书籍和活动的最新消息。欢迎大家保持对《Python3 反爬虫原理与绕过实战》的关注，新书发布后会有很多活动回馈给大家!</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/韦世东学算法和反爬虫" class="author" itemprop="url" rel="index">韦世东学算法和反爬虫</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-10-10 17:57:43" itemprop="dateCreated datePublished" datetime="2019-10-10T17:57:43+08:00">2019-10-10</time>
                </span>
                <span id="/7712.html" class="post-meta-item leancloud_visitors" data-flag-title="书籍《Python3 反爬虫原理与绕过实战》详细目录和最新消息" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>796</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/7701.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 技术杂谈 <i class="label-arrow"></i>
                  </a>
                  <a href="/7701.html" class="post-title-link" itemprop="url">如何用 nativefier 将网页打包成客户端 App</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>大家有没有一种感觉，很多网站其实做得非常优秀，但是它们就是没有开发 PC （电脑）版的客户端，比如知乎、GitHub、微信公众号。 如果我们大多数时间都是使用 PC 开发或者办公的，每次开始时我们都需要打开浏览器输入它们的网址，进入对应的页面。另外一个浏览器中我们可能会开各种各样的选项卡，少则两三个，多则一二十个，这就导致某些我们常用的甚至重度依赖的网站在切换的时候就会不怎么方便。 比如挤在一堆浏览器里面的 GitHub，选项卡已经被挤得看不全了： <img src="https://cdn.cuiqingcai.com/2019-10-09-132628.png" alt="image-20191009212626789"> 这时候，如果我们能有一个客户端，即 Window 上的 exe 程序或 Mac 上的 app 应用程序，它们的名字就叫做 GitHub、微信公众平台等等，打开之后只单独负责呈现 GitHub、微信公众号的内容，我们就可以免去在浏览器中来回寻找站点和切换站点的麻烦。 甚至说，在 Windows 上我们可以直接把这个应用放在桌面或把它 Pin 到任务栏上， Mac 上我们可以直接将它固定到 Dock 栏上，这样一键就打开了，省时省力。如果使用了快捷启动软件，比如 Wox （Windows）或 Alfred（Mac），直接输入 GitHub 或者微信公众平台，那就更方便唤出了，简直不要太方便。 而且，我个人感觉，用客户端软件比用网页更有一种「踏实感」，不知道大家会不会也有这种感觉。 所以，如果能将这些常用的或者重度依赖的网站转成客户端软件，那就再方便不过了。 比如我用的是 Mac，把 GitHub 转成客户端软件之后，我习惯性用 Alfred 呼出： <img src="https://cdn.cuiqingcai.com/2019-10-09-134000.png" alt="image-20191009213959316"> 然后就打开了一个 GitHub.app： <img src="https://cdn.cuiqingcai.com/2019-10-09-134127.png" alt="image-20191009214125953"> 然后把它固定到 Dock 栏上： <img src="https://cdn.cuiqingcai.com/2019-10-09-134257.png" alt="image-20191009214254670"> 就仿佛拥有了一个 GitHub 的客户端，功能与网页一模一样，再也不用在浏览器里面切来切去。而且也不用担心版本更新的问题，因为它就是开了一个独立的网页，网页改版或者更新，内容就随着更新。 是不是很方便呢？ 如果你觉得是，那就随着我来了解一下怎样实现吧。</p>
                  <h2 id="nativefier"><a href="#nativefier" class="headerlink" title="nativefier"></a>nativefier</h2>
                  <p>这里需要用到的一个工具，名字叫做 nativefier，是基于 electron 开发的，它的功能就是把任意的网页转成一个电脑客户端，即 Desktop Application， 有了这个软件，把网页转成电脑客户端只需要这么一条简单的命令：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">nativefier <span class="tag">&lt;<span class="name">website</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>比如把 Whatsapp 的网站打包成一个客户端就只需要执行这样的命令：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">nativefier</span> <span class="selector-tag">web</span><span class="selector-class">.whatsapp</span><span class="selector-class">.com</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>示意如下： <img src="https://cdn.cuiqingcai.com/2019-10-09-135019.gif" alt="Walkthrough"> 怎样，不论是什么网页，就可以使用它来转换成一个客户端软件。 另外它支持三大操作系统，Windows、Linux、Mac，即用它可以将网页转成 <code>.exe</code>、<code>.app</code> 等格式。</p>
                  <h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2>
                  <p>那么这软件究竟具体怎么来使用呢，第一步当然就是安装了。 由于 nativefier 是基于 electron 开发的，而后者又是基于 Node.js 的，所以要使用它必须要安装 Node.js，建议安装 6.0 以上版本。 另外在 Linux 和 Mac 平台可能需要安装其他的依赖。</p>
                  <ul>
                    <li>在 Linux 上需要安装 Wine 并配置好环境变量。</li>
                    <li>在 Mac 上需要安装 iconutil、imagemagick，这两个依赖是为了帮助程序处理 App 的 icon 的。</li>
                  </ul>
                  <p>具体的安装说明可以参见：<a href="https://github.com/jiahaog/nativefier#optional-dependencies" target="_blank" rel="noopener">https://github.com/jiahaog/nativefier#optional-dependencies</a>。 以上步骤完成之后，使用 npm 安装 nativefier 即可：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">npm <span class="keyword">install</span> nativefier -g</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>安装完毕之后便可以使用 nativefier 命令了。</p>
                  <h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2>
                  <p>下面我在 Mac 下以 GitHub 为例来介绍下怎样将 GitHub 打包成一个客户端软件。 像刚才介绍的一样，最简单直接的，运行下面的命令就好了：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">nativefier <span class="string">https:</span><span class="comment">//github.com</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>它会尝试用 GitHub 主页的 title 来命名这个客户端，而 GitHub 的 title 比较长，叫做：</p>
                  <figure class="highlight delphi">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">The worlds leading software development <span class="keyword">platform</span>  GitHub</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>所以它会生成这样的一个客户端软件： <img src="https://cdn.cuiqingcai.com/2019-10-09-140452.png" alt="image-20191009220450996"> 这个名字有点奇怪，我们可以使用命令的一个选项即可控制生成的客户端的名称，添加一个 name 参数即可：</p>
                  <figure class="highlight delphi">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">nativefier --<span class="keyword">name</span> GitHub https:<span class="comment">//github.com</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样便会生成一个名为 GitHub 的客户端： <img src="https://cdn.cuiqingcai.com/2019-10-09-140719.png" alt="image-20191009220717549"> 另外我们可以看到客户端的图标也自动生成了，这个图标怎么来的呢？这个是用的 nativefier 维护的 icons，恰好 GitHub 在它们的收录范围内，所以就用上了。这些 icons 也是一个公开的 Repository，链接为： <a href="https://github.com/jiahaog/nativefier-icons，大家可以到这里搜集或者贡献图标" target="_blank" rel="noopener">https://github.com/jiahaog/nativefier-icons，大家可以到这里搜集或者贡献图标</a>。 如果我们觉得 nativefier 官方提供的图标不好看，想要自定义图标的话，也是可以的，只需要添加一个 icon 参数即可，这样便可以指定本地图片作为图标来生成了。 但值得注意的是，不同平台上要求的图标格式不一样。</p>
                  <ul>
                    <li>Windows 上需要 ico 格式。</li>
                    <li>Linux 上需要 png 格式。</li>
                    <li>Mac 上需要 icns 格式，如果安装了上文所需要的依赖，使用 png 格式也是可以的。</li>
                  </ul>
                  <p>具体的参数用法说明可以看：<a href="https://github.com/jiahaog/nativefier/blob/master/docs/api.md#icon" target="_blank" rel="noopener">https://github.com/jiahaog/nativefier/blob/master/docs/api.md#icon</a>。 好，那么在 Mac 上我安装了依赖，那就直接用 png 格式的图标了。 在这里我自己做了一个圆形的图标如下，命名为 github.png： <img src="https://cdn.cuiqingcai.com/2019-10-09-143323.png" alt="2019-10-09-141852"> 然后把图片使用下面的命令就可以自定义图标了：</p>
                  <figure class="highlight jboss-cli">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">nativefier <span class="params">--name</span> GitHub <span class="params">--icon</span> <span class="string">./github.png</span> https:<span class="string">//github.com</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就能生成自定义图标的客户端软件了。 打开之后，登录，我们就拥有了一个 GitHub 客户端了，界面和网页一模一样，但是已经摆脱了混杂选项卡的干扰，示意如下： <img src="https://cdn.cuiqingcai.com/2019-10-09-143009.png" alt="image-20191009223006991"> 好了，这就是基本的用法，其实大部分情况只需要这几个参数就够了，如果想了解功能大家可以参考官方的 API 文档：<a href="https://github.com/jiahaog/nativefier/blob/master/docs/api.md#api" target="_blank" rel="noopener">https://github.com/jiahaog/nativefier/blob/master/docs/api.md#api</a>。 如果想要生成其他的客户端，如微信公众平台、知乎等等都是可以的。 如微信公众平台就是这样的： <img src="https://cdn.cuiqingcai.com/2019-10-09-142258.png" alt="image-20191009222257275"></p>
                  <h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2>
                  <p>在使用过程中我发现 name 参数对中文的支持并不好，总会生成一个 APP 的客户端，在这里推荐 name 使用英文名称，比如知乎用 Zhihu，微信平台用 WXMP 等等。 例如命令：</p>
                  <figure class="highlight jboss-cli">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">nativefier <span class="params">--name</span> 知乎 <span class="params">--icon</span> <span class="string">./zhihu.png</span> https:<span class="string">//www.zhihu.com</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以用下面的命令代替：</p>
                  <figure class="highlight jboss-cli">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">nativefier <span class="params">--name</span> Zhihu <span class="params">--icon</span> <span class="string">./zhihu.png</span> https:<span class="string">//www.zhihu.com</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>生成客户端软件知乎再手动修改下图标的名称即可。 另外生成的客户端软件是不支持插件的，如果你的站点对某些插件的依赖比较强，那就不建议使用 nativefier 转成的客户端了。 好了，这就是 nativefier 的基本用法，有了它我们就可以随意地将网页转成客户端软件了，快来试试吧！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-10-10 10:02:13" itemprop="dateCreated datePublished" datetime="2019-10-10T10:02:13+08:00">2019-10-10</time>
                </span>
                <span id="/7701.html" class="post-meta-item leancloud_visitors" data-flag-title="如何用 nativefier 将网页打包成客户端 App" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.9k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/7625.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 技术杂谈 <i class="label-arrow"></i>
                  </a>
                  <a href="/7625.html" class="post-title-link" itemprop="url">利用 GitHub + Hexo + Next 从零搭建一个博客</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>趁着周末，搭建了一下 NightTeam 的官方博客和官方主页，耗时数个小时，两个站点终于完工了。 由于 NightTeam 的域名是 nightteam.cn，所以这里官方博客使用了二级域名 blog.nightteam.cn，官方主页使用了根域名 nightteam.cn，现在两个站点都已经稳定运行在 GitHub Pages 上面了，大家如果感兴趣可以去看一下。</p>
                  <ul>
                    <li>NightTeam HomePage：<a href="https://nightteam.cn/" target="_blank" rel="noopener">https://nightteam.cn/</a></li>
                    <li>NightTeam Blog: <a href="https://blog.nightteam.cn/" target="_blank" rel="noopener">https://blog.nightteam.cn/</a></li>
                  </ul>
                  <p>这里的主页就是用一个基本的静态页面搭建了，没有什么技术含量。博客相对复杂一点，使用了 Hexo 框架，采用了 Next 主题，在搭建的过程中我就顺手把搭建的流程大致记录下来了，在这里扩充一下形成一篇记录，毕竟好记性不如烂笔头。 <img src="https://cdn.cuiqingcai.com/2019-09-26-114318.png" alt=""> <img src="https://cdn.cuiqingcai.com/2019-09-26-114346.png" alt=""> 于是，这篇《利用 GitHub 从零开始搭建一个博客》的文章就诞生了。</p>
                  <h2 id="准备条件"><a href="#准备条件" class="headerlink" title="准备条件"></a>准备条件</h2>
                  <p>在这里先跟大家说一些准备条件，有些同学可能一听到搭建博客就望而却步。弄个博客网站，不得有台服务器吗？不得搞数据库吗？不得注册域名吗？没事，如果都没有，那照样是能搭建一个博客的。 GitHub 是个好东西啊，它提供了 GitHub Pages 帮助我们来架设一个静态网站，这就解决了服务器的问题。 Hexo 这个博客框架没有那么重量级，它是 MarkDown 直接写文章的，然后 Hexo 可以直接将文章编译成静态网页文件并发布，所以这样文章的内容、标题、标签等信息就没必要存数据库里面了，是直接纯静态页面了，这就解决了数据库的问题。 GitHub Pages 允许每个账户创建一个名为 {username}.github.io 的仓库，另外它还会自动为这个仓库分配一个 github.io 的二级域名，这就解决了域名的问题，当然如果想要自定义域名的话，也可以支持。 所以说，基本上，先注册个 GitHub 账号就能搞了，下面我们来正式开始吧。</p>
                  <h2 id="新建项目"><a href="#新建项目" class="headerlink" title="新建项目"></a>新建项目</h2>
                  <p>首先在 GitHub 新建一个仓库（Repository），名称为 {username}.github.io，注意这个名比较特殊，必须要是 github.io 为后缀结尾的。比如 NightTeam 的 GitHub 用户名就叫 NightTeam，那我就新建一个 nightteam.github.io，新建完成之后就可以进行后续操作了。 另外如果 GitHub 没有配置 SSH 连接的建议配置一下，这样后面在部署博客的时候会更方便。</p>
                  <h2 id="安装环境"><a href="#安装环境" class="headerlink" title="安装环境"></a>安装环境</h2>
                  <h3 id="安装-Node-js"><a href="#安装-Node-js" class="headerlink" title="安装 Node.js"></a>安装 Node.js</h3>
                  <p>首先在自己的电脑上安装 Node.js，下载地址：<a href="https://nodejs.org/zh-cn/download/" target="_blank" rel="noopener">https://nodejs.org/zh-cn/download/</a>，可以安装 Stable 版本。 安装完毕之后，确保环境变量配置好，能正常使用 <code>npm</code> 命令。</p>
                  <h3 id="安装-Hexo"><a href="#安装-Hexo" class="headerlink" title="安装 Hexo"></a>安装 Hexo</h3>
                  <p>接下来就需要安装 Hexo 了，这是一个博客框架，Hexo 官方还提供了一个命令行工具，用于快速创建项目、页面、编译、部署 Hexo 博客，所以在这之前我们需要先安装 Hexo 的命令行工具。 命令如下：</p>
                  <figure class="highlight avrasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">npm install -g hexo-<span class="keyword">cli</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>安装完毕之后，确保环境变量配置好，能正常使用 <code>hexo</code> 命令。</p>
                  <h2 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h2>
                  <p>接下来我们使用 Hexo 的命令行创建一个项目，并将其在本地跑起来，整体跑通看看。 首先使用如下命令创建项目：</p>
                  <figure class="highlight applescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">hexo init &#123;<span class="built_in">name</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里的 name 就是项目名，我这里要创建 NightTeam 的博客，我就把项目取名为 nightteam 了，用了纯小写，命令如下：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">hexo init nightteam</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样 nightteam 文件夹下就会出现 Hexo 的初始化文件，包括 themes、scaffolds、source 等文件夹，这些内容暂且先不用管是做什么的，我们先知道有什么，然后一步步走下去看看都发生了什么变化。 接下来我们首先进入新生成的文件夹里面，然后调用 Hexo 的 generate 命令，将 Hexo 编译生成 HTML 代码，命令如下：</p>
                  <figure class="highlight verilog">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">hexo <span class="keyword">generate</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到输出结果里面包含了 js、css、font 等内容，并发现他们都处在了项目根目录下的 public 文件夹下面了。 然后我们利用 Hexo 提供的 server 命令把博客在本地运行起来，命令如下：</p>
                  <figure class="highlight axapta">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">hexo <span class="keyword">server</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行之后命令行输出如下：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">INFO</span>  <span class="keyword">Start</span> processing</span><br><span class="line"><span class="keyword">INFO</span>  Hexo <span class="keyword">is</span> running at http://localhost:<span class="number">4000</span> . Press Ctrl+C <span class="keyword">to</span> stop.</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>它告诉我们在本地 4000 端口上就可以查看博客站点了，如图所示： <img src="https://cdn.cuiqingcai.com/2019-09-20-064939.png" alt=""> 这样一个博客的架子就出来了，我们只用了三个命令就完成了。</p>
                  <h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2>
                  <p>接下来我们来将这个初始化的博客进行一下部署，放到 GitHub Pages 上面验证一下其可用性。成功之后我们可以再进行后续的修改，比如修改主题、修改页面配置等等。 那么怎么把这个页面部署到 GitHub Pages 上面呢，其实 Hexo 已经给我们提供一个命令，利用它我们可以直接将博客一键部署，不需要手动去配置服务器或进行其他的各项配置。 部署命令如下：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">hexo deploy</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在部署之前，我们需要先知道博客的部署地址，它需要对应 GitHub 的一个 Repository 的地址，这个信息需要我们来配置一下。 打开根目录下的 _config.yml 文件，找到 Deployment 这个地方，把刚才新建的 Repository 的地址贴过来，然后指定分支为 master 分支，最终修改为如下内容：</p>
                  <figure class="highlight dts">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta"># Deployment</span></span><br><span class="line"><span class="meta">## Docs: https:<span class="comment">//hexo.io/docs/deployment.html</span></span></span><br><span class="line"><span class="symbol">deploy:</span></span><br><span class="line"><span class="symbol">  type:</span> git</span><br><span class="line"><span class="symbol">  repo:</span> &#123;git repo ssh address&#125;</span><br><span class="line"><span class="symbol">  branch:</span> master</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我的就修改为如下内容：</p>
                  <figure class="highlight dts">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta"># Deployment</span></span><br><span class="line"><span class="meta">## Docs: https:<span class="comment">//hexo.io/docs/deployment.html</span></span></span><br><span class="line"><span class="symbol">deploy:</span></span><br><span class="line"><span class="symbol">  type:</span> git</span><br><span class="line"><span class="symbol">  repo:</span> git@github.com:NightTeam/nightteam.github.io.git</span><br><span class="line"><span class="symbol">  branch:</span> master</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外我们还需要额外安装一个支持 Git 的部署插件，名字叫做 hexo-deployer-git，有了它我们才可以顺利将其部署到 GitHub 上面，如果不安装的话，在执行部署命令时会报如下错误：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Deployer not <span class="string">found:</span> git</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好，那就让我们安装下这个插件，在项目目录下执行安装命令如下：</p>
                  <figure class="highlight sql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">npm <span class="keyword">install</span> hexo-deployer-git <span class="comment">--save</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>安装成功之后，执行部署命令：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">hexo deploy</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果类似如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">INFO  Deploying: git</span><br><span class="line">INFO  Clearing .deploy_git folder...</span><br><span class="line">INFO  Copying files <span class="keyword">from</span> <span class="keyword">public</span> folder...</span><br><span class="line">INFO  Copying files <span class="keyword">from</span> extend dirs...</span><br><span class="line">On branch master</span><br><span class="line">nothing to commit, working directory clean</span><br><span class="line">Counting objects: <span class="number">46</span>, done.</span><br><span class="line">Delta compression using up to <span class="number">8</span> threads.</span><br><span class="line">Compressing objects: <span class="number">100</span>% (<span class="number">36</span>/<span class="number">36</span>), done.</span><br><span class="line">Writing objects: <span class="number">100</span>% (<span class="number">46</span>/<span class="number">46</span>), <span class="number">507.66</span> KiB | <span class="number">0</span> bytes/s, done.</span><br><span class="line">Total <span class="number">46</span> (delta <span class="number">3</span>), reused <span class="number">0</span> (delta <span class="number">0</span>)</span><br><span class="line">remote: Resolving deltas: <span class="number">100</span>% (<span class="number">3</span>/<span class="number">3</span>), done.</span><br><span class="line">To <span class="symbol">git@</span>github.com:NightTeam/nightteam.github.io.git</span><br><span class="line"> * [new branch]      HEAD -&gt; master</span><br><span class="line">Branch master <span class="keyword">set</span> up to track remote branch master <span class="keyword">from</span> <span class="symbol">git@</span>github.com:NightTeam/nightteam.github.io.git.</span><br><span class="line">INFO  Deploy done: git</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果出现类似上面的内容，就证明我们的博客已经成功部署到 GitHub Pages 上面了，这时候我们访问一下 GitHub Repository 同名的链接，比如我的 NightTeam 博客的 Repository 名称取的是 nightteam.github.io，那我就访问 <a href="http://nightteam.github.io" target="_blank" rel="noopener">http://nightteam.github.io</a>，这时候我们就可以看到跟本地一模一样的博客内容了。 <img src="https://cdn.cuiqingcai.com/2019-09-20-062934.png" alt=""> 这时候我们去 GitHub 上面看看 Hexo 上传了什么内容，打开之后可以看到 master 分支有了这样的内容： <img src="https://cdn.cuiqingcai.com/2019-09-26-112229.png" alt=""> 仔细看看，这实际上是博客文件夹下面的 public 文件夹下的所有内容，Hexo 把编译之后的静态页面内容上传到 GitHub 的 master 分支上面去了。 这时候可能就有人有疑问了，那我博客的源码也想放到 GitHub 上面怎么办呢？其实很简单，新建一个其他的分支就好了，比如我这边就新建了一个 source 分支，代表博客源码的意思。 具体的添加过程就很简单了，参加如下命令：</p>
                  <figure class="highlight properties">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">git</span> <span class="string">init</span></span><br><span class="line"><span class="attr">git</span> <span class="string">checkout -b source</span></span><br><span class="line"><span class="attr">git</span> <span class="string">add -A</span></span><br><span class="line"><span class="attr">git</span> <span class="string">commit -m "init blog"</span></span><br><span class="line"><span class="attr">git</span> <span class="string">remote add origin git@github.com:&#123;username&#125;/&#123;username&#125;.github.io.git</span></span><br><span class="line"><span class="attr">git</span> <span class="string">push origin source</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>成功之后，可以到 GitHub 上再切换下默认分支，比如我就把默认的分支设置为了 source，当然不换也可以。</p>
                  <h2 id="配置站点信息"><a href="#配置站点信息" class="headerlink" title="配置站点信息"></a>配置站点信息</h2>
                  <p>完成如上内容之后，实际上我们只完成了博客搭建的一小步，因为我们仅仅是把初始化的页面部署成功了，博客里面还没有设置任何有效的信息。下面就让我们来进行一下博客的基本配置，另外换一个好看的主题，配置一些其他的内容，让博客真正变成属于我们自己的博客吧。 下面我就以自己的站点 NightTeam 为例，修改一些基本的配置，比如站点名、站点描述等等。 修改根目录下的 _config.yml 文件，找到 Site 区域，这里面可以配置站点标题 title、副标题 subtitle 等内容、关键字 keywords 等内容，比如我的就修改为如下内容：</p>
                  <figure class="highlight avrasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta"># Site</span></span><br><span class="line"><span class="symbol">title:</span> NightTeam</span><br><span class="line"><span class="symbol">subtitle:</span> 一个专注技术的组织</span><br><span class="line"><span class="symbol">description:</span> 涉猎的主要编程语言为 Python、Rust、C++、Go，领域涵盖爬虫、深度学习、服务研发和对象存储等。</span><br><span class="line"><span class="symbol">keywords:</span> <span class="string">"Python, Rust, C++, Go, 爬虫, 深度学习, 服务研发, 对象存储"</span></span><br><span class="line"><span class="symbol">author:</span> NightTeam</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里大家可以参照格式把内容改成自己的。 另外还可以设置一下语言，如果要设置为汉语的话可以将 language 的字段设置为 zh-CN，修改如下：</p>
                  <figure class="highlight avrasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">language:</span> <span class="built_in">zh</span>-CN</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就完成了站点基本信息的配置，完成之后可以看到一些基本信息就修改过来了，页面效果如下： <img src="https://cdn.cuiqingcai.com/2019-09-26-032710.png" alt=""></p>
                  <h2 id="修改主题"><a href="#修改主题" class="headerlink" title="修改主题"></a>修改主题</h2>
                  <p>目前来看，整个页面的样式个人感觉并不是那么好看，想换一个风格，这就涉及到主题的配置了。目前 Hexo 里面应用最多的主题基本就是 Next 主题了，个人感觉这个主题还是挺好看的，另外它支持的插件和功能也极为丰富，配置了这个主题，我们的博客可以支持更多的扩展功能，比如阅览进度条、中英文空格排版、图片懒加载等等。 那么首先就让我们来安装下 Next 这个主题吧，目前 Next 主题已经更新到 7.x 版本了，我们可以直接到 Next 主题的 GitHub Repository 上把这个主题下载下来。 主题的 GitHub 地址是：<a href="https://github.com/theme-next/hexo-theme-next，我们可以直接把" target="_blank" rel="noopener">https://github.com/theme-next/hexo-theme-next，我们可以直接把</a> master 分支 Clone 下来。 首先命令行进入到项目的根目录，执行如下命令即可：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">git clone http<span class="variable">s:</span>//github.<span class="keyword">com</span>/theme-<span class="keyword">next</span>/hexo-theme-<span class="keyword">next</span> themes/<span class="keyword">next</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>执行完毕之后 Next 主题的源码就会出现在项目的 themes/next 文件夹下。 然后我们需要修改下博客所用的主题名称，修改项目根目录下的 _config.yml 文件，找到 theme 字段，修改为 next 即可，修改如下：</p>
                  <figure class="highlight autoit">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">theme: <span class="keyword">next</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后本地重新开启服务，访问刷新下页面，就可以看到 next 主题就切换成功了，预览效果如下： <img src="https://cdn.cuiqingcai.com/2019-09-26-034504.png" alt=""></p>
                  <h2 id="主题配置"><a href="#主题配置" class="headerlink" title="主题配置"></a>主题配置</h2>
                  <p>现在我们已经成功切换到 next 主题上面了，接下来我们就对主题进行进一步地详细配置吧，比如修改样式、增加其他各项功能的支持，下面逐项道来。 Next 主题内部也提供了一个配置文件，名字同样叫做 _config.yml，只不过位置不一样，它在 themes/next 文件夹下，Next 主题里面所有的功能都可以通过这个配置文件来控制，下文所述的内容都是修改的 themes/next/_config.yml 文件。</p>
                  <h3 id="样式"><a href="#样式" class="headerlink" title="样式"></a>样式</h3>
                  <p>Next 主题还提供了多种样式，风格都是类似黑白的搭配，但整个布局位置不太一样，通过修改配置文件的 scheme 字段即可，我选了 Pisces 样式，修改 _config.yml （注意是 themes/next/_config.yml 文件）如下：</p>
                  <figure class="highlight avrasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">scheme:</span> Pisces</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>刷新页面之后就会变成这种样式，如图所示： <img src="https://cdn.cuiqingcai.com/2019-09-26-034750.png" alt=""> 另外还有几个可选项，比如：</p>
                  <figure class="highlight vala">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta"># scheme: Muse</span></span><br><span class="line"><span class="meta">#scheme: Mist</span></span><br><span class="line">scheme: Pisces</span><br><span class="line"><span class="meta">#scheme: Gemini</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>大家可以自行根据喜好选择。</p>
                  <h3 id="favicon"><a href="#favicon" class="headerlink" title="favicon"></a>favicon</h3>
                  <p>favicon 就是站点标签栏的小图标，默认是用的 Hexo 的小图标，如果我们有站点 Logo 的图片的话，我们可以自己定制小图标。 但这并不意味着我们需要自己用 PS 自己来设计，已经有一个网站可以直接将图片转化为站点小图标，站点链接为：<a href="https://realfavicongenerator.net" target="_blank" rel="noopener">https://realfavicongenerator.net</a>，到这里上传一张图，便可以直接打包下载各种尺寸和适配不同设备的小图标。 图标下载下来之后把它放在 themes/next/source/images 目录下面。 然后在配置文件里面找到 favicon 配置项，把一些相关路径配置进去即可，示例如下：</p>
                  <figure class="highlight dts">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">favicon:</span></span><br><span class="line"><span class="symbol">  small:</span> <span class="meta-keyword">/images/</span>favicon<span class="number">-16</span>x16.png</span><br><span class="line"><span class="symbol">  medium:</span> <span class="meta-keyword">/images/</span>favicon<span class="number">-32</span>x32.png</span><br><span class="line"><span class="symbol">  apple_touch_icon:</span> <span class="meta-keyword">/images/</span>apple-touch-icon.png</span><br><span class="line"><span class="symbol">  safari_pinned_tab:</span> <span class="meta-keyword">/images/</span>safari-pinned-tab.svg</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>配置完成之后刷新页面，整个页面的标签图标就被更新了。</p>
                  <h3 id="avatar"><a href="#avatar" class="headerlink" title="avatar"></a>avatar</h3>
                  <p>avatar 这个就类似站点的头像，如果设置了这个，会在站点的作者信息旁边额外显示一个头像，比如我这边有一张 avatar.png 图片： <img src="https://cdn.cuiqingcai.com/2019-09-26-035351.png" alt=""> 将其放置到 themes/next/source/images/avatar.png 路径，然后在主题 _config.yml 文件下编辑 avatar 的配置，修改为正确的路径即可。</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># Sidebar Avatar</span></span><br><span class="line"><span class="attr">avatar:</span></span><br><span class="line">  <span class="comment"># In theme directory (source/images): /images/avatar.gif</span></span><br><span class="line">  <span class="comment"># In site directory (source/uploads): /uploads/avatar.gif</span></span><br><span class="line">  <span class="comment"># You can also use other linking images.</span></span><br><span class="line">  <span class="attr">url:</span> <span class="string">/images/avatar.png</span></span><br><span class="line">  <span class="comment"># If true, the avatar would be dispalyed in circle.</span></span><br><span class="line">  <span class="attr">rounded:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># If true, the avatar would be rotated with the cursor.</span></span><br><span class="line">  <span class="attr">rotated:</span> <span class="literal">true</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里有 rounded 选项是是否显示圆形，rotated 是是否带有旋转效果，大家可以根据喜好选择是否开启。 效果如下： <img src="https://cdn.cuiqingcai.com/2019-09-26-035817.png" alt=""> 配置完成之后就会显示头像。</p>
                  <h3 id="rss"><a href="#rss" class="headerlink" title="rss"></a>rss</h3>
                  <p>博客一般是需要 RSS 订阅的，如果要开启 RSS 订阅，这里需要安装一个插件，叫做 hexo-generator-feed，安装完成之后，站点会自动生成 RSS Feed 文件，安装命令如下：</p>
                  <figure class="highlight sql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">npm <span class="keyword">install</span> hexo-generator-feed <span class="comment">--save</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在项目根目录下运行这个命令，安装完成之后不需要其他的配置，以后每次编译生成站点的时候就会自动生成 RSS Feed 文件了。</p>
                  <h3 id="code"><a href="#code" class="headerlink" title="code"></a>code</h3>
                  <p>作为程序猿，代码块的显示还是需要很讲究的，默认的代码块我个人不是特别喜欢，因此我把代码的颜色修改为黑色，并把复制按钮的样式修改为类似 Mac 的样式，修改 _config.yml 文件的 codeblock 区块如下：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">codeblock:</span></span><br><span class="line">  <span class="comment"># Code Highlight theme</span></span><br><span class="line">  <span class="comment"># Available values: normal | night | night eighties | night blue | night bright</span></span><br><span class="line">  <span class="comment"># See: https://github.com/chriskempson/tomorrow-theme</span></span><br><span class="line">  <span class="attr">highlight_theme:</span> <span class="string">night</span> <span class="string">bright</span></span><br><span class="line">  <span class="comment"># Add copy button on codeblock</span></span><br><span class="line">  <span class="attr">copy_button:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># Show text copy result.</span></span><br><span class="line">    <span class="attr">show_result:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># Available values: default | flat | mac</span></span><br><span class="line">    <span class="attr">style:</span> <span class="string">mac</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>修改前的代码样式： <img src="https://cdn.cuiqingcai.com/2019-09-26-040437.png" alt=""> 修改后的代码样式： <img src="https://cdn.cuiqingcai.com/2019-09-26-040510.png" alt=""> 嗯，个人觉得整体看起来逼格高了不少。</p>
                  <h3 id="top"><a href="#top" class="headerlink" title="top"></a>top</h3>
                  <p>我们在浏览网页的时候，如果已经看完了想快速返回到网站的上端，一般都是有一个按钮来辅助的，这里也支持它的配置，修改 _config.yml 的 back2top 字段即可，我的设置如下：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">back2top:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># Back to top in sidebar.</span></span><br><span class="line">  <span class="attr">sidebar:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># Scroll percent label in b2t button.</span></span><br><span class="line">  <span class="attr">scrollpercent:</span> <span class="literal">true</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>enable 默认为 true，即默认显示。sidebar 如果设置为 true，按钮会出现在侧栏下方，个人觉得并不是很好看，就取消了，scrollpercent 就是显示阅读百分比，个人觉得还不错，就将其设置为 true。 具体的效果大家可以设置后根据喜好选择。</p>
                  <h3 id="reading-process"><a href="#reading-process" class="headerlink" title="reading_process"></a>reading_process</h3>
                  <p>reading_process，阅读进度。大家可能注意到有些站点的最上侧会出现一个细细的进度条，代表页面加载进度和阅读进度，如果大家想设置的话也可以试试，我将其打开了，修改 _config.yml 如下：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">reading_progress:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># Available values: top | bottom</span></span><br><span class="line">  <span class="attr">position:</span> <span class="string">top</span></span><br><span class="line">  <span class="attr">color:</span> <span class="string">"#222"</span></span><br><span class="line">  <span class="attr">height:</span> <span class="string">2px</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>设置之后显示效果如下： <img src="https://cdn.cuiqingcai.com/2019-09-26-041228.png" alt=""></p>
                  <h3 id="bookmark"><a href="#bookmark" class="headerlink" title="bookmark"></a>bookmark</h3>
                  <p>书签，可以根据阅读历史记录，在下次打开页面的时候快速帮助我们定位到上次的位置，大家可以根据喜好开启和关闭，我的配置如下：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">bookmark:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># Customize the color of the bookmark.</span></span><br><span class="line">  <span class="attr">color:</span> <span class="string">"#222"</span></span><br><span class="line">  <span class="comment"># If auto, save the reading progress when closing the page or clicking the bookmark-icon.</span></span><br><span class="line">  <span class="comment"># If manual, only save it by clicking the bookmark-icon.</span></span><br><span class="line">  <span class="attr">save:</span> <span class="string">auto</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="github-banner"><a href="#github-banner" class="headerlink" title="github_banner"></a>github_banner</h3>
                  <p>在一些技术博客上，大家可能注意到在页面的右上角有个 GitHub 图标，点击之后可以跳转到其源码页面，可以为 GitHub Repository 引流，大家如果想显示的话可以自行选择打开，我的配置如下：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># `Follow me on GitHub` banner in the top-right corner.</span></span><br><span class="line"><span class="attr">github_banner:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">permalink:</span> <span class="string">https://github.com/NightTeam/nightteam.github.io</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">NightTeam</span> <span class="string">GitHub</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>记得修改下链接 permalink 和标题 title，显示效果如下： <img src="https://cdn.cuiqingcai.com/2019-09-26-041726.png" alt=""> 可以看到在页面右上角显示了 GitHub 的图标，点击可以进去到 Repository 页面。</p>
                  <h3 id="gitalk"><a href="#gitalk" class="headerlink" title="gitalk"></a>gitalk</h3>
                  <p>由于 Hexo 的博客是静态博客，而且也没有连接数据库的功能，所以它的评论功能是不能自行集成的，但可以集成第三方的服务。 Next 主题里面提供了多种评论插件的集成，有 changyan | disqus | disqusjs | facebook_comments_plugin | gitalk | livere | valine | vkontakte 这些。 作为一名程序员，我个人比较喜欢 gitalk，它是利用 GitHub 的 Issue 来当评论，样式也比较不错。 首先需要在 GitHub 上面注册一个 OAuth Application，链接为：<a href="https://github.com/settings/applications/new，注册完毕之后拿到" target="_blank" rel="noopener">https://github.com/settings/applications/new，注册完毕之后拿到</a> Client ID、Client Secret 就可以了。 首先需要在 _config.yml 文件的 comments 区域配置使用 gitalk：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># Multiple Comment System Support</span></span><br><span class="line">comments:</span><br><span class="line">  # Available values: tabs | buttons</span><br><span class="line">  style: tabs</span><br><span class="line">  # Choose a comment<span class="built_in"> system </span><span class="keyword">to</span> be displayed by default.</span><br><span class="line">  # Available values: changyan | disqus | disqusjs | facebook_comments_plugin | gitalk | livere | valine | vkontakte</span><br><span class="line">  active: gitalk</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>主要是 comments.active 字段选择对应的名称即可。 然后找打 gitalk 配置，添加它的各项配置：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># Gitalk</span></span><br><span class="line"><span class="comment"># Demo: https://gitalk.github.io</span></span><br><span class="line"><span class="comment"># For more information: https://github.com/gitalk/gitalk</span></span><br><span class="line">gitalk:</span><br><span class="line">  enable: <span class="literal">true</span></span><br><span class="line">  github_id: NightTeam</span><br><span class="line">  repo: nightteam.github.io # Repository name <span class="keyword">to</span> store issues</span><br><span class="line">  client_id: &#123;your<span class="built_in"> client </span>id&#125; # GitHub Application<span class="built_in"> Client </span>ID</span><br><span class="line">  client_secret: &#123;your<span class="built_in"> client </span>secret&#125; # GitHub Application<span class="built_in"> Client </span>Secret</span><br><span class="line">  admin_user: germey # GitHub repo owner <span class="keyword">and</span> collaborators, only these guys can initialize gitHub issues</span><br><span class="line">  distraction_free_mode: <span class="literal">true</span> # Facebook-like distraction free mode</span><br><span class="line">  # Gitalk<span class="string">'s display language depends on user'</span>s browser <span class="keyword">or</span><span class="built_in"> system </span>environment</span><br><span class="line">  # <span class="keyword">If</span> you want everyone visiting your site <span class="keyword">to</span> see a uniform language, you can <span class="builtin-name">set</span> a force language value</span><br><span class="line">  # Available values: en | es-ES | fr | ru | zh-CN | zh-TW</span><br><span class="line">  language: zh-CN</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>配置完成之后 gitalk 就可以使用了，点击进入文章页面，就会出现如下页面： <img src="https://cdn.cuiqingcai.com/2019-09-26-043331.png" alt=""> GitHub 授权登录之后就可以使用了，评论的内容会自动出现在 Issue 里面。</p>
                  <h3 id="pangu"><a href="#pangu" class="headerlink" title="pangu"></a>pangu</h3>
                  <p>我个人有个强迫症，那就是写中文和英文的时候中间必须要留有间距，一个简单直接的方法就是中间加个空格，但某些情况下可能习惯性不加或者忘记加了，这就导致中英文混排并不是那么美观。 pangu 就是来解决这个问题的，我们只需要在主题里面开启这个选项，在编译生成页面的时候，中英文之间就会自动添加空格，看起来更加美观。 具体的修改如下：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">pangu:</span> <span class="literal">true</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="math"><a href="#math" class="headerlink" title="math"></a>math</h3>
                  <p>可能在一些情况下我们需要写一个公式，比如演示一个算法推导过程，MarkDown 是支持公式显示的，Hexo 的 Next 主题同样是支持的。 Next 主题提供了两个渲染引擎，分别是 mathjax 和 katex，后者相对前者来说渲染速度更快，而且不需要 JavaScript 的额外支持，但后者支持的功能现在还不如前者丰富，具体的对比可以看官方文档：<a href="https://theme-next.org/docs/third-party-services/math-equations" target="_blank" rel="noopener">https://theme-next.org/docs/third-party-services/math-equations</a>。 所以我这里选择了 mathjax，通过修改配置即可启用：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">math:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Default (true) will load mathjax / katex script on demand.</span></span><br><span class="line">  <span class="comment"># That is it only render those page which has `mathjax: true` in Front-matter.</span></span><br><span class="line">  <span class="comment"># If you set it to false, it will load mathjax / katex srcipt EVERY PAGE.</span></span><br><span class="line">  <span class="attr">per_page:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># hexo-renderer-pandoc (or hexo-renderer-kramed) required for full MathJax support.</span></span><br><span class="line">  <span class="attr">mathjax:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># See: https://mhchem.github.io/MathJax-mhchem/</span></span><br><span class="line">    <span class="attr">mhchem:</span> <span class="literal">true</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>mathjax 的使用需要我们额外安装一个插件，叫做 hexo-renderer-kramed，另外也可以安装 hexo-renderer-pandoc，命令如下：</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">npm un hexo-renderer-marked <span class="comment">--save</span></span><br><span class="line">npm i hexo-renderer-kramed <span class="comment">--save</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外还有其他的插件支持，大家可以到官方文档查看。</p>
                  <h3 id="pjax"><a href="#pjax" class="headerlink" title="pjax"></a>pjax</h3>
                  <p>可能大家听说过 Ajax，没听说过 pjax，这个技术实际上就是利用 Ajax 技术实现了局部页面刷新，既可以实现 URL 的更换，有可以做到无刷新加载。 要开启这个功能需要先将 pjax 功能开启，然后安装对应的 pjax 依赖库，首先修改 _config.yml 修改如下：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">pjax:</span> <span class="literal">true</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后安装依赖库，切换到 next 主题下，然后安装依赖库：</p>
                  <figure class="highlight crystal">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">$ cd themes/<span class="keyword">next</span></span><br><span class="line">$ git clone <span class="symbol">https:</span>/<span class="regexp">/github.com/theme</span>-<span class="keyword">next</span>/theme-<span class="keyword">next</span>-pjax source/<span class="class"><span class="keyword">lib</span>/<span class="title">pjax</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样 pjax 就开启了，页面就可以实现无刷新加载了。 另外关于 Next 主题的设置还有挺多的，这里就介绍到这里了，更多的主题设置大家可以参考官方文档：<a href="https://theme-next.org/docs/" target="_blank" rel="noopener">https://theme-next.org/docs/</a>。</p>
                  <h2 id="文章"><a href="#文章" class="headerlink" title="文章"></a>文章</h2>
                  <p>现在整个站点只有一篇文章，那么我们怎样来增加其他的文章呢？ 这个很简单，只需要调用 Hexo 提供的命令即可，比如我们要新建一篇「HelloWorld」的文章，命令如下：</p>
                  <figure class="highlight haxe">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">hexo <span class="keyword">new</span> <span class="type">hello</span>-world</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>创建的文章会出现在 <code>source/_posts</code> 文件夹下，是 MarkDown 格式。 在文章开头通过如下格式添加必要信息：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="string">\---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">标题</span> <span class="comment"># 自动创建，如 hello-world</span></span><br><span class="line"><span class="attr">date:</span> <span class="string">日期</span> <span class="comment"># 自动创建，如 2019-09-22 01:47:21</span></span><br><span class="line"><span class="attr">tags:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">标签1</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">标签2</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">标签3</span></span><br><span class="line"><span class="attr">categories:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">分类1</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">分类2</span></span><br><span class="line"><span class="meta">---</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>开头下方撰写正文，MarkDown 格式书写即可。 这样在下次编译的时候就会自动识别标题、时间、类别等等，另外还有其他的一些参数设置，可以参考文档：<a href="https://hexo.io/zh-cn/docs/writing.html" target="_blank" rel="noopener">https://hexo.io/zh-cn/docs/writing.html</a>。</p>
                  <h2 id="标签页"><a href="#标签页" class="headerlink" title="标签页"></a>标签页</h2>
                  <p>现在我们的博客只有首页、文章页，如果我们想要增加标签页，可以自行添加，这里 Hexo 也给我们提供了这个功能，在根目录执行命令如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">hexo new<span class="built_in"> page </span>tags</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>执行这个命令之后会自动帮我们生成一个 source/tags/index.md 文件，内容就只有这样子的：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="string">\---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">tags</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2019</span><span class="number">-09</span><span class="number">-26</span> <span class="number">16</span><span class="string">:44:17</span></span><br><span class="line"><span class="meta">---</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们可以自行添加一个 type 字段来指定页面的类型：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">type:</span> <span class="string">tags</span></span><br><span class="line"><span class="attr">comments:</span> <span class="literal">false</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后再在主题的 _config.yml 文件将这个页面的链接添加到主菜单里面，修改 menu 字段如下：</p>
                  <figure class="highlight dts">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">menu:</span></span><br><span class="line"><span class="symbol">  home:</span> / || home</span><br><span class="line">  <span class="meta">#about: /about/ || user</span></span><br><span class="line"><span class="symbol">  tags:</span> <span class="meta-keyword">/tags/</span> || tags</span><br><span class="line">  <span class="meta">#categories: /categories/ || th</span></span><br><span class="line"><span class="symbol">  archives:</span> <span class="meta-keyword">/archives/</span> || archive</span><br><span class="line">  <span class="meta">#schedule: /schedule/ || calendar</span></span><br><span class="line">  <span class="meta">#sitemap: /sitemap.xml || sitemap</span></span><br><span class="line">  <span class="meta">#commonweal: /404/ || heartbeat</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样重新本地启动看下页面状态，效果如下： <img src="https://cdn.cuiqingcai.com/2019-09-26-085417.png" alt=""> 可以看到左侧导航也出现了标签，点击之后右侧会显示标签的列表。</p>
                  <h3 id="分类页"><a href="#分类页" class="headerlink" title="分类页"></a>分类页</h3>
                  <p>分类功能和标签类似，一个文章可以对应某个分类，如果要增加分类页面可以使用如下命令创建：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">hexo new<span class="built_in"> page </span>categories</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后同样地，会生成一个 source/categories/index.md 文件。 我们可以自行添加一个 type 字段来指定页面的类型：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">type:</span> <span class="string">categories</span></span><br><span class="line"><span class="attr">comments:</span> <span class="literal">false</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后再在主题的 _config.yml 文件将这个页面的链接添加到主菜单里面，修改 menu 字段如下：</p>
                  <figure class="highlight dts">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">menu:</span></span><br><span class="line"><span class="symbol">  home:</span> / || home</span><br><span class="line">  <span class="meta">#about: /about/ || user</span></span><br><span class="line"><span class="symbol">  tags:</span> <span class="meta-keyword">/tags/</span> || tags</span><br><span class="line"><span class="symbol">  categories:</span> <span class="meta-keyword">/categories/</span> || th</span><br><span class="line"><span class="symbol">  archives:</span> <span class="meta-keyword">/archives/</span> || archive</span><br><span class="line">  <span class="meta">#schedule: /schedule/ || calendar</span></span><br><span class="line">  <span class="meta">#sitemap: /sitemap.xml || sitemap</span></span><br><span class="line">  <span class="meta">#commonweal: /404/ || heartbeat</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样页面就会增加分类的支持，效果如下： <img src="https://cdn.cuiqingcai.com/2019-09-26-085755.png" alt=""></p>
                  <h2 id="搜索页"><a href="#搜索页" class="headerlink" title="搜索页"></a>搜索页</h2>
                  <p>很多情况下我们需要搜索全站的内容，所以一个搜索功能的支持也是很有必要的。 如果要添加搜索的支持，需要先安装一个插件，叫做 hexo-generator-searchdb，命令如下：</p>
                  <figure class="highlight sql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">npm <span class="keyword">install</span> hexo-generator-searchdb <span class="comment">--save</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后在项目的 _config.yml 里面添加搜索设置如下：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">search:</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">search.xml</span></span><br><span class="line">  <span class="attr">field:</span> <span class="string">post</span></span><br><span class="line">  <span class="attr">format:</span> <span class="string">html</span></span><br><span class="line">  <span class="attr">limit:</span> <span class="number">10000</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后在主题的 _config.yml 里面修改如下：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># Local search</span></span><br><span class="line"><span class="comment"># Dependencies: https://github.com/wzpan/hexo-generator-search</span></span><br><span class="line"><span class="attr">local_search:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># If auto, trigger search by changing input.</span></span><br><span class="line">  <span class="comment"># If manual, trigger search by pressing enter key or search button.</span></span><br><span class="line">  <span class="attr">trigger:</span> <span class="string">auto</span></span><br><span class="line">  <span class="comment"># Show top n results per article, show all results by setting to -1</span></span><br><span class="line">  <span class="attr">top_n_per_article:</span> <span class="number">5</span></span><br><span class="line">  <span class="comment"># Unescape html strings to the readable one.</span></span><br><span class="line">  <span class="attr">unescape:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># Preload the search data when the page loads.</span></span><br><span class="line">  <span class="attr">preload:</span> <span class="literal">false</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里用的是 Local Search，如果想启用其他是 Search Service 的话可以参考官方文档：<a href="https://theme-next.org/docs/third-party-services/search-services" target="_blank" rel="noopener">https://theme-next.org/docs/third-party-services/search-services</a>。</p>
                  <h2 id="404-页面"><a href="#404-页面" class="headerlink" title="404 页面"></a>404 页面</h2>
                  <p>另外还需要添加一个 404 页面，直接在根目录 source 文件夹新建一个 404.md 文件即可，内容可以仿照如下：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="string">\---</span></span><br><span class="line"><span class="attr">title:</span> <span class="number">404</span> <span class="string">Not</span> <span class="string">Found</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2019</span><span class="number">-09</span><span class="number">-22</span> <span class="number">10</span><span class="string">:41:27</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line"><span class="string">&lt;center&gt;</span></span><br><span class="line"><span class="string">对不起，您所访问的页面不存在或者已删除。</span></span><br><span class="line"><span class="string">您可以&lt;a</span> <span class="string">href="https://blog.nightteam.cn&gt;"&gt;点击此处&lt;/a&gt;返回首页。</span></span><br><span class="line"><span class="string">&lt;/center&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&lt;blockquote</span> <span class="string">class="blockquote-center"&gt;</span></span><br><span class="line">    <span class="string">NightTeam</span></span><br><span class="line"><span class="string">&lt;/blockquote&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里面的一些相关信息和链接可以替换成自己的。 增加了这个 404 页面之后就可以 完成了上面的配置基本就完成了大半了，其实 Hexo 还有很多很多功能，这里就介绍不过来了，大家可以直接参考官方文档：<a href="https://hexo.io/zh-cn/docs/" target="_blank" rel="noopener">https://hexo.io/zh-cn/docs/</a> 查看更多的配置。</p>
                  <h2 id="部署脚本"><a href="#部署脚本" class="headerlink" title="部署脚本"></a>部署脚本</h2>
                  <p>最后我这边还增加了一个简易版的部署脚本，其实就是重新 gererate 下文件，然后重新部署。在根目录下新建一个 deploy.sh 的脚本文件，内容如下：</p>
                  <figure class="highlight verilog">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">hexo clean</span><br><span class="line">hexo <span class="keyword">generate</span></span><br><span class="line">hexo deploy</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们在部署发布的时候只需要执行：</p>
                  <figure class="highlight stata">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">sh</span> deploy.<span class="keyword">sh</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>就可以完成博客的更新了，非常简单。</p>
                  <h2 id="自定义域名"><a href="#自定义域名" class="headerlink" title="自定义域名"></a>自定义域名</h2>
                  <p>将页面修改之后可以用上面的脚本重新部署下博客，其内容便会跟着更新。 另外我们也可以在 GitHub 的 Repository 里面设置域名，找到 Settings，拉到下面，可以看到有个 GitHub Pages 的配置项，如图所示： <img src="https://cdn.cuiqingcai.com/2019-09-26-112622.png" alt=""> 下面有个 custom domain 的选项，输入你想自定义的域名地址，然后添加 CNAME 解析就好了。 另外下面还有一个 Enforce HTTPS 的选项，GitHub Pages 会在我们配置自定义域名之后自动帮我们配置 HTTPS 服务。刚配置完自定义域名的时候可能这个选项是不可用的，一段时间后等到其可以勾选了，直接勾选即可，这样整个博客就会变成 HTTPS 的协议的了。 另外有一个值得注意的地方，如果配置了自定义域名，在目前的情况下，每次部署的时候这个自定义域名的设置是会被自动清除的。所以为了避免这个情况，我们需要在项目目录下面新建一个 CNAME 文件，路径为 source/CNAME，内容就是自定义域名。 比如我就在 source 目录下新建了一个 CNAME 文件，内容为：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">blog</span><span class="selector-class">.nightteam</span><span class="selector-class">.cn</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样避免了每次部署的时候自定义域名被清除的情况了。 以上就是从零搭建一个 Hexo 博客的流程，希望对大家有帮助。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-09-30 10:41:36" itemprop="dateCreated datePublished" datetime="2019-09-30T10:41:36+08:00">2019-09-30</time>
                </span>
                <span id="/7625.html" class="post-meta-item leancloud_visitors" data-flag-title="利用 GitHub + Hexo + Next 从零搭建一个博客" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>14k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>13 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/7544.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 技术杂谈 <i class="label-arrow"></i>
                  </a>
                  <a href="/7544.html" class="post-title-link" itemprop="url">AndServer+Service 打造 Android 服务器实现 so 文件调用</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h4 id="so-文件调用"><a href="#so-文件调用" class="headerlink" title="so 文件调用"></a>so 文件调用</h4>
                  <p>随着 Android 移动安全的高速发展，不管是为了执行效率还是程序的安全性等，关键代码下沉 native 层已成为基本操作。 native 层的开发就是通指的 JNI/NDK 开发，通过 JNI 可以实现 java 层和 native 层（主要是 C/C++ ）的相互调用，native 层经编译后产生 so 动态链接库，so 文件具有可移植性广，执行效率高，保密性强等优点。 那么问题来了，如何调用 so 文件显得异常重要，当然你也可以直接分析 so 文件的伪代码，利用强悍的编程功底直接模拟关键操作，但是我想对于普通人来说头发还是比较重要的。 当前调用 so 文件的主流操作应该是： 1，基于 Unicorn 的各种实现（还在学习中，暂且不表） 2，Android 服务器的搭建，在 App 内起 http 服务完成调用 so 的需求（当然前提是过了 so 的效验等操作） 至于为什么选用 AndServer，好吧，不为什么，只是因为搜索到了它 为什么结合 Service，在学习 Android 开发的时候了解到了 Service 的生命周期，个人理解用 Service 去创建 Http 服务比较好。 当然也有 Application 的简单使用，因为在正式环境中，大多数 so 文件的逻辑中都有 context 的一些包名了，签名了的效验等，自定义 Application 的话获取 context 传参就好了。</p>
                  <h4 id="libyemu-so-简介"><a href="#libyemu-so-简介" class="headerlink" title="libyemu.so 简介"></a>libyemu.so 简介</h4>
                  <p>这是我编译好的一个 so 文件，就是根据入参做下简单的字符串拼接（以下是 native 层编译前的 c 代码）</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">extern <span class="string">"C"</span></span><br><span class="line">JNIEXPORT jstring JNICALL</span><br><span class="line"><span class="constructor">Java_com_fw_myapplication_ndktest_NdkTest_stringFromUTF(JNIEnv <span class="operator">*</span><span class="params">env</span>, <span class="params">jobject</span> <span class="params">instance</span>, <span class="params">jstring</span> <span class="params">str_</span>)</span> &#123;</span><br><span class="line">    jclass String_clazz = env-&gt;<span class="constructor">FindClass(<span class="string">"java/lang/String"</span>)</span>;</span><br><span class="line"></span><br><span class="line">    jmethodID concat_methodID = env-&gt;<span class="constructor">GetMethodID(String_clazz, <span class="string">"concat"</span>, <span class="string">"(Ljava/lang/String;)Ljava/lang/String;"</span>)</span>;</span><br><span class="line"></span><br><span class="line">    jstring str = env-&gt;<span class="constructor">NewStringUTF(<span class="string">"  from so --[NightTeam夜幕]"</span>)</span>;</span><br><span class="line"></span><br><span class="line">    jobject str1 = env-&gt;<span class="constructor">CallObjectMethod(<span class="params">str_</span>, <span class="params">concat_methodID</span>, <span class="params">str</span>)</span>;</span><br><span class="line"></span><br><span class="line">    const <span class="built_in">char</span> *chars = env-&gt;<span class="constructor">GetStringUTFChars((<span class="params">jstring</span>)</span>str1, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    return env-&gt;<span class="constructor">NewStringUTF(<span class="params">chars</span>)</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这部分代码还是有必要贴一下的，简单的静态注册使用了反射的思想，反射在逆向中至关重要 接下来是 java 代码，定义了 native 函数</p>
                  <figure class="highlight arduino">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">package com.fw.myapplication.ndktest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NdkTest</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> native <span class="keyword">String</span> <span class="title">stringFromUTF</span><span class="params">(<span class="keyword">String</span> str)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">"yemu"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果到这里有点懵逼的同学可能需要去补下 Android 开发基础了</p>
                  <h4 id="Android-项目测试-so"><a href="#Android-项目测试-so" class="headerlink" title="Android 项目测试 so"></a>Android 项目测试 so</h4>
                  <p>先说下我的环境，因为这个环境影响太大了 1，AndroidStudio 3.4 2，手机 Android 6 架构 armeabi-v7a 打开 AndroidStudio 新建 project <img src="http://pxx0jx04s.bkt.clouddn.com/FnI6Y8rCEUPsGF-Crl6fHbS1Jj7O" alt=""> 在 module 的 build 中加这么一句，然后 sync <img src="http://pxx0jx04s.bkt.clouddn.com/Fgsl4Zg7LocRkHREXLpBUaJDKsDB" alt=""> 把编译好的 so 文件复制到 libs 文件夹下（和刚才的 jniLibs.srcDirs 对应） <img src="http://pxx0jx04s.bkt.clouddn.com/FjUP5ssOtJSkb-Qas0liRT9yseIG" alt=""> 把 so 对应的 java 代码也 copy 过来，注意包名类名的一致性 <img src="http://pxx0jx04s.bkt.clouddn.com/FqHDAvfRfENxubUUG16galS4NPX8" alt=""> 打开 activity_main.xml 文件为 TextView 添加 id <img src="http://pxx0jx04s.bkt.clouddn.com/Fv-pvgJ3-5DL7P_0kvWZ6uRFODpJ" alt=""> 打开 MainActiviy.java 开始编码 <img src="http://pxx0jx04s.bkt.clouddn.com/FtMaZriK312NMGuHHfnslHxH-DRq" alt=""> 这两行的意思就是，先从布局中找到对应 id 的 TextView，然后为其设置 Text（调用 native 函数的返回值） 下面测试一下咱们的 so 调用情况 <img src="http://pxx0jx04s.bkt.clouddn.com/FlZPSXoC-nljUM-57UYm7IBh78F8" alt=""> 可以看到咱们的 so 文件调用成功（这里咱们的 so 没有效验，只是测试 app 是否可以正常调用）</p>
                  <h4 id="AndServer-代码编写"><a href="#AndServer-代码编写" class="headerlink" title="AndServer 代码编写"></a>AndServer 代码编写</h4>
                  <p>AndServer 官方文档：<a href="https://yanzhenjie.com/AndServer/" target="_blank" rel="noopener">https://yanzhenjie.com/AndServer/</a> 打开官方文档，看看人家的入门介绍，新建 java 文件 <img src="http://pxx0jx04s.bkt.clouddn.com/FpwqVRWawPLsdE4BkB4vk51YeEfj" alt=""> 如图经典 MVC 的 C 就写好了，定义了一个 nightteam_sign 接口，请求方式为 get，请求参数为 sign，调用 native 函数，然后返回 json，但是这里我想利用 Application 获取下 context 对象，取下包名，接下来自定义 Applictaion</p>
                  <figure class="highlight scala">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">package</span> com.nightteam.httpso;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.<span class="type">Application</span>;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> static <span class="type">MyApp</span> myApp;</span><br><span class="line">    public static <span class="type">MyApp</span> getInstance() &#123;</span><br><span class="line">        <span class="keyword">return</span> myApp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    public void onCreate() &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        myApp = <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后在 manifest 文件中指定要启动的 Application <img src="http://pxx0jx04s.bkt.clouddn.com/FoiTsSgJMVTp5IPlTpk899AfjE-v" alt=""> 然后修改 MyController.java 的代码 <img src="http://pxx0jx04s.bkt.clouddn.com/FgO0OfbGufmBi__W0HBQ1PqTfo-w" alt=""> 接下来把官方文档-服务器的代码 copy 下来 导入一些包，修改部分代码如下 <img src="http://pxx0jx04s.bkt.clouddn.com/Flpyzen_6rJH_YOM86WS6-57AE2L" alt=""> 新版本的 AndServer.serverBuilder 已经需要传递 context 了，这里把网络地址和端口号也修改为从构造参数中获取，到这里 AndServer 的东西基本完了，实际上咱们就搭建一个调 so 的接口，并没有过多的业务逻辑，所以代码就是使用的最简单的</p>
                  <h4 id="Service-代码编写"><a href="#Service-代码编写" class="headerlink" title="Service 代码编写"></a>Service 代码编写</h4>
                  <p>咱们这里用按钮的点击事件启动 Service，故在 activity_main.xml 中添加一个 button 并指定点击事件 <img src="http://pxx0jx04s.bkt.clouddn.com/Fh7PsV-Ha67UumUhNt_7HfoziS0G" alt=""> <img src="http://pxx0jx04s.bkt.clouddn.com/FiB44r5XTQIKOZ4wbNtAUaql_PpL" alt=""> 接下来编写自定义 Service 代码</p>
                  <figure class="highlight java">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">package</span> com.nightteam.httpso.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Service;</span><br><span class="line"><span class="keyword">import</span> android.content.Intent;</span><br><span class="line"><span class="keyword">import</span> android.os.IBinder;</span><br><span class="line"><span class="keyword">import</span> android.util.Log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.nightteam.httpso.ServerManager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.UnknownHostException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"NigthTeam"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        Log.d(TAG, <span class="string">"onCreate: MyService"</span>);</span><br><span class="line">        <span class="keyword">new</span> Thread() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">super</span>.run();</span><br><span class="line">                InetAddress inetAddress = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    inetAddress = InetAddress.getByName(<span class="string">"0.0.0.0"</span>);</span><br><span class="line">                    Log.d(TAG, <span class="string">"onCreate: "</span> + inetAddress.getHostAddress());</span><br><span class="line">                    ServerManager serverManager = <span class="keyword">new</span> ServerManager(getApplicationContext(), inetAddress, <span class="number">8005</span>);</span><br><span class="line">                    serverManager.startServer();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (UnknownHostException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>打上了几个 log，在子线程中启动 AndServer 的服务（何时使用 UI 线程和子线程是 Android 基础，这里就不赘述了） 注意一下，这里从 0.0.0.0 获取 inetAddress，可不要写错了，localhost 和 0.0.0.0 的区别请移步搜索引擎 然后就是向 ServerManager 的构造函数传递 context，inetAddress，port 用来 new 对象，随后开启服务 最后注意检查下 manifest 文件中 Service 的声明 <img src="http://pxx0jx04s.bkt.clouddn.com/FrxfrVW-TP5EGegkMIlpKNiiTyqI" alt=""></p>
                  <h4 id="开启-Service，并获取本机-ip"><a href="#开启-Service，并获取本机-ip" class="headerlink" title="开启 Service，并获取本机 ip"></a>开启 Service，并获取本机 ip</h4>
                  <p>回到我们的 MainActivity.java 的 operate（ button 的点击事件）编写启动 Service 代码</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">public void operate(View view) &#123;</span><br><span class="line">       switch (view.get<span class="constructor">Id()</span>)&#123;</span><br><span class="line">           case <span class="module-access"><span class="module"><span class="identifier">R</span>.</span></span>id.id_bt_index:</span><br><span class="line">               <span class="comment">//启动服务:创建--&gt;启动--&gt;销毁</span></span><br><span class="line">               <span class="comment">//如果服务已经创建了，后续重复启动，操作的都是同一个服务，不会再重新创建了，除非你先销毁它</span></span><br><span class="line">               Intent it1 = <span class="keyword">new</span> <span class="constructor">Intent(<span class="params">this</span>, MyService.<span class="params">class</span>)</span>;</span><br><span class="line">               <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>d(TAG, <span class="string">"operate: button"</span>);</span><br><span class="line">               start<span class="constructor">Service(<span class="params">it1</span>)</span>;</span><br><span class="line">               ((Button) view).set<span class="constructor">Text(<span class="string">"服务已开启"</span>)</span>;</span><br><span class="line">               break;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>到这里我们的服务基本搭建好了，但是为了方便起见，我想把咱们的本机 ip 显示在 App 上，这样我们就不用去设置再查看了 我在网上找到了一个获取 ip 地址的一个工具类，源码如下:</p>
                  <figure class="highlight java">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">package</span> com.nightteam.httpso;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.NetworkInterface;</span><br><span class="line"><span class="keyword">import</span> java.net.SocketException;</span><br><span class="line"><span class="keyword">import</span> java.util.Enumeration;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NetUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Pattern IPV4_PATTERN = Pattern.compile(<span class="string">"^("</span> +</span><br><span class="line"></span><br><span class="line">            <span class="string">"([0-9]|[1-9][0-9]|1[0-9]&#123;2&#125;|2[0-4][0-9]|25[0-5])\\.)&#123;3&#125;"</span> +</span><br><span class="line"></span><br><span class="line">            <span class="string">"([0-9]|[1-9][0-9]|1[0-9]&#123;2&#125;|2[0-4][0-9]|25[0-5])$"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isIPv4Address</span><span class="params">(String input)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> IPV4_PATTERN.matcher(input).matches();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取本机IP地址</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> InetAddress <span class="title">getLocalIPAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        Enumeration&lt;NetworkInterface&gt; enumeration = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            enumeration = NetworkInterface.getNetworkInterfaces();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (SocketException e) &#123;</span><br><span class="line"></span><br><span class="line">            e.printStackTrace();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (enumeration != <span class="keyword">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (enumeration.hasMoreElements()) &#123;</span><br><span class="line"></span><br><span class="line">                NetworkInterface nif = enumeration.nextElement();</span><br><span class="line"></span><br><span class="line">                Enumeration&lt;InetAddress&gt; inetAddresses = nif.getInetAddresses();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (inetAddresses != <span class="keyword">null</span>)</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">while</span> (inetAddresses.hasMoreElements()) &#123;</span><br><span class="line"></span><br><span class="line">                        InetAddress inetAddress = inetAddresses.nextElement();</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (!inetAddress.isLoopbackAddress() &amp;&amp; isIPv4Address(inetAddress.getHostAddress())) &#123;</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">return</span> inetAddress;</span><br><span class="line"></span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>把工具类 copy 到我们的 Android 项目中，继续在 MainActivity.java 中编码 <img src="http://pxx0jx04s.bkt.clouddn.com/FgJn1_mmO3xfu8bC4tdiM-uUHM-w" alt=""> 获取了一下本机地址和 Android SDK 版本（ Android 8 之后启动 Service 方式不一样）</p>
                  <h4 id="申请权限，启动-App"><a href="#申请权限，启动-App" class="headerlink" title="申请权限，启动 App"></a>申请权限，启动 App</h4>
                  <p>最后一步就是为 app 申请网络权限了 <img src="http://pxx0jx04s.bkt.clouddn.com/FsWGhs2q4d-zwYjEZJXYIc8LJor9" alt=""> 随后连接我们的手机，运行项目，测试一下，点击开启服务 <img src="http://pxx0jx04s.bkt.clouddn.com/Fkon0mUBUUpqbbsDaQPvdc_xb2aE" alt=""> 看下 AndroidStudio 日志 <img src="http://pxx0jx04s.bkt.clouddn.com/Fl17ks9HRNRDTi-FeHAHz9GRNFXF" alt=""> 好像一切正常，在浏览器访问下试试（ ip 就是 App 中显示的 ip 地址） <img src="http://pxx0jx04s.bkt.clouddn.com/FolDpPh19DiCx3b5eKxT8EHCTZVs" alt=""> 如图正常访问到了我们想要的内容 回过头来说下 Service，打开我们手机的设置，找到应用程序管理-运行中的服务（手机不同，方式不同） <img src="http://pxx0jx04s.bkt.clouddn.com/FuKPa8wpqZ41LMC8vmCS3QTol2GN" alt=""> 可以看到我们的程序，运行了一个服务，这个服务就是咱们编码的 MyService <img src="http://pxx0jx04s.bkt.clouddn.com/Fp461KQ3wzQ_WYMW0XTO1i4bGebI" alt=""> 接下来杀掉该 App进程，再次查看运行中的服务 <img src="http://pxx0jx04s.bkt.clouddn.com/Ft3ZLJIdLXcfd-zwp4K3zVfTXta9" alt=""> 我这里在权限管理设置了自动运行，可以保持服务的运行。（这个地方还是根据系统有大小差异） 至此使用 App 起 http 服务调 so 就完成了</p>
                  <hr>
                  <p>好了，上面就是利用 AndServer 打造 Android 服务器调 so 文件的整体思路和流程，如果你懒得看的话，直接用我写好的 App 修修补补也是可以的，只需要发送消息【AndServer搭建Web服务调so】到公众号【NightTeam】即可。</p>
                  <hr>
                  <p>文章作者：「夜幕团队 NightTeam 」- 妄为 夜幕团队成立于 2019 年，团队成员包括崔庆才、周子淇、陈祥安、唐轶飞、冯威、蔡晋、戴煌金、张冶青和韦世东。 涉猎的主要编程语言为 Python、Rust、C++、Go，领域涵盖爬虫、深度学习、服务研发和对象存储等。团队非正亦非邪，只做认为对的事情，请大家小心。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/NightTeam" class="author" itemprop="url" rel="index">NightTeam</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-09-20 01:16:37" itemprop="dateCreated datePublished" datetime="2019-09-20T01:16:37+08:00">2019-09-20</time>
                </span>
                <span id="/7544.html" class="post-meta-item leancloud_visitors" data-flag-title="AndServer+Service 打造 Android 服务器实现 so 文件调用" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>6.2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>6 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/7542.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 技术杂谈 <i class="label-arrow"></i>
                  </a>
                  <a href="/7542.html" class="post-title-link" itemprop="url">如何将协议规范变成开源库系列文章之 WebSocket</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>这是系列文章的第一篇，也是非常重要的一篇，希望大家能读懂我想要表达的意思。</p>
                  <h1 id="系列文章开篇概述"><a href="#系列文章开篇概述" class="headerlink" title="系列文章开篇概述"></a>系列文章开篇概述</h1>
                  <p>相对于其他编程语言来说，Python 生态中最突出的就是第三方库。任何一个及格的 Python 开发者都使用过至少 5 款第三方库。 就爬虫领域而言，必将用到的例如网络请求库 Requests、网页解析库 Parsel 或 BeautifulSoup、数据库对象关系映射 Motor 或 SQLAlchemy、定时任务 Apscheduler、爬虫框架 Scrapy 等。 这些开源库的使用方法想必大家已经非常熟练了，甚至还修炼出了自己的一套技巧，日常工作中敲起键盘肯定也是哒哒哒的响。 但是你有没有想过：</p>
                  <ul>
                    <li>那个神奇的功能是如何实现的？</li>
                    <li>这个功能背后的逻辑是什么？</li>
                    <li>为什么要这样做而不是选择另一种写法？</li>
                    <li>编写这样的库需要用到哪些知识？</li>
                    <li>这个论点是否有明确的依据？</li>
                  </ul>
                  <p><img src="https://user-gold-cdn.xitu.io/2019/9/14/16d2dda24b0853ed?w=312&amp;h=312&amp;f=png&amp;s=127644" alt=""> 如果你从未这样想过，那说明你还没到达应该「渡劫」的时机；如果你曾提出过 3 个以上的疑问，那说明你即将到达那个重要的关口；如果你常常这么想，而且也尝试着寻找对应的答案，那么恭喜你，你现在正处于「渡劫」的关口之上。 <img src="https://user-gold-cdn.xitu.io/2019/9/14/16d2de0cdaef77c5?w=538&amp;h=282&amp;f=png&amp;s=104780" alt=""> 偶有群友会抛出这样的问题：初级工程师、中级工程师、高级工程师如何界定？ 这个问题有两种不同的观点，第一个是看工作职级，第二个则是看个人能力。工作职级是一个浮动很大的参照物，例如阿里巴巴的高级研发和我司的高级研发，职级名称都是「高级研发」，但能力可能会有很大的差距。 个人能力又如何评定呢？ 难不成看代码写的快还是写的慢吗？ 当然不是！ 个人能力应当从广度和深度两个方面进行考量，这并没有一个明确的标准。当两人能力差异很大的时候，外人可以轻松的分辨孰强孰弱。 自己怎样分辨个人能力的进与退呢？ 这就回到了上面提到的那些问题：WHO WHAT WHERE WHY WHEN HOW？ 我想通过这篇文章告诉你，不要做那个用库用得很熟练的人，要做那个创造库的人。计算机世界如此吸引人，就是因为我们可以在这个世界里尽情创造。 你想做一个创造者吗？ 如果不想，那现在你就可以关掉浏览器窗口，回到 Hub 的世界里。</p>
                  <h1 id="内容介绍"><a href="#内容介绍" class="headerlink" title="内容介绍"></a>内容介绍</h1>
                  <p>这是一套系列文章，这个系列将为大家解读常见库（例如 WebSocket、HTTP、ASCII、Base64、MD5、AES、RSA）的协议规范和对应的代码实现，帮助大家「知其然，知其所以然」。</p>
                  <h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2>
                  <p>这次我们要学习的是 WebSocket 协议规范和代码实现，也可以理解为从 0 开始编写 <a href="https://github.com/asyncins/aiowebsocket" target="_blank" rel="noopener">aiowebsocket</a> 库。至于为什么选择它，那大概是因为全世界没有比我更熟悉的它的人了。 我是 aiowebsocket 库的作者，我花了 7 天编写这个库。写库的过程，让我深刻体会到造轮子和驾驶的区别，也让我有了飞速的进步。我希望用连载系列文章的形式帮助大家从驾驶者转换到创造者，拥有「编程思考」。</p>
                  <h2 id="前置条件"><a href="#前置条件" class="headerlink" title="前置条件"></a>前置条件</h2>
                  <p>WebSocket 是一种在单个 TCP 连接上进行全双工通信的协议，它的出现使客户端和服务器之间的数据交换变得更加简单。下图描述了双端交互的流程: WebSocket 通常被应用在实时性要求较高的场景，例如赛事数据、股票证券、网页聊天和在线绘图等。WebSocket 与 HTTP 协议完全不同，但同样被广泛应用。 无论是后端开发者、前端开发者、爬虫工程师或者信息安全工作者，都应该掌握 WebSocket 协议的知识。 我曾经发表过几篇关于 WebSocket 的文章：</p>
                  <ul>
                    <li><a href="https://juejin.im/post/5d4cbc0cf265da038f47fa37" target="_blank" rel="noopener">【严选-高质量文章】开发者必知必会的 WebSocket 协议</a></li>
                    <li><a href="https://juejin.im/post/5c80b768f265da2dae514d4f" target="_blank" rel="noopener">Python如何爬取实时变化的WebSocket数据</a></li>
                    <li><a href="https://juejin.im/post/5c7cdaabf265da2daf79c15f" target="_blank" rel="noopener">WebSocket 从入门到写出开源库</a></li>
                  </ul>
                  <p>其中，《【严选-高质量文章】开发者必知必会的 WebSocket 协议》介绍了协议规范的相关知识。这篇文章的内容大体如下：</p>
                  <ul>
                    <li>WebSocket 协议来源</li>
                    <li>WebSocket 协议的优点</li>
                    <li>WebSocket 协议规范</li>
                    <li>一些实际代码演示</li>
                  </ul>
                  <p>如果没有掌握 WebSocket 协议的朋友，我建议先去阅读这篇文章，尤其是对 <a href="https://juejin.im/post/5d4cbc0cf265da038f47fa37#heading-4" target="_blank" rel="noopener">WebSocket 协议规范</a>介绍的那部分。 要想将协议规范 RFC6455 变成开源库，第一步就是要熟悉整个协议规范，所以你需要阅读<a href="https://juejin.im/post/5d4cbc0cf265da038f47fa37" target="_blank" rel="noopener">【严选-高质量文章】开发者必知必会的 WebSocket 协议</a>。当然，有能力的同学直接阅读 RFC6455 也未尝不可。 接着还需要了解编程语言中内置库 Socket 的基础用法，例如 Python 中的 <a href="https://docs.python.org/3/library/socket.html?highlight=socket#module-socket" target="_blank" rel="noopener">socket</a> 或者更高级更潮的 <a href="https://docs.python.org/3/library/asyncio-stream.html" target="_blank" rel="noopener">Streams</a>、<a href="https://docs.python.org/3/library/asyncio-protocol.html" target="_blank" rel="noopener">Transports and Protocols</a>。如果你是 Go 开发者、Rust 开发者，请查找对应语言的内置库。 假设你已经熟悉了 RFC6455，你应该知道 Frame 打包和解包的时候需要用到位运算，正好我之前写过位运算相关的文章 <a href="https://gitbook.cn/gitchat/activity/5d4d6d8f6f29256fa317e946" target="_blank" rel="noopener">7分钟全面了解位运算</a>。 至于其它的，现用现学吧！</p>
                  <h1 id="Python-网络通信之-Streams"><a href="#Python-网络通信之-Streams" class="headerlink" title="Python 网络通信之 Streams"></a>Python 网络通信之 Streams</h1>
                  <p>WebSocket，也可以理解为在 WEB 应用中使用的 Socket，这意味着本篇将会涉及到 Socket 编程。上面提到，Python 中与 Socket 相关的有 socket、Streams、Transports and Protocols。其中 socket 是同步的，而另外两个是异步的，这俩属于你常听到的 asyncio。</p>
                  <h2 id="Socket-通信过程"><a href="#Socket-通信过程" class="headerlink" title="Socket 通信过程"></a>Socket 通信过程</h2>
                  <p>Socket 是端到端的通信，所以我们要搞清楚消息是怎么从一台机器发送到另一台机器的，这很重要。假设通信的两台机器为 Client 和 Server，Client 向 Server 发送消息的过程如下图所示：</p>
                  <blockquote>
                    <p>Client 通过文件描述符的读写 API read &amp; write 来访问操作系统内核中的网络模块为当前套接字分配的发送 send buffer 和接收 recv buffer 缓存。 Client 进程写消息到内核的发送缓存中，内核将发送缓存中的数据传送到物理硬件 NIC，也就是网络接口芯片 (Network Interface Circuit)。 NIC 负责将翻译出来的模拟信号通过网络硬件传递到服务器硬件的 NIC。 服务器的 NIC 再将模拟信号转成字节数据存放到内核为套接字分配的接收缓存中，最终服务器进程从接收缓存中读取数据即为源客户端进程传递过来的 消息。</p>
                  </blockquote>
                  <p>上述通信过程的描述和图片均出自钱文品的深入理解 RPC 交互流程。 我尝试寻找通信过程中每个步骤的依据（尤其是 send buffer to NIC to recv buffer），（我翻阅了 TCP 的 RFC 和 Kernel.org）但遗憾的是并未找到有力的证明（一定是我太菜了），如果有朋友知道，可以评论告诉我或发邮件 zenrusts@sina.com 告诉我，我可以扩展出另一篇文章。</p>
                  <h2 id="创建-Streams"><a href="#创建-Streams" class="headerlink" title="创建 Streams"></a>创建 Streams</h2>
                  <p>那么问题来了：在 Python 中，我们如何实现端到端的消息发送呢？ 答：Python 提供了一些对象帮助我们实现这个需求，其中相对简单易用的是 Streams。 Streams 是 Python Asynchronous I/O 中提供的 High-level APIs。Python 官方文档对 Streams 的介绍如下：</p>
                  <blockquote>
                    <p>Streams are high-level async/await-ready primitives to work with network connections. Streams allow sending and receiving data without using callbacks or low-level protocols and transports.</p>
                  </blockquote>
                  <p>我尬译一下：Streams 是用于网络连接的 high-level async/await-ready 原语。Streams 允许在不使用回调或 low-level protocols and transports 的情况下发送和接收数据。 Python 提供了 <code>asyncio.open_connection()</code> 让开发者创建 Streams，<code>asyncio.open_connection()</code> 将建立网络连接并返回 reader 和 writer 对象，这两个对象其实是 StreamReader 和 StreamWriter 类的实例。 开发者可以通过 StreamReader 从 IO 流中读取数据，通过 StreamWriter 将数据写入 IO 流。虽然文档并没有给出 IO 流的明确定义，但我猜它跟 buffer （也就是 send buffer to NIC to recv buffer 中的 buffer）有关，你也可以抽象的认为它就是 buffer。 有了 Streams，就有了端到端消息发送的完整实现。下面将通过一个例子来熟悉 Streams 的用法和用途。这是 Python 官方文档给出的双端示例，首先是 Server 端：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># TCP echo server using streams</span></span><br><span class="line"><span class="comment"># 本文出自「夜幕团队 NightTeam」 转载请联系并取得授权</span></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">handle_echo</span><span class="params">(reader, writer)</span>:</span></span><br><span class="line">    data = <span class="keyword">await</span> reader.read(<span class="number">100</span>)</span><br><span class="line">    message = data.decode()</span><br><span class="line">    addr = writer.get_extra_info(<span class="string">'peername'</span>)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">f"Received <span class="subst">&#123;message!r&#125;</span> from <span class="subst">&#123;addr!r&#125;</span>"</span>)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">f"Send: <span class="subst">&#123;message!r&#125;</span>"</span>)</span><br><span class="line">    writer.write(data)</span><br><span class="line">    <span class="keyword">await</span> writer.drain()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"Close the connection"</span>)</span><br><span class="line">    writer.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    server = <span class="keyword">await</span> asyncio.start_server(</span><br><span class="line">        handle_echo, <span class="string">'127.0.0.1'</span>, <span class="number">8888</span>)</span><br><span class="line"></span><br><span class="line">    addr = server.sockets[<span class="number">0</span>].getsockname()</span><br><span class="line">    print(<span class="string">f'Serving on <span class="subst">&#123;addr&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> server:</span><br><span class="line">        <span class="keyword">await</span> server.serve_forever()</span><br><span class="line"></span><br><span class="line">asyncio.run(main())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接着是 Client 端：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># TCP echo client using streams</span></span><br><span class="line"><span class="comment"># 本文出自「夜幕团队 NightTeam」 转载请联系并取得授权</span></span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">tcp_echo_client</span><span class="params">(message)</span>:</span></span><br><span class="line">    reader, writer = <span class="keyword">await</span> asyncio.open_connection(</span><br><span class="line">        <span class="string">'127.0.0.1'</span>, <span class="number">8888</span>)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">f'Send: <span class="subst">&#123;message!r&#125;</span>'</span>)</span><br><span class="line">    writer.write(message.encode())</span><br><span class="line"></span><br><span class="line">    data = <span class="keyword">await</span> reader.read(<span class="number">100</span>)</span><br><span class="line">    print(<span class="string">f'Received: <span class="subst">&#123;data.decode()!r&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'Close the connection'</span>)</span><br><span class="line">    writer.close()</span><br><span class="line"></span><br><span class="line">asyncio.run(tcp_echo_client(<span class="string">'Hello World!'</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>将示例分别写入到 server.py 和 client.py 中，然后按序运行。此时 server.py 的窗口会输出如下内容：</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Serving <span class="keyword">on</span> (<span class="string">'127.0.0.1'</span>, <span class="title">8888</span>)</span><br><span class="line">Received <span class="string">'Hello World!'</span> <span class="built_in">from</span> (<span class="string">'127.0.0.1'</span>, <span class="number">59534</span>)</span><br><span class="line">Send: <span class="string">'Hello World!'</span></span><br><span class="line">Close <span class="keyword">the</span> connection</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>从输出中得知，服务启动的 address 和 port 为 <code>(&#39;127.0.0.1&#39;, 8888)</code>，从 <code>(&#39;127.0.0.1&#39;, 59534)</code> 读取到内容为 <code>Hello World!</code> 的消息，接着将 <code>Hello World!</code> 返回给 <code>(&#39;127.0.0.1&#39;, 59534)</code> ，最后关闭连接。 client.py 的窗口输出内容如下：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="string">Send:</span> <span class="string">'Hello World!'</span></span><br><span class="line"><span class="string">Received:</span> <span class="string">'Hello World!'</span></span><br><span class="line">Close the connection</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在创建连接后，Client 向指定的端发送了内容为 <code>Hello World!</code> 的消息，接着从指定的端接收到内容为 <code>Hello World!</code> 的消息，最后关闭连接。 有些读者可能不太理解，为什么 Client Send <code>Hello World!</code> ，而 Server 接收到之后也向 Client Send <code>Hello World!</code> 。双端的 Send 和 Received 都是 <code>Hello World!</code> ，这很容易让新手懵逼。实际上这就是一个普通的回显服务器示例，也就是说当 Server 收到消息时，将消息内容原封不动的返回给 Client。 这样只是为了演示，并无它意，但这样的示例却会给新手带来困扰。 以上是一个简单的 Socket 编程示例，整体思路理解起来还是很轻松的，接下来我们将逐步解读示例中的代码：</p>
                  <figure class="highlight autohotkey">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">* client.py 中用 `asyncio.open_connection()` 连接指定的端，并获得 reader 和 writer 这两个对象。</span><br><span class="line">* 然后使用 writer 对象中的 `write()` 方法将 `Hello World!` 写入到 IO 流中，该消息会被发送到 Server。</span><br><span class="line">* 接着使用 reader 对象中的 `read()` 方法从 IO 流中读取消息，并将消息打印到终端。</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>看到这里，你或许会有另一个疑问：<code>write()</code> 只是将消息写入到 IO 流，并没有发送行为，那消息是如何传输到 Server 的呢？ 由于无法直接跟进 CPython 源代码，所以我们无法得到确切的结果。但我们可以跟进 Python 代码，得知消息最后传输到 <code>transport.write()</code> ，如果你想知道更多，可以去看 Transports and Protocols 的介绍。你可以将这个过程抽象为上图的 Client to send buffer to NIC to recv buffer to Server。</p>
                  <h1 id="功能模块设计"><a href="#功能模块设计" class="headerlink" title="功能模块设计"></a>功能模块设计</h1>
                  <p>通过上面的学习，现在你已经掌握了 WebSocket 协议规范和 Python Streams 的基本用法，接下来就可以设计一个 WebSocket 客户端库了。 根据 RFC6455 的约定，WebSocket 之前是 HTTP，通过「握手」来升级协议。协议升级后进入真正的 WebSocket 通信，通信包含发送（Send）和接收（Recv）。文本消息要在传输过程前转换为 Frames，而接受端读取到消息后要将 Frames 转换成文本。当然，期间会有一些异常产生，我们可能需要自定义异常，以快速定位问题所在。现在我们得出了几个模块：</p>
                  <figure class="highlight asciidoc">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="bullet">* </span>握手 - ShakeHands</span><br><span class="line"></span><br><span class="line"><span class="bullet">* </span>传输 - Transports</span><br><span class="line"></span><br><span class="line"><span class="bullet">* </span>帧处理 - Frames</span><br><span class="line"></span><br><span class="line"><span class="bullet">* </span>异常 - Exceptions</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>一切准备就绪后，就可以进入真正的编码环节了。 由于实战编码篇幅太长，我决定放到下一期，这期的内容，读者们可能需要花费一些时间吸收。</p>
                  <h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1>
                  <p>开篇我强调了「创造能力」有多么重要，甚至抛出了一些不是很贴切的例子，但我就是想告诉你，不要做调参?。 然后我告诉你，本篇文章要讲解的是 WebSocket。 接着又跟你说，要掌握 WebSocket 协议，如果你无法独立啃完 RFC6455，还可以看我写过的几篇关于 WebSocket 文章和位运算文章。 过了几分钟，给你展示了 Socket 的通信过程，虽然没有强有力的依据，但你可以假设这是对的。 喝了一杯白开水之后，我向你展示了 Streams 的具体用法并为你解读代码的作用，重要的是将 Streams 与 Socket 通信过程进行了抽象。 这些前置条件都确定后，我又带着你草草地设计了 WebSocket 客户端的功能模块。 下一篇文章将进入代码实战环节，请做好环境（Python 3.6+）准备。</p>
                  <h2 id="总之，要想越过前面这座山，就请跟我来！"><a href="#总之，要想越过前面这座山，就请跟我来！" class="headerlink" title="总之，要想越过前面这座山，就请跟我来！"></a>总之，要想越过前面这座山，就请跟我来！</h2>
                  <hr>
                  <p>文章作者：「夜幕团队 NightTeam 」- 韦世东 夜幕团队成立于 2019 年，团队成员包括崔庆才、周子淇、陈祥安、唐轶飞、冯威、蔡晋、戴煌金、张冶青和韦世东。 涉猎的主要编程语言为 Python、Rust、C++、Go，领域涵盖爬虫、深度学习、服务研发和对象存储等。团队非正亦非邪，只做认为对的事情，请大家小心。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/NightTeam" class="author" itemprop="url" rel="index">NightTeam</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-09-20 01:14:47" itemprop="dateCreated datePublished" datetime="2019-09-20T01:14:47+08:00">2019-09-20</time>
                </span>
                <span id="/7542.html" class="post-meta-item leancloud_visitors" data-flag-title="如何将协议规范变成开源库系列文章之 WebSocket" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>6.5k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>6 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/7540.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 技术杂谈 <i class="label-arrow"></i>
                  </a>
                  <a href="/7540.html" class="post-title-link" itemprop="url">用 Docker 搭建商业级 4G 代理</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>时间过得真快，距离这个系列的上一篇文章《商业级4G代理搭建指南【准备篇】》发布的时间已经过了两个星期了，上个星期由于各种琐事缠身，周二开始就没空写文章了，所以就咕咕咕了。 那么在准备篇中，我们了解了一下搭建 4G 代理所需要的软硬件，也知道了各种选择的优劣势。现在，我们就可以开始实际搭建了，相信大家也是期待已久了。</p>
                  <hr>
                  <h4 id="基本思路"><a href="#基本思路" class="headerlink" title="基本思路"></a>基本思路</h4>
                  <p>从这篇文章的标题中我们可以看出，这一次的搭建方案主要用到的是 Docker，你可能会很好奇，Docker 跟搭建 4G 代理有什么关系吗？ 嗯，关系很大，我们把整件事情梳理一下，先来看看搭建 4G 代理时的基本流程：</p>
                  <ol>
                    <li>调用网卡拨号，拨号成功后会创建一个虚拟网卡。（正常情况下使用这个虚拟网卡就能上网了） <img src="https://oss.crawler-lab.com/%E5%95%86%E4%B8%9A%E7%BA%A74G%E4%BB%A3%E7%90%86%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97%E3%80%90%E6%90%AD%E5%BB%BA%E7%AF%87%E4%B9%8BDocker%E7%89%88%E3%80%91/asserts/1.png?x-oss-process=style/weixin" alt=""></li>
                    <li>在多网卡的情况下，重复第一步，会得到多个虚拟网卡。 <img src="https://oss.crawler-lab.com/%E5%95%86%E4%B8%9A%E7%BA%A74G%E4%BB%A3%E7%90%86%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97%E3%80%90%E6%90%AD%E5%BB%BA%E7%AF%87%E4%B9%8BDocker%E7%89%88%E3%80%91/asserts/2.png?x-oss-process=style/weixin" alt=""></li>
                    <li>启动代理服务器，使其使用虚拟网卡作为出网网卡，并使用接入内网的实体网卡作为入网网卡。 <img src="https://oss.crawler-lab.com/%E5%95%86%E4%B8%9A%E7%BA%A74G%E4%BB%A3%E7%90%86%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97%E3%80%90%E6%90%AD%E5%BB%BA%E7%AF%87%E4%B9%8BDocker%E7%89%88%E3%80%91/asserts/3.png?x-oss-process=style/weixin" alt="使用起来差不多是这样的"></li>
                  </ol>
                  <p>但是呢，有个问题，根据我之前的测试结果来看，目前在 Linux 环境下还没有一个 HTTP 代理服务器是可以做到分别指定出网网卡和入网网卡的，嗯…这就很麻烦了，因为如果我们无法这么做的话，就会出现类似于下面这样的问题：</p>
                  <ol>
                    <li>出网和入网都在虚拟网卡上，使用代理服务器必须要走公网访问。</li>
                    <li>入网为实体网卡，但出网被代理服务器锁定为了某一个，无法利用到多网卡。</li>
                  </ol>
                  <p>嗯…那么不用 HTTP 代理服务器，用那些经常被用来做一些骚操作的 Socks5 代理服务器呢？如果可以指定网卡的话，再用像 Privoxy 之类的工具把 Socks5 代理转成 HTTP 代理就好了。（某知名扶墙软件的 Windows 版本就是这么转的 HTTP 代理） 在经过一番尝试后，我发现虽然有些 Socks5 代理服务器的文档中是说可以指定网卡，但按照说明操作后，似乎并不能直接做到我想要的效果（要么还是锁定在某一个上面、要么上不了网），所以还是存在一些问题的。可能是需要配合路由表设置来进行操作吧，不过我对网络工程的了解不怎么深，搞了几天也没搞出来，于是乎还得想想别的办法。 <img src="https://oss.crawler-lab.com/%E5%95%86%E4%B8%9A%E7%BA%A74G%E4%BB%A3%E7%90%86%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97%E3%80%90%E6%90%AD%E5%BB%BA%E7%AF%87%E4%B9%8BDocker%E7%89%88%E3%80%91/asserts/4.png?x-oss-process=style/weixin_wushuiyin" alt=""> 这时候，我想到了一个东西——Docker，它可以用来解决这个问题！ 因为 Docker 容器被创建后，不管外界的网卡有多少个，容器内部的网卡都只会有一个Docker自己的虚拟网卡（容器间通信用的）和一个本地环回接口（不用管它），而且我们在容器内进行拨号操作时，产生的那个新的虚拟网卡也不会影响到外界或其他容器，这样的话，代理服务器就不需要指定网卡了，直接启动就能跑！ 那么现在整个流程就跑通了，进入实际操作环节看看吧！</p>
                  <hr>
                  <h4 id="系统方面"><a href="#系统方面" class="headerlink" title="系统方面"></a>系统方面</h4>
                  <p>这个 Docker 版的搭建方式，系统方面的选择很多，由于我使用的样例设备是树莓派，所以这里就选择使用了 Raspbian（树莓派专属版 Debian）。如果你使用的是其他设备的话，直接选择一个自己常用的系统就好。 那么准备好之后的第一步当然是先下载并安装 Docker，这里我直接使用 Docker 官方提供的一键安装脚本来进行安装：</p>
                  <figure class="highlight dsconfig">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="string">curl </span>-<span class="string">fsSL </span><span class="string">https:</span>//<span class="string">get.</span><span class="string">docker.</span><span class="string">com </span>-o <span class="built_in">get-docker.sh</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="string">sh </span><span class="built_in">get-docker.sh</span></span><br><span class="line"><span class="built_in">#</span> 出自官方文档：<span class="string">https:</span>//<span class="string">docs.</span><span class="string">docker.</span><span class="string">com/</span><span class="string">install/</span><span class="string">linux/</span><span class="string">docker-ce/</span><span class="string">debian/</span><span class="comment">#install-using-the-convenience-script</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这个一键安装脚本理论上来讲所有 Linux 发行版都可以使用，毕竟已经出来很长时间了，如果不行的话请自行使用搜索引擎查找相关资料。 装好 Docker 之后，你有两个选择：</p>
                  <ol>
                    <li>进入体验模式，了解一下具体操作细节是怎么样的。</li>
                    <li>不看这一段，翻到本文最下方直接使用我写好的轮子。</li>
                  </ol>
                  <h4 id="启动容器"><a href="#启动容器" class="headerlink" title="启动容器"></a>启动容器</h4>
                  <p>体验的话，我们就直接这么启动一个 Docker 容器吧，执行以下命令：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo docker run -it --rm --privileged -p <span class="number">3128</span>:<span class="number">3128</span> ubuntu:<span class="number">18.04</span> bash</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <blockquote>
                    <p>上面这条命令的意思是，启动一个内部系统为 Ubuntu18.04 的容器，并进入容器内部的 Shell 执行 <code>bash</code> 命令，如果退出 bash 就自动销毁容器；然后映射容器内的端口3128到外界，映射出来的外界端口也是3128；最后 <code>privileged</code> 参数是开启特权模式，用于将网卡设备映射进容器内。 如果下载镜像很慢的话，可以搜一下“Docker 加速器”，也可以直接扶墙。</p>
                  </blockquote>
                  <h4 id="测试一下网卡是否正常"><a href="#测试一下网卡是否正常" class="headerlink" title="测试一下网卡是否正常"></a>测试一下网卡是否正常</h4>
                  <p>进入容器内部后，我们可以执行一下 <code>ls /dev/ttyUSB*</code> 看一下网卡有没有正常被识别出来（在容器外也是一样的，因为开了特权模式），如果是和我买的同一款 4G 网卡的话，在只插入一张网卡的情况下你会看到4个 ttyUSB 设备。 <img src="https://oss.crawler-lab.com/%E5%95%86%E4%B8%9A%E7%BA%A74G%E4%BB%A3%E7%90%86%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97%E3%80%90%E6%90%AD%E5%BB%BA%E7%AF%87%E4%B9%8BDocker%E7%89%88%E3%80%91/asserts/5.png?x-oss-process=style/weixin" alt="插入了三张网卡的样子，一共12个 ttyUSB 设备"></p>
                  <blockquote>
                    <p>不同 4G 网卡和硬件组合可能会有差异，请以实际情况为准。</p>
                  </blockquote>
                  <p>如果你可以看到<code>4✖4G网卡个数</code>个 ttyUSB 设备的话，就说明没有问题，可以开始下一步了。</p>
                  <h4 id="拨号上网"><a href="#拨号上网" class="headerlink" title="拨号上网"></a>拨号上网</h4>
                  <p>接下来要做的就是拨号了，拨号方面可以选择使用 Wvdial 这种工具，也可以选择使用像 Fanconn 这样的商家提供的拨号脚本（直接调用 PPPD），使用起来的效果会有一些区别。如果商家没有提供拨号脚本的话，就用 Wvdial 吧，它能自动生成配置，上手即用。 我这边的话，由于 Fanconn 的技术人员直接提供了个拨号脚本，那我就用这个脚本了，Wvdial 的文档网上有很多很详尽的，这里就不再多提，需要的朋友自行搜索即可。 如果你用的是 Fanconn 的这个拨号脚本（怎么弄进容器内就不用我说了吧？），那么直接在 <code>apt install ppp</code> 安装好拨号工具之后，用 <code>chmod +x quectel-pppd.sh</code> 给拨号脚本加个运行权限，然后 <code>./quectel-pppd.sh /dev/ttyUSB3</code> 即可。</p>
                  <blockquote>
                    <p>拨号时使用的 <code>/dev/ttyUSB3</code> 是指 4G 网卡的第四个通信端口，文档中的解释为：ttyUSB3→For PPP connections or AT command communication，翻译一下就是用于 PPP 连接或 AT 命令通信。</p>
                  </blockquote>
                  <p>拨号之后用 ifconfig 之类的工具即可看到类似下图中的状态： <img src="https://oss.crawler-lab.com/%E5%95%86%E4%B8%9A%E7%BA%A74G%E4%BB%A3%E7%90%86%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97%E3%80%90%E6%90%AD%E5%BB%BA%E7%AF%87%E4%B9%8BDocker%E7%89%88%E3%80%91/asserts/6.png?x-oss-process=style/weixin" alt=""> 可以看到，如前文所述，现在有三个网卡，一个是 Docker 自己的、一个是本地环回接口（这个不用管）、一个是拨号产生的虚拟网卡。</p>
                  <blockquote>
                    <p>如果不是在 Docker 容器内使用的话，还会有个 wwan0（或其他名字），那个是 4G 网卡本体。</p>
                  </blockquote>
                  <h4 id="测试是否能正常上网"><a href="#测试是否能正常上网" class="headerlink" title="测试是否能正常上网"></a>测试是否能正常上网</h4>
                  <p>现在如果你用 curl 的 <code>\--interface</code> 参数指定虚拟网卡进行请求的话（如：<code>curl --interface ppp0 https://ip.cn</code>），是已经可以请求成功的了，IP 也会是你所使用的 SIM 卡对应的运营商分配的。</p>
                  <blockquote>
                    <p>由于 Docker 的镜像通常都是极度精简的，所以 Ubuntu 镜像里并没有预装像 net-tools、iputils-ping、vim、curl 之类的这些包，需要自行安装。所以如果你发现 ifconfig、ping、curl、vim 用不了，不要惊慌，这是正常现象，执行 <code>apt install 包名</code> 命令安装即可。</p>
                  </blockquote>
                  <p>如果你无法直接请求成功的话，就可能是 DNS 解析出问题了，可以尝试 ping 一个公网 IP（如：<code>ping 1.1.1.1</code>）和一个域名（如：<code>ping ip.cn</code>），如果 IP 能 ping 通但域名会报 DNS 解析失败的话，就可以确认是 DNS 设置问题了。 4G 拨号时如果出现 DNS 设置问题，通常是因为拨号工具没有正常地将运营商返回的 DNS 服务器设置写入到配置中，我们可以手动配置一下（你要强制指定某一个 DNS 也可以）：</p>
                  <figure class="highlight lsl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"># 以下为阿里云的公共DNS</span><br><span class="line">echo 'nameserver <span class="number">223.5</span><span class="number">.5</span><span class="number">.5</span>' &gt;&gt; /etc/resolv.conf</span><br><span class="line">echo 'nameserver <span class="number">223.6</span><span class="number">.6</span><span class="number">.6</span>' &gt;&gt; /etc/resolv.conf</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <blockquote>
                    <p>在 Docker 容器中，这个 <code>/etc/resolv.conf</code> 文件可能还会有两条内容，是容器本身所需要的，建议不要删除/覆盖，否则会出现容器间无法使用容器名互相通信的情况。</p>
                  </blockquote>
                  <h4 id="启动代理服务器"><a href="#启动代理服务器" class="headerlink" title="启动代理服务器"></a>启动代理服务器</h4>
                  <p>那么在测试拨号后确实可以通过 4G 网卡上网了之后，我们就可以把代理服务器启动了，这里我使用的是 TinyProxy。</p>
                  <blockquote>
                    <p>测试发现，Squid 对资源的占用更大一些，不利于多网卡情况下的使用，会影响到 4G 网卡的数量上限。</p>
                  </blockquote>
                  <p>先 <code>apt install tinyproxy</code> 一波，然后 <code>vim /etc/tinyproxy/tinyproxy.conf</code> 修改一下配置。 要修改的配置主要有：</p>
                  <ul>
                    <li>Port 配置项改为3128，因为我们前面映射出来的端口是3128。</li>
                    <li>Listen 配置项改为0.0.0.0，因为我们需要在其他设备上使用这个代理服务器。</li>
                    <li>Allow 配置项注释掉或改为0.0.0.0/0，默认的127.0.0.1会导致其他设备无法访问。</li>
                  </ul>
                  <p>改完之后保存一波，然后就可以直接执行 <code>tinyproxy</code> 启动了…吗？ 等等，还有一个操作要做！那就是将默认路由指向到虚拟网卡上，很简单，执行以下命令即可：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">route del -net 0.0.0.0 eth0</span><br><span class="line">route <span class="builtin-name">add</span> -net 0.0.0.0 ppp0</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这两条命令的意思是：先将默认的、指向 eth0 这个网卡的上网路由删除，然后添加一个同样的、指向 ppp0 这个网卡的路由。 改完默认路由后的效果就是，即使你不使用 curl 的 <code>\--interface</code> 参数，也能直接使用 4G 网卡上网了。</p>
                  <blockquote>
                    <p>如果没有改默认路由的话，在不指定网卡的情况下，4G 网卡并不会被使用到，因为默认路由指向的是 Docker 自身的虚拟网卡，那个网卡通向你原本的内网环境。也就是说，IP 不会变！</p>
                  </blockquote>
                  <p>那么现在，你可以执行 <code>tinyproxy</code> 启动代理服务器了。</p>
                  <h4 id="测试代理服务器"><a href="#测试代理服务器" class="headerlink" title="测试代理服务器"></a>测试代理服务器</h4>
                  <p>好了，代理服务器应该已经正常启动了，现在我们可以在另一个设备上尝试连接那个容器中的代理服务器，看看是否能正常通过它使用 4G 网卡上网。 例如我这里树莓派分配到的IP是：<code>192.168.137.66</code>，那么我就可以用这样的 curl 命令或 Python 代码进行测试： curl：</p>
                  <figure class="highlight gml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl <span class="string">"https://ip.cn"</span></span><br><span class="line">curl -<span class="symbol">x</span> <span class="string">"192.168.137.66:3128"</span> <span class="string">"https://ip.cn"</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>Python：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line">resp = requests.<span class="builtin-name">get</span>(<span class="string">"https://ip.cn"</span>, proxies=&#123;<span class="string">"https"</span>: <span class="string">"http://192.168.137.66:3128"</span>&#125;)</span><br><span class="line">no_proxy_resp = requests.<span class="builtin-name">get</span>(<span class="string">"https://ip.cn"</span>)</span><br><span class="line"><span class="builtin-name">print</span>(resp.text)</span><br><span class="line"><span class="builtin-name">print</span>(no_proxy_resp.text)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>测试出来的结果应该与前面在容器内部测试时的一致，在使用代理后 IP 就变成了运营商分配的基站 IP。</p>
                  <h4 id="更换-IP"><a href="#更换-IP" class="headerlink" title="更换 IP"></a>更换 IP</h4>
                  <p>那么最核心的问题来了，怎么更换 IP 呢？ 其实和使用那些拨号 VPS 架设代理服务器一样，我们只需要重新拨个号就能换 IP 了，直接 kill 掉 pppd 进程就可以让它断开拨号，断开后重新执行一遍拨号脚本就是重新拨号了。</p>
                  <blockquote>
                    <p>断开拨号方面 Fanconn 的技术人员也提供了一个脚本，同样在 <code>chmod +x quectel-ppp-kill</code> 赋予运行权限之后，执行 <code>./quectel-ppp-kill</code> 就可以了。</p>
                  </blockquote>
                  <p>但需要注意的是，蜂窝网络的拨号在断开后，IP 仍然会保留一段时间（具体多久不清楚，可能跟连接的基站也有关系），所以我们需要强制性地让网卡重新搜网。</p>
                  <blockquote>
                    <p>冷门小知识：手机上开启关闭飞行模式的效果就是重新搜网，通常只是关闭“移动数据”的话，效果是与断开拨号一致的。</p>
                  </blockquote>
                  <p>怎么做呢？很简单，就两行命令：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">AT+<span class="attribute">CFUN</span>=0</span><br><span class="line">AT+<span class="attribute">CFUN</span>=1</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>但注意哦，这是 AT 命令，不是 Linux 下的 Shell 命令，AT 命令是一种调制解调器命令语言，我们如果需要将它执行起来，需要这么做：</p>
                  <figure class="highlight jboss-cli">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">echo</span> <span class="string">"AT+CFUN=0"</span> &gt; <span class="string">/dev/ttyUSB2</span></span><br><span class="line"><span class="comment"># 中间间隔1秒左右</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"AT+CFUN=1"</span> &gt; <span class="string">/dev/ttyUSB2</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <blockquote>
                    <p>这里使用的 <code>/dev/ttyUSB2</code> 是指 4G 网卡的第三个通信端口，文档中的解释为：ttyUSB2→For AT command communication，与第四个通信端口类似，只是它不能用于 PPP 连接、只能用于 AT 命令通信而已。 不同样使用第四个通信端口的原因是那个端口有被占用的可能性，直接区分开最稳妥，本来网卡也就是提供了两个 AT 命令通信渠道的。</p>
                  </blockquote>
                  <p>在使网卡重新搜网后的几秒至十几/几十秒内的时间里，你无法正常拨号，需要等待它初始化完成后才可以拨号成功，具体等待时间以信号强度为准，我测试的时候通常5秒以内就可以了。 所以如果你在断开后一直拨号失败，不妨过一会儿再试。</p>
                  <hr>
                  <h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4>
                  <p>那么现在操作流程也跑通了，我们也了解到了整个的内部细节，最后要做的就是把每个网卡都分别分配一个容器，这样我们就能实现文章开头所提到的——“使用虚拟网卡作为出网网卡，并使用接入内网的实体网卡作为入网网卡”的效果了。 实际操作起来的话，就是把指定网卡的部分给配置化，然后在启动容器的时候传入就好了，使用 Docker 的容器环境变量相关设置可以很轻松地实现这个功能。 最后，我们可以以这个思路，构建一个 docker-compose 模板，模板的核心内容一是做个简易的4G网卡容器集群，二是启动个 Squid，用来聚合代理服务器，这样我们使用的时候只需要指定一个代理服务器就能随机更换了，操作起来更加方便。</p>
                  <hr>
                  <p>好了，上面就是 Docker 版搭建方式的思路和整个的搭建流程，如果你懒得看的话，直接用我写好的轮子也是可以的，只需要发送消息【Docker版4G代理】到公众号【NightTeam】即可。</p>
                  <h4 id="评价"><a href="#评价" class="headerlink" title="评价"></a>评价</h4>
                  <p>最后的最后，我给这个搭建方式打个评价吧。 这个搭建方式并不完美，因为变量太多，而且很多地方肯定不如系统级原生支持的那么稳定，长期使用可能会出现各种奇奇怪怪的问题。 然后 Docker 的资源占用其实挺高的，会浪费相当多的内存在启动容器上，如果只是两三个网卡还好，如果数量大一点的话，像树莓派2B 这种小内存的设备根本就扛不住。 另外代理服务器本身对资源的消耗也是比较高的，高频调用下对树莓派2B 的小 CPU 压力还是蛮大的，即使我对它的 CPU 进行了超频，在并发测试时也还是会出现轻松打满 CPU 的情况。 <strong>但是！截止目前，我还有两种基于路由器系统的搭建方案没写出来！所以…敬请期待后续的其他搭建方案（斜眼笑）。</strong></p>
                  <hr>
                  <p>文章作者：「夜幕团队 NightTeam」 - Loco 夜幕团队成立于 2019 年，团队包括崔庆才、周子淇、陈祥安、唐轶飞、冯威、蔡晋、戴煌金、张冶青和韦世东。 涉猎的编程语言包括但不限于 Python、Rust、C++、Go，领域涵盖爬虫、深度学习、服务研发、对象存储等。团队非正亦非邪，只做认为对的事情，请大家小心。 <img src="https://user-gold-cdn.xitu.io/2019/9/11/16d205d3a2367c2b?w=900&amp;h=383&amp;f=jpeg&amp;s=32674" alt=""></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/NightTeam" class="author" itemprop="url" rel="index">NightTeam</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-09-20 01:12:35" itemprop="dateCreated datePublished" datetime="2019-09-20T01:12:35+08:00">2019-09-20</time>
                </span>
                <span id="/7540.html" class="post-meta-item leancloud_visitors" data-flag-title="用 Docker 搭建商业级 4G 代理" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>5.9k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>5 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/7463.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 技术杂谈 <i class="label-arrow"></i>
                  </a>
                  <a href="/7463.html" class="post-title-link" itemprop="url">谈一谈博客的关注解锁文章功能</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>在这个互联网时代，拥有流量就仿佛于拥有了一切。 我大约在 2014 年底开了自己的个人博客，当时就是想自己记录点学习总结，一个是方便查阅，二是锻炼一下自己写总结或者文章的能力，最初就是记录一些日常生活、编程学习的小知识点什么的。 一次偶然的机会我接触了爬虫，当时用 Python 写爬虫的仿佛也不多，正好有一位学长有研究，我也就跟着他学了起来，学的时候也是自己总结，然后把一些文章发表到博客上，累积了十几篇左右。不知道是什么原因，渐渐地好像爬虫火了起来，Python 也火了起来，不知不觉地我发现我的博客慢慢地流量涨起来了，一天几百、几千一直到现在上万的浏览量，SEO 也逐渐好了起来，说实话我当时都没有想到，感觉还是不少运气成分在里面的。 两年前左右我开了一个公众号，开始在公众号上面发一些文章，自己也逐渐从博客转战到公众号上面了，因为公众号的环境总体来说还是很不错的，尤其是对原创作者来说非常友好，非常尊重原创。转载文章需要开白、原创命中和保护机制、洗稿检测、及时的投诉处理让越来越多的技术人员也转到公众号上来了。所以越来越多的技术开发者都拥有了自己的公众号，变成了一个人人公号的时代。这导致了一个什么结果？竞争日益激烈，读者的可选择范围太多了，大家的涨粉之路也走得越来越艰辛了。 同样地我也遭受着同样的苦恼，这时候我突然想起来，我似乎还有个博客呢？最近写文都专注于公众号，没太有心思打理自己博客了。我在想要是能够把我的博客流量转换到我的公众号上来该多好呢？一来我的博客读者可以关注到我的公号平时发的文章或通知，二来也着实能为自己的公号涨一点粉丝，这样该多好啊？ 思来想去我想到了一个法子，就是在浏览博客文章的时候，把后续内容的隐藏，留一个二维码，可以通过关注公众号解锁。 当时设想效果图就是这样子的： <img src="https://cdn.cuiqingcai.com/2019-09-14-154546.png" alt="image-20190914224503383"> 文章在某个位置会渐变隐藏，同时浮现一个公众号的样子，需要扫码才能解锁。这时候读者扫码自动关注了公号，博客文章也自然而然地解锁，这样博客的读者就自然关注到公号上面来了。</p>
                  <h2 id="功能要点"><a href="#功能要点" class="headerlink" title="功能要点"></a>功能要点</h2>
                  <p>一听到这样的法子，大家肯定就骂起来了，文章还要解锁来看？每篇文章都要解锁一遍吗？以后如果再打开还需要次次解锁吗？ 如果真的是这样，那我情愿不做这个功能，因为这太损伤「用户体验」了。为了尽量减少用户体验的损失，这个功能必须要满足以下几点：</p>
                  <ul>
                    <li>不要添加用户登录注册机制，一旦增加了这个机制，流程可能会大大复杂化，导致用户体验急剧下降。</li>
                    <li>不能每打开一个页面都要解锁一次，读者访问了我的博客，只需要一次解锁，即可全面解锁博客所有文章。</li>
                    <li>读者在关闭浏览器再重新打开浏览器浏览博客的时候，同样不能让读者再解锁一遍，要直接可看。</li>
                    <li>读者在手机或其他移动设备上不方便操作，手机站点禁止启用本功能。</li>
                  </ul>
                  <p>如果满足了这些条件，读者在一篇文章里面只要扫码解锁了一次，那么就可以永久解锁全站文章了，没有繁琐的登录注册功能，也不需要次次频繁解锁，这样用户体验就非常好了。 为了达成这个目的，我就开始开发这个功能了。</p>
                  <h2 id="识别用户"><a href="#识别用户" class="headerlink" title="识别用户"></a>识别用户</h2>
                  <p>那么怎么来实现呢？要实现上面的功能，其实最重要的就是来识别是哪一个用户，也就是说，我怎么知道到底是谁在浏览我的博客呢？我怎么来专门针对这个用户解锁呢？ 有的同学可能说那就用 IP 地址呗，技术角度是可以实现的，但是其实仔细想想，用 IP 地址是很不友好的。一来是很多用户可能都是内网的 IP 地址，多个公户共享一个公网 IP 地址，所以假如两台设备接入了同一个公网 IP，我是无法判断到底解锁哪一台设备的。二来是，如果一个用户换了其他的地方或者用了 VPN，IP 地址变了，原本解锁的设备又变成非解锁状态了。这样也不好。 那么最方便简单的用来标识一个浏览设备的东西是什么？当然是 Cookies。Cookies 里面保存了浏览网页时自动生成的 Session ID，而且每一个用户都是不一样的，这样不就可以来唯一标识一台浏览设备了吗？</p>
                  <h2 id="解锁逻辑"><a href="#解锁逻辑" class="headerlink" title="解锁逻辑"></a>解锁逻辑</h2>
                  <p>好，那有了用户的 ID，我怎么才能把用户 ID 和我的公众号关联起来呢？当然是把这个 ID 发到公众号后台，我来存起来就好了。然后博客这边定时检测我这边有没有把这个 ID 保存，如果保存了，那就呈现解锁状态，如果没有保存，那就呈现非解锁状态。 最开始我就设想，既然公众号要扫码关注，那么我能不能把这个 ID 也糅到二维码里面呢？这样关注公众号的时候既能查询到公众号，有传递过来一个 ID 作为参数，然后后台处理一下存起来就好了。 你别说还真有这个功能，我在微信平台官方文档里面查询到了一个「生成带参数的公众号二维码」，生成的二维码里面可以指定任意的参数，然后生成的二维码图案就是公众号的二维码，然后处理一下关注公众号的回调函数就可以执行某一些操作了。看到之后我就想起来了很多关注公众号自动登录的功能就是这么做的。 但是经过一系列操作，发现了一个很悲伤的事情，只有服务号才有这个功能，我一小小的订阅号，是没有这个权限的，不能生产带参数的二维码。哎，难道凉了吗？ 不，没有，既然这个参数不能通过二维码传递，那就只好麻烦读者手动把这 ID 输入到我的公众号了，我的小小的订阅号还是有处理消息的功能的。我的公众号后台接收到消息，然后处理下这个消息 ID，然后存起来，那不就好了吗？ 说干就干！</p>
                  <h2 id="隐藏文章"><a href="#隐藏文章" class="headerlink" title="隐藏文章"></a>隐藏文章</h2>
                  <p>怎么开始做呢？那就从隐藏文章开始做吧。首先这个隐藏不能是真正的后台的隐藏，需要在前台隐藏。如果是后台隐藏的话，搜索引擎所能爬到的我的网站内容就会缺失了，会影响 SEO 的。所以只需要前台 CSS 隐藏一下就好了。 怎样看起来隐藏得比较自然呢？就取文章的的一半的地方，把文章的下面部分用 CSS 藏起来，然后加个渐变效果就好了。 比如要隐藏一半的内容吧，首先可以获取文章区块的高度，然后把文章页面高度用 CSS 强制设置为原来的一半就好了，这个很好操作，然后再在最底下加个渐变的样子，仿佛底下还有文字的样子。 这个 CSS 用 background 属性就能实现了，参考代码如下：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-id">#locker</span> &#123;</span><br><span class="line">        <span class="attribute">height</span>: <span class="number">240px</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">-webkit-gradient</span>(linear, <span class="number">0</span> top, <span class="number">0</span> bottom, from(rgba(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0</span>)), <span class="built_in">to</span>(#fff));</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里就是设置个 240 像素的区块，然后从上面到下面是透明度渐变颜色就好了，整体效果是下面这个样子： <img src="https://cdn.cuiqingcai.com/2019-09-14-151650.png" alt="image-20190914231647956"> 好，既然隐藏了，那么下面就加个提示吧，把公众号的二维码先放上，然后把那个 Session ID 放上，提示用户关注公众号后发送这个 ID 就能解锁了，但这个 ID 又不能太长，多少呢？六位吧那就。 类似做成这样的样子： <img src="https://cdn.cuiqingcai.com/2019-09-14-151807.png" alt="image-20190914231805506"> 好，那么这个 ID 怎么获取的呢？ 刚才说了，从 Cookies 里面获取就行了，找那个能够标识 Session ID 的一个 Cookies 字段，然后摘取其值的其中几位就行了，摘取的位置也有讲究，前几位仿佛重复率很高的样子，后面几位几乎不重复，那就截取最后六位数字吧。 好，然后我就在博客里面加了这么一点 JavaScript 代码来实现这个 ID 的提取：</p>
                  <figure class="highlight xquery">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">function</span> getCookie<span class="built_in">(name</span>) &#123;</span><br><span class="line">  var <span class="keyword">value</span> = <span class="string">"; "</span> +<span class="built_in"> document</span>.cookie;</span><br><span class="line">  var parts = <span class="keyword">value</span>.split(<span class="string">"; "</span> +<span class="built_in"> name</span> + <span class="string">"="</span>);</span><br><span class="line">  <span class="keyword">if</span> (parts.length == <span class="number">2</span>) <span class="keyword">return</span> parts.pop().split(<span class="string">";"</span>).shift();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> getToken() &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="keyword">value</span> = getCookie(<span class="string">'UM_distinctid'</span>)</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">value</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> defaultToken</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">value</span><span class="built_in">.substring</span>(<span class="keyword">value</span>.length - <span class="number">6</span>).toUpperCase()</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里 getCookie 方法是用某个名字获取一个 Cookies 字段，getToken 方法是截取了 Cookies 这个字段值的后六位并做了大写处理。 这里我的一个可以用来标识 Session ID 的 Cookies 字段叫做 UM_distinctid，就用它了。 这样一来，每个用户浏览的时候就能生成这样的一个 ID 了，六位的。 胜利似乎越来越近了。</p>
                  <h2 id="持久化存储"><a href="#持久化存储" class="headerlink" title="持久化存储"></a>持久化存储</h2>
                  <p>这里就又遇到一个问题，刚才不是说还要在用户关闭浏览器之后再重新打开，依然能保持解锁状态吗？这就要求这个 ID 在用户关闭又打开浏览器的时候是不变的。 这个怎么解？很简单，反正已经是从 Cookies 里面读了，这个 Cookies 持久化就行了，只要不在浏览器关闭后清除就行了，怎么办？设置个过期时间就好。 由于我的站点是 WordPress 做的，所以这个功能自动有了，如果没有的话用一些插件也能实现的。</p>
                  <h2 id="公众号处理"><a href="#公众号处理" class="headerlink" title="公众号处理"></a>公众号处理</h2>
                  <p>好，现在 ID 也有了，用户扫码把这个 ID 发到公众号后台就行了吧，然后公众号对接开发者模式处理一下就好了。 这里就其实就很简单了，其实仅仅就是把用户的 OpenID 和这个码存到了一个数据库里面。我后台是用 Django 写的，所以用了 Django 里面的 Model，实现逻辑如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">unlock</span><span class="params">(source, target, content)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    解锁博客</span></span><br><span class="line"><span class="string">    :param target: 微信平台</span></span><br><span class="line"><span class="string">    :param source: 用户</span></span><br><span class="line"><span class="string">    :param content: 用户发来的码</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    Unlock.objects.get_or_create(openid=source, token=content.upper())</span><br><span class="line">    <span class="keyword">return</span> reply_text(source, target, <span class="string">'恭喜您已经解锁博客全部文章~'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>就是这么两行，插入了一条数据，然后返回了一个信息提示。 插入之后怎么办呢？博客得知道我已经把这条数据插入进来了呀？那就再提供一个 API 查询吧，实现如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_locked</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    判断是否已经解锁</span></span><br><span class="line"><span class="string">    :param request: 包含token的请求</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    token = request.GET.get(<span class="string">'token'</span>)</span><br><span class="line">    result = Unlock.objects.filter(token=token.upper()).first()</span><br><span class="line">    <span class="keyword">return</span> JsonResponse(&#123;</span><br><span class="line">        <span class="string">'locked'</span>: <span class="literal">False</span> <span class="keyword">if</span> result <span class="keyword">else</span> <span class="literal">True</span></span><br><span class="line">    &#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>把这个方法对接一个 API 接口，比如 <code>/api/locked?token=xxxxx</code>，就可以知道是否解锁了。 所以，在公众号后台我就用开发者模式对接了这么两个功能，一个用来存，一个用来查。只要用户发送了这个能够用来表示自己浏览设备的码，我就存下来，然后博客定时请求这个 API 查询状态，如果返回结果是未解锁状态，那就继续锁住，如果是解锁状态。那就把博客解开。</p>
                  <h2 id="博客端处理"><a href="#博客端处理" class="headerlink" title="博客端处理"></a>博客端处理</h2>
                  <p>那么博客端具体怎么来处理呢？就基本的轮询就好了，定时几秒查一次 API，然后把这个码当做参数传过去，然后根据查询结果执行解锁或非解锁操作就好了。 核心代码如下：</p>
                  <figure class="highlight arcade">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">(articleSelector).ready(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> articleElement = $(articleSelector)[<span class="number">0</span>]</span><br><span class="line">  <span class="keyword">if</span> (articleElement) &#123;</span><br><span class="line">    <span class="keyword">var</span> height = articleElement.clientHeight</span><br><span class="line">    <span class="keyword">var</span> halfHeight = height * <span class="number">0.3</span></span><br><span class="line">    <span class="keyword">var</span> token = getToken()</span><br><span class="line">    $(<span class="string">'#locker'</span>).find(<span class="string">'.token'</span>).text(token)</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">detect</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      $.ajax(&#123;</span><br><span class="line">        url: <span class="string">'https://weixin.cuiqingcai.com/api/locked/'</span>,</span><br><span class="line">        method: <span class="string">'GET'</span>,</span><br><span class="line">        data: &#123;</span><br><span class="line">          token: token</span><br><span class="line">        &#125;,</span><br><span class="line">        success: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (data.locked === <span class="literal">true</span> || data.locked === <span class="literal">false</span>) &#123;</span><br><span class="line">            locked = data.locked</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        error: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">          locked = <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里就用基本的 jQuery 实现的，其实就是调了个 Ajax，也没啥高深的技巧。这里唯一值得注意的一点设计就是，如果 API 请求失败，这基本上证明我的 API 服务挂掉了，这里就需要把 locked 设置为 false，证明为解锁状态。这样，万一我的 API 后台挂了，博客会直接是解锁状态，这样就避免了读者永远无法解锁了。这是一个细节上的设计。 至此，一些技术上的问题就基本解决了。</p>
                  <h2 id="手机端处理"><a href="#手机端处理" class="headerlink" title="手机端处理"></a>手机端处理</h2>
                  <p>最后回过头来看看，那个需求还没有满足？ 读者在手机或其他移动设备上不方便操作，手机站点禁止启用本功能。那么怎么实现呢？很简单，判断一下浏览器的 User-Agent 就好了，这里实现了一个判断是否是 PC 的方法：</p>
                  <figure class="highlight arcade">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">var</span> os = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> ua = navigator.userAgent,</span><br><span class="line">    isWindowsPhone = <span class="regexp">/(?:Windows Phone)/</span>.test(ua),</span><br><span class="line">    isSymbian = <span class="regexp">/(?:SymbianOS)/</span>.test(ua) || isWindowsPhone,</span><br><span class="line">    isAndroid = <span class="regexp">/(?:Android)/</span>.test(ua),</span><br><span class="line">    isFireFox = <span class="regexp">/(?:Firefox)/</span>.test(ua),</span><br><span class="line">    isChrome = <span class="regexp">/(?:Chrome|CriOS)/</span>.test(ua),</span><br><span class="line">    isTablet = <span class="regexp">/(?:iPad|PlayBook)/</span>.test(ua) || (isAndroid &amp;&amp; !<span class="regexp">/(?:Mobile)/</span>.test(ua)) || (isFireFox &amp;&amp; <span class="regexp">/(?:Tablet)/</span>.test(ua)),</span><br><span class="line">    isPhone = <span class="regexp">/(?:iPhone)/</span>.test(ua) &amp;&amp; !isTablet,</span><br><span class="line">    isPc = !isPhone &amp;&amp; !isAndroid &amp;&amp; !isSymbian;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    isTablet: isTablet,</span><br><span class="line">    isPhone: isPhone,</span><br><span class="line">    isAndroid: isAndroid,</span><br><span class="line">    isPc: isPc</span><br><span class="line">  &#125;</span><br><span class="line">&#125;()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样一来，调用 os.isPC 就可以知道当前浏览器是不是手机浏览器了。 在处理的时候加上这个条件判断，就可以实现手机功能的解除了。</p>
                  <h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2>
                  <p>可能大家想知道效果是如何的，这里就截图看看了，现在这个功能已经在我的博客 cuiqingcai.com 上线了，大家可以进去体验一下。 首先进去文章是这个样子的： <img src="https://cdn.cuiqingcai.com/2019-09-14-154238.png" alt="image-20190914234237147"> 然后关注了公号，发送了代码： <img src="https://cdn.cuiqingcai.com/2019-09-14-154422.png" alt="image-20190914234421831"> 发送完毕之后，大约一两秒之后，抬头看看博客，就是这个样子了： <img src="https://cdn.cuiqingcai.com/2019-09-14-154408.png" alt="image-20190914234406442"> 这已经就完成了解锁和转化，读者可以全站永久解锁我的博客文章，我也增长了粉丝。 现在过一段时间就会有读者发来代码解锁，同时成为了我的粉丝，订阅号助手看到消息如下： <img src="https://cdn.cuiqingcai.com/2019-09-14-154721.png" alt="image-20190914234720018"> 以上便是这个博客转化的思路分享和实现，大家也可以到我的博客体验一下，谢谢！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-09-15 00:00:19" itemprop="dateCreated datePublished" datetime="2019-09-15T00:00:19+08:00">2019-09-15</time>
                </span>
                <span id="/7463.html" class="post-meta-item leancloud_visitors" data-flag-title="谈一谈博客的关注解锁文章功能" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>6.2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>6 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/7447.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 技术杂谈 <i class="label-arrow"></i>
                  </a>
                  <a href="/7447.html" class="post-title-link" itemprop="url">今天，大佬云集的夜幕团队正式成立了！</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>今天这篇文章是要告诉你，业内多名实力强劲的开发者组建了一个服务于广大开发者的团队。现在，你可能会有下面这些疑问：</p>
                  <ul>
                    <li>为什么要组成团队呢？</li>
                    <li>这个团队将会给广大开发者带来什么？</li>
                    <li>团队成员有哪些？</li>
                  </ul>
                  <p>好了，接下来用 3 分钟时间去了解这个团队吧！</p>
                  <h3 id="夜幕团队简介"><a href="#夜幕团队简介" class="headerlink" title="夜幕团队简介"></a>夜幕团队简介</h3>
                  <p>夜幕团队 NightTeam 于 2019 年 9 月 9 日正式成立，团队由爬虫领域中实力强劲的多名开发者组成：崔庆才、周子淇、陈祥安、唐轶飞、冯威、蔡晋、戴煌金、张冶青和韦世东。 NightTeam 涉猎的编程语言包括但不限于 Python、Rust、C++、Go，领域涵盖爬虫、深度学习、服务研发和对象存储等，团队技术实力十分雄厚。</p>
                  <p><img src="https://pic1.zhimg.com/80/v2-61dd30339bf8ce2bbe775c51b1339d44_hd.jpg" alt=""></p>
                  <h3 id="为什么要组建一个团队？"><a href="#为什么要组建一个团队？" class="headerlink" title="为什么要组建一个团队？"></a>为什么要组建一个团队？</h3>
                  <p>据以往经验来看，产出一篇优质的技术文章所耗费的时间是相当长的，读者很难从单个作者那里获得成体系且覆盖面较广的知识。 对于作者而言，粉丝的积累、文章的持续编写都是一个慢跑的过程，很多优秀的作者会因为没有粉丝、投入产出比差距太大等因素暂停写作。 更有甚者，文章内容质量越来越低、标题越来越唬、广告越来越多，一门心思放在如何涨粉和变现上。如此循环，就会影响技术圈和技术生态的发展。 如果将那些优秀的作者联合起来（即合纵连横），共同运营一系列的技术媒体号，在不增加负担的情况下还能保证优质文章的产出，会怎么样呢？</p>
                  <p><img src="https://pic4.zhimg.com/80/v2-6aabf56efac5d50da23dc660ad72fe1b_hd.jpg" alt=""></p>
                  <p>我们也不知道，但是我们已经意识到了这个问题，也尝试着寻找答案。这就是夜幕团队 NightTeam 组建的大环境背景。</p>
                  <h3 id="团队希望做什么事？"><a href="#团队希望做什么事？" class="headerlink" title="团队希望做什么事？"></a>团队希望做什么事？</h3>
                  <p>互联网是开放的，技术也是开放的。适当的共享可以加速我们的进步，无论是作者还是读者，都能够从分享的过程中获得一些东西。</p>
                  <p><img src="https://pic1.zhimg.com/80/v2-3f85ec0502edafca985cc1f8db399e30_hd.jpg" alt=""></p>
                  <p>在开发中，我们会用到一些库和框架。当我刚编程入门的时候，就想着有一天也要编写开源项目，为其他开发者提供帮助，这正是夜幕团队想要做的事。 当然，我们想要做的不仅仅是编写一个开源项目，我们更希望将知识分享出去，在技术圈中传播开来，让更多的人得到帮助。</p>
                  <h3 id="团队能够为开发者带来什么？"><a href="#团队能够为开发者带来什么？" class="headerlink" title="团队能够为开发者带来什么？"></a>团队能够为开发者带来什么？</h3>
                  <p>读者的能力和阶段各不相同，每个人收获的内容也不同。宽泛来说，读者可以从夜幕团队 NightTeam 输出的内容中获得对待问题的处理方式、分析问题的思路、解决问题的技巧、问题背后的逻辑等。 假如你是一名中级爬虫工程师，那么夜幕团队 NightTeam 输出的内容可能会为你解决工作中遇到的一些反爬虫问题带来思路。</p>
                  <p><img src="https://pic1.zhimg.com/80/v2-6660c7d888e868dc1fc55caaa3a98938_hd.jpg" alt=""></p>
                  <p>如果你是一名后端开发者，你也许会从我们发布的类似于【动图演示 - Redis 持久化 RDB/AOF 详解与实践】这样的文章中了解到 Redis 持久化的两种选择的差异和具体操作过程。</p>
                  <h3 id="团队以什么形式输出内容？"><a href="#团队以什么形式输出内容？" class="headerlink" title="团队以什么形式输出内容？"></a>团队以什么形式输出内容？</h3>
                  <p>大多数情况下，我们会用文章的形式输出内容。但有时候也会采用直播或者视频教程的方式，兴许还会有现场交流的机会。 为了增加传播广度和影响力，我们不仅仅在微信公众号上发布文章，还会将文章同步到业内著名的几个平台，例如掘金社区、CSDN、SF、V2EX、知乎、今日头条等。</p>
                  <h3 id="团队成员介绍"><a href="#团队成员介绍" class="headerlink" title="团队成员介绍"></a>团队成员介绍</h3>
                  <p>团队的成员都是爬虫领域比较活跃的作者，同时也拥有非常强的实力，不会是那些只负责回答小白问题骗钱的盗名之辈。以下将不分先后的列出团队成员姓名、昵称和各自的介绍。 周子淇</p>
                  <blockquote>
                    <p>昵称 Loco 前微信公众号「小周码字」号主、知乎专栏「手把手教你写爬虫」作者，幂度爬虫工程师。啥方向都搞，除了爬虫相关的文章以外还会写一些灰黑产操作研究、机器学习、造轮子、物联网设备研究、脑洞分享等各种奇奇怪怪的东西。</p>
                  </blockquote>
                  <p>韦世东</p>
                  <blockquote>
                    <p>昵称 Asyncins 图灵签约作者、电子工业出版社约稿作者、华为云认证云享专家、掘金社区优秀作者、GitChat 认证作者、搜狐产品技术约稿作者、开源项目 aiowebsocket 作者、微信公众号「Rust之禅」号主、「进击的Coder」运营者之一，有着丰富的爬虫经验，擅长反爬虫的绕过技巧。</p>
                  </blockquote>
                  <p>崔庆才</p>
                  <blockquote>
                    <p>昵称 静觅 畅销书《Python3网络爬虫开发实战》作者、微信公众号「进击的Coder」号主，微软中国工程师。主要研究网络爬虫、机器学习、Web 开发相关内容。</p>
                  </blockquote>
                  <p>陈祥安</p>
                  <blockquote>
                    <p>昵称 CXA 微信公众号「Python学习开发」号主、CSDN 线下沙龙特邀讲师、华为云享社区专家、阿里云栖社区专家、哔哩哔哩《陈祥安分析Python面试题》系列 UP 主、GitChat 热门文章《Python 常见的 170 道面试题全解析：2019 版》作者，马蜂窝高级爬虫工程师。</p>
                  </blockquote>
                  <p>唐轶飞</p>
                  <blockquote>
                    <p>昵称 大鱼 BruceDone 微信公众号「大鱼鱼塘」号主、「<a href="https://link.zhihu.com/?target=http%3A//brucedone.com">http://brucedone.com</a>」站长，腾讯后端工程师。多年 Code 经验，擅长后端开发，语言了解但不限于 .NET、Python、Golang、SQL，兴趣包含但不限于爬虫，后端，数据库，深度学习。</p>
                  </blockquote>
                  <p>冯 威</p>
                  <blockquote>
                    <p>昵称 妄为 微信公众号「妄为写代码」号主，爬虫 Coder，佛系程序员。专注 JavaScript、Android 逆向以及验证码破解，对逆向有着丰富的经验。</p>
                  </blockquote>
                  <p>蔡 晋</p>
                  <blockquote>
                    <p>昵称 悦来客栈的老板 微信公众号「菜鸟学Python编程」号主，平时喜欢研究各大网站的反爬，熟悉常见网站的反爬操作，对反爬有着独到的见解。</p>
                  </blockquote>
                  <p>戴煌金</p>
                  <blockquote>
                    <p>昵称 咸鱼 微信公众号「咸鱼学Python」号主、华为云享专家。专注Python爬虫、JavaScript逆向，立志做一条最咸的咸鱼。</p>
                  </blockquote>
                  <p>张冶青</p>
                  <blockquote>
                    <p>昵称：MarvinZ 微信公众号「Crawlab漫游指南」号主、爬虫管理平台 Crawlab 作者、文章发布平台 ArtiPub 作者，知名外企前端开发工程师。专注前端、爬虫和数据分析。</p>
                  </blockquote>
                  <h3 id="如何与夜幕取得联系？"><a href="#如何与夜幕取得联系？" class="headerlink" title="如何与夜幕取得联系？"></a>如何与夜幕取得联系？</h3>
                  <p>你可能想跟夜幕团队交流一些技术方面的问题，你可以发送消息“夜幕读者群”到我们的公众号「NightTeam」加入读者群，团队成员都在群里等你。 一些重要的事可以通过邮件与夜幕取得联系，夜幕团队的邮箱为 contact@nightteam.cn。 GitHub 也准备好了，我们会逐渐将开源项目迁移到团队的仓库中，地址为 <a href="https://link.zhihu.com/?target=https%3A//github.com/nightteam">https://github.com/nightteam</a></p>
                  <p><img src="https://pic2.zhimg.com/80/v2-259f9f2796f2bcc2980cefc49ed237d5_hd.jpg" alt=""></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-09-12 12:25:31" itemprop="dateCreated datePublished" datetime="2019-09-12T12:25:31+08:00">2019-09-12</time>
                </span>
                <span id="/7447.html" class="post-meta-item leancloud_visitors" data-flag-title="今天，大佬云集的夜幕团队正式成立了！" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.4k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/7436.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 技术杂谈 <i class="label-arrow"></i>
                  </a>
                  <a href="/7436.html" class="post-title-link" itemprop="url">爬虫智能解析库 Readability 和 Newspaper 的用法</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>舆情爬虫是网络爬虫一个比较重要的分支，舆情爬虫往往需要爬虫工程师爬取几百几千个新闻站点。比如一个新闻页面我们需要爬取其标题、正文、时间、作者等信息，如果用传统的方式来实现，每一个站点都要配置非常多的规则，如果要维护一个几百上千的站点，那人力成本简直太高了。 如果有一种方式可以在保证差不多的准确率的前提下，大幅提高提取效率的话，就需要用到智能文本提取了。 本文首先介绍一下智能文本提取的基本原理，让大家对智能提取有基本的了解。然后介绍几个比较基础的工具包，准确率并不是很高，可以尝试一用。最后再介绍几篇比较前沿的技术供大家参考。</p>
                  <h2 id="智能文本提取"><a href="#智能文本提取" class="headerlink" title="智能文本提取"></a>智能文本提取</h2>
                  <p>目前来说，智能文本提取可以分为三类：</p>
                  <ul>
                    <li>基于网页文档内容的提取方法</li>
                    <li>基于 DOM 结构信息的提取方法</li>
                    <li>基于视觉信息的提取方法</li>
                  </ul>
                  <p>基于网页文档的提取方法将 HTML 文档视为文本进行处理，适用于处理含有大量文本信息且结构简单易于处理的单记录网页，或者具有实时要求的在线分析网页应用。 这种方式主要利用自然语言处理相关技术实现，通过理解 文本语义、分析上下文、设定提取规则等，实现对大段网页文档的快速处理。其中，较为知名的方法有 TSIMMIS、Web-OQL、Serrano、FAR-SW 和 FOREST，但这些方法由于通常需要人工的参与，且存在耗时长、效率低的弊端。 基于 DOM 结构信息的方法将 HTML 文档解析为相应的 DOM 树，然后根据 DOM 树的语法结构创建提取规则， 相对于以前的方法而言有了更高的性能和准确率。 W4F 和 XWRAP 将 HTML 文档解析成 DOM 树，然后通过组件化引导用户通过人工选择或者标记生成目标包装器代码。Omini、IEPAD 和 ITE 提取 DOM 树上的关键路径， 获取其中存在的重复模式。MDR 和 DEPTA 挖掘了页面中的数据区域，得到数据记录的模式。CECWS 通过聚类算法从数据库中提取出自同一网站的一组页面，并进行 DOM 树结构的对比，删除其中的静态部分，保留动态内容作为信息提取的结果。虽然此类方法相对于上一类方法 具有较高的提取精度，且克服了对大段连续文本的依赖， 但由于网页的 DOM 树通常较深，含有大量 DOM 节点， 因此基于 DOM 结构信息的方法具有较高的时间和空间消耗。目前来说，大部分原理还是基于 DOM 节点的文本密度、标点符号密度等计算的，其准确率还是比较可观的。今天所介绍的 Readability 和 Newspaper 的库的实现原理就是类似。 目前比较先进的是基于视觉信息的网页信息提取方法，通过浏览器接口或者内核对目标网页预渲染，然后基于网页的视觉规律提取网页数据记录。经典的 VIPS 算法首先从 DOM 树中提取出所有合适的页面区域，然后根据这些页面和分割条重新构建 Web 页面的语义结构。作为对 VIPS 的拓展，ViNT、ViPER、ViDE 也成功利用了网页的视觉特征来实现数据提取。CMDR 为通过神经网络学习多记录型页面中的特征，结合基于 DOM 结构信息的 MDR 方法，挖掘社区论坛页面的数据区域。与上述方法不同，VIBS 将图像领域的 CNN 卷积神经网络运用于网页的截图，同时通过类 VIPS 算法生成视觉块，最后结合两个阶段的结果识别网页的正文区域。另外还有最新的国内提出的 VBIE 方法，基于网页视觉的基础上改进，可以实现无监督的网页信息提取。</p>
                  <blockquote>
                    <p>以上内容主要参考自论文：《王卫红等：基于可视块的多记录型复杂网页信息提取算法》，算法可从该论文参考文献查阅。</p>
                  </blockquote>
                  <p>下面我们来介绍两个比较基础的工具包 Readability 和 Newspaper 的用法，这两个包经我测试其实准确率并不是很好，主要是让大家大致对智能解析有初步的理解。后面还会介绍一些更加强大的智能化解析算法。</p>
                  <h2 id="Readability"><a href="#Readability" class="headerlink" title="Readability"></a>Readability</h2>
                  <p>Readability 实际上是一个算法，并不是一个针对某个语言的库。其主要原理就是计算了 DOM 的文本密度，另外根据一些常见的 DOM 属性如 id、class 等计算了一些 DOM 的权重，最后分析得到了对应的 DOM 区块，进而提取出具体的文本内容。 现在搜索 Readability 其实已经找不到了，取而代之的是一个 JavaScript 工具包，叫做 mercury-parser，据我所知应该是 Readability 不维护了，换成了 mercury-parser。后者现在也做成了一个 Chrome 插件，大家可以下载使用一下。 回归正题，这次主要介绍的是 Python 的 Readability 实现，现在其实有很多开源版本，本文选取的是 <a href="https://github.com/buriy/python-readability，是基于最早的" target="_blank" rel="noopener">https://github.com/buriy/python-readability，是基于最早的</a> Python 版本的 Readability 库 <a href="https://github.com/timbertson/python-readability" target="_blank" rel="noopener">https://github.com/timbertson/python-readability</a> 二次开发的，现在已经发布到了 PyPi，大家可以直接下载安装使用。 安装很简单，通过 pip 安装即可：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> readability-lxml</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>安装好了之后便可以通过导入 readability 使用了，下面我们随便从网上找一个新闻页面，比如：<a href="https://tech.163.com/19/0909/08/EOKA3CFB00097U7S.html，其页面截图如下" target="_blank" rel="noopener">https://tech.163.com/19/0909/08/EOKA3CFB00097U7S.html，其页面截图如下</a>： <img src="https://cdn.cuiqingcai.com/2019-09-09-125723.png" alt="页面示例"> 我们的目的就是它的正文、标题等内容。下面我们用 Readability 试一下，示例如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"><span class="keyword">from</span> readability import Document</span><br><span class="line"></span><br><span class="line">url = <span class="string">'https://tech.163.com/19/0909/08/EOKA3CFB00097U7S.html'</span></span><br><span class="line">html = requests.<span class="builtin-name">get</span>(url).content</span><br><span class="line">doc = Document(html)</span><br><span class="line"><span class="builtin-name">print</span>(<span class="string">'title:'</span>, doc.title())</span><br><span class="line"><span class="builtin-name">print</span>(<span class="string">'content:'</span>, doc.summary(<span class="attribute">html_partial</span>=<span class="literal">True</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里我们直接用 requests 库对网页进行了请求，获取了其 HTML 页面内容，赋值为 html。 然后引入了 readability 里的 Document 类，使用 html 变量对其进行初始化，然后我们分别调用了 title 方法和 summary 方法获得了其标题和正文内容。 这里 title 方法就是获取文章标题的，summary 就是获取文章正文的，但是它获取的正文可能包含一些 HTML 标签。这个 summary 方法可以接收一个 html_partial 参数，如果设置为 True，返回的结果则不会再带有 <code>&lt;html&gt;&lt;body&gt;</code> 标签。 看下运行结果：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">title: 今年iPhone只有小改进？分析师：还有其他亮点_网易科技</span><br><span class="line">content: <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"post_text"</span> <span class="attr">id</span>=<span class="string">"endText"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"otitle"</span>&gt;</span></span><br><span class="line">                        （原标题：Apple Bets More Cameras Can Keep iPhone Humming）</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"f_center"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">alt</span>=<span class="string">"今年iPhone只有小改进？分析师：还有其他亮点"</span> <span class="attr">src</span>=<span class="string">"http://cms-bucket.ws.126.net/2019/09/09/d65ba32672934045a5bfadd27f704bc1.jpeg"</span>/&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>图示：苹果首席执行官蒂姆·库克(Tim Cook)在6月份举行的苹果全球开发者大会上。<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>网易科技讯 9月9日消息，据国外媒体报道，和过去的12个年头一样，新款</span><br><span class="line">... 中间省略 ...</span><br><span class="line">                    <span class="tag">&lt;<span class="name">p</span>&gt;</span>苹果还即将推出包括电视节目和视频游戏等内容的新订阅服务。分析师表示，该公司最早可能在本周宣布TV+和Arcade等服务的价格和上线时间。<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span>Strategy Analytics的尼尔·莫斯顿(Neil Mawston)表示，可穿戴设备和服务的结合将是苹果业务超越iPhone的关键。他说，上一家手机巨头诺基亚公司在试图进行类似业务转型时就陷入了困境之中。（辰辰）<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">b</span>&gt;</span>相关报道：<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://tech.163.com/19/0908/09/EOHS53RK000999LD.html"</span> <span class="attr">target</span>=<span class="string">"_self"</span> <span class="attr">urlmacroreplace</span>=<span class="string">"false"</span>&gt;</span>iPhone 11背部苹果Logo改为居中：为反向无线充电<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"https://tech.163.com/19/0907/08/EOF60CBC00097U7S.html"</span> <span class="attr">target</span>=<span class="string">"_self"</span> <span class="attr">urlmacroreplace</span>=<span class="string">"false"</span>&gt;</span>2019年新iPhone传言汇总，你觉得哪些能成真<span class="tag">&lt;/<span class="name">a</span>&gt;</span>  <span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">p</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">p</span>/&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"ep-source cDGray"</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"left"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://tech.163.com/"</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"https://static.ws.126.net/cnews/css13/img/end_tech.png"</span> <span class="attr">alt</span>=<span class="string">"王凤枝"</span> <span class="attr">class</span>=<span class="string">"icon"</span>/&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span> 本文来源：网易科技报道  <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"ep-editor"</span>&gt;</span>责任编辑：王凤枝_NT2541<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，标题提取是正确的。正文其实也是正确的，不过这里还包含了一些 HTML 标签，比如 <code>&lt;img&gt;</code>、<code>&lt;p&gt;</code> 等，我们可以进一步通过一些解析库来解析。 看下源码吧，比如提取标题的方法：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">normalize_entities</span><span class="params">(cur_title)</span>:</span></span><br><span class="line">    entities = &#123;</span><br><span class="line">        <span class="string">u'u2014'</span>:<span class="string">'-'</span>,</span><br><span class="line">        <span class="string">u'u2013'</span>:<span class="string">'-'</span>,</span><br><span class="line">        <span class="string">u'&amp;mdash;'</span>: <span class="string">'-'</span>,</span><br><span class="line">        <span class="string">u'&amp;ndash;'</span>: <span class="string">'-'</span>,</span><br><span class="line">        <span class="string">u'u00A0'</span>: <span class="string">' '</span>,</span><br><span class="line">        <span class="string">u'u00AB'</span>: <span class="string">'"'</span>,</span><br><span class="line">        <span class="string">u'u00BB'</span>: <span class="string">'"'</span>,</span><br><span class="line">        <span class="string">u'&amp;quot;'</span>: <span class="string">'"'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> c, r <span class="keyword">in</span> entities.items():</span><br><span class="line">        <span class="keyword">if</span> c <span class="keyword">in</span> cur_title:</span><br><span class="line">            cur_title = cur_title.replace(c, r)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> cur_title</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">norm_title</span><span class="params">(title)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> normalize_entities(normalize_spaces(title))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_title</span><span class="params">(doc)</span>:</span></span><br><span class="line">    title = doc.find(<span class="string">'.//title'</span>)</span><br><span class="line">    <span class="keyword">if</span> title <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> title.text <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> len(title.text) == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'[no-title]'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> norm_title(title.text)</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">title</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""Returns document title"""</span></span><br><span class="line">    <span class="keyword">return</span> get_title(self._html(<span class="literal">True</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>title 方法实际上就是调用了一个 get_title 方法，它怎么做的？实际上就是用了一个 XPath 只解析了 <code>&lt;title&gt;</code> 标签里面的内容，别的没了。如果没有，那就返回 <code>[no-title]</code>。</p>
                  <figure class="highlight lasso">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">def summary(<span class="built_in">self</span>, html_partial=<span class="literal">False</span>):</span><br><span class="line">    ruthless = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">self</span>._html(<span class="literal">True</span>)</span><br><span class="line">        for i <span class="keyword">in</span> <span class="built_in">self</span>.tags(<span class="built_in">self</span>.html, <span class="string">'script'</span>, <span class="string">'style'</span>):</span><br><span class="line">            i.drop_tree()</span><br><span class="line">        for i <span class="keyword">in</span> <span class="built_in">self</span>.tags(<span class="built_in">self</span>.html, <span class="string">'body'</span>):</span><br><span class="line">            i.<span class="built_in">set</span>(<span class="string">'id'</span>, <span class="string">'readabilityBody'</span>)</span><br><span class="line">        <span class="keyword">if</span> ruthless:</span><br><span class="line">            <span class="built_in">self</span>.remove_unlikely_candidates()</span><br><span class="line">        <span class="built_in">self</span>.transform_misused_divs_into_paragraphs()</span><br><span class="line">        candidates = <span class="built_in">self</span>.score_paragraphs()</span><br><span class="line"></span><br><span class="line">        best_candidate = <span class="built_in">self</span>.select_best_candidate(candidates)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> best_candidate:</span><br><span class="line">            article = <span class="built_in">self</span>.get_article(candidates, best_candidate,</span><br><span class="line">                                       html_partial=html_partial)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> ruthless:</span><br><span class="line">                ruthless = <span class="literal">False</span></span><br><span class="line">                continue</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                article = <span class="built_in">self</span>.html.find(<span class="string">'body'</span>)</span><br><span class="line">                <span class="keyword">if</span> article is <span class="literal">None</span>:</span><br><span class="line">                    article = <span class="built_in">self</span>.html</span><br><span class="line">        cleaned_article = <span class="built_in">self</span>.sanitize(article, candidates)</span><br><span class="line">        article_length = len(cleaned_article <span class="literal">or</span> <span class="string">''</span>)</span><br><span class="line">        retry_length = <span class="built_in">self</span>.retry_length</span><br><span class="line">        of_acceptable_length = article_length &gt;= retry_length</span><br><span class="line">        <span class="keyword">if</span> ruthless <span class="literal">and</span> <span class="literal">not</span> of_acceptable_length:</span><br><span class="line">            ruthless = <span class="literal">False</span></span><br><span class="line">            continue</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> cleaned_article</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我删除了一些冗余的调试的代码，只保留了核心的代码，其核心实现就是先去除一些干扰内容，然后找出一些疑似正文的 candidates，然后再去寻找最佳匹配的 candidates 最后提取其内容返回即可。 然后再找到获取 candidates 方法里面的 score_paragraphs 方法，又追踪到一个 score_node 方法，就是为每一个节点打分的，其实现如下：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">def score_node(self, elem):</span><br><span class="line">   content_score = self.class_weight(elem)</span><br><span class="line">   <span class="type">name</span> = elem.tag.lower()</span><br><span class="line">   <span class="keyword">if</span> <span class="type">name</span> <span class="keyword">in</span> ["div", "article"]:</span><br><span class="line">       content_score += <span class="number">5</span></span><br><span class="line">   elif <span class="type">name</span> <span class="keyword">in</span> ["pre", "td", "blockquote"]:</span><br><span class="line">       content_score += <span class="number">3</span></span><br><span class="line">   elif <span class="type">name</span> <span class="keyword">in</span> ["address", "ol", "ul", "dl", "dd", "dt", "li", "form", "aside"]:</span><br><span class="line">       content_score -= <span class="number">3</span></span><br><span class="line">   elif <span class="type">name</span> <span class="keyword">in</span> ["h1", "h2", "h3", "h4", "h5", "h6", "th", "header", "footer", "nav"]:</span><br><span class="line">       content_score -= <span class="number">5</span></span><br><span class="line">   <span class="keyword">return</span> &#123;</span><br><span class="line">       <span class="string">'content_score'</span>: content_score,</span><br><span class="line">       <span class="string">'elem'</span>: elem</span><br><span class="line">   &#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这什么意思呢？你看如果这个节点标签是 div 或者 article 等可能表征正文区块的话，就加 5 分，如果是 aside 等表示侧栏的内容就减 3 分。这些打分也没有什么非常标准的依据，可能是根据经验累积的规则。 另外还有一些方法里面引用了一些正则匹配来进行打分或者替换，其定义如下：</p>
                  <figure class="highlight gherkin">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"> REGEXES = &#123;</span><br><span class="line">    'unlikelyCandidatesRe': re.compile('combx|<span class="string">comment</span>|<span class="string">community</span>|<span class="string">disqus</span>|<span class="string">extra</span>|<span class="string">foot</span>|<span class="string">header</span>|<span class="string">menu</span>|<span class="string">remark</span>|<span class="string">rss</span>|<span class="string">shoutbox</span>|<span class="string">sidebar</span>|<span class="string">sponsor</span>|<span class="string">ad-break</span>|<span class="string">agegate</span>|<span class="string">pagination</span>|<span class="string">pager</span>|<span class="string">popup</span>|<span class="string">tweet</span>|<span class="string">twitter', re.I),</span></span><br><span class="line"><span class="string">    'okMaybeItsACandidateRe': re.compile('and</span>|<span class="string">article</span>|<span class="string">body</span>|<span class="string">column</span>|<span class="string">main</span>|<span class="string">shadow', re.I),</span></span><br><span class="line"><span class="string">    'positiveRe': re.compile('article</span>|<span class="string">body</span>|<span class="string">content</span>|<span class="string">entry</span>|<span class="string">hentry</span>|<span class="string">main</span>|<span class="string">page</span>|<span class="string">pagination</span>|<span class="string">post</span>|<span class="string">text</span>|<span class="string">blog</span>|<span class="string">story', re.I),</span></span><br><span class="line"><span class="string">    'negativeRe': re.compile('combx</span>|<span class="string">comment</span>|<span class="string">com-</span>|<span class="string">contact</span>|<span class="string">foot</span>|<span class="string">footer</span>|<span class="string">footnote</span>|<span class="string">masthead</span>|<span class="string">media</span>|<span class="string">meta</span>|<span class="string">outbrain</span>|<span class="string">promo</span>|<span class="string">related</span>|<span class="string">scroll</span>|<span class="string">shoutbox</span>|<span class="string">sidebar</span>|<span class="string">sponsor</span>|<span class="string">shopping</span>|<span class="string">tags</span>|<span class="string">tool</span>|<span class="string">widget', re.I),</span></span><br><span class="line"><span class="string">    'divToPElementsRe': re.compile('&lt;(a</span>|<span class="string">blockquote</span>|<span class="string">dl</span>|<span class="string">div</span>|<span class="string">img</span>|<span class="string">ol</span>|<span class="string">p</span>|<span class="string">pre</span>|<span class="string">table</span>|<span class="string">ul)', re.I),</span></span><br><span class="line"><span class="string">    #'replaceBrsRe': re.compile('(&lt;br[^&gt;]*&gt;[ nrt]*)&#123;2,&#125;',re.I),</span></span><br><span class="line"><span class="string">    #'replaceFontsRe': re.compile('&lt;(/?)font[^&gt;]*&gt;',re.I),</span></span><br><span class="line"><span class="string">    #'trimRe': re.compile('^s+</span>|<span class="string">s+$/'),</span></span><br><span class="line"><span class="string">    #'normalizeRe': re.compile('s&#123;2,&#125;/'),</span></span><br><span class="line"><span class="string">    #'killBreaksRe': re.compile('(&lt;brs*/?&gt;(s</span>|<span class="string">&amp;nbsp;?)*)&#123;1,&#125;/'),</span></span><br><span class="line"><span class="string">    'videoRe': re.compile('https?://(www.)?(youtube</span>|<span class="string">vimeo).com', re.I),</span></span><br><span class="line"><span class="string">    #skipFootnoteLink:      /^s*([?[a-z0-9]&#123;1,2&#125;]?</span>|<span class="string">^</span>|<span class="string">edit</span>|<span class="string">citation needed)s*$/i,</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>比如这里定义了 unlikelyCandidatesRe，就是不像 candidates 的 pattern，比如 foot、comment 等等，碰到这样的标签或 pattern 的话，在计算分数的时候都会减分，另外还有其他的 positiveRe、negativeRe 也是一样的原理，分别对匹配到的内容进行加分或者减分。 这就是 Readability 的原理，是基于一些规则匹配的打分模型，很多规则其实来源于经验的累积，分数的计算规则应该也是不断地调优得出来的。 另外其他的就没了，Readability 并没有提供提取时间、作者的方法，另外此种方法的准确率也是有限的，但多少还是省去了一些人工成本。</p>
                  <h2 id="Newspaper"><a href="#Newspaper" class="headerlink" title="Newspaper"></a>Newspaper</h2>
                  <p>另外还有一个智能解析的库，叫做 Newspaper，提供的功能更强一些，但是准确率上个人感觉和 Readability 差不太多。 这个库分为 Python2 和 Python3 两个版本，Python2 下的版本叫做 newspaper，Python3 下的版本叫做 newspaper3k，这里我们使用 Python3 版本来进行测试。 其 GitHub 地址是：<a href="https://github.com/codelucas/newspaper，官方文档地址是：[https://newspaper.readthedocs.io](https://newspaper.readthedocs.io/" target="_blank" rel="noopener">https://github.com/codelucas/newspaper，官方文档地址是：[https://newspaper.readthedocs.io](https://newspaper.readthedocs.io/</a>&gt;)。 在安装之前需要安装一些依赖库，可以参考官方的说明：<a href="https://github.com/codelucas/newspaper#get-it-now" target="_blank" rel="noopener">https://github.com/codelucas/newspaper#get-it-now</a>。 安装好必要的依赖库之后，就可以使用 pip 安装了：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> newspaper3k</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>安装成功之后便可以导入使用了。 下面我们先用官方提供的实例来过一遍它的用法，官方提供的示例是使用了这个链接：<a href="https://fox13now.com/2013/12/30/new-year-new-laws-obamacare-pot-guns-and-drones/，其页面截图如下" target="_blank" rel="noopener">https://fox13now.com/2013/12/30/new-year-new-laws-obamacare-pot-guns-and-drones/，其页面截图如下</a>： <img src="https://cdn.cuiqingcai.com/2019-09-09-125754.png" alt="官方示例"> 下面用一个实例来感受一下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> newspaper import Article</span><br><span class="line"></span><br><span class="line">url = <span class="string">'https://fox13now.com/2013/12/30/new-year-new-laws-obamacare-pot-guns-and-drones/'</span></span><br><span class="line">article = Article(url)</span><br><span class="line">article.download()</span><br><span class="line"><span class="comment"># print('html:', article.html)</span></span><br><span class="line"></span><br><span class="line">article.parse()</span><br><span class="line"><span class="builtin-name">print</span>(<span class="string">'authors:'</span>, article.authors)</span><br><span class="line"><span class="builtin-name">print</span>(<span class="string">'date:'</span>, article.publish_date)</span><br><span class="line"><span class="builtin-name">print</span>(<span class="string">'text:'</span>, article.text)</span><br><span class="line"><span class="builtin-name">print</span>(<span class="string">'top image:'</span>, article.top_image)</span><br><span class="line"><span class="builtin-name">print</span>(<span class="string">'movies:'</span>, article.movies)</span><br><span class="line"></span><br><span class="line">article.nlp()</span><br><span class="line"><span class="builtin-name">print</span>(<span class="string">'keywords:'</span>, article.keywords)</span><br><span class="line"><span class="builtin-name">print</span>(<span class="string">'summary:'</span>, article.summary)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里从 newspaper 库里面先导入了 Article 这个类，然后直接传入 url 即可，首先需要调用它的 download 方法，将网页爬取下来，否则直接进行解析会抛出错误的。</p>
                  <blockquote>
                    <p>但我总感觉这个设计挺不友好的，parse 方法不能判断下，如果没执行 download 就自动执行 download 方法吗？如果不 download 其他的不什么都干不了吗？</p>
                  </blockquote>
                  <p>好的，然后我们再执行 parse 方法进行网页的智能解析，这个功能就比较全了，能解析 authors、publish_date、text 等等，除了正文还能解析作者、发布时间等等。 另外这个库还提供了一些 NLP 的方法，比如获取关键词、获取文本摘要等等，在使用前需要先执行以下 nlp 方法。 最后运行结果如下：</p>
                  <figure class="highlight">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">authors</span>: ['Cnn Wire']</span><br><span class="line"><span class="attribute">date</span>: 2013-12-30 00:00:00</span><br><span class="line"><span class="attribute">text</span>: By Leigh Ann Caldwell</span><br><span class="line"></span><br><span class="line">WASHINGTON (CNN) — Not everyone subscribes to a New Year’s resolution, but Americans will be required to follow new laws in 2014.</span><br><span class="line"></span><br><span class="line">Some 40,000 measures taking effect range from sweeping, national mandates under Obamacare to marijuana legalization in Colorado, drone prohibition in Illinois and transgender protections in California.</span><br><span class="line"></span><br><span class="line">Although many new laws are controversial, they made it through legislatures, public referendum or city councils and represent the shifting composition of American beliefs.</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line"><span class="attribute">Colorado</span>: Marijuana becomes legal in the state for buyers over 21 at a licensed retail dispensary.</span><br><span class="line"></span><br><span class="line">(Sourcing: much of this list was obtained from the National Conference of State Legislatures).</span><br><span class="line">top image: https://localtvkstu.files.wordpress.com/2012/04/national-news-e1486938949489.jpg?quality=85&amp;strip=all</span><br><span class="line"><span class="attribute">movies</span>: []</span><br><span class="line"><span class="attribute">keywords</span>: ['drones', 'national', 'guns', 'wage', 'law', 'pot', 'leave', 'family', 'states', 'state', 'latest', 'obamacare', 'minimum', 'laws']</span><br><span class="line"><span class="attribute">summary</span>: Oregon: Family leave in Oregon has been expanded to allow eligible employees two weeks of paid leave to handle the death of a family member.</span><br><span class="line"><span class="attribute">Arkansas</span>: The state becomes the latest state requiring voters show a picture ID at the voting booth.</span><br><span class="line">Minimum wage and former felon employmentWorkers in 13 states and four cities will see increases to the minimum wage.</span><br><span class="line">New Jersey residents voted to raise the state’s minimum wage by $1 to $8.25 per hour.</span><br><span class="line">California is also raising its minimum wage to $9 per hour, but workers must wait until July to see the addition.</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里省略了一些输出结果。 可以看到作者、日期、正文、关键词、标签、缩略图等信息都被打印出来了，还算是不错的。 但这个毕竟是官方的实例，肯定是好的，我们再测试一下刚才的例子，看看效果如何，网址还是：<a href="https://tech.163.com/19/0909/08/EOKA3CFB00097U7S.html，改写代码如下" target="_blank" rel="noopener">https://tech.163.com/19/0909/08/EOKA3CFB00097U7S.html，改写代码如下</a>：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> newspaper import Article</span><br><span class="line"></span><br><span class="line">url = <span class="string">'https://tech.163.com/19/0909/08/EOKA3CFB00097U7S.html'</span></span><br><span class="line">article = Article(url, <span class="attribute">language</span>=<span class="string">'zh'</span>)</span><br><span class="line">article.download()</span><br><span class="line"><span class="comment"># print('html:', article.html)</span></span><br><span class="line"></span><br><span class="line">article.parse()</span><br><span class="line"><span class="builtin-name">print</span>(<span class="string">'authors:'</span>, article.authors)</span><br><span class="line"><span class="builtin-name">print</span>(<span class="string">'title:'</span>, article.title)</span><br><span class="line"><span class="builtin-name">print</span>(<span class="string">'date:'</span>, article.publish_date)</span><br><span class="line"><span class="builtin-name">print</span>(<span class="string">'text:'</span>, article.text)</span><br><span class="line"><span class="builtin-name">print</span>(<span class="string">'top image:'</span>, article.top_image)</span><br><span class="line"><span class="builtin-name">print</span>(<span class="string">'movies:'</span>, article.movies)</span><br><span class="line"></span><br><span class="line">article.nlp()</span><br><span class="line"><span class="builtin-name">print</span>(<span class="string">'keywords:'</span>, article.keywords)</span><br><span class="line"><span class="builtin-name">print</span>(<span class="string">'summary:'</span>, article.summary)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们将链接换成了新闻的链接，另外在 Article 初始化的时候还加了一个参数 language，其值为 zh，代表中文。 然后我们看下运行结果：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Building prefix dict from <span class="regexp">/usr/</span>local<span class="regexp">/lib/</span>python3<span class="number">.7</span><span class="regexp">/site-packages/</span>jieba/dict.txt ...</span><br><span class="line">Dumping model to file cache <span class="regexp">/var/</span>folders<span class="regexp">/1g/</span>l2xlw12x6rncs2p9kh5swpmw0000gn<span class="regexp">/T/</span>jieba.cache</span><br><span class="line">Loading model cost <span class="number">1.7178938388824463</span> seconds.</span><br><span class="line">Prefix dict has been built succesfully.</span><br><span class="line"><span class="string">authors:</span> []</span><br><span class="line"><span class="string">title:</span> 今年iPhone只有小改进？分析师：还有其他亮点</span><br><span class="line"><span class="string">date:</span> <span class="number">2019</span><span class="number">-09</span><span class="number">-09</span> <span class="number">08</span>:<span class="number">10</span>:<span class="number">26</span>+<span class="number">08</span>:<span class="number">00</span></span><br><span class="line"><span class="string">text:</span> （原标题：Apple Bets More Cameras Can Keep iPhone Humming）</span><br><span class="line"></span><br><span class="line">图示：苹果首席执行官蒂姆·库克(Tim Cook)在<span class="number">6</span>月份举行的苹果全球开发者大会上。</span><br><span class="line"></span><br><span class="line">网易科技讯 <span class="number">9</span>月<span class="number">9</span>日消息，据国外媒体报道，和过去的<span class="number">12</span>个年头一样，新款iPhone将成为苹果公司本周所举行年度宣传活动的主角。但人们的注意力正转向需要推动增长的其他苹果产品和服务。</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">Strategy Analytics的尼尔·莫斯顿(Neil Mawston)表示，可穿戴设备和服务的结合将是苹果业务超越iPhone的关键。他说，上一家手机巨头诺基亚公司在试图进行类似业务转型时就陷入了困境之中。（辰辰）</span><br><span class="line"></span><br><span class="line">相关报道：</span><br><span class="line"></span><br><span class="line">iPhone <span class="number">11</span>背部苹果Logo改为居中：为反向无线充电</span><br><span class="line"></span><br><span class="line"><span class="number">2019</span>年新iPhone传言汇总，你觉得哪些能成真</span><br><span class="line">top <span class="string">image:</span> <span class="string">https:</span><span class="comment">//www.163.com/favicon.ico</span></span><br><span class="line"><span class="string">movies:</span> []</span><br><span class="line"><span class="string">keywords:</span> [<span class="string">'trust高级投资组合经理丹摩根dan'</span>, <span class="string">'iphone'</span>, <span class="string">'mawston表示可穿戴设备和服务的结合将是苹果业务超越iphone的关键他说上一家手机巨头诺基亚公司在试图进行类似业务转型时就陷入了困境之中辰辰相关报道iphone'</span>, <span class="string">'xs的销售疲软状况迫使苹果在1月份下调了业绩预期这是逾15年来的第一次据贸易公司susquehanna'</span>, <span class="string">'xs机型发布后那种令人失望的业绩重演iphone'</span>, <span class="string">'今年iphone只有小改进分析师还有其他亮点'</span>, <span class="string">'more'</span>, <span class="string">'xr和iphone'</span>, <span class="string">'morgan说他们现在没有任何真正深入的进展只是想继续让iphone这款业务继续转下去他乐观地认为今年发布的新款手机将有足够多的新功能为一个非常成熟的产品增加额外的功能让火车继续前进这种仅限于此的态度说明了苹果自2007年发布首款iphone以来所面临的挑战iphone销售占苹果公司总营收的一半以上这让苹果陷入了一个尴尬的境地既要维持核心产品的销量另一方面又需要减少对它的依赖瑞银ubs今年5月份对8000名智能手机用户进行了相关调查其发布的年度全球调查报告显示最近iphone在人脸识别技术等方面的进步并没有引起一些消费者的共鸣他们基本上都认为苹果产品没有过去几年那么独特或者惊艳品牌也没有过去几年那么有吸引力很多人使用老款手机的时间更长自己认为也没有必要升级到平均售价949美元的新款iphone苹果需要在明年销售足够多的iphone以避免像去年9月份iphone'</span>, <span class="string">'keep'</span>, <span class="string">'原标题apple'</span>]</span><br><span class="line"><span class="string">summary:</span> （原标题：Apple Bets More Cameras Can Keep iPhone Humming）图示：苹果首席执行官蒂姆·库克(Tim Cook)在<span class="number">6</span>月份举行的苹果全球开发者大会上。网易科技讯 <span class="number">9</span>月<span class="number">9</span>日消息，据国外媒体报道，和过去的<span class="number">12</span>个年头一样，新款iPhone将成为苹果公司本周所举行...亚公司在试图进行类似业务转型时就陷入了困境之中。（辰辰）相关报道：iPhone <span class="number">11</span>背部苹果Logo改为居中：为反向无线充电<span class="number">2019</span>年新iPhone传言汇总，你觉得哪些能成真</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>中间正文很长省略了一部分，可以看到运行时首先加载了一些中文的库包，比如 jieba 所依赖的词表等等。 解析结果中，日期的确是解析对了，因为这个日期格式的的确比较规整，但这里还自动给我们加了东八区的时区，贴心了。作者没有提取出来，可能是没匹配到 <code>来源</code> 两个字吧，或者词库里面没有，标题、正文的提取还算比较正确，也或许这个案例的确是比较简单。 另外对于 NLP 部分，获取的关键词比较迷，长度有点太长了。summary 也有点冗余。 另外 Newspaper 还提供了一个较为强大的功能，就是 build 构建信息源。官方的介绍其功能就是构建一个新闻源，可以根据传入的 URL 来提取相关文章、分类、RSS 订阅信息等等。 我们用实例感受一下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import newspaper</span><br><span class="line"></span><br><span class="line">source = newspaper.build(<span class="string">'http://www.sina.com.cn/'</span>, <span class="attribute">language</span>=<span class="string">'zh'</span>)</span><br><span class="line"><span class="keyword">for</span> category <span class="keyword">in</span> source.category_urls():</span><br><span class="line">    <span class="builtin-name">print</span>(category)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> article <span class="keyword">in</span> source.articles:</span><br><span class="line">    <span class="builtin-name">print</span>(article.url)</span><br><span class="line">    <span class="builtin-name">print</span>(article.title)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> feed_url <span class="keyword">in</span> source.feed_urls():</span><br><span class="line">    <span class="builtin-name">print</span>(feed_url)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里我们传入了新浪的官网，调用了 build 方法，构建了一个 source，然后输出了相关的分类、文章、RSS 订阅等内容，运行结果如下：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">http://cul.news.sina.<span class="keyword">com</span>.<span class="keyword">cn</span></span><br><span class="line">http://www.sina.<span class="keyword">com</span>.<span class="keyword">cn</span>/</span><br><span class="line">http://sc.sina.<span class="keyword">com</span>.<span class="keyword">cn</span></span><br><span class="line">http://jiangsu.sina.<span class="keyword">com</span>.<span class="keyword">cn</span></span><br><span class="line">http://gif.sina.<span class="keyword">com</span>.<span class="keyword">cn</span></span><br><span class="line">....</span><br><span class="line">http://<span class="keyword">tj</span>.sina.<span class="keyword">com</span>.<span class="keyword">cn</span></span><br><span class="line">http://travel.sina.<span class="keyword">com</span>.<span class="keyword">cn</span></span><br><span class="line">http://jiaoyi.sina.<span class="keyword">com</span>.<span class="keyword">cn</span></span><br><span class="line">http://cul.sina.<span class="keyword">com</span>.<span class="keyword">cn</span></span><br><span class="line">http<span class="variable">s:</span>//finance.sina.<span class="keyword">com</span>.<span class="keyword">cn</span>/roll/<span class="number">2019</span>-<span class="number">06</span>-<span class="number">12</span>/doc-ihvhiqay5022316.shtml</span><br><span class="line">经参头版：激发微观主体活力加速国企改革</span><br><span class="line">http://eladies.sina.<span class="keyword">com</span>.<span class="keyword">cn</span>/feel/xinli/<span class="number">2018</span>-<span class="number">01</span>-<span class="number">25</span>/<span class="number">0722</span>/doc-ifyqwiqk0463751.shtml</span><br><span class="line">我们别再联系了</span><br><span class="line">http://finance.sina.<span class="keyword">com</span>.<span class="keyword">cn</span>/roll/<span class="number">2018</span>-<span class="number">05</span>-<span class="number">13</span>/doc-ihamfahx2958233.shtml</span><br><span class="line">新违约时代到来！违约“常态化”下的市场出清与换血</span><br><span class="line">http://sports.sina.<span class="keyword">com</span>.<span class="keyword">cn</span>/basketball/<span class="number">2019</span>worldcup/<span class="number">2019</span>-<span class="number">09</span>-<span class="number">08</span>/doc-iicezzrq4390554.shtml</span><br><span class="line">罗健儿<span class="number">26</span>分韩国收首胜</span><br><span class="line">...</span><br><span class="line">http://travel.sina.<span class="keyword">com</span>.<span class="keyword">cn</span>/outbound/pages/<span class="number">2019</span>-<span class="number">09</span>-<span class="number">05</span>/detail-iicezzrq3622449.shtml</span><br><span class="line">菲律宾海滨大道 夜晚让人迷离</span><br><span class="line">http://travel.sina.<span class="keyword">com</span>.<span class="keyword">cn</span>/outbound/pages/<span class="number">2016</span>-<span class="number">08</span>-<span class="number">19</span>/detail-ifxvcnrv0334779.shtml</span><br><span class="line">关岛 用双脚尽情享受阳光与海滩</span><br><span class="line">http://travel.sina.<span class="keyword">com</span>.<span class="keyword">cn</span>/domestic/pages/<span class="number">2019</span>-<span class="number">09</span>-<span class="number">04</span>/detail-iicezzrq3325092.shtml</span><br><span class="line">秋行查干浩特草原</span><br><span class="line">http://travel.sina.<span class="keyword">com</span>.<span class="keyword">cn</span>/outbound/pages/<span class="number">2019</span>-<span class="number">09</span>-<span class="number">03</span>/detail-iicezueu3050710.shtml</span><br><span class="line">白羊座的土豪之城迪拜</span><br><span class="line">http://travel.sina.<span class="keyword">com</span>.<span class="keyword">cn</span>/video/baidang/<span class="number">2019</span>-<span class="number">08</span>-<span class="number">29</span>/detail-ihytcitn2747327.shtml</span><br><span class="line">肯辛顿宫藏着维多利亚的秘密</span><br><span class="line">http://<span class="keyword">cd</span>.auto.sina.<span class="keyword">com</span>.<span class="keyword">cn</span>/bdcs/<span class="number">2017</span>-<span class="number">08</span>-<span class="number">15</span>/detail-ifyixias1051586.shtml</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到它输出了非常多的类别链接，另外还有很多文章列表，由于没有 RSS 订阅内容，这里没有显示。 下面把站点换成我的博客：<a href="https://cuiqingcai.com，博客截图如下" target="_blank" rel="noopener">https://cuiqingcai.com，博客截图如下</a>： <img src="https://cdn.cuiqingcai.com/2019-09-09-134550.png" alt="博客截图"> 看看运行结果：</p>
                  <figure class="highlight dts">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">https:</span><span class="comment">//cuiqingcai.com</span></span><br><span class="line"><span class="symbol">https:</span><span class="comment">//cuiqingcai.com</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>似乎不太行啊，一篇文章都没有，RSS 也没有，可见其功能还有待优化。 Newspaper 的基本用法介绍到这里，更加详细的用法可以参考官方文档：<a href="https://newspaper.readthedocs.io" target="_blank" rel="noopener">https://newspaper.readthedocs.io</a>。个人感觉其中的智能解析可以用用，不过据我的个人经验，感觉还是很多解析不对或者解析不全的， 以上便是 Readability 和 Newspaper 的介绍。</p>
                  <h2 id="其他方案"><a href="#其他方案" class="headerlink" title="其他方案"></a>其他方案</h2>
                  <p>另外除了这两个库其实还有一些比较优秀的算法，由于我们处理的大多为中文文档，所以一些在中文上面的研究是比较有效的，在这里列几个值得借鉴的中文论文供大家参考：</p>
                  <ul>
                    <li>洪鸿辉等，基于文本及符号密度的网页正文提取方法</li>
                    <li>梁东等，基于支持向量机的网页正文内容提取方法</li>
                    <li>王卫红等，基于可视块的多记录型复杂网页信息提取算法</li>
                  </ul>
                  <p>今天还看到一位大佬「青南」根据上面第一篇论文所实现的 GeneralNewsExtractor，GitHub 地址为：<a href="https://github.com/kingname/GeneralNewsExtractor，经测试准确率还不错，比" target="_blank" rel="noopener">https://github.com/kingname/GeneralNewsExtractor，经测试准确率还不错，比</a> Readability 和 Newspaper 的解析效果要好。我也跟作者进行了交流，后续可能还会基于其他的 Feature 或依赖于视觉化的方法进行优化，大家可以关注下，谢谢！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-09-12 09:37:24" itemprop="dateCreated datePublished" datetime="2019-09-12T09:37:24+08:00">2019-09-12</time>
                </span>
                <span id="/7436.html" class="post-meta-item leancloud_visitors" data-flag-title="爬虫智能解析库 Readability 和 Newspaper 的用法" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>15k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>14 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/7440.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 技术杂谈 <i class="label-arrow"></i>
                  </a>
                  <a href="/7440.html" class="post-title-link" itemprop="url">谈谈 Zao 这个软件</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>这两天想必大家应该被一个软件刷屏了，它的名字叫做 Zao，中文音译就叫“造”。它为什么这么火呢？是因为我们可以上传自己的一张照片，他就能把我们的脸替换成一些热门视频的男主或女主的脸，也就是视频换脸。 比如有人尝试了把尼古拉斯赵四的脸换到美国队长的脸上，美队的气质简直就是被垄断了，大家可以扫码看看： <img src="https://cdn.cuiqingcai.com/2019-08-31-151859.png" alt="美队变赵四"> 视频换脸技术大家应该早有耳闻，但这个软件有点意思，它抓住了几个点使得它一炮而红。 第一是这个软件的效果确实不错，我拿自己也做了实验，发现确实它渲染的一些结果几乎毫无违和感，毕竟这个软件核心拼的就是技术。 第二这个软件贴近于日常生活，我们可以把自己的照片上传，让我们真正成为视频里的主角。另外视频选材很有讲究，都是一些剪辑过的明星精彩镜头，这样我们生成的视频镜头会让我们有变成明星的感觉，非常有代入感。</p>
                  <h2 id="技术实现"><a href="#技术实现" class="headerlink" title="技术实现"></a>技术实现</h2>
                  <p>作为一名程序员，当然最关心的可能就是它的技术实现了，毋庸置疑它肯定是利用了深度学习的一些技术。我看了一些文章和调研，大体了解了一下，下面稍微分析一下里面用到的一些技术。 整体而言呢，这个过程分为三步，他们分别是：</p>
                  <ul>
                    <li>人脸定位</li>
                    <li>人脸转换</li>
                    <li>人脸融合</li>
                  </ul>
                  <h3 id="人脸定位"><a href="#人脸定位" class="headerlink" title="人脸定位"></a>人脸定位</h3>
                  <p>现在深度学习对于人脸识别和定位的研究技术已经非常成熟和精准了，其核心就是使用了卷积神经网络，即 CNN，不同的模型架构对于识别的准确率有不用的表现。 对于人脸的定位，一般是使用脸部的关键点定位的，这些点叫做 Landmarks。在一张人脸图像上，每张脸的轮廓和五官的位置都会被打上点，比如整个脸部的轮廓用一些点描出来，鼻子、眼睛、唇形同样用一些点描出来。 <img src="https://cdn.cuiqingcai.com/2019-08-31-152358.jpg" alt="Facial Feature Detection"> 一般来说一张脸会用 68 个点来标记出来，每识别的模型接收一张人脸图像，输出这 68 个点的坐标，这样我们就可以实现人脸定位了。 现在现成的模型也很多了，比如 dlib，opencv 等开源工具包可以直接拿来使用了，如果要更精准地话可以使用更复杂的卷积神经网络模型来实现，大家可以了解下相关论文。</p>
                  <h3 id="人脸生成"><a href="#人脸生成" class="headerlink" title="人脸生成"></a>人脸生成</h3>
                  <p>有了标记点以后，这个软件就可以把我们的人脸提取出来了，但是这有个问题，我们上传的是一张静态图片，总不能直接生硬地替换进去吧，比如我们上传的是一张正脸照片，那视频里的一些侧脸画面直接贴上那不就没法看了吗？ 这时候就要用到另外一个核心技术叫做人脸生成技术，有了它我们就可以对人脸进行生成了，比如根据一张正脸图生成一张侧脸图。目前人脸生成技术主要有两种，有 GAN（生成对抗网络）和 VAE（变分自编码器），下面简单介绍一下它们的原理。 对于 GAN 来说，它叫做生成对抗网络，为什么叫对抗网络呢？是因为模型在训练的过程中一直有两个东西在做对抗，这俩东西分别叫 Generator（生成器）和 Discriminator（判别器）。前者主要负责生成一张人脸，越像越牛逼。后者主要负责判断分辨前者生成的人脸是不是真的，判定越准越牛逼。二者在这个过程中为了变得越来越牛逼，前者就会尽力去生成更像的人脸来欺骗后者，后者也会尽力去判别生成的人脸是不是真的来打击前者。这样二者在不断地训练和对抗过程中，前者生成的结果就会越来越好了。 对于 VAE 呢，它是通过一些无监督学习的方式将人脸信息进行压缩，由编码器把它表示成一个短向量，这些向量里就包含了人脸的基本信息，比如肤色、唇形等信息，这样整个模型就可以学习到人脸的共性。然后，解码器将向量解码，将其转换为某一特定的人脸。这样就等于经过一层中间向量完成了从一张人脸到另一张人脸的转换。</p>
                  <h3 id="图像融合"><a href="#图像融合" class="headerlink" title="图像融合"></a>图像融合</h3>
                  <p>最后的阶段就是图像融合了，也就是把生成的新的人脸和原来图像的背景融合，使之不会产生违和感。 在这个软件中，视频是由一帧一帧组成的，那么在转换的时候也需要一帧一帧处理，最后处理完成后再合成整个视频。 以上也就是我所了解到的变脸的一些方法。</p>
                  <h2 id="安全性"><a href="#安全性" class="headerlink" title="安全性"></a>安全性</h2>
                  <p>有人说，这个技术不是什么好技术。万一有人拿着我们的照片一变脸，就能够把我们任意的表情和头部动作模拟出来，拿着去做认证，比如刷脸支付什么的咋办，那我们的钱不就被盗刷了吗？ 对于这个问题，支付宝官方也做了回应，支付宝称刷脸支付实际上会通过软硬件结合的方式进行检测，其会判断被刷物体是否是照片、视频或者软件模拟的方式生成的，可以有效避免身份冒用情况。其中有一个核心技术就是通过 3D 结构光摄像头来进行信息采集和识别，如果被拍摄物体是平面的，也就是说如果是照片或者视频，是无法通过检测的。 <img src="https://cdn.cuiqingcai.com/2019-08-31-152611.png" alt="支付宝回应"> 这时候我自然而然想到，既然用的是 3D 结构光摄像头，那么如果用了 3D 打印技术把一个人的肖像打印出来，或者用一个非常逼真的蜡像来进行刷脸识别，能不能通过呢？我看了一些报道，发现不少案例的确通过了刷脸测试，比如解开了 iPhone 面部识别锁等等。但要通过 3D 打印技术来模拟一个人的肖像成本还是蛮高的，所以基本上也不太会有人来搞这些。 如果对此还心有余悸的话，支付宝还回应称，即便是真的被盗刷了，支付宝也会通过保险公司进行全额赔付。 所以基本上是不用担心其安全性的，尤其是 Zao 这个软件的出现是没有对刷脸支付的风险造成大的影响的，其就是增加了一个活体视频模拟的实现，对刷脸支付的安全性没有出现大的突破性威胁。</p>
                  <h2 id="隐私性"><a href="#隐私性" class="headerlink" title="隐私性"></a>隐私性</h2>
                  <p>这个就要好好说一下了，这个软件的出现同时引起了另一个轩然大波，那就是其中的隐私条款。 其隐私条款有一条是这样的：</p>
                  <blockquote>
                    <p>用户上传发布内容后，意味着同意授予 ZAO 及其关联公司以及 ZAO 用户在“全球范围内完全免费、不可撤销、永久、可转授权和可再许可的权利”，“包括但不限于可以对用户内容进行全部或部分的修改与编辑（如将短视频中的人脸或者声音换成另一个人的人脸或者声音等）以及对修改前后的用户内容进行信息网络传播以及《著作权法》规定的由著作权人享有的全部著作财产权利及邻接权利”。</p>
                  </blockquote>
                  <p>这条款没人说还真没注意到，因为一般咱用一个软件，一般不会去仔细看它的条款，那么密密麻麻的一坨，有几个人会去仔细看呢？但要不同意，这个软件还没法用，所以用过这个软件的人，这个条款一定是已经同意了。 这条条款其实是很过分的，同意授予 Zao 及其关联公司以及 Zao 用户在“全球范围内完全免费、不可撤销、永久、可转授权和可再许可的权利。注意这里有几个字，完全免费、不可撤销、永久、可转授权、可再许可，这几个词就代表我们已经把我们的肖像权永久授予了 Zao 及其关联公司了，而且不能撤销，账号注销了也不能撤销，也就是以后它们可以有权利永久滥用我们的肖像。更可怕的是，其中还有一个词叫可转授权，那也就是说，Zao 可以对我们的肖像权进行转授权，你懂得，给点钱，啥办不到呢？这就更无法控制了，这可能就意味着，世界上任何一个人可能都能获得我们的肖像权。 所以说，如果你还没用的话，一定要谨慎谨慎再谨慎！ 哎，反正我已经同意了，貌似我现在也没什么办法了。</p>
                  <h2 id="社会影响"><a href="#社会影响" class="headerlink" title="社会影响"></a>社会影响</h2>
                  <p>这个软件的出现，更深一点想，其实它所隐含的影响还是蛮大的。 有了这个变脸技术，如果有人获得了我们在条款里面所”捐出“的肖像权，拿着我们的照片去生产那种你懂得的影片，把视频里面的男主或者女主换成我们的人脸，然后到处传播，或者以此作为敲诈勒索的工具。即便我们有理，那也说不清了，首先这个条款已经说了它们可以有权利随意使用我们的肖像，所以告侵犯肖像权已经行不通了，而且即使我们有证据证明这是假的，但这种视频的传播也一定会带来非常大的影响。 按照现在大众们的观念，比如说一张图，我们如果不信的话可以说它是 P 的，但如果换做是视频的话，很多人可能就会相信了，因为很多人不知道视频中的肖像也可以伪造得这么真了，毕竟很多人并不知道这种技术。因此，有了这种技术的出现，以后视频类的证据，可能也不可信了。因此这个软件的出现，可以说从另一个侧面昭示，以后视频也不能作为犯案的证据和验证人的真伪的依据了。 所以以后可能是这样子的：</p>
                  <ul>
                    <li>坐在电脑面前的网络女主播，即便不开美颜和滤镜，你所看到的她也不是真的她了。</li>
                    <li>你要给人打个钱，说开个视频吧，我看看是不是真的你，即便看到的是他，你也不能信了。</li>
                    <li>有人要 Qiao Zha 你，把你的人脸换成 Zuo An 分子的脸，你到哪里说理去？</li>
                    <li>某一天，你作为男女主角，出现在了 P 站和 91….</li>
                  </ul>
                  <p>我一开始想的还没这么深，边想边写，写到这，我自己都开始后怕了… 怎么甚至感觉，以后的社会可能会乱套了呢？这可能就是 AI 发展的一个隐患吧。 所以写到最后，虽然这个软件很有意思，但还是劝大家还没有用的就不要用了吧，真的很可怕。同时我也不知道这个软件这样的条款和做法会不会有什么问题，但还是希望能引起有关部门的注意。 以后，也希望大家也可以在使用软件的时候，要更加谨慎和小心，有条款就稍微看一看，尤其是对于这种和用户隐私相关的软件，要更加心存戒备。</p>
                  <h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2>
                  <p>本文参考来源：</p>
                  <ul>
                    <li>机器之心：刷屏的 ZAO 换脸 APP 你玩了吗？</li>
                    <li>支付宝推出的刷脸支付是基于“活体检测”技术做支撑</li>
                  </ul>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-09-04 09:40:27" itemprop="dateCreated datePublished" datetime="2019-09-04T09:40:27+08:00">2019-09-04</time>
                </span>
                <span id="/7440.html" class="post-meta-item leancloud_visitors" data-flag-title="谈谈 Zao 这个软件" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>3.5k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/7121.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 技术杂谈 <i class="label-arrow"></i>
                  </a>
                  <a href="/7121.html" class="post-title-link" itemprop="url">如何学好 MongoDB</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h1 id="开发者如何学好-MongoDB"><a href="#开发者如何学好-MongoDB" class="headerlink" title="开发者如何学好 MongoDB"></a>开发者如何学好 MongoDB</h1>
                  <p>作为一名研发，数据库是或多或少都会接触到的技术。MongoDB 是热门的 NoSQL 之一，我们怎样才能学好 MongoDB 呢？ 本篇文章，我们将从以下几方面讨论这个话题：</p>
                  <ol>
                    <li><strong>MongoDB 是什么</strong></li>
                    <li><strong>我如何确定我需要学习 MongoDB</strong></li>
                    <li><strong>开发者应该掌握 MongoDB 的哪些知识</strong></li>
                    <li><strong>学习的选择和困境</strong></li>
                  </ol>
                  <p>我们先来了解一下，MongoDB 为何物。 NoSQL 泛指非关系型数据库，该词是关系型数据库（即 SQL）的相对称呼。MongoDB 是非关系型数据库（NoSQL）中较为人熟知的一种。它拥有很多优秀特性，例如高性能、高可用、支持丰富的查询语句、无需预定义数据模型和水平可伸缩等，适合存储结构化、半结构化的文档和特定格式的文档，这些特性使它受到众多开发者的青睐。 <img src="https://ws1.sinaimg.cn/large/007VLJ1tly1g5hu72cwyhj307u020aa4.jpg" alt=""> 我们通过几个例子来看看 MySQL 与 MongoDB 的差异。 与 MySQL 数据库不同的是，MongoDB 不需要预先定义表和字段，这正是它灵活性的体现。MongoDB 可以拥有多个数据库，每个数据库可以拥有多个集合，每个集合可以存储多份文档，这种关系与 SQL 数据库中的“数据库、表、数据”相当。下图描述了 MongoDB 中数据库、集合和文档的关系： <img src="https://images.gitbook.cn/07193ca0-b418-11e9-8eb9-87f7ea48b37f" alt=""> 数据库 <code>fotoo</code> 中有两个集合，它们分别是 <code>player</code> 和 <code>books</code>。每个集合中都包含了许多文档，例如集合 <code>books</code> 中关于书籍《红楼梦》的文档，集合 <code>player</code> 中关于球员 <code>James</code> 的文档。 在查询方面，一个简单的 MySQL 查询语句为 <code>SELECT * FROM tablename</code>，对应的 MongoDB 查询语句为 <code>db.tablename.find()</code>。在面对多步骤的查询条件时，MongoDB 更游刃有余。例如： “统计数据库 <code>artic</code> 中 <code>score</code> 大于 <code>70</code> 且小于 <code>90</code> 的文档数量” 这样的需求，用 MongoDB 的聚合操作就可以轻松完成，对应示例如下：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">\&gt; db.artic.aggregate([</span><br><span class="line">... &#123;<span class="string">$match:</span> &#123;<span class="string">score:</span> &#123;<span class="string">$gt:</span> <span class="number">70</span>, <span class="string">$lt:</span> <span class="number">90</span>&#125;&#125;&#125;,</span><br><span class="line">... &#123;<span class="string">$group:</span> &#123;<span class="string">_id:</span> <span class="literal">null</span>, <span class="string">number:</span> &#123;<span class="string">$sum:</span> <span class="number">1</span>&#125;&#125;&#125;</span><br><span class="line">... ])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这个例子或许简单了些，在 MySQL 中我们可以用 <code>count</code> 和 <code>where</code> 完成，但如果复杂度再提高四五个等级呢？例如在此基础上增加对某个字段的运算、替换、排序、分组计数、增删字段，用 MySQL 来实现就会很头疼，而 MongoDB 的聚合可以让我们轻松地完成这类复杂需求。</p>
                  <h2 id="我如何确定我需要学习-MongoDB"><a href="#我如何确定我需要学习-MongoDB" class="headerlink" title="我如何确定我需要学习 MongoDB"></a>我如何确定我需要学习 MongoDB</h2>
                  <p>MongoDB 是近些年涌现的几十种 NoSQL 中第一梯队的成员，另外一个为人熟知的是 Redis。你可能会有”我如何确定我需要学习 MongoDB 呢？“ 这样的疑问，面对这个问题，我们可以通过 MongoDB 的特点和应用场景着手。</p>
                  <ul>
                    <li>MongoDB 适合存储结构确定或不确定的文档。例如爬虫爬取的信息常缺失字段的情况或字段参差不齐的情况；</li>
                    <li>对数据库可用性要求较高的情况。MySQL 这类数据库要做到负载均衡、自动容灾和数据同步需要借助外部工具，而 MongoDB 的复制集可以让我们轻松完成这一系列的工作。相对接借助第三方工具来说，复制集的稳定性更高。</li>
                    <li>分库分表是 WEB 开发中常用到的数据库优化手段，MySQL 的分库分表要考虑的问题非常多，例如字段冗余、数据组装跨节点分页、排序和数据迁移等，而 MongoDB 的分片可以让我们轻松完成“分库分表”的工作。MongoDB 的分片机制使我们不必将心思放在由“分库分表”带来的问题，而是专注于具体需求。</li>
                    <li>同样的，MySQL 的权限控制、定义数据模型、数据库备份和恢复等功能在 MongoDB 上也有。</li>
                    <li>MongoDB 中支持地理位置的存储和查询，这意味着 MongoDB 可以用于共享单车、共享雨伞、汽车定位等业务中。</li>
                  </ul>
                  <p>我们常用的关系型数据库无法满足 WEB2.0 时代的需求，在实际应用中暴露了很多难以克服的问题。NoSQL 的产生就是为了解决例如<strong>海量数据的存储</strong>、<strong>弹性可伸缩</strong>和<strong>灵活性</strong>等方面的挑战，所以作为一名合格的开发者，应该抽空学习 SQL 以外的数据库知识。</p>
                  <h2 id="开发者应该掌握-MongoDB-的哪些知识"><a href="#开发者应该掌握-MongoDB-的哪些知识" class="headerlink" title="开发者应该掌握 MongoDB 的哪些知识"></a>开发者应该掌握 MongoDB 的哪些知识</h2>
                  <p>学习前，我们需要明白自身定位：专业 DBA 或者日常开发使用。MongoDB 有完善的培训体系和对应的认证考试，对于希望成为专业 DBA 的朋友我建议到 MongoDB 官方网站了解。而对于仅需要<strong>满足日常开发需求</strong>的朋友，我建议学习的内容如下：</p>
                  <ul>
                    <li>MongoDB 在各个平台的安装方法</li>
                    <li>MongoDB 数据库和集合的基本操作</li>
                    <li>MongoDB 文档 CRUD 操作，包括能够丰富 CRUD 的投影和修饰符等</li>
                    <li>MongoDB 流式聚合操作，这能够在数据库层面轻松完成复杂数据的处理，而不是用编程语言来处理</li>
                    <li>MongoDB 的数据模型，虽然它可以存储不规则的文档，但有些情况下定义数据模型可以提高查询效率</li>
                  </ul>
                  <p>当然，除了这些基本操作之外我们还可以<strong>学习更多的知识提高个人竞争力</strong>，这些知识是：</p>
                  <ul>
                    <li>MongoDB 执行计划和索引，执行计划可以让我们清楚的了解到查询语句的效率，而索引则是优化查询效率的常用手段</li>
                    <li>MongoDB 的复制集，这是提高 MongoDB 可用性，保证数据服务不停机的最佳手段</li>
                    <li>MongoDB 的分片，分片能够在数据量变得庞大之后保证效率</li>
                    <li>MongoDB 的事物，如果你将 MongoDB 用于 WEB 网站，那么事物是你必须学习的知识</li>
                    <li>MongoDB 数据库备份和还原，有了复制集后，备份就显得不是那么重要了，但并不是没有这个需求。而且 MongoDB 的备份可以精细到文档，这就非常有意义了。</li>
                  </ul>
                  <h2 id="学习的选择和困境"><a href="#学习的选择和困境" class="headerlink" title="学习的选择和困境"></a>学习的选择和困境</h2>
                  <p>有一定工作经验的开发者，大多数情况下都会选择自学。有些在网上搜索对应的文章，有些则直接翻阅官方文档。我推荐的方式是翻阅官方文档，在遇到难以理解的观点时通过搜索引擎查找网友分享的文章。 自学的优点很多，缺点也很明显。例如：</p>
                  <ul>
                    <li><strong>断断续续的学习，难以保持专注导致知识吸收不好</strong></li>
                    <li><strong>耗费时间很长，虽然知道应该学习哪些方面的知识，但文档并不是按你所想而规划的，所以翻阅文档要费很多功夫</strong></li>
                    <li><strong>知识不成体系，东看看西看看，没有归纳容易忘记</strong></li>
                    <li><strong>学习就需要记笔记，这又是一件很费时间的事情</strong></li>
                    <li><strong>官方文档有些观点难以理解，卡在半路很难受</strong></li>
                    <li><strong>零星学了一两个月，也不确定学会了没有，内心毫无把握</strong></li>
                  </ul>
                  <p>如果不自学，就得找一些成体系的课程来帮助自己快速进步，少走弯路。知识付费时代，在条件允许的情况下适当地投入也是很好的选择。但面对动辄几百块的视频课程，不少开发者还是感觉略有压力，毕竟我们搬砖的经济压力也非常大。培训班就更不用说了，很少有专业教授单个数据库知识的，而且费用比视频课程更贵。 考虑到这些问题，这里推荐<strong>韦世东</strong>的 GitChat 文章 <strong>《超高性价比的 MongoDB 零基础快速入门实战教程》</strong>，这也是一个收费教程，但它售价不到 10 块钱。文章作者韦世东是：<strong>图灵签约作者、电子工业出版社约稿作者，华为云认证云享专家、掘金社区优秀作者、GitChat 认证作者，开源项目 aiowebsocket 作者</strong>。所以在文章质量上，大家可以放心。 这篇文章的内容几乎囊括了上面我们提到的所有知识点，看完这篇仅 5 万词的文章，你将收获：</p>
                  <ul>
                    <li><strong>文档的 CRUD 操作和 Cursor 对象</strong></li>
                    <li><strong>掌握流式聚合操作，轻松面对任何数据处理需求</strong></li>
                    <li><strong>了解 MongoDB 的查询效率和优化</strong></li>
                    <li><strong>如何提高 MongoDB 的可用性</strong></li>
                    <li><strong>如何应对数据服务故障</strong></li>
                    <li><strong>理解 MongoDB 的访问控制</strong></li>
                    <li><strong>学会用数据模型降低数据冗余，提高效率</strong></li>
                    <li><strong>掌握 mongodump 数据备份与还原方法</strong></li>
                  </ul>
                  <p>这样就可以<strong>胜任日常开发中对数据库操作能力的要求</strong>了。这篇文章适合对 MongoDB 感兴趣的零基础开发者或者有一定基础，想要继续巩固和加深学习的开发者。文章篇幅很长，内容详尽，不乏优质配图，例如描述复制集节点关系的图： <img src="https://ws1.sinaimg.cn/large/007VLJ1tly1g5itduq6uqj30z60jw75s.jpg" alt=""> 描述节主点掉线，重新选举主节点的图 <img src="https://ws1.sinaimg.cn/large/007VLJ1tly1g5itsqu9oqj31880mu0vm.jpg" alt=""> 如果你觉得有学习 MongoDB 的需要，且这篇文章规划的内容是你想要的内容，那么请<strong>长按下方图片识别二维码</strong>，前往订阅文章吧！ <img src="http://ww1.sinaimg.cn/large/006tNc79gy1g5z3r992yqj30ku102k12.jpg" alt=""></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/韦世东学算法和反爬虫" class="author" itemprop="url" rel="index">韦世东学算法和反爬虫</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-08-14 20:22:07" itemprop="dateCreated datePublished" datetime="2019-08-14T20:22:07+08:00">2019-08-14</time>
                </span>
                <span id="/7121.html" class="post-meta-item leancloud_visitors" data-flag-title="如何学好 MongoDB" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>3.2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/7080.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/7080.html" class="post-title-link" itemprop="url">利用 Python Faker 包来制作假数据</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>在做程序开发的时候，我们经常会用到一些测试数据，相信大多数同学是这么来造测试数据的：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">test1</span><br><span class="line">test01</span><br><span class="line">test02</span><br><span class="line">测试<span class="number">1</span></span><br><span class="line">测试<span class="number">2</span></span><br><span class="line">测试数据<span class="number">1</span></span><br><span class="line">这是一段测试文本</span><br><span class="line">这是一段很长很长很长的测试文本...</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>中枪的请举手。 不仅要自己手动敲这些测试数据，还敲的这么假。那有啥办法呢？难不成有什么东西能自动给我造点以假乱真的数据啊？你别说，还真有！ 在 Python 中有个神库，叫做 Faker，它可以自动帮我们来生成各种各样的看起来很真的”假“数据，让我们来看看吧！</p>
                  <h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2>
                  <p>首先让我们来看看这个库的安装方法，实际上装起来非常简单，使用 pip 安装即可，Python3 版本的安装命令如下：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> faker</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>安装好了之后，我们使用最简单的例子来生成几个假数据试试：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from faker import Faker</span><br><span class="line"></span><br><span class="line">faker = Faker()</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">'name:'</span>, faker.name()</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">'address:'</span>, faker.address()</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">'text:'</span>, faker.text()</span></span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>首先我们从 faker 这个包里面导入一个 Faker 类，然后将其实例化为 faker 对象，依次调用它的 name、address、text 方法，看下运行效果：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="type">name</span>: Nicholas Wilson</span><br><span class="line">address: <span class="number">70561</span> Simmons Road Apt. <span class="number">893</span></span><br><span class="line">Lake Raymondville, HI <span class="number">35240</span></span><br><span class="line"><span class="type">text</span>: <span class="keyword">Both</span> <span class="keyword">begin</span> bring federal space.</span><br><span class="line">Official <span class="keyword">start</span> idea specific. Able under young fire.</span><br><span class="line">Who <span class="keyword">show</span> <span class="type">line</span> traditional easy people. <span class="keyword">Until</span> economic lead event <span class="keyword">case</span>. Technology college his director style.</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>看到这里给我们生成了看起来很真的英文姓名、地址、长文本。 但我们是中国人，我们肯定想要生成中文的吧，不用担心，这个库对非常多的语言都有支持，当然也包括中文了，具体的支持的语言列表可以见：<a href="https://faker.readthedocs.io/en/master/locales.html" target="_blank" rel="noopener">https://faker.readthedocs.io/en/master/locales.html</a>。 这里几个比较常见的语言代号列一下：</p>
                  <ul>
                    <li>简体中文：zh_CN</li>
                    <li>繁体中文：zh_TW</li>
                    <li>美国英文：en_US</li>
                    <li>英国英文：en_GB</li>
                    <li>德文：de_DE</li>
                    <li>日文：ja_JP</li>
                    <li>韩文：ko_KR</li>
                    <li>法文：fr_FR</li>
                  </ul>
                  <p>那么如果要生成中文，只需要在 Faker 类的第一个参数传入对应的语言代号即可，例如简体中文就传入 zh_CN，所以上面的代码改写如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from faker import Faker</span><br><span class="line"></span><br><span class="line">faker = Faker(<span class="string">'zh_CN'</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">'name:'</span>, faker.name()</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">'address:'</span>, faker.address()</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">'text:'</span>, faker.text()</span></span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight erlang">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">name: 何琳</span><br><span class="line">address: 宁夏回族自治区六盘水县南溪北镇街f座 <span class="number">912311</span></span><br><span class="line">text: 经营软件积分开始次数专业.美国留言一种管理人民解决两个.支持只有地方一切.</span><br><span class="line">文化目前东西的是不过所以.系统觉得这种为什一下他们.时候以及这样继续是一状态威望.</span><br><span class="line">网站密码情况.问题一点那个还是.其实过程详细.</span><br><span class="line">中国历史环境电话规定.经验上海控制不要生活.朋友运行项目我们.</span><br><span class="line">以后今天那些使用免费国家加入但是.内容简介空间次数最大一个.日期通过得到日本北京.</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到一段中文的姓名、地址、长文本便生成了。看起来地址是省份、地级市、县级市、街道是随机组合的，文本也是一些随机的词组合而成的，但其实这样已经比文章一开头列的测试数据强太多了。 上面的代码每次运行得到的结果都是不同的，因为生成的结果都是随机组合而成的。</p>
                  <h2 id="Provider"><a href="#Provider" class="headerlink" title="Provider"></a>Provider</h2>
                  <p>接下来让我们详细看下 faker 可以都生成什么类型的数据，具体的可用 API 可以看 <a href="https://faker.readthedocs.io/en/master/locales/zh_CN.html" target="_blank" rel="noopener">https://faker.readthedocs.io/en/master/locales/zh_CN.html</a>，这里面列出来了可用的所有方法。 但打开之后可以发现，这里面多了一个 Provider 对象，那么这个 Provider 是怎么一回事呢？ 实际上这个 faker 库在设计上，为了解耦，将 Provider 对象做成了 Faker 对象的”插件“。Faker 可以添加一个个 Provider 对象，Provider 对象为 Faker 对象提供了生成某项数据的核心实现。就相当于 Faker 对象是一个生成器，它的生成功能依赖于什么呢？依赖于 Provider，是 Provider 提供给了 Faker 对象生成某项数据的能力。 正是因为 Faker 对象内置了一些 Provider 对象，Faker 对象才可以生成刚才所要求的姓名、地址和文本。 那么这时候我们肯定就很好奇了，既然 Faker 对象有生成数据的能力，那么它一定内置了一些默认的 Provider 对象，下面我们来打印看一下：</p>
                  <figure class="highlight isbl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">from</span> <span class="variable">faker</span> <span class="variable">import</span> <span class="variable">Faker</span></span><br><span class="line"></span><br><span class="line"><span class="variable">faker</span> = <span class="function"><span class="title">Faker</span>(<span class="string">'zh_CN'</span>)</span></span><br><span class="line"><span class="function"><span class="title">print</span>(<span class="variable">faker.providers</span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[&lt;faker<span class="selector-class">.providers</span><span class="selector-class">.user_agent</span><span class="selector-class">.Provider</span> <span class="selector-tag">object</span> at <span class="number">0</span>x10249de48&gt;, &lt;faker<span class="selector-class">.providers</span><span class="selector-class">.ssn</span><span class="selector-class">.zh_CN</span><span class="selector-class">.Provider</span> <span class="selector-tag">object</span> at <span class="number">0</span>x10249dc18&gt;, &lt;faker<span class="selector-class">.providers</span><span class="selector-class">.python</span><span class="selector-class">.Provider</span> <span class="selector-tag">object</span> at <span class="number">0</span>x10249dd68&gt;, &lt;faker<span class="selector-class">.providers</span><span class="selector-class">.profile</span><span class="selector-class">.Provider</span> <span class="selector-tag">object</span> at <span class="number">0</span>x10249dcc0&gt;, &lt;faker<span class="selector-class">.providers</span><span class="selector-class">.phone_number</span><span class="selector-class">.zh_CN</span><span class="selector-class">.Provider</span> <span class="selector-tag">object</span> at <span class="number">0</span>x10249dc88&gt;, &lt;faker<span class="selector-class">.providers</span><span class="selector-class">.person</span><span class="selector-class">.zh_CN</span><span class="selector-class">.Provider</span> <span class="selector-tag">object</span> at <span class="number">0</span>x10249de80&gt;, &lt;faker<span class="selector-class">.providers</span><span class="selector-class">.misc</span><span class="selector-class">.Provider</span> <span class="selector-tag">object</span> at <span class="number">0</span>x10249df60&gt;, &lt;faker<span class="selector-class">.providers</span><span class="selector-class">.lorem</span><span class="selector-class">.zh_CN</span><span class="selector-class">.Provider</span> <span class="selector-tag">object</span> at <span class="number">0</span>x10249dc50&gt;, &lt;faker<span class="selector-class">.providers</span><span class="selector-class">.job</span><span class="selector-class">.zh_CN</span><span class="selector-class">.Provider</span> <span class="selector-tag">object</span> at <span class="number">0</span>x10249de10&gt;, &lt;faker<span class="selector-class">.providers</span><span class="selector-class">.isbn</span><span class="selector-class">.Provider</span> <span class="selector-tag">object</span> at <span class="number">0</span>x10249c6d8&gt;, &lt;faker<span class="selector-class">.providers</span><span class="selector-class">.internet</span><span class="selector-class">.zh_CN</span><span class="selector-class">.Provider</span> <span class="selector-tag">object</span> at <span class="number">0</span>x10249c828&gt;, &lt;faker<span class="selector-class">.providers</span><span class="selector-class">.geo</span><span class="selector-class">.en_US</span><span class="selector-class">.Provider</span> <span class="selector-tag">object</span> at <span class="number">0</span>x102484748&gt;, &lt;faker<span class="selector-class">.providers</span><span class="selector-class">.file</span><span class="selector-class">.Provider</span> <span class="selector-tag">object</span> at <span class="number">0</span>x102484828&gt;, &lt;faker<span class="selector-class">.providers</span><span class="selector-class">.date_time</span><span class="selector-class">.en_US</span><span class="selector-class">.Provider</span> <span class="selector-tag">object</span> at <span class="number">0</span>x1023789e8&gt;, &lt;faker<span class="selector-class">.providers</span><span class="selector-class">.currency</span><span class="selector-class">.Provider</span> <span class="selector-tag">object</span> at <span class="number">0</span>x102484780&gt;, &lt;faker<span class="selector-class">.providers</span><span class="selector-class">.credit_card</span><span class="selector-class">.Provider</span> <span class="selector-tag">object</span> at <span class="number">0</span>x1024845f8&gt;, &lt;faker<span class="selector-class">.providers</span><span class="selector-class">.company</span><span class="selector-class">.zh_CN</span><span class="selector-class">.Provider</span> <span class="selector-tag">object</span> at <span class="number">0</span>x102499ef0&gt;, &lt;faker<span class="selector-class">.providers</span><span class="selector-class">.color</span><span class="selector-class">.en_US</span><span class="selector-class">.Provider</span> <span class="selector-tag">object</span> at <span class="number">0</span>x1023532e8&gt;, &lt;faker<span class="selector-class">.providers</span><span class="selector-class">.barcode</span><span class="selector-class">.Provider</span> <span class="selector-tag">object</span> at <span class="number">0</span>x101cb6d30&gt;, &lt;faker<span class="selector-class">.providers</span><span class="selector-class">.bank</span><span class="selector-class">.en_GB</span><span class="selector-class">.Provider</span> <span class="selector-tag">object</span> at <span class="number">0</span>x102378f98&gt;, &lt;faker<span class="selector-class">.providers</span><span class="selector-class">.automotive</span><span class="selector-class">.en_US</span><span class="selector-class">.Provider</span> <span class="selector-tag">object</span> at <span class="number">0</span>x1017a5c50&gt;, &lt;faker<span class="selector-class">.providers</span><span class="selector-class">.address</span><span class="selector-class">.zh_CN</span><span class="selector-class">.Provider</span> <span class="selector-tag">object</span> at <span class="number">0</span>x101787c18&gt;]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>还真不少，通过名字可以看到有 user_agent、phone_number、isbn、credit_card 等 Provider，其中具有语言差异化的 Provider 还单独区分了语言，比如 phone_number 代表电话号码，这个不同语言的不同，所以这里就又分了一层 zh_CN，作了语言的区分。 这样一来，通用的 Provider 就直接处在某个 Provider 类别的模块中，具有语言差异的 Provider 就又根据不同的语言进一步划分了模块，设计上非常科学，易扩展又不冗余。 知道了 Faker 具有这么多 Provider 之后，我们来看看刚才调用的 name、address 等方法又和 Provider 有什么关系呢？ 我们将 name、address、text 等方法打印一下看看：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from faker import Faker</span><br><span class="line"></span><br><span class="line">faker = Faker(<span class="string">'zh_CN'</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">'name:'</span>, faker.name)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">'address:'</span>, faker.address)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">'text:'</span>, faker.text)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>注意这里没有调用，而是直接打印了这三个方法，这样可以直接输出方法的对象形式的描述，结果如下：</p>
                  <figure class="highlight oxygene">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">name: &lt;bound <span class="function"><span class="keyword">method</span> <span class="title">Provider</span>.<span class="title">name</span> <span class="title">of</span> &lt;<span class="title">faker</span>.<span class="title">providers</span>.<span class="title">person</span>.<span class="title">zh_CN</span>.<span class="title">Provider</span> <span class="title">object</span> <span class="title">at</span> 0<span class="title">x10f6dea58</span>&gt;&gt;</span></span><br><span class="line"><span class="function"><span class="title">address</span>:</span> &lt;bound <span class="function"><span class="keyword">method</span> <span class="title">Provider</span>.<span class="title">address</span> <span class="title">of</span> &lt;<span class="title">faker</span>.<span class="title">providers</span>.<span class="title">address</span>.<span class="title">zh_CN</span>.<span class="title">Provider</span> <span class="title">object</span> <span class="title">at</span> 0<span class="title">x10e9e6cf8</span>&gt;&gt;</span></span><br><span class="line"><span class="function"><span class="title">text</span>:</span> &lt;bound <span class="function"><span class="keyword">method</span> <span class="title">Provider</span>.<span class="title">text</span> <span class="title">of</span> &lt;<span class="title">faker</span>.<span class="title">providers</span>.<span class="title">lorem</span>.<span class="title">zh_CN</span>.<span class="title">Provider</span> <span class="title">object</span> <span class="title">at</span> 0<span class="title">x10f6dfda0</span>&gt;&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>恍然大悟，原来我们调用的方法就是 Faker 对象调用的 Provider 里面的对应方法，比如 name 就是 faker.providers.person.zh<em>CN.Provider 里面的 name 方法，二者是一致的，我们扒一扒源码验证下，源码在：[[<a href="https://github.com/joke2k/faker/blob/master/faker/providers/person/__init" target="_blank" rel="noopener">https://github.com/joke2k/faker/blob/master/faker/providers/person/__init</a></em>](<a href="https://github.com/joke2k/faker/blob/master/faker/providers/person/__init_)_.py]([https://github.com/joke2k/faker/blob/master/faker/providers/person/__init__.py)，果不其然，里面定义了](https://github.com/joke2k/faker/blob/master/faker/providers/person/__init__.py)，果不其然，里面定义了" target="_blank" rel="noopener">https://github.com/joke2k/faker/blob/master/faker/providers/person/__init_)_.py]([https://github.com/joke2k/faker/blob/master/faker/providers/person/__init__.py)，果不其然，里面定义了](https://github.com/joke2k/faker/blob/master/faker/providers/person/__init__.py)，果不其然，里面定义了</a>) name 方法，然后 Faker 动态地将这个方法引入进来了，就可以使用了。</p>
                  <h2 id="方法列举"><a href="#方法列举" class="headerlink" title="方法列举"></a>方法列举</h2>
                  <p>既然有这么多 Provider，下面我们再详细地看看还有哪些常用的方法吧，下面进行一部分简单的梳理，参考来源文档地址为：<a href="https://faker.readthedocs.io/en/master/providers.html" target="_blank" rel="noopener">https://faker.readthedocs.io/en/master/providers.html</a>。</p>
                  <h3 id="Address"><a href="#Address" class="headerlink" title="Address"></a>Address</h3>
                  <p>Address，用于生成一些和地址相关的数据，如地址、城市、邮政编码、街道等内容， 用法如下：</p>
                  <figure class="highlight autoit">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">faker.address()</span><br><span class="line"><span class="meta"># <span class="string">'新疆维吾尔自治区杰县南湖武汉街D座 253105'</span></span></span><br><span class="line">faker.building_number()</span><br><span class="line"><span class="meta"># <span class="string">'B座'</span></span></span><br><span class="line">faker.city()</span><br><span class="line"><span class="meta"># <span class="string">'璐县'</span></span></span><br><span class="line">faker.city_name()</span><br><span class="line"><span class="meta"># <span class="string">'贵阳'</span></span></span><br><span class="line">faker.city_suffix()</span><br><span class="line"><span class="meta"># <span class="string">'县'</span></span></span><br><span class="line">faker.country()</span><br><span class="line"><span class="meta"># <span class="string">'阿拉斯加'</span></span></span><br><span class="line">faker.country_code(representation=<span class="string">"alpha-2"</span>)</span><br><span class="line"><span class="meta"># <span class="string">'CR'</span></span></span><br><span class="line">faker.district()</span><br><span class="line"><span class="meta"># <span class="string">'西峰'</span></span></span><br><span class="line">faker.postcode()</span><br><span class="line"><span class="meta"># <span class="string">'726749'</span></span></span><br><span class="line">faker.province()</span><br><span class="line"><span class="meta"># <span class="string">'福建省'</span></span></span><br><span class="line">faker.street_address()</span><br><span class="line"><span class="meta"># <span class="string">'余路N座'</span></span></span><br><span class="line">faker.street_name()</span><br><span class="line"><span class="meta"># <span class="string">'李路'</span></span></span><br><span class="line">faker.street_suffix()</span><br><span class="line"><span class="meta"># <span class="string">'路'</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="Color"><a href="#Color" class="headerlink" title="Color"></a>Color</h3>
                  <p>Color，用于生成和颜色相关的数据，如 HEX、RGB、RGBA 等格式的颜色，用法如下：</p>
                  <figure class="highlight autoit">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">faker.color_name()</span><br><span class="line"><span class="meta"># <span class="string">'DarkKhaki'</span></span></span><br><span class="line">faker.hex_color()</span><br><span class="line"><span class="meta"># <span class="string">'#97d14e'</span></span></span><br><span class="line">faker.rgb_color()</span><br><span class="line"><span class="meta"># <span class="string">'107,179,51'</span></span></span><br><span class="line">faker.rgb_css_color()</span><br><span class="line"><span class="meta"># <span class="string">'rgb(20,46,70)'</span></span></span><br><span class="line">faker.safe_color_name()</span><br><span class="line"><span class="meta"># <span class="string">'navy'</span></span></span><br><span class="line">faker.safe_hex_color()</span><br><span class="line"><span class="meta"># <span class="string">'#dd2200'</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="Company"><a href="#Company" class="headerlink" title="Company"></a>Company</h3>
                  <p>Company，用于生成公司相关数据，如公司名、公司前缀、公司后缀等内容，用法如下：</p>
                  <figure class="highlight autoit">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">faker.bs()</span><br><span class="line"><span class="meta"># <span class="string">'grow rich initiatives'</span></span></span><br><span class="line">faker.catch_phrase()</span><br><span class="line"><span class="meta"># <span class="string">'Self-enabling encompassing function'</span></span></span><br><span class="line">faker.company()</span><br><span class="line"><span class="meta"># <span class="string">'恒聪百汇网络有限公司'</span></span></span><br><span class="line">faker.company_prefix()</span><br><span class="line"><span class="meta"># <span class="string">'晖来计算机'</span></span></span><br><span class="line">faker.company_suffix()</span><br><span class="line"><span class="meta"># <span class="string">'信息有限公司'</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="Credit-Card"><a href="#Credit-Card" class="headerlink" title="Credit Card"></a>Credit Card</h3>
                  <p>Credit Card，用于生成信用卡相关数据，如过期时间、银行卡号、安全码等内容，用法如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">faker.credit_card_expire(<span class="attribute">start</span>=<span class="string">"now"</span>, <span class="attribute">end</span>=<span class="string">"+10y"</span>, <span class="attribute">date_format</span>=<span class="string">"%m/%y"</span>)</span><br><span class="line"><span class="comment"># '08/20'</span></span><br><span class="line">faker.credit_card_full(<span class="attribute">card_type</span>=None)</span><br><span class="line"><span class="comment"># 'Mastercardn玉兰 范n5183689713096897 01/25nCVV: 012n'</span></span><br><span class="line">faker.credit_card_number(<span class="attribute">card_type</span>=None)</span><br><span class="line"><span class="comment"># '4009911097184929918'</span></span><br><span class="line">faker.credit_card_provider(<span class="attribute">card_type</span>=None)</span><br><span class="line"><span class="comment"># 'JCB 15 digit'</span></span><br><span class="line">faker.credit_card_security_code(<span class="attribute">card_type</span>=None)</span><br><span class="line"><span class="comment"># '259'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="Date-Time"><a href="#Date-Time" class="headerlink" title="Date Time"></a>Date Time</h3>
                  <p>Date Time，用于生成时间相关数据，如年份、月份、星期、出生日期等内容，可以返回 datetime 类型的数据，用法如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">faker.am_pm()</span><br><span class="line"><span class="comment"># 'AM'</span></span><br><span class="line">faker.century()</span><br><span class="line"><span class="comment"># 'X'</span></span><br><span class="line">faker.date(<span class="attribute">pattern</span>=<span class="string">"%Y-%m-%d"</span>, <span class="attribute">end_datetime</span>=None)</span><br><span class="line"><span class="comment"># '1997-06-16'</span></span><br><span class="line">faker.date_between(<span class="attribute">start_date</span>=<span class="string">"-30y"</span>, <span class="attribute">end_date</span>=<span class="string">"today"</span>)</span><br><span class="line"><span class="comment"># datetime.date(2000, 8, 30)</span></span><br><span class="line">faker.date_between_dates(<span class="attribute">date_start</span>=None, <span class="attribute">date_end</span>=None)</span><br><span class="line"><span class="comment"># datetime.date(2019, 7, 30)</span></span><br><span class="line">faker.date_object(<span class="attribute">end_datetime</span>=None)</span><br><span class="line"><span class="comment"># datetime.date(1978, 3, 12)</span></span><br><span class="line">faker.date_of_birth(<span class="attribute">tzinfo</span>=None, <span class="attribute">minimum_age</span>=0, <span class="attribute">maximum_age</span>=115)</span><br><span class="line"><span class="comment"># datetime.date(2012, 6, 3)</span></span><br><span class="line">faker.date_this_century(<span class="attribute">before_today</span>=<span class="literal">True</span>, <span class="attribute">after_today</span>=<span class="literal">False</span>)</span><br><span class="line"><span class="comment"># datetime.date(2011, 6, 12)</span></span><br><span class="line">faker.date_this_decade(<span class="attribute">before_today</span>=<span class="literal">True</span>, <span class="attribute">after_today</span>=<span class="literal">False</span>)</span><br><span class="line"><span class="comment"># datetime.date(2011, 8, 22)</span></span><br><span class="line">faker.date_this_month(<span class="attribute">before_today</span>=<span class="literal">True</span>, <span class="attribute">after_today</span>=<span class="literal">False</span>)</span><br><span class="line"><span class="comment"># datetime.date(2019, 7, 25)</span></span><br><span class="line">faker.date_this_year(<span class="attribute">before_today</span>=<span class="literal">True</span>, <span class="attribute">after_today</span>=<span class="literal">False</span>)</span><br><span class="line"><span class="comment"># datetime.date(2019, 7, 22)</span></span><br><span class="line">faker.date_time(<span class="attribute">tzinfo</span>=None, <span class="attribute">end_datetime</span>=None)</span><br><span class="line"><span class="comment"># datetime.datetime(2018, 8, 11, 22, 3, 34)</span></span><br><span class="line">faker.date_time_ad(<span class="attribute">tzinfo</span>=None, <span class="attribute">end_datetime</span>=None, <span class="attribute">start_datetime</span>=None)</span><br><span class="line"><span class="comment"># datetime.datetime(1566, 8, 26, 16, 25, 30)</span></span><br><span class="line">faker.date_time_between(<span class="attribute">start_date</span>=<span class="string">"-30y"</span>, <span class="attribute">end_date</span>=<span class="string">"now"</span>, <span class="attribute">tzinfo</span>=None)</span><br><span class="line"><span class="comment"># datetime.datetime(2015, 1, 31, 4, 14, 10)</span></span><br><span class="line">faker.date_time_between_dates(<span class="attribute">datetime_start</span>=None, <span class="attribute">datetime_end</span>=None, <span class="attribute">tzinfo</span>=None)</span><br><span class="line"><span class="comment"># datetime.datetime(2019, 7, 30, 17, 51, 44)</span></span><br><span class="line">faker.date_time_this_century(<span class="attribute">before_now</span>=<span class="literal">True</span>, <span class="attribute">after_now</span>=<span class="literal">False</span>, <span class="attribute">tzinfo</span>=None)</span><br><span class="line"><span class="comment"># datetime.datetime(2002, 9, 25, 23, 59, 49)</span></span><br><span class="line">faker.date_time_this_decade(<span class="attribute">before_now</span>=<span class="literal">True</span>, <span class="attribute">after_now</span>=<span class="literal">False</span>, <span class="attribute">tzinfo</span>=None)</span><br><span class="line"><span class="comment"># datetime.datetime(2010, 5, 25, 20, 20, 52)</span></span><br><span class="line">faker.date_time_this_month(<span class="attribute">before_now</span>=<span class="literal">True</span>, <span class="attribute">after_now</span>=<span class="literal">False</span>, <span class="attribute">tzinfo</span>=None)</span><br><span class="line"><span class="comment"># datetime.datetime(2019, 7, 19, 18, 4, 6)</span></span><br><span class="line">faker.date_time_this_year(<span class="attribute">before_now</span>=<span class="literal">True</span>, <span class="attribute">after_now</span>=<span class="literal">False</span>, <span class="attribute">tzinfo</span>=None)</span><br><span class="line"><span class="comment"># datetime.datetime(2019, 3, 15, 11, 4, 18)</span></span><br><span class="line">faker.day_of_month()</span><br><span class="line"><span class="comment"># '04'</span></span><br><span class="line">faker.day_of_week()</span><br><span class="line"><span class="comment"># 'Monday'</span></span><br><span class="line">faker.future_date(<span class="attribute">end_date</span>=<span class="string">"+30d"</span>, <span class="attribute">tzinfo</span>=None)</span><br><span class="line"><span class="comment"># datetime.date(2019, 8, 12)</span></span><br><span class="line">faker.future_datetime(<span class="attribute">end_date</span>=<span class="string">"+30d"</span>, <span class="attribute">tzinfo</span>=None)</span><br><span class="line"><span class="comment"># datetime.datetime(2019, 8, 24, 2, 59, 4)</span></span><br><span class="line">faker.iso8601(<span class="attribute">tzinfo</span>=None, <span class="attribute">end_datetime</span>=None)</span><br><span class="line"><span class="comment"># '1987-07-01T18:33:56'</span></span><br><span class="line">faker.month()</span><br><span class="line"><span class="comment"># '11'</span></span><br><span class="line">faker.month_name()</span><br><span class="line"><span class="comment"># 'August'</span></span><br><span class="line">faker.past_date(<span class="attribute">start_date</span>=<span class="string">"-30d"</span>, <span class="attribute">tzinfo</span>=None)</span><br><span class="line"><span class="comment"># datetime.date(2019, 7, 25)</span></span><br><span class="line">faker.past_datetime(<span class="attribute">start_date</span>=<span class="string">"-30d"</span>, <span class="attribute">tzinfo</span>=None)</span><br><span class="line"><span class="comment"># datetime.datetime(2019, 7, 18, 22, 46, 51)</span></span><br><span class="line">faker.time(<span class="attribute">pattern</span>=<span class="string">"%H:%M:%S"</span>, <span class="attribute">end_datetime</span>=None)</span><br><span class="line"><span class="comment"># '16:22:30'</span></span><br><span class="line">faker.time_delta(<span class="attribute">end_datetime</span>=None)</span><br><span class="line"><span class="comment"># datetime.timedelta(0)</span></span><br><span class="line">faker.time_object(<span class="attribute">end_datetime</span>=None)</span><br><span class="line"><span class="comment"># datetime.time(22, 12, 15)</span></span><br><span class="line">faker.time_series(<span class="attribute">start_date</span>=<span class="string">"-30d"</span>, <span class="attribute">end_date</span>=<span class="string">"now"</span>, <span class="attribute">precision</span>=None, <span class="attribute">distrib</span>=None, <span class="attribute">tzinfo</span>=None)</span><br><span class="line"><span class="comment"># &lt;generator object Provider.time_series at 0x7fcbce0604f8&gt;</span></span><br><span class="line">faker.timezone()</span><br><span class="line"><span class="comment"># 'Indian/Comoro'</span></span><br><span class="line">faker.unix_time(<span class="attribute">end_datetime</span>=None, <span class="attribute">start_datetime</span>=None)</span><br><span class="line"><span class="comment"># 1182857626</span></span><br><span class="line">faker.year()</span><br><span class="line"><span class="comment"># '1970'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="File"><a href="#File" class="headerlink" title="File"></a>File</h3>
                  <p>File，用于生成文件和文件路径相关的数据，包括文件扩展名、文件路径、MIME_TYPE、磁盘分区等内容，用法如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">faker.file_extension(<span class="attribute">category</span>=None)</span><br><span class="line"><span class="comment"># 'flac'</span></span><br><span class="line">faker.file_name(<span class="attribute">category</span>=None, <span class="attribute">extension</span>=None)</span><br><span class="line"><span class="comment"># '然后.numbers'</span></span><br><span class="line">faker.file_path(<span class="attribute">depth</span>=1, <span class="attribute">category</span>=None, <span class="attribute">extension</span>=None)</span><br><span class="line"><span class="comment"># '/关系/科技.mov'</span></span><br><span class="line">faker.mime_type(<span class="attribute">category</span>=None)</span><br><span class="line"><span class="comment"># 'video/ogg'</span></span><br><span class="line">faker.unix_device(<span class="attribute">prefix</span>=None)</span><br><span class="line"><span class="comment"># '/dev/sdd'</span></span><br><span class="line">faker.unix_partition(<span class="attribute">prefix</span>=None)</span><br><span class="line"><span class="comment"># '/dev/xvds3'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="Geo"><a href="#Geo" class="headerlink" title="Geo"></a>Geo</h3>
                  <p>Geo，用于生成和地理位置相关的数据，包括经纬度，时区等等信息，用法如下：</p>
                  <figure class="highlight less">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">faker</span><span class="selector-class">.coordinate</span>(center=None, radius=<span class="number">0.001</span>)</span><br><span class="line"># <span class="selector-tag">Decimal</span>(<span class="string">'-114.420686'</span>)</span><br><span class="line"><span class="selector-tag">faker</span><span class="selector-class">.latitude</span>()</span><br><span class="line"># <span class="selector-tag">Decimal</span>(<span class="string">'-9.772541'</span>)</span><br><span class="line"><span class="selector-tag">faker</span><span class="selector-class">.latlng</span>()</span><br><span class="line"># (Decimal(<span class="string">'-27.0730915'</span>), Decimal(<span class="string">'-5.919460'</span>))</span><br><span class="line"><span class="selector-tag">faker</span><span class="selector-class">.local_latlng</span>(country_code=<span class="string">"US"</span>, coords_only=False)</span><br><span class="line"># (<span class="string">'41.47892'</span>, <span class="string">'-87.45476'</span>, <span class="string">'Schererville'</span>, <span class="string">'US'</span>, <span class="string">'America/Chicago'</span>)</span><br><span class="line"><span class="selector-tag">faker</span><span class="selector-class">.location_on_land</span>(coords_only=False)</span><br><span class="line"># (<span class="string">'12.74482'</span>, <span class="string">'4.52514'</span>, <span class="string">'Argungu'</span>, <span class="string">'NG'</span>, <span class="string">'Africa/Lagos'</span>)</span><br><span class="line"><span class="selector-tag">faker</span><span class="selector-class">.longitude</span>()</span><br><span class="line"># <span class="selector-tag">Decimal</span>(<span class="string">'40.885895'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="Internet"><a href="#Internet" class="headerlink" title="Internet"></a>Internet</h3>
                  <p>Internet，用于生成和互联网相关的数据，包括随机电子邮箱、域名、IP 地址、URL、用户名、后缀名等内容，用法如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">faker.ascii_company_email(<span class="number">*a</span>rgs, **kwargs)</span><br><span class="line"><span class="comment"># 'xuna@xiaqian.cn'</span></span><br><span class="line">faker.ascii_email(<span class="number">*a</span>rgs, **kwargs)</span><br><span class="line"><span class="comment"># 'min59@60.cn'</span></span><br><span class="line">faker.ascii_free_email(<span class="number">*a</span>rgs, **kwargs)</span><br><span class="line"><span class="comment"># 'min75@gmail.com'</span></span><br><span class="line">faker.ascii_safe_email(<span class="number">*a</span>rgs, **kwargs)</span><br><span class="line"><span class="comment"># 'cliu@example.com'</span></span><br><span class="line">faker.company_email(<span class="number">*a</span>rgs, **kwargs)</span><br><span class="line"><span class="comment"># 'ilong@99.cn'</span></span><br><span class="line">faker.domain_name(<span class="attribute">levels</span>=1)</span><br><span class="line"><span class="comment"># 'xiulan.cn'</span></span><br><span class="line">faker.domain_word(<span class="number">*a</span>rgs, **kwargs)</span><br><span class="line"><span class="comment"># 'luo'</span></span><br><span class="line">faker.email(<span class="number">*a</span>rgs, **kwargs)</span><br><span class="line"><span class="comment"># 'maoxiulan@hotmail.com'</span></span><br><span class="line">faker.free_email(<span class="number">*a</span>rgs, **kwargs)</span><br><span class="line"><span class="comment"># 'yanshen@gmail.com'</span></span><br><span class="line">faker.free_email_domain(<span class="number">*a</span>rgs, **kwargs)</span><br><span class="line"><span class="comment"># 'yahoo.com'</span></span><br><span class="line">faker.hostname(<span class="number">*a</span>rgs, **kwargs)</span><br><span class="line"><span class="comment"># 'lt-18.pan.cn'</span></span><br><span class="line">faker.image_url(<span class="attribute">width</span>=None, <span class="attribute">height</span>=None)</span><br><span class="line"><span class="comment"># 'https://placekitten.com/51/201'</span></span><br><span class="line">faker.ipv4(<span class="attribute">network</span>=<span class="literal">False</span>, <span class="attribute">address_class</span>=None, <span class="attribute">private</span>=None)</span><br><span class="line"><span class="comment"># '192.233.68.5'</span></span><br><span class="line">faker.ipv4_network_class()</span><br><span class="line"><span class="comment"># 'a'</span></span><br><span class="line">faker.ipv4_private(<span class="attribute">network</span>=<span class="literal">False</span>, <span class="attribute">address_class</span>=None)</span><br><span class="line"><span class="comment"># '10.9.97.93'</span></span><br><span class="line">faker.ipv4_public(<span class="attribute">network</span>=<span class="literal">False</span>, <span class="attribute">address_class</span>=None)</span><br><span class="line"><span class="comment"># '192.51.22.7'</span></span><br><span class="line">faker.ipv6(<span class="attribute">network</span>=<span class="literal">False</span>)</span><br><span class="line"><span class="comment"># 'de57:9c6f:a38c:9864:10ec:6442:775d:5f02'</span></span><br><span class="line">faker.mac_address()</span><br><span class="line"><span class="comment"># '99:80:5c:ab:8c:a9'</span></span><br><span class="line">faker.safe_email(<span class="number">*a</span>rgs, **kwargs)</span><br><span class="line"><span class="comment"># 'tangjuan@example.net'</span></span><br><span class="line">faker.slug(<span class="number">*a</span>rgs, **kwargs)</span><br><span class="line"><span class="comment"># ''</span></span><br><span class="line">faker.tld()</span><br><span class="line"><span class="comment"># 'cn'</span></span><br><span class="line">faker.uri()</span><br><span class="line"><span class="comment"># 'http://fangfan.org/app/tag/post/'</span></span><br><span class="line">faker.uri_extension()</span><br><span class="line"><span class="comment"># '.php'</span></span><br><span class="line">faker.uri_page()</span><br><span class="line"><span class="comment"># 'about'</span></span><br><span class="line">faker.uri_path(<span class="attribute">deep</span>=None)</span><br><span class="line"><span class="comment"># 'app'</span></span><br><span class="line">faker.url(<span class="attribute">schemes</span>=None)</span><br><span class="line"><span class="comment"># 'http://mingli.cn/'</span></span><br><span class="line">faker.user_name(<span class="number">*a</span>rgs, **kwargs)</span><br><span class="line"><span class="comment"># 'jie54'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="Job"><a href="#Job" class="headerlink" title="Job"></a>Job</h3>
                  <p>Job，用于生成和职业相关的数据，用法如下：</p>
                  <figure class="highlight autoit">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">faker.job()</span><br><span class="line"><span class="meta"># <span class="string">'烫工'</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="Lorem"><a href="#Lorem" class="headerlink" title="Lorem"></a>Lorem</h3>
                  <p>Lorem，用于生成一些假文字数据，包括句子、自然段、长文本、关键词等，另外可以传入不同的参数来控制生成的长度，用法如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">faker.paragraph(<span class="attribute">nb_sentences</span>=3, <span class="attribute">variable_nb_sentences</span>=<span class="literal">True</span>, <span class="attribute">ext_word_list</span>=None)</span><br><span class="line"><span class="comment"># '包括的是报告那些一点.图片地址基本全部.'</span></span><br><span class="line">faker.paragraphs(<span class="attribute">nb</span>=3, <span class="attribute">ext_word_list</span>=None)</span><br><span class="line"><span class="comment"># [   '计划规定这样所以组织商品其中.参加成为不同发表地区.精华科技谢谢大家需要.一下手机上海中文工程.',</span></span><br><span class="line"><span class="comment">#     '非常相关是一就是一个一种文章发生.增加那些以及之后以下你的.',</span></span><br><span class="line"><span class="comment">#     '学生应该出来分析增加关系组织.评论来源朋友注册应该需要单位.感觉最后无法发现选择人民.']</span></span><br><span class="line">faker.sentence(<span class="attribute">nb_words</span>=6, <span class="attribute">variable_nb_words</span>=<span class="literal">True</span>, <span class="attribute">ext_word_list</span>=None)</span><br><span class="line"><span class="comment"># '介绍结果自己解决处理.'</span></span><br><span class="line">faker.sentences(<span class="attribute">nb</span>=3, <span class="attribute">ext_word_list</span>=None)</span><br><span class="line"><span class="comment"># ['查看其实一次学习登录浏览是一他们.', '而且资源的人事情.', '科技价格免费大学教育.']</span></span><br><span class="line">faker.text(<span class="attribute">max_nb_chars</span>=200, <span class="attribute">ext_word_list</span>=None)</span><br><span class="line"><span class="comment"># ('只是当前国内中文所以.威望系统在线虽然.n'</span></span><br><span class="line"><span class="comment">#  '图片人民非常合作这种谢谢更新.名称详细直接社会一直首页完全.n'</span></span><br><span class="line"><span class="comment">#  '重要更多只要市场.必须只是学生音乐.系统美国类别这些一切环境.n'</span></span><br><span class="line"><span class="comment">#  '但是的话人民美国关于.n'</span></span><br><span class="line"><span class="comment">#  '情况专业国际看到研究.音乐环境市场搜索发现.n'</span></span><br><span class="line"><span class="comment">#  '工具还是到了今天位置人民.留言作者品牌工程项目必须.上海精华现在我们新闻应该关系.n'</span></span><br><span class="line"><span class="comment">#  '更新经济能力全部资源如果.手机能够登录国内.')</span></span><br><span class="line">faker.texts(<span class="attribute">nb_texts</span>=3, <span class="attribute">max_nb_chars</span>=200, <span class="attribute">ext_word_list</span>=None)</span><br><span class="line"><span class="comment"># [   '成功可能推荐你的行业.地区而且推荐.n'</span></span><br><span class="line"><span class="comment">#     '网络不断是一主要必须.开始安全服务.n'</span></span><br><span class="line"><span class="comment">#     '应该网上通过以后通过大学.管理要求有关国际阅读当前.为了应该结果点击公司开始怎么.n'</span></span><br><span class="line"><span class="comment">#     '成功一次最大生产网站.这种加入她的地址有限.n'</span></span><br><span class="line"><span class="comment">#     '根据新闻汽车起来非常主题显示必须.有些建设来自作者电话支持.n'</span></span><br><span class="line"><span class="comment">#     '只是资源还是由于经济事情喜欢.为什中文大小得到服务.网络密码是否免费参加一次社区欢迎.',</span></span><br><span class="line"><span class="comment">#     '部门活动技术.商品影响发生行业密码完成.就是部门结果资料学习当然.或者帮助城市要求首页市场教育你们.n'</span></span><br><span class="line"><span class="comment">#     '专业完全分析处理城市大学什么.n'</span></span><br><span class="line"><span class="comment">#     '文件非常国际全部起来积分公司.资料的是电影没有.这是本站需要.n'</span></span><br><span class="line"><span class="comment">#     '合作重要没有现在市场开发空间.您的会员推荐成功教育进行中国.n'</span></span><br><span class="line"><span class="comment">#     '文件不是如果评论.因为经验设备规定.n'</span></span><br><span class="line"><span class="comment">#     '加入一起影响网上大家运行在线如果.工程企业这种以后.',</span></span><br><span class="line"><span class="comment">#     '空间市场出现必须基本电话.显示一个标准其他设计作品.工程不断新闻问题更多更新这么.n'</span></span><br><span class="line"><span class="comment">#     '一起简介网上内容不会.任何知道各种两个.类别事情经营那么投资市场.n'</span></span><br><span class="line"><span class="comment">#     '那些使用介绍公司朋友人民你们浏览.应该表示一点一般说明主要谢谢.电话回复起来经验一个来源加入.n'</span></span><br><span class="line"><span class="comment">#     '地区法律其他表示虽然.参加社会喜欢有限论坛一般发布.类别目前文化可以.n'</span></span><br><span class="line"><span class="comment">#     '报告质量工作主要.企业发布完全.得到名称作者等级两个论坛只要电话.']</span></span><br><span class="line">faker.word(<span class="attribute">ext_word_list</span>=None)</span><br><span class="line"><span class="comment"># '注意'</span></span><br><span class="line">faker.words(<span class="attribute">nb</span>=3, <span class="attribute">ext_word_list</span>=None, <span class="attribute">unique</span>=<span class="literal">False</span>)</span><br><span class="line"><span class="comment"># ['责任', '组织', '以后']</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里每个方法的参数是不同的，具体的参数解释可以见源代码每个方法的注释：<a href="https://github.com/joke2k/faker/blob/master/faker/providers/lorem/__init__.py" target="_blank" rel="noopener">https://github.com/joke2k/faker/blob/master/faker/providers/lorem/<strong>init</strong>.py</a>，</p>
                  <h3 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h3>
                  <p>Misc，用于生成生成一些混淆数据，比如密码、sha1、sha256、md5 等加密后的内容，用法如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">faker.boolean(<span class="attribute">chance_of_getting_true</span>=50)</span><br><span class="line"><span class="comment"># True</span></span><br><span class="line">faker.md5(<span class="attribute">raw_output</span>=<span class="literal">False</span>)</span><br><span class="line"><span class="comment"># '3166fa26ffd3f2a33e020dfe11191ac6'</span></span><br><span class="line">faker.null_boolean()</span><br><span class="line"><span class="comment"># False</span></span><br><span class="line">faker.password(<span class="attribute">length</span>=10, <span class="attribute">special_chars</span>=<span class="literal">True</span>, <span class="attribute">digits</span>=<span class="literal">True</span>, <span class="attribute">upper_case</span>=<span class="literal">True</span>, <span class="attribute">lower_case</span>=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># 'W7Ln8La@%O'</span></span><br><span class="line">faker.sha1(<span class="attribute">raw_output</span>=<span class="literal">False</span>)</span><br><span class="line"><span class="comment"># 'c8301a2a79445439ee5287f38053e4b3a05eac79'</span></span><br><span class="line">faker.sha256(<span class="attribute">raw_output</span>=<span class="literal">False</span>)</span><br><span class="line"><span class="comment"># '1e909d331e20cf241aaa2da894deae5a3a75e5cdc35c053422d9b8e7ccfa0402'</span></span><br><span class="line">faker.uuid4(<span class="attribute">cast_to</span>=&lt;class <span class="string">'str'</span>&gt;)</span><br><span class="line"><span class="comment"># '6e6fe387-6877-48d9-94ea-4263c4c71aa5'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="Person"><a href="#Person" class="headerlink" title="Person"></a>Person</h3>
                  <p>Person，用于生成和人名相关的数据，包括姓氏、名字、全名、英文名等内容，还能区分男女名字，用法如下：</p>
                  <figure class="highlight autoit">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">faker.first_name()</span><br><span class="line"><span class="meta"># <span class="string">'颖'</span></span></span><br><span class="line">faker.first_name_female()</span><br><span class="line"><span class="meta"># <span class="string">'芳'</span></span></span><br><span class="line">faker.first_name_male()</span><br><span class="line"><span class="meta"># <span class="string">'利'</span></span></span><br><span class="line">faker.first_romanized_name()</span><br><span class="line"><span class="meta"># <span class="string">'Jing'</span></span></span><br><span class="line">faker.last_name()</span><br><span class="line"><span class="meta"># <span class="string">'温'</span></span></span><br><span class="line">faker.last_name_female()</span><br><span class="line"><span class="meta"># <span class="string">'寇'</span></span></span><br><span class="line">faker.last_name_male()</span><br><span class="line"><span class="meta"># <span class="string">'陈'</span></span></span><br><span class="line">faker.last_romanized_name()</span><br><span class="line"><span class="meta"># <span class="string">'Lei'</span></span></span><br><span class="line">faker.name()</span><br><span class="line"><span class="meta"># <span class="string">'黄明'</span></span></span><br><span class="line">faker.name_female()</span><br><span class="line"><span class="meta"># <span class="string">'张凯'</span></span></span><br><span class="line">faker.name_male()</span><br><span class="line"><span class="meta"># <span class="string">'黄鹏'</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="User-Agent"><a href="#User-Agent" class="headerlink" title="User-Agent"></a>User-Agent</h3>
                  <p>User-Agent，用于生成和浏览器 User-Agent 相关的内容，可以定制各种浏览器，还可以传入版本信息来控制生成的内容，用法如下：</p>
                  <figure class="highlight autoit">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">faker.chrome(version_from=<span class="number">13</span>, version_to=<span class="number">63</span>, build_from=<span class="number">800</span>, build_to=<span class="number">899</span>)</span><br><span class="line"><span class="meta"># (<span class="string">'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/5332 (KHTML, like Gecko) '</span></span></span><br><span class="line"><span class="meta">#  <span class="string">'Chrome/40.0.837.0 Safari/5332'</span>)</span></span><br><span class="line">faker.firefox()</span><br><span class="line"><span class="meta"># (<span class="string">'Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_8_9; rv:1.9.4.20) '</span></span></span><br><span class="line"><span class="meta">#  <span class="string">'Gecko/2019-05-02 05:58:44 Firefox/3.6.19'</span>)</span></span><br><span class="line">faker.internet_explorer()</span><br><span class="line"><span class="meta"># <span class="string">'Mozilla/5.0 (compatible; MSIE 8.0; Windows NT 5.2; Trident/3.0)'</span></span></span><br><span class="line">faker.linux_platform_token()</span><br><span class="line"><span class="meta"># <span class="string">'X11; Linux i686'</span></span></span><br><span class="line">faker.linux_processor()</span><br><span class="line"><span class="meta"># <span class="string">'x86_64'</span></span></span><br><span class="line">faker.mac_platform_token()</span><br><span class="line"><span class="meta"># <span class="string">'Macintosh; U; PPC Mac OS X 10_12_5'</span></span></span><br><span class="line">faker.mac_processor()</span><br><span class="line"><span class="meta"># <span class="string">'U; Intel'</span></span></span><br><span class="line">faker.opera()</span><br><span class="line"><span class="meta"># <span class="string">'Opera/9.77.(Windows NT 4.0; vi-VN) Presto/2.9.182 Version/11.00'</span></span></span><br><span class="line">faker.safari()</span><br><span class="line"><span class="meta"># (<span class="string">'Mozilla/5.0 (Macintosh; PPC Mac OS X 10_7_1 rv:5.0; or-IN) '</span></span></span><br><span class="line"><span class="meta">#  <span class="string">'AppleWebKit/535.9.4 (KHTML, like Gecko) Version/5.0.2 Safari/535.9.4'</span>)</span></span><br><span class="line">faker.user_agent()</span><br><span class="line"><span class="meta"># <span class="string">'Opera/8.69.(X11; Linux i686; ml-IN) Presto/2.9.170 Version/11.00'</span></span></span><br><span class="line">faker.windows_platform_token()</span><br><span class="line"><span class="meta"># <span class="string">'Windows NT 6.1'</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上仅仅列了一部分，还有更多的功能大家可以查看官方文档的内容，链接为：<a href="https://faker.readthedocs.io/en/master/locales/zh_CN.html" target="_blank" rel="noopener">https://faker.readthedocs.io/en/master/locales/zh_CN.html</a>。</p>
                  <h2 id="其他-Provider"><a href="#其他-Provider" class="headerlink" title="其他 Provider"></a>其他 Provider</h2>
                  <p>另外还有一些社区贡献的 Provider，如 WiFi、微服务相关的，大家可以查看文档的说明，另外需要额外安装这些扩展包并自行添加 Provider，文档见：<a href="https://faker.readthedocs.io/en/master/communityproviders.html" target="_blank" rel="noopener">https://faker.readthedocs.io/en/master/communityproviders.html</a>。 添加 Provider 需要调用 add_provider 方法，用法示例如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> faker <span class="keyword">import</span> Faker</span><br><span class="line"><span class="keyword">from</span> faker.providers <span class="keyword">import</span> <span class="built_in">int</span>ernet</span><br><span class="line"></span><br><span class="line">faker = Faker()</span><br><span class="line">faker.add_provider(<span class="built_in">int</span>ernet)</span><br><span class="line">print(faker.ipv4_private())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>还有更多的内容大家可以参考官方文档，链接：<a href="https://faker.readthedocs.io/" target="_blank" rel="noopener">https://faker.readthedocs.io/</a>。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-08-06 12:24:18" itemprop="dateCreated datePublished" datetime="2019-08-06T12:24:18+08:00">2019-08-06</time>
                </span>
                <span id="/7080.html" class="post-meta-item leancloud_visitors" data-flag-title="利用 Python Faker 包来制作假数据" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>15k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>14 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/7071.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/7071.html" class="post-title-link" itemprop="url">Python 中 typing 模块和类型注解的使用</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="实例引入"><a href="#实例引入" class="headerlink" title="实例引入"></a>实例引入</h2>
                  <p>我们知道 Python 是一种动态语言，在声明一个变量时我们不需要显式地声明它的类型，例如下面的例子：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">a</span> = <span class="number">2</span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">'1 + a ='</span>, <span class="number">1</span> + a)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight basic">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">1 </span>+ a = <span class="number">3</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们首先声明了一个变量 <code>a</code>，并将其赋值为了 2，然后将最后的结果打印出来，程序输出来了正确的结果。但在这个过程中，我们没有声明它到底是什么类型。 但如果这时候我们将 <code>a</code> 变成一个字符串类型，结果会是怎样的呢？改写如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">a</span> = <span class="string">'2'</span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(<span class="string">'1 + a ='</span>, <span class="number">1</span> + a)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight scala">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="type">TypeError</span>: unsupported operand <span class="class"><span class="keyword">type</span>(<span class="params">s</span>) <span class="title">for</span> <span class="title">+</span></span>: <span class="symbol">'in</span>t' and <span class="symbol">'st</span>r'</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>直接报错了，错误原因是我们进行了字符串类型的变量和数值类型变量的加和，两种数据类型不同，是无法进行相加的。 如果我们将上面的语句改写成一个方法定义：</p>
                  <figure class="highlight ruby">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(a)</span></span><span class="symbol">:</span></span><br><span class="line">    <span class="keyword">return</span> a + <span class="number">1</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里定义了一个方法，传入一个参数，然后将其加 1 并返回。 如果这时候如果用下面的方式调用，传入的参数是一个数值类型：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="title">add</span><span class="params">(<span class="number">2</span>)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>则可以正常输出结果 3。但如果我们传入的参数并不是我们期望的类型，比如传入一个字符类型，那么就会同样报刚才类似的错误。 但又由于 Python 的特性，很多情况下我们并不用去声明它的类型，因此从方法定义上面来看，我们实际上是不知道一个方法的参数到底应该传入什么类型的。 这样其实就造成了很多不方便的地方，在某些情况下一些复杂的方法，如果不借助于一些额外的说明，我们是不知道参数到底是什么类型的。 因此，Python 中的类型注解就显得比较重要了。</p>
                  <h2 id="类型注解"><a href="#类型注解" class="headerlink" title="类型注解"></a>类型注解</h2>
                  <p>在 Python 3.5 中，Python PEP 484 引入了类型注解（type hints），在 Python 3.6 中，PEP 526 又进一步引入了变量注解（Variable Annotations），所以上面的代码我们改写成如下写法：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">a:</span> <span class="keyword">int</span> = <span class="number">2</span></span><br><span class="line"><span class="keyword">print</span>(<span class="string">'5 + a ='</span>, <span class="number">5</span> + <span class="keyword">a</span>)</span><br><span class="line"></span><br><span class="line">def <span class="built_in">add</span>(<span class="variable">a:</span> <span class="keyword">int</span>) -&gt; in<span class="variable">t:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">a</span> + <span class="number">1</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>具体的语法是可以归纳为两点：</p>
                  <ul>
                    <li>在声明变量时，变量的后面可以加一个冒号，后面再写上变量的类型，如 int、list 等等。</li>
                    <li>在声明方法返回值的时候，可以在方法的后面加一个箭头，后面加上返回值的类型，如 int、list 等等。</li>
                  </ul>
                  <p>在 <a href="https://www.python.org/dev/peps/pep-0008/#other-recommendations" target="_blank" rel="noopener">PEP 8</a> 中，具体的格式是这样规定的：</p>
                  <ul>
                    <li>在声明变量类型时，变量后方紧跟一个冒号，冒号后面跟一个空格，再跟上变量的类型。</li>
                    <li>在声明方法返回值的时候，箭头左边是方法定义，箭头右边是返回值的类型，箭头左右两边都要留有空格。</li>
                  </ul>
                  <p>有了这样的声明，以后我们如果看到这个方法的定义，我们就知道传入的参数类型了，如调用 add 方法的时候，我们就知道传入的需要是一个数值类型的变量，而不是字符串类型，非常直观。 但值得注意的是，这种类型和变量注解实际上只是一种类型提示，对运行实际上是没有影响的，比如调用 add 方法的时候，我们传入的不是 int 类型，而是一个 float 类型，它也不会报错，也不会对参数进行类型转换，如：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="title">add</span><span class="params">(<span class="number">1.5</span>)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们传入的是一个 float 类型的数值 1.5，看下运行结果：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">2.5</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，运行结果正常输出，而且 1.5 并没有经过强制类型转换变成 1，否则结果会变成 2。 因此，类型和变量注解只是提供了一种提示，对于运行实际上没有任何影响。 不过有了类型注解，一些 IDE 是可以识别出来并提示的，比如 PyCharm 就可以识别出来在调用某个方法的时候参数类型不一致，会提示 WARNING。 比如上面的调用，如果在 PyCharm 中，就会有如下提示内容：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Expected<span class="built_in"> type </span><span class="string">'int'</span>, got <span class="string">'float'</span> instead</span><br><span class="line">This inspection detects<span class="built_in"> type </span>errors <span class="keyword">in</span> function call expressions. Due <span class="keyword">to</span> dynamic dispatch <span class="keyword">and</span> duck typing, this is possible <span class="keyword">in</span> a limited but useful number of cases. Types of function parameters can be specified <span class="keyword">in</span> docstrings <span class="keyword">or</span> <span class="keyword">in</span> Python 3 function annotations.</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外也有一些库是支持类型检查的，比如 mypy，安装之后，利用 mypy 即可检查出 Python 脚本中不符合类型注解的调用情况。 上面只是用一个简单的 int 类型做了实例，下面我们再看下一些相对复杂的数据结构，例如列表、元组、字典等类型怎么样来声明。 可想而知了，列表用 list 表示，元组用 tuple 表示，字典用 dict 来表示，那么很自然地，在声明的时候我们就很自然地写成这样了：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">names:</span> <span class="string">list</span> <span class="string">=</span> <span class="string">['Germey',</span> <span class="string">'Guido'</span><span class="string">]</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">tuple</span> <span class="string">=</span> <span class="string">(3,</span> <span class="number">7</span><span class="string">,</span> <span class="number">4</span><span class="string">)</span></span><br><span class="line"><span class="attr">operations:</span> <span class="string">dict</span> <span class="string">=</span> <span class="string">&#123;'show':</span> <span class="literal">False</span><span class="string">,</span> <span class="attr">'sort':</span> <span class="literal">True</span><span class="string">&#125;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这么看上去没有问题，确实声明为了对应的类型，但实际上并不能反映整个列表、元组的结构，比如我们只通过类型注解是不知道 names 里面的元素是什么类型的，只知道 names 是一个列表 list 类型，实际上里面都是字符串 str 类型。我们也不知道 version 这个元组的每一个元素是什么类型的，实际上是 int 类型。但这些信息我们都无从得知。因此说，仅仅凭借 list、tuple 这样的声明是非常“弱”的，我们需要一种更强的类型声明。 这时候我们就需要借助于 typing 模块了，它提供了非常“强“的类型支持，比如 <code>List[str]</code>、<code>Tuple[int, int, int]</code> 则可以表示由 str 类型的元素组成的列表和由 int 类型的元素组成的长度为 3 的元组。所以上文的声明写法可以改写成下面的样子：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> List, Tuple, Dict</span><br><span class="line"></span><br><span class="line">names: List[str] = [<span class="string">'Germey'</span>, <span class="string">'Guido'</span>]</span><br><span class="line"><span class="keyword">version</span>: Tuple[<span class="type">int</span>, <span class="type">int</span>, <span class="type">int</span>] = (<span class="number">3</span>, <span class="number">7</span>, <span class="number">4</span>)</span><br><span class="line">operations: Dict[str, <span class="type">bool</span>] = &#123;<span class="string">'show'</span>: <span class="keyword">False</span>, <span class="string">'sort'</span>: <span class="keyword">True</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样一来，变量的类型便可以非常直观地体现出来了。 目前 typing 模块也已经被加入到 Python 标准库中，不需要安装第三方模块，我们就可以直接使用了。</p>
                  <h2 id="typing"><a href="#typing" class="headerlink" title="typing"></a>typing</h2>
                  <p>下面我们再来详细看下 typing 模块的具体用法，这里主要会介绍一些常用的注解类型，如 List、Tuple、Dict、Sequence 等等，了解了每个类型的具体使用方法，我们可以得心应手的对任何变量进行声明了。 在引入的时候就直接通过 typing 模块引入就好了，例如：</p>
                  <figure class="highlight capnproto">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="built_in">List</span>, Tuple</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="List"><a href="#List" class="headerlink" title="List"></a>List</h3>
                  <p>List、列表，是 list 的泛型，基本等同于 list，其后紧跟一个方括号，里面代表了构成这个列表的元素类型，如由数字构成的列表可以声明为：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">var: List[<span class="built_in">int</span> <span class="keyword">or</span> <span class="built_in">float</span>] = [<span class="number">2</span>, <span class="number">3.5</span>]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外还可以嵌套声明都是可以的：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">var: List[List[<span class="built_in">int</span>]] = [[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">2</span>, <span class="number">3</span>]]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="Tuple、NamedTuple"><a href="#Tuple、NamedTuple" class="headerlink" title="Tuple、NamedTuple"></a>Tuple、NamedTuple</h3>
                  <p>Tuple、元组，是 tuple 的泛型，其后紧跟一个方括号，方括号中按照顺序声明了构成本元组的元素类型，如 <code>Tuple[X, Y]</code> 代表了构成元组的第一个元素是 X 类型，第二个元素是 Y 类型。 比如想声明一个元组，分别代表姓名、年龄、身高，三个数据类型分别为 str、int、float，那么可以这么声明：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">person: Tuple[str, <span class="built_in">int</span>, <span class="built_in">float</span>] = (<span class="string">'Mike'</span>, <span class="number">22</span>, <span class="number">1.75</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>同样地也可以使用类型嵌套。 NamedTuple，是 collections.namedtuple 的泛型，实际上就和 namedtuple 用法完全一致，但个人其实并不推荐使用 NamedTuple，推荐使用 attrs 这个库来声明一些具有表征意义的类。</p>
                  <h3 id="Dict、Mapping、MutableMapping"><a href="#Dict、Mapping、MutableMapping" class="headerlink" title="Dict、Mapping、MutableMapping"></a>Dict、Mapping、MutableMapping</h3>
                  <p>Dict、字典，是 dict 的泛型；Mapping，映射，是 collections.abc.Mapping 的泛型。根据官方文档，Dict 推荐用于注解返回类型，Mapping 推荐用于注解参数。它们的使用方法都是一样的，其后跟一个中括号，中括号内分别声明键名、键值的类型，如：</p>
                  <figure class="highlight processing">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">def <span class="built_in">size</span>(<span class="built_in">rect</span>: Mapping[<span class="built_in">str</span>, <span class="built_in">int</span>]) -&gt; Dict[<span class="built_in">str</span>, <span class="built_in">int</span>]:</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">'width'</span>: <span class="built_in">rect</span>[<span class="string">'width'</span>] + <span class="number">100</span>, <span class="string">'height'</span>: <span class="built_in">rect</span>[<span class="string">'width'</span>] + <span class="number">100</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里将 Dict 用作了返回值类型注解，将 Mapping 用作了参数类型注解。 MutableMapping 则是 Mapping 对象的子类，在很多库中也经常用 MutableMapping 来代替 Mapping。</p>
                  <h3 id="Set、AbstractSet"><a href="#Set、AbstractSet" class="headerlink" title="Set、AbstractSet"></a>Set、AbstractSet</h3>
                  <p>Set、集合，是 set 的泛型；AbstractSet、是 collections.abc.Set 的泛型。根据官方文档，Set 推荐用于注解返回类型，AbstractSet 用于注解参数。它们的使用方法都是一样的，其后跟一个中括号，里面声明集合中元素的类型，如：</p>
                  <figure class="highlight sql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">def <span class="keyword">describe</span>(s: AbstractSet[<span class="built_in">int</span>]) -&gt; <span class="keyword">Set</span>[<span class="built_in">int</span>]:</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">set</span>(s)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里将 Set 用作了返回值类型注解，将 AbstractSet 用作了参数类型注解。</p>
                  <h3 id="Sequence"><a href="#Sequence" class="headerlink" title="Sequence"></a>Sequence</h3>
                  <p>Sequence，是 collections.abc.Sequence 的泛型，在某些情况下，我们可能并不需要严格区分一个变量或参数到底是列表 list 类型还是元组 tuple 类型，我们可以使用一个更为泛化的类型，叫做 Sequence，其用法类似于 List，如：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">def</span> square(<span class="string">elements:</span> Sequence[<span class="keyword">float</span>]) -&gt; List[<span class="keyword">float</span>]:</span><br><span class="line">    <span class="keyword">return</span> [x ** <span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> elements]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="NoReturn"><a href="#NoReturn" class="headerlink" title="NoReturn"></a>NoReturn</h3>
                  <p>NoReturn，当一个方法没有返回结果时，为了注解它的返回类型，我们可以将其注解为 NoReturn，例如：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">()</span> -&gt; NoReturn:</span></span><br><span class="line">    print(<span class="string">'hello'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="Any"><a href="#Any" class="headerlink" title="Any"></a>Any</h3>
                  <p>Any，是一种特殊的类型，它可以代表所有类型，静态类型检查器的所有类型都与 Any 类型兼容，所有的无参数类型注解和返回类型注解的都会默认使用 Any 类型，也就是说，下面两个方法的声明是完全等价的：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(a)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> a + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(a: Any)</span> -&gt; Any:</span></span><br><span class="line">    <span class="keyword">return</span> a + <span class="number">1</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>原理类似于 object，所有的类型都是 object 的子类。但如果我们将参数声明为 object 类型，静态参数类型检查便会抛出错误，而 Any 则不会，具体可以参考官方文档的说明：<a href="https://docs.python.org/zh-cn/3/library/typing.html?highlight=typing#the-any-type" target="_blank" rel="noopener">https://docs.python.org/zh-cn/3/library/typing.html?highlight=typing#the-any-type</a>。</p>
                  <h3 id="TypeVar"><a href="#TypeVar" class="headerlink" title="TypeVar"></a>TypeVar</h3>
                  <p>TypeVar，我们可以借助它来自定义兼容特定类型的变量，比如有的变量声明为 int、float、None 都是符合要求的，实际就是代表任意的数字或者空内容都可以，其他的类型则不可以，比如列表 list、字典 dict 等等，像这样的情况，我们可以使用 TypeVar 来表示。 例如一个人的身高，便可以使用 int 或 float 或 None 来表示，但不能用 dict 来表示，所以可以这么声明：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">height = <span class="number">1.75</span></span><br><span class="line">Height = TypeVar(<span class="string">'Height'</span>, int, float, <span class="literal">None</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_height</span><span class="params">()</span> -&gt; Height:</span></span><br><span class="line">    <span class="keyword">return</span> height</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们使用 TypeVar 声明了一个 Height 类型，然后将其用于注解方法的返回结果。</p>
                  <h3 id="NewType"><a href="#NewType" class="headerlink" title="NewType"></a>NewType</h3>
                  <p>NewType，我们可以借助于它来声明一些具有特殊含义的类型，例如像 Tuple 的例子一样，我们需要将它表示为 Person，即一个人的含义，但但从表面上声明为 Tuple 并不直观，所以我们可以使用 NewType 为其声明一个类型，如：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">Person</span> = NewType(<span class="string">'Person'</span>, Tuple[str, int, float])</span><br><span class="line"><span class="attr">person</span> = Person((<span class="string">'Mike'</span>, <span class="number">22</span>, <span class="number">1.75</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里实际上 person 就是一个 tuple 类型，我们可以对其像 tuple 一样正常操作。</p>
                  <h3 id="Callable"><a href="#Callable" class="headerlink" title="Callable"></a>Callable</h3>
                  <p>Callable，可调用类型，它通常用来注解一个方法，比如我们刚才声明了一个 add 方法，它就是一个 Callable 类型：</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">print(<span class="name">Callable</span>, type(<span class="name">add</span>), isinstance(<span class="name">add</span>, Callable))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">typing.Callable &lt;<span class="keyword">class</span> '<span class="symbol">function</span>'&gt; <span class="symbol">True</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里虽然二者 add 利用 type 方法得到的结果是 function，但实际上利用 isinstance 方法判断确实是 True。 Callable 在声明的时候需要使用 <code>Callable[[Arg1Type, Arg2Type, ...], ReturnType]</code> 这样的类型注解，将参数类型和返回值类型都要注解出来，例如：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">def</span> date(<span class="string">year:</span> <span class="keyword">int</span>, <span class="string">month:</span> <span class="keyword">int</span>, <span class="string">day:</span> <span class="keyword">int</span>) -&gt; <span class="string">str:</span></span><br><span class="line">    <span class="keyword">return</span> f<span class="string">'&#123;year&#125;-&#123;month&#125;-&#123;day&#125;'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> get_date_fn() -&gt; Callable[[<span class="keyword">int</span>, <span class="keyword">int</span>, <span class="keyword">int</span>], str]:</span><br><span class="line">    <span class="keyword">return</span> date</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里首先声明了一个方法 date，接收三个 int 参数，返回一个 str 结果，get_date_fn 方法返回了这个方法本身，它的返回值类型就可以标记为 Callable，中括号内分别标记了返回的方法的参数类型和返回值类型。</p>
                  <h3 id="Union"><a href="#Union" class="headerlink" title="Union"></a>Union</h3>
                  <p>Union，联合类型，<code>Union[X, Y]</code> 代表要么是 X 类型，要么是 Y 类型。 联合类型的联合类型等价于展平后的类型：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">Union</span>[<span class="keyword">Union</span>[<span class="type">int</span>, str], <span class="type">float</span>] == <span class="keyword">Union</span>[<span class="type">int</span>, str, <span class="type">float</span>]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>仅有一个参数的联合类型会坍缩成参数自身，比如：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">Union</span>[<span class="type">int</span>] == <span class="type">int</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>多余的参数会被跳过，比如：</p>
                  <figure class="highlight axapta">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Union[<span class="keyword">int</span>, <span class="keyword">str</span>, <span class="keyword">int</span>] == Union[<span class="keyword">int</span>, <span class="keyword">str</span>]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在比较联合类型的时候，参数顺序会被忽略，比如：</p>
                  <figure class="highlight axapta">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Union[<span class="keyword">int</span>, <span class="keyword">str</span>] == Union[<span class="keyword">str</span>, <span class="keyword">int</span>]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这个在一些方法参数声明的时候比较有用，比如一个方法，要么传一个字符串表示的方法名，要么直接把方法传过来：</p>
                  <figure class="highlight armasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">def</span> process(<span class="meta">fn</span>: Union[<span class="keyword">str, </span>Callable]):</span><br><span class="line">    <span class="meta">if</span> isinstance(<span class="meta">fn</span>, <span class="keyword">str):</span></span><br><span class="line"><span class="keyword"> </span>       # <span class="keyword">str2fn </span><span class="keyword">and </span>process</span><br><span class="line">        pass</span><br><span class="line">    <span class="meta">elif</span> isinstance(<span class="meta">fn</span>, Callable):</span><br><span class="line">        <span class="meta">fn</span>()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样的声明在一些类库方法定义的时候十分常见。</p>
                  <h3 id="Optional"><a href="#Optional" class="headerlink" title="Optional"></a>Optional</h3>
                  <p>Optional，意思是说这个参数可以为空或已经声明的类型，即 <code>Optional[X]</code> 等价于 <code>Union[X, None]</code>。 但值得注意的是，这个并不等价于可选参数，当它作为参数类型注解的时候，不代表这个参数可以不传递了，而是说这个参数可以传为 None。 如当一个方法执行结果，如果执行完毕就不返回错误信息， 如果发生问题就返回错误信息，则可以这么声明：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">judge</span><span class="params">(result: bool)</span> -&gt; Optional[str]:</span></span><br><span class="line">    <span class="keyword">if</span> result: <span class="keyword">return</span> <span class="string">'Error Occurred'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="Generator"><a href="#Generator" class="headerlink" title="Generator"></a>Generator</h3>
                  <p>如果想代表一个生成器类型，可以使用 Generator，它的声明比较特殊，其后的中括号紧跟着三个参数，分别代表 YieldType、SendType、ReturnType，如：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">echo_round</span><span class="params">()</span> -&gt; Generator[int, float, str]:</span></span><br><span class="line">    sent = <span class="keyword">yield</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> sent &gt;= <span class="number">0</span>:</span><br><span class="line">        sent = <span class="keyword">yield</span> round(sent)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Done'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里 yield 关键字后面紧跟的变量的类型就是 YieldType，yield 返回的结果的类型就是 SendType，最后生成器 return 的内容就是 ReturnType。 当然很多情况下，生成器往往只需要 yield 内容就够了，我们是不需要 SendType 和 ReturnType 的，可以将其设置为空，如：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">infinite_stream</span><span class="params">(start: int)</span> -&gt; Generator[int, <span class="keyword">None</span>, <span class="keyword">None</span>]:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">yield</span> start</span><br><span class="line">        start += <span class="number">1</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="案例实战"><a href="#案例实战" class="headerlink" title="案例实战"></a>案例实战</h2>
                  <p>接下来让我们看一个实际的项目，看看经常用到的类型一般是怎么使用的。 这里我们看的库是 requests-html，是由 Kenneth Reitz 所开发的，其 GitHub 地址为：<a href="https://github.com/psf/requests-html" target="_blank" rel="noopener">https://github.com/psf/requests-html</a>，下面我们主要看看它的源代码中一些类型是如何声明的。 这个库的源代码其实就一个文件，那就是 <a href="https://github.com/psf/requests-html/blob/master/requests_html.py" target="_blank" rel="noopener">https://github.com/psf/requests-html/blob/master/requests_html.py</a>，我们看一下它里面的一些 typing 的定义和方法定义。 首先 Typing 的定义部分如下：</p>
                  <figure class="highlight sqf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> typing import <span class="built_in">Set</span>, Union, <span class="built_in">List</span>, MutableMapping, Optional</span><br><span class="line"></span><br><span class="line"><span class="variable">_Find</span> = Union[<span class="built_in">List</span>[<span class="string">'Element'</span>], <span class="string">'Element'</span>]</span><br><span class="line"><span class="variable">_XPath</span> = Union[<span class="built_in">List</span>[<span class="built_in">str</span>], <span class="built_in">List</span>[<span class="string">'Element'</span>], <span class="built_in">str</span>, <span class="string">'Element'</span>]</span><br><span class="line"><span class="variable">_Result</span> = Union[<span class="built_in">List</span>[<span class="string">'Result'</span>], <span class="string">'Result'</span>]</span><br><span class="line"><span class="variable">_HTML</span> = Union[<span class="built_in">str</span>, bytes]</span><br><span class="line"><span class="variable">_BaseHTML</span> = <span class="built_in">str</span></span><br><span class="line"><span class="variable">_UserAgent</span> = <span class="built_in">str</span></span><br><span class="line"><span class="variable">_DefaultEncoding</span> = <span class="built_in">str</span></span><br><span class="line"><span class="variable">_URL</span> = <span class="built_in">str</span></span><br><span class="line"><span class="variable">_RawHTML</span> = bytes</span><br><span class="line"><span class="variable">_Encoding</span> = <span class="built_in">str</span></span><br><span class="line"><span class="variable">_LXML</span> = HtmlElement</span><br><span class="line"><span class="variable">_Text</span> = <span class="built_in">str</span></span><br><span class="line"><span class="variable">_Search</span> = Result</span><br><span class="line"><span class="variable">_Containing</span> = Union[<span class="built_in">str</span>, <span class="built_in">List</span>[<span class="built_in">str</span>]]</span><br><span class="line"><span class="variable">_Links</span> = <span class="built_in">Set</span>[<span class="built_in">str</span>]</span><br><span class="line"><span class="variable">_Attrs</span> = MutableMapping</span><br><span class="line"><span class="variable">_Next</span> = Union[<span class="string">'HTML'</span>, <span class="built_in">List</span>[<span class="built_in">str</span>]]</span><br><span class="line"><span class="variable">_NextSymbol</span> = <span class="built_in">List</span>[<span class="built_in">str</span>]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里可以看到主要用到的类型有 Set、Union、List、MutableMapping、Optional，这些在上文都已经做了解释，另外这里使用了多次 Union 来声明了一些新的类型，如 <code>_Find</code> 则要么是是 Element 对象的列表，要么是单个 Element 对象，<code>_Result</code> 则要么是 Result 对象的列表，要么是单个 Result 对象。另外 <code>_Attrs</code> 其实就是字典类型，这里用 MutableMapping 来表示了，没有用 Dict，也没有用 Mapping。 接下来再看一个 Element 类的声明：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Element</span><span class="params">(BaseParser)</span>:</span></span><br><span class="line">    <span class="string">"""An element of HTML.</span></span><br><span class="line"><span class="string">    :param element: The element from which to base the parsing upon.</span></span><br><span class="line"><span class="string">    :param url: The URL from which the HTML originated, used for ``absolute_links``.</span></span><br><span class="line"><span class="string">    :param default_encoding: Which encoding to default to.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    __slots__ = [</span><br><span class="line">        <span class="string">'element'</span>, <span class="string">'url'</span>, <span class="string">'skip_anchors'</span>, <span class="string">'default_encoding'</span>, <span class="string">'_encoding'</span>,</span><br><span class="line">        <span class="string">'_html'</span>, <span class="string">'_lxml'</span>, <span class="string">'_pq'</span>, <span class="string">'_attrs'</span>, <span class="string">'session'</span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, *, element, url: _URL, default_encoding: _DefaultEncoding = None)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        super(Element, self).__init__(element=element, url=url, default_encoding=default_encoding)</span><br><span class="line">        self.element = element</span><br><span class="line">        self.tag = element.tag</span><br><span class="line">        self.lineno = element.sourceline</span><br><span class="line">        self._attrs = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span> -&gt; str:</span></span><br><span class="line">        attrs = [<span class="string">'&#123;&#125;=&#123;&#125;'</span>.format(attr, repr(self.attrs[attr])) <span class="keyword">for</span> attr <span class="keyword">in</span> self.attrs]</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&lt;Element &#123;&#125; &#123;&#125;&gt;"</span>.format(repr(self.element.tag), <span class="string">' '</span>.join(attrs))</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">attrs</span><span class="params">(self)</span> -&gt; _Attrs:</span></span><br><span class="line">        <span class="string">"""Returns a dictionary of the attributes of the :class:`Element &lt;Element&gt;`</span></span><br><span class="line"><span class="string">        (`learn more &lt;https://www.w3schools.com/tags/ref_attributes.asp&gt;`_).</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> self._attrs <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            self._attrs = &#123;k: v <span class="keyword">for</span> k, v <span class="keyword">in</span> self.element.items()&#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Split class and rel up, as there are ussually many of them:</span></span><br><span class="line">            <span class="keyword">for</span> attr <span class="keyword">in</span> [<span class="string">'class'</span>, <span class="string">'rel'</span>]:</span><br><span class="line">                <span class="keyword">if</span> attr <span class="keyword">in</span> self._attrs:</span><br><span class="line">                    self._attrs[attr] = tuple(self._attrs[attr].split())</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self._attrs</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里 <code>__init__</code> 方法接收非常多的参数，同时使用 <code>_URL</code> 、<code>_DefaultEncoding</code> 进行了参数类型注解，另外 attrs 方法使用了 <code>_Attrs</code> 进行了返回结果类型注解。 整体看下来，每个参数的类型、返回值都进行了清晰地注解，代码可读性大大提高。 以上便是类型注解和 typing 模块的详细介绍。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-08-04 20:28:17" itemprop="dateCreated datePublished" datetime="2019-08-04T20:28:17+08:00">2019-08-04</time>
                </span>
                <span id="/7071.html" class="post-meta-item leancloud_visitors" data-flag-title="Python 中 typing 模块和类型注解的使用" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>9.2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>8 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/7051.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/7051.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 9.3-付费讯代理、阿布云代理的使用</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>相对免费代理来说，付费代理的稳定性相对更高一点，本节介绍一下爬虫付费代理的相关使用过程。</p>
                  <h3 id="1-付费代理分类"><a href="#1-付费代理分类" class="headerlink" title="1. 付费代理分类"></a>1. 付费代理分类</h3>
                  <p>在这里将付费代理分为两类：</p>
                  <ul>
                    <li>提供接口获取海量代理，按天或者按量付费，如讯代理</li>
                    <li>搭建了代理隧道，直接设置固定域名代理，如阿布云</li>
                  </ul>
                  <p>本节讲解一下这两种代理的使用方法，分别以两家代表性的代理网站为例进行讲解。</p>
                  <h3 id="2-讯代理"><a href="#2-讯代理" class="headerlink" title="2. 讯代理"></a>2. 讯代理</h3>
                  <p>讯代理个人使用过代理有效率还是蛮高的，此处非广告，其官网为：<a href="http://www.xdaili.cn/" target="_blank" rel="noopener">http://www.xdaili.cn/</a>，如图 9-5 所示： <img src="./assets/9-5.png" alt=""> 图 9-5 讯代理官网 有多种类别的代理可供选购，摘抄其官网的各类别代理介绍如下：</p>
                  <ul>
                    <li>优质代理： 适合对代理 IP 需求量非常大，但能接受代理有效时长较短（10~30 分钟)，小部分不稳定的客户</li>
                    <li>独享动态： 适合对代理 IP 稳定性要求非常高，且可以自主控制的客户，支持地区筛选。</li>
                    <li>独享秒切： 适合对代理 IP 稳定性要求非常高，且可以自主控制的客户，快速获取 IP，地区随机分配</li>
                    <li>动态混拨： 适合对代理 IP 需求量大，代理 IP 使用时效短（3 分钟），切换快的客户</li>
                    <li>优质定制： 如果优质代理的套餐不能满足您的需求，请使用定制服务</li>
                  </ul>
                  <p>一般选择第一类别优质代理即可，代理量比较大，但是代理的稳定性没那么高，有一些代理也是不可用的，所以这种代理的使用方式就需要借助于上一节所说的代理池，我们自己再做一次筛选，确保代理可用。 可以购买一天的试一下效果，购买之后会提供一个 API 来提取代理，如图 9-6 所示： <img src="https://cdn.cuiqingcai.com/2019-08-02-060609.jpg" alt=""> 图 9-6 提取页面 比如在这里我的提取 API 为：<a href="http://www.xdaili.cn/ipagent/greatRecharge/getGreatIp?spiderId=da289b78fec24f19b392e04106253f2a&amp;orderno=YZ20177140586mTTnd7&amp;returnType=2&amp;count=20" target="_blank" rel="noopener">http://www.xdaili.cn/ipagent/greatRecharge/getGreatIp?spiderId=da289b78fec24f19b392e04106253f2a&amp;orderno=YZ20177140586mTTnd7&amp;returnType=2&amp;count=20</a>，可能已过期，在此仅做演示。 在这里指定了提取数量为 20，提取格式为 Json，直接访问链接即可提取代理，结果如图 9-7 所示： <img src="https://cdn.cuiqingcai.com/2019-08-02-060621.jpg" alt=""> 图 9-7 提取结果 接下来我们要做的就是解析这个 Json，然后将其放入我们的代理池中。 当然如果信赖讯代理的话也可以不做代理池筛选，直接使用，不过我个人还是推荐再使用代理池筛选一遍，提高可用几率。 根据上一节代理池的写法，我们只需要在 Crawler 中再加入一个 crawl 开头的方法即可。 方法实现如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">def crawl_xdaili(self):</span><br><span class="line">        <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">        获取讯代理</span></span><br><span class="line"><span class="string">        :return: 代理</span></span><br><span class="line"><span class="string">        "</span><span class="string">""</span></span><br><span class="line">        url = <span class="string">'http://www.xdaili.cn/ipagent/greatRecharge/getGreatIp?spiderId=da289b78fec24f19b392e04106253f2a&amp;orderno=YZ20177140586mTTnd7&amp;returnType=2&amp;count=20'</span></span><br><span class="line">        html = get_page(url)</span><br><span class="line">        <span class="keyword">if</span> html:</span><br><span class="line">            result = json.loads(html)</span><br><span class="line">            proxies = result.<span class="builtin-name">get</span>(<span class="string">'RESULT'</span>)</span><br><span class="line">            <span class="keyword">for</span><span class="built_in"> proxy </span><span class="keyword">in</span> proxies:</span><br><span class="line">                yield proxy.<span class="builtin-name">get</span>(<span class="string">'ip'</span>) + <span class="string">':'</span> + proxy.<span class="builtin-name">get</span>(<span class="string">'port'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们就在代理池中接入了讯代理，获取讯代理的结果之后，解析 Json，返回代理即可。 这样代理池运行之后就会抓取和检测该接口返回的代理了，如果可用，那么就会被设为 100，通过代理池接口即可获取到。 以上以讯代理为例说明了此种批量提取代理的使用方法。</p>
                  <h3 id="3-阿布云代理"><a href="#3-阿布云代理" class="headerlink" title="3. 阿布云代理"></a>3. 阿布云代理</h3>
                  <p>阿布云代理提供了代理隧道，代理速度快而且非常稳定，此处依然非广告，其官网为：<a href="https://www.abuyun.com/" target="_blank" rel="noopener">https://www.abuyun.com/</a>，如图 9-8 所示： <img src="https://cdn.cuiqingcai.com/2019-08-02-060629.png" alt=""> 图 9-8 阿布云官网 阿布云的代理主要分为两种，专业版和动态版，另外还有定制版，摘抄官网的介绍如下：</p>
                  <ul>
                    <li>专业版，多个请求锁定一个代理 IP，海量 IP 资源池需求，近 300 个区域全覆盖，代理 IP 可连续使用 1 分钟，适用于请求 IP 连续型业务</li>
                    <li>动态版，每个请求一个随机代理 IP，海量 IP 资源池需求，近 300 个区域全覆盖，适用于爬虫类业务</li>
                    <li>定制版，灵活按照需求定制，定制 IP 区域，定制 IP 使用时长，定制 IP 每秒请求数</li>
                  </ul>
                  <p>关于专业版和动态版的更多介绍可以查看官网：<a href="https://www.abuyun.com/http-proxy/dyn-intro.html" target="_blank" rel="noopener">https://www.abuyun.com/http-proxy/dyn-intro.html</a>。 对于爬虫来说，推荐使用动态版，购买之后可以在后台看到代理隧道的用户名和密码，如图 9-9 所示： <img src="https://cdn.cuiqingcai.com/2019-08-02-060650.jpg" alt=""> 图 9-9 阿布云代理后台 可以发现整个代理的连接域名为 proxy.abuyun.com，端口为 9020，均是固定的，但是使用之后每次的 IP 都会更改，这其实就是利用了代理隧道实现。 其官网原理介绍如下：</p>
                  <ul>
                    <li>云代理通过代理隧道的形式提供高匿名代理服务，支持 HTTP/HTTPS 协议。</li>
                    <li>云代理在云端维护一个全局 IP 池供代理隧道使用，池中的 IP 会不间断更新，以保证同一时刻 IP 池中有几十到几百个可用代理 IP。</li>
                    <li>需要注意的是代理 IP 池中有部分 IP 可能会在当天重复出现多次。</li>
                    <li>动态版 HTTP 代理隧道会为每个请求从 IP 池中挑选一个随机代理 IP。</li>
                    <li>无须切换代理 IP，每一个请求一个随机代理 IP。</li>
                    <li>HTTP 代理隧道有并发请求限制，默认每秒只允许 5 个请求。如果需要更多请求数，请额外购买。</li>
                  </ul>
                  <p>注意默认套餐的并发请求是 5 个，如果需要更多需要另外购买。 使用的教程在官网也有，链接为：<a href="https://www.abuyun.com/http-proxy/dyn-manual-python.html" target="_blank" rel="noopener">https://www.abuyun.com/http-proxy/dyn-manual-python.html</a>，提供了 Requests、Urllib、Scrapy 的接入方式。 以 Requests 为例，接入示例如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://httpbin.org/get'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 代理服务器</span></span><br><span class="line">proxy_host = <span class="string">'proxy.abuyun.com'</span></span><br><span class="line">proxy_port = <span class="string">'9020'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 代理隧道验证信息</span></span><br><span class="line">proxy_user = <span class="string">'H01234567890123D'</span></span><br><span class="line">proxy_pass = <span class="string">'0123456789012345'</span></span><br><span class="line"></span><br><span class="line">proxy_meta = <span class="string">'http://%(user)s:%(pass)s@%(host)s:%(port)s'</span> % &#123;</span><br><span class="line">    <span class="string">'host'</span>: proxy_host,</span><br><span class="line">    <span class="string">'port'</span>: proxy_port,</span><br><span class="line">    <span class="string">'user'</span>: proxy_user,</span><br><span class="line">    <span class="string">'pass'</span>: proxy_pass,</span><br><span class="line">&#125;</span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">'http'</span>: proxy_meta,</span><br><span class="line">    <span class="string">'https'</span>: proxy_meta,</span><br><span class="line">&#125;</span><br><span class="line">response = requests.<span class="builtin-name">get</span>(url, <span class="attribute">proxies</span>=proxies)</span><br><span class="line"><span class="builtin-name">print</span>(response.status_code)</span><br><span class="line"><span class="builtin-name">print</span>(response.text)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里其实就是使用了代理认证，在前面我们也提到过类似的设置方法，运行结果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">200</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"args"</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">"headers"</span>: &#123;</span><br><span class="line">    <span class="attr">"Accept"</span>: <span class="string">"*/*"</span>,</span><br><span class="line">    <span class="attr">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>,</span><br><span class="line">    <span class="attr">"Connection"</span>: <span class="string">"close"</span>,</span><br><span class="line">    <span class="attr">"Host"</span>: <span class="string">"httpbin.org"</span>,</span><br><span class="line">    <span class="attr">"User-Agent"</span>: <span class="string">"python-requests/2.18.1"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"origin"</span>: <span class="string">"60.207.237.111"</span>,</span><br><span class="line">  <span class="attr">"url"</span>: <span class="string">"http://httpbin.org/get"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>输出结果的 origin 即为代理 IP 的实际地址，可以多次运行测试，可以发现每次请求 origin 都会在变化，这就是动态版代理的效果。 这种效果其实跟我们之前的代理池的随机代理效果类似，都是随机取出了一个当前可用代理。 但是此服务相比于维护代理池来说，使用更加方便，配置简单，省时省力，在价格可以接受的情况下，个人推荐此种代理。</p>
                  <h3 id="4-结语"><a href="#4-结语" class="headerlink" title="4. 结语"></a>4. 结语</h3>
                  <p>以上便是付费代理的相关使用方法，稳定性相比免费代理更高，可以自行选购合适的代理。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-08-02 14:07:57" itemprop="dateCreated datePublished" datetime="2019-08-02T14:07:57+08:00">2019-08-02</time>
                </span>
                <span id="/7051.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 9.3-付费讯代理、阿布云代理的使用" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>3.3k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/7048.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/7048.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 9.2-代理池的维护</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>我们在上一节了解了代理的设置方法，利用代理我们可以解决目标网站封 IP 的问题，而在网上又有大量公开的免费代理，其中有一部分可以拿来使用，或者我们也可以购买付费的代理 IP，价格也不贵。但是不论是免费的还是付费的，都不能保证它们每一个都是可用的，毕竟可能其他人也可能在用此 IP 爬取同样的目标站点而被封禁，或者代理服务器突然出故障或网络繁忙。一旦我们选用了一个不可用的代理，势必会影响我们爬虫的工作效率。 所以说，在用代理时，我们需要提前做一下筛选，将不可用的代理剔除掉，保留下可用代理，接下来在获取代理时从可用代理里面取出直接使用就好了。 所以本节我们来搭建一个高效易用的代理池。</p>
                  <h3 id="1-准备工作"><a href="#1-准备工作" class="headerlink" title="1. 准备工作"></a>1. 准备工作</h3>
                  <p>要实现代理池我们首先需要成功安装好了 Redis 数据库并启动服务，另外还需要安装 Aiohttp、Requests、RedisPy、PyQuery、Flask 库，如果没有安装可以参考第一章的安装说明。</p>
                  <h3 id="2-代理池的目标"><a href="#2-代理池的目标" class="headerlink" title="2. 代理池的目标"></a>2. 代理池的目标</h3>
                  <p>代理池要做到易用、高效，我们一般需要做到下面的几个目标：</p>
                  <ul>
                    <li>基本模块分为四块，获取模块、存储模块、检查模块、接口模块。</li>
                    <li>获取模块需要定时去各大代理网站抓取代理，代理可以是免费公开代理也可以是付费代理，代理的形式都是 IP 加端口，尽量从不同来源获取，尽量抓取高匿代理，抓取完之后将可用代理保存到数据库中。</li>
                    <li>存储模块负责存储抓取下来的代理。首先我们需要保证代理不重复，另外我们还需要标识代理的可用情况，而且需要动态实时处理每个代理，所以说，一种比较高效和方便的存储方式就是使用 Redis 的 Sorted Set，也就是有序集合。</li>
                    <li>检测模块需要定时将数据库中的代理进行检测，在这里我们需要设置一个检测链接，最好是爬取哪个网站就检测哪个网站，这样更加有针对性，如果要做一个通用型的代理，那可以设置百度等链接来检测。另外我们需要标识每一个代理的状态，如设置分数标识，100 分代表可用，分数越少代表越不可用，检测一次如果可用，我们可以将其立即设置为 100 满分，也可以在原基础上加 1 分，当不可用，可以将其减 1 分，当减到一定阈值后就直接从数据库移除。通过这样的标识分数，我们就可以区分出代理的可用情况，选用的时候会更有针对性。</li>
                    <li>接口模块需要用 API 来提供对外服务的接口，其实我们可以直接连数据库来取，但是这样就需要知道数据库的连接信息，不太安全，而且需要配置连接，所以一个比较安全和方便的方式就是提供一个 Web API 接口，通过访问接口即可拿到可用代理。另外由于可用代理可能有多个，我们可以提供随机返回一个可用代理的接口，这样保证每个可用代理都可以取到，实现负载均衡。</li>
                  </ul>
                  <p>以上便是设计代理的一些基本思路，那么接下来我们就设计一下整体的架构，然后用代码该实现代理池。</p>
                  <h3 id="3-代理池的架构"><a href="#3-代理池的架构" class="headerlink" title="3. 代理池的架构"></a>3. 代理池的架构</h3>
                  <p>根据上文的描述，代理池的架构可以是这样的，如图 9-1 所示： <img src="https://cdn.cuiqingcai.com/2019-08-02-060342.jpg" alt=""> 图 9-1 代理池架构 代理池分为四个部分，获取模块、存储模块、检测模块、接口模块。</p>
                  <ul>
                    <li>存储模块使用 Redis 的有序集合，用以代理的去重和状态标识，同时它也是中心模块和基础模块，将其他模块串联起来。</li>
                    <li>获取模块定时从代理网站获取代理，将获取的代理传递给存储模块，保存到数据库。</li>
                    <li>检测模块定时通过存储模块获取所有代理，并对其进行检测，根据不同的检测结果对代理设置不同的标识。</li>
                    <li>接口模块通过 Web API 提供服务接口，其内部还是连接存储模块，获取可用的代理。</li>
                  </ul>
                  <h3 id="4-代理池的实现"><a href="#4-代理池的实现" class="headerlink" title="4. 代理池的实现"></a>4. 代理池的实现</h3>
                  <p>接下来我们分别用代码来实现一下这四个模块。</p>
                  <h4 id="存储模块"><a href="#存储模块" class="headerlink" title="存储模块"></a>存储模块</h4>
                  <p>存储在这里我们使用 Redis 的有序集合，集合的每一个元素都是不重复的，对于代理代理池来说，集合的元素就变成了一个个代理，也就是 IP 加端口的形式，如 60.207.237.111:8888，这样的一个代理就是集合的一个元素。另外有序集合的每一个元素还都有一个分数字段，分数是可以重复的，是一个浮点数类型，也可以是整数类型。该集合会根据每一个元素的分数对集合进行排序，数值小的排在前面，数值大的排在后面，这样就可以实现集合元素的排序了。 对于代理池来说，这个分数可以作为我们判断一个代理可用不可用的标志，我们将 100 设为最高分，代表可用，0 设为最低分，代表不可用。从代理池中获取代理的时候会随机获取分数最高的代理，注意这里是随机，这样可以保证每个可用代理都会被调用到。 分数是我们判断代理稳定性的重要标准，在这里我们设置分数规则如下：</p>
                  <ul>
                    <li>分数 100 为可用，检测器会定时循环检测每个代理可用情况，一旦检测到有可用的代理就立即置为 100，检测到不可用就将分数减 1，减至 0 后移除。</li>
                    <li>新获取的代理添加时将分数置为 10，当测试可行立即置 100，不可行分数减 1，减至 0 后移除。</li>
                  </ul>
                  <p>这是一种解决方案，当然可能还有更合理的方案。此方案的设置有一定的原因，在此总结如下：</p>
                  <ul>
                    <li>当检测到代理可用时立即置为 100，这样可以保证所有可用代理有更大的机会被获取到。你可能会说为什么不直接将分数加 1 而是直接设为最高 100 呢？设想一下，我们有的代理是从各大免费公开代理网站获取的，如果一个代理并没有那么稳定，平均五次请求有两次成功，三次失败，如果按照这种方式来设置分数，那么这个代理几乎不可能达到一个高的分数，也就是说它有时是可用的，但是我们筛选是筛选的分数最高的，所以这样的代理就几乎不可能被取到，当然如果想追求代理稳定性的化可以用这种方法，这样可确保分数最高的一定是最稳定可用的。但是在这里我们采取可用即设置 100 的方法，确保只要可用的代理都可以被使用到。</li>
                    <li>当检测到代理不可用时，将分数减 1，减至 0 后移除，一共 100 次机会，也就是说当一个可用代理接下来如果尝试了 100 次都失败了，就一直减分直到移除，一旦成功就重新置回 100，尝试机会越多代表将这个代理拯救回来的机会越多，这样不容易将曾经的一个可用代理丢弃，因为代理不可用的原因可能是网络繁忙或者其他人用此代理请求太过频繁，所以在这里设置为 100 级。</li>
                    <li>新获取的代理分数设置为 10，检测如果不可用就减 1，减到 0 就移除，如果可用就置 100。由于我们很多代理是从免费网站获取的，所以新获取的代理无效的可能性是非常高的，可能不足 10%，所以在这里我们将其设置为 10，检测的机会没有可用代理 100 次那么多，这也可以适当减少开销。</li>
                  </ul>
                  <p>以上便是代理分数的一个设置思路，不一定是最优思路，但个人实测实用性还是比较强的。 所以我们就需要定义一个类来操作数据库的有序集合，定义一些方法来实现分数的设置，代理的获取等等。 实现如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">MAX_SCORE = <span class="number">100</span></span><br><span class="line">MIN_SCORE = <span class="number">0</span></span><br><span class="line">INITIAL_SCORE = <span class="number">10</span></span><br><span class="line">REDIS_HOST = <span class="string">'localhost'</span></span><br><span class="line">REDIS_PORT = <span class="number">6379</span></span><br><span class="line">REDIS_PASSWORD = <span class="literal">None</span></span><br><span class="line">REDIS_KEY = <span class="string">'proxies'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> choice</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RedisClient</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, host=REDIS_HOST, port=REDIS_PORT, password=REDIS_PASSWORD)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        初始化</span></span><br><span class="line"><span class="string">        :param host: Redis 地址</span></span><br><span class="line"><span class="string">        :param port: Redis 端口</span></span><br><span class="line"><span class="string">        :param password: Redis密码</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.db = redis.StrictRedis(host=host, port=port, password=password, decode_responses=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(self, proxy, score=INITIAL_SCORE)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        添加代理，设置分数为最高</span></span><br><span class="line"><span class="string">        :param proxy: 代理</span></span><br><span class="line"><span class="string">        :param score: 分数</span></span><br><span class="line"><span class="string">        :return: 添加结果</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.db.zscore(REDIS_KEY, proxy):</span><br><span class="line">            <span class="keyword">return</span> self.db.zadd(REDIS_KEY, score, proxy)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">random</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        随机获取有效代理，首先尝试获取最高分数代理，如果不存在，按照排名获取，否则异常</span></span><br><span class="line"><span class="string">        :return: 随机代理</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        result = self.db.zrangebyscore(REDIS_KEY, MAX_SCORE, MAX_SCORE)</span><br><span class="line">        <span class="keyword">if</span> len(result):</span><br><span class="line">            <span class="keyword">return</span> choice(result)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result = self.db.zrevrange(REDIS_KEY, <span class="number">0</span>, <span class="number">100</span>)</span><br><span class="line">            <span class="keyword">if</span> len(result):</span><br><span class="line">                <span class="keyword">return</span> choice(result)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">raise</span> PoolEmptyError</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decrease</span><span class="params">(self, proxy)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        代理值减一分，小于最小值则删除</span></span><br><span class="line"><span class="string">        :param proxy: 代理</span></span><br><span class="line"><span class="string">        :return: 修改后的代理分数</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        score = self.db.zscore(REDIS_KEY, proxy)</span><br><span class="line">        <span class="keyword">if</span> score <span class="keyword">and</span> score &gt; MIN_SCORE:</span><br><span class="line">            print(<span class="string">'代理'</span>, proxy, <span class="string">'当前分数'</span>, score, <span class="string">'减1'</span>)</span><br><span class="line">            <span class="keyword">return</span> self.db.zincrby(REDIS_KEY, proxy, <span class="number">-1</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">'代理'</span>, proxy, <span class="string">'当前分数'</span>, score, <span class="string">'移除'</span>)</span><br><span class="line">            <span class="keyword">return</span> self.db.zrem(REDIS_KEY, proxy)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">exists</span><span class="params">(self, proxy)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        判断是否存在</span></span><br><span class="line"><span class="string">        :param proxy: 代理</span></span><br><span class="line"><span class="string">        :return: 是否存在</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">not</span> self.db.zscore(REDIS_KEY, proxy) == <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">max</span><span class="params">(self, proxy)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        将代理设置为MAX_SCORE</span></span><br><span class="line"><span class="string">        :param proxy: 代理</span></span><br><span class="line"><span class="string">        :return: 设置结果</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        print(<span class="string">'代理'</span>, proxy, <span class="string">'可用，设置为'</span>, MAX_SCORE)</span><br><span class="line">        <span class="keyword">return</span> self.db.zadd(REDIS_KEY, MAX_SCORE, proxy)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">count</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        获取数量</span></span><br><span class="line"><span class="string">        :return: 数量</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> self.db.zcard(REDIS_KEY)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">all</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        获取全部代理</span></span><br><span class="line"><span class="string">        :return: 全部代理列表</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> self.db.zrangebyscore(REDIS_KEY, MIN_SCORE, MAX_SCORE)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>首先定义了一些常量，如 MAX_SCORE、MIN_SCORE、INITIAL_SCORE 分别代表最大分数、最小分数、初始分数。REDIS_HOST、REDIS_PORT、REDIS_PASSWORD 分别代表了 Redis 的连接信息，即地址、端口、密码。REDIS_KEY 是有序集合的键名，可以通过它来获取代理存储所使用的有序集合。 接下来定义了一个 RedisClient 类，用以操作 Redis 的有序集合，其中定义了一些方法来对集合中的元素进行处理，主要功能如下：</p>
                  <ul>
                    <li><strong>init</strong>() 方法是初始化的方法，参数是 Redis 的连接信息，默认的连接信息已经定义为常量，在 <strong>init</strong>() 方法中初始化了一个 StrictRedis 的类，建立 Redis 连接。这样当 RedisClient 类初始化的时候就建立了 Redis 的连接。</li>
                    <li>add() 方法向数据库添加代理并设置分数，默认的分数是 INITIAL_SCORE 也就是 10，返回结果是添加的结果。</li>
                    <li>random() 方法是随机获取代理的方法，首先获取 100 分的代理，然后随机选择一个返回，如果不存在 100 分的代理，则按照排名来获取，选取前 100 名，然后随机选择一个返回，否则抛出异常。</li>
                    <li>decrease() 方法是在代理检测无效的时候设置分数减 1 的方法，传入代理，然后将此代理的分数减 1，如果达到最低值，那么就删除。</li>
                    <li>exists() 方法判断代理是否存在集合中</li>
                    <li>max() 方法是将代理的分数设置为 MAX_SCORE，即 100，也就是当代理有效时的设置。</li>
                    <li>count() 方法返回当前集合的元素个数。</li>
                    <li>all() 方法返回所有的代理列表，供检测使用。</li>
                  </ul>
                  <p>定义好了这些方法，我们可以在后续的模块中调用此类来连接和操作数据库，非常方便。如我们想要获取随机可用的代理，只需要调用 random() 方法即可，得到的就是随机的可用代理。</p>
                  <h4 id="获取模块"><a href="#获取模块" class="headerlink" title="获取模块"></a>获取模块</h4>
                  <p>获取模块的逻辑相对简单，首先需要定义一个 Crawler 来从各大网站抓取代理，示例如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import json</span><br><span class="line"><span class="keyword">from</span> .utils import get_page</span><br><span class="line"><span class="keyword">from</span> pyquery import PyQuery as pq</span><br><span class="line"></span><br><span class="line">class ProxyMetaclass(type):</span><br><span class="line">    def __new__(cls, name, bases, attrs):</span><br><span class="line">        count = 0</span><br><span class="line">        attrs[<span class="string">'__CrawlFunc__'</span>] = []</span><br><span class="line">        <span class="keyword">for</span> k, v <span class="keyword">in</span> attrs.items():</span><br><span class="line">            <span class="keyword">if</span> <span class="string">'crawl_'</span> <span class="keyword">in</span> k:</span><br><span class="line">                attrs[<span class="string">'__CrawlFunc__'</span>].append(k)</span><br><span class="line">                count += 1</span><br><span class="line">        attrs[<span class="string">'__CrawlFuncCount__'</span>] = count</span><br><span class="line">        return type.__new__(cls, name, bases, attrs)</span><br><span class="line"></span><br><span class="line">class Crawler(object, <span class="attribute">metaclass</span>=ProxyMetaclass):</span><br><span class="line">    def get_proxies(self, callback):</span><br><span class="line">        proxies = []</span><br><span class="line">        <span class="keyword">for</span><span class="built_in"> proxy </span><span class="keyword">in</span> eval(<span class="string">"self.&#123;&#125;()"</span>.format(callback)):</span><br><span class="line">            <span class="builtin-name">print</span>(<span class="string">'成功获取到代理'</span>, proxy)</span><br><span class="line">            proxies.append(proxy)</span><br><span class="line">        return proxies</span><br><span class="line"></span><br><span class="line">    def crawl_daili66(self, <span class="attribute">page_count</span>=4):</span><br><span class="line">        <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">        获取代理66</span></span><br><span class="line"><span class="string">        :param page_count: 页码</span></span><br><span class="line"><span class="string">        :return: 代理</span></span><br><span class="line"><span class="string">        "</span><span class="string">""</span></span><br><span class="line">        start_url = <span class="string">'http://www.66ip.cn/&#123;&#125;.html'</span></span><br><span class="line">        urls = [start_url.format(page) <span class="keyword">for</span><span class="built_in"> page </span><span class="keyword">in</span> range(1, page_count + 1)]</span><br><span class="line">        <span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line">            <span class="builtin-name">print</span>(<span class="string">'Crawling'</span>, url)</span><br><span class="line">            html = get_page(url)</span><br><span class="line">            <span class="keyword">if</span> html:</span><br><span class="line">                doc = pq(html)</span><br><span class="line">                trs = doc(<span class="string">'.containerbox table tr:gt(0)'</span>).items()</span><br><span class="line">                <span class="keyword">for</span> tr <span class="keyword">in</span> trs:</span><br><span class="line">                   <span class="built_in"> ip </span>= tr.<span class="builtin-name">find</span>(<span class="string">'td:nth-child(1)'</span>).text()</span><br><span class="line">                   <span class="built_in"> port </span>= tr.<span class="builtin-name">find</span>(<span class="string">'td:nth-child(2)'</span>).text()</span><br><span class="line">                    yield <span class="string">':'</span>.join([ip, port])</span><br><span class="line"></span><br><span class="line">    def crawl_proxy360(self):</span><br><span class="line">        <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">        获取Proxy360</span></span><br><span class="line"><span class="string">        :return: 代理</span></span><br><span class="line"><span class="string">        "</span><span class="string">""</span></span><br><span class="line">        start_url = <span class="string">'http://www.proxy360.cn/Region/China'</span></span><br><span class="line">        <span class="builtin-name">print</span>(<span class="string">'Crawling'</span>, start_url)</span><br><span class="line">        html = get_page(start_url)</span><br><span class="line">        <span class="keyword">if</span> html:</span><br><span class="line">            doc = pq(html)</span><br><span class="line">            lines = doc(<span class="string">'div[name="list_proxy_ip"]'</span>).items()</span><br><span class="line">            <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">               <span class="built_in"> ip </span>= line.<span class="builtin-name">find</span>(<span class="string">'.tbBottomLine:nth-child(1)'</span>).text()</span><br><span class="line">               <span class="built_in"> port </span>= line.<span class="builtin-name">find</span>(<span class="string">'.tbBottomLine:nth-child(2)'</span>).text()</span><br><span class="line">                yield <span class="string">':'</span>.join([ip, port])</span><br><span class="line"></span><br><span class="line">    def crawl_goubanjia(self):</span><br><span class="line">        <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">        获取Goubanjia</span></span><br><span class="line"><span class="string">        :return: 代理</span></span><br><span class="line"><span class="string">        "</span><span class="string">""</span></span><br><span class="line">        start_url = <span class="string">'http://www.goubanjia.com/free/gngn/index.shtml'</span></span><br><span class="line">        html = get_page(start_url)</span><br><span class="line">        <span class="keyword">if</span> html:</span><br><span class="line">            doc = pq(html)</span><br><span class="line">            tds = doc(<span class="string">'td.ip'</span>).items()</span><br><span class="line">            <span class="keyword">for</span> td <span class="keyword">in</span> tds:</span><br><span class="line">                td.<span class="builtin-name">find</span>(<span class="string">'p'</span>).<span class="builtin-name">remove</span>()</span><br><span class="line">                yield td.text().replace(<span class="string">' '</span>, <span class="string">''</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>为了实现灵活，在这里我们将获取代理的一个个方法统一定义一个规范，如统一定义以 crawl 开头，这样扩展的时候只需要添加 crawl 开头的方法即可。 在这里实现了几个示例，如抓取代理 66、Proxy360、Goubanjia 三个免费代理网站，这些方法都定义成了生成器，通过 yield 返回一个个代理。首先将网页获取，然后用 PyQuery 解析，解析出 IP 加端口的形式的代理然后返回。 然后定义了一个 get_proxies() 方法，将所有以 crawl 开头的方法调用一遍，获取每个方法返回的代理并组合成列表形式返回。 你可能会想知道是怎样获取了所有以 crawl 开头的方法名称的。其实这里借助于元类来实现，定义了一个 ProxyMetaclass，Crawl 类将它设置为元类，元类中实现了 <strong>new</strong>() 方法，这个方法有固定的几个参数，其中第四个参数 attrs 中包含了类的一些属性，这其中就包含了类中方法的一些信息，我们可以遍历 attrs 这个变量即可获取类的所有方法信息。所以在这里我们在 <strong>new</strong>() 方法中遍历了 attrs 的这个属性，就像遍历一个字典一样，键名对应的就是方法的名称，接下来判断其开头是否是 crawl，如果是，则将其加入到 <strong>CrawlFunc</strong> 属性中，这样我们就成功将所有以 crawl 开头的方法定义成了一个属性，就成功动态地获取到所有以 crawl 开头的方法列表了。 所以说，如果要做扩展的话，我们只需要添加一个以 crawl 开头的方法，例如抓取快代理，我们只需要在 Crawler 类中增加 crawl_kuaidaili() 方法，仿照其他的几个方法将其定义成生成器，抓取其网站的代理，然后通过 yield 返回代理即可，所以这样我们可以非常方便地扩展，而不用关心类其他部分的实现逻辑。 代理网站的添加非常灵活，不仅可以添加免费代理，也可以添加付费代理，一些付费代理的提取方式其实也类似，也是通过 Web 的形式获取，然后进行解析，解析方式可能更加简单，如解析纯文本或 Json，解析之后以同样的方式返回即可，在此不再添加，可以自行扩展。 既然定义了这个 Crawler 类，我们就要调用啊，所以在这里再定义一个 Getter 类，动态地调用所有以 crawl 开头的方法，然后获取抓取到的代理，将其加入到数据库存储起来。</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> db <span class="keyword">import</span> RedisClient</span><br><span class="line"><span class="keyword">from</span> crawler <span class="keyword">import</span> Crawler</span><br><span class="line"></span><br><span class="line">POOL_UPPER_THRESHOLD = <span class="number">10000</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Getter</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.redis = RedisClient()</span><br><span class="line">        self.crawler = Crawler()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_over_threshold</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        判断是否达到了代理池限制</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> self.redis.count() &gt;= POOL_UPPER_THRESHOLD:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'获取器开始执行'</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.is_over_threshold():</span><br><span class="line">            <span class="keyword">for</span> callback_label <span class="keyword">in</span> range(self.crawler.__CrawlFuncCount__):</span><br><span class="line">                callback = self.crawler.__CrawlFunc__[callback_label]</span><br><span class="line">                proxies = self.crawler.get_proxies(callback)</span><br><span class="line">                <span class="keyword">for</span> proxy <span class="keyword">in</span> proxies:</span><br><span class="line">                    self.redis.add(proxy)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>Getter 类就是获取器类，这其中定义了一个变量 POOL_UPPER_THRESHOLD 表示代理池的最大数量，这个数量可以灵活配置，然后定义了 is_over_threshold() 方法判断代理池是否已经达到了容量阈值，它就是调用了 RedisClient 的 count() 方法获取代理的数量，然后加以判断，如果数量达到阈值则返回 True，否则 False。如果不想加这个限制可以将此方法永久返回 True。 接下来定义了 run() 方法，首先判断了代理池是否达到阈值，然后在这里就调用了 Crawler 类的 <strong>CrawlFunc</strong> 属性，获取到所有以 crawl 开头的方法列表，依次通过 get_proxies() 方法调用，得到各个方法抓取到的代理，然后再利用 RedisClient 的 add() 方法加入数据库，这样获取模块的工作就完成了。</p>
                  <h4 id="检测模块"><a href="#检测模块" class="headerlink" title="检测模块"></a>检测模块</h4>
                  <p>在获取模块中，我们已经成功将各个网站的代理获取下来了，然后就需要一个检测模块来对所有的代理进行一轮轮的检测，检测可用就设置为 100，不可用就分数减 1，这样就可以实时改变每个代理的可用情况，在获取有效代理的时候只需要获取分数高的代理即可。 由于代理的数量非常多，为了提高代理的检测效率，我们在这里使用异步请求库 Aiohttp 来进行检测。 Requests 作为一个同步请求库，我们在发出一个请求之后需要等待网页加载完成之后才能继续执行程序。也就是这个过程会阻塞在等待响应这个过程，如果服务器响应非常慢，比如一个请求等待十几秒，那么我们使用 Requests 完成一个请求就会需要十几秒的时间，中间其实就是一个等待响应的过程，程序也不会继续往下执行，而这十几秒的时间其实完全可以去做其他的事情，比如调度其他的请求或者进行网页解析等等。 异步请求库就解决了这个问题，它类似 JavaScript 中的回调，意思是说在请求发出之后，程序可以继续接下去执行去做其他的事情，当响应到达时，会通知程序再去处理这个响应，这样程序就没有被阻塞，充分把时间和资源利用起来，大大提高效率。 对于响应速度比较快的网站，可能 Requests 同步请求和 Aiohttp 异步请求的效果差距没那么大，可对于检测代理这种事情，一般是需要十多秒甚至几十秒的时间，这时候使用 Aiohttp 异步请求库的优势就大大体现出来了，效率可能会提高几十倍不止。 所以在这里我们的代理检测使用异步请求库 Aiohttp，实现示例如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">VALID_STATUS_CODES = [200]</span><br><span class="line">TEST_URL = <span class="string">'http://www.baidu.com'</span></span><br><span class="line">BATCH_TEST_SIZE = 100</span><br><span class="line"></span><br><span class="line">class Tester(object):</span><br><span class="line">    def __init__(self):</span><br><span class="line">        self.redis = RedisClient()</span><br><span class="line"></span><br><span class="line">    async def test_single_proxy(self, proxy):</span><br><span class="line">        <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">        测试单个代理</span></span><br><span class="line"><span class="string">        :param proxy: 单个代理</span></span><br><span class="line"><span class="string">        :return: None</span></span><br><span class="line"><span class="string">        "</span><span class="string">""</span></span><br><span class="line">        conn = aiohttp.TCPConnector(<span class="attribute">verify_ssl</span>=<span class="literal">False</span>)</span><br><span class="line">        async with aiohttp.ClientSession(<span class="attribute">connector</span>=conn) as session:</span><br><span class="line">            try:</span><br><span class="line">                <span class="keyword">if</span> isinstance(proxy, bytes):</span><br><span class="line">                   <span class="built_in"> proxy </span>= proxy.decode(<span class="string">'utf-8'</span>)</span><br><span class="line">                real_proxy = <span class="string">'http://'</span> + proxy</span><br><span class="line">                <span class="builtin-name">print</span>(<span class="string">'正在测试'</span>, proxy)</span><br><span class="line">                async with session.<span class="builtin-name">get</span>(TEST_URL, <span class="attribute">proxy</span>=real_proxy, <span class="attribute">timeout</span>=15) as response:</span><br><span class="line">                    <span class="keyword">if</span> response.status <span class="keyword">in</span> VALID_STATUS_CODES:</span><br><span class="line">                        self.redis.max(proxy)</span><br><span class="line">                        <span class="builtin-name">print</span>(<span class="string">'代理可用'</span>, proxy)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        self.redis.decrease(proxy)</span><br><span class="line">                        <span class="builtin-name">print</span>(<span class="string">'请求响应码不合法'</span>, proxy)</span><br><span class="line">            except (ClientError, ClientConnectorError, TimeoutError, AttributeError):</span><br><span class="line">                self.redis.decrease(proxy)</span><br><span class="line">                <span class="builtin-name">print</span>(<span class="string">'代理请求失败'</span>, proxy)</span><br><span class="line"></span><br><span class="line">    def <span class="builtin-name">run</span>(self):</span><br><span class="line">        <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">        测试主函数</span></span><br><span class="line"><span class="string">        :return: None</span></span><br><span class="line"><span class="string">        "</span><span class="string">""</span></span><br><span class="line">        <span class="builtin-name">print</span>(<span class="string">'测试器开始运行'</span>)</span><br><span class="line">        try:</span><br><span class="line">            proxies = self.redis.all()</span><br><span class="line">            loop = asyncio.get_event_loop()</span><br><span class="line">            # 批量测试</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(0, len(proxies), BATCH_TEST_SIZE):</span><br><span class="line">                test_proxies = proxies[i:i + BATCH_TEST_SIZE]</span><br><span class="line">                tasks = [self.test_single_proxy(proxy) <span class="keyword">for</span><span class="built_in"> proxy </span><span class="keyword">in</span> test_proxies]</span><br><span class="line">                loop.run_until_complete(asyncio.wait(tasks))</span><br><span class="line">                time.sleep(5)</span><br><span class="line">        except Exception as e:</span><br><span class="line">            <span class="builtin-name">print</span>(<span class="string">'测试器发生错误'</span>, e.args)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里定义了一个类 Tester，<strong>init</strong>() 方法中建立了一个 RedisClient 对象，供类中其他方法使用。接下来定义了一个 test_single_proxy() 方法，用来检测单个代理的可用情况，其参数就是被检测的代理，注意这个方法前面加了 async 关键词，代表这个方法是异步的，方法内部首先创建了 Aiohttp 的 ClientSession 对象，此对象类似于 Requests 的 Session 对象，可以直接调用该对象的 get() 方法来访问页面，在这里代理的设置方式是通过 proxy 参数传递给 get() 方法，请求方法前面也需要加上 async 关键词标明是异步请求，这也是 Aiohttp 使用时的常见写法。 测试的链接在这里定义常量为 TEST_URL，如果针对某个网站有抓取需求，建议将 TEST_URL 设置为目标网站的地址，因为在抓取的过程中，可能代理本身是可用的，但是该代理的 IP 已经被目标网站封掉了。例如，如要抓取知乎，可能其中某些代理是可以正常使用，比如访问百度等页面是完全没有问题的，但是可能对知乎来说可能就被封了，所以可以将 TEST_URL 设置为知乎的某个页面的链接，当请求失败时，当代理被封时，分数自然会减下来，就不会被取到了。 如果想做一个通用的代理池，则不需要专门设置 TEST_URL，可以设置为一个不会封 IP 的网站，也可以设置为百度这类响应稳定的网站。 另外我们还定义了 VALID_STATUS_CODES 变量，是一个列表形式，包含了正常的状态码，如可以定义成 [200]，当然对于某些检测目标网站可能会出现其他的状态码也是正常的，可以自行配置。 获取 Response 后需要判断响应的状态，如果状态码在 VALID_STATUS_CODES 这个列表里，则代表代理可用，调用 RedisClient 的 max() 方法将代理分数设为 100，否则调用 decrease() 方法将代理分数减 1，如果出现异常也同样将代理分数减 1。 另外在测试的时候设置了批量测试的最大值 BATCH_TEST_SIZE 为 100，也就是一批测试最多测试 100 个，这可以避免当代理池过大时全部测试导致内存开销过大的问题。 随后在 run() 方法里面获取了所有的代理列表，使用 Aiohttp 分配任务，启动运行，这样就可以进行异步检测了，写法可以参考 Aiohttp 的官方示例：<a href="http://aiohttp.readthedocs.io/" target="_blank" rel="noopener">http://aiohttp.readthedocs.io/</a>。 这样测试模块的逻辑就完成了。</p>
                  <h4 id="接口模块"><a href="#接口模块" class="headerlink" title="接口模块"></a>接口模块</h4>
                  <p>通过上述三个模块我们已经可以做到代理的获取、检测和更新了，数据库中就会以有序集合的形式存储各个代理还有对应的分数，分数 100 代表可用，分数越小代表越不可用。 但是我们怎样来方便地获取可用代理呢？用 RedisClient 类来直接连接 Redis 然后调用 random() 方法获取当然没问题，这样做效率很高，但是有这么几个弊端：</p>
                  <ul>
                    <li>需要知道 Redis 的用户名和密码，如果这个代理池是给其他人使用的就需要告诉他连接的用户名和密码信息，这样是很不安全的。</li>
                    <li>代理池如果想持续运行需要部署在远程服务器上运行，如果远程服务器的 Redis 是只允许本地连接的，那么就没有办法远程直连 Redis 获取代理了。</li>
                    <li>如果爬虫所在的主机没有连接 Redis 的模块，或者爬虫不是由 Python 语言编写的，那么就无法使用 RedisClient 来获取代理了。</li>
                    <li>如果 RedisClient 类或者数据库结构有更新，那么在爬虫端还需要去同步这些更新。</li>
                  </ul>
                  <p>综上考虑，为了使得代理池可以作为一个独立服务运行，我们最好增加一个接口模块，以 Web API 的形式暴露可用代理。 这样获取代理只需要请求一下接口即可，以上的几个缺点弊端可以解决。 我们在这里使用一个比较轻量级的库 Flask 来实现这个接口模块，实现示例如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, g</span><br><span class="line"><span class="keyword">from</span> db <span class="keyword">import</span> RedisClient</span><br><span class="line"></span><br><span class="line">__all__ = [<span class="string">'app'</span>]</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_conn</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> hasattr(g, <span class="string">'redis'</span>):</span><br><span class="line">        g.redis = RedisClient()</span><br><span class="line">    <span class="keyword">return</span> g.redis</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&lt;h2&gt;Welcome to Proxy Pool System&lt;/h2&gt;'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/random')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_proxy</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    获取随机可用代理</span></span><br><span class="line"><span class="string">    :return: 随机代理</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    conn = get_conn()</span><br><span class="line">    <span class="keyword">return</span> conn.random()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/count')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_counts</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    获取代理池总量</span></span><br><span class="line"><span class="string">    :return: 代理池总量</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    conn = get_conn()</span><br><span class="line">    <span class="keyword">return</span> str(conn.count())</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里我们声明了一个 Flask 对象，定义了三个接口，分别是首页、随机代理页、获取数量页。 运行之后 Flask 会启动一个 Web 服务，我们只需要访问对应的接口即可获取到可用代理。</p>
                  <h4 id="调度模块"><a href="#调度模块" class="headerlink" title="调度模块"></a>调度模块</h4>
                  <p>这个模块其实就是调用以上所定义的三个模块，将以上三个模块通过多进程的形式运行起来，示例如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">TESTER_CYCLE = <span class="number">20</span></span><br><span class="line">GETTER_CYCLE = <span class="number">20</span></span><br><span class="line">TESTER_ENABLED = <span class="literal">True</span></span><br><span class="line">GETTER_ENABLED = <span class="literal">True</span></span><br><span class="line">API_ENABLED = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">from</span> api <span class="keyword">import</span> app</span><br><span class="line"><span class="keyword">from</span> getter <span class="keyword">import</span> Getter</span><br><span class="line"><span class="keyword">from</span> tester <span class="keyword">import</span> Tester</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Scheduler</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">schedule_tester</span><span class="params">(self, cycle=TESTER_CYCLE)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        定时测试代理</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        tester = Tester()</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            print(<span class="string">'测试器开始运行'</span>)</span><br><span class="line">            tester.run()</span><br><span class="line">            time.sleep(cycle)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">schedule_getter</span><span class="params">(self, cycle=GETTER_CYCLE)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        定时获取代理</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        getter = Getter()</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            print(<span class="string">'开始抓取代理'</span>)</span><br><span class="line">            getter.run()</span><br><span class="line">            time.sleep(cycle)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">schedule_api</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        开启API</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        app.run(API_HOST, API_PORT)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'代理池开始运行'</span>)</span><br><span class="line">        <span class="keyword">if</span> TESTER_ENABLED:</span><br><span class="line">            tester_process = Process(target=self.schedule_tester)</span><br><span class="line">            tester_process.start()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> GETTER_ENABLED:</span><br><span class="line">            getter_process = Process(target=self.schedule_getter)</span><br><span class="line">            getter_process.start()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> API_ENABLED:</span><br><span class="line">            api_process = Process(target=self.schedule_api)</span><br><span class="line">            api_process.start()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里还有三个常量，TESTER_ENABLED、GETTER_ENABLED、API_ENABLED 都是布尔类型，True 或者 False。标明了测试模块、获取模块、接口模块的开关，如果为 True，则代表模块开启。 启动入口是 run() 方法，其分别判断了三个模块的开关，如果开启的话，就新建一个 Process 进程，设置好启动目标，然后调用 start() 方法运行，这样三个进程就可以并行执行，互不干扰。 三个调度方法结构也非常清晰，比如 schedule_tester() 方法，这是用来调度测试模块的方法，首先声明一个 Tester 对象，然后进入死循环不断循环调用其 run() 方法，执行完一轮之后就休眠一段时间，休眠结束之后重新再执行。在这里休眠时间也定义为一个常量，如 20 秒，这样就会每隔 20 秒进行一次代理检测。 最后整个代理池的运行只需要调用 Scheduler 的 run() 方法即可启动。 以上便是整个代理池的架构和相应实现逻辑。</p>
                  <h3 id="5-运行"><a href="#5-运行" class="headerlink" title="5. 运行"></a>5. 运行</h3>
                  <p>接下来我们将代码整合一下，将代理运行起来，运行之后的输出结果如图 9-2 所示： <img src="https://cdn.cuiqingcai.com/2019-08-02-060356.png" alt=""> 图 9-2 运行结果 以上是代理池的控制台输出，可以看到可用代理设置为 100，不可用代理分数减 1。 接下来我们再打开浏览器，当前配置了运行在 5555 端口，所以打开：<a href="http://127.0.0.1:5555" target="_blank" rel="noopener">http://127.0.0.1:5555</a>，即可看到其首页，如图 9-3 所示： <img src="https://cdn.cuiqingcai.com/2019-08-02-060403.jpg" alt=""> 图 9-3 首页页面 再访问：<a href="http://127.0.0.1:5555/random" target="_blank" rel="noopener">http://127.0.0.1:5555/random</a>，即可获取随机可用代理，如图 9-4 所示： <img src="https://cdn.cuiqingcai.com/2019-08-02-060410.jpg" alt=""> 图 9-4 获取代理页面 所以后面我们只需要访问此接口即可获取一个随机可用代理，非常方便。 获取代理的代码如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">PROXY_POOL_URL = <span class="string">'http://localhost:5555/random'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_proxy</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = requests.get(PROXY_POOL_URL)</span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="keyword">return</span> response.text</span><br><span class="line">    <span class="keyword">except</span> ConnectionError:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>获取下来之后便是一个字符串类型的代理，可以按照上一节所示的方法设置代理，如 Requests 的使用方法如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">proxy = get_proxy()</span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">'http'</span>: <span class="string">'http://'</span> + proxy,</span><br><span class="line">    <span class="string">'https'</span>: <span class="string">'https://'</span> + proxy,</span><br><span class="line">&#125;</span><br><span class="line">try:</span><br><span class="line">    response = requests.<span class="builtin-name">get</span>(<span class="string">'http://httpbin.org/get'</span>, <span class="attribute">proxies</span>=proxies)</span><br><span class="line">    <span class="builtin-name">print</span>(response.text)</span><br><span class="line">except requests.exceptions.ConnectionError as e:</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">'Error'</span>, e.args)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>有了代理池之后，我们再取出代理即可有效防止 IP 被封禁的情况。</p>
                  <h3 id="6-本节代码"><a href="#6-本节代码" class="headerlink" title="6. 本节代码"></a>6. 本节代码</h3>
                  <p>本节代码地址为：<a href="https://github.com/Python3WebSpider/ProxyPool" target="_blank" rel="noopener">https://github.com/Python3WebSpider/ProxyPool</a>。</p>
                  <h3 id="7-结语"><a href="#7-结语" class="headerlink" title="7. 结语"></a>7. 结语</h3>
                  <p>本节我们实现了一个比较高效的代理池来获取随机可用的代理，整个内容比较多，需要好好理解一下。 在后文我们会利用代理池来实现数据的抓取。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-08-02 14:05:09" itemprop="dateCreated datePublished" datetime="2019-08-02T14:05:09+08:00">2019-08-02</time>
                </span>
                <span id="/7048.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 9.2-代理池的维护" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>15k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>13 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/7045.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/7045.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 9.1-代理的设置</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>在前面我们介绍了多种请求库，如 Requests、Urllib、Selenium 等。我们接下来首先贴近实战，了解一下代理怎么使用，为后面了解代理池、ADSL 拨号代理的使用打下基础。 下面我们来梳理一下这些库的代理的设置方法。</p>
                  <h3 id="1-获取代理"><a href="#1-获取代理" class="headerlink" title="1. 获取代理"></a>1. 获取代理</h3>
                  <p>在做测试之前，我们需要先获取一个可用代理，搜索引擎搜索“代理”关键字，就可以看到有许多代理服务网站，在网站上会有很多免费代理，比如西刺：<a href="http://www.xicidaili.com/" target="_blank" rel="noopener">http://www.xicidaili.com/</a>，这里列出了很多免费代理，但是这些免费代理大多数情况下都是不好用的，所以比较靠谱的方法是购买付费代理，很多网站都有售卖，数量不用多，买一个稳定可用的即可，可以自行选购。 或者如果我们本机有相关代理软件的话，软件一般会在本机创建 HTTP 或 SOCKS 代理服务，直接使用此代理也可以。 在这里我的本机安装了一部代理软件，它会在本地 9743 端口上创建 HTTP 代理服务，也就是代理为 127.0.0.1:9743，另外还会在 9742 端口创建 SOCKS 代理服务，也就是代理为 127.0.0.1:9742，我只要设置了这个代理就可以成功将本机 IP 切换到代理软件连接的服务器的 IP了。 所以本节下面的示例里我使用上述代理来演示其设置方法，你可以自行替换成自己的可用代理，设置代理后测试的网址是：<a href="http://httpbin.org/get" target="_blank" rel="noopener">http://httpbin.org/get</a>，访问该站点可以得到请求的一些相关信息，其中 origin 字段就是客户端的 IP，我们可以根据它来判断代理是否设置成功，也就是是否成功伪装了IP。 下面我们来看下各个库的代理设置方式。</p>
                  <h3 id="2-Urllib"><a href="#2-Urllib" class="headerlink" title="2. Urllib"></a>2. Urllib</h3>
                  <p>首先我们以最基础的 Urllib 为例，来看一下代理的设置方法，代码如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> urllib.<span class="builtin-name">error</span> import URLError</span><br><span class="line"><span class="keyword">from</span> urllib.request import ProxyHandler, build_opener</span><br><span class="line"></span><br><span class="line">proxy = <span class="string">'127.0.0.1:9743'</span></span><br><span class="line">proxy_handler = ProxyHandler(&#123;</span><br><span class="line">    <span class="string">'http'</span>: <span class="string">'http://'</span> + proxy,</span><br><span class="line">    <span class="string">'https'</span>: <span class="string">'https://'</span> + proxy</span><br><span class="line">&#125;)</span><br><span class="line">opener = build_opener(proxy_handler)</span><br><span class="line">try:</span><br><span class="line">    response = opener.open(<span class="string">'http://httpbin.org/get'</span>)</span><br><span class="line">    <span class="builtin-name">print</span>(response.read().decode(<span class="string">'utf-8'</span>))</span><br><span class="line">except URLError as e:</span><br><span class="line">    <span class="builtin-name">print</span>(e.reason)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"args"</span>: &#123;&#125;, </span><br><span class="line">  <span class="attr">"headers"</span>: &#123;</span><br><span class="line">    <span class="attr">"Accept-Encoding"</span>: <span class="string">"identity"</span>, </span><br><span class="line">    <span class="attr">"Connection"</span>: <span class="string">"close"</span>, </span><br><span class="line">    <span class="attr">"Host"</span>: <span class="string">"httpbin.org"</span>, </span><br><span class="line">    <span class="attr">"User-Agent"</span>: <span class="string">"Python-urllib/3.6"</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="attr">"origin"</span>: <span class="string">"106.185.45.153"</span>, </span><br><span class="line">  <span class="attr">"url"</span>: <span class="string">"http://httpbin.org/get"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里我们需要借助于 ProxyHandler 设置代理，参数是字典类型，键名为协议类型，键值是代理，注意此处代理前面需要加上协议，即 http 或者 https，此处设置了 http 和 https 两种代理，当我们请求的链接是 http 协议的时候，它会调用 http 代理，当请求的链接是 https 协议的时候，它会调用https代理，所以此处生效的代理是：<a href="http://127.0.0.1:9743" target="_blank" rel="noopener">http://127.0.0.1:9743</a>。 创建完 ProxyHandler 对象之后，我们需要利用 build_opener() 方法传入该对象来创建一个 Opener，这样就相当于此 Opener 已经设置好代理了，接下来直接调用它的 open() 方法即可使用此代理访问我们所想要的链接。 运行输出结果是一个 Json，它有一个字段 origin，标明了客户端的 IP，此处的 IP 验证一下，确实为代理的 IP，而并不是我们真实的 IP，所以这样我们就成功设置好代理，并可以隐藏真实 IP 了。 如果遇到需要认证的代理，我们可以用如下的方法设置：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> urllib.<span class="builtin-name">error</span> import URLError</span><br><span class="line"><span class="keyword">from</span> urllib.request import ProxyHandler, build_opener</span><br><span class="line"></span><br><span class="line">proxy = <span class="string">'username:password@127.0.0.1:9743'</span></span><br><span class="line">proxy_handler = ProxyHandler(&#123;</span><br><span class="line">    <span class="string">'http'</span>: <span class="string">'http://'</span> + proxy,</span><br><span class="line">    <span class="string">'https'</span>: <span class="string">'https://'</span> + proxy</span><br><span class="line">&#125;)</span><br><span class="line">opener = build_opener(proxy_handler)</span><br><span class="line">try:</span><br><span class="line">    response = opener.open(<span class="string">'http://httpbin.org/get'</span>)</span><br><span class="line">    <span class="builtin-name">print</span>(response.read().decode(<span class="string">'utf-8'</span>))</span><br><span class="line">except URLError as e:</span><br><span class="line">    <span class="builtin-name">print</span>(e.reason)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里改变的只是 proxy 变量，只需要在代理前面加入代理认证的用户名密码即可，其中 username 就是用户名，password 为密码，例如 username 为foo，密码为 bar，那么代理就是 foo:bar@127.0.0.1:9743。 如果代理是 SOCKS5 类型，那么可以用如下方式设置代理：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import socks</span><br><span class="line">import socket</span><br><span class="line"><span class="keyword">from</span> urllib import request</span><br><span class="line"><span class="keyword">from</span> urllib.<span class="builtin-name">error</span> import URLError</span><br><span class="line"></span><br><span class="line">socks.set_default_proxy(socks.SOCKS5, <span class="string">'127.0.0.1'</span>, 9742)</span><br><span class="line">socket.socket = socks.socksocket</span><br><span class="line">try:</span><br><span class="line">    response = request.urlopen(<span class="string">'http://httpbin.org/get'</span>)</span><br><span class="line">    <span class="builtin-name">print</span>(response.read().decode(<span class="string">'utf-8'</span>))</span><br><span class="line">except URLError as e:</span><br><span class="line">    <span class="builtin-name">print</span>(e.reason)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>此处需要一个 Socks 模块，可以通过如下命令安装：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> PySocks</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>本地我有一个 SOCKS5 代理，运行在 9742 端口，运行成功之后和上文 HTTP 代理输出结果是一样的：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"args"</span>: &#123;&#125;, </span><br><span class="line">  <span class="attr">"headers"</span>: &#123;</span><br><span class="line">    <span class="attr">"Accept-Encoding"</span>: <span class="string">"identity"</span>, </span><br><span class="line">    <span class="attr">"Connection"</span>: <span class="string">"close"</span>, </span><br><span class="line">    <span class="attr">"Host"</span>: <span class="string">"httpbin.org"</span>, </span><br><span class="line">    <span class="attr">"User-Agent"</span>: <span class="string">"Python-urllib/3.6"</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="attr">"origin"</span>: <span class="string">"106.185.45.153"</span>, </span><br><span class="line">  <span class="attr">"url"</span>: <span class="string">"http://httpbin.org/get"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果的 origin 字段同样为代理的 IP，设置代理成功。</p>
                  <h3 id="3-Requests"><a href="#3-Requests" class="headerlink" title="3. Requests"></a>3. Requests</h3>
                  <p>对于 Requests 来说，代理设置更加简单，我们只需要传入 proxies 参数即可。 还是以上例中的代理为例，我们来看下 Requests 的代理的设置：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">proxy = <span class="string">'127.0.0.1:9743'</span></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">'http'</span>: <span class="string">'http://'</span> + proxy,</span><br><span class="line">    <span class="string">'https'</span>: <span class="string">'https://'</span> + proxy,</span><br><span class="line">&#125;</span><br><span class="line">try:</span><br><span class="line">    response = requests.<span class="builtin-name">get</span>(<span class="string">'http://httpbin.org/get'</span>, <span class="attribute">proxies</span>=proxies)</span><br><span class="line">    <span class="builtin-name">print</span>(response.text)</span><br><span class="line">except requests.exceptions.ConnectionError as e:</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">'Error'</span>, e.args)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"args"</span>: &#123;&#125;, </span><br><span class="line">  <span class="attr">"headers"</span>: &#123;</span><br><span class="line">    <span class="attr">"Accept"</span>: <span class="string">"*/*"</span>, </span><br><span class="line">    <span class="attr">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>, </span><br><span class="line">    <span class="attr">"Connection"</span>: <span class="string">"close"</span>, </span><br><span class="line">    <span class="attr">"Host"</span>: <span class="string">"httpbin.org"</span>, </span><br><span class="line">    <span class="attr">"User-Agent"</span>: <span class="string">"python-requests/2.18.1"</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="attr">"origin"</span>: <span class="string">"106.185.45.153"</span>, </span><br><span class="line">  <span class="attr">"url"</span>: <span class="string">"http://httpbin.org/get"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以发现 Requests 的代理设置比 Urllib 简单很多，只需要构造代理字典即可，然后通过 proxies 参数即可设置代理，不需要重新构建 Opener。 可以发现其运行结果的 origin 也是代理的 IP，证明代理已经设置成功。 如果代理需要认证，同样在代理的前面加上用户名密码即可，代理的写法就变成：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">proxy</span> = <span class="string">'username:password@127.0.0.1:9743'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>和 Urllib 一样，只需要将 username 和 password 替换即可。 如果需要使用 SOCKS5 代理，则可以使用如下方式：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">proxy = <span class="string">'127.0.0.1:9742'</span></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">'http'</span>: <span class="string">'socks5://'</span> + proxy,</span><br><span class="line">    <span class="string">'https'</span>: <span class="string">'socks5://'</span> + proxy</span><br><span class="line">&#125;</span><br><span class="line">try:</span><br><span class="line">    response = requests.<span class="builtin-name">get</span>(<span class="string">'http://httpbin.org/get'</span>, <span class="attribute">proxies</span>=proxies)</span><br><span class="line">    <span class="builtin-name">print</span>(response.text)</span><br><span class="line">except requests.exceptions.ConnectionError as e:</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">'Error'</span>, e.args)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里需要额外安装一个 Socks 模块，命令如下：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> <span class="string">"requests[socks]"</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果是完全相同的：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"args"</span>: &#123;&#125;, </span><br><span class="line">  <span class="attr">"headers"</span>: &#123;</span><br><span class="line">    <span class="attr">"Accept"</span>: <span class="string">"*/*"</span>, </span><br><span class="line">    <span class="attr">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>, </span><br><span class="line">    <span class="attr">"Connection"</span>: <span class="string">"close"</span>, </span><br><span class="line">    <span class="attr">"Host"</span>: <span class="string">"httpbin.org"</span>, </span><br><span class="line">    <span class="attr">"User-Agent"</span>: <span class="string">"python-requests/2.18.1"</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="attr">"origin"</span>: <span class="string">"106.185.45.153"</span>, </span><br><span class="line">  <span class="attr">"url"</span>: <span class="string">"http://httpbin.org/get"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外还有一种设置方式，和 Urllib 中的方法相同，使用 socks 模块，也需要像上文一样安装该库，设置方法如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line">import socks</span><br><span class="line">import socket</span><br><span class="line"></span><br><span class="line">socks.set_default_proxy(socks.SOCKS5, <span class="string">'127.0.0.1'</span>, 9742)</span><br><span class="line">socket.socket = socks.socksocket</span><br><span class="line">try:</span><br><span class="line">    response = requests.<span class="builtin-name">get</span>(<span class="string">'http://httpbin.org/get'</span>)</span><br><span class="line">    <span class="builtin-name">print</span>(response.text)</span><br><span class="line">except requests.exceptions.ConnectionError as e:</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">'Error'</span>, e.args)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样也可以设置 SOCKS5 代理，运行结果完全相同，相比第一种方法，此方法是全局设置，不同情况可以选用不同的方法。</p>
                  <h3 id="4-Selenium"><a href="#4-Selenium" class="headerlink" title="4. Selenium"></a>4. Selenium</h3>
                  <p>Selenium 同样也可以设置代理，在这里分两种介绍，一个是有界面浏览器，以 Chrome 为例介绍，另一种是无界面浏览器，以 PhantomJS 为例介绍。</p>
                  <h4 id="Chrome"><a href="#Chrome" class="headerlink" title="Chrome"></a>Chrome</h4>
                  <p>对于 Chrome 来说，用 Selenium 设置代理的方法也非常简单，设置方法如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> selenium import webdriver</span><br><span class="line"></span><br><span class="line">proxy = <span class="string">'127.0.0.1:9743'</span></span><br><span class="line">chrome_options = webdriver.ChromeOptions()</span><br><span class="line">chrome_options.add_argument(<span class="string">'--proxy-server=http://'</span> + proxy)</span><br><span class="line">browser = webdriver.Chrome(<span class="attribute">chrome_options</span>=chrome_options)</span><br><span class="line">browser.<span class="builtin-name">get</span>(<span class="string">'http://httpbin.org/get'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里我们通过 ChromeOptions 来设置代理，在创建 Chrome 对象的时候通过 chrome_options 参数传递即可。 这样在运行之后便会弹出一个 Chrome 浏览器，访问目标链接之后输出结果如下：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"args"</span>: &#123;&#125;, </span><br><span class="line">  <span class="attr">"headers"</span>: &#123;</span><br><span class="line">    <span class="attr">"Accept"</span>: <span class="string">"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8"</span>, </span><br><span class="line">    <span class="attr">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>, </span><br><span class="line">    <span class="attr">"Accept-Language"</span>: <span class="string">"zh-CN,zh;q=0.8"</span>, </span><br><span class="line">    <span class="attr">"Connection"</span>: <span class="string">"close"</span>, </span><br><span class="line">    <span class="attr">"Host"</span>: <span class="string">"httpbin.org"</span>, </span><br><span class="line">    <span class="attr">"Upgrade-Insecure-Requests"</span>: <span class="string">"1"</span>, </span><br><span class="line">    <span class="attr">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/59.0.3071.115 Safari/537.36"</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="attr">"origin"</span>: <span class="string">"106.185.45.153"</span>, </span><br><span class="line">  <span class="attr">"url"</span>: <span class="string">"http://httpbin.org/get"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到 origin 同样为代理 IP 的地址，代理设置成功。 如果代理是认证代理，则设置方法相对比较麻烦，方法如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> selenium import webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.options import Options</span><br><span class="line">import zipfile</span><br><span class="line"></span><br><span class="line">ip = <span class="string">'127.0.0.1'</span></span><br><span class="line">port = 9743</span><br><span class="line">username = <span class="string">'foo'</span></span><br><span class="line">password = <span class="string">'bar'</span></span><br><span class="line"></span><br><span class="line">manifest_json = <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    "</span>version<span class="string">": "</span>1.0.0<span class="string">",</span></span><br><span class="line"><span class="string">    "</span>manifest_version<span class="string">": 2,</span></span><br><span class="line"><span class="string">    "</span>name<span class="string">": "</span>Chrome Proxy<span class="string">",</span></span><br><span class="line"><span class="string">    "</span>permissions<span class="string">": [</span></span><br><span class="line"><span class="string">        "</span>proxy<span class="string">",</span></span><br><span class="line"><span class="string">        "</span>tabs<span class="string">",</span></span><br><span class="line"><span class="string">        "</span>unlimitedStorage<span class="string">",</span></span><br><span class="line"><span class="string">        "</span>storage<span class="string">",</span></span><br><span class="line"><span class="string">        "</span>&lt;all_urls&gt;<span class="string">",</span></span><br><span class="line"><span class="string">        "</span>webRequest<span class="string">",</span></span><br><span class="line"><span class="string">        "</span>webRequestBlocking<span class="string">"</span></span><br><span class="line"><span class="string">    ],</span></span><br><span class="line"><span class="string">    "</span>background<span class="string">": &#123;</span></span><br><span class="line"><span class="string">        "</span>scripts<span class="string">": ["</span>background.js<span class="string">"]</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">"</span><span class="string">""</span></span><br><span class="line"></span><br><span class="line">background_js = <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">var config = &#123;</span></span><br><span class="line"><span class="string">        mode: "</span>fixed_servers<span class="string">",</span></span><br><span class="line"><span class="string">        rules: &#123;</span></span><br><span class="line"><span class="string">          singleProxy: &#123;</span></span><br><span class="line"><span class="string">            scheme: "</span>http<span class="string">",</span></span><br><span class="line"><span class="string">            host: "</span>%(ip)s<span class="string">",</span></span><br><span class="line"><span class="string">            port: %(port)s</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">chrome.proxy.settings.set(&#123;value: config, scope: "</span>regular<span class="string">"&#125;, function() &#123;&#125;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function callbackFn(details) &#123;</span></span><br><span class="line"><span class="string">    return &#123;</span></span><br><span class="line"><span class="string">        authCredentials: &#123;</span></span><br><span class="line"><span class="string">            username: "</span>%(username)s<span class="string">",</span></span><br><span class="line"><span class="string">            password: "</span>%(password)s<span class="string">"</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">chrome.webRequest.onAuthRequired.addListener(</span></span><br><span class="line"><span class="string">            callbackFn,</span></span><br><span class="line"><span class="string">            &#123;urls: ["</span>&lt;all_urls&gt;<span class="string">"]&#125;,</span></span><br><span class="line"><span class="string">            ['blocking']</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string">"</span><span class="string">""</span> % &#123;<span class="string">'ip'</span>: ip, <span class="string">'port'</span>: port, <span class="string">'username'</span>: username, <span class="string">'password'</span>: password&#125;</span><br><span class="line"></span><br><span class="line">plugin_file = <span class="string">'proxy_auth_plugin.zip'</span></span><br><span class="line">with zipfile.ZipFile(plugin_file, <span class="string">'w'</span>) as zp:</span><br><span class="line">    zp.writestr(<span class="string">"manifest.json"</span>, manifest_json)</span><br><span class="line">    zp.writestr(<span class="string">"background.js"</span>, background_js)</span><br><span class="line">chrome_options = Options()</span><br><span class="line">chrome_options.add_argument(<span class="string">"--start-maximized"</span>)</span><br><span class="line">chrome_options.add_extension(plugin_file)</span><br><span class="line">browser = webdriver.Chrome(<span class="attribute">chrome_options</span>=chrome_options)</span><br><span class="line">browser.<span class="builtin-name">get</span>(<span class="string">'http://httpbin.org/get'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里需要在本地创建一个 manifest.json 配置文件和 background.js 脚本来设置认证代理，运行之后本地会生成一个 proxy_auth_plugin.zip 文件保存配置。 运行结果和上例一致，origin 同样为代理 IP。</p>
                  <h4 id="PhantomJS"><a href="#PhantomJS" class="headerlink" title="PhantomJS"></a>PhantomJS</h4>
                  <p>对于 PhantomJS，代理设置方法可以借助于 service_args 参数，也就是命令行参数，代理设置方法如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> selenium import webdriver</span><br><span class="line"></span><br><span class="line">service_args = [</span><br><span class="line">    <span class="string">'--proxy=127.0.0.1:9743'</span>,</span><br><span class="line">    <span class="string">'--proxy-type=http'</span></span><br><span class="line">]</span><br><span class="line">browser = webdriver.PhantomJS(<span class="attribute">service_args</span>=service_args)</span><br><span class="line">browser.<span class="builtin-name">get</span>(<span class="string">'http://httpbin.org/get'</span>)</span><br><span class="line"><span class="builtin-name">print</span>(browser.page_source)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里我们只需要使用 service_args 参数，将命令行的一些参数定义为列表，在初始化的时候传递即可。 运行结果：</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"args"</span>: &#123;&#125;, </span><br><span class="line">  <span class="attr">"headers"</span>: &#123;</span><br><span class="line">    <span class="attr">"Accept"</span>: <span class="string">"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"</span>, </span><br><span class="line">    <span class="attr">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>, </span><br><span class="line">    <span class="attr">"Accept-Language"</span>: <span class="string">"zh-CN,en,*"</span>, </span><br><span class="line">    <span class="attr">"Connection"</span>: <span class="string">"close"</span>, </span><br><span class="line">    <span class="attr">"Host"</span>: <span class="string">"httpbin.org"</span>, </span><br><span class="line">    <span class="attr">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (Macintosh; Intel Mac OS X) AppleWebKit/538.1 (KHTML, like Gecko) PhantomJS/2.1.0 Safari/538.1"</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="attr">"origin"</span>: <span class="string">"106.185.45.153"</span>, </span><br><span class="line">  <span class="attr">"url"</span>: <span class="string">"http://httpbin.org/get"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果的 origin 同样为代理的 IP，设置代理成功。 如果需要认证，那么只需要再加入 —proxy-auth 选项即可，这样参数就改为：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">service_args</span> = [</span><br><span class="line">    <span class="string">'--proxy=127.0.0.1:9743'</span>,</span><br><span class="line">    <span class="string">'--proxy-type=http'</span>,</span><br><span class="line">    <span class="string">'--proxy-auth=username:password'</span></span><br><span class="line">]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>将 username 和 password 替换为认证所需的用户名和密码即可。</p>
                  <h3 id="5-本节代码"><a href="#5-本节代码" class="headerlink" title="5. 本节代码"></a>5. 本节代码</h3>
                  <p>本节代码地址为：<a href="https://github.com/Python3WebSpider/ProxySettings" target="_blank" rel="noopener">https://github.com/Python3WebSpider/ProxySettings</a>。</p>
                  <h3 id="6-结语"><a href="#6-结语" class="headerlink" title="6. 结语"></a>6. 结语</h3>
                  <p>本节介绍了前文所介绍的请求库的代理设置方法，稍作了解即可，后面我们会使用这些方法来搭建代理池和爬取网站，进一步加深印象。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-08-02 14:03:32" itemprop="dateCreated datePublished" datetime="2019-08-02T14:03:32+08:00">2019-08-02</time>
                </span>
                <span id="/7045.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 9.1-代理的设置" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>8.4k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>8 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/7043.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/7043.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 9-代理的使用</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>我们在做爬虫的过程中经常会遇到这样的情况，最初爬虫正常运行，正常抓取数据，一切看起来都是那么的美好，然而一杯茶的功夫可能就会出现错误，比如 403 Forbidden，这时候打开网页一看，可能会看到“您的 IP 访问频率太高”这样的提示，或者跳出一个验证码让我们输入，输入之后才可能解封，但是输入之后过一会儿就又这样了。 出现这样的现象的原因是网站采取了一些反爬虫的措施，比如服务器会检测某个 IP 在单位时间内的请求次数，如果超过了这个阈值，那么会直接拒绝服务，返回一些错误信息，这种情况可以称之为封 IP，于是乎就成功把我们的爬虫禁掉了。 既然服务器检测的是某个 IP 单位时间的请求次数，那么我们借助某种方式来伪装我们的 IP，让服务器识别不出是由我们本机发起的请求，不就可以成功防止封 IP 了吗？ 所以这时候代理就派上用场了，本章我们会详细介绍一下代理的基本知识及各种代理的使用方式，帮助爬虫脱离封 IP 的苦海。 本章接下来会介绍代理的设置、代理池的维护、付费代理的使用、ADSL拨号代理的搭建方法。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-08-02 14:02:17" itemprop="dateCreated datePublished" datetime="2019-08-02T14:02:17+08:00">2019-08-02</time>
                </span>
                <span id="/7043.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 9-代理的使用" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>438</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/7041.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/7041.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 8.4-微博宫格验证码的识别</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>本节我们来介绍一下新浪微博宫格验证码的识别，此验证码是一种新型交互式验证码，每个宫格之间会有一条指示连线，指示了我们应该的滑动轨迹，我们需要按照滑动轨迹依次从起始宫格一直滑动到终止宫格才可以完成验证，如图 8-24 所示： <img src="https://cdn.cuiqingcai.com/2019-08-02-055351.png" alt=""> 图 8-24 验证码示例 鼠标滑动后的轨迹会以黄色的连线来标识，如图 8-25 所示： <img src="https://cdn.cuiqingcai.com/2019-08-02-055407.jpg" alt=""> 图 8-25 滑动过程 我们可以访问新浪微博移动版登录页面就可以看到如上验证码，链接为：<a href="https://passport.weibo.cn/signin/login" target="_blank" rel="noopener">https://passport.weibo.cn/signin/login</a>，当然也不是每次都会出现验证码，一般当频繁登录或者账号存在安全风险的时候会出现。 接下来我们就来试着识别一下此类验证码。</p>
                  <h3 id="1-本节目标"><a href="#1-本节目标" class="headerlink" title="1. 本节目标"></a>1. 本节目标</h3>
                  <p>本节我们的目标是用程序来识别并通过微博宫格验证码的验证。</p>
                  <h3 id="2-准备工作"><a href="#2-准备工作" class="headerlink" title="2. 准备工作"></a>2. 准备工作</h3>
                  <p>本次我们使用的 Python 库是 Selenium，使用的浏览器为 Chrome，在此之前请确保已经正确安装好了 Selenium 库、Chrome 浏览器并配置好了 ChromeDriver，相关流程可以参考第一章的说明。</p>
                  <h3 id="3-识别思路"><a href="#3-识别思路" class="headerlink" title="3. 识别思路"></a>3. 识别思路</h3>
                  <p>要识别首先要从探寻规律入手，那么首先我们找到的规律就是此验证码的四个宫格一定是有连线经过的，而且每一条连线上都会相应的指示箭头，连线的形状多样，如 C 型、Z 型、X 型等等，如图 8-26、8-27、8-28 所示： <img src="https://cdn.cuiqingcai.com/2019-08-02-055423.png" alt=""> 图 8-26 C 型 <img src="https://cdn.cuiqingcai.com/2019-08-02-055430.png" alt=""> 图 8-27 Z 型 <img src="https://cdn.cuiqingcai.com/2019-08-02-055434.png" alt=""> 图 8-28 X 型 而同时我们发现同一种类型它的连线轨迹是相同的，唯一不同的就是连线的方向，如图 8-29、8-30 所示： <img src="https://cdn.cuiqingcai.com/2019-08-02-055441.png" alt=""> 图 8-29 反向连线 <img src="https://cdn.cuiqingcai.com/2019-08-02-055457.png" alt=""> 图 8-30 正向连线 这两种验证码的连线轨迹是相同的，但是由于连线上面的指示箭头不同导致滑动的宫格顺序就有所不同。 所以要完全识别滑动宫格顺序的话就需要具体识别出箭头的朝向，而观察一下整个验证码箭头朝向一共可能有 8 种，而且会出现在不同的位置，如果要写一个箭头方向识别算法的话需要都考虑到不同箭头所在的位置，我们需要找出各个位置的箭头的像素点坐标，同时识别算法还需要计算其像素点变化规律，这个工作量就变得比较大。 这时我们可以考虑用模板匹配的方法，模板匹配的意思就是将一些识别目标提前保存下来并做好标记，称作模板，在这里我们就可以获取验证码图片并做好拖动顺序的标记当做模板。在匹配的时候来对比要新识别的目标和每一个模板哪个是匹配的，如果找到匹配的模板，则被匹配到的模板就和新识别的目标是相同的，这样就成功识别出了要新识别的目标了。模板匹配在图像识别中也是非常常用的一种方法，实现简单而且易用性好。 模板匹配方法如果要效果好的话，我们必须要收集到足够多的模板才可以，而对于微博宫格验证码来说，宫格就 4 个，验证码的样式最多就是 4 <em> 3 </em> 2 * 1 = 24 种，所以我们可以直接将所有模板都收集下来。 所以接下来我们需要考虑的就是用何种模板来进行匹配，是只匹配箭头还是匹配整个验证码全图呢？我们来权衡一下这两种方式的匹配精度和工作量：</p>
                  <ul>
                    <li>首先是精度问题。如果要匹配箭头的话，我们比对的目标只有几个像素点范围的箭头，而且我们需要精确知道各个箭头所在的像素点，一旦像素点有所偏差，那么匹配模板的时候会直接错位，导致匹配结果大打折扣。如果匹配全图，我们无需关心箭头所在位置，同时还有连线帮助辅助匹配，所以匹配精度上显然是全图匹配精度更高。</li>
                    <li>其次是工作量的问题。如果要匹配箭头的话，我们需要将所有不同朝向的箭头模板都保存下来，而相同位置箭头的朝向可能不一，相同朝向的箭头位置可能不一，这时候我们需要都算出各个箭头的位置并将其逐个截出来保存成模板，同时在匹配的时候也需要依次去探寻验证码对应位置是否有匹配模板。如果匹配全图的话，我们不需要关心每个箭头的位置和朝向，只需要将验证码全图保存下来即可，在匹配的时候也不需要再去计算箭头的位置，所以工作量上明显是匹配全图更小。</li>
                  </ul>
                  <p>所以综上考虑，我们选用全图匹配的方式来进行识别。 所以到此为止，我们就可以使用全图模板匹配的方法来识别这个宫格验证码了，找到匹配的模板之后，我们就可以得到事先为模板定义的拖动顺序，然后模拟拖动即可。</p>
                  <h3 id="4-获取模板"><a href="#4-获取模板" class="headerlink" title="4. 获取模板"></a>4. 获取模板</h3>
                  <p>在开始之前，我们需要做一下准备工作，先将 24 张验证码全图保存下来，保存工作难道需要手工来做吗？当然不是的，因为验证码是随机的，一共有 24 种，所以我们可以写一段程序来批量保存一些验证码图片，然后从中筛选出需要的图片就好了，代码如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.common.exceptions <span class="keyword">import</span> TimeoutException</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"></span><br><span class="line">USERNAME = <span class="string">''</span></span><br><span class="line">PASSWORD = <span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CrackWeiboSlide</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.url = <span class="string">'https://passport.weibo.cn/signin/login'</span></span><br><span class="line">        self.browser = webdriver.Chrome()</span><br><span class="line">        self.wait = WebDriverWait(self.browser, <span class="number">20</span>)</span><br><span class="line">        self.username = USERNAME</span><br><span class="line">        self.password = PASSWORD</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__del__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.browser.close()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">open</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        打开网页输入用户名密码并点击</span></span><br><span class="line"><span class="string">        :return: None</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.browser.get(self.url)</span><br><span class="line">        username = self.wait.until(EC.presence_of_element_located((By.ID, <span class="string">'loginName'</span>)))</span><br><span class="line">        password = self.wait.until(EC.presence_of_element_located((By.ID, <span class="string">'loginPassword'</span>)))</span><br><span class="line">        submit = self.wait.until(EC.element_to_be_clickable((By.ID, <span class="string">'loginAction'</span>)))</span><br><span class="line">        username.send_keys(self.username)</span><br><span class="line">        password.send_keys(self.password)</span><br><span class="line">        submit.click()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_position</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        获取验证码位置</span></span><br><span class="line"><span class="string">        :return: 验证码位置元组</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            img = self.wait.until(EC.presence_of_element_located((By.CLASS_NAME, <span class="string">'patt-shadow'</span>)))</span><br><span class="line">        <span class="keyword">except</span> TimeoutException:</span><br><span class="line">            print(<span class="string">'未出现验证码'</span>)</span><br><span class="line">            self.open()</span><br><span class="line">        time.sleep(<span class="number">2</span>)</span><br><span class="line">        location = img.location</span><br><span class="line">        size = img.size</span><br><span class="line">        top, bottom, left, right = location[<span class="string">'y'</span>], location[<span class="string">'y'</span>] + size[<span class="string">'height'</span>], location[<span class="string">'x'</span>], location[<span class="string">'x'</span>] + size[<span class="string">'width'</span>]</span><br><span class="line">        <span class="keyword">return</span> (top, bottom, left, right)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_screenshot</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        获取网页截图</span></span><br><span class="line"><span class="string">        :return: 截图对象</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        screenshot = self.browser.get_screenshot_as_png()</span><br><span class="line">        screenshot = Image.open(BytesIO(screenshot))</span><br><span class="line">        <span class="keyword">return</span> screenshot</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_image</span><span class="params">(self, name=<span class="string">'captcha.png'</span>)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        获取验证码图片</span></span><br><span class="line"><span class="string">        :return: 图片对象</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        top, bottom, left, right = self.get_position()</span><br><span class="line">        print(<span class="string">'验证码位置'</span>, top, bottom, left, right)</span><br><span class="line">        screenshot = self.get_screenshot()</span><br><span class="line">        captcha = screenshot.crop((left, top, right, bottom))</span><br><span class="line">        captcha.save(name)</span><br><span class="line">        <span class="keyword">return</span> captcha</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        批量获取验证码</span></span><br><span class="line"><span class="string">        :return: 图片对象</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            self.open()</span><br><span class="line">            self.get_image(str(count) + <span class="string">'.png'</span>)</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    crack = CrackWeiboSlide()</span><br><span class="line">    crack.main()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中这里需要将 USERNAME 和 PASSWORD 修改为自己微博的用户名密码，运行一段时间后便可以发现在本地多了很多以数字命名的验证码，如图 8-31 所示： <img src="https://cdn.cuiqingcai.com/2019-08-02-055514.jpg" alt=""> 图 8-31 获取结果 在这里我们只需要挑选出不同的 24 张验证码图片并命名保存就好了，名称可以直接取作宫格的滑动的顺序，如某张验证码图片如图 8-32 所示： <img src="https://cdn.cuiqingcai.com/2019-08-02-055525.png" alt=""> 图 8-32 验证码示例 我们将其命名为 4132.png 即可，也就是代表滑动顺序为 4-1-3-2，按照这样的规则，我们将验证码整理为如下 24 张图，如图 8-33 所示： <img src="https://cdn.cuiqingcai.com/2019-08-02-055531.jpg" alt=""> 图 8-33 整理结果 如上的 24 张图就是我们的模板，接下来我们在识别的时候只需要遍历模板进行匹配即可。</p>
                  <h3 id="5-模板匹配"><a href="#5-模板匹配" class="headerlink" title="5. 模板匹配"></a>5. 模板匹配</h3>
                  <p>上面的代码已经实现了将验证码保存下来的功能，通过调用 get_image() 方法我们便可以得到验证码图片对象，得到验证码对象之后我们就需要对其进行模板匹配了，定义如下的方法进行匹配：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> listdir</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">detect_image</span><span class="params">(self, image)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    匹配图片</span></span><br><span class="line"><span class="string">    :param image: 图片</span></span><br><span class="line"><span class="string">    :return: 拖动顺序</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">for</span> template_name <span class="keyword">in</span> listdir(TEMPLATES_FOLDER):</span><br><span class="line">        print(<span class="string">'正在匹配'</span>, template_name)</span><br><span class="line">        template = Image.open(TEMPLATES_FOLDER + template_name)</span><br><span class="line">        <span class="keyword">if</span> self.same_image(image, template):</span><br><span class="line">            <span class="comment"># 返回顺序</span></span><br><span class="line">            numbers = [int(number) <span class="keyword">for</span> number <span class="keyword">in</span> list(template_name.split(<span class="string">'.'</span>)[<span class="number">0</span>])]</span><br><span class="line">            print(<span class="string">'拖动顺序'</span>, numbers)</span><br><span class="line">            <span class="keyword">return</span> numbers</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里 TEMPLATES_FOLDER 就是模板所在的文件夹，在这里我们用 listdir() 方法将所有模板的文件名称获取出来，然后对其进行遍历，通过 same_image() 方法对验证码和模板进行比对，如果成功匹配，那么就将匹配到的模板文件名转为列表，如匹配到了 3124.png，则返回结果 [3, 1, 2, 4]。 比对的方法实现如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_pixel_equal</span><span class="params">(self, image1, image2, x, y)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    判断两个像素是否相同</span></span><br><span class="line"><span class="string">    :param image1: 图片1</span></span><br><span class="line"><span class="string">    :param image2: 图片2</span></span><br><span class="line"><span class="string">    :param x: 位置x</span></span><br><span class="line"><span class="string">    :param y: 位置y</span></span><br><span class="line"><span class="string">    :return: 像素是否相同</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># 取两个图片的像素点</span></span><br><span class="line">    pixel1 = image1.load()[x, y]</span><br><span class="line">    pixel2 = image2.load()[x, y]</span><br><span class="line">    threshold = <span class="number">20</span></span><br><span class="line">    <span class="keyword">if</span> abs(pixel1[<span class="number">0</span>] - pixel2[<span class="number">0</span>]) &lt; threshold <span class="keyword">and</span> abs(pixel1[<span class="number">1</span>] - pixel2[<span class="number">1</span>]) &lt; threshold <span class="keyword">and</span> abs(</span><br><span class="line">            pixel1[<span class="number">2</span>] - pixel2[<span class="number">2</span>]) &lt; threshold:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">same_image</span><span class="params">(self, image, template)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    识别相似验证码</span></span><br><span class="line"><span class="string">    :param image: 待识别验证码</span></span><br><span class="line"><span class="string">    :param template: 模板</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># 相似度阈值</span></span><br><span class="line">    threshold = <span class="number">0.99</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> range(image.width):</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> range(image.height):</span><br><span class="line">            <span class="comment"># 判断像素是否相同</span></span><br><span class="line">            <span class="keyword">if</span> self.is_pixel_equal(image, template, x, y):</span><br><span class="line">                count += <span class="number">1</span></span><br><span class="line">    result = float(count) / (image.width * image.height)</span><br><span class="line">    <span class="keyword">if</span> result &gt; threshold:</span><br><span class="line">        print(<span class="string">'成功匹配'</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里比对图片也是利用了遍历像素的方法，same_image() 方法接收两个参数，image 为待检测的验证码图片对象，template 是模板对象，由于二者大小是完全一致的，所以在这里我们遍历了图片的所有像素点，比对二者同一位置的像素点是否相同，如果相同就计数加 1，最后计算一下相同的像素点占总像素的比例，如果该比例超过一定阈值那就判定为图片完全相同，匹配成功。在这里设定阈值为 0.99，即如果二者有 0.99 以上的相似比则代表匹配成功。 这样通过上面的方法，依次匹配 24 个模板，如果验证码图片正常，总能找到一个匹配的模板，这样最后就可以得到宫格的滑动顺序了。</p>
                  <h3 id="6-模拟拖动"><a href="#6-模拟拖动" class="headerlink" title="6. 模拟拖动"></a>6. 模拟拖动</h3>
                  <p>得到了滑动顺序之后，我们接下来就是根据滑动顺序来拖动鼠标连接各个宫格了，方法实现如下：</p>
                  <figure class="highlight perl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">def move(self, numbers):</span><br><span class="line">    <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">    根据顺序拖动</span></span><br><span class="line"><span class="string">    :param numbers:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    "</span><span class="string">""</span></span><br><span class="line">    <span class="comment"># 获得四个按点</span></span><br><span class="line">    circles = self.browser.find_elements_by_css_selector(<span class="string">'.patt-wrap .patt-circ'</span>)</span><br><span class="line">    dx = dy = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">index</span> in range(<span class="number">4</span>):</span><br><span class="line">        circle = circles[numbers[<span class="keyword">index</span>] - <span class="number">1</span>]</span><br><span class="line">        <span class="comment"># 如果是第一次循环</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">index</span> == <span class="number">0</span>:</span><br><span class="line">            <span class="comment"># 点击第一个按点</span></span><br><span class="line">            ActionChains(self.browser)</span><br><span class="line">                .move_to_element_with_offset(circle, circle.size[<span class="string">'width'</span>] / <span class="number">2</span>, circle.size[<span class="string">'height'</span>] / <span class="number">2</span>)</span><br><span class="line">                .click_and_hold().perform()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 小幅移动次数</span></span><br><span class="line">            <span class="keyword">times</span> = <span class="number">30</span></span><br><span class="line">            <span class="comment"># 拖动</span></span><br><span class="line">            <span class="keyword">for</span> i in range(<span class="keyword">times</span>):</span><br><span class="line">                ActionChains(self.browser).move_by_offset(dx / <span class="keyword">times</span>, dy / <span class="keyword">times</span>).perform()</span><br><span class="line">                time.sleep(<span class="number">1</span> / <span class="keyword">times</span>)</span><br><span class="line">        <span class="comment"># 如果是最后一次循环</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">index</span> == <span class="number">3</span>:</span><br><span class="line">            <span class="comment"># 松开鼠标</span></span><br><span class="line">            ActionChains(self.browser).release().perform()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 计算下一次偏移</span></span><br><span class="line">            dx = circles[numbers[<span class="keyword">index</span> + <span class="number">1</span>] - <span class="number">1</span>].location[<span class="string">'x'</span>] - circle.location[<span class="string">'x'</span>]</span><br><span class="line">            dy = circles[numbers[<span class="keyword">index</span> + <span class="number">1</span>] - <span class="number">1</span>].location[<span class="string">'y'</span>] - circle.location[<span class="string">'y'</span>]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里方法接收的参数就是宫格的点按顺序，如 [3, 1, 2, 4]。首先我们利用 find_elements_by_css_selector() 方法获取到四个宫格元素，是一个列表形式，每个元素代表一个宫格，接下来我们遍历了宫格的点按顺序，再做一系列对应操作。 其中如果是第一个宫格，那就直接鼠标点击并保持动作，否则移动到下一个宫格。如果是最后一个宫格，那就松开鼠标，否则计算移动到下一个宫格的偏移量。 通过四次循环，我们便可以成功操作浏览器完成宫格验证码的拖拽填充，松开鼠标之后即可识别成功。 运行效果如图 8-34 所示： <img src="https://cdn.cuiqingcai.com/2019-08-02-055449.png" alt=""> 图 8-34 运行效果 鼠标会慢慢的从起始位置移动到终止位置，最后一个宫格松开之后便完成了验证码的识别。 至此，微博宫格验证码的识别就全部完成了。 识别完成之后验证码窗口会自动关闭，接下来直接点击登录按钮即可完成微博登录。</p>
                  <h3 id="7-本节代码"><a href="#7-本节代码" class="headerlink" title="7. 本节代码"></a>7. 本节代码</h3>
                  <p>本节代码地址为：<a href="https://github.com/Python3WebSpider/CrackWeiboSlide" target="_blank" rel="noopener">https://github.com/Python3WebSpider/CrackWeiboSlide</a>。</p>
                  <h3 id="8-结语"><a href="#8-结语" class="headerlink" title="8. 结语"></a>8. 结语</h3>
                  <p>本节我们介绍了一种常用的模板匹配识别图片的方式来识别验证码，并模拟了鼠标拖拽动作来实现验证码的识别。如果遇到类似的验证码，可以采用同样的思路进行识别。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-08-02 13:56:40" itemprop="dateCreated datePublished" datetime="2019-08-02T13:56:40+08:00">2019-08-02</time>
                </span>
                <span id="/7041.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 8.4-微博宫格验证码的识别" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>7k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>6 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/7039.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/7039.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 8.3-点触点选验证码的识别</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>上一节我们实现了极验验证码的识别，但是除了极验其实还有另一种常见的且应用广泛的验证码，比较有代表性的就是点触验证码。 可能你对这个名字比较陌生，但是肯定见过类似的验证码，比如 12306，这就是一种典型的点触验证码，如图 8-18 所示： <img src="https://cdn.cuiqingcai.com/2019-08-02-055135.jpg" alt=""> 图 8-18 12306 验证码 我们需要直接点击图中符合要求的图，如果所有答案均正确才会验证成功，如果有一个答案错误，验证就会失败，这种验证码就可以称之为点触验证码。 另外还有一个专门提供点触验证码服务的站点，叫做 TouClick，其官方网站为：<a href="https://www.touclick.com/" target="_blank" rel="noopener">https://www.touclick.com/</a>，本节就以它为例讲解一下此类验证码的识别过程。</p>
                  <h3 id="1-本节目标"><a href="#1-本节目标" class="headerlink" title="1. 本节目标"></a>1. 本节目标</h3>
                  <p>本节我们的目标是用程序来识别并通过点触验证码的验证。</p>
                  <h3 id="2-准备工作"><a href="#2-准备工作" class="headerlink" title="2. 准备工作"></a>2. 准备工作</h3>
                  <p>本次我们使用的 Python 库是 Selenium，使用的浏览器为 Chrome，在此之前请确保已经正确安装好了 Selenium 库、Chrome 浏览器并配置好了 ChromeDriver，相关流程可以参考第一章的说明。</p>
                  <h3 id="3-了解点触验证码"><a href="#3-了解点触验证码" class="headerlink" title="3. 了解点触验证码"></a>3. 了解点触验证码</h3>
                  <p>TouClick 官方网站的验证码样式如图 8-19 所示： <img src="https://cdn.cuiqingcai.com/2019-08-02-055138.jpg" alt=""> 图 8-19 验证码样式 和 12306 站点有相似之处，不过这次是点击图片中的文字，不是图片了，另外还有各种形形色色的点触验证码，其交互形式可能略有不同，但基本原理都是类似的。 接下来我们就来统一实现一下此类点触验证码的识别过程。</p>
                  <h3 id="4-识别思路"><a href="#4-识别思路" class="headerlink" title="4. 识别思路"></a>4. 识别思路</h3>
                  <p>此种验证码的如果依靠图像识别的话识别难度非常之大。 例如就 12306 来说，其识别难点有两个点，第一点是文字识别，如图 8-20 所示： <img src="https://cdn.cuiqingcai.com/2019-08-02-055142.jpg" alt=""> 图 8-20 12306 验证码 如点击图中所有的漏斗，“漏斗”二字其实都经过变形、放缩、模糊处理了，如果要借助于前面我们讲的 OCR 技术来识别，识别的精准度会大打折扣，甚至得不到任何结果。第二点是图像的识别，我们需要将图像重新转化文字，可以借助于各种识图接口，可经我测试识别正确结果的准确率非常低，经常会出现匹配不正确或匹配不出结果的情况，而且图片本身的的清晰度也不够，所以识别难度会更大，更何况需要同时识别出八张图片的结果，且其中几个答案需要完全匹配正确才能验证通过，综合来看，此种方法基本是不可行的。 再拿 TouClick 来说，如图 8-21 所示： <img src="https://cdn.cuiqingcai.com/2019-08-02-055147.jpg" alt=""> 图 8-21 验证码示例 我们需要从这幅图片中识别出植株二字，但是图片的背景或多或少会有干扰，导致 OCR 几乎不会识别出结果，有人会说，直接识别白色的文字不就好了吗？但是如果换一张验证码呢？如图 8-22 所示： <img src="https://cdn.cuiqingcai.com/2019-08-02-055153.jpg" alt=""> 图 8-22 验证码示例 这张验证码图片的文字又变成了蓝色，而且还又有白色阴影，识别的难度又会大大增加。 那么此类验证码就没法解了吗？答案当然是有，靠什么？靠人。 靠人解决？那还要程序做什么？不要急，这里说的人并不是我们自己去解，在互联网上存在非常多的验证码服务平台，平台 7x24 小时提供验证码识别服务，一张图片几秒就会获得识别结果，准确率可达 90% 以上，但是就需要花点钱来购买服务了，毕竟平台都是需要盈利的，不过不用担心，识别一个验证码只需要几分钱。 在这里我个人比较推荐的一个平台是超级鹰，其官网为：<a href="https://www.chaojiying.com" target="_blank" rel="noopener">https://www.chaojiying.com</a>，非广告。 其提供的服务种类非常广泛，可识别的验证码类型非常多，其中就包括此类点触验证码。 另外超级鹰平台同样支持简单的图形验证码识别，如果 OCR 识别有难度，同样可以用本节相同的方法借助此平台来识别，下面是此平台提供的一些服务：</p>
                  <ul>
                    <li>英文数字，提供最多 20 位英文数字的混合识别</li>
                    <li>中文汉字，提供最多 7 个汉字的识别</li>
                    <li>纯英文，提供最多 12 位的英文的识别</li>
                    <li>纯数字，提供最多 11 位的数字的识别</li>
                    <li>任意特殊字符，提供不定长汉字英文数字、拼音首字母、计算题、成语混合、 集装箱号等字符的识别</li>
                    <li>坐标选择识别，如复杂计算题、选择题四选一、问答题、点击相同的字、物品、动物等返回多个坐标的识别</li>
                  </ul>
                  <p>具体如有变动以官网为准：<a href="https://www.chaojiying.com/price.html" target="_blank" rel="noopener">https://www.chaojiying.com/price.html</a>。 而本节我们需要解决的就是属于最后一类，坐标多选识别的情况，我们需要做的就是将验证码图片提交给平台，然后平台会返回识别结果在图片中的坐标位置，接下来我们再解析坐标模拟点击就好了。 原理非常简单，下面我们就来实际用程序来实验一下。</p>
                  <h3 id="5-注册账号"><a href="#5-注册账号" class="headerlink" title="5. 注册账号"></a>5. 注册账号</h3>
                  <p>在开始之前，我们需要先注册一个超级鹰账号并申请一个软件 ID，注册页面链接为：<a href="https://www.chaojiying.com/user/reg/" target="_blank" rel="noopener">https://www.chaojiying.com/user/reg/</a>，注册完成之后还需要在后台开发商中心添加一个软件 ID，最后一件事就是充值一些题分，充值多少可以根据价格和识别量自行决定。</p>
                  <h3 id="6-获取-API"><a href="#6-获取-API" class="headerlink" title="6. 获取 API"></a>6. 获取 API</h3>
                  <p>做好上面的准备工作之后我们就可以开始用程序来对接验证码的识别了。 首先我们可以到官方网站下载对应的 Python API，链接为：<a href="https://www.chaojiying.com/api-14.html" target="_blank" rel="noopener">https://www.chaojiying.com/api-14.html</a>，但是此 API 是 Python2 版本的，是用 Requests 库来实现的，我们可以简单更改几个地方即可将其修改为 Python3 版本。 修改之后的 API 如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Chaojiying</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, username, password, soft_id)</span>:</span></span><br><span class="line">        self.username = username</span><br><span class="line">        self.password = md5(password.encode(<span class="string">'utf-8'</span>)).hexdigest()</span><br><span class="line">        self.soft_id = soft_id</span><br><span class="line">        self.base_params = &#123;</span><br><span class="line">            <span class="string">'user'</span>: self.username,</span><br><span class="line">            <span class="string">'pass2'</span>: self.password,</span><br><span class="line">            <span class="string">'softid'</span>: self.soft_id,</span><br><span class="line">        &#125;</span><br><span class="line">        self.headers = &#123;</span><br><span class="line">            <span class="string">'Connection'</span>: <span class="string">'Keep-Alive'</span>,</span><br><span class="line">            <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0)'</span>,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post_pic</span><span class="params">(self, im, codetype)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        im: 图片字节</span></span><br><span class="line"><span class="string">        codetype: 题目类型 参考 http://www.chaojiying.com/price.html</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">'codetype'</span>: codetype,</span><br><span class="line">        &#125;</span><br><span class="line">        params.update(self.base_params)</span><br><span class="line">        files = &#123;<span class="string">'userfile'</span>: (<span class="string">'ccc.jpg'</span>, im)&#125;</span><br><span class="line">        r = requests.post(<span class="string">'http://upload.chaojiying.net/Upload/Processing.php'</span>, data=params, files=files, headers=self.headers)</span><br><span class="line">        <span class="keyword">return</span> r.json()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">report_error</span><span class="params">(self, im_id)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        im_id:报错题目的图片ID</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">'id'</span>: im_id,</span><br><span class="line">        &#125;</span><br><span class="line">        params.update(self.base_params)</span><br><span class="line">        r = requests.post(<span class="string">'http://upload.chaojiying.net/Upload/ReportError.php'</span>, data=params, headers=self.headers)</span><br><span class="line">        <span class="keyword">return</span> r.json()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里定义了一个 Chaojiying 类，其构造函数接收三个参数，分别是超级鹰的用户名、密码以及软件 ID，保存好以备使用。 接下来是最重要的一个方法叫做 post_pic()，这里需要传入图片对象和验证码的代号，该方法会将图片对象和相关信息发给超级鹰的后台进行识别，然后将识别成功的 Json 返回回来。 另一个方法叫做 report_error()，这个是发生错误的时候的回调，如果验证码识别错误，调用此方法会返还相应的题分。 接下来我们以 TouClick 的官网为例来进行演示点触验证码的识别过程，链接为：<a href="http://admin.touclick.com/" target="_blank" rel="noopener">http://admin.touclick.com/</a>，如果没有注册账号可以先注册一个。</p>
                  <h3 id="7-初始化"><a href="#7-初始化" class="headerlink" title="7. 初始化"></a>7. 初始化</h3>
                  <p>首先我们需要初始化一些变量，如 WebDriver、Chaojiying 对象等等，代码实现如下：</p>
                  <figure class="highlight ruby">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">EMAIL = <span class="string">'cqc@cuiqingcai.com'</span></span><br><span class="line">PASSWORD = <span class="string">''</span></span><br><span class="line"><span class="comment"># 超级鹰用户名、密码、软件ID、验证码类型</span></span><br><span class="line">CHAOJIYING_USERNAME = <span class="string">'Germey'</span></span><br><span class="line">CHAOJIYING_PASSWORD = <span class="string">''</span></span><br><span class="line">CHAOJIYING_SOFT_ID = <span class="number">893590</span></span><br><span class="line">CHAOJIYING_KIND = <span class="number">9102</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CrackTouClick</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.url = <span class="string">'http://admin.touclick.com/login.html'</span></span><br><span class="line">        <span class="keyword">self</span>.browser = webdriver.Chrome()</span><br><span class="line">        <span class="keyword">self</span>.wait = WebDriverWait(<span class="keyword">self</span>.browser, <span class="number">20</span>)</span><br><span class="line">        <span class="keyword">self</span>.email = EMAIL</span><br><span class="line">        <span class="keyword">self</span>.password = PASSWORD</span><br><span class="line">        <span class="keyword">self</span>.chaojiying = Chaojiying(CHAOJIYING_USERNAME, CHAOJIYING_PASSWORD, CHAOJIYING_SOFT_ID)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里的账号和密码请自行修改。</p>
                  <h3 id="8-获取验证码"><a href="#8-获取验证码" class="headerlink" title="8. 获取验证码"></a>8. 获取验证码</h3>
                  <p>接下来的第一步就是完善相关表单，然后模拟点击呼出验证码，此步非常简单，代码实现如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">open</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    打开网页输入用户名密码</span></span><br><span class="line"><span class="string">    :return: None</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    self.browser.get(self.url)</span><br><span class="line">    email = self.wait.until(EC.presence_of_element_located((By.ID, <span class="string">'email'</span>)))</span><br><span class="line">    password = self.wait.until(EC.presence_of_element_located((By.ID, <span class="string">'password'</span>)))</span><br><span class="line">    email.send_keys(self.email)</span><br><span class="line">    password.send_keys(self.password)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_touclick_button</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    获取初始验证按钮</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    button = self.wait.until(EC.element_to_be_clickable((By.CLASS_NAME, <span class="string">'touclick-hod-wrap'</span>)))</span><br><span class="line">    <span class="keyword">return</span> button</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里 open() 方法负责填写表单，get_touclick_button() 方法则是获取验证码按钮，随后触发点击即可。 接下来我们需要类似上一节极验验证码图像获取一样，首先获取验证码图片的位置和大小，随后从网页截图里面截取相应的验证码图片就好了。代码实现如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_touclick_element</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    获取验证图片对象</span></span><br><span class="line"><span class="string">    :return: 图片对象</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    element = self.wait.until(EC.presence_of_element_located((By.CLASS_NAME, <span class="string">'touclick-pub-content'</span>)))</span><br><span class="line">    <span class="keyword">return</span> element</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_position</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    获取验证码位置</span></span><br><span class="line"><span class="string">    :return: 验证码位置元组</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    element = self.get_touclick_element()</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    location = element.location</span><br><span class="line">    size = element.size</span><br><span class="line">    top, bottom, left, right = location[<span class="string">'y'</span>], location[<span class="string">'y'</span>] + size[<span class="string">'height'</span>], location[<span class="string">'x'</span>], location[<span class="string">'x'</span>] + size[</span><br><span class="line">        <span class="string">'width'</span>]</span><br><span class="line">    <span class="keyword">return</span> (top, bottom, left, right)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_screenshot</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    获取网页截图</span></span><br><span class="line"><span class="string">    :return: 截图对象</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    screenshot = self.browser.get_screenshot_as_png()</span><br><span class="line">    screenshot = Image.open(BytesIO(screenshot))</span><br><span class="line">    <span class="keyword">return</span> screenshot</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_touclick_image</span><span class="params">(self, name=<span class="string">'captcha.png'</span>)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    获取验证码图片</span></span><br><span class="line"><span class="string">    :return: 图片对象</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    top, bottom, left, right = self.get_position()</span><br><span class="line">    print(<span class="string">'验证码位置'</span>, top, bottom, left, right)</span><br><span class="line">    screenshot = self.get_screenshot()</span><br><span class="line">    captcha = screenshot.crop((left, top, right, bottom))</span><br><span class="line">    <span class="keyword">return</span> captcha</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里 get_touclick_image() 方法即为从网页截图中截取对应的验证码图片，其中验证码图片的相对位置坐标由 get_position() 方法返回得到，最后我们得到的是一个 Image 对象。</p>
                  <h3 id="9-识别验证码"><a href="#9-识别验证码" class="headerlink" title="9. 识别验证码"></a>9. 识别验证码</h3>
                  <p>随后我们调用 Chaojiying 对象的 post_pic() 方法即可把图片发送给超级鹰后台，在这里发送的图像是字节流格式，代码实现如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">image = self.get_touclick_image()</span><br><span class="line">bytes_array = BytesIO()</span><br><span class="line">image.save(bytes_array, <span class="attribute">format</span>=<span class="string">'PNG'</span>)</span><br><span class="line"><span class="comment"># 识别验证码</span></span><br><span class="line">result = self.chaojiying.post_pic(bytes_array.getvalue(), CHAOJIYING_KIND)</span><br><span class="line"><span class="builtin-name">print</span>(result)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样运行之后 result 变量就是超级鹰后台的识别结果，可能运行需要等待几秒，毕竟后台还有人工来完成识别。 返回的结果是一个 Json，如果识别成功后一个典型的返回结果类似如下：</p>
                  <figure class="highlight 1c">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;'err_no': <span class="number">0</span>, 'err_str': 'OK', 'pic_id': '<span class="number">60020013809492</span><span class="number">0000</span>1', 'pic_str': '132,127|56,77', 'md5': '1f8e1d4bef8b<span class="number">1148</span>4cb1f1f<span class="number">34299865</span>b'&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中 pic_str 就是识别的文字的坐标，是以字符串形式返回的，每个坐标都以 | 分隔，所以接下来我们只需要将其解析之后再模拟点击即可，代码实现如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_points</span><span class="params">(self, captcha_result)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    解析识别结果</span></span><br><span class="line"><span class="string">    :param captcha_result: 识别结果</span></span><br><span class="line"><span class="string">    :return: 转化后的结果</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    groups = captcha_result.get(<span class="string">'pic_str'</span>).split(<span class="string">'|'</span>)</span><br><span class="line">    locations = [[int(number) <span class="keyword">for</span> number <span class="keyword">in</span> group.split(<span class="string">','</span>)] <span class="keyword">for</span> group <span class="keyword">in</span> groups]</span><br><span class="line">    <span class="keyword">return</span> locations</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">touch_click_words</span><span class="params">(self, locations)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    点击验证图片</span></span><br><span class="line"><span class="string">    :param locations: 点击位置</span></span><br><span class="line"><span class="string">    :return: None</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">for</span> location <span class="keyword">in</span> locations:</span><br><span class="line">        print(location)</span><br><span class="line">        ActionChains(self.browser).move_to_element_with_offset(self.get_touclick_element(), location[<span class="number">0</span>], location[<span class="number">1</span>]).click().perform()</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里我们用 get_points() 方法将识别结果变成了列表的形式，最后 touch_click_words() 方法则通过调用 move_to_element_with_offset() 方法依次传入解析后的坐标，然后点击即可。 这样我们就可以模拟完成坐标的点选了，运行效果如图 8-23 所示： <img src="https://cdn.cuiqingcai.com/2019-08-02-055241.jpg" alt=""> 图 8-23 点选效果 最后我们需要做的就是点击提交验证的按钮等待验证通过，再点击登录按钮即可成功登录，后续实现在此不再赘述。 这样我们就借助于在线验证码平台完成了点触验证码的识别，此种方法也是一种通用方法，用此方法来识别 12306 等验证码也是完全相同的原理。</p>
                  <h3 id="10-本节代码"><a href="#10-本节代码" class="headerlink" title="10. 本节代码"></a>10. 本节代码</h3>
                  <p>本节代码地址为：<a href="https://github.com/Python3WebSpider/CrackTouClick" target="_blank" rel="noopener">https://github.com/Python3WebSpider/CrackTouClick</a>。</p>
                  <h3 id="11-结语"><a href="#11-结语" class="headerlink" title="11. 结语"></a>11. 结语</h3>
                  <p>本节我们通过在线打码平台辅助完成了验证码的识别，这种识别方法非常强大，几乎任意的验证码都可以识别，如果遇到难题，借助于打码平台无疑是一个极佳的选择。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-08-02 13:53:42" itemprop="dateCreated datePublished" datetime="2019-08-02T13:53:42+08:00">2019-08-02</time>
                </span>
                <span id="/7039.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 8.3-点触点选验证码的识别" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>7k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>6 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/7037.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/7037.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 8.2-极验滑动验证码的识别</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>上节我们了解了图形验证码的识别，简单的图形验证码我们可以直接利用 Tesserocr 来识别，但是近几年又出现了一些新型验证码，如滑动验证码，比较有代表性的就是极验验证码，它需要拖动拼合滑块才可以完成验证，相对图形验证码来说识别难度上升了几个等级，本节来讲解下极验验证码的识别过程。</p>
                  <h3 id="1-本节目标"><a href="#1-本节目标" class="headerlink" title="1. 本节目标"></a>1. 本节目标</h3>
                  <p>本节我们的目标是用程序来识别并通过极验验证码的验证，其步骤有分析识别思路、识别缺口位置、生成滑块拖动路径，最后模拟实现滑块拼合通过验证。</p>
                  <h3 id="2-准备工作"><a href="#2-准备工作" class="headerlink" title="2. 准备工作"></a>2. 准备工作</h3>
                  <p>本次我们使用的 Python 库是 Selenium，使用的浏览器为 Chrome，在此之前请确保已经正确安装好了 Selenium 库、Chrome 浏览器并配置好了 ChromeDriver，相关流程可以参考第一章的说明。</p>
                  <h3 id="3-了解极验验证码"><a href="#3-了解极验验证码" class="headerlink" title="3. 了解极验验证码"></a>3. 了解极验验证码</h3>
                  <p>极验验证码其官网为：<a href="http://www.geetest.com/" target="_blank" rel="noopener">http://www.geetest.com/</a>，它是一个专注于提供验证安全的系统，主要验证方式是拖动滑块拼合图像，若图像完全拼合，则验证成功，即可以成功提交表单，否则需要重新验证，样例如图 8-5 和 8-6 所示： <img src="https://cdn.cuiqingcai.com/2019-08-02-054905.jpg" alt=""> 图 8-5 验证码示例 <img src="https://cdn.cuiqingcai.com/2019-08-02-054908.jpg" alt=""> 图 8-6 验证码示例 现在极验验证码已经更新到了 3.0 版本，截至 2017 年 7 月全球已有十六万家企业正在使用极验，每天服务响应超过四亿次，广泛应用于直播视频、金融服务、电子商务、游戏娱乐、政府企业等各大类型网站，下面是斗鱼、魅族的登录页面，可以看到其都对接了极验验证码，如图 8-7 和 8-8 所示： <img src="https://cdn.cuiqingcai.com/2019-08-02-054908.jpg" alt=""> 图 8-7 斗鱼登录页面 <img src="https://cdn.cuiqingcai.com/2019-08-02-054912.jpg" alt=""> 图 8-8 魅族登录页面</p>
                  <h3 id="4-极验验证码的特点"><a href="#4-极验验证码的特点" class="headerlink" title="4. 极验验证码的特点"></a>4. 极验验证码的特点</h3>
                  <p>这种验证码相较于图形验证码来说识别难度更大，极验验证码首先需要在前台验证通过，对于极验 3.0，我们首先需要点击按钮进行智能验证，如果验证不通过，则会弹出滑动验证的窗口，随后需要拖动滑块拼合图像进行验证，验证之后会生成三个加密参数，参数随后通过表单提交到后台，后台还会进行一次验证。 另外极验还增加了机器学习的方法来识别拖动轨迹，官方网站的安全防护说明如下：</p>
                  <ul>
                    <li>三角防护之防模拟</li>
                  </ul>
                  <p>恶意程序模仿人类行为轨迹对验证码进行识别。针对模拟，极验拥有超过 4000 万人机行为样本的海量数据。利用机器学习和神经网络构建线上线下的多重静态、动态防御模型。识别模拟轨迹，界定人机边界。</p>
                  <ul>
                    <li>三角防护之防伪造</li>
                  </ul>
                  <p>恶意程序通过伪造设备浏览器环境对验证码进行识别。针对伪造，极验利用设备基因技术。深度分析浏览器的实际性能来辨识伪造信息。同时根据伪造事件不断更新黑名单，大幅提高防伪造能力。</p>
                  <ul>
                    <li>三角防护之防暴力</li>
                  </ul>
                  <p>恶意程序短时间内进行密集的攻击，对验证码进行暴力识别 针对暴力，极验拥有多种验证形态，每一种验证形态都有利用神经网络生成的海量图库储备，每一张图片都是独一无二的，且图库不断更新，极大程度提高了暴力识别的成本。 另外极验的验证相对于普通验证方式更加方便，体验更加友好，其官方网站说明如下：</p>
                  <ul>
                    <li>点击一下，验证只需要 0.4 秒</li>
                  </ul>
                  <p>极验始终专注于去验证化实践，让验证环节不再打断产品本身的交互流程，最终达到优化用户体验和提高用户转化率的效果。</p>
                  <ul>
                    <li>全平台兼容，适用各种交互场景</li>
                  </ul>
                  <p>极验兼容所有主流浏览器甚至古老的 IE6，也可以轻松应用在 iOS 和 Android 移动端平台，满足各种业务需求，保护网站资源不被滥用和盗取。</p>
                  <ul>
                    <li>面向未来，懂科技，更懂人性</li>
                  </ul>
                  <p>极验在保障安全同时不断致力于提升用户体验，精雕细琢的验证面板，流畅顺滑的验证动画效果，让验证过程不再枯燥乏味。 因此，相较于一般验证码，极验的验证安全性和易用性有了非常大的提高。</p>
                  <h3 id="5-识别思路"><a href="#5-识别思路" class="headerlink" title="5. 识别思路"></a>5. 识别思路</h3>
                  <p>但是对于应用了极验验证码的网站，识别并不是没有办法的。如果我们直接模拟表单提交的话，加密参数的构造是个问题，参数构造有问题服务端就会校验失败，所以在这里我们采用直接模拟浏览器动作的方式来完成验证，在 Python 中我们就可以使用 Selenium 来通过完全模拟人的行为的方式来完成验证，此验证成本相对于直接去识别加密算法容易不少。 首先我们找到一个带有极验验证的网站，最合适的当然为极验官方后台了，链接为：<a href="https://account.geetest.com/login" target="_blank" rel="noopener">https://account.geetest.com/login</a>，首先可以看到在登录按钮上方有一个极验验证按钮，如图 8-9 所示： <img src="https://cdn.cuiqingcai.com/2019-08-02-054921.jpg" alt=""> 图 8-9 验证按钮 此按钮为智能验证按钮，点击一下即可智能验证，一般来说如果是同一个 Session，一小段时间内第二次登录便会直接通过验证，如果智能识别不通过，则会弹出滑动验证窗口，我们便需要拖动滑块来拼合图像完成二步验证，如图 8-10 所示： <img src="https://cdn.cuiqingcai.com/2019-08-02-054919.jpg" alt=""> 图 8-10 拖动示例 验证成功后验证按钮便会变成如下状态，如图 8-11 所示： <img src="https://cdn.cuiqingcai.com/2019-08-02-54922.jpg" alt=""> 图 8-11 验证成功结果 接下来我们便可以进行表单提交了。 所以在这里我们要识别验证需要做的有三步：</p>
                  <ul>
                    <li>模拟点击验证按钮</li>
                    <li>识别滑动缺口的位置</li>
                    <li>模拟拖动滑块</li>
                  </ul>
                  <p>第一步操作是最简单的，我们可以直接用 Selenium 模拟点击按钮即可。 第二步操作识别缺口的位置比较关键，需要用到图像的相关处理方法，那缺口怎么找呢？首先来观察一下缺口的样子，如图 8-12 和 8-13 所示： <img src="https://cdn.cuiqingcai.com/2019-08-02-054942.jpg" alt=""> 图 8-12 缺口示例 <img src="https://cdn.cuiqingcai.com/2019-08-02-054944.jpg" alt=""> 图 8-13 缺口示例 可以看到缺口的四周边缘有明显的断裂边缘，而且边缘和边缘周围有明显的区别，我们可以实现一个边缘检测算法来找出缺口的位置。对于极验来说，我们可以利用和原图对比检测的方式来识别缺口的位置，因为在没有滑动滑块之前，缺口其实是没有呈现的，如图 8-14 所示： <img src="https://cdn.cuiqingcai.com/2019-08-02-054940.jpg" alt=""> 图 8-14 初始状态 所以我们可以同时获取两张图片，设定一个对比阈值，然后遍历两张图片找出相同位置像素 RGB 差距超过此阈值的像素点位置，那么此位置就是缺口的位置。 第三步操作看似简单，但是其中的坑比较多，极验验证码增加了机器轨迹识别，匀速移动、随机速度移动等方法都是不行的，只有完全模拟人的移动轨迹才可以通过验证，而人的移动轨迹一般是先加速后减速的，这又涉及到物理学中加速度的相关问题，我们需要模拟这个过程才能成功。 有了基本的思路之后就让我们用程序来实现一下它的识别过程吧。</p>
                  <h3 id="6-初始化"><a href="#6-初始化" class="headerlink" title="6. 初始化"></a>6. 初始化</h3>
                  <p>首先这次我们选定的链接为：<a href="https://account.geetest.com/login" target="_blank" rel="noopener">https://account.geetest.com/login</a>，也就是极验的管理后台登录页面，在这里我们首先初始化一些配置，如 Selenium 对象的初始化及一些参数的配置：</p>
                  <figure class="highlight ruby">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">EMAIL = <span class="string">'test@test.com'</span></span><br><span class="line">PASSWORD = <span class="string">'123456'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CrackGeetest</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.url = <span class="string">'https://account.geetest.com/login'</span></span><br><span class="line">        <span class="keyword">self</span>.browser = webdriver.Chrome()</span><br><span class="line">        <span class="keyword">self</span>.wait = WebDriverWait(<span class="keyword">self</span>.browser, <span class="number">20</span>)</span><br><span class="line">        <span class="keyword">self</span>.email = EMAIL</span><br><span class="line">        <span class="keyword">self</span>.password = PASSWORD</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中 EMAIL 和 PASSWORD 就是登录极验需要的用户名和密码，如果没有的话可以先注册一下。</p>
                  <h3 id="7-模拟点击"><a href="#7-模拟点击" class="headerlink" title="7. 模拟点击"></a>7. 模拟点击</h3>
                  <p>随后我们需要实现第一步的操作，也就是模拟点击初始的验证按钮，所以我们定义一个方法来获取这个按钮，利用显式等待的方法来实现：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_geetest_button</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    获取初始验证按钮</span></span><br><span class="line"><span class="string">    :return: 按钮对象</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    button = self.wait.until(EC.element_to_be_clickable((By.CLASS_NAME, <span class="string">'geetest_radar_tip'</span>)))</span><br><span class="line">    <span class="keyword">return</span> button</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>获取之后就会获取一个 WebElement 对象，调用它的 click() 方法即可模拟点击，代码如下：</p>
                  <figure class="highlight armasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"># 点击验证按钮</span><br><span class="line"><span class="keyword">button </span>= <span class="keyword">self.get_geetest_button()</span></span><br><span class="line"><span class="keyword">button.click()</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>到这里我们第一步的工作就完成了。</p>
                  <h3 id="8-识别缺口"><a href="#8-识别缺口" class="headerlink" title="8. 识别缺口"></a>8. 识别缺口</h3>
                  <p>接下来我们需要识别缺口的位置，首先我们需要将前后的两张比对图片获取下来，然后比对二者的不一致的地方即为缺口。首先我们需要获取不带缺口的图片，利用 Selenium 选取图片元素，然后得到其所在位置和宽高，随后获取整个网页的截图，再从截图中裁切出来即可，代码实现如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_position</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    获取验证码位置</span></span><br><span class="line"><span class="string">    :return: 验证码位置元组</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    img = self.wait.until(EC.presence_of_element_located((By.CLASS_NAME, <span class="string">'geetest_canvas_img'</span>)))</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line">    location = img.location</span><br><span class="line">    size = img.size</span><br><span class="line">    top, bottom, left, right = location[<span class="string">'y'</span>], location[<span class="string">'y'</span>] + size[<span class="string">'height'</span>], location[<span class="string">'x'</span>], location[<span class="string">'x'</span>] + size[</span><br><span class="line">        <span class="string">'width'</span>]</span><br><span class="line">    <span class="keyword">return</span> (top, bottom, left, right)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_geetest_image</span><span class="params">(self, name=<span class="string">'captcha.png'</span>)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    获取验证码图片</span></span><br><span class="line"><span class="string">    :return: 图片对象</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    top, bottom, left, right = self.get_position()</span><br><span class="line">    print(<span class="string">'验证码位置'</span>, top, bottom, left, right)</span><br><span class="line">    screenshot = self.get_screenshot()</span><br><span class="line">    captcha = screenshot.crop((left, top, right, bottom))</span><br><span class="line">    <span class="keyword">return</span> captcha</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里 get_position() 函数首先获取了图片对象，然后获取了它的位置和宽高，随后返回了其左上角和右下角的坐标。而 get_geetest_image() 方法则是获取了网页截图，然后调用了 crop() 方法将图片再裁切出来，返回的是 Image 对象。 随后我们需要获取第二张图片，也就是带缺口的图片，要使得图片出现缺口，我们只需要点击一下下方的滑块即可，触发这个动作之后，图片中的缺口就会显现，实现如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_slider</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    获取滑块</span></span><br><span class="line"><span class="string">    :return: 滑块对象</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    slider = self.wait.until(EC.element_to_be_clickable((By.CLASS_NAME, <span class="string">'geetest_slider_button'</span>)))</span><br><span class="line">    <span class="keyword">return</span> slider</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>利用 get_slider() 方法获取滑块对象，接下来调用其 click() 方法即可触发点击，缺口图片即可呈现：</p>
                  <figure class="highlight crystal">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># 点按呼出缺口</span></span><br><span class="line">slider = <span class="keyword">self</span>.get_slider()</span><br><span class="line">slider.click()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>随后还是调用 get_geetest_image() 方法将第二张图片获取下来即可。 到现在我们就已经得到了两张图片对象了，分别赋值给变量 image1 和 image2，接下来对比图片获取缺口即可。要对比图片的不同之处，我们在这里遍历图片的每个坐标点，获取两张图片对应像素点的 RGB 数据，然后判断二者的 RGB 数据差异，如果差距超过在一定范围内，那就代表两个像素相同，继续比对下一个像素点，如果差距超过一定范围，则判断像素点不同，当前位置即为缺口位置，代码实现如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_pixel_equal</span><span class="params">(self, image1, image2, x, y)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    判断两个像素是否相同</span></span><br><span class="line"><span class="string">    :param image1: 图片1</span></span><br><span class="line"><span class="string">    :param image2: 图片2</span></span><br><span class="line"><span class="string">    :param x: 位置x</span></span><br><span class="line"><span class="string">    :param y: 位置y</span></span><br><span class="line"><span class="string">    :return: 像素是否相同</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># 取两个图片的像素点</span></span><br><span class="line">    pixel1 = image1.load()[x, y]</span><br><span class="line">    pixel2 = image2.load()[x, y]</span><br><span class="line">    threshold = <span class="number">60</span></span><br><span class="line">    <span class="keyword">if</span> abs(pixel1[<span class="number">0</span>] - pixel2[<span class="number">0</span>]) &lt; threshold <span class="keyword">and</span> abs(pixel1[<span class="number">1</span>] - pixel2[<span class="number">1</span>]) &lt; threshold <span class="keyword">and</span> abs(</span><br><span class="line">            pixel1[<span class="number">2</span>] - pixel2[<span class="number">2</span>]) &lt; threshold:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_gap</span><span class="params">(self, image1, image2)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    获取缺口偏移量</span></span><br><span class="line"><span class="string">    :param image1: 不带缺口图片</span></span><br><span class="line"><span class="string">    :param image2: 带缺口图片</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    left = <span class="number">60</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(left, image1.size[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(image1.size[<span class="number">1</span>]):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self.is_pixel_equal(image1, image2, i, j):</span><br><span class="line">                left = i</span><br><span class="line">                <span class="keyword">return</span> left</span><br><span class="line">    <span class="keyword">return</span> left</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>get_gap() 方法即为获取缺口位置的方法，此方法的参数为两张图片，一张为带缺口图片，另一张为不带缺口图片，在这里遍历两张图片的每个像素，然后利用 is_pixel_equal() 方法判断两张图片同一位置的像素是否相同，比对的时候比较了两张图 RGB 的绝对值是否均小于定义的阈值 threshold，如果均在阈值之内，则像素点相同，继续遍历，否则遇到不相同的像素点就是缺口的位置。 在这里比如两张对比图片如下，如图 8-15 和 8-16 所示： <img src="https://cdn.cuiqingcai.com/2019-08-02-054959.png" alt=""> 图 8-15 初始状态 <img src="https://cdn.cuiqingcai.com/2019-08-02-055003.jpg" alt=""> 图 8-16 后续状态 两张图片其实有两处明显不同的地方，一个就是待拼合的滑块，一个就是缺口，但是滑块的位置会出现在左边位置，缺口会出现在与滑块同一水平线的位置，所以缺口一般会在滑块的右侧，所以要寻找缺口的话，我们直接从滑块右侧寻找即可，所以在遍历的时候我们直接设置了遍历的起始横坐标为 60，也就是在滑块的右侧开始识别，这样识别出的结果就是缺口的位置了。 到现在为止，我们就可以获取缺口的位置了，剩下最后一步模拟拖动就可以完成验证了。</p>
                  <h3 id="9-模拟拖动"><a href="#9-模拟拖动" class="headerlink" title="9. 模拟拖动"></a>9. 模拟拖动</h3>
                  <p>模拟拖动的这个过程说复杂并不复杂，只是其中的坑比较多。现在我们已经获取到了缺口的位置，接下来只需要调用拖动的相关函数将滑块拖动到对应位置不就好了吗？然而事实很残酷，如果匀速拖动，极验必然会识别出来这是程序的操作，因为人是无法做到完全匀速拖动的，极验利用机器学习模型筛选出此类数据，归类为机器操作，验证码识别失败。 随后我又尝试了分段模拟，将拖动过程划分几段，每段设置一个平均速度，同时速度围绕该平均速度小幅度随机抖动，同样无法完成验证。 最后尝试了完全模拟加速减速的过程通过了验证，在前段滑块需要做匀加速运动，后面需要做匀减速运动，在这里利用物理学的加速度公式即可完成。 设滑块滑动的加速度用 a 来表示，当前速度用 v 表示，初速度用 v0 表示，位移用 x 表示，所需时间用 t 表示，则它们之间满足如下关系：</p>
                  <figure class="highlight excel">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">x = <span class="symbol">v0</span> * <span class="built_in">t</span> + <span class="number">0.5</span> * a * <span class="built_in">t</span> * <span class="built_in">t</span></span><br><span class="line">v = <span class="symbol">v0</span> + a * <span class="built_in">t</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来我们利用两个公式可以构造一个轨迹移动算法，计算出先加速后减速的运动轨迹，代码实现如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_track</span><span class="params">(self, distance)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    根据偏移量获取移动轨迹</span></span><br><span class="line"><span class="string">    :param distance: 偏移量</span></span><br><span class="line"><span class="string">    :return: 移动轨迹</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># 移动轨迹</span></span><br><span class="line">    track = []</span><br><span class="line">    <span class="comment"># 当前位移</span></span><br><span class="line">    current = <span class="number">0</span></span><br><span class="line">    <span class="comment"># 减速阈值</span></span><br><span class="line">    mid = distance * <span class="number">4</span> / <span class="number">5</span></span><br><span class="line">    <span class="comment"># 计算间隔</span></span><br><span class="line">    t = <span class="number">0.2</span></span><br><span class="line">    <span class="comment"># 初速度</span></span><br><span class="line">    v = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> current &lt; distance:</span><br><span class="line">        <span class="keyword">if</span> current &lt; mid:</span><br><span class="line">            <span class="comment"># 加速度为正2</span></span><br><span class="line">            a = <span class="number">2</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 加速度为负3</span></span><br><span class="line">            a = <span class="number">-3</span></span><br><span class="line">        <span class="comment"># 初速度v0</span></span><br><span class="line">        v0 = v</span><br><span class="line">        <span class="comment"># 当前速度v = v0 + at</span></span><br><span class="line">        v = v0 + a * t</span><br><span class="line">        <span class="comment"># 移动距离x = v0t + 1/2 * a * t^2</span></span><br><span class="line">        move = v0 * t + <span class="number">1</span> / <span class="number">2</span> * a * t * t</span><br><span class="line">        <span class="comment"># 当前位移</span></span><br><span class="line">        current += move</span><br><span class="line">        <span class="comment"># 加入轨迹</span></span><br><span class="line">        track.append(round(move))</span><br><span class="line">    <span class="keyword">return</span> track</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里我们定义了 get_track() 方法，传入的参数为移动的总距离，返回的是运动轨迹，用 track 表示，它是一个列表，列表的每个元素代表每次移动多少距离。 首先定义了一个变量 mid，即减速的阈值，也就是加速到什么位置就开始减速，在这里定义为 4/5，即模拟前 4/5 路程是加速过程，后 1/5 是减速过程。 随后定义了当前位移的距离变量 current，初始为 0，随后进入 while 循环，循环的条件是当前位移小于总距离。在循环里我们分段定义了加速度，其中加速过程加速度定义为 2，减速过程加速度定义为 -3，随后再套用位移公式计算出某个时间段内的位移，同时将当前位移更新并记录到轨迹里即可。 这样直到运动轨迹达到总距离时即终止循环，最后得到的 track 即记录了每个时间间隔移动了多少位移，这样滑块的运动轨迹就得到了。 最后我们只需要按照该运动轨迹拖动滑块即可，方法实现如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">move_to_gap</span><span class="params">(self, slider, tracks)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    拖动滑块到缺口处</span></span><br><span class="line"><span class="string">    :param slider: 滑块</span></span><br><span class="line"><span class="string">    :param tracks: 轨迹</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    ActionChains(self.browser).click_and_hold(slider).perform()</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> tracks:</span><br><span class="line">        ActionChains(self.browser).move_by_offset(xoffset=x, yoffset=<span class="number">0</span>).perform()</span><br><span class="line">    time.sleep(<span class="number">0.5</span>)</span><br><span class="line">    ActionChains(self.browser).release().perform()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里传入的参数为滑块对象和运动轨迹，首先调用 ActionChains 的 click_and_hold() 方法按住拖动底部滑块，随后遍历运动轨迹获取每小段位移距离，调用 move_by_offset() 方法移动此位移，最后移动完成之后调用 release() 方法松开鼠标即可。 这样再经过测试，验证就通过了，识别完成，效果图 8-17 所示： <img src="https://cdn.cuiqingcai.com/2019-08-02-055006.jpg" alt=""> 图 8-17 识别成功结果 最后，我们只需要将表单完善，模拟点击登录按钮即可完成登录，成功登录后即跳转到后台。 至此，极验验证码的识别工作即全部完成，此识别方法同样适用于其他使用极验 3.0 的网站，原理都是相同的。</p>
                  <h3 id="10-本节代码"><a href="#10-本节代码" class="headerlink" title="10. 本节代码"></a>10. 本节代码</h3>
                  <p>本节代码地址为：<a href="https://github.com/Python3WebSpider/CrackGeetest" target="_blank" rel="noopener">https://github.com/Python3WebSpider/CrackGeetest</a>。</p>
                  <h3 id="11-结语"><a href="#11-结语" class="headerlink" title="11. 结语"></a>11. 结语</h3>
                  <p>本节我们分析并实现了极验验证码的识别，其关键在于识别的思路，如怎样识别缺口位置，怎样生成运动轨迹等，学会了这些思路后以后我们再遇到类似原理的验证码同样可以完成识别过程。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-08-02 13:51:17" itemprop="dateCreated datePublished" datetime="2019-08-02T13:51:17+08:00">2019-08-02</time>
                </span>
                <span id="/7037.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 8.2-极验滑动验证码的识别" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>7.5k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>7 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/7035.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/7035.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 8.1-图形验证码的识别</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>本节我们首先来尝试识别最简单的一种验证码，图形验证码，这种验证码出现的最早，现在也很常见，一般是四位字母或者数字组成的，例如中国知网的注册页面就有类似的验证码，链接为：<a href="http://my.cnki.net/elibregister/commonRegister.aspx" target="_blank" rel="noopener">http://my.cnki.net/elibregister/commonRegister.aspx</a>，页面如图 8-1 所示： <img src="https://cdn.cuiqingcai.com/2019-08-02-054718.png" alt=""> 图 8-1 知网注册页面 表单的最后一项就是图形验证码，我们必须完全输入正确图中的字符才可以完成注册。</p>
                  <h3 id="1-本节目标"><a href="#1-本节目标" class="headerlink" title="1. 本节目标"></a>1. 本节目标</h3>
                  <p>本节我们就以知网的验证码为例，讲解一下利用 OCR 技术识别此种图形验证码的方法。</p>
                  <h3 id="2-准备工作"><a href="#2-准备工作" class="headerlink" title="2. 准备工作"></a>2. 准备工作</h3>
                  <p>识别图形验证码需要的库有 Tesserocr，如果没有安装可以参考第一章的安装说明。</p>
                  <h3 id="3-获取验证码"><a href="#3-获取验证码" class="headerlink" title="3. 获取验证码"></a>3. 获取验证码</h3>
                  <p>为了便于实验，我们先将验证码的图片保存到本地，以供测试。 打开开发者工具，找到验证码元素，可以看到这是一张图片，它的 src 属性是 CheckCode.aspx，在这里我们直接将这个链接打开：<a href="http://my.cnki.net/elibregister/CheckCode.aspx" target="_blank" rel="noopener">http://my.cnki.net/elibregister/CheckCode.aspx</a>，就可以看到一个验证码，直接右键保存下来即可，将名称命名为 code.jpg，如图 8-2 所示： <img src="https://cdn.cuiqingcai.com/2019-08-02-054745.jpg" alt=""> 图 8-2 验证码 这样我们就可以得到一张验证码图片供下面测试识别使用了。</p>
                  <h3 id="4-识别测试"><a href="#4-识别测试" class="headerlink" title="4. 识别测试"></a>4. 识别测试</h3>
                  <p>接下来我们新建一个项目，将验证码图片放到项目根目录下，用 Tesserocr 库来识别一下该验证码试试，代码如下：</p>
                  <figure class="highlight processing">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> tesserocr</span><br><span class="line">from PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line"><span class="built_in">image</span> = Image.<span class="built_in">open</span>(<span class="string">'code.jpg'</span>)</span><br><span class="line">result = tesserocr.image_to_text(<span class="built_in">image</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里我们首先新建了一个 Image 对象，然后调用了 Tesserocr 的 image_to_text() 方法，传入该 Image 对象即可完成识别，实现过程非常简单，识别结果如下：</p>
                  <figure class="highlight plain">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">JR42</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外 Tesserocr 还有一个更加简单的方法直接将图片文件转为字符串可以达到同样的效果，代码如下：</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import tesserocr</span><br><span class="line">print(<span class="name">tesserocr</span>.file_to_text('image.png'))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>不过经测试此种方法的识别效果不如上一种方法好。</p>
                  <h3 id="5-验证码处理"><a href="#5-验证码处理" class="headerlink" title="5. 验证码处理"></a>5. 验证码处理</h3>
                  <p>如上的图片识别基本没有难度，只是新建一个 Image 对象，然后调用 image_to_text() 方法即可得出图片的识别结果。 接下来我们换一个验证码试一下，命名为 code2.jpg，如图 8-3 所示： <img src="https://cdn.cuiqingcai.com/2019-08-02-054722.jpg" alt=""> 图 8-3 验证码 重新用下面的代码测试一下：</p>
                  <figure class="highlight processing">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> tesserocr</span><br><span class="line">from PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line"><span class="built_in">image</span> = Image.<span class="built_in">open</span>(<span class="string">'code2.jpg'</span>)</span><br><span class="line">result = tesserocr.image_to_text(<span class="built_in">image</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这时可以看到如下输出结果：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">FFKT</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>发现这次识别和实际的结果有所偏差，这是因为验证码内的多余线条干扰了图片的识别。 对于这种情况，我们还需要做一下额外的处理，如转灰度、二值化等操作。 我们可以利用 Image 对象的 convert() 方法参数传入 L 即可将图片转化为灰度图像，代码如下：</p>
                  <figure class="highlight maxima">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">image</span> = <span class="built_in">image</span>.<span class="built_in">convert</span>('L')</span><br><span class="line"><span class="built_in">image</span>.<span class="built_in">show</span>()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>传入 1 即可将图片进行二值化处理：</p>
                  <figure class="highlight maxima">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">image</span> = <span class="built_in">image</span>.<span class="built_in">convert</span>('<span class="number">1</span>')</span><br><span class="line"><span class="built_in">image</span>.<span class="built_in">show</span>()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外我们还可以指定二值化的阈值，上面的方法采用的是默认阈值 127，不过我们不能用原图直接转化，可以先转为灰度图像，然后再指定二值化阈值转化，代码如下：</p>
                  <figure class="highlight maxima">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">image</span> = <span class="built_in">image</span>.<span class="built_in">convert</span>('L')</span><br><span class="line">threshold = <span class="number">80</span></span><br><span class="line">table = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    <span class="keyword">if</span> i &lt; threshold:</span><br><span class="line">        table.<span class="built_in">append</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        table.<span class="built_in">append</span>(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">image</span> = <span class="built_in">image</span>.point(table, '<span class="number">1</span>')</span><br><span class="line"><span class="built_in">image</span>.<span class="built_in">show</span>()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里我们指定了一个变量 threshold 代表二值化阈值，阈值设置为 80，处理之后我们看一下结果，如图 8-4 所示： <img src="https://cdn.cuiqingcai.com/2019-08-02-054728.jpg" alt=""> 图 8-4 处理结果 经过处理之后我们发现原来的验证码中的线条已经被去除了，而且整个验证码变得黑白分明，这时重新识别验证码，代码如下：</p>
                  <figure class="highlight processing">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> tesserocr</span><br><span class="line">from PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line"><span class="built_in">image</span> = Image.<span class="built_in">open</span>(<span class="string">'code2.jpg'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">image</span> = <span class="built_in">image</span>.convert(<span class="string">'L'</span>)</span><br><span class="line">threshold = <span class="number">127</span></span><br><span class="line">table = []</span><br><span class="line"><span class="keyword">for</span> i in range(<span class="number">256</span>):</span><br><span class="line">    <span class="keyword">if</span> i &lt; threshold:</span><br><span class="line">        table.<span class="built_in">append</span>(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        table.<span class="built_in">append</span>(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">image</span> = <span class="built_in">image</span>.<span class="built_in">point</span>(table, <span class="string">'1'</span>)</span><br><span class="line">result = tesserocr.image_to_text(<span class="built_in">image</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>即可发现运行结果变成了：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">PFRT</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>识别正确。 可见对于一些有干扰的图片，我们做一些灰度和二值化处理，会提高其识别正确率。</p>
                  <h3 id="6-本节代码"><a href="#6-本节代码" class="headerlink" title="6. 本节代码"></a>6. 本节代码</h3>
                  <p>本节代码地址为：<a href="https://github.com/Python3WebSpider/CrackImageCode" target="_blank" rel="noopener">https://github.com/Python3WebSpider/CrackImageCode</a>。</p>
                  <h3 id="7-结语"><a href="#7-结语" class="headerlink" title="7. 结语"></a>7. 结语</h3>
                  <p>本节我们了解了利用 Tesserocr 识别验证码的过程，对于简单的图形验证码我们可以直接用它来得到结果，如果要提高识别的准确度还可以对验证码图片做一下预处理。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-08-02 13:48:53" itemprop="dateCreated datePublished" datetime="2019-08-02T13:48:53+08:00">2019-08-02</time>
                </span>
                <span id="/7035.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 8.1-图形验证码的识别" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/7032.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/7032.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 8-验证码的识别</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>当今时代，许多网站为了反爬虫采用了各种各样的措施，其中之一便是使用验证码，随着技术的发展，验证码的花样也越来越多，最初可能是几个数字组合的简单的图形验证码，后来加入了英文字母和混淆曲线使得验证码更加复杂，有的网站还可能看到中文字符的验证码，使得识别愈发困难。 而后来 12306 验证码的出现又开辟了验证码的新纪元，用过 12306 的肯定多少为它的验证码头疼过，它需要我们去识别文字，然后再点击文字描述相符的图片，只有完全正确才可以验证通过。现在这种交互式验证码越来越多，如极验滑动验证码需要滑动拼合滑块才可以完成验证，点触的验证码需要完全点击正确的结果才可以完成验证，另外还有一些滑动宫格验证码，计算题验证码等等五花八门。 验证码变得越来越复杂，爬虫的工作也变得愈发艰难，有时候我们必须通过验证码的验证才可以访问页面，所以本章专门来针对验证码的识别做一下统一的讲解。 本章涉及的验证码有普通图形验证码、极验滑动验证码、点触验证码、微博宫格验证码，识别的方式和思路各有不同，了解了这几个验证码的识别方式之后，我们可以举一反三，用类似的方法识别其他类型的验证码。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-08-02 13:45:53" itemprop="dateCreated datePublished" datetime="2019-08-02T13:45:53+08:00">2019-08-02</time>
                </span>
                <span id="/7032.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 8-验证码的识别" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>474</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6978.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 生活笔记 <i class="label-arrow"></i>
                  </a>
                  <a href="/6978.html" class="post-title-link" itemprop="url">人生数10载，你已度过几个10年？</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>人生一共就是由几个10年组成的，每个10年都有不同的经历，不同的心境，每个10年追求的东西都不一样。 鱼与熊掌不可兼得，在追求的过程中你总要有取舍，该取什么?该舍什么?</p>
                  <h2 id="10岁时"><a href="#10岁时" class="headerlink" title="10岁时"></a><strong><strong>10岁时</strong></strong></h2>
                  <p>应该不再计较家里给的零花钱多少，不和别人家的孩子比较穿名牌服装；少不更事，和人家比吃穿，还情有可原，年纪到了整数就该懂事了。</p>
                  <h2 id="20岁时"><a href="#20岁时" class="headerlink" title="20岁时"></a><strong><strong>20岁时</strong></strong></h2>
                  <p>不再计较自己的家庭出身，不再计较父母的职业十几岁时，会和别的孩子比较家庭出身，比爹娘官大官小，恨不得都投生帝王之家、将相之门，也是人之常情。 但如果到了“弱冠”之年，还弱不禁风，尚无自立之志，出身贫寒的还为家庭自卑，老觉得抬不起头来;出身富豪的还处处依靠父母，在家庭荫护下养尊处优，那就会一辈子都没出息。</p>
                  <h2 id="30岁时"><a href="#30岁时" class="headerlink" title="30岁时"></a><strong><strong>30岁时</strong></strong></h2>
                  <p>已成家立业，为父为母，有了几年家庭生活的经验。大丈夫该不再计较妻子的容貌，深知贤惠比美貌更重要，会过日子的媳妇比会打扮的媳妇更让人待见； 老婆该不再计较老公的身高，明白能力比身高更有作用，没有谋生能力的老公，纵然长成丈二金刚，还不如卖炊饼的大郎。</p>
                  <h2 id="40岁时"><a href="#40岁时" class="headerlink" title="40岁时"></a><strong><strong>40岁时</strong></strong></h2>
                  <p>不再计较别人的议论，谁爱说啥就说啥，自己想咋过就咋过。 人言可畏，想想上世纪30年代的阮玲玉还成如今的明星，一星期听不到他的绯闻轶事没人对他议论纷纷，他就急得火烧火燎的。 咱们虽然没有明星那高深道行，但不会再轻易被别人议论左右，这点本事应该有的，否则也对不起“不惑”这两个字啊。</p>
                  <h2 id="50岁时"><a href="#50岁时" class="headerlink" title="50岁时"></a><strong><strong>50岁时</strong></strong></h2>
                  <p>不再计较无处不在的不平之事，不再计较别人的成功对自己的压力，不再眼红他人的财。 半百之年，曾经沧海，阋人无数，见惯秋月春风，不再大惊小怪;历尽是非成败，不再愤愤不平看新贵飞扬跋扈，可不动声色;看大款挥金如土，也气定神闲，耐住性子。</p>
                  <h2 id="60岁时"><a href="#60岁时" class="headerlink" title="60岁时"></a><strong><strong>60岁时</strong></strong></h2>
                  <p>如果从政，该不再计较官大官小，退了体，官大官小一个样，都是退体干部。 如果经商，该不再计较利大利小，钱是挣不完的，再能花也是有限的，心态平和对自己身体有好处。 如果舞文弄墨，当不再计较文名大小，文坛座次。</p>
                  <h2 id="70岁时"><a href="#70岁时" class="headerlink" title="70岁时"></a><strong><strong>70岁时</strong></strong></h2>
                  <p>人到古稀，该不再计较的东西更多，看淡的事情更广。 年轻时争得你死我活的东西，现在只会淡然一笑。 中年时费尽心机格外计较的东西，如今看来已无关紧要。一生多少事，“都付笑谈中”。 这个岁数的老人，要有三样特别积极健康的身体、和谐的家庭、良好的名声。 人生在世，如果计较的东西太多，名利地位，金钱美色，样样都不肯放手，那就会如牛重负，活得很累。 反之，什么都不计较，什么都马马虎虎，什么都可以凑合，那也未免太对不起自己，活得没啥意思。 <strong><strong>人生智慧</strong></strong> <strong><strong>聪明的人，有生活智慧的人，会有所为，有所不为。他们只计较对自己最重要的东西，</strong></strong> <strong><strong>并且知道什么年龄该计较什么，不该计较什么，有取有舍，收放自如。</strong></strong></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/a385962416" class="author" itemprop="url" rel="index">a385962416</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-07-29 01:37:44" itemprop="dateCreated datePublished" datetime="2019-07-29T01:37:44+08:00">2019-07-29</time>
                </span>
                <span id="/6978.html" class="post-meta-item leancloud_visitors" data-flag-title="人生数10载，你已度过几个10年？" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.1k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6982.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6982.html" class="post-title-link" itemprop="url">你还在用 os.path？快来感受一下 pathlib 给你带来的便捷吧！</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <blockquote>
                    <p>相比常用的 os.path而言，pathlib 对于目录路径的操作更简介也更贴近 Pythonic。但是它不单纯是为了简化操作，还有更大的用途</p>
                  </blockquote>
                  <h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1>
                  <p>pathlib 是Python内置库，Python 文档给它的定义是 Object-oriented filesystem paths（面向对象的文件系统路径）。pathlib 提供表示文件系统路径的类，其语义适用于不同的操作系统。路径类在纯路径之间划分，纯路径提供纯粹的计算操作而没有I / O，以及具体路径，它继承纯路径但也提供I / O操作。 听起来有点绕？那就对了，毕竟这是直译过来的，但这并不影响我们喜爱它。 我们通过几个例子来了解它吧</p>
                  <h1 id="举个栗子"><a href="#举个栗子" class="headerlink" title="举个栗子"></a>举个栗子</h1>
                  <p>相对于 os 模块的 path 方法，Python3 标准库 pathlib 模块的 Path 对路径的操作会更简单。</p>
                  <h2 id="获取当前文件路径"><a href="#获取当前文件路径" class="headerlink" title="获取当前文件路径"></a>获取当前文件路径</h2>
                  <p>使用 os 模块时，有两种方法可以直接获取当前文件路径：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import os</span><br><span class="line"></span><br><span class="line">value1 = os<span class="selector-class">.path</span>.dirname(__file__)</span><br><span class="line">value2 = os.getcwd()</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(value1)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(value2)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><img src="https://user-gold-cdn.xitu.io/2018/11/23/1673f1a91bbe4553?w=1408&amp;h=512&amp;f=png&amp;s=79211" alt=""> pathlib 获取当前文件路径应该怎么写呢？ 官方文档给出了建议 <a href="https://docs.python.org/3/library/pathlib.html#methods" target="_blank" rel="noopener">插眼传送</a> <img src="https://user-gold-cdn.xitu.io/2018/11/23/1673f1e078abc837?w=863&amp;h=235&amp;f=png&amp;s=26250" alt=""> 动手试一试</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import pathlib</span><br><span class="line"></span><br><span class="line">value1 = pathlib<span class="selector-class">.Path</span>.cwd()</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(value1)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><img src="https://user-gold-cdn.xitu.io/2018/11/23/1673f1f1d4cb8275?w=1490&amp;h=501&amp;f=png&amp;s=71717" alt=""></p>
                  <h3 id="它是如何实现的"><a href="#它是如何实现的" class="headerlink" title="它是如何实现的"></a>它是如何实现的</h3>
                  <p>文档中有介绍，它以 os.getcwd() 的形式将路径返回。我们去源码中一探究竟（Pycharm 编辑器快捷键 ctrl+鼠标左键点击即可跟进指定对象） <img src="https://user-gold-cdn.xitu.io/2018/11/23/1673f227b220c55b?w=983&amp;h=214&amp;f=png&amp;s=23854" alt=""> 原来它是对 os 模块中一些对象进行了封装，看 cwd 的注释： <code>Return a new path pointing to the current working directory</code> 意为：返回指向当前工作目录的新路径。 看起来也没什么特别的，但是为什么官方特意将它推出呢？</p>
                  <h3 id="其他的封装"><a href="#其他的封装" class="headerlink" title="其他的封装"></a>其他的封装</h3>
                  <p>pathlib 封装了很多的 os path ，文档中有写明，如：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"># 关系说明</span><br><span class="line"> <span class="selector-tag">os</span><span class="selector-class">.path</span><span class="selector-class">.expanduser</span>() <span class="selector-tag">--</span>&gt; <span class="selector-tag">pathlib</span><span class="selector-class">.Path</span><span class="selector-class">.home</span>()</span><br><span class="line"></span><br><span class="line"> <span class="selector-tag">os</span><span class="selector-class">.path</span><span class="selector-class">.expanduser</span>() <span class="selector-tag">--</span>&gt; <span class="selector-tag">pathlib</span><span class="selector-class">.Path</span><span class="selector-class">.expanduser</span>()</span><br><span class="line"></span><br><span class="line"> <span class="selector-tag">os</span><span class="selector-class">.stat</span>() <span class="selector-tag">--</span>&gt; <span class="selector-tag">pathlib</span><span class="selector-class">.Path</span><span class="selector-class">.stat</span>()</span><br><span class="line"></span><br><span class="line"> <span class="selector-tag">os</span><span class="selector-class">.chmod</span>() <span class="selector-tag">--</span>&gt; <span class="selector-tag">pathlib</span><span class="selector-class">.Path</span><span class="selector-class">.chmod</span>()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>官网文档截图： <img src="https://user-gold-cdn.xitu.io/2018/11/23/1673f2f489ba95c7?w=1268&amp;h=675&amp;f=png&amp;s=81475" alt=""> 详细请查看官方文档:<a href="https://docs.python.org/3/library/pathlib.html#methods" target="_blank" rel="noopener">插眼传送</a></p>
                  <h2 id="再举几个栗子"><a href="#再举几个栗子" class="headerlink" title="再举几个栗子"></a>再举几个栗子</h2>
                  <p>刚才的案例并不能说明什么，只是让我们了解到 pathlib 的构成，接下来让我们感受一下它带给我们的便捷。</p>
                  <h3 id="获取上层-上层目录"><a href="#获取上层-上层目录" class="headerlink" title="获取上层/上层目录"></a>获取上层/上层目录</h3>
                  <p>也就是获取它爷爷的名字 <img src="https://user-gold-cdn.xitu.io/2018/11/23/1673f7ac5fcfc394?w=1197&amp;h=438&amp;f=png&amp;s=28570" alt=""> os 模块的写法为：</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import os</span><br><span class="line"></span><br><span class="line">print(<span class="name">os</span>.path.dirname(<span class="name">os</span>.path.dirname(<span class="name">os</span>.getcwd())))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><img src="https://user-gold-cdn.xitu.io/2018/11/23/1673f37dca2cee03?w=1702&amp;h=461&amp;f=png&amp;s=59217" alt=""> 如果用 pathlib 来实现：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">pathlib</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">print</span>(<span class="selector-tag">pathlib</span><span class="selector-class">.Path</span><span class="selector-class">.cwd</span>()<span class="selector-class">.parent</span><span class="selector-class">.parent</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><img src="https://user-gold-cdn.xitu.io/2018/11/23/1673f3907795c105?w=1493&amp;h=383&amp;f=png&amp;s=57514" alt=""> parent 就完事了，这是不是更贴近 Pythonic ？ 像写英语一样写代码。 如果你只需要找到它爸爸，那就使用一次：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">pathlib</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">print</span>(<span class="selector-tag">pathlib</span><span class="selector-class">.Path</span><span class="selector-class">.cwd</span>()<span class="selector-class">.parent</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>你还可以继续往祖辈上找：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">import</span> <span class="selector-tag">pathlib</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">print</span>(<span class="selector-tag">pathlib</span><span class="selector-class">.Path</span><span class="selector-class">.cwd</span>()<span class="selector-class">.parent</span><span class="selector-class">.parent</span><span class="selector-class">.parent</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><img src="https://user-gold-cdn.xitu.io/2018/11/23/1673f3ce29deae54?w=1422&amp;h=363&amp;f=png&amp;s=53634" alt=""> 相对与之前 os 模块使用的多层 os.path.dirname，使用 parent 是不是便捷很多？</p>
                  <h3 id="路径拼接"><a href="#路径拼接" class="headerlink" title="路径拼接"></a>路径拼接</h3>
                  <p>如果你要在它爷爷辈那里拼接路径，那么你需要写这么长一串代码：</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import os</span><br><span class="line"></span><br><span class="line">print(<span class="name">os</span>.path.join(<span class="name">os</span>.path.dirname(<span class="name">os</span>.path.dirname(<span class="name">os</span>.getcwd())), <span class="string">"关注"</span>, <span class="string">"微信公众号"</span>, <span class="string">"【进击的"</span>, <span class="string">"Coder】"</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><img src="https://user-gold-cdn.xitu.io/2018/11/23/1673f610d27e5947?w=1799&amp;h=398&amp;f=png&amp;s=56070" alt=""> 当你用 pathlib 的时候，你一定能够感受到快乐：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import pathlib</span><br><span class="line"></span><br><span class="line">parts = [<span class="string">"关注"</span>, <span class="string">"微信公众号"</span>, <span class="string">"【进击的"</span>, <span class="string">"Coder】"</span>]</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(pathlib.Path.cwd()</span></span><span class="selector-class">.parent</span><span class="selector-class">.parent</span>.joinpath(*parts))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>而且你还可以通过增加或减少 parent 的数量，来实现它祖辈的调节，美哉。</p>
                  <h1 id="PurePath"><a href="#PurePath" class="headerlink" title="PurePath"></a>PurePath</h1>
                  <p>上面的操作大部分都通过 pathlib 中的 Path 实现，其实它还有另一个模块 PurePath。</p>
                  <blockquote>
                    <p>PurePath 是一个纯路径对象，纯路径对象提供了实际上不访问文件系统的路径处理操作。有三种方法可以访问这些类，我们也称之为flavor。</p>
                  </blockquote>
                  <p>上面这句话来自于官方文档，听起来还是有点绕，我们还是通过栗子来了解它吧</p>
                  <h3 id="PurePath-match"><a href="#PurePath-match" class="headerlink" title="PurePath.match"></a>PurePath.match</h3>
                  <p>让我们来判断一下，当前文件路径是否有符合 ‘*.py’ 规则的文件</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import pathlib</span><br><span class="line"></span><br><span class="line">print(<span class="name">pathlib</span>.PurePath(<span class="name">__file__</span>).match('*.py'))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><img src="https://user-gold-cdn.xitu.io/2018/11/23/1673f9dfde47ae14?w=1476&amp;h=326&amp;f=png&amp;s=34765" alt=""> 很显然，我们编写代码的 coder.py 就符合规则，所以输出是 True。 为什么我要拿这个来举例呢？再深入想一下 pathlib.PurePath 后面能够跟着 match，那说明它应该是个对象，而不是一个路径字符串。为了验证这个想法，把代码改一改：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import pathlib</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">os_path = os<span class="selector-class">.path</span>.dirname(__file__)</span><br><span class="line">pure_path = pathlib.PurePath(__file__)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(os_path, type(os_path)</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(pure_path, type(pure_path)</span></span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(pathlib.PurePath(__file__)</span></span>.match(<span class="string">'*.py'</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><img src="https://user-gold-cdn.xitu.io/2018/11/23/1673fa51dc777a36?w=1526&amp;h=540&amp;f=png&amp;s=74413" alt=""> 打印通过 os.path 获取当前路径的结果，得出一个路径字符串；而通过 pathlib.Pure 则获得的是一个 <strong>PurePosixPath</strong> 对象，并且得到的路径包括了当前文件 coder.py。 这就有点悬疑了， PurePosixPath 究竟是什么？ pathlib 可以操作两种文件系统的路径，一种是 Windows 文件系统，另一种称为非 Windows 文件系统，对应的对象是 <a href="PureWindowsPath">pathlib.PurePosixPath</a> 和 <a href="PureWindowsPath">PureWindowsPath</a>，不过不用担心，这些类并非是指定在某些操作系统上运行才能够使用，无论你运行的是哪个系统，都可以实例化所有这些类，因为它们不提供任何进行系统调用的操作。 不提供任何进行系统调用的操作，这又是什么？真是越听越深了 文档在最开始给出了这么一段描述:</p>
                  <blockquote>
                    <p>Pure paths are useful in some special cases; for example: If you want to manipulate Windows paths on a Unix machine (or vice versa). You cannot instantiate a WindowsPath when running on Unix, but you can instantiate PureWindowsPath. You want to make sure that your code only manipulates paths without actually accessing the OS. In this case, instantiating one of the pure classes may be useful since those simply don’t have any OS-accessing operations. 翻译：纯路径在某些特殊情况下很有用; 例如： 如果要在Unix计算机上操作Windows路径（反之亦然）。WindowsPath在Unix上运行时无法实例化，但可以实例化PureWindowsPath。 您希望确保您的代码仅操作路径而不实际访问操作系统。在这种情况下，实例化其中一个纯类可能很有用，因为那些只是没有任何操作系统访问操作。</p>
                  </blockquote>
                  <p>还附上了一张图： <img src="https://user-gold-cdn.xitu.io/2018/11/23/1673fae4d58d74a5?w=538&amp;h=495&amp;f=png&amp;s=18221" alt=""> 一下子也不是很理解，这是什么意思。不要紧，继续往下看。</p>
                  <h1 id="对应关系"><a href="#对应关系" class="headerlink" title="对应关系"></a>对应关系</h1>
                  <p>通过以上的例子我们可以感受到，它不仅封装了 os.path 相关常用方法，还集成了 os 的其他模块，比如创建文件夹 Path.mkdir。 如果你担心记不住，没关系的，文档一直都在。并且文档给我们列出了对应关系表 <img src="https://user-gold-cdn.xitu.io/2018/11/23/1673f6944714cd2f?w=800&amp;h=637&amp;f=png&amp;s=56688" alt=""></p>
                  <h3 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h3>
                  <p>Path.iterdir()　　# 遍历目录的子目录或者文件 Path.is_dir()　　# 判断是否是目录 Path.glob()　　# 过滤目录(返回生成器) Path.resolve()　　# 返回绝对路径 Path.exists()　　# 判断路径是否存在 Path.open()　　# 打开文件(支持with) Path.unlink()　　# 删除文件或目录(目录非空触发异常)</p>
                  <h3 id="基本属性"><a href="#基本属性" class="headerlink" title="基本属性"></a>基本属性</h3>
                  <p>Path.parts　　# 分割路径 类似os.path.split(), 不过返回元组 Path.drive　　# 返回驱动器名称 Path.root　　# 返回路径的根目录 Path.anchor　　# 自动判断返回drive或root Path.parents　　# 返回所有上级目录的列表</p>
                  <h3 id="改变路径"><a href="#改变路径" class="headerlink" title="改变路径"></a>改变路径</h3>
                  <p>Path.with_name()　　# 更改路径名称, 更改最后一级路径名 Path.with_suffix()　　# 更改路径后缀</p>
                  <h3 id="拼接路径"><a href="#拼接路径" class="headerlink" title="拼接路径"></a>拼接路径</h3>
                  <p>Path.joinpath()　　# 拼接路径 Path.relative_to()　　# 计算相对路径</p>
                  <h3 id="测试路径"><a href="#测试路径" class="headerlink" title="测试路径"></a>测试路径</h3>
                  <p>Path.match()　　# 测试路径是否符合pattern Path.is_dir()　　# 是否是文件 Path.is_absolute()　　# 是否是绝对路径 Path.is_reserved()　　# 是否是预留路径 Path.exists()　　# 判断路径是否真实存在</p>
                  <h3 id="其他方法"><a href="#其他方法" class="headerlink" title="其他方法"></a>其他方法</h3>
                  <p>Path.cwd()　　# 返回当前目录的路径对象 Path.home()　　# 返回当前用户的home路径对象 Path.stat()　　# 返回路径信息, 同os.stat() Path.chmod()　　# 更改路径权限, 类似os.chmod() Path.expanduser()　　# 展开~返回完整路径对象 Path.mkdir()　　# 创建目录 Path.rename()　　# 重命名路径 Path.rglob()　　# 递归遍历所有子目录的文件</p>
                  <h1 id="pathlib-回顾"><a href="#pathlib-回顾" class="headerlink" title="pathlib 回顾"></a>pathlib 回顾</h1>
                  <p>通过上面的几个例子，我们对 pathlib 应该有一个大体的了解，接下来再回顾一下官方给 pathlib 库的定义：</p>
                  <blockquote>
                    <p>This module offers classes representing filesystem paths with semantics appropriate for different operating systems. Path classes are divided between pure paths, which provide purely computational operations without I/O, and concrete paths, which inherit from pure paths but also provide I/O operations. 释义：pathlib 提供表示文件系统路径的类，其语义适用于不同的操作系统。路径类在纯路径之间划分，纯路径提供纯粹的计算操作而没有I / O，以及具体路径，它继承纯路径但也提供I / O操作。</p>
                  </blockquote>
                  <p>回顾刚才这张图，重新理解 pathlib <img src="https://user-gold-cdn.xitu.io/2018/11/23/1673f6c43bcae0eb?w=538&amp;h=495&amp;f=png&amp;s=18074" alt=""> 如果你以前从未使用过这个模块，或者只是不确定哪个类适合您的任务，那么Path很可能就是您所需要的。它为代码运行的平台实例化一个具体路径。 <strong>总结：pathlib 不单纯是对 os 中一些模块或方法进行封装，而是为了兼容不同的操作系统，它为每类操作系统定义了接口。你希望在UNIX机器上操作Windows的路径，然而直接操作是做不到的，所以为你创建了一套接口 PurePath，你可以通过接口来实现你的目的（反之亦然）</strong></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/韦世东学算法和反爬虫" class="author" itemprop="url" rel="index">韦世东学算法和反爬虫</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-07-27 10:30:18" itemprop="dateCreated datePublished" datetime="2019-07-27T10:30:18+08:00">2019-07-27</time>
                </span>
                <span id="/6982.html" class="post-meta-item leancloud_visitors" data-flag-title="你还在用 os.path？快来感受一下 pathlib 给你带来的便捷吧！" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>4.7k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>4 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6970.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 技术杂谈 <i class="label-arrow"></i>
                  </a>
                  <a href="/6970.html" class="post-title-link" itemprop="url">5G时代谁领风骚：先看看2G、3G、4G时代都崛起了哪些公司？</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>6月6日工信部正式向中国电信、中国移动、中国联通、中国广电发放5G商用牌照。自此，中国正式进入5G商用元年。 就中国而讲，2G时代门户网站林立、社交软件初起，3G时代智能手机大战、社交类软件成为王者，4G时代直播与短视频风光无二、信息流成热话题，那5G时代谁能独领风骚？ 在5G还未全面普及之前，我们回顾一下并不遥远的昨天，在2G、3G、4G的兴起时，哪些公司应运而生，成为巨头，哪些巨头又轰然倒塌，成为历史的一部分。 <strong>2G时代，QQ崛起，阿里京东起家，门户网站林立</strong> 中国互联网的发展至今也只20年有余，自20世纪90年代末，中国人从1G时代代表性手机大哥大（摩托罗拉）手机换成了2G时代代表性手机诺基亚，彼时手机不只是接打电话，增加了发短信甚至邮件的功能。 20世纪90年代末期中国，还处在纸媒、广播和电视一统天下的传统媒体时代，但经济的迅猛发展已经造成信息饥渴，彼时媒体所提供的信息无论从丰富程度还是传播速度上都很难满足用户需求。 一个从美国麻省理工学院（MIT）攻读博士学位归来的“天之骄子”带回了一个新鲜事物，由于被美国互联网的发展深深震撼，张朝阳回国创建了中国第一家门户网站——搜狐。那是在1998年，阿里巴巴还没诞生，马化腾的QQ也未问世，李彦宏还在美国硅谷，中国互联网的舞台上，也只有张朝阳和他的搜狐。 竞争对手还未成长，搜狐独享巨大的互联网红利，2000年就上市，占据着中国门户网站头部企业的位置。 同样1998年，在搜狐成立后不到10个月，王志东的新浪网于年底成立，当时的口号是在互联网上建立全球最大的华人网站。以体育新闻传播为起点的新浪迅速扩张，进阶成为综合性新闻门户。 当时中国门户网站受资本青睐的程度，以及上市的速度堪称一个时代的奇迹，新浪网虽成立晚了搜狐10个月，但却比搜狐早了3个月在纳斯达克敲钟。 与搜狐新浪以门户网站起家不同，网易1997年成立之初以搜索引擎和免费邮箱系统立身，赶上门户网站热潮席卷中国，1998年丁磊带领网易挥师北上，落户北京，公司战略也从“系统集成商”正式转向“互联网服务提供商”。自此，网易与搜狐、新浪成为中国三大门户网站。 在张朝阳、丁磊等都借互联网东风大搞门户网站捞第一波红利的时候，在深圳创业的马化腾开始琢磨做社交。马化腾与大学同学合伙成立腾讯，当时主要做“无线网络寻呼系统”，就是将互联网和寻呼机结合，使得寻呼机可以收到互联网的传唤，并且可以收看新闻乃至电子邮件等功能。 但不可逆的是当时寻呼机业务已处于颓势，1998年，身处2G时代，手机在市场上肆意生长。马化腾当机立断，转头做IM（即时通讯软件），OICQ应运而生，OICQ1999年2月10日发布了第一个版本——OICQ 99 beta build 0210，就此，颠覆未来20年中文互联网的明星产品QQ诞生了。 此后腾讯围绕QQ延展出多款产品，包括QQ宠物、QQ空间、QQ游戏等，这为腾讯带来盈利的同时留存了海量互联网用户。QQ在中国整个2G时代都占据着社交软件第一把交椅，为腾讯后续布局游戏等可以提供天然入口，这让腾讯的产品可以轻而易举地碾压竞品。 而之后改变中国互联网格局的阿里巴巴也是在2G时代诞生的。1999年，马云带领下的18为创始人创建阿里巴巴集团。2003年，淘宝网创立，作为新生事物的淘宝网出奇制胜——没和ebay易趣争抢既有的存量市场，而是收割疯狂生长的增量市场；仅仅通过1年时间，这家“倒过来看世界”的互联网公司，就成了中国网络购物市场的领军企业。 而2004年，支付宝创立，中国第三方支付模式雏形初现。值得一提的是，同年诞生的淘宝旺旺将即时聊天工具和网络购物相联系起来，是阿里巴巴做网上零售的法宝。这时候的淘宝旺旺并没有和QQ对标，还处在阿里腾讯之间还是各自领域狂奔的时代。 在2005年淘宝的成交额就突破80亿元，甚至超越了沃尔玛。 在马云创立淘宝网，大搞电商之时，在中关村卖了几年光盘的刘强东坐不住了，2004年，京东多媒体网正式开通。或许与刘强东卖3C产品起家有关，京东电子商务平台是主打3C产品，与淘宝对标的同时又有自己清晰的定位，虽然都是做电商，但同质化并不严重。 <strong>3G时代，智能手机展露头角，巨头大战社交</strong> 整个2G时代其实属于PC端互联网，2G的手机只能打电话发短信，上网很困难。但3G通信标准将信息传输率提高了一个数量级，这是一个飞跃，3G时代真正意义上而言是移动互联网的开端，从此手机打电话的功能降到了次要的位置，而数据通信，也就是上网，成为了主要功能。 乔布斯2007年拿着一款智能手机iPhone1出现，宣布苹果主宰移动互联网时代的开始。从此手机不再以功能为主，而是以应用软件（APP）为主，APP store 更是一个划时代产品，让用户可以轻而易举地购买下载所需的应用。 中国的3G时代稍晚于美国，2009年1月，工信部为中国移动、联通、电信发布3G牌照，中国从此进入3G时代。 在智能手机初探中国市场的时间节点，三星、诺基亚、HTC等占据了巨大部分江山，而中国2G时代的功能机科健、波导、海尔等相继淡出市场，国产的智能机中兴、华为、酷派、联想等完全靠三大运营商的销售渠道生存，打着性价比旗号的合约机始终比不上价格更高的三星、HTC的中低端手机。 但2011年小米的横空出世打破了这个壁垒。3G网络在中国越来越普及，彼时在国外品牌占据中国市场，而国产智能手机厂商仅能依附三大运营商销售，而当苹果手机最具冲击力的一代iPhone4席卷全球时，一个叫雷军的人拿出了他的第一代产品——小米1，冲进中国智能手机市场。 三星与HTC主流机型定价4000元，而小米1999的超高性价比＋饥饿营销，搅动了中国智能手机市场，成为3G时代崛起的手机巨头，2012年2月，“屌丝”一词横空出世，有人说它是为屌丝而生，谁能想到日后它更是成为世界最年轻的500强？ 如果说QQ的问世是一个偶然，那微信出道是无数竞争的结果。 移动互联网兴起，当然PC端依然沉淀着大量用户，彼时的QQ为了顾及PC端的用户，界面、功能更照顾PC端，以至于没能及时赶上移动互联网的浪潮，但一个叫张小龙的人彻底颠覆了社交。 2011年1月，微信横空出世，这款主打IM的应用程序契合3G时代的特点，可以发送文字、语音、图片、视频等，一出现就借助QQ的天然优势，并打通通信录，迅速推广，以至于后续发展成为国民软件，腾讯也借此拿到了通向移动互联网第一张门票，腾讯能成为今天的巨头公司，而且地位难以撼动，微信功不可没。 其实在腾讯布局社交之时，2G时代崛起的门户大咖搜狐、新浪也瞄准了社交这个大蛋糕。只不过新浪瞄准的是信息即时分享，而搜狐一直在拾人牙慧。新浪微博自2009年一经问世便牢牢掌控着微博头把交椅的位置，就连腾讯微博的冲击也未动摇半分。 搜狐看QQ火爆便做了搜Q，见微博火爆便做了搜狐微博，还做了社区社交“白社会”，但无一例外遭遇失败。连张朝阳本人都说，“微信微博左右扇了我两个耳光。”最近张朝阳又推出“狐友”，硬要推着石头上山的张朝阳不知还有没有气力。 而前面提到2G时代阿里推出淘宝旺旺却忙着做电商，没有正面硬刚QQ，但此时看到微信在庞大的社交领域带来的巨大流量时，马云坐不住了。2013年，阿里巴巴推出了来往，这是阿里推出的即时通讯软件，也是阿里第一款独立于电商业务之外的社交产品，其核心功能是实现熟人之间的社交。 原因是马云认为腾讯已经“侵入”了阿里的地盘，要用来往去砸微信的场子，但结果大家都知晓了。但马云并不灰心，之后用支付宝做社交还是失败，只是钉钉的成功才稍找回点面子。 另外值得一提的是，3G时代，LBS应用于地图等会对4G时代滴滴、共享单车等的崛起起到推手的作用。 <strong>4G时代，团购直播视频手游异军突起，共享出行风口正盛，巨头布局信息流</strong> 如果说1G到2G是划时代的进步，而3G的短暂存在只是一个过渡，因为短短几年后，网速产生质的飞跃的4G时代迅速到来。 3G传播速度相对2G较快，可以较好满足手机上网等需求，只是播放高清视频还是比较困难。而4G的速度几乎满足无线用户所有需求。 彼时移动互联网光速发展，大面积吞噬PC互联网流量和用户。比PC端更加便捷的移动端生活服务类应用风靡中国，O2O模式成了风口上的猪。巨头们纷纷布局，阿里有口碑网，腾讯有微团购，百度则买来糯米网，但谁也不曾想最后的赢家不是巨头而是王兴的美团网，2015年，美团网与大众点评合并，重构了O2O模式。 美团成为4G时代崛起的巨头，而腾讯依靠着微信的社交流量巨大入口也不会败，阿里则有支付宝这个生活服务类的大平台，甚至日后提出新零售概念取代O2O成为新的风口，这场大战里，仿佛只有百度掉队了，从PC互联网时代跨到移动互联网时代，百度要做的产品是在抢夺自己PC端的用户，这让百度似乎有点手足无措。 网速加快受益最大的无疑是直播与视频。2016年前后，资本涌入直播赛道，以斗鱼、虎牙、YY、熊猫、全民等为首的游戏直播平台，纷纷宣布获得融资，疯狂烧钱抢夺主播和用户，以映客、花椒等移动端为主的直播也趁势而起。 彼时直播行业一片混乱，违法违规直播大行其道，随着监管力度加大，资本退场，直播赛道也一地鸡毛，也只是留下虎牙、斗鱼等直播巨头。 4G时代网速加快的同时，运营商提速降费，这让依靠文字和图片获取信息的用户越来越不满足，短视频有着天时地利人和，在用户需求之下诞生。其中以抖音、快手为代表的的社交媒体类短视频最为火爆，而以秒拍、西瓜为代表的的新闻资讯类也广受媒体和用户欢迎，以B站为首的BBS类更是抓住了细分市场。 今年年初Vlog的流行也只是吹了一阵，现已没有当时的热度，看起来短视频的风还会继续吹下去。 2G时代的三大门户巨头搜狐新浪和网易，如今搜狐和新浪的体量与网易已不是一个级别的，新浪尚有微博撑着场面，搜狐却实实在在地掉队了，网易又是如何始终保持盈利的呢？其中一个很重要的支撑点就是网易的游戏帝国，而4G时代更让网易如虎添翼。 曾经风靡全国的PC端回合制游戏“梦幻西游”，手机版一经上线便俘获众多老玩家，这个游戏特点之一就是烧钱。一位玩梦幻的朋友告诉盒饭财经，这个游戏里，充值几万也只是低端玩家而已，动辄砸百万的大有人在，而广受女性玩家喜爱的手游阴阳师也是一个人民币玩家的游戏。 从网易公布的财报不难看出，近几年网易游戏收入占每季度总收入都超过6成，与还靠着新闻资讯的新浪搜狐不同，网易应4G时代实现业务重心迁徙，还能算是互联网一线巨头。 守着微信这个巨大流量入口的腾讯布局游戏更显得理所当然，从PC端的QQ衍生出的众多小游戏为起点，到英雄联盟的大火，3G时代的天天酷跑，再到4G移动互联网时代手游吃鸡（和平精英）、王者荣耀，腾讯在每个时代都在游戏产业上走得很稳。 目前，腾讯游戏占中国游戏市场规模的5成以上，不过与网易不同的是，腾讯一直追求的是薄利多销策略。游戏内道具价格相比网易较为低廉，能取得超过千亿的年收入，全靠用户基数众多。 在PC端流量急剧下降，移动端用户暴涨之时，广告投放方也开始思考有的放矢，PC端时代是买广告位，而4G大数据时代就是买用户，这也称为信息流广告。 信息流广告最大的优势是不浪费资源，运用大数据针对性投放，既然有利可图，便成为各大巨头争先布局的板块，而这其中最为突出的就是今日头条和百度。 说起今日头条，这个曾经“小而美”的公司今年内发展成为TMD（头条、美团、滴滴）的首字母巨头，核心是张一鸣，但也得益于4G时代的浪潮。 今日头条的大获成功最引以为傲的是算法，虽然是新闻资讯类产品，但张一鸣的主创团队全是技术，不需要文字编辑。他们只做一件事，用纯技术算法手段从海量的内容中去搜索挖掘有价值的内容，最关键的是这些内容可以根据客户的需要进行“定制化”推送。这在信息爆炸时代，人们可以摆脱浩瀚无垠的信息海洋，只读取精准定制的有价值信息。 而依靠着强大的算法，什么火他做什么。微博火，做微头条，知乎火，做悟空问答，短视频直播时代到来，做火山小视频、西瓜视频、抖音，头条系产品依靠其强大的算法打造着一个又一个爆款。 2G时代，两大电商平台阿里和京东相争，虽然不是一个体量级，但是淘宝假货风行，一度让阿里痛下决心清理商家，而这些商家顺势被一个叫黄峥的人收走了，2015年，主打社交电商的拼多多应运而生。对了，这个黄峥还跟着别人和巴菲特吃过午餐。 而拼多多背后除了创始人黄峥，腾讯是第二大股东，而微信的天然社交入口让拼多多尝够了甜头，短短三年便上市，如今月活量已超过京东直逼淘宝。很显然，腾讯非常乐见有一家公司能威胁到阿里的主业务。 前文提到，LBS的应用为4G时代的滴滴发展起到推手的作用，2012年滴滴成立以来直至2014年都是缓慢上升期。但是自2014年以后，4G手机进一步普及，滴滴迅猛发展，短短一年便成为出行当之无愧的No.1，而滴滴2014年接入微信，这为滴滴提供了天然的流量入口。 但滴滴的竞品快的接入支付宝，此时阿里与腾讯在各个重合的领域相争已是司空见惯。但当时占领市场只有一个秘诀——烧钱，各种补贴各种红包雨，滴滴快的的烧钱战略持续了相当长一段时间，直到2015年滴滴快的的合并，让出行市场成为一家独大。 如果说滴滴是划时代的出行产品，那共享单车的出现引领了一个共享经济时代。 2004年，一个年轻人连同4个校友，提出“以共享经济+智能硬件，解决最后一公里出行问题”的经营理念，创立ofo共享单车项目，起先他们通过定制，将自行车通过车身号、机械锁绑定APP的方式，提供密码解锁用车的方式，在北京大学推出这一项目。这个项目的创始人叫戴威，北京大学光华管理学院的毕业生。 2015年1月27日，做媒体出身的胡玮炜和运营大牛王晓峰，在北京成立了一家名为“北京摩拜科技有限公司“的公司，他们的愿景是“让自行车回归生活”。 自此，共享单车风口吹起，共享单车“颜色大战”一触即发。而中国互联网创投倒贴钱抢市场，等日后一家独大再赚钱的逻辑，再一次在共享单车上体现的淋漓尽致。当时也就ofo和摩拜两家独大，但风口过得似乎有些快，风口过后，一地鸡毛。摩拜卖身美团，ofo深陷押金风波半死不活，老三哈罗单车如今倒是坐收渔翁之利。 <strong>5G时代，谁又能领风骚？</strong> 2G、3G、4G时代，随着互联网的发展，一些巨头应时代而生，而一些公司没能及时跟上时代的发展而掉队，还有像腾讯阿里等长盛不衰而又相互掣肘。2G、3G已然开始退网，4G时代方兴未艾，而5G时代紧赶着来了。 5G会直接加速万物互联的进程，改变我们与世界的交互界面。除了VR游戏、无人驾驶、智能物联等应用外，移动办公、会议直播、视频监控、智能城市等都会在5G的大网络下运行。智能手机厂商忙着推出5G手机，而互联网科技巨头在推出5G应用，虽然用户还未感觉到5G的速度，但这个赛道已经热得发烫。 阿里腾讯继续两强争霸？还是迷途的百度能否东山再起？是否还有头条、美团一样突然崛起的巨头？5G时代，一切皆有可能。 来源：<a href="https://www.chinaventure.com.cn/news/83-20190726-346438.html" target="_blank" rel="noopener">https://www.chinaventure.com.cn/news/83-20190726-346438.html</a></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-07-26 11:37:43" itemprop="dateCreated datePublished" datetime="2019-07-26T11:37:43+08:00">2019-07-26</time>
                </span>
                <span id="/6970.html" class="post-meta-item leancloud_visitors" data-flag-title="5G时代谁领风骚：先看看2G、3G、4G时代都崛起了哪些公司？" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>6.1k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>6 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6942.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 技术杂谈 <i class="label-arrow"></i>
                  </a>
                  <a href="/6942.html" class="post-title-link" itemprop="url">Python 爬虫利器之 Pyppeteer 的用法</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>如果大家对 Python 爬虫有所了解的话，想必你应该听说过 Selenium 这个库，这实际上是一个自动化测试工具，现在已经被广泛用于网络爬虫中来应对 JavaScript 渲染的页面的抓取。 但 Selenium 用的时候有个麻烦事，就是环境的相关配置，得安装好相关浏览器，比如 Chrome、Firefox 等等，然后还要到官方网站去下载对应的驱动，最重要的还需要安装对应的 Python Selenium 库，确实是不是很方便，另外如果要做大规模部署的话，环境配置的一些问题也是个头疼的事情。 那么本节就介绍另一个类似的替代品，叫做 Pyppeteer。注意，是叫做 Pyppeteer，不是 Puppeteer。Puppeteer 是 Google 基于 Node.js 开发的一个工具，有了它我们可以通过 JavaScript 来控制 Chrome 浏览器的一些操作，当然也可以用作网络爬虫上，其 API 极其完善，功能非常强大。 而 Pyppeteer 又是什么呢？它实际上是 Puppeteer 的 Python 版本的实现，但他不是 Google 开发的，是一位来自于日本的工程师依据 Puppeteer 的一些功能开发出来的非官方版本。 在 Pyppetter 中，实际上它背后也是有一个类似 Chrome 浏览器的 Chromium 浏览器在执行一些动作进行网页渲染，首先说下 Chrome 浏览器和 Chromium 浏览器的渊源。</p>
                  <blockquote>
                    <p>Chromium 是谷歌为了研发 Chrome 而启动的项目，是完全开源的。二者基于相同的源代码构建，Chrome 所有的新功能都会先在 Chromium 上实现，待验证稳定后才会移植，因此 Chromium 的版本更新频率更高，也会包含很多新的功能，但作为一款独立的浏览器，Chromium 的用户群体要小众得多。两款浏览器“同根同源”，它们有着同样的 Logo，但配色不同，Chrome 由蓝红绿黄四种颜色组成，而 Chromium 由不同深度的蓝色构成。</p>
                  </blockquote>
                  <p><img src="https://cdn.cuiqingcai.com/2019-07-26-image-20190325031516968.png" alt=""> 总的来说，两款浏览器的内核是一样的，实现方式也是一样的，可以认为是开发版和正式版的区别，功能上基本是没有太大区别的。 Pyppeteer 就是依赖于 Chromium 这个浏览器来运行的。那么有了 Pyppeteer 之后，我们就可以免去那些繁琐的环境配置等问题。如果第一次运行的时候，Chromium 浏览器没有安全，那么程序会帮我们自动安装和配置，就免去了繁琐的环境配置等工作。另外 Pyppeteer 是基于 Python 的新特性 async 实现的，所以它的一些执行也支持异步操作，效率相对于 Selenium 来说也提高了。 那么下面就让我们来一起了解下 Pyppeteer 的相关用法吧。</p>
                  <h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2>
                  <p>首先就是安装问题了，由于 Pyppeteer 采用了 Python 的 async 机制，所以其运行要求的 Python 版本为 3.5 及以上。 安装方式非常简单：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> pyppeteer</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好了，安装完成之后我们命令行下测试下：</p>
                  <figure class="highlight elm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">\&gt;&gt;&gt; <span class="keyword">import</span> pyppeteer</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果没有报错，那么就证明安装成功了。</p>
                  <h2 id="快速上手"><a href="#快速上手" class="headerlink" title="快速上手"></a>快速上手</h2>
                  <p>接下来我们测试下基本的页面渲染操作，这里我们选用的网址为：<a href="http://quotes.toscrape.com/js/，这个页面是" target="_blank" rel="noopener">http://quotes.toscrape.com/js/，这个页面是</a> JavaScript 渲染而成的，用基本的 requests 库请求得到的 HTML 结果里面是不包含页面中所见的条目内容的。 为了证明 requests 无法完成正常的抓取，我们可以先用如下代码来测试一下：</p>
                  <figure class="highlight perl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line">from pyquery import PyQuery as pq</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://quotes.toscrape.com/js/'</span></span><br><span class="line">response = requests.get(url)</span><br><span class="line">doc = p<span class="string">q(response.text)</span></span><br><span class="line"><span class="keyword">print</span>(<span class="string">'Quotes:'</span>, doc(<span class="string">'.quote'</span>).length)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里首先使用 requests 来请求网页内容，然后使用 pyquery 来解析页面中的每一个条目。观察源码之后我们发现每个条目的 class 名为 quote，所以这里选用了 .quote 这个 CSS 选择器来选择，最后输出条目数量。 运行结果：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">Quotes:</span> <span class="number">0</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果是 0，这就证明使用 requests 是无法正常抓取到相关数据的。因为什么？因为这个页面是 JavaScript 渲染而成的，我们所看到的内容都是网页加载后又执行了 JavaScript 之后才呈现出来的，因此这些条目数据并不存在于原始 HTML 代码中，而 requests 仅仅抓取的是原始 HTML 代码。 好的，所以遇到这种类型的网站我们应该怎么办呢？ 其实答案有很多：</p>
                  <ul>
                    <li>分析网页源代码数据，如果数据是隐藏在 HTML 中的其他地方，以 JavaScript 变量的形式存在，直接提取就好了。</li>
                    <li>分析 Ajax，很多数据可能是经过 Ajax 请求时候获取的，所以可以分析其接口。</li>
                    <li>模拟 JavaScript 渲染过程，直接抓取渲染后的结果。</li>
                  </ul>
                  <p>而 Pyppeteer 和 Selenium 就是用的第三种方法，下面我们再用 Pyppeteer 来试试，如果用 Pyppeteer 实现如上页面的抓取的话，代码就可以写为如下形式：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">from</span> pyppeteer <span class="keyword">import</span> launch</span><br><span class="line"><span class="keyword">from</span> pyquery <span class="keyword">import</span> PyQuery <span class="keyword">as</span> pq</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    browser = <span class="keyword">await</span> launch()</span><br><span class="line">    page = <span class="keyword">await</span> browser.newPage()</span><br><span class="line">    <span class="keyword">await</span> page.goto(<span class="string">'http://quotes.toscrape.com/js/'</span>)</span><br><span class="line">    doc = pq(<span class="keyword">await</span> page.content())</span><br><span class="line">    print(<span class="string">'Quotes:'</span>, doc(<span class="string">'.quote'</span>).length)</span><br><span class="line">    <span class="keyword">await</span> browser.close()</span><br><span class="line"></span><br><span class="line">asyncio.get_event_loop().run_until_complete(main())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">Quotes:</span> <span class="number">10</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>看运行结果，这说明我们就成功匹配出来了 class 为 quote 的条目，总数为 10 条，具体的内容可以进一步使用 pyquery 解析查看。 那么这里面的过程发生了什么？ 实际上，Pyppeteer 整个流程就完成了浏览器的开启、新建页面、页面加载等操作。另外 Pyppeteer 里面进行了异步操作，所以需要配合 async/await 关键词来实现。 首先， launch 方法会新建一个 Browser 对象，然后赋值给 browser，然后调用 newPage 方法相当于浏览器中新建了一个选项卡，同时新建了一个 Page 对象。然后 Page 对象调用了 goto 方法就相当于在浏览器中输入了这个 URL，浏览器跳转到了对应的页面进行加载，加载完成之后再调用 content 方法，返回当前浏览器页面的源代码。然后进一步地，我们用 pyquery 进行同样地解析，就可以得到 JavaScript 渲染的结果了。 另外其他的一些方法如调用 asyncio 的 get_event_loop 等方法的相关操作则属于 Python 异步 async 相关的内容了，大家如果不熟悉可以了解下 Python 的 async/await 的相关知识。 好，通过上面的代码，我们就可以完成 JavaScript 渲染页面的爬取了。 在这个过程中，我们没有配置 Chrome 浏览器，没有配置浏览器驱动，免去了一些繁琐的步骤，同样达到了 Selenium 的效果，还实现了异步抓取，爽歪歪！ 接下来我们再看看另外一个例子，这个例子可以模拟网页截图，保存 PDF，另外还可以执行自定义的 JavaScript 获得特定的内容，代码如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">from</span> pyppeteer <span class="keyword">import</span> launch</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    browser = <span class="keyword">await</span> launch()</span><br><span class="line">    page = <span class="keyword">await</span> browser.newPage()</span><br><span class="line">    <span class="keyword">await</span> page.goto(<span class="string">'http://quotes.toscrape.com/js/'</span>)</span><br><span class="line">    <span class="keyword">await</span> page.screenshot(path=<span class="string">'example.png'</span>)</span><br><span class="line">    <span class="keyword">await</span> page.pdf(path=<span class="string">'example.pdf'</span>)</span><br><span class="line">    dimensions = <span class="keyword">await</span> page.evaluate(<span class="string">'''() =&gt; &#123;</span></span><br><span class="line"><span class="string">        return &#123;</span></span><br><span class="line"><span class="string">            width: document.documentElement.clientWidth,</span></span><br><span class="line"><span class="string">            height: document.documentElement.clientHeight,</span></span><br><span class="line"><span class="string">            deviceScaleFactor: window.devicePixelRatio,</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;'''</span>)</span><br><span class="line"></span><br><span class="line">    print(dimensions)</span><br><span class="line">    <span class="comment"># &gt;&gt;&gt; &#123;'width': 800, 'height': 600, 'deviceScaleFactor': 1&#125;</span></span><br><span class="line">    <span class="keyword">await</span> browser.close()</span><br><span class="line"></span><br><span class="line">asyncio.get_event_loop().run_until_complete(main())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们又用到了几个新的 API，完成了网页截图保存、网页导出 PDF 保存、执行 JavaScript 并返回对应数据。 首先 screenshot 方法可以传入保存的图片路径，另外还可以指定保存格式 type、清晰度 quality、是否全屏 fullPage、裁切 clip 等各个参数实现截图。 截图的样例如下： <img src="https://cdn.cuiqingcai.com/2019-07-26-image-20190325095645072.png" alt=""> 可以看到它返回的就是 JavaScript 渲染后的页面。 pdf 方法也是类似的，只不过页面保存格式不一样，最后得到一个多页的 pdf 文件，样例如下： <img src="https://cdn.cuiqingcai.com/2019-07-26-image-20190325095759738.png" alt=""> 可见其内容也是 JavaScript 渲染后的内容，另外这个方法还可以指定放缩大小 scale、页码范围 pageRanges、宽高 width 和 height、方向 landscape 等等参数，导出定制化的 pdf 用这个方法就十分方便。 最后我们又调用了 evaluate 方法执行了一些 JavaScript，JavaScript 传入的是一个函数，使用 return 方法返回了网页的宽高、像素大小比率三个值，最后得到的是一个 JSON 格式的对象，内容如下：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="string">&#123;'width':</span> <span class="number">800</span><span class="string">,</span> <span class="attr">'height':</span> <span class="number">600</span><span class="string">,</span> <span class="attr">'deviceScaleFactor':</span> <span class="number">1</span><span class="string">&#125;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>OK，实例就先感受到这里，还有太多太多的功能还没提及。 总之利用 Pyppeteer 我们可以控制浏览器执行几乎所有动作，想要的操作和功能基本都可以实现，用它来自由地控制爬虫当然就不在话下了。</p>
                  <h2 id="详细用法"><a href="#详细用法" class="headerlink" title="详细用法"></a>详细用法</h2>
                  <p>了解了基本的实例之后，我们再来梳理一下 Pyppeteer 的一些基本和常用操作。Pyppeteer 的几乎所有功能都能在其官方文档的 API Reference 里面找到，链接为：<a href="https://miyakogi.github.io/pyppeteer/reference.html，用到哪个方法就来这里查询就好了，参数不必死记硬背，即用即查就好" target="_blank" rel="noopener">https://miyakogi.github.io/pyppeteer/reference.html，用到哪个方法就来这里查询就好了，参数不必死记硬背，即用即查就好</a>。</p>
                  <h3 id="开启浏览器"><a href="#开启浏览器" class="headerlink" title="开启浏览器"></a>开启浏览器</h3>
                  <p>使用 Pyppeteer 的第一步便是启动浏览器，首先我们看下怎样启动一个浏览器，其实就相当于我们点击桌面上的浏览器图标一样，把它开起来。用 Pyppeteer 完成同样的操作，只需要调用 launch 方法即可。 我们先看下 launch 方法的 API，链接为：<a href="https://miyakogi.github.io/pyppeteer/reference.html#pyppeteer.launcher.launch" target="_blank" rel="noopener">https://miyakogi.github.io/pyppeteer/reference.html#pyppeteer.launcher.launch</a>，其方法定义如下：</p>
                  <figure class="highlight less">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">pyppeteer</span><span class="selector-class">.launcher</span><span class="selector-class">.launch</span>(<span class="attribute">options</span>: dict = None, **kwargs) → <span class="selector-tag">pyppeteer</span><span class="selector-class">.browser</span><span class="selector-class">.Browser</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到它处于 launcher 模块中，参数没有在声明中特别指定，返回类型是 browser 模块中的 Browser 对象，另外观察源码发现这是一个 async 修饰的方法，所以调用它的时候需要使用 await。 接下来看看它的参数：</p>
                  <ul>
                    <li>ignoreHTTPSErrors (bool): 是否要忽略 HTTPS 的错误，默认是 False。</li>
                    <li>headless (bool): 是否启用 Headless 模式，即无界面模式，如果 devtools 这个参数是 True 的话，那么该参数就会被设置为 False，否则为 True，即默认是开启无界面模式的。</li>
                    <li>executablePath (str): 可执行文件的路径，如果指定之后就不需要使用默认的 Chromium 了，可以指定为已有的 Chrome 或 Chromium。</li>
                    <li>slowMo (int|float): 通过传入指定的时间，可以减缓 Pyppeteer 的一些模拟操作。</li>
                    <li>args (List[str]): 在执行过程中可以传入的额外参数。</li>
                    <li>ignoreDefaultArgs (bool): 不使用 Pyppeteer 的默认参数，如果使用了这个参数，那么最好通过 args 参数来设定一些参数，否则可能会出现一些意想不到的问题。这个参数相对比较危险，慎用。</li>
                    <li>handleSIGINT (bool): 是否响应 SIGINT 信号，也就是可以使用 Ctrl + C 来终止浏览器程序，默认是 True。</li>
                    <li>handleSIGTERM (bool): 是否响应 SIGTERM 信号，一般是 kill 命令，默认是 True。</li>
                    <li>handleSIGHUP (bool): 是否响应 SIGHUP 信号，即挂起信号，比如终端退出操作，默认是 True。</li>
                    <li>dumpio (bool): 是否将 Pyppeteer 的输出内容传给 process.stdout 和 process.stderr 对象，默认是 False。</li>
                    <li>userDataDir (str): 即用户数据文件夹，即可以保留一些个性化配置和操作记录。</li>
                    <li>env (dict): 环境变量，可以通过字典形式传入。</li>
                    <li>devtools (bool): 是否为每一个页面自动开启调试工具，默认是 False。如果这个参数设置为 True，那么 headless 参数就会无效，会被强制设置为 False。</li>
                    <li>logLevel (int|str): 日志级别，默认和 root logger 对象的级别相同。</li>
                    <li>autoClose (bool): 当一些命令执行完之后，是否自动关闭浏览器，默认是 True。</li>
                    <li>loop (asyncio.AbstractEventLoop): 时间循环对象。</li>
                  </ul>
                  <p>好了，知道这些参数之后，我们可以先试试看。 首先可以试用下最常用的参数 headless，如果我们将它设置为 True 或者默认不设置它，在启动的时候我们是看不到任何界面的，如果把它设置为 False，那么在启动的时候就可以看到界面了，一般我们在调试的时候会把它设置为 False，在生产环境上就可以设置为 True，我们先尝试一下关闭 headless 模式：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">from</span> pyppeteer <span class="keyword">import</span> launch</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">await</span> launch(headless=<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">asyncio.get_event_loop().run_until_complete(main())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行之后看不到任何控制台输出，但是这时候就会出现一个空白的 Chromium 界面了： <img src="https://cdn.cuiqingcai.com/2019-07-26-image-20190416075926432.png" alt=""> 但是可以看到这就是一个光秃秃的浏览器而已，看一下相关信息： <img src="https://cdn.cuiqingcai.com/2019-07-26-image-20190416080103093.png" alt=""> 看到了，这就是 Chromium，上面还写了开发者内部版本，可以认为是开发版的 Chrome 浏览器就好。 另外我们还可以开启调试模式，比如在写爬虫的时候会经常需要分析网页结构还有网络请求，所以开启调试工具还是很有必要的，我们可以将 devtools 参数设置为 True，这样每开启一个界面就会弹出一个调试窗口，非常方便，示例如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import asyncio</span><br><span class="line"><span class="keyword">from</span> pyppeteer import launch</span><br><span class="line"></span><br><span class="line">async def main():</span><br><span class="line">    browser = await launch(<span class="attribute">devtools</span>=<span class="literal">True</span>)</span><br><span class="line">   <span class="built_in"> page </span>= await browser.newPage()</span><br><span class="line">    await page.goto(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line">    await asyncio.sleep(100)</span><br><span class="line"></span><br><span class="line">asyncio.get_event_loop().run_until_complete(main())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>刚才说过 devtools 这个参数如果设置为了 True，那么 headless 就会被关闭了，界面始终会显现出来。在这里我们新建了一个页面，打开了百度，界面运行效果如下： <img src="https://cdn.cuiqingcai.com/2019-07-26-image-20190416081010098.png" alt=""> 这时候我们可以看到上面的一条提示：”Chrome 正受到自动测试软件的控制”，这个提示条有点烦，那咋关闭呢？这时候就需要用到 args 参数了，禁用操作如下：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">browser</span> = await launch(headless=<span class="literal">False</span>, args=[<span class="string">'--disable-infobars'</span>])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里就不再写完整代码了，就是在 launch 方法中，args 参数通过 list 形式传入即可，这里使用的是 —disable-infobars 的参数。 另外有人就说了，这里你只是把提示关闭了，有些网站还是会检测到是 webdriver 吧，比如淘宝检测到是 webdriver 就会禁止登录了，我们可以试试：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import asyncio</span><br><span class="line"><span class="keyword">from</span> pyppeteer import launch</span><br><span class="line"></span><br><span class="line">async def main():</span><br><span class="line">    browser = await launch(<span class="attribute">headless</span>=<span class="literal">False</span>)</span><br><span class="line">   <span class="built_in"> page </span>= await browser.newPage()</span><br><span class="line">    await page.goto(<span class="string">'https://www.taobao.com'</span>)</span><br><span class="line">    await asyncio.sleep(100)</span><br><span class="line"></span><br><span class="line">asyncio.get_event_loop().run_until_complete(main())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行时候进行一下登录，然后就会弹出滑块，自己手动拖动一下，然后就报错了，界面如下： <img src="https://cdn.cuiqingcai.com/2019-07-26-image-20190416085103827.png" alt=""> 爬虫的时候看到这界面是很让人崩溃的吧，而且这时候我们还发现了页面的 bug，整个浏览器窗口比显示的内容窗口要大，这个是某些页面会出现的情况，让人看起来很不爽。 我们可以先解决一下这个显示的 bug，需要设置下 window-size 还有 viewport，代码如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">from</span> pyppeteer <span class="keyword">import</span> launch</span><br><span class="line"></span><br><span class="line">width, height = <span class="number">1366</span>, <span class="number">768</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    browser = <span class="keyword">await</span> launch(headless=<span class="literal">False</span>,</span><br><span class="line">                           args=[<span class="string">f'--window-size=<span class="subst">&#123;width&#125;</span>,<span class="subst">&#123;height&#125;</span>'</span>])</span><br><span class="line">    page = <span class="keyword">await</span> browser.newPage()</span><br><span class="line">    <span class="keyword">await</span> page.setViewport(&#123;<span class="string">'width'</span>: width, <span class="string">'height'</span>: height&#125;)</span><br><span class="line">    <span class="keyword">await</span> page.goto(<span class="string">'https://www.taobao.com'</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">asyncio.get_event_loop().run_until_complete(main())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样整个界面就正常了： <img src="https://cdn.cuiqingcai.com/2019-07-26-image-20190416090302627.png" alt=""> OK，那刚才所说的 webdriver 检测问题怎样来解决呢？其实淘宝主要通过 window.navigator.webdriver 来对 webdriver 进行检测，所以我们只需要使用 JavaScript 将它设置为 false 即可，代码如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">from</span> pyppeteer <span class="keyword">import</span> launch</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    browser = <span class="keyword">await</span> launch(headless=<span class="literal">False</span>, args=[<span class="string">'--disable-infobars'</span>])</span><br><span class="line">    page = <span class="keyword">await</span> browser.newPage()</span><br><span class="line">    <span class="keyword">await</span> page.goto(<span class="string">'https://login.taobao.com/member/login.jhtml?redirectURL=https://www.taobao.com/'</span>)</span><br><span class="line">    <span class="keyword">await</span> page.evaluate(</span><br><span class="line">        <span class="string">'''() =&gt;&#123; Object.defineProperties(navigator,&#123; webdriver:&#123; get: () =&gt; false &#125; &#125;) &#125;'''</span>)</span><br><span class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">asyncio.get_event_loop().run_until_complete(main())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里没加输入用户名密码的代码，当然后面可以自行添加，下面打开之后，我们点击输入用户名密码，然后这时候会出现一个滑动条，这里滑动的话，就可以通过了，如图所示： <img src="https://cdn.cuiqingcai.com/2019-07-26-image-20190416205859048.png" alt=""> OK，这样的话我们就成功规避了 webdriver 的检测，使用鼠标拖动模拟就可以完成淘宝的登录了。 还有另一种方法可以进一步免去淘宝登录的烦恼，那就是设置用户目录。平时我们已经注意到，当我们登录淘宝之后，如果下次再次打开浏览器发现还是登录的状态。这是因为淘宝的一些关键 Cookies 已经保存到本地了，下次登录的时候可以直接读取并保持登录状态。 那么这些信息保存在哪里了呢？其实就是保存在用户目录下了，里面不仅包含了浏览器的基本配置信息，还有一些 Cache、Cookies 等各种信息都在里面，如果我们能在浏览器启动的时候读取这些信息，那么启动的时候就可以恢复一些历史记录甚至一些登录状态信息了。 这也就解决了一个问题：很多朋友在每次启动 Selenium 或 Pyppeteer 的时候总是是一个全新的浏览器，那就是没有设置用户目录，如果设置了它，每次打开就不再是一个全新的浏览器了，它可以恢复之前的历史记录，也可以恢复很多网站的登录信息。 那么这个怎么来做呢？很简单，在启动的时候设置 userDataDir 就好了，示例如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import asyncio</span><br><span class="line"><span class="keyword">from</span> pyppeteer import launch</span><br><span class="line"></span><br><span class="line">async def main():</span><br><span class="line">    browser = await launch(<span class="attribute">headless</span>=<span class="literal">False</span>, <span class="attribute">userDataDir</span>=<span class="string">'./userdata'</span>, args=[<span class="string">'--disable-infobars'</span>])</span><br><span class="line">   <span class="built_in"> page </span>= await browser.newPage()</span><br><span class="line">    await page.goto(<span class="string">'https://www.taobao.com'</span>)</span><br><span class="line">    await asyncio.sleep(100)</span><br><span class="line"></span><br><span class="line">asyncio.get_event_loop().run_until_complete(main())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好，这里就是加了一个 userDataDir 的属性，值为 userdata，即当前目录的 userdata 文件夹。我们可以首先运行一下，然后登录一次淘宝，这时候我们同时可以观察到在当前运行目录下又多了一个 userdata 的文件夹，里面的结构是这样子的： <img src="https://cdn.cuiqingcai.com/2019-07-26-image-20190416211340444.png" alt=""> 具体的介绍可以看官方的一些说明，如：<a href="https://chromium.googlesource.com/chromium/src/+/master/docs/user_data_dir.md" target="_blank" rel="noopener">https://chromium.googlesource.com/chromium/src/+/master/docs/user_data_dir.md</a>，这里面介绍了 userdatadir 的相关内容。 再次运行上面的代码，这时候可以发现现在就已经是登录状态了，不需要再次登录了，这样就成功跳过了登录的流程。当然可能时间太久了，Cookies 都过期了，那还是需要登录的。 好了，本想把 Pyppeteer 的用法详细介绍完的，结果只 launch 的方法就介绍这么多了，后面的内容放到其他文章来介绍了，其他的内容后续文章会陆续放出，谢谢。</p>
                  <h2 id="本节代码获取"><a href="#本节代码获取" class="headerlink" title="本节代码获取"></a>本节代码获取</h2>
                  <p>公众号”进击的 Coder”回复”Pyppeteer”即可获取本节全部代码。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-07-26 10:46:18" itemprop="dateCreated datePublished" datetime="2019-07-26T10:46:18+08:00">2019-07-26</time>
                </span>
                <span id="/6942.html" class="post-meta-item leancloud_visitors" data-flag-title="Python 爬虫利器之 Pyppeteer 的用法" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>9.6k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>9 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6924.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 技术杂谈 <i class="label-arrow"></i>
                  </a>
                  <a href="/6924.html" class="post-title-link" itemprop="url">程序员开发必知必会之正则表达式学习资料</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="正则表达式-30-分钟入门教程（https-deerchao-net-tutorials-regex-regex-htm）"><a href="#正则表达式-30-分钟入门教程（https-deerchao-net-tutorials-regex-regex-htm）" class="headerlink" title="正则表达式 30 分钟入门教程（https://deerchao.net/tutorials/regex/regex.htm）"></a>正则表达式 30 分钟入门教程（<a href="https://deerchao.net/tutorials/regex/regex.htm" target="_blank" rel="noopener">https://deerchao.net/tutorials/regex/regex.htm</a>）</h2>
                  <p><img src="https://cdn.cuiqingcai.com/2019-07-25-232029.png" alt=""></p>
                  <blockquote>
                    <p>本教程目标：30 分钟内让你明白正则表达式是什么，并对它有一些基本的了解，让你可以在自己的程序或网页里使用它。</p>
                  </blockquote>
                  <h2 id="正则表达式-必知必会（https-www-zybuluo-com-Yano-note-475174）"><a href="#正则表达式-必知必会（https-www-zybuluo-com-Yano-note-475174）" class="headerlink" title="正则表达式 必知必会（https://www.zybuluo.com/Yano/note/475174）"></a>正则表达式 必知必会（<a href="https://www.zybuluo.com/Yano/note/475174" target="_blank" rel="noopener">https://www.zybuluo.com/Yano/note/475174</a>）</h2>
                  <p><img src="https://cdn.cuiqingcai.com/2019-07-25-232021.png" alt=""></p>
                  <h2 id="Zjmainstay-学习笔记-正则表达式（http-www-zjmainstay-cn-regexp）"><a href="#Zjmainstay-学习笔记-正则表达式（http-www-zjmainstay-cn-regexp）" class="headerlink" title="Zjmainstay 学习笔记 | 正则表达式（http://www.zjmainstay.cn/regexp）"></a>Zjmainstay 学习笔记 | 正则表达式（<a href="http://www.zjmainstay.cn/regexp" target="_blank" rel="noopener">http://www.zjmainstay.cn/regexp</a>）</h2>
                  <p><img src="https://cdn.cuiqingcai.com/2019-07-25-232013.png" alt=""></p>
                  <h2 id="《精通正则表达式-第三版》"><a href="#《精通正则表达式-第三版》" class="headerlink" title="《精通正则表达式 第三版》"></a>《精通正则表达式 第三版》</h2>
                  <ol>
                    <li>最后，推荐一本动物书《精通正则表达式 第三版》</li>
                  </ol>
                  <blockquote>
                    <p><strong>【顺手提供】</strong>精通正则表达式：第三版 PDF (高清-中文-带标签)</p>
                    <p>关注本公众号<strong>【离不开的网】</strong>，后台回复 “ <strong>正则 pdf</strong> ” 即可。</p>
                  </blockquote>
                  <p><img src="https://cdn.cuiqingcai.com/2019-07-25-231906.png" alt=""></p>
                  <h2 id="相关好文推荐"><a href="#相关好文推荐" class="headerlink" title="相关好文推荐"></a>相关好文推荐</h2>
                  <ol>
                    <li>想精通正则表达式 这几个正则表达式学习资料及工具你必须有 ：<a href="https://www.cnblogs.com/3rocks/p/11212724.html" target="_blank" rel="noopener">https://www.cnblogs.com/3rocks/p/11212724.html</a></li>
                    <li>菜鸟教程-正则表达式 ：<a href="https://www.runoob.com/regexp/regexp-tutorial.html" target="_blank" rel="noopener">https://www.runoob.com/regexp/regexp-tutorial.html</a></li>
                    <li>正则表达式速查表 ：<a href="https://www.jb51.net/article/67634.htm" target="_blank" rel="noopener">https://www.jb51.net/article/67634.htm</a></li>
                    <li>细说 python 正则表达式 ：<a href="https://www.jianshu.com/p/147fab022566" target="_blank" rel="noopener">https://www.jianshu.com/p/147fab022566</a></li>
                    <li>路人甲的关于正则表达式 ：<a href="https://zhuanlan.zhihu.com/p/21341872?refer=passer" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/21341872?refer=passer</a></li>
                    <li>最全的常用正则表达式大全——包括校验数字、字符、一些特殊的需求等等 ：<a href="http://www.cnblogs.com/zxin/archive/2013/01/26/2877765.html" target="_blank" rel="noopener">http://www.cnblogs.com/zxin/archive/2013/01/26/2877765.html</a></li>
                    <li>深入理解正则表达式 ：<a href="https://www.cnblogs.com/China3S/archive/2013/11/30/3451971.html" target="_blank" rel="noopener">https://www.cnblogs.com/China3S/archive/2013/11/30/3451971.html</a></li>
                  </ol>
                  <blockquote>
                    <p>原文链接：<a href="https://mp.weixin.qq.com/s/CGSUJntKtvOrV1o-R2GrRw" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/CGSUJntKtvOrV1o-R2GrRw</a> 来源公众号：离不开的网</p>
                  </blockquote>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-07-26 07:22:47" itemprop="dateCreated datePublished" datetime="2019-07-26T07:22:47+08:00">2019-07-26</time>
                </span>
                <span id="/6924.html" class="post-meta-item leancloud_visitors" data-flag-title="程序员开发必知必会之正则表达式学习资料" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>845</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6921.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6921.html" class="post-title-link" itemprop="url">一看就懂，Python 日志 logging 模块详解及应用</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="日志概述"><a href="#日志概述" class="headerlink" title="日志概述"></a>日志概述</h2>
                  <p><strong>百度百科的日志概述</strong>： Windows网络操作系统都设计有各种各样的日志文件，如应用程序日志，安全日志、系统日志、Scheduler服务日志、FTP日志、WWW日志、DNS服务器日志等等，这些根据你的系统开启的服务的不同而有所不同。我们在系统上进行一些操作时，这些日志文件通常会记录下我们操作的一些相关内容，这些内容对系统安全工作人员相当有用。比如说有人对系统进行了IPC探测，系统就会在安全日志里迅速地记下探测者探测时所用的IP、时间、用户名等，用FTP探测后，就会在FTP日志中记下IP、时间、探测所用的用户名等。 <strong>我映像中的日志</strong>： 查看日志是开发人员日常获取信息、排查异常、发现问题的最好途径，日志记录中通常会标记有异常产生的原因、发生时间、具体错误行数等信息，这极大的节省了我们的排查时间，无形中提高了编码效率。</p>
                  <h2 id="日志分类"><a href="#日志分类" class="headerlink" title="日志分类"></a>日志分类</h2>
                  <p>我们可以按照输出终端进行分类，也可以按照日志级别进行分类。输出终端指的是将日志在控制台输出显示和将日志存入文件；日志级别指的是 Debug、Info、WARNING、ERROR以及CRITICAL等严重等级进行划分。</p>
                  <h2 id="Python-的-logging"><a href="#Python-的-logging" class="headerlink" title="Python 的 logging"></a>Python 的 logging</h2>
                  <p>logging提供了一组便利的日志函数，它们分别是：debug()、 info()、 warning()、 error() 和 critical()。logging函数根据它们用来跟踪的事件的级别或严重程度来命名。标准级别及其适用性描述如下（以严重程度递增排序）： <img src="https://user-gold-cdn.xitu.io/2018/11/19/1672b380840b4fa6?w=853&amp;h=229&amp;f=png&amp;s=38748" alt=""> 每个级别对应的数字值为 CRITICAL：50，ERROR：40，WARNING：30，INFO：20，DEBUG：10，NOTSET：0。 Python 中日志的默认等级是 WARNING，DEBUG 和 INFO 级别的日志将不会得到显示，在 logging 中更改设置。</p>
                  <h2 id="日志输出"><a href="#日志输出" class="headerlink" title="日志输出"></a>日志输出</h2>
                  <h3 id="输出到控制台"><a href="#输出到控制台" class="headerlink" title="输出到控制台"></a>输出到控制台</h3>
                  <p>使用 logging 在控制台打印日志，这里我们用 Pycharm 编辑器来观察：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import logging</span><br><span class="line"></span><br><span class="line">logging.<span class="builtin-name">debug</span>(<span class="string">'崔庆才丨静觅、韦世东丨奎因'</span>)</span><br><span class="line">logging.<span class="builtin-name">warning</span>(<span class="string">'邀请你关注微信公众号【进击的 Coder】'</span>)</span><br><span class="line">logging.<span class="builtin-name">info</span>(<span class="string">'和大佬一起coding、共同进步'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><img src="https://user-gold-cdn.xitu.io/2018/11/19/1672bb018ec815a3?w=1206&amp;h=455&amp;f=png&amp;s=103466" alt=""> 从上图运行的结果来看，的确只显示了 WARNING 级别的信息，验证了上面的观点。同时也在控制台输出了日志内容，默认情况下 Python 中使用 logging 模块中的函数打印日志，日志只会在控制台输出，而不会保存到日文件。 <strong>有什么办法可以改变默认的日志级别呢？</strong> 当然是有的，logging 中提供了 basicConfig 让使用者可以适时调节默认日志级别，我们可以将上面的代码改为：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import logging</span><br><span class="line"></span><br><span class="line">logging.basicConfig(<span class="attribute">level</span>=logging.DEBUG)</span><br><span class="line">logging.<span class="builtin-name">debug</span>(<span class="string">'崔庆才丨静觅、韦世东丨奎因'</span>)</span><br><span class="line">logging.<span class="builtin-name">warning</span>(<span class="string">'邀请你关注微信公众号【进击的 Coder】'</span>)</span><br><span class="line">logging.<span class="builtin-name">info</span>(<span class="string">'和大佬一起coding、共同进步'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><img src="https://user-gold-cdn.xitu.io/2018/11/19/1672bb0f460bc73c?w=1154&amp;h=488&amp;f=png&amp;s=128578" alt=""> 在 basicConfig 中设定 level 参数的级别即可。 思考：如果设定级别为 logging.INFO，那 DEBUG 信息能够显示么？</p>
                  <h3 id="保存到文件"><a href="#保存到文件" class="headerlink" title="保存到文件"></a>保存到文件</h3>
                  <p>刚才演示了如何在控制台输出日志内容，并且自由设定日志的级别，那现在就来看看如何将日志保存到文件。依旧是强大的 basicConfig，我们再将上面的代码改为：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import logging</span><br><span class="line"></span><br><span class="line">logging.basicConfig(<span class="attribute">level</span>=logging.DEBUG, <span class="attribute">filename</span>=<span class="string">'coder.log'</span>, <span class="attribute">filemode</span>=<span class="string">'a'</span>)</span><br><span class="line">logging.<span class="builtin-name">debug</span>(<span class="string">'崔庆才丨静觅、韦世东丨奎因'</span>)</span><br><span class="line">logging.<span class="builtin-name">warning</span>(<span class="string">'邀请你关注微信公众号【进击的 Coder】'</span>)</span><br><span class="line">logging.<span class="builtin-name">info</span>(<span class="string">'和大佬一起coding、共同进步'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><img src="https://user-gold-cdn.xitu.io/2018/11/19/1672bb1abdf6b05b?w=1320&amp;h=412&amp;f=png&amp;s=100828" alt=""> 在配置中填写 filename （指定文件名） 和 filemode （文件写入方式），控制台的日志输出就不见了，那么 coder.log 会生成么？ <img src="https://user-gold-cdn.xitu.io/2018/11/19/1672bb2629d9df1a?w=991&amp;h=236&amp;f=png&amp;s=47054" alt=""> 在 .py 文件的同级目录生成了名为 coder.log 的日志。 通过简单的代码设置，我们就完成了日志文件在控制台和文件中的输出。那既在控制台显示又能保存到文件中呢？</p>
                  <h2 id="强大的-logging"><a href="#强大的-logging" class="headerlink" title="强大的 logging"></a>强大的 logging</h2>
                  <p>logging所提供的模块级别的日志记录函数是对logging日志系统相关类的封装 logging 模块提供了两种记录日志的方式：</p>
                  <ul>
                    <li>使用logging提供的模块级别的函数</li>
                    <li>使用Logging日志系统的四大组件</li>
                  </ul>
                  <p>这里提到的级别函数就是上面所用的 DEBGE、ERROR 等级别，而四大组件则是指 loggers、handlers、filters 和 formatters 这几个组件，下图简单明了的阐述了它们各自的作用： <img src="https://user-gold-cdn.xitu.io/2018/11/19/1672bb8e26053d22?w=599&amp;h=210&amp;f=png&amp;s=38081" alt=""> 日志器（logger）是入口，真正工作的是处理器（handler），处理器（handler）还可以通过过滤器（filter）和格式器（formatter）对要输出的日志内容做过滤和格式化等处理操作。</p>
                  <h3 id="四大组件"><a href="#四大组件" class="headerlink" title="四大组件"></a>四大组件</h3>
                  <p>下面介绍下与logging四大组件相关的类：Logger, Handler, Filter, Formatter。 <img src="https://user-gold-cdn.xitu.io/2018/11/19/1672bd8de061fc84?w=686&amp;h=620&amp;f=png&amp;s=6905" alt=""> <strong>Logger类</strong> Logger 对象有3个工作要做：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">1</span>）向应用程序代码暴露几个方法，使应用程序可以在运行时记录日志消息；</span><br><span class="line"><span class="number">2</span>）基于日志严重等级（默认的过滤设施）或filter对象来决定要对哪些日志进行后续处理；</span><br><span class="line"><span class="number">3</span>）将日志消息传送给所有感兴趣的日志handlers。</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>Logger对象最常用的方法分为两类：配置方法 和 消息发送方法 最常用的配置方法如下： <img src="https://user-gold-cdn.xitu.io/2018/11/19/1672bbaf86c3a29d?w=620&amp;h=167&amp;f=png&amp;s=29759" alt=""> 关于Logger.setLevel()方法的说明： 内建等级中，级别最低的是DEBUG，级别最高的是CRITICAL。例如setLevel(logging.INFO)，此时函数参数为INFO，那么该logger将只会处理INFO、WARNING、ERROR和CRITICAL级别的日志，而DEBUG级别的消息将会被忽略/丢弃。 logger对象配置完成后，可以使用下面的方法来创建日志记录： <img src="https://user-gold-cdn.xitu.io/2018/11/19/1672bbbf3d172a74?w=689&amp;h=234&amp;f=png&amp;s=34940" alt=""> 那么，怎样得到一个Logger对象呢？一种方式是通过Logger类的实例化方法创建一个Logger类的实例，但是我们通常都是用第二种方式—logging.getLogger()方法。 logging.getLogger()方法有一个可选参数name，该参数表示将要返回的日志器的名称标识，如果不提供该参数，则其值为’root’。若以相同的name参数值多次调用getLogger()方法，将会返回指向同一个logger对象的引用。</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">关于logger的层级结构与有效等级的说明：</span><br><span class="line"></span><br><span class="line">    logger的名称是一个以<span class="string">'.'</span>分割的层级结构，每个<span class="string">'.'</span>后面的logger都是<span class="string">'.'</span>前面的logger的children，例如，有一个名称为 foo 的logger，其它名称分别为 foo.bar, foo.bar.baz 和 foo.bam都是 foo 的后代。</span><br><span class="line">    logger有一个"有效等级（effective level）"的概念。如果一个logger上没有被明确设置一个<span class="keyword">level</span>，那么该logger就是使用它parent的<span class="keyword">level</span>;如果它的parent也没有明确设置<span class="keyword">level</span>则继续向上查找parent的parent的有效<span class="keyword">level</span>，依次类推，直到找到个一个明确设置了<span class="keyword">level</span>的祖先为止。需要说明的是，root logger总是会有一个明确的<span class="keyword">level</span>设置（默认为 <span class="built_in">WARNING</span>）。当决定是否去处理一个已发生的事件时，logger的有效等级将会被用来决定是否将该事件传递给该logger的handlers进行处理。</span><br><span class="line">    child loggers在完成对日志消息的处理后，默认会将日志消息传递给与它们的祖先loggers相关的handlers。因此，我们不必为一个应用程序中所使用的所有loggers定义和配置handlers，只需要为一个顶层的logger配置handlers，然后按照需要创建child loggers就可足够了。我们也可以通过将一个logger的propagate属性设置为<span class="keyword">False</span>来关闭这种传递机制。</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><strong>Handler</strong> Handler对象的作用是（基于日志消息的level）将消息分发到handler指定的位置（文件、网络、邮件等）。Logger对象可以通过addHandler()方法为自己添加0个或者更多个handler对象。比如，一个应用程序可能想要实现以下几个日志需求：</p>
                  <figure class="highlight lsl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">1</span>）把所有日志都发送到一个日志文件中；</span><br><span class="line"><span class="number">2</span>）把所有严重级别大于等于error的日志发送到stdout（标准输出）；</span><br><span class="line"><span class="number">3</span>）把所有严重级别为critical的日志发送到一个<span class="section">email</span>邮件地址。</span><br><span class="line">这种场景就需要<span class="number">3</span>个不同的handlers，每个handler复杂发送一个特定严重级别的日志到一个特定的位置。</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>一个handler中只有非常少数的方法是需要应用开发人员去关心的。对于使用内建handler对象的应用开发人员来说，似乎唯一相关的handler方法就是下面这几个配置方法： <img src="https://user-gold-cdn.xitu.io/2018/11/19/1672bbcf0837d1f2?w=608&amp;h=169&amp;f=png&amp;s=27138" alt=""> 需要说明的是，应用程序代码不应该直接实例化和使用Handler实例。因为Handler是一个基类，它只定义了素有handlers都应该有的接口，同时提供了一些子类可以直接使用或覆盖的默认行为。下面是一些常用的Handler： <img src="https://user-gold-cdn.xitu.io/2018/11/19/1672bbd41c2102cc?w=691&amp;h=433&amp;f=png&amp;s=82087" alt=""> <strong>Formater</strong> Formater对象用于配置日志信息的最终顺序、结构和内容。与logging.Handler基类不同的是，应用代码可以直接实例化Formatter类。另外，如果你的应用程序需要一些特殊的处理行为，也可以实现一个Formatter的子类来完成。 Formatter类的构造方法定义如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">logging.Formatter.__init__(<span class="attribute">fmt</span>=None, <span class="attribute">datefmt</span>=None, <span class="attribute">style</span>=<span class="string">'%'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>该构造方法接收3个可选参数：</p>
                  <ul>
                    <li>fmt：指定消息格式化字符串，如果不指定该参数则默认使用message的原始值</li>
                    <li>datefmt：指定日期格式字符串，如果不指定该参数则默认使用”%Y-%m-%d %H:%M:%S”</li>
                    <li>style：Python 3.2新增的参数，可取值为 ‘%’, ‘{‘和 ‘$’，如果不指定该参数则默认使用’%’</li>
                  </ul>
                  <p><strong>Filter</strong> Filter可以被Handler和Logger用来做比level更细粒度的、更复杂的过滤功能。Filter是一个过滤器基类，它只允许某个logger层级下的日志事件通过过滤。该类定义如下：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">class</span> logging.<span class="keyword">Filter</span>(<span class="type">name</span>=<span class="string">''</span>)</span><br><span class="line">    <span class="keyword">filter</span>(<span class="type">record</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>比如，一个filter实例化时传递的name参数值为’A.B’，那么该filter实例将只允许名称为类似如下规则的loggers产生的日志记录通过过滤：’A.B’，’A.B,C’，’A.B.C.D’，’A.B.D’，而名称为’A.BB’, ‘B.A.B’的loggers产生的日志则会被过滤掉。如果name的值为空字符串，则允许所有的日志事件通过过滤。 filter方法用于具体控制传递的record记录是否能通过过滤，如果该方法返回值为0表示不能通过过滤，返回值为非0表示可以通过过滤。</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">说明：</span><br><span class="line"></span><br><span class="line">    如果有需要，也可以在<span class="keyword">filter</span>(<span class="type">record</span>)方法内部改变该<span class="type">record</span>，比如添加、删除或修改一些属性。</span><br><span class="line">    我们还可以通过<span class="keyword">filter</span>做一些统计工作，比如可以计算下被一个特殊的logger或<span class="keyword">handler</span>所处理的<span class="type">record</span>数量等。</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="实战演练"><a href="#实战演练" class="headerlink" title="实战演练"></a>实战演练</h2>
                  <p>上面文绉绉的说了(复制/粘贴)那么多，现在应该动手实践了。 <strong>现在我需要既将日志输出到控制台、又能将日志保存到文件，我应该怎么办？</strong> 利用刚才所学的知识，我们可以构思一下： <img src="https://user-gold-cdn.xitu.io/2018/11/19/1672bcba03047ac6?w=806&amp;h=150&amp;f=png&amp;s=11198" alt=""> 看起来好像也不难，挺简单的样子，但是实际如此吗？ 在实际的工作或应用中，我们或许还需要指定文件存放路径、用随机数作为日志文件名、显示具体的信息输出代码行数、日志信息输出日期和日志写入方式等内容。再构思一下： <img src="https://user-gold-cdn.xitu.io/2018/11/19/1672bd3489169e73?w=1079&amp;h=391&amp;f=png&amp;s=23173" alt=""> 具体代码如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import os</span><br><span class="line">import logging</span><br><span class="line">import uuid</span><br><span class="line"><span class="keyword">from</span><span class="built_in"> logging </span>import Handler, FileHandler, StreamHandler</span><br><span class="line"></span><br><span class="line">class PathFileHandler(FileHandler):</span><br><span class="line">    def __init__(self, path, filename, <span class="attribute">mode</span>=<span class="string">'a'</span>, <span class="attribute">encoding</span>=None, <span class="attribute">delay</span>=<span class="literal">False</span>):</span><br><span class="line"></span><br><span class="line">        filename = os.fspath(filename)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(path):</span><br><span class="line">            os.mkdir(path)</span><br><span class="line">        self.baseFilename = os.path.join(path, filename)</span><br><span class="line">        self.mode = mode</span><br><span class="line">        self.encoding = encoding</span><br><span class="line">        self.delay = delay</span><br><span class="line">        <span class="keyword">if</span> delay:</span><br><span class="line">            Handler.__init__(self)</span><br><span class="line">            self.stream = None</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            StreamHandler.__init__(self, self._open())</span><br><span class="line"></span><br><span class="line">class Loggers(object):</span><br><span class="line">    # 日志级别关系映射</span><br><span class="line">    level_relations = &#123;</span><br><span class="line">        <span class="string">'debug'</span>: logging.DEBUG, <span class="string">'info'</span>: logging.INFO, <span class="string">'warning'</span>: logging.WARNING,</span><br><span class="line">        <span class="string">'error'</span>: logging.ERROR, <span class="string">'critical'</span>: logging.CRITICAL</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    def __init__(self, <span class="attribute">filename</span>=<span class="string">'&#123;uid&#125;.log'</span>.format(uid=uuid.uuid4()), <span class="attribute">level</span>=<span class="string">'info'</span>, <span class="attribute">log_dir</span>=<span class="string">'log'</span>,</span><br><span class="line">                 <span class="attribute">fmt</span>=<span class="string">'%(asctime)s - %(filename)s[line:%(lineno)d] - %(levelname)s: %(message)s'</span>):</span><br><span class="line">        self.logger = logging.getLogger(filename)</span><br><span class="line">        abspath = os.path.dirname(os.path.abspath(__file__))</span><br><span class="line">        self.directory = os.path.join(abspath, log_dir)</span><br><span class="line">        format_str = logging.Formatter(fmt)  # 设置日志格式</span><br><span class="line">        self.logger.setLevel(self.level_relations.<span class="builtin-name">get</span>(level))  # 设置日志级别</span><br><span class="line">        stream_handler = logging.StreamHandler()  # 往屏幕上输出</span><br><span class="line">        stream_handler.setFormatter(format_str)</span><br><span class="line">        file_handler = PathFileHandler(<span class="attribute">path</span>=self.directory, <span class="attribute">filename</span>=filename, <span class="attribute">mode</span>=<span class="string">'a'</span>)</span><br><span class="line">        file_handler.setFormatter(format_str)</span><br><span class="line">        self.logger.addHandler(stream_handler)</span><br><span class="line">        self.logger.addHandler(file_handler)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    txt = <span class="string">"关注公众号【进击的 Coder】，回复『日志代码』可以领取文章中完整的代码以及流程图"</span></span><br><span class="line">    log = Loggers(<span class="attribute">level</span>=<span class="string">'debug'</span>)</span><br><span class="line">    log.logger.<span class="builtin-name">info</span>(4)</span><br><span class="line">    log.logger.<span class="builtin-name">info</span>(5)</span><br><span class="line">    log.logger.<span class="builtin-name">info</span>(txt)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>文件保存后运行，运行结果如下图所示： <img src="https://user-gold-cdn.xitu.io/2018/11/19/1672bc4eb81ba291?w=1437&amp;h=602&amp;f=png&amp;s=153201" alt=""> 日志确实在控制台输出了，再来看一下目录内是否生成有指定的文件和文件夹： <img src="https://user-gold-cdn.xitu.io/2018/11/19/1672bc654930ee3f?w=1152&amp;h=161&amp;f=png&amp;s=35731" alt=""> 文件打开后可以看到里面输出的内容： <img src="https://user-gold-cdn.xitu.io/2018/11/19/1672bc6cd9fa316a" alt=""> <strong>正确的学习方式是什么</strong> 是一步步的看着文章介绍，等待博主结论？ 是拿着代码运行，跑一遍？ 都不是，应该是一边看着文章，一边拿着示例代码琢磨和研究，到底哪里可以改进、哪里可以设计得更好。如果你需要文章中所用到的示例代码和流程图，那么关注微信公众号【进击的 Coder】，回复『日志代码』就可以领取文章中完整的代码以及流程图。毕竟，学习是一件勤劳的事。 <img src="https://user-gold-cdn.xitu.io/2018/11/19/1672bd719ead7e24" alt=""> 参考资料： <a href="https://www.cnblogs.com/yyds/p/6901864.html" target="_blank" rel="noopener">云游道士博文</a> <a href="https://www.cnblogs.com/nancyzhu/p/8551506.html" target="_blank" rel="noopener">nancy05博文</a></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/韦世东学算法和反爬虫" class="author" itemprop="url" rel="index">韦世东学算法和反爬虫</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-07-25 14:53:35" itemprop="dateCreated datePublished" datetime="2019-07-25T14:53:35+08:00">2019-07-25</time>
                </span>
                <span id="/6921.html" class="post-meta-item leancloud_visitors" data-flag-title="一看就懂，Python 日志 logging 模块详解及应用" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>6.7k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>6 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6841.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 技术杂谈 <i class="label-arrow"></i>
                  </a>
                  <a href="/6841.html" class="post-title-link" itemprop="url">七分钟全面了解位运算</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>位运算是我们在编程中常会遇到的操作，但仍然有很多开发者并不了解位运算，这就导致在遇到位运算时会“打退堂鼓”。实际上，位运算并没有那么复杂，只要我们了解其运算基础和运算符的运算规则，就能够掌握位运算的知识。接下来，我们一起学习位运算的相关知识。 程序中的数在计算机内存中都是以二进制的形式存在的，位运算就是直接对整数在内存中对应的二进制位进行操作。</p>
                  <blockquote>
                    <p>注意：本文只讨论整数运算，小数运算不在本文研究之列</p>
                  </blockquote>
                  <h2 id="位运算的基础"><a href="#位运算的基础" class="headerlink" title="位运算的基础"></a>位运算的基础</h2>
                  <p>我们常用的 <code>3</code>， <code>5</code> 等数字是十进制表示，而位运算的基础是二进制。即人类采用十进制，机器采用的是二进制，要深入了解位运算，就需要了解十进制和二进制的转换方法和对应关系。</p>
                  <h3 id="二进制"><a href="#二进制" class="headerlink" title="二进制"></a>二进制</h3>
                  <p>十进制转二进制时，采用“除 2 取余，逆序排列”法：</p>
                  <ol>
                    <li>用 2 整除十进制数，得到商和余数;</li>
                    <li>再用 2 整除商，得到新的商和余数;</li>
                    <li>重复第 1 和第 2 步，直到商为 0;</li>
                    <li>将先得到的余数作为二进制数的高位，后得到的余数作为二进制数的低位，依次排序;</li>
                  </ol>
                  <p>排序结果就是该十进制数的二进制表示。例如十进制数 <code>101</code> 转换为二进制数的计算过程如下：</p>
                  <figure class="highlight basic">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">101 </span>% <span class="number">2</span> = <span class="number">50</span> 余 <span class="number">1</span></span><br><span class="line"><span class="symbol">50 </span>% <span class="number">2</span> = <span class="number">25</span> 余 <span class="number">0</span></span><br><span class="line"><span class="symbol">25 </span>% <span class="number">2</span> = <span class="number">12</span> 余 <span class="number">1</span></span><br><span class="line"><span class="symbol">12 </span>% <span class="number">2</span> = <span class="number">6</span> 余 <span class="number">0</span></span><br><span class="line"><span class="symbol">6 </span>% <span class="number">2</span> = <span class="number">3</span> 余 <span class="number">0</span></span><br><span class="line"><span class="symbol">3 </span>% <span class="number">2</span> = <span class="number">1</span> 余 <span class="number">1</span></span><br><span class="line"><span class="symbol">1 </span>% <span class="number">2</span> = <span class="number">0</span> 余 <span class="number">1</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>逆序排列即二进制中的从高位到低位排序，得到 <code>7</code> 位二进制数为 <code>1100101</code>，如果要转换为 <code>8</code> 位二进制数，就需要在最高位补 <code>0</code>。即十进制数的 <code>8</code> 位二进制数为 <code>01100101</code>。 其完整过程如下图所示： <img src="https://user-gold-cdn.xitu.io/2019/7/12/16be42ccba578426?w=448&amp;h=206&amp;f=png&amp;s=15358" alt=""> 有网友整理了常见的进制与 ASCII 码对照表，表内容如下： ASCII 控制字符 <img src="https://user-gold-cdn.xitu.io/2019/7/12/16be42d124cccad8?w=716&amp;h=858&amp;f=png&amp;s=110314" alt=""> ASCII 可显示字符 <img src="https://user-gold-cdn.xitu.io/2019/7/12/16be42d36b70664e?w=720&amp;h=836&amp;f=png&amp;s=106105" alt=""></p>
                  <h3 id="补码"><a href="#补码" class="headerlink" title="补码"></a>补码</h3>
                  <p>现在，我们已经了解到二进制与十进制的换算方法，并拥有了进制对照表。但在开始学习位运算符之前，我们还需要了解补码的知识。 数值有正负之分，那么仅有 <code>0</code> 和 <code>1</code> 的二进制如何表示正负呢？ 人们设定，二进制中最高位为 <code>0</code> 代表正，为 <code>1</code> 则代表负。例如 <code>0000 1100</code> 对应的十进制为 <code>12</code>，而 <code>1000 1100</code> 对应的十进制为 <code>\-12</code>。这种表示被称作原码。但新的问题出现了，原本二进制的最高位始终为 <code>0</code>，为了表示正负又多出了 <code>1</code>，在执行运算时就会出错。举个例子，<code>1 + (-2)</code> 的二进制运算如下：</p>
                  <figure class="highlight asciidoc">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">0000 0001 + 1000 0010 </span><br><span class="line"><span class="section">= 1000 0011</span></span><br><span class="line"><span class="section">= -3</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这显然是有问题的，问题就处在这个代表正负的最高位。接着，人们又弄出了反码（二进制各位置的 <code>0</code> 与 <code>1</code> 互换，例如 <code>0000 1100</code> 的反码为 <code>1111 0011</code>）。此时，运算就会变成这样：</p>
                  <figure class="highlight asciidoc">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">0000 0001 + 1111 1101</span><br><span class="line"><span class="section">= 1111 1110</span></span><br><span class="line"># 在转换成十进制前，需要再次反码</span><br><span class="line"><span class="section">= 1000 0001 </span></span><br><span class="line"><span class="section">= -1</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这次好像正确了。但它仍然有例外，我们来看一下 <code>1 + (-1)</code>：</p>
                  <figure class="highlight asciidoc">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">0000 0001 <span class="code">+ 1111 +</span> 1110</span><br><span class="line"><span class="section">= 1111 1111</span></span><br><span class="line"><span class="section">= 1000 0000</span></span><br><span class="line"><span class="section">= -0</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>零是没有正负之分的，为了解决这个问题，就搞出了补码的概念。补码是为了让负数变成能够加的正数，所以 <code>负数的补码= 负数的绝对值取反 + 1</code>，例如 <code>\-1</code> 的补码为：</p>
                  <figure class="highlight asciidoc">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">\-1 的绝对值 1</span><br><span class="line"><span class="section">= 0000 0001 # 1 的二进制原码</span></span><br><span class="line"><span class="section">= 1111 1110 # 原码取反</span></span><br><span class="line"><span class="section">= 1111 1111 # +1 后得到补码</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><code>\-1</code> 补码推导的完整过程如下图所示： <img src="https://user-gold-cdn.xitu.io/2019/7/12/16be42de18183539?w=480&amp;h=152&amp;f=png&amp;s=14842" alt=""> 反过来，由补码推导原码的过程为 <code>原码 = 补码 - 1，再求反</code>。要注意的是，反码过程中，最高位的值不变，这样才能够保证结果的正负不会出错。例如 <code>1 + (-6)</code> 和 <code>1 + (-9)</code> 的运算过程如下：</p>
                  <figure class="highlight asciidoc">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"># 1 的补码 + -6 的补码</span><br><span class="line">0000 0001 + 1111 1010</span><br><span class="line"><span class="section">= 1111 1011 # 补码运算结果</span></span><br><span class="line"><span class="section">= 1111 1010 # 对补码减 1，得到反码</span></span><br><span class="line"><span class="section">= 1000 0101 # 反码取反，得到原码</span></span><br><span class="line"><span class="section">= -5 # 对应的十进制</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight asciidoc">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"># 1 的补码 + -9 的补码</span><br><span class="line">0000 0001 + 1111 0111</span><br><span class="line"><span class="section">= 1111 1000 # 补码运算结果</span></span><br><span class="line"><span class="section">= 1111 0111 # 对补码减 1，得到反码</span></span><br><span class="line"><span class="section">= 1000 1000 # 反码取反，得到原码</span></span><br><span class="line"><span class="section">= -8 # 对应的十进制</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>要注意的是，正数的补码与原码相同，不需要额外运算。也可以说，补码的出现就是为了解决负数运算时的符号问题。</p>
                  <blockquote>
                    <p>人生苦短 我用 Python。 崔庆才|静觅 邀请你关注微信公众号：进击的Coder</p>
                  </blockquote>
                  <h2 id="运算符介绍"><a href="#运算符介绍" class="headerlink" title="运算符介绍"></a>运算符介绍</h2>
                  <p>位运算分为 6 种，它们是：</p>
                  <p>名称</p>
                  <p>符号</p>
                  <p>按位与</p>
                  <p>&amp;</p>
                  <p>按位或</p>
                  <p>|</p>
                  <p>按位异或</p>
                  <p>^</p>
                  <p>按位取反</p>
                  <p>~</p>
                  <p>左移运算</p>
                  <p>&lt;&lt;</p>
                  <p>右移运算</p>
                  <p>>&gt;</p>
                  <h3 id="按位与"><a href="#按位与" class="headerlink" title="按位与"></a>按位与</h3>
                  <p>按位与运算将参与运算的两数对应的二进制位相与，当对应的二进制位均为 <code>1</code> 时，结果位为 <code>1</code>，否则结果位为 <code>0</code>。按位与运算的运算符为 <code>&amp;</code>，参与运算的数以补码方式出现。举个例子，将数字 <code>5</code> 和数字 <code>8</code> 进行按位与运算，其实是将数字 <code>5</code> 对应的二进制 <code>0000 0101</code> 和数字 <code>8</code> 对应的二进制 <code>0000 1000</code> 进行按位与运算，即：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">0000</span> <span class="number">0101</span></span><br><span class="line">&amp;</span><br><span class="line"><span class="number">0000</span> <span class="number">1000</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>根据按位与的规则，将各个位置的数进行比对。运算过程如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">0000</span> <span class="number">0101</span></span><br><span class="line">&amp;</span><br><span class="line"><span class="number">0000</span> <span class="number">1000</span></span><br><span class="line">---- ----</span><br><span class="line"><span class="number">0000</span> <span class="number">0000</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>由于它们对应位置中没有“均为 <code>1</code> ”的情况，所以得到的结果是 <code>0000 0000</code>。数字 <code>5</code> 和 <code>8</code> 按位与运算的完整过程如下图： <img src="https://user-gold-cdn.xitu.io/2019/7/12/16be42e0ef065859?w=745&amp;h=290&amp;f=png&amp;s=27444" alt=""> 将结果换算成十进制，得到 <code>0</code>，即 <code>5&amp;8 = 0</code>。</p>
                  <h3 id="按位或"><a href="#按位或" class="headerlink" title="按位或"></a>按位或</h3>
                  <p>按位或运算将参与运算的两数对应的二进制位相或，只要对应的二进制位中有 <code>1</code>，结果位为 <code>1</code>，否则结果位为 <code>0</code>。按位或运算的运算符为 <code>|</code>，参与运算的数以补码方式出现。举个例子，将数字 <code>3</code> 和数字 <code>7</code> 进行按位或运算，其实是将数字 <code>3</code> 对应的二进制 <code>0000 0011</code>和数字 <code>7</code> 对应的二进制 <code>0000 0111</code> 进行按位或运算，即：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">0000</span> <span class="number">0011</span></span><br><span class="line">|</span><br><span class="line"><span class="number">0000</span> <span class="number">0111</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>根据按位或的规则，将各个位置的数进行比对。运算过程如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">0000</span> <span class="number">0011</span></span><br><span class="line">|</span><br><span class="line"><span class="number">0000</span> <span class="number">0111</span></span><br><span class="line">---- ----</span><br><span class="line"><span class="number">0000</span> <span class="number">0111</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>最终得到的结果为 <code>0000 0111</code>。将结果换算成十进制，得到 <code>7</code>，即 <code>3|7 = 7</code>。</p>
                  <h3 id="按位异或"><a href="#按位异或" class="headerlink" title="按位异或"></a>按位异或</h3>
                  <p>按位异或运算将参与运算的两数对应的二进制位相异或，当对应的二进制位值不同时，结果位为 <code>1</code>，否则结果位为 <code>0</code>。按位异或的运算符为 <code>^</code>，参与运算的数以补码方式出现。举个例子，将数字 <code>12</code> 和数字 <code>7</code> 进行按位异或运算，其实是将数字 <code>12</code> 对应的二进制 <code>0000 1100</code> 和数字 <code>7</code> 对应的二进制 <code>0000 0111</code> 进行按位异或运算，即：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">0000</span> <span class="number">1100</span></span><br><span class="line">^</span><br><span class="line"><span class="number">0000</span> <span class="number">0111</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>根据按位异或的规则，将各个位置的数进行比对。运算过程如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">0000</span> <span class="number">1100</span></span><br><span class="line">^</span><br><span class="line"><span class="number">0000</span> <span class="number">0111</span></span><br><span class="line">---- ----</span><br><span class="line"><span class="number">0000</span> <span class="number">1011</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>最终得到的结果为 <code>0000 1011</code>。将结果换算成十进制，得到 <code>11</code>，即 <code>12^7 = 11</code>。</p>
                  <h3 id="按位取反"><a href="#按位取反" class="headerlink" title="按位取反"></a>按位取反</h3>
                  <p>按位取反运算将二进制数的每一个位上面的 <code>0</code> 换成 <code>1</code>，<code>1</code> 换成 <code>0</code>。按位取反的运算符为 <code>~</code>，参与运算的数以补码方式出现。举个例子，对数字 <code>9</code> 进行按位取反运算，其实是将数字 <code>9</code> 对应的二进制 <code>0000 1001</code> 进行按位取反运算，即：</p>
                  <figure class="highlight asciidoc">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">～0000 1001</span><br><span class="line"><span class="section">= 0000 1001 # 补码，正数补码即原码</span></span><br><span class="line"><span class="section">= 1111 1010 # 取反</span></span><br><span class="line"><span class="section">= -10</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>最终得到的结果为 <code>\-10</code>。再来看一个例子，<code>\-20</code> 按位取反的过程如下：</p>
                  <figure class="highlight asciidoc">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">～0001 0100</span><br><span class="line"><span class="section">= 1110 1100 # 补码</span></span><br><span class="line"><span class="section">= 0001 0011 # 取反</span></span><br><span class="line"><span class="section">= 19</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>最终得到的结果为 <code>19</code>。我们从示例中找到了规律，按位取反的结果用数学公式表示： <script type="math/tex">～x = -(x + 1)</script> 我们可以将其套用在 <code>9</code> 和 <code>\-20</code> 上：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">～<span class="number">9</span> = -(<span class="number">9</span> + <span class="number">1</span>) = <span class="number">-10</span></span><br><span class="line">~(<span class="number">-20</span>) = -((<span class="number">-20</span>) + <span class="number">1</span>) = <span class="number">19</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这个规律也可以作用于数字 <code>0</code> 上，即 <code>~0 = -(0 + 1) = -1</code>。</p>
                  <h3 id="左移运算"><a href="#左移运算" class="headerlink" title="左移运算"></a>左移运算</h3>
                  <p>左移运算将数对应的二进位全部向左移动若干位，高位丢弃，低位补 <code>0</code>。左移运算的运算符为 <code>&lt;&lt;</code>。举个例子，将数字 <code>5</code> 左移 <code>4</code> 位，其实是将数字 <code>5</code> 对应的二进制 <code>0000 0101</code> 中的二进位向左移动 <code>4</code> 位，即：</p>
                  <figure class="highlight asciidoc">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">5 &lt;&lt; 4</span><br><span class="line"><span class="section">= 0000 0101 &lt;&lt; 4</span></span><br><span class="line"><span class="section">= 0101 0000 # 高位丢弃，低位补 0</span></span><br><span class="line"><span class="section">= 80</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>数字 <code>5</code> 左移 <code>4</code> 位的完整运算过程如下图： <img src="https://user-gold-cdn.xitu.io/2019/7/12/16be42e6eddfc892?w=530&amp;h=293&amp;f=png&amp;s=17694" alt=""> 最终结果为 <code>80</code>。这等效于: <script type="math/tex">5 _ (2) ^4</script> 也就是说，左移运算的规律为： <script type="math/tex">x << n = x _ (2) ^ n</script>
                  </p>
                  <h3 id="右移运算"><a href="#右移运算" class="headerlink" title="右移运算"></a>右移运算</h3>
                  <p>右移运算将数对应的二进位全部向右移动若干位。对于左边的空位，如果是正数则补 <code>0</code>，负数可能补 <code>0</code> 或 <code>1</code> （Turbo C 和很多编译器选择补 <code>1</code>）。右移运算的运算符为 <code>\&gt;&gt;</code>。举个例子，将数字 <code>80</code> 右移 <code>4</code> 位，其实是将数字 <code>80</code> 对应的二进制 <code>0101 0000</code> 中的二进位向右移动 <code>4</code> 位，即：</p>
                  <figure class="highlight asciidoc">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">80 &gt;&gt; 4</span><br><span class="line"><span class="section">= 0101 0000 &gt;&gt; 4</span></span><br><span class="line"><span class="section">= 0000 0101 # 正数补0，负数补1 </span></span><br><span class="line"><span class="section">= 5</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>最终结果为 <code>5</code>。这等效于： <script type="math/tex">80 \\div (2)^4</script> 也就是说，右移运算的规律为： <script type="math/tex">x >> n = x \\div (2) ^ n</script> 要注意的是，不能整除时，取整数。这中除法取整的规则类似于 <code>PYTHON</code> 语言中的地板除。</p>
                  <blockquote>
                    <p>超酷人生 我用 Rust 韦世东|奎因 邀请你关注微信公众号：Rust之禅</p>
                  </blockquote>
                  <h2 id="位运算的应用"><a href="#位运算的应用" class="headerlink" title="位运算的应用"></a>位运算的应用</h2>
                  <p>在掌握了位运算的知识后，我们可以在开发中尝试使用它。坊间一直流传着位运算的效率高，速度快，但从未见过文献证明，所以本文不讨论效率和速度的问题。如果正在阅读文章的你有相关文献，请留言告知，谢谢。 <strong>判断数字奇偶</strong> 通常，我们会通过取余来判断数字是奇数还是偶数。例如判断 <code>101</code> 的奇偶用的方法是：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># python</span></span><br><span class="line"><span class="keyword">if</span> 101 % 2:</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">'偶数'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">'奇数'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们也可以通过位运算中的按位与来实现奇偶判断，例如：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># python</span></span><br><span class="line"><span class="keyword">if</span> 101 &amp; 1:</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">'奇数'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">'偶数'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这是因为奇数的二进制最低位始终为 <code>1</code>，而偶数的二进制最低为始终为 <code>0</code>。所以，无论任何奇数与 <code>1</code> 即 <code>0000 0001</code> 相与得到的都是 <code>1</code>，任何偶数与其相与得到的都是 <code>0</code>。 <strong>变量交换</strong> 在 C 语言中，两个变量的交换必须通过第三个变量来实现。伪代码如下：</p>
                  <figure class="highlight asciidoc">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"># 伪代码</span><br><span class="line">a = 3, b = 5</span><br><span class="line">c = a</span><br><span class="line">a = b</span><br><span class="line">b = a</span><br><span class="line">--------</span><br><span class="line">a = 5, b = 3</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在 PYTHON 语言中并没有这么麻烦，可以直接交换。对应的 PYTHON 代码如下：</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># python</span></span><br><span class="line"><span class="keyword">a</span>, b = <span class="number">3</span>, <span class="number">5</span></span><br><span class="line"><span class="keyword">a</span>, b = b, <span class="keyword">a</span></span><br><span class="line">print(<span class="keyword">a</span>, b)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>代码运行结果为 <code>5 3</code>。但大部分编程语言都不支持 PYTHON 这种写法，在这种情况下我们可以通过位运算中的按位异或来实现变量的交换。对应的伪代码如下：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># 伪代码</span></span><br><span class="line"><span class="attr">a</span> = <span class="number">3</span>, b = <span class="number">5</span></span><br><span class="line"><span class="attr">a</span> = a ^ b</span><br><span class="line"><span class="attr">b</span> = a ^ b</span><br><span class="line"><span class="attr">a</span> = a ^ b</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>最后，<code>a = 5, b = 3</code>。我们可以用 C 语言和 PYTHON 语言进行验证，对应的 PYTHON 代码如下：</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># python</span></span><br><span class="line"><span class="keyword">a</span>, b = <span class="number">3</span>, <span class="number">5</span></span><br><span class="line"><span class="keyword">a</span> = <span class="keyword">a</span> ^ b</span><br><span class="line">b = <span class="keyword">a</span> ^ b</span><br><span class="line"><span class="keyword">a</span> = <span class="keyword">a</span> ^ b</span><br><span class="line">print(<span class="keyword">a</span>, b)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>代码运行结果为 <code>5 3</code>，说明变量交换成功。对应的 C 代码如下：</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">3</span>, b = <span class="number">5</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"交换前：a=%d , b=%dn"</span>,a,b);</span><br><span class="line">    a = a^b;</span><br><span class="line">    b = a^b;</span><br><span class="line">    a = a^b;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"交换后：a=%d , b=%dn"</span>,a, b);           </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>代码运行结果如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">交换前：<span class="attribute">a</span>=3 , <span class="attribute">b</span>=5</span><br><span class="line">交换后：<span class="attribute">a</span>=5 , <span class="attribute">b</span>=3</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这说明变量交换成功。 <strong>求 x 与 2 的 n 次方乘积</strong> 设一个数为 <code>x</code>，求 <code>x</code> 与 <code>2</code> 的 <code>n</code> 次方乘积。这用数学来计算都是非常简单的： <script type="math/tex">x * (2) ^ n</script> 在位运算中，要实现这个需求只需要用到左移运算，即 <code>x &lt;&lt; n</code>。 <strong>取 x 的第 k 位</strong> 即取数字 <code>x</code> 对应的二进制的第 <code>k</code> 位上的二进制值。假设数字为 <code>5</code>，其对应的二进制为 <code>0000 0101</code>，取第 <code>k</code> 位二进制值的位运算为 <code>x &gt;&gt; k &amp; 1</code>。我们可以用 PYTHON 代码进行验证：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"># python</span><br><span class="line">x = <span class="number">5</span>  # <span class="number">0000</span> <span class="number">0101</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">    print(x &gt;&gt; i &amp; <span class="number">1</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>代码运行结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">0</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这说明位运算的算法是正确的，可以满足我们的需求。 <strong>判断赋值</strong></p>
                  <figure class="highlight gml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">if</span> a == <span class="symbol">x</span>:</span><br><span class="line">    <span class="symbol">x</span> = b</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="symbol">x</span> = a</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>等效于 <code>x = a ^ b ^ x</code>。我们可以通过 PYTHON 代码来验证：</p>
                  <figure class="highlight sas">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"># python</span><br><span class="line">a, b, <span class="meta">x</span> = 6, 9, 6</span><br><span class="line"><span class="meta">if</span> a == <span class="meta">x</span>:</span><br><span class="line">    <span class="meta">x</span> = b</span><br><span class="line"><span class="meta">else</span>:</span><br><span class="line">    <span class="meta">x</span> = a</span><br><span class="line">p<span class="meta">rint(</span>a, b, <span class="meta">x</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>代码运行结果为 <code>699</code>，与之等效的代码如下：</p>
                  <figure class="highlight sas">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"># python</span><br><span class="line">a, b, <span class="meta">x</span> = 6, 9, 6</span><br><span class="line"><span class="meta">x</span> = a ^ b ^ <span class="meta">x</span></span><br><span class="line">p<span class="meta">rint(</span>a, b, <span class="meta">x</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就省去了 <code>if else</code> 的判断语句。 <strong>代替地板除</strong> 二分查找是最常用的算法之一，但它有一定的前提条件：二分查找的目标必须采用顺序存储结构，且元素有序排列。例如 PYTHON 中的有序列表。二分查找的最优复杂度为 <code>O(1)</code>，最差时间复杂度为 <code>O(log n)</code>。举个例子，假设我们需要从列表 <code>[1, 3, 5, 6, 7, 8, 12, 22, 23, 43, 65, 76, 90, 543]</code> 中找到指定元素的下标，对应的 PYTHON 代码如下：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># python</span></span><br><span class="line"><span class="string">def</span> <span class="string">search(lis:</span> <span class="string">list,</span> <span class="attr">x:</span> <span class="string">int)</span> <span class="string">-&gt;</span> <span class="attr">int:</span></span><br><span class="line">    <span class="string">""</span><span class="string">"非递归二分查找</span></span><br><span class="line"><span class="string">    返回指定元素在列表中的索引</span></span><br><span class="line"><span class="string">    -1 代表不存在"</span><span class="string">""</span></span><br><span class="line">    <span class="string">mix_index</span> <span class="string">=</span> <span class="number">0</span></span><br><span class="line">    <span class="string">max_index</span> <span class="string">=</span> <span class="string">len(lis)</span> <span class="bullet">-</span> <span class="number">1</span></span><br><span class="line">    <span class="string">while</span> <span class="string">mix_index</span> <span class="string">&lt;=</span> <span class="attr">max_index:</span></span><br><span class="line">        <span class="string">midpoint</span> <span class="string">=</span> <span class="string">(mix_index</span> <span class="string">+</span> <span class="string">max_index)</span> <span class="string">//</span> <span class="number">2</span></span><br><span class="line">        <span class="string">if</span> <span class="string">lis[midpoint]</span> <span class="string">&lt;</span> <span class="attr">x:</span></span><br><span class="line">            <span class="string">mix_index</span> <span class="string">=</span> <span class="string">mix_index</span> <span class="string">+</span> <span class="number">1</span></span><br><span class="line">        <span class="string">elif</span> <span class="string">lis[midpoint]</span> <span class="string">&gt;</span> <span class="attr">x:</span></span><br><span class="line">            <span class="string">max_index</span> <span class="string">=</span> <span class="string">max_index</span> <span class="bullet">-</span> <span class="number">1</span></span><br><span class="line">        <span class="attr">else:</span></span><br><span class="line">            <span class="string">return</span> <span class="string">midpoint</span></span><br><span class="line">    <span class="string">return</span> <span class="number">-1</span></span><br><span class="line"></span><br><span class="line"><span class="string">lists</span> <span class="string">=</span> <span class="string">[1,</span> <span class="number">3</span><span class="string">,</span> <span class="number">5</span><span class="string">,</span> <span class="number">6</span><span class="string">,</span> <span class="number">7</span><span class="string">,</span> <span class="number">8</span><span class="string">,</span> <span class="number">12</span><span class="string">,</span> <span class="number">22</span><span class="string">,</span> <span class="number">23</span><span class="string">,</span> <span class="number">43</span><span class="string">,</span> <span class="number">65</span><span class="string">,</span> <span class="number">76</span><span class="string">,</span> <span class="number">90</span><span class="string">,</span> <span class="number">543</span><span class="string">]</span></span><br><span class="line"><span class="string">res</span> <span class="string">=</span> <span class="string">search(lists,</span> <span class="number">76</span><span class="string">)</span></span><br><span class="line"><span class="string">print(res)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在取列表中间值时使用的语句是 <code>midpoint = (mix_index + max_index) // 2</code>，即地板除，我们可以将其替换为 <code>midpoint = (mix_index + max_index) &gt;&gt; 1</code> 最终得到的结果是相同的。这是因为左移 <code>1</code>位 等效于乘以 <code>2</code>，而右移 <code>1</code> 位等效于除以 <code>2</code>。这样的案例还有很多，此处不再赘述。 至此，我们已经对位运算有了一定的了解，希望你在工作中使用位运算。更多 <code>Saoperation</code> 和知识请扫描下方二维码。 <img src="https://user-gold-cdn.xitu.io/2019/7/12/16be42f3a7eae3fa?w=608&amp;h=304&amp;f=jpeg&amp;s=73490" alt=""></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/韦世东学算法和反爬虫" class="author" itemprop="url" rel="index">韦世东学算法和反爬虫</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-07-12 12:15:17" itemprop="dateCreated datePublished" datetime="2019-07-12T12:15:17+08:00">2019-07-12</time>
                </span>
                <span id="/6841.html" class="post-meta-item leancloud_visitors" data-flag-title="七分钟全面了解位运算" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>5.4k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>5 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6829.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/6829.html" class="post-title-link" itemprop="url">Python3 模拟登录并爬取表格数据</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>本节主要内容有：</p>
                  <ul>
                    <li>通过 requests 库模拟表单提交</li>
                    <li>通过 pandas 库提取网页表格</li>
                  </ul>
                  <p>上周五，大师兄发给我一个网址，哭哭啼啼地求我：“去！把这个网页上所有年所有县所有作物的数据全爬下来，存到 Access 里！” 我看他可怜，勉为其难地挥挥手说：“好嘞，马上就开始！”</p>
                  <h2 id="目标分析"><a href="#目标分析" class="headerlink" title="目标分析"></a>目标分析</h2>
                  <p>大师兄给我的网址是这个：<a href="https://www.ctic.org/crm?tdsourcetag=s_pctim_aiomsg" target="_blank" rel="noopener">https://www.ctic.org/crm?tdsourcetag=s_pctim_aiomsg</a> 打开长这样： <img src="https://cdn.cuiqingcai.com/2019-07-08-175155.png" alt=""> 根据我学爬虫并不久的经验，通常只要把年月日之类的参数附加到 url 里面去，然后用<code>requests.get</code>拿到<code>response</code>解析 html 就完了，所以这次应该也差不多——除了要先想办法获得具体有哪些年份、地名、作物名称，其他部分拿以前的代码稍微改改就能用了，毫无挑战性工作，生活真是太无聊了 点击 <code>View Summary</code> 后出现目标网页长这样 <img src="https://cdn.cuiqingcai.com/2019-07-08-175159.png" alt=""> 那个大表格的数据就是目标数据了，好像没什么了不起的—— 有点不对劲 目标数据所在网页的网址是这样的：<a href="https://www.ctic.org/crm/?action=result" target="_blank" rel="noopener">https://www.ctic.org/crm/?action=result</a> ，刚刚选择的那些参数并没有作为 url 的参数啊！网址网页都变了，所以也不是 ajax 这和我想象的情况有巨大差别啊</p>
                  <h2 id="尝试获取目标页面"><a href="#尝试获取目标页面" class="headerlink" title="尝试获取目标页面"></a>尝试获取目标页面</h2>
                  <p>让我来康康点击<code>View Summary</code>这个按钮时到底发生了啥：右键<code>View Summary</code>检查是这样： <img src="https://cdn.cuiqingcai.com/2019-07-08-175219.png" alt=""> 实话说，这是我第一次遇到要提交表单的活儿。以前可能是上天眷顾我，统统<code>get</code>就能搞定，今天终于让我碰上一个<code>post</code>了。 点击<code>View Summary</code>，到 DevTools 里找 network 第一条： <img src="https://cdn.cuiqingcai.com/2019-07-08-175223.png" alt=""> 不管三七二十一，<code>post</code>一下试试看</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'https://www.ctic.org/crm?tdsourcetag=s_pctim_aiomsg'</span></span><br><span class="line">headers = &#123;<span class="string">'user-agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) '</span></span><br><span class="line">           <span class="string">'AppleWebKit/537.36 (KHTML, like Gecko) '</span></span><br><span class="line">           <span class="string">'Chrome/74.0.3729.131 Safari/537.36'</span>,</span><br><span class="line">           <span class="string">'Host'</span>: <span class="string">'www.ctic.org'</span>&#125;</span><br><span class="line">data = &#123;<span class="string">'_csrf'</span>: <span class="string">'SjFKLWxVVkkaSRBYQWYYCA1TMG8iYR8ReUYcSj04Jh4EBzIdBGwmLw=='</span>,</span><br><span class="line">        <span class="string">'CRMSearchForm[year]'</span>: <span class="string">'2011'</span>,</span><br><span class="line">        <span class="string">'CRMSearchForm[format]'</span>: <span class="string">'Acres'</span>,</span><br><span class="line">        <span class="string">'CRMSearchForm[area]'</span>: <span class="string">'County'</span>,</span><br><span class="line">        <span class="string">'CRMSearchForm[region]'</span>: <span class="string">'Midwest'</span>,</span><br><span class="line">        <span class="string">'CRMSearchForm[state]'</span>: <span class="string">'IL'</span>,</span><br><span class="line">        <span class="string">'CRMSearchForm[county]'</span>: <span class="string">'Adams'</span>,</span><br><span class="line">        <span class="string">'CRMSearchForm[crop_type]'</span>: <span class="string">'All'</span>,</span><br><span class="line">        <span class="string">'summary'</span>: <span class="string">'county'</span>&#125;</span><br><span class="line">response = requests.post(url, <span class="attribute">data</span>=data, <span class="attribute">headers</span>=headers)</span><br><span class="line"><span class="builtin-name">print</span>(response.status_code)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>果不其然，输出<code>400</code>……我猜这就是传说中的<code>cookies</code>在搞鬼吗？《Python3 网络爬虫实战》只看到第 6 章的我不禁有些心虚跃跃欲试呢！ 首先，我搞不清<code>cookies</code>具体是啥，只知道它是用来维持会话的，应该来自于第一次<code>get</code>，搞出来看看先：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">response1 = requests.<span class="builtin-name">get</span>(url, <span class="attribute">headers</span>=headers)</span><br><span class="line"><span class="keyword">if</span> response1.status_code == 200:</span><br><span class="line">    cookies = response1.cookies</span><br><span class="line">    <span class="builtin-name">print</span>(cookies)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>输出：</p>
                  <figure class="highlight fsharp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;RequestsCookieJar<span class="meta">[&lt;Cookie PHPSESSID=52asgghnqsntitqd7c8dqesgh6 for www.ctic.org/&gt;, &lt;Cookie _csrf=2571c72a4ca9699915ea4037b967827150715252de98ea2173b162fa376bad33s%3A32%3A%22TAhjwgNo5ElZzV55k3DMeFoc5TWrEmXj%22%3B for www.ctic.org/&gt;]</span>&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>Nah，看不懂，不看不管，直接把它放到<code>post</code>里试试</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">response2 = requests.post(url, <span class="attribute">data</span>=data, <span class="attribute">headers</span>=headers, <span class="attribute">cookies</span>=cookies)</span><br><span class="line"><span class="builtin-name">print</span>(response2.status_code)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>还是<code>400</code>，气氛突然变得有些焦灼，我给你<code>cookies</code>了啊，你还想要啥？！ 突然，我发现一件事：<code>post</code>请求所带的<code>data</code>中那个一开始就显得很可疑的<code>_csrf</code>我仿佛在哪儿见过？ 那个我完全看不懂的<code>cookies</code>里好像就有一个<code>_csrf</code>啊！但是两个<code>_csrf</code>的值很明显结构不一样，试了一下把<code>data</code>里的<code>_csrf</code>换成<code>cookies</code>里的<code>_csrf</code>确实也不行。 但是我逐渐有了一个想法：这个两个<code>_csrf</code>虽然不相等，但是应该是匹配的，我刚刚的<code>data</code>来自浏览器，<code>cookies</code>来自 python 程序，所以不匹配！ 于是我又点开浏览器的 DevTools，Ctrl+F 搜索了一下，嘿嘿，发现了： <img src="https://cdn.cuiqingcai.com/2019-07-08-175237.png" alt=""> 和 <img src="https://cdn.cuiqingcai.com/2019-07-08-175242.png" alt=""> 这三处。 第一处那里的下一行的<code>csrf_token</code>很明显就是<code>post</code>请求所带的<code>data</code>里的<code>_csrf</code>，另外两个是 js 里的函数，虽然 js 没好好学但也能看出来这俩是通过<code>post</code>请求获得州名和县名的，Binggo！一下子解决两个问题。 为了验证我的猜想，我打算先直接用 requests 获取点击<code>View Summary</code>前的页面的 HTML 和<code>cookies</code>，将从 HTML 中提取的<code>csrf_token</code>值作为点击<code>View Summary</code>时<code>post</code>请求的<code>data</code>里的<code>_csrf</code>值，同时附上<code>cookies</code>，这样两处<code>_csrf</code>就应该是匹配的了：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> lxml import etree</span><br><span class="line">response1 = requests.<span class="builtin-name">get</span>(url, <span class="attribute">headers</span>=headers)</span><br><span class="line">cookies = response1.cookies</span><br><span class="line">html = etree.HTML(response1.text)</span><br><span class="line">csrf_token = html.xpath(<span class="string">'/html/head/meta[3]/@content'</span>)[0]</span><br><span class="line">data.update(&#123;<span class="string">'_csrf'</span>: csrf_token&#125;)</span><br><span class="line">response2 = requests.post(url, <span class="attribute">data</span>=data, <span class="attribute">headers</span>=headers, <span class="attribute">cookies</span>=cookies)</span><br><span class="line"><span class="builtin-name">print</span>(response2.status_code)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>输出<code>200</code>，虽然和 Chrome 显示的<code>302</code>不一样，但是也表示成功，那就不管了。把<code>response2.text</code>写入 html 文件打开看是这样： <img src="https://cdn.cuiqingcai.com/2019-07-08-175252.png" alt=""> Yeah，数据都在！说明我的猜想是对的！那一会再试试我从没用过的<code>requests.Session()</code>维持会话，自动处理<code>cookies</code>。</p>
                  <h2 id="尝试-pandas-库提取网页表格"><a href="#尝试-pandas-库提取网页表格" class="headerlink" title="尝试 pandas 库提取网页表格"></a>尝试 pandas 库提取网页表格</h2>
                  <p>现在既然已经拿到了目标页面的 HTML，那在获取所有年、地区、州名、县名之前，先测试一下<code>pandas.read_html</code>提取网页表格的功能。 <code>pandas.read_html</code>这个函数时在写代码时 IDE 自动补全下拉列表里瞄到的，一直想试试来着，今天乘机拉出来溜溜：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import pandas <span class="keyword">as</span> pd</span><br><span class="line">df = pd.read<span class="constructor">_html(<span class="params">response2</span>.<span class="params">text</span>)</span><span class="literal">[<span class="number">0</span>]</span></span><br><span class="line">print(df)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>输出： <img src="https://cdn.cuiqingcai.com/2019-07-08-175300.png" alt=""> Yeah！拿到了，确实比自己手写提取方便，而且数值字符串自动转成数值，优秀！</p>
                  <h2 id="准备所有参数"><a href="#准备所有参数" class="headerlink" title="准备所有参数"></a>准备所有参数</h2>
                  <p>接下来要获取所有年、地区、州名、县名。年份和地区是写死在 HTML 里的，直接 xpath 获取： <img src="https://cdn.cuiqingcai.com/2019-07-08-175307.png" alt=""> 州名、县名根据之前发现的两个 js 函数，要用<code>post</code>请求来获得，其中州名要根据地区名获取，县名要根据州名获取，套两层循环就行</p>
                  <figure class="highlight pf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">def new():</span><br><span class="line">    session = requests.Session()</span><br><span class="line">    response = session.get(url=url, headers=headers)</span><br><span class="line">    html = etree.HTML(response.text)</span><br><span class="line">    return session, html</span><br><span class="line"></span><br><span class="line">session, html = new()</span><br><span class="line">years = html.xpath('//*[@id=<span class="string">"crmsearchform-year"</span>]/option/text()')</span><br><span class="line">regions = html.xpath('//*[@id=<span class="string">"crmsearchform-region"</span>]/option/text()')</span><br><span class="line">_csrf = html.xpath('/html/head/meta[<span class="number">3</span>]/@content')[<span class="number">0</span>]</span><br><span class="line">region_state = &#123;&#125;</span><br><span class="line">state_county = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> region <span class="keyword">in</span> regions:</span><br><span class="line">    data = &#123;'region': region, '_csrf': _csrf&#125;</span><br><span class="line">    response = session.post(url_state, data=data)</span><br><span class="line">    html = etree.HTML(response.json())</span><br><span class="line">    region_state[region] = &#123;x: y <span class="keyword">for</span> x, y <span class="keyword">in</span></span><br><span class="line">                            zip(html.xpath('//option/@value'),</span><br><span class="line">                                html.xpath('//option/text()'))&#125;</span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">state</span> <span class="keyword">in</span> region_state[region]:</span><br><span class="line">        data = &#123;'<span class="keyword">state</span>': <span class="keyword">state</span>, '_csrf': _csrf&#125;</span><br><span class="line">        response = session.post(url_county, data=data)</span><br><span class="line">        html = etree.HTML(response.json())</span><br><span class="line">        state_county[<span class="keyword">state</span>] = html.xpath('//option/@value')</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>啧啧，使用<code>requests.Session</code>就完全不需要自己管理<code>cookies</code>了，方便！具体获得的州名县名就不放出来了，实在太多了。然后把所有年、地区、州名、县名的可能组合先整理成 csv 文件，一会直接从 csv 里读取并构造<code>post</code>请求的<code>data</code>字典：</p>
                  <figure class="highlight pf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">remain = [[str(year), str(region), str(<span class="keyword">state</span>), str(county)]</span><br><span class="line">         <span class="keyword">for</span> year <span class="keyword">in</span> years <span class="keyword">for</span> region <span class="keyword">in</span> regions</span><br><span class="line">         <span class="keyword">for</span> <span class="keyword">state</span> <span class="keyword">in</span> region_state[region] <span class="keyword">for</span> county <span class="keyword">in</span> state_county[<span class="keyword">state</span>]]</span><br><span class="line">remain = pd.DataFrame(remain, columns=['CRMSearchForm[year]',</span><br><span class="line">                                       'CRMSearchForm[region]',</span><br><span class="line">                                       'CRMSearchForm[<span class="keyword">state</span>]',</span><br><span class="line">                                       'CRMSearchForm[county]'])</span><br><span class="line">remain.to_csv('remain.csv', index=False)</span><br><span class="line"><span class="comment"># 由于州名有缩写和全称，也本地保存一份</span></span><br><span class="line">import json</span><br><span class="line">with open('region_state.json', 'w') as json_file:</span><br><span class="line">        json.dump(region_state, json_file, indent=<span class="number">4</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我看了一下，一共 49473 行——也就是说至少要发送 49473 个<code>post</code>请求才能爬完全部数据，纯手工获取的话大概要点击十倍这个数字的次数……</p>
                  <h2 id="正式开始"><a href="#正式开始" class="headerlink" title="正式开始"></a>正式开始</h2>
                  <p>那么开始爬咯</p>
                  <figure class="highlight sql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import pyodbc</span><br><span class="line"><span class="keyword">with</span> <span class="keyword">open</span>(<span class="string">"region_state.json"</span>) <span class="keyword">as</span> json_file:</span><br><span class="line">    region_state = json.load(json_file)</span><br><span class="line"><span class="keyword">data</span> = pd.read_csv(<span class="string">'remain.csv'</span>)</span><br><span class="line"><span class="comment"># 读取已经爬取的</span></span><br><span class="line">cnxn = pyodbc.connect(<span class="string">'DRIVER=&#123;Microsoft Access Driver (*.mdb, *.accdb)&#125;;'</span></span><br><span class="line">                      <span class="string">'DBQ=./ctic_crm.accdb'</span>)</span><br><span class="line">crsr = cnxn.cursor()</span><br><span class="line">crsr.execute(<span class="string">'select Year_, Region, State, County from ctic_crm'</span>)</span><br><span class="line">done = crsr.fetchall()</span><br><span class="line">done = [<span class="keyword">list</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> done]</span><br><span class="line">done = pd.DataFrame([<span class="keyword">list</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> done], <span class="keyword">columns</span>=[<span class="string">'CRMSearchForm[year]'</span>,</span><br><span class="line">                                                      <span class="string">'CRMSearchForm[region]'</span>,</span><br><span class="line">                                                      <span class="string">'CRMSearchForm[state]'</span>,</span><br><span class="line">                                                      <span class="string">'CRMSearchForm[county]'</span>])</span><br><span class="line">done[<span class="string">'CRMSearchForm[year]'</span>] = done[<span class="string">'CRMSearchForm[year]'</span>].astype(<span class="string">'int64'</span>)</span><br><span class="line">state2st = &#123;y: x <span class="keyword">for</span> z <span class="keyword">in</span> region_state.values() <span class="keyword">for</span> x, y <span class="keyword">in</span> z.items()&#125;</span><br><span class="line">done[<span class="string">'CRMSearchForm[state]'</span>] = [state2st[x]</span><br><span class="line">                                <span class="keyword">for</span> x <span class="keyword">in</span> done[<span class="string">'CRMSearchForm[state]'</span>]]</span><br><span class="line"><span class="comment"># 排除已经爬取的</span></span><br><span class="line">remain = data.append(done)</span><br><span class="line">remain = remain.drop_duplicates(<span class="keyword">keep</span>=<span class="literal">False</span>)</span><br><span class="line">total = <span class="keyword">len</span>(remain)</span><br><span class="line">print(f<span class="string">'&#123;total&#125; left.n'</span>)</span><br><span class="line">del <span class="keyword">data</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># %%</span></span><br><span class="line">remain[<span class="string">'CRMSearchForm[year]'</span>] = remain[<span class="string">'CRMSearchForm[year]'</span>].astype(<span class="string">'str'</span>)</span><br><span class="line"><span class="keyword">columns</span> = [<span class="string">'Crop'</span>,</span><br><span class="line">           <span class="string">'Total_Planted_Acres'</span>,</span><br><span class="line">           <span class="string">'Conservation_Tillage_No_Till'</span>,</span><br><span class="line">           <span class="string">'Conservation_Tillage_Ridge_Till'</span>,</span><br><span class="line">           <span class="string">'Conservation_Tillage_Mulch_Till'</span>,</span><br><span class="line">           <span class="string">'Conservation_Tillage_Total'</span>,</span><br><span class="line">           <span class="string">'Other_Tillage_Practices_Reduced_Till15_30_Residue'</span>,</span><br><span class="line">           <span class="string">'Other_Tillage_Practices_Conventional_Till0_15_Residue'</span>]</span><br><span class="line"><span class="keyword">fields</span> = [<span class="string">'Year_'</span>, <span class="string">'Units'</span>, <span class="string">'Area'</span>, <span class="string">'Region'</span>, <span class="string">'State'</span>, <span class="string">'County'</span>] + <span class="keyword">columns</span></span><br><span class="line"><span class="keyword">data</span> = &#123;<span class="string">'CRMSearchForm[format]'</span>: <span class="string">'Acres'</span>,</span><br><span class="line">        <span class="string">'CRMSearchForm[area]'</span>: <span class="string">'County'</span>,</span><br><span class="line">        <span class="string">'CRMSearchForm[crop_type]'</span>: <span class="string">'All'</span>,</span><br><span class="line">        <span class="string">'summary'</span>: <span class="string">'county'</span>&#125;</span><br><span class="line">headers = &#123;<span class="string">'user-agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) '</span></span><br><span class="line">           <span class="string">'AppleWebKit/537.36 (KHTML, like Gecko) '</span></span><br><span class="line">           <span class="string">'Chrome/74.0.3729.131 Safari/537.36'</span>,</span><br><span class="line">           <span class="string">'Host'</span>: <span class="string">'www.ctic.org'</span>,</span><br><span class="line">           <span class="string">'Upgrade-Insecure-Requests'</span>: <span class="string">'1'</span>,</span><br><span class="line">           <span class="string">'DNT'</span>: <span class="string">'1'</span>,</span><br><span class="line">           <span class="string">'Connection'</span>: <span class="string">'keep-alive'</span>&#125;</span><br><span class="line"><span class="keyword">url</span> = <span class="string">'https://www.ctic.org/crm?tdsourcetag=s_pctim_aiomsg'</span></span><br><span class="line">headers2 = headers.copy()</span><br><span class="line">headers2 = headers2.update(&#123;<span class="string">'Referer'</span>: <span class="keyword">url</span>,</span><br><span class="line">                            <span class="string">'Origin'</span>: <span class="string">'https://www.ctic.org'</span>&#125;)</span><br><span class="line"><span class="keyword">def</span> <span class="keyword">new</span>():</span><br><span class="line">    <span class="keyword">session</span> = requests.Session()</span><br><span class="line">    response = session.get(<span class="keyword">url</span>=<span class="keyword">url</span>, headers=headers)</span><br><span class="line">    html = etree.HTML(response.text)</span><br><span class="line">    _csrf = html.xpath(<span class="string">'/html/head/meta[3]/@content'</span>)[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">session</span>, _csrf</span><br><span class="line"><span class="keyword">session</span>, _csrf = <span class="keyword">new</span>()</span><br><span class="line"><span class="keyword">for</span> _, <span class="keyword">row</span> <span class="keyword">in</span> remain.iterrows():</span><br><span class="line">    temp = dict(<span class="keyword">row</span>)</span><br><span class="line">    data.update(temp)</span><br><span class="line">    data.update(&#123;<span class="string">'_csrf'</span>: _csrf&#125;)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        try:</span><br><span class="line">            response = session.post(<span class="keyword">url</span>, <span class="keyword">data</span>=<span class="keyword">data</span>, headers=headers2, <span class="keyword">timeout</span>=<span class="number">15</span>)</span><br><span class="line">            break</span><br><span class="line">        <span class="keyword">except</span> <span class="keyword">Exception</span> <span class="keyword">as</span> e:</span><br><span class="line">            session.close()</span><br><span class="line">            print(e)</span><br><span class="line">            print(<span class="string">'nSleep 30s.n'</span>)</span><br><span class="line">            time.sleep(<span class="number">30</span>)</span><br><span class="line">            <span class="keyword">session</span>, _csrf = <span class="keyword">new</span>()</span><br><span class="line">            data.update(&#123;<span class="string">'_csrf'</span>: _csrf&#125;)</span><br><span class="line"></span><br><span class="line">    df = pd.read_html(response.text)[<span class="number">0</span>].dropna(how=<span class="string">'all'</span>)</span><br><span class="line">    df.columns = <span class="keyword">columns</span></span><br><span class="line">    df[<span class="string">'Year_'</span>] = <span class="built_in">int</span>(temp[<span class="string">'CRMSearchForm[year]'</span>])</span><br><span class="line">    df[<span class="string">'Units'</span>] = <span class="string">'Acres'</span></span><br><span class="line">    df[<span class="string">'Area'</span>] = <span class="string">'County'</span></span><br><span class="line">    df[<span class="string">'Region'</span>] = temp[<span class="string">'CRMSearchForm[region]'</span>]</span><br><span class="line">    df[<span class="string">'State'</span>] = region_state[temp[<span class="string">'CRMSearchForm[region]'</span>]][temp[<span class="string">'CRMSearchForm[state]'</span>]]</span><br><span class="line">    df[<span class="string">'County'</span>] = temp[<span class="string">'CRMSearchForm[county]'</span>]</span><br><span class="line">    df = df.reindex(<span class="keyword">columns</span>=<span class="keyword">fields</span>)</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">record</span> <span class="keyword">in</span> df.itertuples(<span class="keyword">index</span>=<span class="literal">False</span>):</span><br><span class="line">        tuple_record = tuple(<span class="built_in">record</span>)</span><br><span class="line">        sql_insert = f<span class="string">'INSERT INTO ctic_crm VALUES &#123;tuple_record&#125;'</span></span><br><span class="line">        sql_insert = sql_insert.replace(<span class="string">', nan,'</span>, <span class="string">', null,'</span>)</span><br><span class="line">        crsr.execute(sql_insert)</span><br><span class="line">        crsr.commit()</span><br><span class="line">    print(total, row.to_list())</span><br><span class="line">    total -= <span class="number">1</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'Done!'</span>)</span><br><span class="line">    crsr.close()</span><br><span class="line">    cnxn.close()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>注意中间有个<code>try...except..</code>语句，是因为不定时会发生<code>Connection aborted</code>的错误，有时 9000 次才断一次，有时一次就断，这也是我加上了<code>读取已经爬取的</code>和<code>排除已经爬取的</code>原因，而且担心被识别出爬虫，把<code>headers</code>写的丰富了一些（好像并没有什么卵用），并且每次断开都暂停个 30s 并重新开一个会话 <img src="https://cdn.cuiqingcai.com/2019-07-08-175315.png" alt=""> 然后把程序开着过了一个周末，命令行里终于打出了<code>Done!</code>，到 Access 里一看有 816288 条记录，心想：下次试试多线程（进程）和代理池。</p>
                  <hr>
                  <p>周一，我把跑出来的数据发给大师兄，大师兄回我：“好的”。 隔着屏幕我都能感受到滔滔不绝的敬仰和感激之情， 一直到现在，大师兄都感动地说不出话来。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/墨大宝" class="author" itemprop="url" rel="index">墨大宝</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-07-09 01:55:30" itemprop="dateCreated datePublished" datetime="2019-07-09T01:55:30+08:00">2019-07-09</time>
                </span>
                <span id="/6829.html" class="post-meta-item leancloud_visitors" data-flag-title="Python3 模拟登录并爬取表格数据" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>8.2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>7 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6808.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> JavaScript <i class="label-arrow"></i>
                  </a>
                  <a href="/6808.html" class="post-title-link" itemprop="url">JavaScript API 设计原则详解</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2>
                  <p>本篇博文来自一次公司内部的前端分享，从多个方面讨论了在设计接口时遵循的原则，总共包含了七个大块。系卤煮自己总结的一些经验和教训。本篇博文同时也参考了其他一些文章，相关地址会在后面贴出来。很难做到详尽充实，如果有好的建议或者不对的地方，还望不吝赐教斧正。</p>
                  <h2 id="一、接口的流畅性"><a href="#一、接口的流畅性" class="headerlink" title="一、接口的流畅性"></a>一、接口的流畅性</h2>
                  <p>好的接口是流畅易懂的，他主要体现如下几个方面： 1.简单 操作某个元素的css属性，下面是原生的方法:</p>
                  <figure class="highlight dart">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">document</span>.<span class="built_in">querySelector</span>(<span class="string">'#id'</span>).style.color = <span class="string">'red'</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>封装之后</p>
                  <figure class="highlight oxygene">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span><span class="params">(<span class="keyword">selector</span>, color)</span> <span class="comment">&#123;</span></span></span><br><span class="line"><span class="function"><span class="comment">  document.querySelector(selector).style.color = color</span></span></span><br><span class="line"><span class="function"><span class="comment">&#125;</span></span></span><br><span class="line"><span class="function"><span class="title">a</span><span class="params">(<span class="string">'#a'</span>, <span class="string">'red'</span>)</span>;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>从几十个字母长长的一行到简简单单的一个函数调用，体现了api设计原则之一：简单易用。 2.可阅读性 a(‘#a’, ‘red’)是个好函数，帮助我们简单实用地改变某个元素，但问题来了，如果第一次使用该函数的人来说会比较困惑，a函数是啥函数，没有人告诉他。开发接口有必要知道一点，大多数人都是懒惰的（包括卤煮自己），从颜色赋值这个函数来说，虽然少写了代码，但是增加了单词字母的个数，使得它不再好记。每次做这件事情的时候都需要有映射关系： a—-&gt;color. 如果是简单的几个api倒是无所谓，但是通常一套框架都有几十甚至上百的api，映射成本增加会使得<a href="http://www.codeceo.com/" target="_blank" rel="noopener" title="程序员">程序员</a>哥哥崩溃。 我们需要的就是使得接口名称有意义，下面我们改写一下a函数：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">function</span> <span class="keyword">let</span><span class="constructor">SomeElementChangeColor(<span class="params">selector</span>, <span class="params">color</span>)</span> &#123;</span><br><span class="line">  document.query<span class="constructor">SelectorAll(<span class="params">selector</span>, <span class="params">color</span>)</span>.style.color = color; &#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>letSomeElementChangeColor相对于a来说被赋予了现实语言上的意义，任何人都不需要看说明也能知道它的功能。 3.减少记忆成本 我们刚刚的函数太长了，letSomeElementChangeColor虽然减少了映射成本，有了语言上的意义，但是毫无疑问增加了记忆成本。要知道，包括学霸在内，任何人都不喜欢背单词。不仅仅在此处，原生获取dom的api也同样有这个问题： document.getElementsByClassName； document.getElementsByName; document.querySelectorAll;这些api给人的感觉就是单词太长了，虽然他给出的意义是很清晰，然而这种做法是建立在牺牲简易性和简忆性的基础上进行的。于是我们又再次改写这个之前函数</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">function</span> set<span class="constructor">Color(<span class="params">selector</span>, <span class="params">color</span>)</span> &#123;</span><br><span class="line"> xxxxxxxxxxxx</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在语言意义不做大的变化前提下，缩减函数名称。使得它易读易记易用。 4.可延伸 所谓延伸就是指函数的使用像流水一样按照书写的顺序执行形成执行链条:</p>
                  <figure class="highlight coffeescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'id'</span>).style.color = <span class="string">'red'</span>;</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'id'</span>).style.fontSize = <span class="string">'12px'</span>;</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'id'</span>).style.backgourdColor = <span class="string">'pink'</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果我们需要实现像以上有强关联性的业务时，用我们之前的之前的方法是再次封装两个函数 setFontSize, setbackgroundColor; 然后执行它们 setColor(‘id’, ‘red’);setFontSiez(‘id’, ’12px’); setbackgroundColor(‘id’, ‘pink’); 显然，这样的做法没有懒出境界来；id元素每次都需要重新获取，影响性能，失败；每次都需要添加新的方法，失败； 每次还要调用这些方法，还是失败。下面我们将其改写为可以延伸的函数 首先将获取id方法封装成对象,然后再对象的每个方法中返回这个对象：</p>
                  <figure class="highlight qml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getElement</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.style = <span class="built_in">document</span>.querySelecotrAll(selector).style;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getElement.prototype.color = <span class="function"><span class="keyword">function</span>(<span class="params">color</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.style.color = <span class="built_in">color</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line">getElement.prototype.background = <span class="function"><span class="keyword">function</span>(<span class="params">bg</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.style.backgroundColor = bg;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line">getElement.prototype.fontSize = <span class="function"><span class="keyword">function</span>(<span class="params">size</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.style.fontSize = <span class="built_in">size</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//调用</span></span><br><span class="line"><span class="keyword">var</span> el = <span class="keyword">new</span> getElement(<span class="string">'#id'</span>)</span><br><span class="line">el.color(<span class="string">'red'</span>).background(<span class="string">'pink'</span>).fontSize(<span class="string">'12px'</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>简单、流畅、易读，它们看起来就像行云流水一样，即在代码性能上得到了提升优化，又在视觉上悦目。后面我们会在参数里面讲到如何继续优化。 所以，大家都比较喜欢用jquery的api，虽然一个$符号并不代表任何现实意义，但简单的符号有利于我们的使用。它体现了以上的多种原则，简单，易读，易记，链式写法，多参处理。 nightmare:</p>
                  <figure class="highlight coffeescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'id'</span>).style.color = <span class="string">'red'</span>;</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'id'</span>).style.fontSize = <span class="string">'12px'</span>;</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'id'</span>).style.backgourdColor = <span class="string">'pink'</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>dream:</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">$(<span class="string">'id'</span>).css(&#123;<span class="string">color:</span><span class="string">'red'</span>, <span class="string">fontSize:</span><span class="string">'12px'</span>, <span class="string">backgroundColor:</span><span class="string">'pink'</span>&#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="二、一致性"><a href="#二、一致性" class="headerlink" title="二、一致性"></a>二、一致性</h2>
                  <p>1.接口的一致性 相关的接口保持一致的风格，一整套 API 如果传递一种熟悉和舒适的感觉，会大大减轻开发者对新工具的适应性。 命名这点事：既要短，又要自描述，最重要的是保持一致性 “在计算机科学界只有两件头疼的事：缓存失效和命名问题” — Phil Karlton 选择一个你喜欢的措辞，然后持续使用。选择一种风格，然后保持这种风格。 Nightmare:</p>
                  <figure class="highlight autohotkey">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">setColor,</span></span><br><span class="line">letBackGround</span><br><span class="line">changefontSize</span><br><span class="line">makedisplay</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>dream:</p>
                  <figure class="highlight jboss-cli">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">set</span>Color;</span><br><span class="line"><span class="keyword">set</span>Background;</span><br><span class="line"><span class="keyword">set</span>FontSize</span><br><span class="line"><span class="keyword">set</span>.<span class="string">........</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>尽量地保持代码风格和命名风格，使别人读你的代码像是阅读同一个人写的文章一样。</p>
                  <h2 id="三、参数的处理"><a href="#三、参数的处理" class="headerlink" title="三、参数的处理"></a>三、参数的处理</h2>
                  <p>1.参数的类型 判断参数的类型为你的程序提供稳定的保障</p>
                  <figure class="highlight qml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//我们规定，color接受字符串类型</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setColor</span>(<span class="params">color</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">typeof</span> <span class="built_in">color</span> !== <span class="string">'string'</span>) <span class="keyword">return</span>;</span><br><span class="line">dosomething</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>2.使用json方式传参 使用json的方式传值很多好处，它可以给参数命名，可以忽略参数的具体位置，可以给参数默认值等等 比如下面这种糟糕的情况:</p>
                  <figure class="highlight actionscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span><span class="params">(param1, param2<span class="rest_arg">...............paramN</span>)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>你必须对应地把每一个参数按照顺序传入，否则你的方法就会偏离你预期去执行，正确的方法是下面的做法。</p>
                  <figure class="highlight actionscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span><span class="params">(json)</span> </span>&#123;</span><br><span class="line"><span class="comment">//为必须的参数设置默认值</span></span><br><span class="line">   <span class="keyword">var</span> <span class="keyword">default</span> = extend(&#123;</span><br><span class="line">    param: <span class="string">'default'</span>,</span><br><span class="line">    param1: <span class="string">'default'</span></span><br><span class="line">    ......</span><br><span class="line">   &#125;,json)</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这段函数代码，即便你不传任何参数进来，他也会预期运行。因为在声明的时候，你会根据具体的业务预先决定参数的缺省值。</p>
                  <h2 id="四、可扩展性"><a href="#四、可扩展性" class="headerlink" title="四、可扩展性"></a>四、可扩展性</h2>
                  <p>软件设计最重要的原则之一：永远不修改接口，而是去扩展它！可扩展性同时会要求接口的职责单一，多职责的接口很难扩展。 举个栗子：</p>
                  <figure class="highlight qml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//需要同时改变某个元素的字体和背景</span></span><br><span class="line"><span class="comment">// Nightmare:</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">set</span>(<span class="params">selector, color</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">document</span>.querySelectroAll(selector).style.color = <span class="built_in">color</span>;</span><br><span class="line">  <span class="built_in">document</span>.querySelectroAll(selector).style.backgroundColor = <span class="built_in">color</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//无法扩展改函数，如果需要再次改变字体的大小的话，只能修改此函数，在函数后面填加改变字体大小的代码</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Dream</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">set</span>(<span class="params">selector, color</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> el = <span class="built_in">document</span>.querySelectroAll(selector);</span><br><span class="line">  el.style.color = <span class="built_in">color</span>;</span><br><span class="line">  el.style.backgroundColor = <span class="built_in">color</span>;</span><br><span class="line">  <span class="keyword">return</span> el;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//需要设置字体、背景颜色和大小</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setAgain</span> (<span class="params">selector, color, px</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> el = set(selector, <span class="built_in">color</span>)</span><br><span class="line">  el.style.fontSize = px;</span><br><span class="line">  <span class="keyword">return</span> el;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上只是简单的添加颜色，业务复杂而代码又不是你写的时候，你就必须去阅读之前的代码再修改它，显然是不符合开放-封闭原则的。修改后的function是返回了元素对象，使得下次需要改变时再次得到返回值做处理。 2.this的运用 可扩展性还包括对this的以及call和apply方法的灵活运用：</p>
                  <figure class="highlight actionscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayBonjour</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  alert(<span class="keyword">this</span>.a)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj.a = <span class="number">1</span>;</span><br><span class="line">obj.say = sayBonjour;</span><br><span class="line">obj.say();<span class="comment">//1</span></span><br><span class="line"><span class="comment">//or</span></span><br><span class="line">sayBonjour.call||apply(obj);<span class="comment">//1</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="五、对错误的处理"><a href="#五、对错误的处理" class="headerlink" title="五、对错误的处理"></a>五、对错误的处理</h2>
                  <p>1.预见错误 可以用 类型检测 typeof 或者try…catch。 typeof 会强制检测对象不抛出错误，对于未定义的变量尤其有用。 2.抛出错误 大多数开发者不希望出错了还需要自己去找带对应得代码，最好方式是直接在console中输出，告诉用户发生了什么事情。我们可以用到浏览器为我们提供的api输出这些信息:console.log/warn/error。你还可以为自己的程序留些后路: try…catch。</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">error</span> (<span class="params">a</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">typeof</span> a !== <span class="string">'string'</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">'param a must be type of string'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">error</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// some code excucete here maybe throw wrong</span></span><br><span class="line">  &#125;<span class="keyword">catch</span>(ex) &#123;</span><br><span class="line">    <span class="built_in">console</span>.wran(ex);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="六、可预见性"><a href="#六、可预见性" class="headerlink" title="六、可预见性"></a>六、可预见性</h2>
                  <p>可预见性味程序接口提供健壮性，为保证你的代码顺利执行，必须为它考虑到非正常预期的情况。我们看下不可以预见的代码和可预见的代码的区别用之前的setColor</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//nighware</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">set</span>(<span class="params">selector, color</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">document</span>.getElementById(selector).style.color = color;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//dream</span></span><br><span class="line">zepto.init = <span class="function"><span class="keyword">function</span>(<span class="params">selector, context</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> dom</span><br><span class="line">  <span class="comment">// If nothing given, return an empty Zepto collection</span></span><br><span class="line">  <span class="keyword">if</span> (!selector) <span class="keyword">return</span> zepto.Z()</span><br><span class="line">  <span class="comment">// Optimize for string selectors</span></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> selector == <span class="string">'string'</span>) &#123;</span><br><span class="line">    selector = selector.trim()</span><br><span class="line">    <span class="comment">// If it's a html fragment, create nodes from it</span></span><br><span class="line">    <span class="comment">// Note: In both Chrome 21 and Firefox 15, DOM error 12</span></span><br><span class="line">    <span class="comment">// is thrown if the fragment doesn't begin with &lt;</span></span><br><span class="line">    <span class="keyword">if</span> (selector[<span class="number">0</span>] == <span class="string">'&lt;'</span> &amp;&amp; fragmentRE.test(selector))</span><br><span class="line">      dom = zepto.fragment(selector, <span class="built_in">RegExp</span>.$<span class="number">1</span>, context), selector = <span class="literal">null</span></span><br><span class="line">    <span class="comment">// If there's a context, create a collection on that context first, and select</span></span><br><span class="line">    <span class="comment">// nodes from there</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (context !== <span class="literal">undefined</span>) <span class="keyword">return</span> $(context).find(selector)</span><br><span class="line">    <span class="comment">// If it's a CSS selector, use it to select nodes.</span></span><br><span class="line">    <span class="keyword">else</span> dom = zepto.qsa(<span class="built_in">document</span>, selector)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// If a function is given, call it when the DOM is ready</span></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (isFunction(selector)) <span class="keyword">return</span> $(<span class="built_in">document</span>).ready(selector)</span><br><span class="line">  <span class="comment">// If a Zepto collection is given, just return it</span></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (zepto.isZ(selector)) <span class="keyword">return</span> selector</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// normalize array if an array of nodes is given</span></span><br><span class="line">    <span class="keyword">if</span> (isArray(selector)) dom = compact(selector)</span><br><span class="line">    <span class="comment">// Wrap DOM nodes.</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (isObject(selector))</span><br><span class="line">      dom = [selector], selector = <span class="literal">null</span></span><br><span class="line">    <span class="comment">// If it's a html fragment, create nodes from it</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (fragmentRE.test(selector))</span><br><span class="line">      dom = zepto.fragment(selector.trim(), <span class="built_in">RegExp</span>.$<span class="number">1</span>, context), selector = <span class="literal">null</span></span><br><span class="line">    <span class="comment">// If there's a context, create a collection on that context first, and select</span></span><br><span class="line">    <span class="comment">// nodes from there</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (context !== <span class="literal">undefined</span>) <span class="keyword">return</span> $(context).find(selector)</span><br><span class="line">    <span class="comment">// And last but no least, if it's a CSS selector, use it to select nodes.</span></span><br><span class="line">    <span class="keyword">else</span> dom = zepto.qsa(<span class="built_in">document</span>, selector)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// create a new Zepto collection from the nodes found</span></span><br><span class="line">  <span class="keyword">return</span> zepto.Z(dom, selector)</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上是zepto的源码，可以看见，作者在预见传入的参数时做了很多的处理。其实可预见性是为程序提供了若干的入口，无非是一些逻辑判断而已。zepto在这里使用了很多的是非判断，这样做的好处当然是代码比之前更健壮，但同时导致了代码的冗长，不适合阅读。总之，可预见性真正需要你做的事多写一些对位置实物的参数。把外部的检测改为内部检测。是的使用的人用起来舒心放心开心。呐！做人嘛最重要的就是海森啦。</p>
                  <h2 id="七、注释和文档的可读性"><a href="#七、注释和文档的可读性" class="headerlink" title="七、注释和文档的可读性"></a>七、注释和文档的可读性</h2>
                  <p>一个最好的接口是不需要文档我们也会使用它，但是往往接口量一多和业务增加，接口使用起来也会有些费劲。所以接口文档和注释是需要认真书写的。注释遵循简单扼要地原则，给多年后的自己也给后来者看：</p>
                  <figure class="highlight actionscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//注释接口，为了演示PPT用</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">commentary</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">//如果你定义一个没有字面意义的变量时，最好为它写上注释：a：没用的变量，可以删除</span></span><br><span class="line">  <span class="keyword">var</span> a;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//在关键和有歧义的地方写上注释，犹如画龙点睛：路由到hash界面后将所有的数据清空结束函数</span></span><br><span class="line">  <span class="keyword">return</span> go.Navigate(<span class="string">'hash'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">    data.clear();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2>
                  <p>推荐markdown语法书写API文档，github御用文档编写语法。简单、快速，代码高亮、话不多说上图 <img src="http://static.codeceo.com/images/2017/06/f0839dcb3fe291d221540d9aef8c89d1.png" alt=""> 卤煮在此也推荐几个在线编辑的网站。诸君可自行前往练习使用。 <a href="https://www.zybuluo.com/mdeditor" target="_blank" rel="noopener">https://www.zybuluo.com/mdeditor</a> <a href="http://mahua.jser.me/" target="_blank" rel="noopener">http://mahua.jser.me/</a></p>
                  <h2 id="参考博文"><a href="#参考博文" class="headerlink" title="参考博文"></a>参考博文</h2>
                  <p><a href="http://top.css88.com/archives/814" target="_blank" rel="noopener">前端头条-javascript的api设计原则</a> 原文：<a href="http://www.cnblogs.com/constantince/p/5580003.html" target="_blank" rel="noopener">http://www.cnblogs.com/constantince/p/5580003.html</a></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-07-08 03:25:55" itemprop="dateCreated datePublished" datetime="2019-07-08T03:25:55+08:00">2019-07-08</time>
                </span>
                <span id="/6808.html" class="post-meta-item leancloud_visitors" data-flag-title="JavaScript API 设计原则详解" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>7.2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>7 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6806.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> JavaScript <i class="label-arrow"></i>
                  </a>
                  <a href="/6806.html" class="post-title-link" itemprop="url">介绍 5 个实用的 Ajax 库</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>在这篇文章中，我们将介绍一些用于AJAX调用的最好的JS库，包括jQuery，Axios和Fetch。欢迎查看代码示例！ AJAX是用来对服务器进行异步HTTP调用的一系列web开发技术客户端框架。 AJAX即Asynchronous JavaScript and XML（异步JavaScript和XML）。AJAX曾是web开发界的一个常见名称，许多流行的JavaScript小部件都是使用AJAX构建的。例如，有些特定的用户交互（如按下按钮）会异步调用到服务器，服务器会检索数据并将其返回给客户端——所有这些都不需要重新加载网页。 <img src="http://static.codeceo.com/images/2018/03/ajax-logo.jpg" alt="" title="ajax-logo"></p>
                  <h2 id="AJAX的现代化重新引入"><a href="#AJAX的现代化重新引入" class="headerlink" title="AJAX的现代化重新引入"></a>AJAX的现代化重新引入</h2>
                  <p>JavaScript已经进化了，现在我们使用前端库和/或如React、Angular、Vue等框架构建了动态的网站。AJAX的概念也经历了重大变化，因为现代异步JavaScript调用涉及检索JSON而不是XML。有很多库允许你从客户端应用程序对服务器进行异步调用。有些进入到浏览器标准，有些则有很大的用户基础，因为它们不但灵活而且易于使用。有些支持promises，有些则使用回调。在本文中，我将介绍用于从服务器获取数据的前5个AJAX库。</p>
                  <h2 id="Fetch-API"><a href="#Fetch-API" class="headerlink" title="Fetch API"></a>Fetch API</h2>
                  <p>Fetch API是XMLHttpRequest的现代替代品，用于从服务器检索资源。与XMLHttpRequest不同的是，它具有更强大的功能集和更有意义的命名。基于其语法和结构，Fetch不但灵活而且易于使用。但是，与其他AJAX HTTP库区别开来的是，它具有所有现代Web浏览器的支持。Fetch遵循请求-响应的方法，也就是说，Fetch提出请求并返回解析到Response对象的promise。 你可以传递Request对象来获取，或者，也可以仅传递要获取的资源的URL。下面的示例演示了使用Fetch创建简单的GET请求。</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">fetch(<span class="string">'https://www.example.com'</span>, &#123;</span><br><span class="line">        method: <span class="string">'get'</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function"><span class="params">response</span> =&gt;</span> response.json())</span><br><span class="line">    .then(<span class="function"><span class="params">jsonData</span> =&gt;</span> <span class="built_in">console</span>.log(jsonData))</span><br><span class="line">    .catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">//error block</span></span><br><span class="line">     &#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>正如你所看到的，Fetch的then方法返回了一个响应对象，你可以使用一系列的then 进行进一步的操作。我使用.json() 方法将响应转换为JSON并将其输出到控制台。 假如你需要POST表单数据或<a href="https://cloudinary.com/blog/file_upload_with_ajax" target="_blank" rel="noopener">使用Fetch创建AJAX文件上传</a>，将会怎么样？此时，除了Fetch之外，你还需要一个输入表单，并使用FormData库来存储表单对象。</p>
                  <figure class="highlight haskell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="title">var</span> input = document.querySelector('input[<span class="class"><span class="keyword">type</span>="file"]')</span></span><br><span class="line"><span class="title">var</span> <span class="class"><span class="keyword">data</span> = new <span class="type">FormData</span>()</span></span><br><span class="line"><span class="class"><span class="keyword">data</span>.append('<span class="title">file'</span>, <span class="title">input</span>.<span class="title">files</span>[0])</span></span><br><span class="line"><span class="class"><span class="keyword">data</span>.append('<span class="title">user'</span>, '<span class="title">blizzerand'</span>)</span></span><br><span class="line"><span class="title">fetch</span>('/avatars', &#123;</span><br><span class="line">    method: '<span class="type">POST'</span>,</span><br><span class="line">    body: <span class="class"><span class="keyword">data</span></span></span><br><span class="line">&#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>你可以在官方的<a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API" target="_blank" rel="noopener">Mozilla web文档</a>中阅读更多关于Fetch API的信息。</p>
                  <h2 id="Axios"><a href="#Axios" class="headerlink" title="Axios"></a>Axios</h2>
                  <p><a href="https://github.com/axios/axios" target="_blank" rel="noopener">Axios</a>是一个基于XMLHttpRequest而构建的现代JavaScript库，用于进行AJAX调用。它允许你从浏览器和服务器发出HTTP请求。此外，它还支持ES6原生的Promise API。Axios的其他突出特点包括：</p>
                  <ul>
                    <li>拦截请求和响应。</li>
                    <li>使用promise转换请求和响应数据。</li>
                    <li>自动转换JSON数据。</li>
                    <li>取消实时请求。</li>
                  </ul>
                  <p>要使用Axios，你需要先安装它。</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">npm <span class="keyword">install</span> axios</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>下面是一个演示Axios行动的基本例子。</p>
                  <figure class="highlight scilab">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">// Make a request for a user with a given ID</span></span><br><span class="line">axios.get(<span class="string">'/user?ID=12345'</span>)</span><br><span class="line">  .<span class="keyword">then</span>(<span class="function"><span class="keyword">function</span> <span class="params">(response)</span> &#123;</span></span><br><span class="line">    console.<span class="built_in">log</span>(response);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="keyword">catch</span>(<span class="function"><span class="keyword">function</span> <span class="params">(error)</span> &#123;</span></span><br><span class="line">    console.<span class="built_in">log</span>(<span class="built_in">error</span>);</span><br><span class="line">  &#125;);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>与Fetch相比，Axios的语法更简单。让我们做一些更复杂的事情，比如我们之前使用Fetch创建的AJAX文件上传器。</p>
                  <figure class="highlight lua">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">var data = new FormData();</span><br><span class="line">   data.append(<span class="string">'foo'</span>, <span class="string">'bar'</span>);</span><br><span class="line">   data.append(<span class="string">'file'</span>, document.getElementById(<span class="string">'file'</span>).files[<span class="number">0</span>]);</span><br><span class="line">   var <span class="built_in">config</span> = &#123;</span><br><span class="line">        onUploadProgress: <span class="function"><span class="keyword">function</span><span class="params">(progressEvent)</span></span> &#123;</span><br><span class="line">          var percentCompleted = Math.round( (progressEvent.<span class="built_in">loaded</span> * <span class="number">100</span>) / progressEvent.total );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    axios.put(<span class="string">'/upload/server'</span>, data, <span class="built_in">config</span>)</span><br><span class="line">      .<span class="keyword">then</span>(<span class="function"><span class="keyword">function</span> <span class="params">(res)</span></span> &#123;</span><br><span class="line">        <span class="built_in">output</span>.className = <span class="string">'container'</span>;</span><br><span class="line">        <span class="built_in">output</span>.innerHTML = res.data;</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function"><span class="keyword">function</span> <span class="params">(err)</span></span> &#123;</span><br><span class="line">        <span class="built_in">output</span>.className = <span class="string">'container text-danger'</span>;</span><br><span class="line">        <span class="built_in">output</span>.innerHTML = err.message;</span><br><span class="line">      &#125;);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>Axios更具可读性。Axios也非常受React和Vue等现代库的欢迎。</p>
                  <h2 id="jQuery"><a href="#jQuery" class="headerlink" title="jQuery"></a>jQuery</h2>
                  <p>jQuery曾经是JavaScript中的一个前线库，用于处理从AJAX调用到操纵DOM内容的所有事情。虽然随着其他前端库的“冲击”，其相关性有所降低，但你仍然可以使用jQuery来进行异步调用。 如果你之前使用过jQuery，那么这可能是最简单的解决方案。但是，你将不得不导入整个jQuery库以使用$.ajax方法。虽然这个库有特定于域的方法，例如$.getJSON，$.get和$.post，但是其语法并不像其他的AJAX库那么简单。以下代码用于编写基本的GET请求。</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">$.ajax(&#123;</span><br><span class="line">  url: <span class="string">'/users'</span>,</span><br><span class="line">  type: <span class="string">"GET"</span>,</span><br><span class="line">  dataType: <span class="string">"json"</span>,</span><br><span class="line">  success: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(data);</span><br><span class="line">  &#125;</span><br><span class="line">  fail: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"Encountered an error"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>jQuery好的地方在于，如果你有疑问，那么你可以找到大量的支持和文档。我发现了很多使用FormData()和jQuery进行AJAX文件上传的例子。下面是最简单的方法：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">var</span> formData = <span class="keyword">new</span> FormData();</span><br><span class="line">formData.append(<span class="string">'file'</span>, $(<span class="string">'#file'</span>)[<span class="number">0</span>].files[<span class="number">0</span>]);</span><br><span class="line">$.ajax(&#123;</span><br><span class="line">       url : <span class="string">'upload.php'</span>,</span><br><span class="line">       type : <span class="string">'POST'</span>,</span><br><span class="line">       data : formData,</span><br><span class="line">       processData: <span class="literal">false</span>,  <span class="comment">// tell jQuery not to process the data</span></span><br><span class="line">       contentType: <span class="literal">false</span>,  <span class="comment">// tell jQuery not to set contentType</span></span><br><span class="line">       success : <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">           <span class="built_in">console</span>.log(data);</span><br><span class="line">           alert(data);</span><br><span class="line">       &#125;</span><br><span class="line">&#125;);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="SuperAgent"><a href="#SuperAgent" class="headerlink" title="SuperAgent"></a>SuperAgent</h2>
                  <p>SuperAgent是一个轻量级和渐进式的AJAX库，更侧重于可读性和灵活性。SuperAgent还拥有一个温和的学习曲线，不像其他库。它有一个针对Node.js API相同的模块。SuperAgent有一个接受GET、POST、PUT、DELETE和HEAD等方法的请求对象。然后你可以调用.then()，.end()或新的.await()方法来处理响应。例如，以下代码为使用SuperAgent的简单GET请求。</p>
                  <figure class="highlight less">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">request</span></span><br><span class="line">   <span class="selector-class">.post</span>(<span class="string">'/api/pet'</span>)</span><br><span class="line">   <span class="selector-class">.send</span>(&#123; <span class="attribute">name</span>: <span class="string">'Manny'</span>, <span class="attribute">species</span>: <span class="string">'cat'</span> &#125;)</span><br><span class="line">   <span class="selector-class">.set</span>(<span class="string">'X-API-Key'</span>, <span class="string">'foobar'</span>)</span><br><span class="line">   <span class="selector-class">.set</span>(<span class="string">'Accept'</span>, <span class="string">'application/json'</span>)</span><br><span class="line">   <span class="selector-class">.then</span>(function(res) &#123;</span><br><span class="line">      <span class="selector-tag">alert</span>(<span class="string">'yay got '</span> + JSON.stringify(res.body));</span><br><span class="line">   &#125;);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果你想要做更多的事情，比如使用此AJAX库上传文件，那该怎么做呢？ 同样超级easy。</p>
                  <figure class="highlight less">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">request</span></span><br><span class="line">   <span class="selector-class">.post</span>(<span class="string">'/upload'</span>)</span><br><span class="line">   <span class="selector-class">.field</span>(<span class="string">'user[name]'</span>, <span class="string">'Tobi'</span>)</span><br><span class="line">   <span class="selector-class">.field</span>(<span class="string">'user[email]'</span>, <span class="string">'tobi@learnboost.com'</span>)</span><br><span class="line">   <span class="selector-class">.field</span>(<span class="string">'friends[]'</span>, [<span class="string">'loki'</span>, <span class="string">'jane'</span>])</span><br><span class="line">   <span class="selector-class">.attach</span>(<span class="string">'image'</span>, <span class="string">'path/to/tobi.png'</span>)</span><br><span class="line">   <span class="selector-class">.then</span>(callback);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果你有兴趣了解更多<a href="https://visionmedia.github.io/superagent/" target="_blank" rel="noopener">关于SuperAgent的信息</a>，那么它们有一系列很不错的文档来帮助你开始这个旅程。</p>
                  <h2 id="Request——简化的HTTP客户端"><a href="#Request——简化的HTTP客户端" class="headerlink" title="Request——简化的HTTP客户端"></a>Request——简化的HTTP客户端</h2>
                  <p><a href="https://github.com/request/request" target="_blank" rel="noopener">Request库</a>是进行HTTP调用最简单的方法之一。结构和语法与在Node.js中处理请求的方式非常相似。目前，该项目在GitHub上有18K个星，值得一提的是，它是可用的最流行的HTTP库之一。 下面是一个例子：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">var</span> request = <span class="built_in">require</span>(<span class="string">'request'</span>);</span><br><span class="line">request(<span class="string">'http://www.google.com'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">error, response, body</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'error:'</span>, error); <span class="comment">// Print the error if one occurred</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'statusCode:'</span>, response &amp;&amp; response.statusCode); <span class="comment">// Print the response status code if a response was received</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'body:'</span>, body); <span class="comment">// Print the HTML for the Google homepage.</span></span><br><span class="line">&#125;);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2>
                  <p>从客户端进行HTTP调用在十年前可不是一件容易的事。前端开发人员不得不依赖于难以使用和实现的XMLHttpRequest。现代的库和HTTP客户端使得用户交互、动画、异步文件上传等前端功能变得更加简单。 我个人最喜欢的是Axios，因为我觉得它更易读更赏心悦目。你也可以忠于Fetch，因为它文档化良好且有标准化的解决方案。 你个人最喜欢的AJAX库是哪个？ 欢迎各位分享你的看法。</p>
                  <ul>
                    <li>译文链接：<a href="http://www.codeceo.com/article/5-javascript-ajax-libs.html" target="_blank" rel="noopener">http://www.codeceo.com/article/5-javascript-ajax-libs.html</a></li>
                    <li>英文原文：<a href="https://dzone.com/articles/top-javascript-libraries-for-making-ajax-calls" target="_blank" rel="noopener">Top JavaScript Libraries for Making AJAX Calls</a></li>
                    <li>翻译作者：<a href="http://www.codeceo.com/" target="_blank" rel="noopener">码农网</a> – 小峰</li>
                  </ul>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-07-08 01:23:09" itemprop="dateCreated datePublished" datetime="2019-07-08T01:23:09+08:00">2019-07-08</time>
                </span>
                <span id="/6806.html" class="post-meta-item leancloud_visitors" data-flag-title="介绍 5 个实用的 Ajax 库" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>4.7k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>4 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6804.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> JavaScript <i class="label-arrow"></i>
                  </a>
                  <a href="/6804.html" class="post-title-link" itemprop="url">JavaScript 实用窍门总结</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <blockquote>
                    <p>简评：一开始 JavaScript 只是为网页增添一些实时动画效果，现在 JS 已经能做到前后端通吃了，而且还是年度流行语言。本文分享几则 JS 小窍门，可以让你事半功倍 ~</p>
                  </blockquote>
                  <h2 id="1-删除数组尾部元素"><a href="#1-删除数组尾部元素" class="headerlink" title="1. 删除数组尾部元素"></a>1. 删除数组尾部元素</h2>
                  <p>一个简单方法就是改变数组的length值:</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>, <span class="number">44</span>, <span class="number">55</span>, <span class="number">66</span>];</span><br><span class="line"><span class="comment">// truncanting</span></span><br><span class="line">arr.length = <span class="number">3</span>;</span><br><span class="line">console.log(arr); <span class="comment">//=&gt; [11, 22, 33]</span></span><br><span class="line"><span class="comment">// clearing</span></span><br><span class="line">arr.length = <span class="number">0</span>;</span><br><span class="line">console.log(arr); <span class="comment">//=&gt; []</span></span><br><span class="line">console.log(arr[<span class="number">2</span>]); <span class="comment">//=&gt; undefined</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="2-使用对象解构（object-destructuring）来模拟命名参数"><a href="#2-使用对象解构（object-destructuring）来模拟命名参数" class="headerlink" title="2. 使用对象解构（object destructuring）来模拟命名参数"></a>2. 使用对象解构（object destructuring）来模拟命名参数</h2>
                  <p>如果需要将一系列可选项作为参数传入函数，你很可能会使用对象（Object）来定义配置（Config）。</p>
                  <figure class="highlight actionscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">doSomething(&#123; foo: <span class="string">'Hello'</span>, bar: <span class="string">'Hey!'</span>, baz: <span class="number">42</span> &#125;);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doSomething</span><span class="params">(config)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> foo = config.foo !== <span class="literal">undefined</span> ? config.foo : <span class="string">'Hi'</span>;</span><br><span class="line">  <span class="keyword">const</span> bar = config.bar !== <span class="literal">undefined</span> ? config.bar : <span class="string">'Yo!'</span>;</span><br><span class="line">  <span class="keyword">const</span> baz = config.baz !== <span class="literal">undefined</span> ? config.baz : <span class="number">13</span>;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>不过这是一个比较老的方法了，它模拟了 JavaScript 中的命名参数。 在 ES 2015 中，你可以直接使用对象解构：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">function</span> <span class="keyword">do</span><span class="constructor">Something(&#123; <span class="params">foo</span> = 'Hi', <span class="params">bar</span> = 'Yo!', <span class="params">baz</span> = 13 &#125;)</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>让参数可选也很简单：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">function</span> <span class="keyword">do</span><span class="constructor">Something(&#123; <span class="params">foo</span> = 'Hi', <span class="params">bar</span> = 'Yo!', <span class="params">baz</span> = 13 &#125; = &#123;&#125;)</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="3-使用对象解构来处理数组"><a href="#3-使用对象解构来处理数组" class="headerlink" title="3. 使用对象解构来处理数组"></a>3. 使用对象解构来处理数组</h2>
                  <p>可以使用对象解构的语法来获取数组的元素：</p>
                  <figure class="highlight stata">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">const</span> csvFileLine = '1997,John <span class="keyword">Doe</span>,<span class="keyword">US</span>,john@<span class="keyword">doe</span>.com,New York';</span><br><span class="line"><span class="keyword">const</span> &#123; 2: country, 4: state &#125; = csvFileLine.<span class="keyword">split</span>(',');</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="4-在-Switch-语句中使用范围值"><a href="#4-在-Switch-语句中使用范围值" class="headerlink" title="4. 在 Switch 语句中使用范围值"></a>4. 在 Switch 语句中使用范围值</h2>
                  <p>可以这样写满足范围值的语句：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getWaterState</span>(<span class="params">tempInCelsius</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> state;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> (tempInCelsius &lt;= <span class="number">0</span>): </span><br><span class="line">      state = <span class="string">'Solid'</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> (tempInCelsius &gt; <span class="number">0</span> &amp;&amp; tempInCelsius &lt; <span class="number">100</span>): </span><br><span class="line">      state = <span class="string">'Liquid'</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>: </span><br><span class="line">      state = <span class="string">'Gas'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> state;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="5-await-多个-async-函数"><a href="#5-await-多个-async-函数" class="headerlink" title="5. await 多个 async 函数"></a>5. await 多个 async 函数</h2>
                  <p>在使用 async/await 的时候，可以使用 Promise.all 来 await 多个 async 函数</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">await</span> <span class="selector-tag">Promise</span><span class="selector-class">.all</span>(<span class="selector-attr">[anAsyncCall(), thisIsAlsoAsync(), oneMore()]</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="6-创建-Pure-objects"><a href="#6-创建-Pure-objects" class="headerlink" title="6. 创建 Pure objects"></a>6. 创建 <a href="http://www.codeceo.com/article/yahoo-pure-css.html" target="_blank" rel="noopener" title="Pure">Pure</a> objects</h2>
                  <p>你可以创建一个 100% pure object，它不从Object中继承任何属性或则方法（比如constructor, toString()等）</p>
                  <figure class="highlight delphi">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">const</span> pureObject = <span class="keyword">Object</span>.create(null);</span><br><span class="line">console.log(pureObject); <span class="comment">//=&gt; &#123;&#125;</span></span><br><span class="line">console.log(pureObject<span class="function">.<span class="keyword">constructor</span>);</span> <span class="comment">//=&gt; undefined</span></span><br><span class="line">console.log(pureObject.toString); <span class="comment">//=&gt; undefined</span></span><br><span class="line">console.log(pureObject.hasOwnProperty); <span class="comment">//=&gt; undefined</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="7-格式化-JSON-代码"><a href="#7-格式化-JSON-代码" class="headerlink" title="7. 格式化 JSON 代码"></a>7. 格式化 JSON 代码</h2>
                  <p>JSON.stringify除了可以将一个对象字符化，还可以格式化输出 JSON 对象</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">const</span> obj = &#123; </span><br><span class="line">  foo: &#123; bar: [<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>, <span class="number">44</span>], baz: &#123; bing: <span class="literal">true</span>, boom: <span class="string">'Hello'</span> &#125; &#125; </span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// The third parameter is the number of spaces used to </span></span><br><span class="line"><span class="comment">// beautify the JSON output.</span></span><br><span class="line">JSON.<span class="built_in">string</span>ify(obj, <span class="literal">null</span>, <span class="number">4</span>); </span><br><span class="line"><span class="comment">// =&gt;"&#123;</span></span><br><span class="line"><span class="comment">// =&gt;    "foo": &#123;</span></span><br><span class="line"><span class="comment">// =&gt;        "bar": [</span></span><br><span class="line"><span class="comment">// =&gt;            11,</span></span><br><span class="line"><span class="comment">// =&gt;            22,</span></span><br><span class="line"><span class="comment">// =&gt;            33,</span></span><br><span class="line"><span class="comment">// =&gt;            44</span></span><br><span class="line"><span class="comment">// =&gt;        ],</span></span><br><span class="line"><span class="comment">// =&gt;        "baz": &#123;</span></span><br><span class="line"><span class="comment">// =&gt;            "bing": true,</span></span><br><span class="line"><span class="comment">// =&gt;            "boom": "Hello"</span></span><br><span class="line"><span class="comment">// =&gt;        &#125;</span></span><br><span class="line"><span class="comment">// =&gt;    &#125;</span></span><br><span class="line"><span class="comment">// =&gt;&#125;"</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="8-从数组中移除重复元素"><a href="#8-从数组中移除重复元素" class="headerlink" title="8. 从数组中移除重复元素"></a>8. 从数组中移除重复元素</h2>
                  <p>通过使用集合语法和 Spread 操作，可以很容易将重复的元素移除：</p>
                  <figure class="highlight dart">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">const</span> removeDuplicateItems = arr =&gt; [...<span class="keyword">new</span> <span class="built_in">Set</span>(arr)];</span><br><span class="line">removeDuplicateItems([<span class="number">42</span>, <span class="string">'foo'</span>, <span class="number">42</span>, <span class="string">'foo'</span>, <span class="keyword">true</span>, <span class="keyword">true</span>]);</span><br><span class="line"><span class="comment">//=&gt; [42, "foo", true]</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="9-平铺多维数组"><a href="#9-平铺多维数组" class="headerlink" title="9. 平铺多维数组"></a>9. 平铺多维数组</h2>
                  <p>使用 Spread 操作平铺嵌套多维数组：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">11</span>, [<span class="number">22</span>, <span class="number">33</span>], [<span class="number">44</span>, <span class="number">55</span>], <span class="number">66</span>];</span><br><span class="line"><span class="keyword">const</span> flatArr = [].concat(...arr); <span class="comment">//=&gt; [11, 22, 33, 44, 55, 66]</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>不过上面的方法仅适用于二维数组，但是通过递归，就可以平铺任意维度的嵌套数组了：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">function</span> flatten<span class="constructor">Array(<span class="params">arr</span>)</span> &#123;</span><br><span class="line">  const flattened = <span class="literal">[]</span>.concat(...arr);</span><br><span class="line">  return flattened.some(item =&gt; <span class="module-access"><span class="module"><span class="identifier">Array</span>.</span></span>is<span class="constructor">Array(<span class="params">item</span>)</span>) ? </span><br><span class="line">    flatten<span class="constructor">Array(<span class="params">flattened</span>)</span> : flattened;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const arr = <span class="literal">[<span class="number">11</span>, [<span class="number">22</span>, <span class="number">33</span>]</span>, <span class="literal">[<span class="number">44</span>, [<span class="number">55</span>, <span class="number">66</span>, [<span class="number">77</span>, [<span class="number">88</span>]</span>], <span class="number">99</span>]]];</span><br><span class="line">const flatArr = flatten<span class="constructor">Array(<span class="params">arr</span>)</span>; </span><br><span class="line"><span class="comment">//=&gt; [11, 22, 33, 44, 55, 66, 77, 88, 99]</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>希望这些小技巧能帮助你写好 JavaScript ~ 原文：<a href="https://zhuanlan.zhihu.com/p/37493249" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/37493249</a></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-07-08 01:20:57" itemprop="dateCreated datePublished" datetime="2019-07-08T01:20:57+08:00">2019-07-08</time>
                </span>
                <span id="/6804.html" class="post-meta-item leancloud_visitors" data-flag-title="JavaScript 实用窍门总结" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.9k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6801.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 技术杂谈 <i class="label-arrow"></i>
                  </a>
                  <a href="/6801.html" class="post-title-link" itemprop="url">知识付费的发展趋势</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p><img src="https://img0.tuicool.com/n2MFZbv.jpg!web" alt=""> 现代人都普遍比较焦虑，越来越多的人感到生活压力很大，在一二线城市不少白领人士更是已是患上“知识焦虑症”：这年头知识信息迭代太快，学习跟不上，别人懂的自己都不懂，总感觉自己欠缺的很多，没有技术和专长不知未来靠什么生存，担心自己长期落后他人从而被社会淘汰，从而产生了一种对未来不确定的心理恐惧。 于是，他们就急于渴求，希望能在短时间内学习大量知识希望从根本上解决自己的实际问题，拼命利用碎片化时间学习补充欠缺知识，不断完善自己的知识体系。这时知识付费的出现，正好满足了他们这些刚性需求。 再加上2018年前以逻辑思维为主一批内容供应商到处鼓吹和贩卖知识焦虑，在这种风气影响下连身边的很多小伙伴都购买了大量知识付费产品，但一年下来却发现这些知识根本没有学会几个，内容良莠不齐，服务跟不上，就算能坚持学完下来还是什么都不会，焦虑依然存在 。甚至更多人觉得其实知识付费就是一场骗局，从本质上来说知识付费并没有解决任何的问题，表面上只是缓解了一些焦虑，在短时间内让一些人自我感觉良好，实则上只是自欺欺人而已。 于是，一些感觉被欺骗的用户纷纷发声，对某些知识付费大号和机构更是愤怒抨击，在这些负面影响下这两年知识付费其实已逐渐降温并遭遇爆冷，甚至还有一些负面声音在说： <strong>在线知识付费的寒冬是不是要来临了？</strong> 其实不然，纵观当下市场发展态势知识付费的前景仍然是广阔的，竞争激烈程度仍方兴未艾，当人们对知识的盲目消费退烧后，知识付费更多的是回归服务价值， <strong>核心需求有两方面</strong> ： 一方面是为了提升欠缺的知识让自己具有更多的市场竞争力，另一方面也希望自己花钱买的知识付费产品是一些真正有帮助的东西，可帮自己迎来一个不错的未来。所以，知识付费的下一阶段必然聚焦于如何让学习用户获得真正有效的学习效果。 那么，知识付费下半场风口到底会吹去哪？ 好学豚认为这一领域的大方向以后的发展趋势大致有如下特征：</p>
                  <h4 id="趋势一：内容下沉，回归有价值的真实内容"><a href="#趋势一：内容下沉，回归有价值的真实内容" class="headerlink" title="趋势一：内容下沉，回归有价值的真实内容"></a>趋势一：内容下沉，回归有价值的真实内容</h4>
                  <h4 id="1、职场技能"><a href="#1、职场技能" class="headerlink" title="1、职场技能"></a>1、职场技能</h4>
                  <p>在知识付费领域和在整个教育市场体系里，职场技能都是最刚需的内容板块，从最早的电算会计化到后来的英语类培训，再到如今一些以工具为代表的设计、办公技能、IT编程等等培训，无一不彰显着其旺盛的生命力。 究其根本原因，这是因为它能够切实解决职场人士的实际需求，所以职场技能内容才会一直火爆，繁荣至今仍在蓬勃发展。</p>
                  <h4 id="2、知识拓展"><a href="#2、知识拓展" class="headerlink" title="2、知识拓展"></a>2、知识拓展</h4>
                  <p>知识拓展是近年来兴起的版块内容，也是互联网上传播特别广泛的内容。以得到为代表，邀请行业细分领域的专业人士，按照标准的生产流程来生产较高质量的内容，帮助拓广知识的视野从而实现专家指路的效果。不容忽视的是，知识拓展的内容从今天来看存在较大的局限，很难解决用户的实际问题，学习效果也很难得到保证；如何打磨出更加直击用户痛点的产品，需要更多的探索和尝试。</p>
                  <h4 id="3、兴趣爱好"><a href="#3、兴趣爱好" class="headerlink" title="3、兴趣爱好"></a>3、兴趣爱好</h4>
                  <p>在线教育领域，兴趣爱好的内容已经有了长足发展。用户的痛点正在逐渐从追求高大上、财务自由这些虚伪的概念转型到享受生活：提 升生活趣味让自己活得更舒服。兴趣爱好内容之所以能生命力如此旺盛，最大因素要得益于其以兴趣为导向，学习者本身并不会有太高的学习结果诉求，更多的是在学习之中获得的乐趣以及对授课老师的认同。</p>
                  <h4 id="趋势二：后续服务提升，注重全流程效果"><a href="#趋势二：后续服务提升，注重全流程效果" class="headerlink" title="趋势二：后续服务提升，注重全流程效果"></a>趋势二：后续服务提升，注重全流程效果</h4>
                  <p>今后知识付费需要做好三个关键点的平衡：碎片化学习、学习规模和学习效果，这三者缺一不可。根据业内行家的实践和推断，下一阶段知识付费的标配服务模式将会是1+1+N模式，能较好地实现以上三个关键点的平衡。 第一个“1”代表的是标准化的课程： 这个课程将会以“图文”、“视频”或“音频”形式进行展现，让学习者完成自学。这个“1”满足了碎片化学习的随时随地性，给予了学习者最大限度的自由度，同时也满足了由于学习规模日益扩大而带来的各种问题。 第二个“1”代表的是在线训练营： 就是把线下的集中学习模式搬到线上，开展一段时间的在线集中训练，通过学习流程、学习氛围、学习评估的三位一体运作，从而使学习效果得以达成。总体做法是把所有参与训练营的学员，分成不同的小组，然后配定相应老师。每个学员在学习过程中都需要完成相应作业，然后交给老师进行批改和点评。整个训练营阶段会有实战练习，根据学习者的自身情况或使用真实的案例来进行实战，进而帮助学习者实现学以致用。同时，老师需要对每个学习者进行阶段性评分，在学习完成时要进行总体评估；老师还需要针对小组学习效果进行展示和相应氛围的营造。 最后一个“N”则代表通过科技的力量，实现多种教学辅助手段 ：比如老师和学员之间的交互，老师批量布置和批改作业，对学员进行评分和评估，给积极学习者一些奖励等等，所有这些辅助手段，将会让老师和学员之间的交互更紧密，让学习效率更高、让学习流程更完整、学习模式更人性，从而最终达到提升学习效果的目的。</p>
                  <h4 id="趋势三：更多垂直领域的小KOL将通过工具类平台输出产品"><a href="#趋势三：更多垂直领域的小KOL将通过工具类平台输出产品" class="headerlink" title="趋势三：更多垂直领域的小KOL将通过工具类平台输出产品"></a>趋势三：更多垂直领域的小KOL将通过工具类平台输出产品</h4>
                  <p>垂直领域的小KOL，他们标签清晰、价值点明确，用户深度认可，反倒更容易突围，甚至可以脱离平台，通过好学豚这类工具就可以完成知识店铺的搭建。而且因为他们有很强的用户沉淀能力，所以也更有动力参与。长期来看，小KOL通过线上虚拟产品输出知识将会成为一个新的趋势。</p>
                  <h4 id="趋势四：一线城市受众有限，二、三线城市女性用户价值开始受到重视"><a href="#趋势四：一线城市受众有限，二、三线城市女性用户价值开始受到重视" class="headerlink" title="趋势四：一线城市受众有限，二、三线城市女性用户价值开始受到重视"></a>趋势四：一线城市受众有限，二、三线城市女性用户价值开始受到重视</h4>
                  <p>一线城市对于知识付费产品的承载能力是有限的，据观察主流付费用户都不是一线白领，而是二三线城市的宝妈。她们更愿意在知识上付钱，也愿意分享课程，赚取一定分成。 互联网独角兽的发展规律一再地证明二三线城市的女性是主力消费群体，知识付费也不会逃离这个规律，现在很多母婴类课程、女性个人提升课程、陪伴式励志课程、情商人际关系类课程销量都很不错。这是一个巨大的市场空窗，目前市场上的多数知识付费平台还忽视了二三线城市的用户，电商平台和垂直大号也还没有真正介入这一行业，这个空窗很有可能下一家知识付费独角兽企业崛起的机会。 针对以上趋势，好学豚知识付费平台也正在进行多方面的尝试，希望能把握住这些新的市场机会迎来爆发性增长，对于当下的知识付费从业者来说既是一个巨大的挑战，也是突围而出成为新独角兽企业的机会。 原文：<a href="https://www.iyiou.com/p/104850.html" target="_blank" rel="noopener">https://www.iyiou.com/p/104850.html</a></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-07-08 00:54:09" itemprop="dateCreated datePublished" datetime="2019-07-08T00:54:09+08:00">2019-07-08</time>
                </span>
                <span id="/6801.html" class="post-meta-item leancloud_visitors" data-flag-title="知识付费的发展趋势" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.5k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6799.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 技术杂谈 <i class="label-arrow"></i>
                  </a>
                  <a href="/6799.html" class="post-title-link" itemprop="url">未来，你可能会主动点开这种广告</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>首先，这篇文章不是一个广告。 但你可能已经要被这个时代无处不在的洗脑广告逼疯了。 大街小巷贴满的纸皮广告、商场和电梯里循环播放的电子屏广告、电脑上避不开关不掉停不了的网页广告…… 某招聘软件和某旅拍公司的循环怒吼式视频让人生理性地记住了它，但心理上可能想把相关人员关电梯里让它们把这条广告看一万遍。 <img src="https://img2.tuicool.com/YVBRNze.png!web" alt=""> ▲ 图片来自：「伯爵旅拍」广告截图 广告的形式不断在变化，从广播、平面、视频，到 H5、直播，部分广告会以新颖的形式和优质的内容取胜，但人们看广告一直都是被动接受的过程。 上周蜘蛛侠上映，索尼在 Snapchat 上 <a href="https://mobilemarketingmagazine.com/sony-snapchatspider-man-far-from-home-ar-campaign" target="_blank" rel="noopener">推出了 AR 活动宣传</a> ，为了贴合「英雄远征」的主题，索尼让蜘蛛侠「出现」在世界各地的地标处，比如纽约的熨斗大厦、伦敦的白金汉宫、巴黎的艾菲尔铁塔，只要你将自拍镜头对准建筑，就可以看到蜘蛛侠在屏幕上摆动。 <img src="https://img2.tuicool.com/QZNRjaI.jpg!web" alt=""> ▲图片来自：mobilemarketingmagazine 它让人们愿意看蜘蛛侠的广告，同时也让广告成了一种主动参与的过程。 接下来要讲的，就是未来这一种我们会主动点开的——VR 广告。</p>
                  <h3 id="当广告变成了一种「真实」的体验"><a href="#当广告变成了一种「真实」的体验" class="headerlink" title="当广告变成了一种「真实」的体验"></a>当广告变成了一种「真实」的体验</h3>
                  <p>我们看现在的广告，有一种潜意识默认的原则，就是注意力只给它们 3 秒钟。 但现在的 VR 广告，是给你无限的时间，让你自己去体验。 AR 火起来，还是被 2015 年 Snapchat 的搞怪 AR 滤镜，以及 2016 年的神奇宝贝 GO 带动，这也改变了市场营销对 AR 的看法，让 AR 开始在广告界生根发芽。 <img src="https://img1.tuicool.com/naMv6nE.png!web" alt=""> 宜家是首批尝试购买 AR 技术并以此宣传的公司之一。 在 <a href="https://sensortower.com/ios/US/inter-ikea-systems-b-v/app/ikea-place/1279244498/" target="_blank" rel="noopener">IKEA Place app 中</a> ，人们可以看到新款家具实际摆放在家里的样子，以判断它们是不是有足够空间布局放置、颜色风格是否和周围环境搭调，这可以帮宜家提高客户满意度以及降低产品退回率。 <img src="https://img1.tuicool.com/J3iYnqr.gif" alt=""> 随后苹果发布了 ARkit 技术，Google、Facebook、亚马逊等大公司也在 2017 年和 2018 年期间发布了自己 AR 软件开发套件，以支持日后 AR 技术的发展。 Facebook 去年就为广告商提供了 <a href="https://techcrunch.com/2018/07/10/facebook-ar-ads/" target="_blank" rel="noopener">展示产品的新方式</a> ，让人们在新闻流中看到品牌广告时，能够通过前置摄像头对比自己戴上太阳镜等配饰、甚至穿各种衣服的样子。现在 Facebook 也一直在通过各个平台包括 Instagram 扩大购物范围和增值产品。 <img src="https://img1.tuicool.com/VNRRBvZ.png!web" alt=""> 除了家居服饰，美容时尚等行业也开始尝试利用 AR 营销，主要是为了弥补线上和线下的差距。 两周前，人们已经能在 YouTube 上一边看美妆博主的化妆教程，一边在分屏之下跟着博主一起涂口红试色，这个名为 <a href="https://techcrunch.com/2019/06/18/youtubes-new-ar-beauty-try-on-lets-viewers-virtually-try-on-makeup-while-watching-video-reviews/" target="_blank" rel="noopener">AR Beauty Try-On 的功能</a> 由 Google 推出，M・A・C 是第一个跟上这项 AR 广告的品牌。测试结果发现，人们愿意花费超过 80 秒的时间去体验虚拟唇膏色调。 <img src="https://img1.tuicool.com/NbAJRrm.gif" alt=""> 甚至当你逛淘宝店，在前几周 <a href="https://www.chinanews.com/it/2019/06-25/8874866.shtml" target="_blank" rel="noopener">天猫旗舰店升级的</a> 2.0 版本，能直接让你像逛线下实体店一样逛线上 3D 商店、参观漫游，每家店铺展示内容也因人而异。 而且，你还可以实地进入 AR 广告之中。 在汽车行业，宝马、保时捷、丰田等汽车品牌都成为了 AR 广告的追随者。 丰田上个月给 2020 年卡罗拉 <a href="https://mobile-ar.reality.news/news/toyota-rolls-out-web-based-ar-advertising-campaign-via-8th-wall-0198696/" target="_blank" rel="noopener">推出了 AR 移动广告</a> ，人们可以 360 度全方位观看车内视图和功能，以及固定在一个地方的 3D 数字模型，甚至还可以在车内行走。这能让购买者更简单地了解车辆的技术特性，也有助于在购买车辆前对其预先认证。 <img src="https://img2.tuicool.com/Ivu2ume.gif" alt=""> 这种自然而直观的方式，不仅让人们和品牌建立起更真实的关系，与以往广告最大的不同就是，人们还能随时参与、持续互动，并响应内容。</p>
                  <h3 id="我们可以拿回看广告的主动权"><a href="#我们可以拿回看广告的主动权" class="headerlink" title="我们可以拿回看广告的主动权"></a>我们可以拿回看广告的主动权</h3>
                  <p>现在，我们自己可以掌控广告。 目前我们 <a href="https://www.clickz.com/ar-in-marketing-iab-playbook/241746/" target="_blank" rel="noopener">能看到的 AR 广告</a> ，主要包括被赞助的拍照滤镜镜头、应用软件和游戏内的 AR 广告单元，信息流内的 AR 广告单元等。 之前是广告「邀请」我们看，没有任何协商。但现在我们「侵入」广告，去满足自己的好奇心。广告变成了一个工具，我们通过它与我们喜欢的品牌获得联系。 这种形式现在也让 AR 广告成为当今市场上破坏性最小的广告单元之一。 <img src="https://img1.tuicool.com/z63EnqU.png!web" alt=""> ▲ 图片来自：unsplash 另外，AR 广告已经不再是单独的一个内容，而是进入我们的真实生活，或者进入其它我们沉浸的内容之中——广告本身就是商品的展示位，不会再有其它如美化特效、夸张视觉等因素插入和干扰。 而且这些 AR 广告最初打开的阀门，就掌握在消费者手上。 因为 AR 广告现在都需要申请对其相机／设备的访问，在非相机优先的应用中，也需要申请特定权限，因此你完全可以选择你需要的内容，并与之开始进一步互动。 <img src="https://img2.tuicool.com/aiUJVnA.jpg!web" alt=""> ▲ 图片来自： <a href="https://www.cisin.com/coffee-break/technology/augmented-reality-ar-technology-sets-free-an-enormous-company-development-prospects.html" target="_blank" rel="noopener">Cyber Infrastructure</a> 可以说，AR 就是有史以来最强大的故事叙述媒体。它的互动带来的「响应式特色」，就是它最大的优势。 Unity 技术的 AR / VR 广告创新 <a href="https://appdevelopermagazine.com/why-ar-advertising-is-hard/" target="_blank" rel="noopener">负责人 Tony Parisi 说</a> ： 响应性 AR 广告是一种更加友好，不那么令人生畏的方法，这些广告能够提高客户的选择率，同时通过控制权来提高用户的舒适度。 尽管 AR 广告现在还不足以吸引大多数用户，人们似乎更觉得这只是消费者的一种自我意淫。 但实际上幸运的是，现在它背后有一批最大的科技公司在支持和推动，这就让更多设计师有机会去创造更好的 AR 广告环境，更多品牌有空间去施放更大的营销活动。 Google、苹果、Facebook 这样的大平台仍然主导着 AR 领域及其营销的发展。这些科技公司还和零售商 <a href="https://www.mobilemarketer.com/news/more-than-140-retailers-tech-companies-team-up-to-improve-arvr/553412/" target="_blank" rel="noopener">组成了一个小组</a> ，为用于增强现实购物的 3D 图像创建一套通用标准。 <img src="https://img2.tuicool.com/juaaIzr.gif" alt=""> ▲ Google 推出名为 Swirl 的沉浸式显示，消费者可以 360 度查看、旋转、放大、缩小商品 在这个背景之下，市场研究公司 <a href="https://www.seaberyat.com/augmented-reality-stats/" target="_blank" rel="noopener">Markets and Markets 的数据</a> 预计，到明年 AR 将拥有 10 亿用户，到 2022 年将达到 22 亿美元的广告支出。 AR 广告进入我们的生活将会更加快速，而我们掌握的主动权也会越来越多，正如以色列最大的互联网公司 IronSource 首席设计官 <a href="http://www.adotas.com/2017/11/__trashed-115/" target="_blank" rel="noopener">Dan Greenberg</a> <a href="http://www.adotas.com/2017/11/__trashed-115/" target="_blank" rel="noopener">所认为的</a> ： 我们不断研究如何在广告中为用户提供尽可能多的选择的方法。因为给用户提供更多控制权，才是创建真正个性化移动体验的关键。</p>
                  <h3 id="AR-会是下一个广告形态"><a href="#AR-会是下一个广告形态" class="headerlink" title="AR 会是下一个广告形态"></a>AR 会是下一个广告形态</h3>
                  <p>数字广告总体上正朝着更丰富、更身临其境、更多选择的方向发展，消费者正在被置于互动体验的中心。 <a href="https://www.mobilemarketer.com/news/study-agencies-face-cost-tech-hurdles-with-ar-advertising/557067/" target="_blank" rel="noopener">根据 Gartner 的估计</a> ，随着 5G 高速移动服务的推出，明年它将推动 AR 购物增长到 1 亿消费者。 <img src="https://img2.tuicool.com/bI77bau.png!web" alt=""> ▲ 图片来自：unsplash 因为在高速运行的网络下，开发者不仅能够创造更高质量的 3D 可视化技术，消费者也能获得更多形式的沉浸式体验，品牌也能将其购物平台更多扩展到商店和传统网站之外的移动设备上，而且广告也不会再只限于移动设备的小屏幕。 还可以预见的是，5G 网络之下数据信息密度也会迅速加大，除了文本，还有图像、视频，人们接受的购物信息无疑更广、更深、更繁杂，而 AR 能够降低广告的感知成本，让人们消费数字内容将更简便和直观。 <img src="https://img0.tuicool.com/2QRNfqF.png!web" alt=""> ▲ 图片来自：unsplash 但现在 AR 广告还未普及的主要问题，就在于它的成本和技术。 比起其他广告形式来说，其实它的投入成本并不低。Digiday 指出 <a href="https://www.skyword.com/contentstandard/marketing/snapchat-ar-ads-are-now-more-affordable-making-it-a-go-to-ar-destination/" target="_blank" rel="noopener">单一的广告体验</a> 可能需要花费 5,000 到 30,000 美元甚至更多才能正常开发，投资回报率也很难衡量。 而近阶段虽然 AR 技术发展很快，但 5G 手机还刚推出第一批，5G 网络也并未稳定普及，这也是影响 AR 广告现在扩大规模的关键因素——没有与之匹配的设备。另外，比起其它开发多年的其它形式的广告，AR 广告迭代和优化也还不太灵活，并非广告商们信手就可捏来。 <img src="https://img1.tuicool.com/Y3Uz2uV.png!web" alt=""> ▲ 图片来自：unsplash AR 热潮刚刚开始真正起飞，我们现在看到的只是关于 AR 能带来什么以及它能做些什么的一瞥。不过苹果 2017 年推出 ARKit 时，首席执行官蒂姆・库克在 <a href="https://www.mobilemarketer.com/news/mobile-disruptor-of-the-year-augmented-reality/510150/" target="_blank" rel="noopener">财报电话会议上就指出</a> AR 将成为「主流」： 虽然我们现在还只触及冰山一角，但它将永久改变我们使用技术的方式。 而这个未来正在靠近。Digi-Capital <a href="https://www.mobilemarketer.com/news/mobile-disruptor-of-the-year-augmented-reality/510150/" target="_blank" rel="noopener">预计在未来五年内</a> AR 广告的市场价值将达到 830 亿美元。而且下一代移动设备，还会为我们带来更多新的可能性。 折叠手机的柔性屏幕将能让 AR 广告拥有更多形式；内置投影仪的手机，能让 AR 广告用更大的位置呈现，当广告变成了一种看电影的方式，这对广告商也意味着有更多的空间来宣传。 <img src="https://img2.tuicool.com/NzMNNrq.jpg!web" alt=""> ▲ 图片来自： <a href="https://www.satzuma.com/product-page/3d-hologram-visualiser" target="_blank" rel="noopener">satzuma</a> 但无论何种新的形式，接下来，当我们沉迷于自己所选的 AR 广告体验中无法自拔，会不会更加停不下来「买买买」呢？ 我开始觉得这是一篇关于 AR 的沉浸式广告了。 原文：<a href="https://www.ifanr.com/1230440?utm_source=tuicool&amp;utm_medium=referral" target="_blank" rel="noopener">https://www.ifanr.com/1230440</a></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-07-08 00:52:27" itemprop="dateCreated datePublished" datetime="2019-07-08T00:52:27+08:00">2019-07-08</time>
                </span>
                <span id="/6799.html" class="post-meta-item leancloud_visitors" data-flag-title="未来，你可能会主动点开这种广告" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>3.3k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/6797.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 技术杂谈 <i class="label-arrow"></i>
                  </a>
                  <a href="/6797.html" class="post-title-link" itemprop="url">阿里新开发了一款神器，零基础也能轻松做出酷炫动效！</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>阿里作为中国互联网企业的标杆，不仅一直在为广大人民群众提供快捷便利的服务。也不断引领行业，在各个专业领域，给专业人员提供了优质的工具与服务。对设计师而言，无论是每年一度的 UCAN大会，还是 Kitchen、语雀、Ant Design 等设计开发工具，都给广大设计师带来很大的便利。 而最近，阿里又推出了一款基于 Lottie 的动效设计平台 ── 犸良。能够快速生成设计师想要的动态效果，并交付给开发，极大地提高了设计效率和设计还原度。</p>
                  <h4 id="犸良是什么？"><a href="#犸良是什么？" class="headerlink" title="犸良是什么？"></a>犸良是什么？</h4>
                  <p>它是一个积累了很多通用动效素材的平台，让不会动效的同学们也能基于动效库和素材库快速生成一个通用动效创意，你只需要简单地编辑图片、颜色或者文字即可。同时平台集成了以 Lottie 为代表的动效技术，让曾经令人苦恼的安装包大小和性能问题一并解决。 <img src="https://img2.tuicool.com/uQFZNzN.gif" alt=""> △ 官网： <a href="https://design.alipay.com/emotion" target="_blank" rel="noopener">https://design.alipay.com/emotion</a></p>
                  <h4 id="犸良的应用场景"><a href="#犸良的应用场景" class="headerlink" title="犸良的应用场景"></a>犸良的应用场景</h4>
                  <p>犸良支持全平台 iOS、Android、H5、小程序。无论是营销展位、活动页面、空状态还是产品icon。犸良编辑器对接投放平台，一站式完成动效创意制作和投放。 丰富的动效素材能够满足多种场景需要。</p>
                  <h4 id="犸良怎么用？"><a href="#犸良怎么用？" class="headerlink" title="犸良怎么用？"></a>犸良怎么用？</h4>
                  <h4 id="方式一：基于模版直接制作（适用于设计师进行动态banner制作）"><a href="#方式一：基于模版直接制作（适用于设计师进行动态banner制作）" class="headerlink" title="方式一：基于模版直接制作（适用于设计师进行动态banner制作）"></a>方式一：基于模版直接制作（适用于设计师进行动态banner制作）</h4>
                  <ol>
                    <li>选择模版</li>
                    <li>从动画仓库选择动画进行当前动画的替换</li>
                    <li>通过替换图片或修改颜色来自定义动画</li>
                    <li>自定义模板文字内容</li>
                    <li>选择模板背景图片</li>
                    <li>完成编辑选择是否带背景（banner模版默认带背景）</li>
                    <li>导出成功下载 json</li>
                  </ol>
                  <h4 id="方式二：自定义画布制作（适用于设计师进行模板覆盖不到的动效应用场景）"><a href="#方式二：自定义画布制作（适用于设计师进行模板覆盖不到的动效应用场景）" class="headerlink" title="方式二：自定义画布制作（适用于设计师进行模板覆盖不到的动效应用场景）"></a>方式二：自定义画布制作（适用于设计师进行模板覆盖不到的动效应用场景）</h4>
                  <p>使用犸良一分钟做出来的效果，大家感受下： <img src="https://img0.tuicool.com/ZZFjIn3.gif" alt=""> <img src="https://img1.tuicool.com/M7Bjuuy.gif" alt=""></p>
                  <h4 id="体验感受"><a href="#体验感受" class="headerlink" title="体验感受"></a>体验感受</h4>
                  <p>综合体验了一下犸良，相对于鹿班人工智能随意撸图。猛良其实是一款基于人工的动效模板网站。所有的动态效果都是设计师提前做好的。基于 Lottie 的特性，将可编辑的属性进行模块化。 说到这里有些设计师可能有疑问了，Lottie 究竟是什么？在优设已经有相关文章介绍的比较全面了，这里就不赘述了，阅读链接： <a href="http://www.uisdc.com/tag/lottie/" target="_blank" rel="noopener">http://www.uisdc.com/tag/lottie/</a> 。 简言之 Lottie 就是一个快速将 AE 中设计的动效快速调出，并且开发可以直接调用的动效库。 Lottie 的原理是将矢量图形和动态效果通过代码实现，复杂的图形导出图片资源。最终生成 json 文件+图片资源。犸良所做的就是，将 json 里的颜色属性提取出来，用户可以从外部修改。同样只需要替换图片资源，就可以让用户自己设计的图形根据 json 写好的运动方式来展示。如果你把一只移动的猪替换成猫了，那么你看到的效果就是一只移动的猫。 而它的文字编辑功能，我觉得就比较神奇了。因为 Lottie 貌似不能从外部修改字体，应该是阿里自己写的。如果有知道的同学也欢迎解惑。因为我们在实际工作中经常遇到这样的问题，就是如果动效包含文本了，需要适配国际化，就没法从外部修改语言。如果能解决这个问题，将会减少很多麻烦。 从现有的素材来看，其主要应用场景还是电商和运营方面。相信未来会增加更多的素材和应用场景。希望以后能够开放出让设计师可以将自己做的动效分享出来供大家使用，或者提供优质付费内容也是不错的选择。 就个人的工作经验来看，Lottie 还是有丰富的应用场景的。比如可以做动态图标、动态闪屏页、表情贴纸、直播礼物、空白页、动态banner…… 其实 Lottie 官方社区也有很多的动效资源，都是来自全世界的设计师上传的，大家可以去下载参考，如果要商用，可能需要联系作者。 <img src="https://img1.tuicool.com/zuuqe2R.gif" alt=""> △ 附上链接： <a href="https://lottiefiles.com/popular" target="_blank" rel="noopener">https://lottiefiles.com/popular</a> 本文资料，很多都是来自语雀的分享。再次感谢相关人员的辛勤付出。大家可以在此处查看犸良的完整介绍： <a href="https://www.yuque.com/dapolloali/news/ui43vg" target="_blank" rel="noopener">https://www.yuque.com/dapolloali/news/ui43vg</a> 。 再次附上官网： <a href="https://design.alipay.com/emotion" target="_blank" rel="noopener">https://design.alipay.com/emotion</a> 因为犸良是基于 Lottie 的工具，所以有相关基础的设计师很容易上手。还不了解的同学也可以在各大设计网站搜索到。 欢迎关注作者的微信公众号：「懿凡设计」 本文原文：<a href="https://www.uisdc.com/alibaba-emotion" target="_blank" rel="noopener">https://www.uisdc.com/alibaba-emotion</a></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2019-07-08 00:43:19" itemprop="dateCreated datePublished" datetime="2019-07-08T00:43:19+08:00">2019-07-08</time>
                </span>
                <span id="/6797.html" class="post-meta-item leancloud_visitors" data-flag-title="阿里新开发了一款神器，零基础也能轻松做出酷炫动效！" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.7k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <script>
              document.querySelectorAll('.random').forEach(item => item.src = "https://picsum.photos/id/" + Math.floor(Math.random() * Math.floor(300)) + "/200/133")

            </script>
            <nav class="pagination">
              <a class="extend prev" rel="prev" href="/page/8/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/10/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
            </nav>
          </div>
          <script>
            window.addEventListener('tabs:register', () =>
            {
              let
              {
                activeClass
              } = CONFIG.comments;
              if (CONFIG.comments.storage)
              {
                activeClass = localStorage.getItem('comments_active') || activeClass;
              }
              if (activeClass)
              {
                let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
                if (activeTab)
                {
                  activeTab.click();
                }
              }
            });
            if (CONFIG.comments.storage)
            {
              window.addEventListener('tabs:click', event =>
              {
                if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
                let commentClass = event.target.classList[1];
                localStorage.setItem('comments_active', commentClass);
              });
            }

          </script>
        </div>
        <div class="toggle sidebar-toggle">
          <span class="toggle-line toggle-line-first"></span>
          <span class="toggle-line toggle-line-middle"></span>
          <span class="toggle-line toggle-line-last"></span>
        </div>
        <aside class="sidebar">
          <div class="sidebar-inner">
            <ul class="sidebar-nav motion-element">
              <li class="sidebar-nav-toc"> 文章目录 </li>
              <li class="sidebar-nav-overview"> 站点概览 </li>
            </ul>
            <!--noindex-->
            <div class="post-toc-wrap sidebar-panel">
            </div>
            <!--/noindex-->
            <div class="site-overview-wrap sidebar-panel">
              <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <img class="site-author-image" itemprop="image" alt="崔庆才" src="/images/avatar.png">
                <p class="site-author-name" itemprop="name">崔庆才</p>
                <div class="site-description" itemprop="description">静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。</div>
              </div>
              <div class="site-state-wrap motion-element">
                <nav class="site-state">
                  <div class="site-state-item site-state-posts">
                    <a href="/archives/">
                      <span class="site-state-item-count">710</span>
                      <span class="site-state-item-name">日志</span>
                    </a>
                  </div>
                  <div class="site-state-item site-state-categories">
                    <a href="/categories/">
                      <span class="site-state-item-count">43</span>
                      <span class="site-state-item-name">分类</span></a>
                  </div>
                  <div class="site-state-item site-state-tags">
                    <a href="/tags/">
                      <span class="site-state-item-count">260</span>
                      <span class="site-state-item-name">标签</span></a>
                  </div>
                </nav>
              </div>
              <div class="links-of-author motion-element">
                <span class="links-of-author-item">
                  <a href="https://github.com/Germey" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Germey" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
                </span>
                <span class="links-of-author-item">
                  <a href="mailto:cqc@cuiqingcai.com.com" title="邮件 → mailto:cqc@cuiqingcai.com.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>邮件</a>
                </span>
                <span class="links-of-author-item">
                  <a href="https://weibo.com/cuiqingcai" title="微博 → https:&#x2F;&#x2F;weibo.com&#x2F;cuiqingcai" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>微博</a>
                </span>
                <span class="links-of-author-item">
                  <a href="https://www.zhihu.com/people/Germey" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;Germey" rel="noopener" target="_blank"><i class="fa fa-magic fa-fw"></i>知乎</a>
                </span>
              </div>
            </div>
            <div style=" width: 100%;" class="sidebar-panel sidebar-panel-image sidebar-panel-active">
              <a href="https://item.jd.com/13527222.html" target="_blank" rel="noopener">
                <img src="https://cdn.cuiqingcai.com/ei5og.jpg" style=" width: 100%;">
              </a>
            </div>
            <div class="sidebar-panel sidebar-panel-categories sidebar-panel-active">
              <h4 class="name"> 分类 </h4>
              <div class="content">
                <ul class="category-list">
                  <li class="category-list-item"><a class="category-list-link" href="/categories/API/">API</a><span class="category-list-count">6</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/C-C/">C/C++</a><span class="category-list-count">23</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Claude/">Claude</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Gemini/">Gemini</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Google-SERP/">Google SERP</a><span class="category-list-count">2</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/HTML/">HTML</a><span class="category-list-count">14</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">5</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/">JavaScript</a><span class="category-list-count">26</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">14</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Luma/">Luma</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Markdown/">Markdown</a><span class="category-list-count">2</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Midjourney/">Midjourney</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Nano-Banana/">Nano Banana</a><span class="category-list-count">2</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Net/">Net</a><span class="category-list-count">4</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Nexior/">Nexior</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Other/">Other</a><span class="category-list-count">40</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a><span class="category-list-count">27</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Paper/">Paper</a><span class="category-list-count">2</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Producer/">Producer</a><span class="category-list-count">2</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">303</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/SeeDance/">SeeDance</a><span class="category-list-count">5</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/SeeDream/">SeeDream</a><span class="category-list-count">3</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Sora/">Sora</a><span class="category-list-count">2</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/TypeScript/">TypeScript</a><span class="category-list-count">2</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Veo/">Veo</a><span class="category-list-count">3</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/nano-banana/">nano-banana</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E5%B1%95%E7%A4%BA/">个人展示</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E6%97%A5%E8%AE%B0/">个人日记</a><span class="category-list-count">9</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E8%AE%B0%E5%BD%95/">个人记录</a><span class="category-list-count">6</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E9%9A%8F%E7%AC%94/">个人随笔</a><span class="category-list-count">21</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/">人工智能</a><span class="category-list-count">6</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/">安装配置</a><span class="category-list-count">59</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%9D%82%E8%B0%88/">技术杂谈</a><span class="category-list-count">96</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9C%AA%E5%88%86%E7%B1%BB/">未分类</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">深度学习</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E7%88%AC%E8%99%AB/">爬虫</a><span class="category-list-count">4</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E7%94%9F%E6%B4%BB%E7%AC%94%E8%AE%B0/">生活笔记</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E7%A6%8F%E5%88%A9%E4%B8%93%E5%8C%BA/">福利专区</a><span class="category-list-count">6</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E8%81%8C%E4%BD%8D%E6%8E%A8%E8%8D%90/">职位推荐</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E8%89%BA%E6%9C%AF%E4%BA%8C%E7%BB%B4%E7%A0%81/">艺术二维码</a><span class="category-list-count">1</span></li>
                </ul>
              </div>
            </div>
            <div class="sidebar-panel sidebar-panel-friends sidebar-panel-active">
              <h4 class="name"> 友情链接 </h4>
              <ul class="friends">
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/j2dub.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.findhao.net/" target="_blank" rel="noopener">FindHao</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/6apxu.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.51dev.com/" target="_blank" rel="noopener">IT技术社区</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/bqlbs.png">
                  </span>
                  <span class="link">
                    <a href="http://www.urselect.com/" target="_blank" rel="noopener">优社电商</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/8s88c.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.yuanrenxue.com/" target="_blank" rel="noopener">猿人学</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/2wgg5.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.yunlifang.cn/" target="_blank" rel="noopener">云立方</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="http://qianxunclub.com/favicon.png">
                  </span>
                  <span class="link">
                    <a href="http://qianxunclub.com/" target="_blank" rel="noopener">千寻啊千寻</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/0044u.jpg">
                  </span>
                  <span class="link">
                    <a href="http://kodcloud.com/" target="_blank" rel="noopener">可道云</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/ygnpn.jpg">
                  </span>
                  <span class="link">
                    <a href="http://www.kunkundashen.cn/" target="_blank" rel="noopener">坤坤大神</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/x714o.jpg">
                  </span>
                  <span class="link">
                    <a href="http://www.hubwiz.com/" target="_blank" rel="noopener">汇智网</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/44hxf.png">
                  </span>
                  <span class="link">
                    <a href="http://redstonewill.com/" target="_blank" rel="noopener">红色石头</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/wkaus.jpg">
                  </span>
                  <span class="link">
                    <a href="https://zhaoshuai.me/" target="_blank" rel="noopener">碎念</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/pgo0r.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.chenwenguan.com/" target="_blank" rel="noopener">陈文管的博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/kk82a.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.lxlinux.net/" target="_blank" rel="noopener">良许Linux教程网</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/lj0t2.jpg">
                  </span>
                  <span class="link">
                    <a href="https://tanqingbo.cn/" target="_blank" rel="noopener">IT码农</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/i8cdr.png">
                  </span>
                  <span class="link">
                    <a href="https://junyiseo.com/" target="_blank" rel="noopener">均益个人博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/chwv2.png">
                  </span>
                  <span class="link">
                    <a href="https://brucedone.com/" target="_blank" rel="noopener">大鱼的鱼塘</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://www.91vps.com/favicon.ico">
                  </span>
                  <span class="link">
                    <a href="http://www.91vps.com/" target="_blank" rel="noopener">91VPS</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://webpage.qidian.qq.com/qidian/chatv3-gray/favicon.ico">
                  </span>
                  <span class="link">
                    <a href="https://www.qg.net/" target="_blank" rel="noopener">青果网络</a>
                  </span>
                </li>
              </ul>
            </div>
            <div class="sidebar-panel sidebar-panel-tags sidebar-panel-active">
              <h4 class="name"> 标签云 </h4>
              <div class="content">
                <a href="/tags/2022/" style="font-size: 20px;">2022</a> <a href="/tags/2048/" style="font-size: 10px;">2048</a> <a href="/tags/ACE-Data/" style="font-size: 13px;">ACE Data</a> <a href="/tags/ADSL/" style="font-size: 10px;">ADSL</a> <a href="/tags/AI%E7%BC%96%E7%A8%8B/" style="font-size: 10px;">AI编程</a> <a href="/tags/API/" style="font-size: 19px;">API</a> <a href="/tags/Ajax/" style="font-size: 12px;">Ajax</a> <a href="/tags/Audios/" style="font-size: 11px;">Audios</a> <a href="/tags/Bootstrap/" style="font-size: 11px;">Bootstrap</a> <a href="/tags/Bug/" style="font-size: 10px;">Bug</a> <a href="/tags/CDN/" style="font-size: 10px;">CDN</a> <a href="/tags/CQC/" style="font-size: 10px;">CQC</a> <a href="/tags/CSS/" style="font-size: 10px;">CSS</a> <a href="/tags/CSS-%E5%8F%8D%E7%88%AC%E8%99%AB/" style="font-size: 10px;">CSS 反爬虫</a> <a href="/tags/CV/" style="font-size: 10px;">CV</a> <a href="/tags/ChatGPT/" style="font-size: 10px;">ChatGPT</a> <a href="/tags/Cookie/" style="font-size: 10px;">Cookie</a> <a href="/tags/Django/" style="font-size: 10px;">Django</a> <a href="/tags/Eclipse/" style="font-size: 11px;">Eclipse</a> <a href="/tags/Elasticsearch/" style="font-size: 10px;">Elasticsearch</a> <a href="/tags/FTP/" style="font-size: 10px;">FTP</a> <a href="/tags/Flux/" style="font-size: 10px;">Flux</a> <a href="/tags/Gemini/" style="font-size: 10px;">Gemini</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/GitHub/" style="font-size: 13px;">GitHub</a> <a href="/tags/Google-SERP/" style="font-size: 11px;">Google SERP</a> <a href="/tags/HTML5/" style="font-size: 10px;">HTML5</a> <a href="/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="/tags/Hailuo/" style="font-size: 10px;">Hailuo</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/Hook/" style="font-size: 10px;">Hook</a> <a href="/tags/IP/" style="font-size: 10px;">IP</a> <a href="/tags/IT/" style="font-size: 10px;">IT</a> <a href="/tags/Images/" style="font-size: 11px;">Images</a> <a href="/tags/JSON/" style="font-size: 10px;">JSON</a> <a href="/tags/JSP/" style="font-size: 10px;">JSP</a> <a href="/tags/JavaScript/" style="font-size: 14px;">JavaScript</a> <a href="/tags/K8s/" style="font-size: 10px;">K8s</a> <a href="/tags/LOGO/" style="font-size: 10px;">LOGO</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/Luma/" style="font-size: 10px;">Luma</a> <a href="/tags/MIUI/" style="font-size: 10px;">MIUI</a> <a href="/tags/Markdown/" style="font-size: 10px;">Markdown</a> <a href="/tags/Midjourney/" style="font-size: 12px;">Midjourney</a> <a href="/tags/MongoDB/" style="font-size: 11px;">MongoDB</a> <a href="/tags/MySQL/" style="font-size: 10px;">MySQL</a> <a href="/tags/Mysql/" style="font-size: 10px;">Mysql</a> <a href="/tags/NBA/" style="font-size: 10px;">NBA</a> <a href="/tags/Nano-Banana/" style="font-size: 11px;">Nano Banana</a> <a href="/tags/Nexior/" style="font-size: 10px;">Nexior</a> <a href="/tags/OCR/" style="font-size: 10px;">OCR</a> <a href="/tags/OpenCV/" style="font-size: 10px;">OpenCV</a> <a href="/tags/PHP/" style="font-size: 11px;">PHP</a> <a href="/tags/PPT/" style="font-size: 10px;">PPT</a> <a href="/tags/PS/" style="font-size: 10px;">PS</a> <a href="/tags/Pathlib/" style="font-size: 10px;">Pathlib</a> <a href="/tags/PhantomJS/" style="font-size: 10px;">PhantomJS</a> <a href="/tags/Playwright/" style="font-size: 10px;">Playwright</a> <a href="/tags/Producer/" style="font-size: 11px;">Producer</a> <a href="/tags/Python/" style="font-size: 16px;">Python</a> <a href="/tags/Python-%E7%88%AC%E8%99%AB/" style="font-size: 17px;">Python 爬虫</a> <a href="/tags/Python3/" style="font-size: 11px;">Python3</a> <a href="/tags/Python3%E7%88%AC%E8%99%AB%E6%95%99%E7%A8%8B/" style="font-size: 12px;">Python3爬虫教程</a> <a href="/tags/Pythonic/" style="font-size: 10px;">Pythonic</a> <a href="/tags/Python%E7%88%AC%E8%99%AB/" style="font-size: 18px;">Python爬虫</a> <a href="/tags/Python%E7%88%AC%E8%99%AB%E4%B9%A6/" style="font-size: 12px;">Python爬虫书</a> <a href="/tags/Python%E7%88%AC%E8%99%AB%E6%95%99%E7%A8%8B/" style="font-size: 15px;">Python爬虫教程</a> <a href="/tags/QQ/" style="font-size: 10px;">QQ</a> <a href="/tags/RabbitMQ/" style="font-size: 10px;">RabbitMQ</a> <a href="/tags/ReCAPTCHA/" style="font-size: 10px;">ReCAPTCHA</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/Riffusion/" style="font-size: 11px;">Riffusion</a> <a href="/tags/SAE/" style="font-size: 10px;">SAE</a> <a href="/tags/SSH/" style="font-size: 10px;">SSH</a> <a href="/tags/SVG/" style="font-size: 10px;">SVG</a> <a href="/tags/Scrapy-redis/" style="font-size: 10px;">Scrapy-redis</a> <a href="/tags/Scrapy%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 10px;">Scrapy分布式</a> <a href="/tags/SeeDance/" style="font-size: 14px;">SeeDance</a> <a href="/tags/SeeDream/" style="font-size: 12px;">SeeDream</a> <a href="/tags/Selenium/" style="font-size: 11px;">Selenium</a> <a href="/tags/Session/" style="font-size: 10px;">Session</a> <a href="/tags/Shell/" style="font-size: 10px;">Shell</a> <a href="/tags/Sora/" style="font-size: 10px;">Sora</a> <a href="/tags/Sora2/" style="font-size: 11px;">Sora2</a> <a href="/tags/Suno/" style="font-size: 11px;">Suno</a> <a href="/tags/TKE/" style="font-size: 10px;">TKE</a> <a href="/tags/TXT/" style="font-size: 10px;">TXT</a> <a href="/tags/Terminal/" style="font-size: 10px;">Terminal</a> <a href="/tags/Ubuntu/" style="font-size: 11px;">Ubuntu</a> <a href="/tags/VS-Code/" style="font-size: 10px;">VS Code</a> <a href="/tags/Veo/" style="font-size: 13px;">Veo</a> <a href="/tags/Vercel/" style="font-size: 10px;">Vercel</a> <a href="/tags/Videos/" style="font-size: 12px;">Videos</a> <a href="/tags/Vs-Code/" style="font-size: 10px;">Vs Code</a> <a href="/tags/Vue/" style="font-size: 11px;">Vue</a> <a href="/tags/Web/" style="font-size: 10px;">Web</a> <a href="/tags/Webpack/" style="font-size: 10px;">Webpack</a> <a href="/tags/Web%E7%BD%91%E9%A1%B5/" style="font-size: 10px;">Web网页</a> <a href="/tags/Windows/" style="font-size: 10px;">Windows</a> <a href="/tags/Winpcap/" style="font-size: 10px;">Winpcap</a>
              </div>
              <script>
                const tagsColors = ['#00a67c', '#5cb85c', '#d9534f', '#567e95', '#b37333', '#f4843d', '#15a287']
                const tagsElements = document.querySelectorAll('.sidebar-panel-tags .content a')
                tagsElements.forEach((item) =>
                {
                  item.style.backgroundColor = tagsColors[Math.floor(Math.random() * tagsColors.length)]
                })

              </script>
            </div>
          </div>
        </aside>
        <div id="sidebar-dimmer"></div>
      </div>
    </main>
    <footer class="footer">
      <div class="footer-inner">
        <div class="copyright">
          <span class="author" itemprop="copyrightHolder">崔庆才丨静觅</span> &copy; <span itemprop="copyrightYear">2026</span>
          <span class="with-love">
            <i class="fa fa-heart"></i>
          </span>
          <a href="https://cuiqingcai.com/sitemap.xml" style="display:none" title="爬虫教程" target="_blank"><strong>爬虫教程</strong></a>
          <a href="https://cuiqingcai.com/sitemap.html" style="display:none" title="爬虫教程" target="_blank"><strong>爬虫教程</strong></a>
          <span class="post-meta-divider">|</span>
          <span class="post-meta-item-icon">
            <i class="fa fa-chart-area"></i>
          </span>
          <span title="站点总字数">3.5m</span>
          <span class="post-meta-divider">|</span>
          <span class="post-meta-item-icon">
            <i class="fa fa-coffee"></i>
          </span>
          <span title="站点阅读时长">52:30</span>
        </div>
        <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动 </div>
        <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">京ICP备18015597号-1 </a>
        </div>
        <script>
          (function ()
          {
            function leancloudSelector(url)
            {
              url = encodeURI(url);
              return document.getElementById(url).querySelector('.leancloud-visitors-count');
            }

            function addCount(Counter)
            {
              var visitors = document.querySelector('.leancloud_visitors');
              var url = decodeURI(visitors.id);
              var title = visitors.dataset.flagTitle;
              Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify(
              {
                url
              }))).then(response => response.json()).then((
              {
                results
              }) =>
              {
                if (results.length > 0)
                {
                  var counter = results[0];
                  leancloudSelector(url).innerText = counter.time + 1;
                  Counter('put', '/classes/Counter/' + counter.objectId,
                  {
                    time:
                    {
                      '__op': 'Increment',
                      'amount': 1
                    }
                  }).catch(error =>
                  {
                    console.error('Failed to save visitor count', error);
                  });
                }
                else
                {
                  Counter('post', '/classes/Counter',
                  {
                    title,
                    url,
                    time: 1
                  }).then(response => response.json()).then(() =>
                  {
                    leancloudSelector(url).innerText = 1;
                  }).catch(error =>
                  {
                    console.error('Failed to create', error);
                  });
                }
              }).catch(error =>
              {
                console.error('LeanCloud Counter Error', error);
              });
            }

            function showTime(Counter)
            {
              var visitors = document.querySelectorAll('.leancloud_visitors');
              var entries = [...visitors].map(element =>
              {
                return decodeURI(element.id);
              });
              Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify(
              {
                url:
                {
                  '$in': entries
                }
              }))).then(response => response.json()).then((
              {
                results
              }) =>
              {
                for (let url of entries)
                {
                  let target = results.find(item => item.url === url);
                  leancloudSelector(url).innerText = target ? target.time : 0;
                }
              }).catch(error =>
              {
                console.error('LeanCloud Counter Error', error);
              });
            }
            let
            {
              app_id,
              app_key,
              server_url
            } = {
              "enable": true,
              "app_id": "6X5dRQ0pnPWJgYy8SXOg0uID-gzGzoHsz",
              "app_key": "ziLDVEy73ne5HtFTiGstzHMS",
              "server_url": "https://6x5drq0p.lc-cn-n1-shared.com",
              "security": false
            };

            function fetchData(api_server)
            {
              var Counter = (method, url, data) =>
              {
                return fetch(`${api_server}/1.1${url}`,
                {
                  method,
                  headers:
                  {
                    'X-LC-Id': app_id,
                    'X-LC-Key': app_key,
                    'Content-Type': 'application/json',
                  },
                  body: JSON.stringify(data)
                });
              };
              if (CONFIG.page.isPost)
              {
                if (CONFIG.hostname !== location.hostname) return;
                addCount(Counter);
              }
              else if (document.querySelectorAll('.post-title-link').length >= 1)
              {
                showTime(Counter);
              }
            }
            let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;
            if (api_server)
            {
              fetchData(api_server);
            }
            else
            {
              fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id).then(response => response.json()).then((
              {
                api_server
              }) =>
              {
                fetchData('https://' + api_server);
              });
            }
          })();

        </script>
      </div>
      <div class="footer-stat">
        <span id="cnzz_stat_icon_1279355174"></span>
        <script type="text/javascript">
          document.write(unescape("%3Cspan id='cnzz_stat_icon_1279355174'%3E%3C/span%3E%3Cscript src='https://v1.cnzz.com/z_stat.php%3Fid%3D1279355174%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"));

        </script>
      </div>
    </footer>
  </div>
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script src="/js/utils.js"></script>
  <script src="/.js"></script>
  <script src="/js/schemes/pisces.js"></script>
  <script src="/.js"></script>
  <script src="/js/next-boot.js"></script>
  <script src="/.js"></script>
  <script>
    (function ()
    {
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x = document.getElementsByTagName("link");
      //Find the last canonical URL
      if (x.length > 0)
      {
        for (i = 0; i < x.length; i++)
        {
          if (x[i].rel.toLowerCase() == 'canonical' && x[i].href)
          {
            canonicalURL = x[i].href;
          }
        }
      }
      //Get protocol
      if (!canonicalURL)
      {
        curProtocol = window.location.protocol.split(':')[0];
      }
      else
      {
        curProtocol = canonicalURL.split(':')[0];
      }
      //Get current URL if the canonical URL does not exist
      if (!canonicalURL) canonicalURL = window.location.href;
      //Assign script content. Replace current URL with the canonical URL
      ! function ()
      {
        var e = /([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,
          r = canonicalURL,
          t = document.referrer;
        if (!e.test(r))
        {
          var n = (String(curProtocol).toLowerCase() === 'https') ? "https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif" : "//api.share.baidu.com/s.gif";
          t ? (n += "?r=" + encodeURIComponent(document.referrer), r && (n += "&l=" + r)) : r && (n += "?l=" + r);
          var i = new Image;
          i.src = n
        }
      }(window);
    })();

  </script>
  <script src="/js/local-search.js"></script>
  <script src="/.js"></script>
</body>

</html>
