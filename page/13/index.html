<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
  <meta name="theme-color" content="#222">
  <meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>
  <script id="hexo-configurations">
    var NexT = window.NexT ||
    {};
    var CONFIG = {
      "hostname": "cuiqingcai.com",
      "root": "/",
      "scheme": "Pisces",
      "version": "7.8.0",
      "exturl": false,
      "sidebar":
      {
        "position": "right",
        "width": 360,
        "display": "post",
        "padding": 18,
        "offset": 12,
        "onmobile": false,
        "widgets": [
          {
            "type": "image",
            "name": "阿布云",
            "enable": false,
            "url": "https://www.abuyun.com/http-proxy/introduce.html",
            "src": "https://cdn.cuiqingcai.com/88au8.jpg",
            "width": "100%"
      },
          {
            "type": "image",
            "name": "爬虫书",
            "url": "https://item.jd.com/13527222.html",
            "src": "https://cdn.cuiqingcai.com/ei5og.jpg",
            "width": "100%",
            "enable": true
      },
          {
            "type": "categories",
            "name": "分类",
            "enable": true
      },
          {
            "type": "image",
            "name": "IPIDEA",
            "url": "http://www.ipidea.net/?utm-source=cqc&utm-keyword=?cqc",
            "src": "https://cdn.cuiqingcai.com/0ywun.png",
            "width": "100%",
            "enable": false
      },
          {
            "type": "image",
            "name": "Storm Proxies",
            "src": "https://cdn.cuiqingcai.com/a2zad8.png",
            "url": "https://www.stormproxies.cn/?keyword=jingmi",
            "width": "100%",
            "enable": false
      },
          {
            "type": "friends",
            "name": "友情链接",
            "enable": true
      },
          {
            "type": "hot",
            "name": "猜你喜欢",
            "enable": true
      },
          {
            "type": "tags",
            "name": "标签云",
            "enable": true
      }]
      },
      "copycode":
      {
        "enable": true,
        "show_result": true,
        "style": "mac"
      },
      "back2top":
      {
        "enable": true,
        "sidebar": false,
        "scrollpercent": true
      },
      "bookmark":
      {
        "enable": false,
        "color": "#222",
        "save": "auto"
      },
      "fancybox": false,
      "mediumzoom": false,
      "lazyload": false,
      "pangu": true,
      "comments":
      {
        "style": "tabs",
        "active": "gitalk",
        "storage": true,
        "lazyload": false,
        "nav": null,
        "activeClass": "gitalk"
      },
      "algolia":
      {
        "hits":
        {
          "per_page": 10
        },
        "labels":
        {
          "input_placeholder": "Search for Posts",
          "hits_empty": "We didn't find any results for the search: ${query}",
          "hits_stats": "${hits} results found in ${time} ms"
        }
      },
      "localsearch":
      {
        "enable": true,
        "trigger": "auto",
        "top_n_per_article": 10,
        "unescape": false,
        "preload": false
      },
      "motion":
      {
        "enable": false,
        "async": false,
        "transition":
        {
          "post_block": "bounceDownIn",
          "post_header": "slideDownIn",
          "post_body": "slideDownIn",
          "coll_header": "slideLeftIn",
          "sidebar": "slideUpIn"
        }
      },
      "path": "search.xml"
    };

  </script>
  <meta name="keywords" content="爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书,静觅,崔庆才">
  <meta name="robots" content="index,follow">
  <meta name="GOOGLEBOT" content="index,follow">
  <meta name="author" content="静觅丨崔庆才的个人站点">
  <meta name="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  <meta property="og:type" content="website">
  <meta property="og:title" content="静觅">
  <meta property="og:url" content="https://cuiqingcai.com/page/13/index.html">
  <meta property="og:site_name" content="静觅">
  <meta property="og:description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  <meta property="og:locale" content="zh_CN">
  <meta property="article:author" content="崔庆才">
  <meta property="article:tag" content="爬虫教程">
  <meta property="article:tag" content="爬虫">
  <meta property="article:tag" content="Python">
  <meta property="article:tag" content="Python爬虫">
  <meta property="article:tag" content="Python爬虫教程">
  <meta property="article:tag" content="爬虫书">
  <meta property="article:tag" content="静觅">
  <meta property="article:tag" content="崔庆才">
  <meta name="twitter:card" content="summary">
  <link rel="canonical" href="https://cuiqingcai.com/page/13/">
  <script id="page-configurations">
    // https://hexo.io/docs/variables.html
    CONFIG.page = {
      sidebar: "",
      isHome: true,
      isPost: false,
      lang: 'zh-CN'
    };

  </script>
  <title>静觅丨崔庆才的个人站点 - Python爬虫教程</title>
  <meta name="google-site-verification" content="p_bIcnvirkFzG2dYKuNDivKD8-STet5W7D-01woA2fc" />
  <meta name="sogou_site_verification" content="kBOV53NQqT" />
  <noscript>
    <style>
      .use-motion .brand,
      .use-motion .menu-item,
      .sidebar-inner,
      .use-motion .post-block,
      .use-motion .pagination,
      .use-motion .comments,
      .use-motion .post-header,
      .use-motion .post-body,
      .use-motion .collection-header
      {
        opacity: initial;
      }

      .use-motion .site-title,
      .use-motion .site-subtitle
      {
        opacity: initial;
        top: initial;
      }

      .use-motion .logo-line-before i
      {
        left: initial;
      }

      .use-motion .logo-line-after i
      {
        right: initial;
      }

    </style>
  </noscript>
  <link rel="alternate" href="/atom.xml" title="静觅" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner">
        <div class="site-brand-container">
          <div class="site-nav-toggle">
            <div class="toggle" aria-label="切换导航栏">
              <span class="toggle-line toggle-line-first"></span>
              <span class="toggle-line toggle-line-middle"></span>
              <span class="toggle-line toggle-line-last"></span>
            </div>
          </div>
          <div class="site-meta">
            <a href="/" class="brand" rel="start">
              <span class="logo-line-before"><i></i></span>
              <h1 class="site-title">静觅 <span class="site-subtitle"> 崔庆才的个人站点 - Python爬虫教程 </span>
              </h1>
              <span class="logo-line-after"><i></i></span>
            </a>
          </div>
          <div class="site-nav-right">
            <div class="toggle popup-trigger">
              <i class="fa fa-search fa-fw fa-lg"></i>
            </div>
          </div>
        </div>
        <nav class="site-nav">
          <ul id="menu" class="main-menu menu">
            <li class="menu-item menu-item-home">
              <a href="/" rel="section">首页</a>
            </li>
            <li class="menu-item menu-item-archives">
              <a href="/archives/" rel="section">文章列表</a>
            </li>
            <li class="menu-item menu-item-tags">
              <a href="/tags/" rel="section">文章标签</a>
            </li>
            <li class="menu-item menu-item-categories">
              <a href="/categories/" rel="section">文章分类</a>
            </li>
            <li class="menu-item menu-item-about">
              <a href="/about/" rel="section">关于博主</a>
            </li>
            <li class="menu-item menu-item-message">
              <a href="/message/" rel="section">给我留言</a>
            </li>
            <li class="menu-item menu-item-search">
              <a role="button" class="popup-trigger">搜索 </a>
            </li>
          </ul>
        </nav>
        <div class="search-pop-overlay">
          <div class="popup search-popup">
            <div class="search-header">
              <span class="search-icon">
                <i class="fa fa-search"></i>
              </span>
              <div class="search-input-container">
                <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input">
              </div>
              <span class="popup-btn-close">
                <i class="fa fa-times-circle"></i>
              </span>
            </div>
            <div id="search-result">
              <div id="no-result">
                <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>
    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
      <span>0%</span>
    </div>
    <div class="reading-progress-bar"></div>
    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div class="content index posts-expand">
            <div class="carousel">
              <div id="wowslider-container">
                <div class="ws_images">
                  <ul>
                    <li><a target="_blank" href="https://item.jd.com/13527222.html"><img title="Python3网络爬虫开发实战（第二版）上市了！" src="https://cdn.cuiqingcai.com/prwgs.png" /></a></li>
                    <li><a target="_blank" href="https://t.lagou.com/fRCBRsRCSN6FA"><img title="52讲轻松搞定网络爬虫" src="https://cdn.cuiqingcai.com/fqq5e.png" /></a></li>
                    <li><a target="_blank" href="https://cuiqingcai.com/4320.html"><img title="Python3网络爬虫开发视频教程" src="https://cdn.cuiqingcai.com/bjrny.jpg" /></a></li>
                    <li><a target="_blank" href="https://cuiqingcai.com/5094.html"><img title="爬虫代理哪家强？十大付费代理详细对比评测出炉！" src="https://cdn.cuiqingcai.com/nifs6.jpg" /></a></li>
                  </ul>
                </div>
                <div class="ws_thumbs">
                  <div>
                    <a target="_blank" href="#"><img src="https://cdn.cuiqingcai.com/prwgs.png" /></a>
                    <a target="_blank" href="#"><img src="https://cdn.cuiqingcai.com/fqq5e.png" /></a>
                    <a target="_blank" href="#"><img src="https://cdn.cuiqingcai.com/bjrny.jpg" /></a>
                    <a target="_blank" href="#"><img src="https://cdn.cuiqingcai.com/nifs6.jpg" /></a>
                  </div>
                </div>
                <div class="ws_shadow"></div>
              </div>
            </div>
            <link rel="stylesheet" href="/lib/wowslide/slide.css">
            <script src="/lib/wowslide/jquery.min.js"></script>
            <script src="/lib/wowslide/slider.js"></script>
            <script>
              jQuery("#wowslider-container").wowSlider(
              {
                effect: "cube",
                prev: "",
                next: "",
                duration: 20 * 100,
                delay: 100 * 100,
                width: 716,
                height: 297,
                autoPlay: true,
                playPause: true,
                stopOnHover: false,
                loop: false,
                bullets: 0,
                caption: true,
                captionEffect: "slide",
                controls: true,
                onBeforeStep: 0,
                images: 0
              });

            </script>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5219.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5219.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 1.4.3-Redis的安装</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>Redis 是一个基于内存的高效的非关系型数据库，本节中我们来了解一下它在各个平台的安装过程。</p>
                  <h2 id="1-相关链接"><a href="#1-相关链接" class="headerlink" title="1. 相关链接"></a>1. 相关链接</h2>
                  <ul>
                    <li>官方网站：<a href="https://redis.io/" target="_blank" rel="noopener">https://redis.io</a></li>
                    <li>官方文档：<a href="https://redis.io/documentation" target="_blank" rel="noopener">https://redis.io/documentation</a></li>
                    <li>中文官网：<a href="http://www.redis.cn/" target="_blank" rel="noopener">http://www.redis.cn</a></li>
                    <li>GitHub：<a href="https://github.com/antirez/redis" target="_blank" rel="noopener">https://github.com/antirez/redis</a></li>
                    <li>中文教程：<a href="http://www.runoob.com/redis/redis-tutorial.html" target="_blank" rel="noopener">http://www.runoob.com/redis/redis-tutorial.html</a></li>
                    <li>Redis Desktop Manager：<a href="https://redisdesktop.com/" target="_blank" rel="noopener">https://redisdesktop.com</a></li>
                    <li>Redis Desktop Manager GitHub：<a href="https://github.com/uglide/RedisDesktopManager" target="_blank" rel="noopener">https://github.com/uglide/RedisDesktopManager</a></li>
                  </ul>
                  <h2 id="2-Windows-下的安装"><a href="#2-Windows-下的安装" class="headerlink" title="2. Windows 下的安装"></a>2. Windows 下的安装</h2>
                  <p>在 Windows 下，Redis 可以直接到 GitHub 的发行版本里面下载，具体下载地址是<a href="https://github.com/MSOpenTech/redis/releases" target="_blank" rel="noopener">https://github.com/MSOpenTech/redis/releases</a>。</p>
                  <p>打开下载页面后，会发现有许多发行版本及其安装包，如图 1-39 所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/02/1-39.jpg" alt="">图 1-39 下载页面</p>
                  <p>可以下载 Redis-x64-3.2.100.msi 安装即可。</p>
                  <p>安装过程比较简单，直接点击 Next 按钮安装即可。安装完成后，Redis 便会启动。</p>
                  <p>在系统服务页面里，可以观察到多了一个正在运行到 Redis 服务，如图 1-40 所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/02/1-40.jpg" alt="">图 1-40 系统服务页面</p>
                  <p>另外，推荐下载 Redis Desktop Manager 可视化管理工具，来管理 Redis。这既可以到官方网站（链接为：<a href="https://redisdesktop.com/download" target="_blank" rel="noopener">https://redisdesktop.com/download</a>）下载，也可以到 GitHub（链接为：<a href="https://github.com/uglide/RedisDesktopManager/releases" target="_blank" rel="noopener">https://github.com/uglide/RedisDesktopManager/releases</a>）下载最新发行版本。</p>
                  <p>安装后，直接连接本地 Redis 即可。</p>
                  <h2 id="3-Linux-下的安装"><a href="#3-Linux-下的安装" class="headerlink" title="3. Linux 下的安装"></a>3. Linux 下的安装</h2>
                  <p>这里依然分为两类平台来介绍。</p>
                  <h3 id="Ubuntu、Debian-和-Deepin"><a href="#Ubuntu、Debian-和-Deepin" class="headerlink" title="Ubuntu、Debian 和 Deepin"></a>Ubuntu、Debian 和 Deepin</h3>
                  <p>在 Ubuntu、Debian 和 Deepin 系统下，使用<code>apt-get</code>命令安装 Redis：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-<span class="keyword">get</span> -y install redis-<span class="keyword">server</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后输入<code>redis-cli</code>进入 Redis 命令行模式：</p>
                  <figure class="highlight accesslog">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">$ redis-cli</span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; set 'name' 'Germey'</span><br><span class="line">OK</span><br><span class="line"><span class="number">127.0.0.1:6379</span>&gt; get 'name'</span><br><span class="line"><span class="string">"Germey"</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就证明 Redis 成功安装了，但是现在 Redis 还是无法远程连接的，依然需要修改配置文件，配置文件的路径为/etc/redis/redis.conf。</p>
                  <p>首先，注释这一行：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">bind <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外，推荐给 Redis 设置密码，取消注释这一行：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">requirepass foobared</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><code>foobared</code>即当前密码，可以自行修改。</p>
                  <p>然后重启 Redis 服务，使用的命令如下：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo /etc/init.d/redis-<span class="keyword">server</span> <span class="keyword">restart</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>现在就可以使用密码远程连接 Redis 了。</p>
                  <p>另外，停止和启动 Redis 服务的命令分别如下：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo /etc/init.d/redis-<span class="keyword">server</span> stop</span><br><span class="line">sudo /etc/init.d/redis-<span class="keyword">server</span> <span class="keyword">start</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="CentOS-和-Red-Hat"><a href="#CentOS-和-Red-Hat" class="headerlink" title="CentOS 和 Red Hat"></a>CentOS 和 Red Hat</h3>
                  <p>在 CentOS 和 Red Hat 系统中，首先添加 EPEL 仓库，然后更新 yum 源：</p>
                  <figure class="highlight sql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo yum <span class="keyword">install</span> epel-<span class="keyword">release</span></span><br><span class="line">sudo yum <span class="keyword">update</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后安装 Redis 数据库：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo yum -y <span class="keyword">install</span> redis</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>安装好后启动 Redis 服务即可：</p>
                  <figure class="highlight crmsh">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo systemctl <span class="literal">start</span> redis</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里同样可以使用<code>redis-cli</code>进入 Redis 命令行模式操作。</p>
                  <p>另外，为了可以使 Redis 能被远程连接，需要修改配置文件，路径为/etc/redis.conf。</p>
                  <p>参见上文来修改配置文件实现远程连接和密码配置。</p>
                  <p>修改完成之后保存。</p>
                  <p>然后重启 Redis 服务即可，命令如下：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">sudo systemctl restart redis</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="4-Mac-下的安装"><a href="#4-Mac-下的安装" class="headerlink" title="4. Mac 下的安装"></a>4. Mac 下的安装</h2>
                  <p>这里推荐使用 Homebrew 安装，直接执行如下命令即可：</p>
                  <figure class="highlight mipsasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">brew </span><span class="keyword">install </span>redis</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>启动 Redis 服务的命令如下：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">brew services <span class="keyword">start</span> redis</span><br><span class="line">redis-<span class="keyword">server</span> /usr/<span class="keyword">local</span>/etc/redis.conf</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里同样可以使用<code>redis-cli</code>进入 Redis 命令行模式。</p>
                  <p>在 Mac 下 Redis 的配置文件路径是/usr/local/etc/redis.conf，可以通过修改它来配置访问密码。</p>
                  <p>修改配置文件后，需要重启 Redis 服务。停止和重启 Redis 服务的命令分别如下：</p>
                  <figure class="highlight armasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">brew </span>services stop redis</span><br><span class="line"><span class="keyword">brew </span>services restart redis</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外，在 Mac 下也可以安装 Redis Desktop Manager 可视化管理工具来管理 Redis。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-25 15:24:32" itemprop="dateCreated datePublished" datetime="2018-01-25T15:24:32+08:00">2018-01-25</time>
                </span>
                <span id="/5219.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 1.4.3-Redis的安装" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5205.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5205.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 1.4.2-MongoDB安装</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="更新-2020-3-8"><a href="#更新-2020-3-8" class="headerlink" title="更新 2020/3/8"></a>更新 2020/3/8</h2>
                  <p>MongoDB 现在已经出到了 4.x 版本，下面的安装教程是基于 3.x 版本，可能已经过期。</p>
                  <p>关于 4.x 的安装教程，可以参考如下内容：</p>
                  <ul>
                    <li><a href="https://juejin.im/post/5d525b1af265da03b31bc2d5" target="_blank" rel="noopener">https://juejin.im/post/5d525b1af265da03b31bc2d5</a></li>
                    <li><a href="https://www.cnblogs.com/TM0831/p/10606624.html" target="_blank" rel="noopener">https://www.cnblogs.com/TM0831/p/10606624.html</a></li>
                    <li><a href="https://www.cnblogs.com/georgeleoo/p/11479409.html" target="_blank" rel="noopener">https://www.cnblogs.com/georgeleoo/p/11479409.html</a></li>
                  </ul>
                  <hr>
                  <p>以下为原文：</p>
                  <p>MongoDB 是由 C++语言编写的非关系型数据库，是一个基于分布式文件存储的开源数据库系统，其内容存储形式类似 JSON 对象，它的字段值可以包含其他文档、数组及文档数组，非常灵活。</p>
                  <p>MongoDB 支持多种平台，包括 Windows、Linux、Mac OS、Solaris 等，在其官方网站（<a href="https://www.mongodb.com/download-center" target="_blank" rel="noopener">https://www.mongodb.com/download-center</a>）均可找到对应的安装包。</p>
                  <p>本节中，我们来看下它的安装过程。</p>
                  <h2 id="1-相关链接"><a href="#1-相关链接" class="headerlink" title="1. 相关链接"></a>1. 相关链接</h2>
                  <ul>
                    <li>官方网站：<a href="https://www.mongodb.com/" target="_blank" rel="noopener">https://www.mongodb.com</a></li>
                    <li>官方文档：<a href="https://docs.mongodb.com/" target="_blank" rel="noopener">https://docs.mongodb.com</a></li>
                    <li>GitHub：<a href="https://github.com/mongodb" target="_blank" rel="noopener">https://github.com/mongodb</a></li>
                    <li>中文教程：<a href="http://www.runoob.com/mongodb/mongodb-tutorial.html" target="_blank" rel="noopener">http://www.runoob.com/mongodb/mongodb-tutorial.html</a></li>
                  </ul>
                  <h2 id="2-Windows-下的安装"><a href="#2-Windows-下的安装" class="headerlink" title="2. Windows 下的安装"></a>2. Windows 下的安装</h2>
                  <p>这里直接在官网（如图 1-29 所示）点击 DOWNLOAD 按钮下载 msi 安装包即可。</p>
                  <p><img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/02/1-29.jpg" alt="">图 1-29 MongoDB 官网</p>
                  <p>下载完成后，双击它开始安装，指定 MongoDB 的安装路径，例如此处我指定的安装路径为 C:\MongoDB\Server\3.4，如图 1-30 所示。当然，这里也可以自行选择路径。</p>
                  <p><img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/02/1-30.jpg" alt="">图 1-30 指定安装路径</p>
                  <p>点击 Next 按钮执行安装即可。</p>
                  <p>安装成功之后，进入 MongoDB 的安装目录，此处是 C:\MongoDB\Server\3.4，在 bin 目录下新建同级目录 data，如图 1-31 所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/02/1-31.jpg" alt="">图 1-31 新建 data 目录</p>
                  <p>然后进入 data 文件夹，新建子文件夹 db 来存储数据目录，如图 1-32 所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/02/1-32.jpg" alt="">图 1-32 新建 db 目录</p>
                  <p>之后打开命令行，进入 MongoDB 安装目录的 bin 目录下，运行 MongoDB 服务：</p>
                  <figure class="highlight taggerscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">mongod --dbpath "C:<span class="symbol">\M</span>ongoDB<span class="symbol">\S</span>erver<span class="symbol">\3</span>.4<span class="symbol">\d</span>ata<span class="symbol">\d</span>b"</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>请记得将此处的路径替换成你的主机 MongoDB 安装路径。</p>
                  <p>运行之后，会出现一些输出信息，如图 1-33 所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/02/1-33.jpg" alt="">图 1-33 运行结果</p>
                  <p>这样我们就启动 MongoDB 服务了。</p>
                  <p>但是如果我们想一直使用 MongoDB，就不能关闭此命令行了。如果意外关闭或重启，MongoDB 服务就不能使用了。这显然不是我们想要的。所以，接下来还需将 MongoDB 配置成系统服务。</p>
                  <p>首先，以管理员模式运行命令行。注意，此处一定要以管理员身份运行，否则可能配置失败，如图 1-34 所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/02/1-34.jpg" alt="">图 1-34 以管理员身份运行</p>
                  <p>在“开始”菜单中搜索 cmd，找到命令行，然后右击它以管理员身份运行即可。</p>
                  <p>随后新建一个日志文件，在 bin 目录新建 logs 同级目录，进入之后新建一个 mongodb.log 文件，用于保存 MongoDB 的运行日志，如图 1-35 所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/02/1-35.jpg" alt="">图 1-35 新建 mongodb.log 文件</p>
                  <p>在命令行下输入如下内容：</p>
                  <figure class="highlight jboss-cli">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">mongod <span class="params">--bind_ip</span> 0.0.0.0 <span class="params">--logpath</span> <span class="string">"C:\MongoDB\Server\3.4\logs\mongodb.log"</span> <span class="params">--logappend</span> <span class="params">--dbpath</span> <span class="string">"C:\MongoDB\Server\3.4\data\db"</span> <span class="params">--port</span> 27017 <span class="params">--serviceName</span> <span class="string">"MongoDB"</span> <span class="params">--serviceDisplayName</span> <span class="string">"MongoDB"</span> <span class="params">--install</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里的意思是绑定 IP 为 0.0.0.0（即任意 IP 均可访问），指定日志路径、数据库路径和端口，指定服务名称。需要注意的是，这里依然需要把路径替换成你的 MongoDB 安装路径，运行此命令后即可安装服务，运行结果如图 1-36 所示。<img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/02/1-36.jpg" alt="">图 1-36 运行结果</p>
                  <p>如果没有出现错误提示，则证明 MongoDB 服务已经安装成功。</p>
                  <p>可以在服务管理页面查看到系统服务，如图 1-37 所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/02/1-37.jpg" alt="">图 1-37 系统服务页面</p>
                  <p>然后就可以设置它的开机启动方式了，如自动启动或手动启动等，这样我们就可以非常方便地管理 MongoDB 服务了。</p>
                  <p>启动服务后，在命令行下就可以利用<code>mongo</code>命令进入 MongoDB 命令交互环境了，如图 1-38 所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/02/1-38.jpg" alt="">图 1-38 命令行模式</p>
                  <p>这样，Windows 下的 MongoDB 配置就完成了。</p>
                  <h2 id="3-Linux-下的安装"><a href="#3-Linux-下的安装" class="headerlink" title="3. Linux 下的安装"></a>3. Linux 下的安装</h2>
                  <p>这里以 MongoDB 3.4 为例说明 MongoDB 的安装过程。</p>
                  <h3 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h3>
                  <p>首先，导入 MongoDB 的 GPG key：</p>
                  <figure class="highlight jboss-cli">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-key adv <span class="params">--keyserver</span> hkp:<span class="string">//keyserver.ubuntu.com</span><span class="function">:80</span> <span class="params">--recv</span> 0C49F3730359A14518585931BC711F9BA15703C6</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>随后创建 apt-get 源列表，各个系统版本对应的命令分别如下。</p>
                  <ul>
                    <li>
                      <p>Ubuntu 12.04 对应的命令如下：</p>
                      <figure class="highlight lsl">
                        <table>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line">echo <span class="string">"deb [ arch=amd64 ] http://repo.mongodb.org/apt/ubuntu precise/mongodb-org/3.4 multiverse"</span> | sudo tee /etc/apt/sources.<span class="type">list</span>.d/mongodb-org<span class="number">-3.4</span>.<span class="type">list</span></span><br></pre>
                            </td>
                          </tr>
                        </table>
                      </figure>
                    </li>
                    <li>
                      <p>Ubuntu 14.04 对应的命令如下：</p>
                      <figure class="highlight lsl">
                        <table>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line">echo <span class="string">"deb [ arch=amd64 ] http://repo.mongodb.org/apt/ubuntu trusty/mongodb-org/3.4 multiverse"</span> | sudo tee /etc/apt/sources.<span class="type">list</span>.d/mongodb-org<span class="number">-3.4</span>.<span class="type">list</span></span><br></pre>
                            </td>
                          </tr>
                        </table>
                      </figure>
                    </li>
                    <li>
                      <p>Ubuntu 16.04 对应的命令如下：</p>
                      <figure class="highlight lsl">
                        <table>
                          <tr>
                            <td class="gutter">
                              <pre><span class="line">1</span><br></pre>
                            </td>
                            <td class="code">
                              <pre><span class="line">echo <span class="string">"deb [ arch=amd64,arm64 ] http://repo.mongodb.org/apt/ubuntu xenial/mongodb-org/3.4 multiverse"</span> | sudo tee /etc/apt/sources.<span class="type">list</span>.d/mongodb-org<span class="number">-3.4</span>.<span class="type">list</span></span><br></pre>
                            </td>
                          </tr>
                        </table>
                      </figure>
                    </li>
                  </ul>
                  <p>随后更新 apt-get 源：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">update</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>之后安装 MongoDB 即可：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-<span class="builtin-name">get</span> install -y mongodb-org</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>安装完成后运行 MongoDB，命令如下：</p>
                  <figure class="highlight jboss-cli">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">mongod <span class="params">--port</span> 27017 <span class="params">--dbpath</span> <span class="string">/data/db</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行命令之后，MongoDB 就在 27017 端口上运行了，数据文件会保存在/data/db 路径下。</p>
                  <p>一般情况下，我们在 Linux 上配置 MongoDB 都是为了远程连接使用的，所以这里还需要配置一下 MongoDB 的远程连接以及用户名和密码。</p>
                  <p>接着，进入 MongoDB 命令行：</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">mongo <span class="comment">--port 27017</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>现在我们就已经进入到 MongoDB 的命令行交互模式下了，在此模式下运行如下命令：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&gt; use admin</span><br><span class="line">switched to db admin</span><br><span class="line">&gt; db.createUser(&#123;<span class="string">user:</span> <span class="string">'admin'</span>, <span class="string">pwd:</span> <span class="string">'admin123'</span>, <span class="string">roles:</span> [&#123;<span class="string">role:</span> <span class="string">'root'</span>, <span class="string">db:</span> <span class="string">'admin'</span>&#125;]&#125;)</span><br><span class="line">Successfully added <span class="string">user:</span> &#123;</span><br><span class="line">        <span class="string">"user"</span> : <span class="string">"admin"</span>,</span><br><span class="line">        <span class="string">"roles"</span> : [</span><br><span class="line">                &#123;</span><br><span class="line">                        <span class="string">"role"</span> : <span class="string">"root"</span>,</span><br><span class="line">                        <span class="string">"db"</span> : <span class="string">"admin"</span></span><br><span class="line">                &#125;</span><br><span class="line">        ]</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们就创建了一个用户名为 admin，密码为 admin123 的用户，赋予最高权限。</p>
                  <p>随后需要修改 MongoDB 的配置文件，此时执行如下命令：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo <span class="keyword">vi</span> /etc/mongod.<span class="keyword">conf</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后修改<code>net</code>部分为：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">net:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">27017</span></span><br><span class="line">  <span class="attr">bindIp:</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样配置后，MongoDB 可被远程访问。</p>
                  <p>另外，还需要添加如下的权限认证配置，此时直接添加如下内容到配置文件即可：</p>
                  <figure class="highlight dts">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">security:</span></span><br><span class="line"><span class="symbol">  authorization:</span> enabled</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>配置完成之后，我们需要重新启动 MongoDB 服务，命令如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo<span class="built_in"> service </span>mongod restart</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样远程连接和权限认证就配置完成了。</p>
                  <h5 id="CentOS-和-Red-Hat"><a href="#CentOS-和-Red-Hat" class="headerlink" title="CentOS 和 Red Hat"></a>CentOS 和 Red Hat</h5>
                  <p>首先，添加 MongoDB 源：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo vi <span class="regexp">/etc/yum</span>.repos.d<span class="regexp">/mongodb-org.repo</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接着修改如下内容并保存：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="section">[mongodb-org-3.4]</span></span><br><span class="line"><span class="attr">name</span>=MongoDB Repository</span><br><span class="line"><span class="attr">baseurl</span>=https://repo.mongodb.org/yum/redhat/<span class="variable">$releasever</span>/mongodb-org/<span class="number">3.4</span>/x<span class="number">86_64</span>/</span><br><span class="line"><span class="attr">gpgcheck</span>=<span class="number">1</span></span><br><span class="line"><span class="attr">enabled</span>=<span class="number">1</span></span><br><span class="line"><span class="attr">gpgkey</span>=https://www.mongodb.org/static/pgp/server-<span class="number">3.4</span>.asc</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后执行<code>yum</code>命令安装：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo yum <span class="keyword">install</span> mongodb-org</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里启动 MongoDB 服务的命令如下：</p>
                  <figure class="highlight crmsh">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo systemctl <span class="literal">start</span> mongod</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>停止和重新加载 MongoDB 服务的命令如下：</p>
                  <figure class="highlight properties">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">sudo</span> <span class="string">systemctl stop mongod</span></span><br><span class="line"><span class="attr">sudo</span> <span class="string">systemctl reload mongod</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>有关远程连接和认证配置，可以参考前面，方式是相同的。</p>
                  <p>更多 Linux 发行版的 MongoDB 安装方式可以参考官方文档：<a href="https://docs.mongodb.com/manual/administration/install-on-linux/" target="_blank" rel="noopener">https://docs.mongodb.com/manual/administration/install-on-linux/</a>。</p>
                  <h2 id="4-Mac-下的安装"><a href="#4-Mac-下的安装" class="headerlink" title="4. Mac 下的安装"></a>4. Mac 下的安装</h2>
                  <p>这里推荐使用 Homebrew 安装，直接执行<code>brew</code>命令即可：</p>
                  <figure class="highlight mipsasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">brew </span><span class="keyword">install </span>mongodb</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后创建一个新文件夹/data/db，用于存放 MongoDB 数据。</p>
                  <p>这里启动 MongoDB 服务的命令如下：</p>
                  <figure class="highlight properties">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">brew</span> <span class="string">services start mongodb</span></span><br><span class="line"><span class="attr">sudo</span> <span class="string">mongod</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>停止和重启 MongoDB 服务的命令分别是：</p>
                  <figure class="highlight armasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">brew </span>services stop mongodb</span><br><span class="line"><span class="keyword">brew </span>services restart mongodb</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="5-可视化工具"><a href="#5-可视化工具" class="headerlink" title="5. 可视化工具"></a>5. 可视化工具</h2>
                  <p>这里推荐一个可视化工具 RoboMongo/Robo 3T，它使用简单，功能强大，官方网站为<a href="https://robomongo.org/" target="_blank" rel="noopener">https://robomongo.org/</a>，三大平台都支持，下载链接为<a href="https://robomongo.org/download" target="_blank" rel="noopener">https://robomongo.org/download</a>。</p>
                  <p>另外，还有一个简单易用的可视化工具——Studio 3T，它同样具有方便的图形化管理界面，官方网站为<a href="https://studio3t.com/" target="_blank" rel="noopener">https://studio3t.com</a>，同样支持三大平台，下载链接为<a href="https://studio3t.com/download/" target="_blank" rel="noopener">https://studio3t.com/download/</a>。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-25 15:10:03" itemprop="dateCreated datePublished" datetime="2018-01-25T15:10:03+08:00">2018-01-25</time>
                </span>
                <span id="/5205.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 1.4.2-MongoDB安装" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>4.4k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>4 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5200.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5200.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 1.4.1-MySQL的安装</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>MySQL 是一个轻量级的关系型数据库，本节中我们来了解下它的安装方式。</p>
                  <h2 id="1-相关链接"><a href="#1-相关链接" class="headerlink" title="1. 相关链接"></a>1. 相关链接</h2>
                  <ul>
                    <li>官方网站：<a href="https://www.mysql.com/cn" target="_blank" rel="noopener">https://www.mysql.com/cn</a></li>
                    <li>下载地址：<a href="https://www.mysql.com/cn/downloads" target="_blank" rel="noopener">https://www.mysql.com/cn/downloads</a></li>
                    <li>中文教程：<a href="http://www.runoob.com/mysql/mysql-tutorial.html" target="_blank" rel="noopener">http://www.runoob.com/mysql/mysql-tutorial.html</a></li>
                  </ul>
                  <h2 id="2-Windows-下的安装"><a href="#2-Windows-下的安装" class="headerlink" title="2. Windows 下的安装"></a>2. Windows 下的安装</h2>
                  <p>对于 Windows 来说，可以直接在百度软件中心搜索 MySQL，下载其提供的 MySQL 安装包，速度还是比较快的。</p>
                  <p>当然，最安全稳妥的方式是直接到官网下载安装包进行安装，但是这样做有个缺点，那就是需要登录才可以下载，而且速度不快。</p>
                  <p>下载完成后，双击安装包即可安装，这里直接选择默认选项，点击 Next 按钮安装即可。这里需要记住图 1-27 所设置的密码。</p>
                  <p><img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/02/1-27.jpg" alt="">图 1-27 设置密码页面</p>
                  <p>安装完成后，我们可以在“计算机”→“管理”→“服务”页面开启和关闭 MySQL 服务，如图 1-28 所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/02/1-28.jpg" alt="">图 1-28 系统服务页面</p>
                  <p>如果启动了 MySQL 服务，就可以使用它来存储数据了。</p>
                  <h2 id="3-Linux-下的安装"><a href="#3-Linux-下的安装" class="headerlink" title="3. Linux 下的安装"></a>3. Linux 下的安装</h2>
                  <p>下面我们仍然分平台来介绍。</p>
                  <h3 id="Ubuntu、Debian-和-Deepin"><a href="#Ubuntu、Debian-和-Deepin" class="headerlink" title="Ubuntu、Debian 和 Deepin"></a>Ubuntu、Debian 和 Deepin</h3>
                  <p>在 Ubuntu、Debian 和 Deepin 系统中，我们直接使用<code>apt-get</code>命令即可安装 MySQL：</p>
                  <figure class="highlight sql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-get <span class="keyword">update</span></span><br><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">install</span> -y mysql-<span class="keyword">server</span> mysql-<span class="keyword">client</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在安装过程中，会提示输入用户名和密码，输入后等待片刻即可完成安装。</p>
                  <p>启动、关闭和重启 MySQL 服务的命令如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo<span class="built_in"> service </span>mysql start</span><br><span class="line">sudo<span class="built_in"> service </span>mysql stop</span><br><span class="line">sudo<span class="built_in"> service </span>mysql restart</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="CentOS-和-Red-Hat"><a href="#CentOS-和-Red-Hat" class="headerlink" title="CentOS 和 Red Hat"></a>CentOS 和 Red Hat</h3>
                  <p>这里以 MySQL 5.6 的 Yum 源为例来说明（如果需要更高版本，可以另寻），安装命令如下：</p>
                  <figure class="highlight sql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">wget http://repo.mysql.com/mysql-community-<span class="keyword">release</span>-el7<span class="number">-5.</span>noarch.rpm</span><br><span class="line">sudo rpm -ivh mysql-community-<span class="keyword">release</span>-el7<span class="number">-5.</span>noarch.rpm</span><br><span class="line">yum <span class="keyword">install</span> -y mysql mysql-<span class="keyword">server</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行如上命令即可完成安装，初始密码为空。接下来，需要启动 MySQL 服务。</p>
                  <p>启动 MySQL 服务的命令如下：</p>
                  <figure class="highlight crmsh">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo systemctl <span class="literal">start</span> mysqld</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>停止、重启 MySQL 服务的命令如下：</p>
                  <figure class="highlight properties">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">sudo</span> <span class="string">systemctl stop mysqld</span></span><br><span class="line"><span class="attr">sudo</span> <span class="string">systemctl restart mysqld</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>上面我们完成了 Linux 下 MySQL 的安装，之后可以修改密码，此时可以执行如下命令：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">mysql -uroot -p</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>输入密码后，进入 MySQL 命令行模式，接着输入如下命令：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">use mysql;</span><br><span class="line">UPDATE<span class="built_in"> user </span><span class="builtin-name">SET</span> Password = PASSWORD(<span class="string">'newpass'</span>) WHERE<span class="built_in"> user </span>= <span class="string">'root'</span>;</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中<code>newpass</code>为修改的新的 MySQL 密码，请自行替换。</p>
                  <p>由于 Linux 一般会作为服务器使用，为了使 MySQL 可以被远程访问，我们需要修改 MySQL 的配置文件，配置文件的路径一般为/etc/mysql/my.cnf。</p>
                  <p>比如，使用<code>vi</code>进行修改的命令如下：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">vi</span> /etc/mysql/my.<span class="keyword">cnf</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>取消此行的注释如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">bind-address = <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>此行限制了 MySQL 只能本地访问而不能远程访问，取消注释即可解除此限制。</p>
                  <p>修改完成后重启 MySQL 服务，此时 MySQL 就可以被远程访问了。</p>
                  <p>到此为止，在 Linux 下安装 MySQL 的过程就结束了。</p>
                  <h2 id="4-Mac-下的安装"><a href="#4-Mac-下的安装" class="headerlink" title="4. Mac 下的安装"></a>4. Mac 下的安装</h2>
                  <p>这里推荐使用 Homebrew 安装，直接执行<code>brew</code>命令即可：</p>
                  <figure class="highlight mipsasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">brew </span><span class="keyword">install </span>mysql</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>启动、停止和重启 MySQL 服务的命令如下：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo mysql.<span class="keyword">server</span> <span class="keyword">start</span></span><br><span class="line">sudo mysql.<span class="keyword">server</span> stop</span><br><span class="line">sudo mysql.<span class="keyword">server</span> <span class="keyword">restart</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>Mac 一般不会作为服务器使用，如果想取消本地 host 绑定，那么需要修改 my.cnf 文件，然后重启服务。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-25 15:05:00" itemprop="dateCreated datePublished" datetime="2018-01-25T15:05:00+08:00">2018-01-25</time>
                </span>
                <span id="/5200.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 1.4.1-MySQL的安装" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.7k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5197.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5197.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 1.4-数据库的安装</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>作为数据存储的重要部分，数据库同样是必不可少的，数据库可以分为关系型数据库和非关系型数据库。</p>
                  <p>关系型数据库如SQLite、MySQL、Oracle、SQL Server、DB2等，其数据库是以表的形式存储，非关系型数据库如MongoDB、Redis，它们的存储形式是键值对，存储形式更加灵活。</p>
                  <p>本书用到的数据库主要有关系型数据库MySQL及非关系型数据库MongoDB、Redis。</p>
                  <p>本节中，我们来了解一下它们的安装方式。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-25 15:02:35" itemprop="dateCreated datePublished" datetime="2018-01-25T15:02:35+08:00">2018-01-25</time>
                </span>
                <span id="/5197.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 1.4-数据库的安装" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>207</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5189.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5189.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 1.3.4-tesserocr的安装</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>在爬虫过程中，难免会遇到各种各样的验证码，而大多数验证码还是图形验证码，这时候我们可以直接用 OCR 来识别。</p>
                  <h2 id="1-OCR"><a href="#1-OCR" class="headerlink" title="1. OCR"></a>1. OCR</h2>
                  <p>OCR，即 Optical Character Recognition，光学字符识别，是指通过扫描字符，然后通过其形状将其翻译成电子文本的过程。对于图形验证码来说，它们都是一些不规则的字符，这些字符确实是由字符稍加扭曲变换得到的内容。</p>
                  <p>例如，对于如图 1-22 和图 1-23 所示的验证码，我们可以使用 OCR 技术来将其转化为电子文本，然后爬虫将识别结果提交给服务器，便可以达到自动识别验证码的过程。</p>
                  <p><img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/02/1-22.jpg" alt=""></p>
                  <p>图 1-22 验证码</p>
                  <p><img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/02/1-23.jpg" alt="">图 1-23 验证码</p>
                  <p>tesserocr 是 Python 的一个 OCR 识别库，但其实是对 tesseract 做的一层 Python API 封装，所以它的核心是 tesseract。因此，在安装 tesserocr 之前，我们需要先安装 tesseract。</p>
                  <h2 id="2-相关链接"><a href="#2-相关链接" class="headerlink" title="2. 相关链接"></a>2. 相关链接</h2>
                  <ul>
                    <li>tesserocr GitHub：<a href="https://github.com/sirfz/tesserocr" target="_blank" rel="noopener">https://github.com/sirfz/tesserocr</a></li>
                    <li>tesserocr PyPI：<a href="https://pypi.python.org/pypi/tesserocr" target="_blank" rel="noopener">https://pypi.python.org/pypi/tesserocr</a></li>
                    <li>tesseract 下载地址：<a href="http://digi.bib.uni-mannheim.de/tesseract" target="_blank" rel="noopener">http://digi.bib.uni-mannheim.de/tesseract</a></li>
                    <li>tesseract GitHub：<a href="https://github.com/tesseract-ocr/tesseract" target="_blank" rel="noopener">https://github.com/tesseract-ocr/tesseract</a></li>
                    <li>tesseract 语言包：<a href="https://github.com/tesseract-ocr/tessdata" target="_blank" rel="noopener">https://github.com/tesseract-ocr/tessdata</a></li>
                    <li>tesseract 文档：<a href="https://github.com/tesseract-ocr/tesseract/wiki/Documentation" target="_blank" rel="noopener">https://github.com/tesseract-ocr/tesseract/wiki/Documentation</a></li>
                  </ul>
                  <h2 id="3-Windows-下的安装"><a href="#3-Windows-下的安装" class="headerlink" title="3. Windows 下的安装"></a>3. Windows 下的安装</h2>
                  <p>在 Windows 下，首先需要下载 tesseract，它为 tesserocr 提供了支持。</p>
                  <p>进入下载页面，可以看到有各种.exe 文件的下载列表，这里可以选择下载 3.0 版本。图 1-24 所示为 3.05 版本。</p>
                  <p><img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/02/1-24.jpg" alt="">图 1-24 下载页面</p>
                  <p>其中文件名中带有 dev 的为开发版本，不带 dev 的为稳定版本，可以选择下载不带 dev 的版本，例如可以选择下载 tesseract-ocr-setup-3.05.01.exe。</p>
                  <p>下载完成后双击，此时会出现如图 1-25 所示的页面。</p>
                  <p><img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/02/1-25.jpg" alt="">图 1-25 安装页面</p>
                  <p>此时可以勾选 Additional language data(download)选项来安装 OCR 识别支持的语言包，这样 OCR 便可以识别多国语言。然后一路点击 Next 按钮即可。</p>
                  <p>接下来，再安装 tesserocr 即可，此时直接使用 pip 安装：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> tesserocr pillow</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="4-Linux-下的安装"><a href="#4-Linux-下的安装" class="headerlink" title="4. Linux 下的安装"></a>4. Linux 下的安装</h2>
                  <p>对于 Linux 来说，不同系统已经有了不同的发行包了，它可能叫作 tesseract-ocr 或者 tesseract，直接用对应的命令安装即可。</p>
                  <h3 id="Ubuntu、Debian-和-Deepin"><a href="#Ubuntu、Debian-和-Deepin" class="headerlink" title="Ubuntu、Debian 和 Deepin"></a>Ubuntu、Debian 和 Deepin</h3>
                  <p>在 Ubuntu、Debian 和 Deepin 系统下，安装命令如下：</p>
                  <figure class="highlight q">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-<span class="built_in">get</span> install -y tesseract-ocr libtesseract-<span class="built_in">dev</span> libleptonica-<span class="built_in">dev</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="CentOS、Red-Hat"><a href="#CentOS、Red-Hat" class="headerlink" title="CentOS、Red Hat"></a>CentOS、Red Hat</h3>
                  <p>在 CentOS 和 Red Hat 系统下，安装命令如下：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">yum <span class="keyword">install</span> -y tesseract</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在不同发行版本运行如上命令，即可完成 tesseract 的安装。</p>
                  <p>安装完成后，便可以调用<code>tesseract</code>命令了。</p>
                  <p>接着，我们查看一下其支持的语言：</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">tesseract <span class="comment">--list-langs</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果示例：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">List of available languages (<span class="number">3</span>):</span><br><span class="line">eng</span><br><span class="line">osd</span><br><span class="line">equ</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果显示它只支持几种语言，如果想要安装多国语言，还需要安装语言包，官方叫作 tessdata（其下载链接为：<a href="https://github.com/tesseract-ocr/tessdata" target="_blank" rel="noopener">https://github.com/tesseract-ocr/tessdata</a>）。</p>
                  <p>利用 Git 命令将其下载下来并迁移到相关目录即可，不同版本的迁移命令如下所示。</p>
                  <p>在 Ubuntu、Debian 和 Deepin 系统下的迁移命令如下：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">git clone https:<span class="regexp">//gi</span>thub.com<span class="regexp">/tesseract-ocr/</span>tessdata.git</span><br><span class="line">sudo mv tessdata<span class="regexp">/* /u</span>sr<span class="regexp">/share/</span>tesseract-ocr<span class="regexp">/tessdata</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在 CentOS 和 Red Hat 系统下的迁移命令如下：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">git clone https:<span class="regexp">//gi</span>thub.com<span class="regexp">/tesseract-ocr/</span>tessdata.git</span><br><span class="line">sudo mv tessdata<span class="regexp">/* /u</span>sr<span class="regexp">/share/</span>tesseract<span class="regexp">/tessdata</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就可以将下载下来的语言包全部安装了。</p>
                  <p>这时我们重新运行列出所有语言的命令：</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">tesseract <span class="comment">--list-langs</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果如下：</p>
                  <figure class="highlight armasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">List</span> of available languages (<span class="number">107</span>):</span><br><span class="line"><span class="symbol">afr</span></span><br><span class="line"><span class="symbol">amh</span></span><br><span class="line"><span class="symbol">ara</span></span><br><span class="line"><span class="symbol">asm</span></span><br><span class="line"><span class="symbol">aze</span></span><br><span class="line"><span class="symbol">aze_cyrl</span></span><br><span class="line"><span class="keyword">bel</span></span><br><span class="line"><span class="keyword">ben</span></span><br><span class="line"><span class="keyword">bod</span></span><br><span class="line"><span class="keyword">bos</span></span><br><span class="line"><span class="keyword">bul</span></span><br><span class="line"><span class="keyword">cat</span></span><br><span class="line"><span class="keyword">ceb</span></span><br><span class="line"><span class="keyword">ces</span></span><br><span class="line"><span class="keyword">chi_sim</span></span><br><span class="line"><span class="keyword">chi_tra</span></span><br><span class="line"><span class="keyword">...</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以发现，这里列出的语言就多了很多，比如 chi_sim 就代表简体中文，这就证明语言包安装成功了。</p>
                  <p>接下来再安装 tesserocr 即可，这里直接使用 pip 安装：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> tesserocr pillow</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="5-Mac-下的安装"><a href="#5-Mac-下的安装" class="headerlink" title="5. Mac 下的安装"></a>5. Mac 下的安装</h2>
                  <p>在 Mac 下，我们首先使用 Homebrew 安装 ImageMagick 和 tesseract 库：</p>
                  <figure class="highlight mipsasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">brew </span><span class="keyword">install </span>imagemagick</span><br><span class="line"><span class="keyword">brew </span><span class="keyword">install </span>tesseract --all-languages</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来再安装 tesserocr 即可：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> tesserocr pillow</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们便完成了 tesserocr 的安装。</p>
                  <h2 id="6-验证安装"><a href="#6-验证安装" class="headerlink" title="6. 验证安装"></a>6. 验证安装</h2>
                  <p>接下来，我们可以使用 tesseract 和 tesserocr 来分别进行测试。</p>
                  <p>下面我们以如图 1-26 所示的图片为样例进行测试。</p>
                  <p><img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/02/1-26.jpg" alt="">图 1-26 测试样例</p>
                  <p>该图片的链接为<a href="https://raw.githubusercontent.com/Python3WebSpider/TestTess/master/image.png" target="_blank" rel="noopener">https://raw.githubusercontent.com/Python3WebSpider/TestTess/master/image.png</a>，可以直接保存或下载。</p>
                  <p>首先用命令行进行测试，将图片下载下来并保存为 image.png，然后用<code>tesseract</code>命令测试：</p>
                  <figure class="highlight applescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">tesseract image.png <span class="literal">result</span> -l eng &amp;&amp; cat <span class="literal">result</span>.txt</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Tesseract Open Source OCR Engine v3<span class="number">.05</span><span class="number">.01</span> with Leptonica</span><br><span class="line">Python3WebSpider</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们调用了<code>tesseract</code>命令，其中第一个参数为图片名称，第二个参数<code>result</code>为结果保存的目标文件名称，<code>\-l</code>指定使用的语言包，在此使用英文（<code>eng</code>）。然后，再用<code>cat</code>命令将结果输出。</p>
                  <p>运行结果便是图片的识别结果：<code>Python3WebSpider</code>。可以看到，这时已经成功将图片文字转为电子文本了。</p>
                  <p>然后还可以利用 Python 代码来测试，这里就需要借助于 tesserocr 库了，测试代码如下：</p>
                  <figure class="highlight processing">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> tesserocr</span><br><span class="line">from PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="built_in">image</span> = Image.<span class="built_in">open</span>(<span class="string">'image.png'</span>)</span><br><span class="line"><span class="built_in">print</span>(tesserocr.image_to_text(<span class="built_in">image</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们首先利用<code>Image</code>读取了图片文件，然后调用了<code>tesserocr</code>的<code>image_to_text()</code>方法，再将其识别结果输出。</p>
                  <p>运行结果如下：</p>
                  <figure class="highlight gcode">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Pytho<span class="symbol">n3</span>WebSpider</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外，我们还可以直接调用<code>file_to_text()</code>方法，这可以达到同样的效果：</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import tesserocr</span><br><span class="line">print(<span class="name">tesserocr</span>.file_to_text('image.png'))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight gcode">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Pytho<span class="symbol">n3</span>WebSpider</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果成功输出结果，则证明 tesseract 和 tesserocr 都已经安装成功。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-25 14:56:13" itemprop="dateCreated datePublished" datetime="2018-01-25T14:56:13+08:00">2018-01-25</time>
                </span>
                <span id="/5189.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 1.3.4-tesserocr的安装" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>3.3k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5186.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5186.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 1.3.3-pyquery的安装</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>pyquery同样是一个强大的网页解析工具，它提供了和jQuery类似的语法来解析HTML文档，支持CSS选择器，使用非常方便。本节中，我们就来了解一下它的安装方式。</p>
                  <h2 id="1-相关链接"><a href="#1-相关链接" class="headerlink" title="1. 相关链接"></a>1. 相关链接</h2>
                  <ul>
                    <li>GitHub：<a href="https://github.com/gawel/pyquery" target="_blank" rel="noopener">https://github.com/gawel/pyquery</a></li>
                    <li>PyPI：<a href="https://pypi.python.org/pypi/pyquery" target="_blank" rel="noopener">https://pypi.python.org/pypi/pyquery</a></li>
                    <li>官方文档：<a href="http://pyquery.readthedocs.io/" target="_blank" rel="noopener">http://pyquery.readthedocs.io</a></li>
                  </ul>
                  <h2 id="2-pip安装"><a href="#2-pip安装" class="headerlink" title="2. pip安装"></a>2. pip安装</h2>
                  <p>这里推荐使用pip安装，命令如下：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> pyquery</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>命令执行完毕之后即可完成安装。</p>
                  <h2 id="3-wheel安装"><a href="#3-wheel安装" class="headerlink" title="3. wheel安装"></a>3. wheel安装</h2>
                  <p>当然，我们也可以到PyPI（<a href="https://pypi.python.org/pypi/pyquery/#downloads" target="_blank" rel="noopener">https://pypi.python.org/pypi/pyquery/#downloads</a>）下载对应的wheel文件安装。比如如果当前版本为1.2.17，则下载的文件名称为pyquery-1.2.17-py2.py3-none-any.whl，此时下载到本地再进行pip安装即可，命令如下：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">pip3</span> <span class="selector-tag">install</span> <span class="selector-tag">pyquery-1</span><span class="selector-class">.2</span><span class="selector-class">.17-py2</span><span class="selector-class">.py3-none-any</span><span class="selector-class">.whl</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="4-验证安装"><a href="#4-验证安装" class="headerlink" title="4. 验证安装"></a>4. 验证安装</h2>
                  <p>安装完成之后，可以在Python命令行下测试：</p>
                  <figure class="highlight ruby">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">$ python3</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; import pyquery</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果没有错误报出，则证明库已经安装好了。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-25 14:53:07" itemprop="dateCreated datePublished" datetime="2018-01-25T14:53:07+08:00">2018-01-25</time>
                </span>
                <span id="/5186.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 1.3.3-pyquery的安装" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>562</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5183.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5183.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 1.3.2-Beautiful Soup的安装</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>Beautiful Soup是Python的一个HTML或XML的解析库，我们可以用它来方便地从网页中提取数据。它拥有强大的API和多样的解析方式，本节就来了解下它的安装方式。</p>
                  <h2 id="1-相关链接"><a href="#1-相关链接" class="headerlink" title="1. 相关链接"></a>1. 相关链接</h2>
                  <ul>
                    <li>官方文档：<a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc" target="_blank" rel="noopener">https://www.crummy.com/software/BeautifulSoup/bs4/doc</a></li>
                    <li>中文文档：<a href="https://www.crummy.com/software/BeautifulSoup/bs4/doc.zh" target="_blank" rel="noopener">https://www.crummy.com/software/BeautifulSoup/bs4/doc.zh</a></li>
                    <li>PyPI：<a href="https://pypi.python.org/pypi/beautifulsoup4" target="_blank" rel="noopener">https://pypi.python.org/pypi/beautifulsoup4</a></li>
                  </ul>
                  <h2 id="2-准备工作"><a href="#2-准备工作" class="headerlink" title="2. 准备工作"></a>2. 准备工作</h2>
                  <p>Beautiful Soup的HTML和XML解析器是依赖于lxml库的，所以在此之前请确保已经成功安装好了lxml库，具体的安装方式参见上节。</p>
                  <h2 id="3-pip安装"><a href="#3-pip安装" class="headerlink" title="3. pip安装"></a>3. pip安装</h2>
                  <p>目前，Beautiful Soup的最新版本是4.x版本，之前的版本已经停止开发了。这里推荐使用pip来安装，安装命令如下：</p>
                  <figure class="highlight smali">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 install beautifulsoup4</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>命令执行完毕之后即可完成安装。</p>
                  <h2 id="4-wheel安装"><a href="#4-wheel安装" class="headerlink" title="4. wheel安装"></a>4. wheel安装</h2>
                  <p>当然，我们也可以从PyPI下载wheel文件安装，链接如下：<a href="https://pypi.python.org/pypi/beautifulsoup4" target="_blank" rel="noopener">https://pypi.python.org/pypi/beautifulsoup4</a></p>
                  <p>然后使用pip安装wheel文件即可。</p>
                  <h2 id="5-验证安装"><a href="#5-验证安装" class="headerlink" title="5. 验证安装"></a>5. 验证安装</h2>
                  <p>安装完成之后，可以运行下面的代码验证一下：</p>
                  <figure class="highlight moonscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(<span class="string">'&lt;p&gt;Hello&lt;/p&gt;'</span>, <span class="string">'lxml'</span>)</span><br><span class="line"><span class="built_in">print</span>(soup.p.<span class="built_in">string</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">Hello</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果运行结果一致，则证明安装成功。</p>
                  <p>注意，这里我们虽然安装的是beautifulsoup4这个包，但是在引入的时候却是bs4。这是因为这个包源代码本身的库文件夹名称就是bs4，所以安装完成之后，这个库文件夹就被移入到本机Python3的lib库里，所以识别到的库文件名就叫作bs4。</p>
                  <p>因此，包本身的名称和我们使用时导入的包的名称并不一定是一致的。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-25 14:45:43" itemprop="dateCreated datePublished" datetime="2018-01-25T14:45:43+08:00">2018-01-25</time>
                </span>
                <span id="/5183.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 1.3.2-Beautiful Soup的安装" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>860</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5180.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5180.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 1.3.1-lxml的安装</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>lxml是Python的一个解析库，支持HTML和XML的解析，支持XPath解析方式，而且解析效率非常高。本节中，我们了解一下lxml的安装方式，这主要从Windows、Linux和Mac三大平台来介绍。</p>
                  <h2 id="1-相关链接"><a href="#1-相关链接" class="headerlink" title="1. 相关链接"></a>1. 相关链接</h2>
                  <ul>
                    <li>官方网站：<a href="http://lxml.de/" target="_blank" rel="noopener">http://lxml.de</a></li>
                    <li>GitHub：<a href="https://github.com/lxml/lxml" target="_blank" rel="noopener">https://github.com/lxml/lxml</a></li>
                    <li>PyPI：<a href="https://pypi.python.org/pypi/lxml" target="_blank" rel="noopener">https://pypi.python.org/pypi/lxml</a></li>
                  </ul>
                  <h2 id="2-Windows下的安装"><a href="#2-Windows下的安装" class="headerlink" title="2. Windows下的安装"></a>2. Windows下的安装</h2>
                  <p>在Windows下，可以先尝试利用pip安装，此时直接执行如下命令即可：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> lxml</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果没有任何报错，则证明安装成功。</p>
                  <p>如果出现报错，比如提示缺少libxml2库等信息，可以采用wheel方式安装。</p>
                  <p>推荐直接到这里（链接为：<a href="http://www.lfd.uci.edu/~gohlke/pythonlibs/#lxml" target="_blank" rel="noopener">http://www.lfd.uci.edu/~gohlke/pythonlibs/#lxml</a>）下载对应的wheel文件，找到本地安装Python版本和系统对应的lxml版本，例如Windows 64位、Python 3.6，就选择lxml‑3.8.0‑cp36‑cp36m‑win_amd64.whl，将其下载到本地。</p>
                  <p>然后利用pip安装即可，命令如下：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">pip3</span> <span class="selector-tag">install</span> <span class="selector-tag">lxml</span>‑3<span class="selector-class">.8</span><span class="selector-class">.0</span>‑<span class="selector-tag">cp36</span>‑<span class="selector-tag">cp36m</span>‑<span class="selector-tag">win_amd64</span><span class="selector-class">.whl</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们就可以成功安装lxml了。</p>
                  <h2 id="3-Linux下的安装"><a href="#3-Linux下的安装" class="headerlink" title="3. Linux下的安装"></a>3. Linux下的安装</h2>
                  <p>在Linux平台下安装问题不大，同样可以先尝试pip安装，命令如下：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> lxml</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果报错，可以尝试下面的解决方案。</p>
                  <h3 id="CentOS、Red-Hat"><a href="#CentOS、Red-Hat" class="headerlink" title="CentOS、Red Hat"></a>CentOS、Red Hat</h3>
                  <p>对于此类系统，报错主要是因为缺少必要的库。</p>
                  <p>执行如下命令安装所需的库即可：</p>
                  <figure class="highlight gml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo yum groupinstall -<span class="symbol">y</span> development tools</span><br><span class="line">sudo yum install -<span class="symbol">y</span> epel-release libxslt-devel libxml2-devel openssl-devel</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>主要是libxslt-devel和libxml2-devel这两个库，lxml依赖它们。安装好之后，重新尝试pip安装即可。</p>
                  <h3 id="Ubuntu、Debian和Deepin"><a href="#Ubuntu、Debian和Deepin" class="headerlink" title="Ubuntu、Debian和Deepin"></a>Ubuntu、Debian和Deepin</h3>
                  <p>在这些系统下，报错的原因同样可能是缺少了必要的类库，执行如下命令安装：</p>
                  <figure class="highlight q">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-<span class="built_in">get</span> install -y python3-<span class="built_in">dev</span> build-essential libssl-<span class="built_in">dev</span> libffi-<span class="built_in">dev</span> libxml2 libxml2-<span class="built_in">dev</span> libxslt1-<span class="built_in">dev</span> zlib1g-<span class="built_in">dev</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>安装好之后，重新尝试pip安装即可。</p>
                  <h2 id="4-Mac下的安装"><a href="#4-Mac下的安装" class="headerlink" title="4. Mac下的安装"></a>4. Mac下的安装</h2>
                  <p>在Mac平台下，仍然可以首先尝试pip安装，命令如下：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> lxml</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果产生错误，可以执行如下命令将必要的类库安装：</p>
                  <figure class="highlight ada">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">xcode-<span class="keyword">select</span> <span class="comment">--install</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>之后再重新尝试pip安装，就没有问题了。</p>
                  <p>lxml是一个非常重要的库，后面的Beautiful Soup、Scrapy框架都需要用到此库，所以请一定安装成功。</p>
                  <h2 id="5-验证安装"><a href="#5-验证安装" class="headerlink" title="5. 验证安装"></a>5. 验证安装</h2>
                  <p>安装完成之后，可以在Python命令行下测试：</p>
                  <figure class="highlight ruby">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">$ python3</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; import lxml</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果没有错误报出，则证明库已经安装好了。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-25 14:41:12" itemprop="dateCreated datePublished" datetime="2018-01-25T14:41:12+08:00">2018-01-25</time>
                </span>
                <span id="/5180.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 1.3.1-lxml的安装" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.3k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5168.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5168.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 1.3-解析库的安装</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>抓取网页代码之后，下一步就是从网页中提取信息。提取信息的方式有多种多样，可以使用正则来提取，但是写起来相对比较烦琐。这里还有许多强大的解析库，如lxml、Beautiful Soup、pyquery等。此外，还提供了非常强大的解析方法，如XPath解析和CSS选择器解析等，利用它们，我们可以高效便捷地从网页中提取有效信息。</p>
                  <p>本节中，我们就来介绍一下这些库的安装过程。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-25 14:35:54" itemprop="dateCreated datePublished" datetime="2018-01-25T14:35:54+08:00">2018-01-25</time>
                </span>
                <span id="/5168.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 1.3-解析库的安装" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>182</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5163.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5163.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 1.2.6-aiohttp的安装</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>之前介绍的Requests库是一个阻塞式HTTP请求库，当我们发出一个请求后，程序会一直等待服务器响应，直到得到响应后，程序才会进行下一步处理。其实，这个过程比较耗费资源。如果程序可以在这个等待过程中做一些其他的事情，如进行请求的调度、响应的处理等，那么爬取效率一定会大大提高。</p>
                  <p>aiohttp就是这样一个提供异步Web服务的库，从Python 3.5版本开始，Python中加入了<code>async</code>/<code>await</code>关键字，使得回调的写法更加直观和人性化。aiohttp的异步操作借助于<code>async</code>/<code>await</code>关键字的写法变得更加简洁，架构更加清晰。使用异步请求库进行数据抓取时，会大大提高效率，下面我们来看一下这个库的安装方法。</p>
                  <h2 id="1-相关链接"><a href="#1-相关链接" class="headerlink" title="1. 相关链接"></a>1. 相关链接</h2>
                  <ul>
                    <li>官方文档：<a href="http://aiohttp.readthedocs.io/en/stable" target="_blank" rel="noopener">http://aiohttp.readthedocs.io/en/stable</a></li>
                    <li>GitHub：<a href="https://github.com/aio-libs/aiohttp" target="_blank" rel="noopener">https://github.com/aio-libs/aiohttp</a></li>
                    <li>PyPI：<a href="https://pypi.python.org/pypi/aiohttp" target="_blank" rel="noopener">https://pypi.python.org/pypi/aiohttp</a></li>
                  </ul>
                  <h2 id="2-pip安装"><a href="#2-pip安装" class="headerlink" title="2. pip安装"></a>2. pip安装</h2>
                  <p>这里推荐使用pip安装，命令如下：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> aiohttp</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外，官方还推荐安装如下两个库：一个是字符编码检测库cchardet，另一个是加速DNS的解析库aiodns。安装命令如下：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> cchardet aiodns</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="3-测试安装"><a href="#3-测试安装" class="headerlink" title="3. 测试安装"></a>3. 测试安装</h2>
                  <p>安装完成之后，可以在Python命令行下测试：</p>
                  <figure class="highlight ruby">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">$ python3</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; import aiohttp</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果没有错误报出，则证明库已经安装好了。</p>
                  <h2 id="4-结语"><a href="#4-结语" class="headerlink" title="4. 结语"></a>4. 结语</h2>
                  <p>我们会在后面的实例中用到这个库，比如维护一个代理池时，利用异步方式检测大量代理的运行状况，会极大地提升效率。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-25 13:42:51" itemprop="dateCreated datePublished" datetime="2018-01-25T13:42:51+08:00">2018-01-25</time>
                </span>
                <span id="/5163.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 1.2.6-aiohttp的安装" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>712</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5159.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5159.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 1.2.5-PhantomJS的安装</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>PhantomJS 是一个无界面的、可脚本编程的 WebKit 浏览器引擎，它原生支持多种 Web 标准：DOM 操作、CSS 选择器、JSON、Canvas 以及 SVG。</p>
                  <p>Selenium 支持 PhantomJS，这样在运行的时候就不会再弹出一个浏览器了。而且 PhantomJS 的运行效率也很高，还支持各种参数配置，使用非常方便。下面我们就来了解一下 PhantomJS 的安装过程。</p>
                  <h2 id="1-相关链接"><a href="#1-相关链接" class="headerlink" title="1. 相关链接"></a>1. 相关链接</h2>
                  <ul>
                    <li>官方网站：<a href="http://phantomjs.org/" target="_blank" rel="noopener">http://phantomjs.org</a></li>
                    <li>官方文档：<a href="http://phantomjs.org/quick-start.html" target="_blank" rel="noopener">http://phantomjs.org/quick-start.html</a></li>
                    <li>下载地址：<a href="http://phantomjs.org/download.html" target="_blank" rel="noopener">http://phantomjs.org/download.html</a></li>
                    <li>API 接口说明：<a href="http://phantomjs.org/api/command-line.html" target="_blank" rel="noopener">http://phantomjs.org/api/command-line.html</a></li>
                  </ul>
                  <h2 id="2-下载-PhantomJS"><a href="#2-下载-PhantomJS" class="headerlink" title="2. 下载 PhantomJS"></a>2. 下载 PhantomJS</h2>
                  <p>我们需要在官方网站下载对应的安装包，PhantomJS 支持多种操作系统，比如 Windows、Linux、Mac、FreeBSD 等，我们可以选择对应的平台并将安装包下载下来。</p>
                  <p>下载完成后，将 PhantomJS 可执行文件所在的路径配置到环境变量里。比如在 Windows 下，将下载的文件解压之后并打开，会看到一个 bin 文件夹，里面包括一个可执行文件 phantomjs.exe，我们需要将它直接放在配置好环境变量的路径下或者将它所在的路径配置到环境变量里。比如，我们既可以将它直接复制到 Python 的 Scripts 文件夹，也可以将它所在的 bin 目录加入到环境变量。</p>
                  <p>Windows 下环境变量的配置可以参见 1.1 节，Linux 及 Mac 环境变量的配置可以参见 1.2.3 节，在此不再赘述，关键在于将 PhantomJS 的可执行文件所在路径配置到环境变量里。</p>
                  <p>配置成功后，可以在命令行下测试一下，输入：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">phantomjs</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果可以进入到 PhantomJS 的命令行，那就证明配置完成了，如图 1-21 所示。<img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/02/1-21.jpg" alt=""></p>
                  <p>图 1-21 控制台</p>
                  <h2 id="3-验证安装"><a href="#3-验证安装" class="headerlink" title="3. 验证安装"></a>3. 验证安装</h2>
                  <p>在 Selenium 中使用的话，我们只需要将 Chrome 切换为 PhantomJS 即可：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> selenium import webdriver</span><br><span class="line">browser = webdriver.PhantomJS()</span><br><span class="line">browser.<span class="builtin-name">get</span>(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line"><span class="builtin-name">print</span>(browser.current_url)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行之后，我们就不会发现有浏览器弹出了，但实际上 PhantomJS 已经运行起来了。这里我们访问了百度，然后将当前的 URL 打印出来。</p>
                  <p>控制台的输出如下：</p>
                  <figure class="highlight dts">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">https:</span><span class="comment">//www.baidu.com/</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如此一来，我们便完成了 PhantomJS 的配置，后面可以利用它来完成一些页面的抓取。</p>
                  <p>这里我们介绍了 Selenium 对应的三大主流浏览器的对接方式，后面我们会对 Selenium 及各个浏览器的对接方法进行更加深入的探究。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-25 13:38:03" itemprop="dateCreated datePublished" datetime="2018-01-25T13:38:03+08:00">2018-01-25</time>
                </span>
                <span id="/5159.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 1.2.5-PhantomJS的安装" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5153.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5153.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 1.2.4-GeckoDriver的安装</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>上一节中，我们了解了 ChromeDriver 的配置方法，配置完成之后便可以用 Selenium 驱动 Chrome 浏览器来做相应网页的抓取。</p>
                  <p>那么对于 Firefox 来说，也可以使用同样的方式完成 Selenium 的对接，这时需要安装另一个驱动 GeckoDriver。</p>
                  <p>本节中，我们来介绍一下 GeckoDriver 的安装过程。</p>
                  <h2 id="1-相关链接"><a href="#1-相关链接" class="headerlink" title="1. 相关链接"></a>1. 相关链接</h2>
                  <ul>
                    <li>GitHub：<a href="https://github.com/mozilla/geckodriver" target="_blank" rel="noopener">https://github.com/mozilla/geckodriver</a></li>
                    <li>下载地址：<a href="https://github.com/mozilla/geckodriver/releases" target="_blank" rel="noopener">https://github.com/mozilla/geckodriver/releases</a></li>
                  </ul>
                  <h2 id="2-准备工作"><a href="#2-准备工作" class="headerlink" title="2. 准备工作"></a>2. 准备工作</h2>
                  <p>在这之前请确保已经正确安装好了 Firefox 浏览器并可以正常运行，安装过程不再赘述。</p>
                  <h2 id="3-下载-GeckoDriver"><a href="#3-下载-GeckoDriver" class="headerlink" title="3. 下载 GeckoDriver"></a>3. 下载 GeckoDriver</h2>
                  <p>我们可以在 GitHub 上找到 GeckoDriver 的发行版本，当前最新版本为 0.18，下载页面如图 1-18 所示。<img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/02/1-18.png" alt="">图 1-18 GeckoDriver 下载页面</p>
                  <p>这里可以在不同的平台上下载，如 Windows、Mac、Linux、ARM 等平台，我们可以根据自己的系统和位数选择对应的驱动下载，若是 Windows 64 位，就下载 geckodriver-v0.18.0-win64.zip。</p>
                  <h2 id="4-环境变量配置"><a href="#4-环境变量配置" class="headerlink" title="4. 环境变量配置"></a>4. 环境变量配置</h2>
                  <p>在 Windows 下，可以直接将 geckodriver.exe 文件拖到 Python 的 Scripts 目录下，如图 1-19 所示。<img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/02/1-19.jpg" alt=""></p>
                  <p>图 1-19 将 geckodriver.exe 文件拖到 Python Scripts 目录</p>
                  <p>此外，也可以单独将其所在路径配置到环境变量，具体的配置方法请参 1.1 节。</p>
                  <p>在 Linux 和 Mac 下，需要将可执行文件配置到环境变量或将文件移动到属于环境变量的目录里。</p>
                  <p>例如，要移动文件到/usr/bin 目录。首先在命令行模式下进入其所在路径，然后将其移动到/usr/bin：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo mv geckodriver <span class="regexp">/usr/</span>bin</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>当然，也可以将 GeckoDriver 配置到$PATH。首先，可以将可执行文件放到某一目录，目录可以任意选择，例如将当前可执行文件放在/usr/local/geckodriver 目录下。接下来可以修改~/.profile 文件，命令如下：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">vi</span> ~/.<span class="keyword">profile</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后添加如下一句配置：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=<span class="string">"<span class="variable">$PATH</span>:/usr/local/geckodriver"</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>保存后执行如下命令即可完成配置：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">source</span> ~/.<span class="keyword">profile</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="5-验证安装"><a href="#5-验证安装" class="headerlink" title="5. 验证安装"></a>5. 验证安装</h2>
                  <p>配置完成后，就可以在命令行下直接执行<code>geckodriver</code>命令测试：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">geckodriver</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这时如果控制台有类似图 1-20 所示的输出，则证明 GeckoDriver 的环境变量配置好了。<img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/02/1-20.jpg" alt=""></p>
                  <p>图 1-20 控制台输出</p>
                  <p>随后执行如下 Python 代码，在程序中测试一下：</p>
                  <figure class="highlight armasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">from</span> <span class="keyword">selenium </span><span class="meta">import</span> webdriver</span><br><span class="line"><span class="keyword">browser </span>= webdriver.Firefox()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行之后，若弹出一个空白的 Firefox 浏览器，则证明所有的配置都没有问题；如果没有弹出，请检查之前的每一步配置。</p>
                  <p>如果没有问题，接下来就可以利用 Firefox 配合 Selenium 来做网页抓取了。</p>
                  <h2 id="6-结语"><a href="#6-结语" class="headerlink" title="6. 结语"></a>6. 结语</h2>
                  <p>现在我们就可以使用 Chrome 或 Firefox 进行网页抓取了，但是这样可能有个不方便之处：因为程序运行过程中需要一直开着浏览器，在爬取网页的过程中浏览器可能一直动来动去。目前最新的 Chrome 浏览器版本已经支持无界面模式了，但如果版本较旧的话，就不支持。所以这里还有另一种选择，那就是安装一个无界面浏览器 PhantomJS，此时抓取过程会在后台运行，不会再有窗口出现。在下一节中，我们就来了解一下 PhantomJS 的相关安装方法。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-25 13:29:52" itemprop="dateCreated datePublished" datetime="2018-01-25T13:29:52+08:00">2018-01-25</time>
                </span>
                <span id="/5153.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 1.2.4-GeckoDriver的安装" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.5k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5135.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5135.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 1.2.3-ChromeDriver的安装</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>前面我们成功安装好了 Selenium 库，但是它是一个自动化测试工具，需要浏览器来配合使用，本节中我们就介绍一下 Chrome 浏览器及 ChromeDriver 驱动的配置。</p>
                  <p>首先，下载 Chrome 浏览器，方法有很多，在此不再赘述。</p>
                  <p>随后安装 ChromeDriver。因为只有安装 ChromeDriver，才能驱动 Chrome 浏览器完成相应的操作。下面我们来介绍下怎样安装 ChromeDriver。</p>
                  <h2 id="1-相关链接"><a href="#1-相关链接" class="headerlink" title="1. 相关链接"></a>1. 相关链接</h2>
                  <ul>
                    <li>官方网站：<a href="https://sites.google.com/a/chromium.org/chromedriver" target="_blank" rel="noopener">https://sites.google.com/a/chromium.org/chromedriver</a></li>
                    <li>下载地址：<a href="https://chromedriver.storage.googleapis.com/index.html" target="_blank" rel="noopener">https://chromedriver.storage.googleapis.com/index.html</a></li>
                  </ul>
                  <h2 id="2-准备工作"><a href="#2-准备工作" class="headerlink" title="2. 准备工作"></a>2. 准备工作</h2>
                  <p>在这之前请确保已经正确安装好了 Chrome 浏览器并可以正常运行，安装过程不再赘述。</p>
                  <h2 id="3-查看版本"><a href="#3-查看版本" class="headerlink" title="3. 查看版本"></a>3. 查看版本</h2>
                  <p>点击 Chrome 菜单“帮助”→“关于 Google Chrome”，即可查看 Chrome 的版本号，如图 1-14 所示。<img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/02/1-14.jpg" alt=""></p>
                  <p>图 1-14 Chrome 版本号</p>
                  <p>这里我的 Chrome 版本是 58.0。</p>
                  <p>请记住 Chrome 版本号，因为选择 ChromeDriver 版本时需要用到。</p>
                  <h2 id="4-下载-ChromeDriver"><a href="#4-下载-ChromeDriver" class="headerlink" title="4. 下载 ChromeDriver"></a>4. 下载 ChromeDriver</h2>
                  <p>打开 ChromeDriver 的官方网站，可以看到最新版本为 2.31，其支持的 Chrome 浏览器版本为 58~60，官网页面如图 1-15 所示。</p>
                  <blockquote>
                    <p>更新：现在 2020 年，Chrome 版本已经更新到 80+，请以最新的 ChromeDriver 为准！<a href="https://chromedriver.chromium.org/downloads" target="_blank" rel="noopener">https://chromedriver.chromium.org/downloads</a></p>
                  </blockquote>
                  <p><img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/02/1-15.jpg" alt=""></p>
                  <p>图 1-15 官网页面</p>
                  <p>如果你的 Chrome 版本号是 58~60，那么可以选择此版本下载。</p>
                  <p>如果你的 Chrome 版本号不在此范围，可以继续查看之前的 ChromeDriver 版本。每个版本都有相应的支持 Chrome 版本的介绍，请找好自己的 Chrome 浏览器版本对应的 ChromeDriver 版本再下载，否则可能无法正常工作。</p>
                  <p>找好对应的版本号后，随后到 ChromeDriver 镜像站下载对应的安装包即可：<a href="https://chromedriver.storage.googleapis.com/index.html" target="_blank" rel="noopener">https://chromedriver.storage.googleapis.com/index.html</a>。在不同平台下，可以下载不同的安装包。</p>
                  <h2 id="5-环境变量配置"><a href="#5-环境变量配置" class="headerlink" title="5. 环境变量配置"></a>5. 环境变量配置</h2>
                  <p>下载完成后，将 ChromeDriver 的可执行文件配置到环境变量下。</p>
                  <p>在 Windows 下，建议直接将 chromedriver.exe 文件拖到 Python 的 Scripts 目录下，如图 1-16 所示。</p>
                  <p><img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/02/1-16.jpg" alt=""></p>
                  <p>图 1-16 Python Scripts 目录</p>
                  <p>此外，也可以单独将其所在路径配置到环境变量，具体的配置方法请参见 1.1 节。</p>
                  <p>在 Linux 和 Mac 下，需要将可执行文件配置到环境变量或将文件移动到属于环境变量的目录里。</p>
                  <p>例如，要移动文件到/usr/bin 目录。首先，需要在命令行模式下进入其所在路径，然后将其移动到/usr/bin：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo mv chromedriver <span class="regexp">/usr/</span>bin</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>当然，也可以将 ChromeDriver 配置到$PATH。首先，可以将可执行文件放到某一目录，目录可以任意选择，例如将当前可执行文件放在/usr/local/chromedriver 目录下，接下来可以修改~/.profile 文件，相关命令如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=<span class="string">"<span class="variable">$PATH</span>:/usr/local/chromedriver"</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>保存后执行如下命令：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">source</span> ~/.<span class="keyword">profile</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>即可完成环境变量的添加。</p>
                  <h2 id="6-验证安装"><a href="#6-验证安装" class="headerlink" title="6. 验证安装"></a>6. 验证安装</h2>
                  <p>配置完成后，就可以在命令行下直接执行<code>chromedriver</code>命令了：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">chromedriver</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果输入控制台有类似图 1-17 所示的输出，则证明 ChromeDriver 的环境变量配置好了。</p>
                  <p><img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/02/1-17.jpg" alt=""></p>
                  <p>图 1-17 控制台输出</p>
                  <p>随后再在程序中测试，执行如下 Python 代码：</p>
                  <figure class="highlight armasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">from</span> <span class="keyword">selenium </span><span class="meta">import</span> webdriver</span><br><span class="line"><span class="keyword">browser </span>= webdriver.Chrome()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行之后，如果弹出一个空白的 Chrome 浏览器，则证明所有的配置都没有问题。如果没有弹出，请检查之前的每一步配置。</p>
                  <p>如果弹出后闪退，则可能是 ChromeDriver 版本和 Chrome 版本不兼容，请更换 ChromeDriver 版本。</p>
                  <p>如果没有问题，接下来就可以利用 Chrome 来做网页抓取了。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-25 10:46:39" itemprop="dateCreated datePublished" datetime="2018-01-25T10:46:39+08:00">2018-01-25</time>
                </span>
                <span id="/5135.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 1.2.3-ChromeDriver的安装" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.8k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5141.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a href="/5141.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 1.2.2-Selenium的安装</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>Selenium是一个自动化测试工具，利用它我们可以驱动浏览器执行特定的动作，如点击、下拉等操作。对于一些JavaScript渲染的页面来说，这种抓取方式非常有效。下面我们来看看Selenium的安装过程。</p>
                  <h2 id="1-相关链接"><a href="#1-相关链接" class="headerlink" title="1. 相关链接"></a>1. 相关链接</h2>
                  <ul>
                    <li>官方网站：<a href="http://www.seleniumhq.org/" target="_blank" rel="noopener">http://www.seleniumhq.org</a></li>
                    <li>GitHub：<a href="https://github.com/SeleniumHQ/selenium/tree/master/py" target="_blank" rel="noopener">https://github.com/SeleniumHQ/selenium/tree/master/py</a></li>
                    <li>PyPI：<a href="https://pypi.python.org/pypi/selenium" target="_blank" rel="noopener">https://pypi.python.org/pypi/selenium</a></li>
                    <li>官方文档：<a href="http://selenium-python.readthedocs.io/" target="_blank" rel="noopener">http://selenium-python.readthedocs.io</a></li>
                    <li>中文文档：<a href="http://selenium-python-zh.readthedocs.io/" target="_blank" rel="noopener">http://selenium-python-zh.readthedocs.io</a></li>
                  </ul>
                  <h2 id="2-pip安装"><a href="#2-pip安装" class="headerlink" title="2. pip安装"></a>2. pip安装</h2>
                  <p>这里推荐直接使用pip安装，执行如下命令即可：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> selenium</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="3-wheel安装"><a href="#3-wheel安装" class="headerlink" title="3. wheel安装"></a>3. wheel安装</h2>
                  <p>此外，也可以到PyPI下载对应的wheel文件进行安装（下载地址：<a href="https://pypi.python.org/pypi/selenium/#downloads" target="_blank" rel="noopener">https://pypi.python.org/pypi/selenium/#downloads</a>），如最新版本为3.4.3，则下载selenium-3.4.3-py2.py3-none-any.whl即可。</p>
                  <p>然后进入wheel文件目录，使用pip安装：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">pip3</span> <span class="selector-tag">install</span> <span class="selector-tag">selenium-3</span><span class="selector-class">.4</span><span class="selector-class">.3-py2</span><span class="selector-class">.py3-none-any</span><span class="selector-class">.whl</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="4-验证安装"><a href="#4-验证安装" class="headerlink" title="4. 验证安装"></a>4. 验证安装</h2>
                  <p>进入Python命令行交互模式，导入Selenium包，如果没有报错，则证明安装成功：</p>
                  <figure class="highlight ruby">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">$ python3</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; import selenium</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>但这样做还不够，因为我们还需要用浏览器（如Chrome、Firefox等）来配合Selenium工作。</p>
                  <p>后面我们会介绍Chrome、Firefox、PhantomJS三种浏览器的配置方式。有了浏览器，我们才可以配合Selenium进行页面的抓取。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-25 10:07:20" itemprop="dateCreated datePublished" datetime="2018-01-25T10:07:20+08:00">2018-01-25</time>
                </span>
                <span id="/5141.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 1.2.2-Selenium的安装" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>799</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5132.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5132.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 1.2.1-Requests的安装</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>由于Requests属于第三方库，也就是Python默认不会自带这个库，所以需要我们手动安装。下面我们首先看一下它的安装过程。</p>
                  <h2 id="1-相关链接"><a href="#1-相关链接" class="headerlink" title="1. 相关链接"></a>1. 相关链接</h2>
                  <ul>
                    <li>GitHub：<a href="https://github.com/requests/requests" target="_blank" rel="noopener">https://github.com/requests/requests</a></li>
                    <li>PyPI：<a href="https://pypi.python.org/pypi/requests" target="_blank" rel="noopener">https://pypi.python.org/pypi/requests</a></li>
                    <li>官方文档：<a href="http://www.python-requests.org/" target="_blank" rel="noopener">http://www.python-requests.org</a></li>
                    <li>中文文档：<a href="http://docs.python-requests.org/zh_CN/latest" target="_blank" rel="noopener">http://docs.python-requests.org/zh_CN/latest</a></li>
                  </ul>
                  <h2 id="2-pip安装"><a href="#2-pip安装" class="headerlink" title="2. pip安装"></a>2. pip安装</h2>
                  <p>无论是Windows、Linux还是Mac，都可以通过pip这个包管理工具来安装。</p>
                  <p>在命令行界面中运行如下命令，即可完成Requests库的安装：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> requests</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这是最简单的安装方式，推荐使用这种方法安装。</p>
                  <h2 id="3-wheel安装"><a href="#3-wheel安装" class="headerlink" title="3. wheel安装"></a>3. wheel安装</h2>
                  <p>wheel是Python的一种安装包，其后缀为.whl，在网速较差的情况下可以选择下载wheel文件再安装，然后直接用<code>pip3</code>命令加文件名安装即可。</p>
                  <p>不过在这之前需要先安装wheel库，安装命令如下：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> wheel</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后到PyPI上下载对应的wheel文件，如最新版本为2.17.3，则打开<a href="https://pypi.python.org/pypi/requests/2.17.3#downloads" target="_blank" rel="noopener">https://pypi.python.org/pypi/requests/2.17.3#downloads</a>，下载requests-2.17.3-py2.py3-none-any.whl到本地。</p>
                  <p>随后在命令行界面进入wheel文件目录，利用<code>pip</code>安装即可：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">pip3</span> <span class="selector-tag">install</span> <span class="selector-tag">requests-2</span><span class="selector-class">.17</span><span class="selector-class">.3-py2</span><span class="selector-class">.py3-none-any</span><span class="selector-class">.whl</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们也可以完成Requests的安装。</p>
                  <h2 id="4-源码安装"><a href="#4-源码安装" class="headerlink" title="4. 源码安装"></a>4. 源码安装</h2>
                  <p>如果你不想用pip来安装，或者想获取某一特定版本，可以选择下载源码安装。</p>
                  <p>此种方式需要先找到此库的源码地址，然后下载下来再用命令安装。</p>
                  <p>Requests项目的地址是：<a href="https://github.com/kennethreitz/requests" target="_blank" rel="noopener">https://github.com/kennethreitz/requests</a>。</p>
                  <p>可以通过Git来下载源代码：</p>
                  <figure class="highlight crmsh">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">git <span class="keyword">clone</span> <span class="title">git</span>://github.com/kennethreitz/requests.git</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>或通过<code>curl</code>下载：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl -OL https:<span class="regexp">//gi</span>thub.com<span class="regexp">/kennethreitz/</span>requests<span class="regexp">/tarball/m</span>aster</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>下载下来之后，进入目录，执行如下命令即可安装：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">cd</span> requests</span><br><span class="line"><span class="keyword">python3</span> setup.<span class="keyword">py</span> install</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>命令执行结束后即可完成Requests的安装。由于这种安装方式比较烦琐，后面不再赘述。</p>
                  <h2 id="5-验证安装"><a href="#5-验证安装" class="headerlink" title="5. 验证安装"></a>5. 验证安装</h2>
                  <p>为了验证库是否已经安装成功，可以在命令行模式测试一下：</p>
                  <figure class="highlight ruby">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">$ python3</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; import requests</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>首先输入<code>python3</code>，进入命令行模式，然后输入上述内容，如果什么错误提示也没有，就证明已经成功安装了Requests。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-25 09:50:40" itemprop="dateCreated datePublished" datetime="2018-01-25T09:50:40+08:00">2018-01-25</time>
                </span>
                <span id="/5132.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 1.2.1-Requests的安装" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5081.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5081.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 1.2-请求库的安装</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>爬虫可以简单分为几步：抓取页面、分析页面和存储数据。</p>
                  <p>在抓取页面的过程中，我们需要模拟浏览器向服务器发出请求，所以需要用到一些Python库来实现HTTP请求操作。在本书中，我们用到的第三方库有Requests、Selenium和aiohttp等。</p>
                  <p>在本节中，我们介绍一下这些请求库的安装方法。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-25 09:40:19" itemprop="dateCreated datePublished" datetime="2018-01-25T09:40:19+08:00">2018-01-25</time>
                </span>
                <span id="/5081.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 1.2-请求库的安装" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>145</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5059.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5059.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 1.1-Python3的安装</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>既然要用Python 3开发爬虫，那么第一步一定是安装Python 3。这里会介绍Windows、Linux和Mac三大平台下的安装过程。</p>
                  <h2 id="1-相关链接"><a href="#1-相关链接" class="headerlink" title="1. 相关链接"></a>1. 相关链接</h2>
                  <ul>
                    <li>官方网站：<a href="http://python.org/" target="_blank" rel="noopener">http://python.org</a></li>
                    <li>下载地址：<a href="https://www.python.org/downloads" target="_blank" rel="noopener">https://www.python.org/downloads</a></li>
                    <li>第三方库：<a href="https://pypi.python.org/pypi" target="_blank" rel="noopener">https://pypi.python.org/pypi</a></li>
                    <li>官方文档：<a href="https://docs.python.org/3" target="_blank" rel="noopener">https://docs.python.org/3</a></li>
                    <li>中文教程：<a href="http://www.runoob.com/python3/python3-tutorial.html" target="_blank" rel="noopener">http://www.runoob.com/python3/python3-tutorial.html</a></li>
                    <li>Awesome Python：<a href="https://github.com/vinta/awesome-python" target="_blank" rel="noopener">https://github.com/vinta/awesome-python</a></li>
                    <li>Awesome Python中文版：<a href="https://github.com/jobbole/awesome-python-cn" target="_blank" rel="noopener">https://github.com/jobbole/awesome-python-cn</a></li>
                  </ul>
                  <h2 id="2-Windows下的安装"><a href="#2-Windows下的安装" class="headerlink" title="2. Windows下的安装"></a>2. Windows下的安装</h2>
                  <p>在Windows下安装Python 3的方式有两种。</p>
                  <ul>
                    <li>一种是通过Anaconda安装，它提供了Python的科学计算环境，里面自带了Python以及常用的库。如果选用了这种方式，后面的环境配置方式会更加简便。</li>
                    <li>另一种是直接下载安装包安装，即标准的安装方式。</li>
                  </ul>
                  <p>下面我们依次介绍这两种安装方式，任选其一即可。</p>
                  <h3 id="1-Anaconda安装"><a href="#1-Anaconda安装" class="headerlink" title="(1) Anaconda安装"></a>(1) Anaconda安装</h3>
                  <p>Anaconda的官方下载链接为<a href="https://www.continuum.io/downloads" target="_blank" rel="noopener">https://www.continuum.io/downloads</a>，选择Python 3版本的安装包下载即可，如图1-1所示。</p>
                  <p><img src="http://epub.ituring.com.cn/api/storage/getbykey/screenshow?key=1708002eb50fe93aef25" alt="图像说明文字"></p>
                  <p>图1-1 Anaconda Windows下载页面</p>
                  <p>如果下载速度过慢，可以选择使用清华大学镜像，下载列表链接为<a href="https://mirrors.tuna.tsinghua.edu.cn/anaconda/archive/" target="_blank" rel="noopener">https://mirrors.tuna.tsinghua.edu.cn/anaconda/archive/</a>，使用说明链接为<a href="https://mirrors.tuna.tsinghua.edu.cn/help/anaconda/" target="_blank" rel="noopener">https://mirrors.tuna.tsinghua.edu.cn/help/anaconda/</a>。</p>
                  <p>下载完成之后，直接双击安装包安装即可。安装完成之后，Python 3的环境就配置好了。</p>
                  <h3 id="2-安装包安装"><a href="#2-安装包安装" class="headerlink" title="(2) 安装包安装"></a>(2) 安装包安装</h3>
                  <p>我们推荐直接下载安装包来安装，此时可以直接到官方网站下载Python 3的安装包：<a href="https://www.python.org/downloads/" target="_blank" rel="noopener">https://www.python.org/downloads/</a>。</p>
                  <p>写书时，Python的最新版本1是3.6.2，其下载链接为<a href="https://www.python.org/downloads/release/python-362/" target="_blank" rel="noopener">https://www.python.org/downloads/release/python-362/</a>，下载页面如图1-2所示。需要说明的是，实际的Python最新版本以官网为准。</p>
                  <p><img src="http://epub.ituring.com.cn/api/storage/getbykey/screenshow?key=170831c80abe71970c38" alt="图像说明文字"></p>
                  <p>图1-2 Python下载页面</p>
                  <blockquote>
                    <ol>
                      <li>若无特别说明，书中的最新版本均为作者写书时的情况，后面不再一一说明。</li>
                    </ol>
                  </blockquote>
                  <p>64位系统可以下载Windows x86-64 executable installer，32位系统可以下载Windows x86 executable installer。</p>
                  <p>下载完成之后，直接双击Python安装包，然后通过图形界面安装，接着设置Python的安装路径，完成后将Python 3和Python 3的Scripts目录配置到环境变量即可。</p>
                  <p>关于环境变量的配置，此处以Windows 10系统为例进行演示。</p>
                  <p>假如安装后的Python 3路径为C:\Python36，从资源管理器中打开该路径，如图1-3所示。</p>
                  <p><img src="http://epub.ituring.com.cn/api/storage/getbykey/screenshow?key=17082965ee593cae2365" alt="图像说明文字"></p>
                  <p>图1-3 Python安装目录</p>
                  <p>将该路径复制下来。</p>
                  <p>随后，右击“计算机”，从中选择“属性”，此时将打开系统属性窗口，如图1-4所示。</p>
                  <p><img src="http://epub.ituring.com.cn/api/storage/getbykey/screenshow?key=1708cdd34354955d1fde" alt="图像说明文字"></p>
                  <p>图1-4 系统属性</p>
                  <p>点击左侧的“高级系统设置”，即可看到在弹出的对话框下方看到“环境变量”按钮，如图1-5所示。</p>
                  <p><img src="http://epub.ituring.com.cn/api/storage/getbykey/screenshow?key=1708d35844164e63b26a" alt="图像说明文字"></p>
                  <p>图1-5 高级系统设置</p>
                  <p>点击“环境变量”按钮，找到系统变量下的Path变量，随后点击“编辑”按钮，如图1-6所示。</p>
                  <p><img src="http://epub.ituring.com.cn/api/storage/getbykey/screenshow?key=1708e0b523729330b0e8" alt="图像说明文字"></p>
                  <p>图1-6 环境变量</p>
                  <p>随后点击“新建”，新建一个条目，将刚才复制的C:\Python36复制进去。这里需要说明的是，此处的路径就是你的Python 3安装目录，请自行替换。然后，再把C:\Python36\Scripts路径复制进去，如图1-7所示。</p>
                  <p><img src="http://epub.ituring.com.cn/api/storage/getbykey/screenshow?key=1708d8f0669ffcf518a7" alt="图像说明文字"></p>
                  <p>图1-7 编辑环境变量</p>
                  <p>最后，点击“确定”按钮即可完成环境变量的配置。</p>
                  <p>配置好环境变量后，我们就可以在命令行中直接执行环境变量路径下的可执行文件了，如<code>python</code>、<code>pip</code>等命令。</p>
                  <h3 id="3-添加别名"><a href="#3-添加别名" class="headerlink" title="(3) 添加别名"></a>(3) 添加别名</h3>
                  <p>上面这两种安装方式任选其一即可完成安装，但如果之前安装过Python 2的话，可能会导致版本冲突问题，比如在命令行下输入<code>python</code>就不知道是调用的Python 2还是Python 3了。为了解决这个问题，建议将安装目录中的python.exe复制一份，命名为python3.exe，这样便可以调用<code>python3</code>命令了。实际上，它和<code>python</code>命令是完全一致的，这样只是为了可以更好地区分Python版本。当然，如果没有安装过Python 2的话，也建议添加此别名，添加完毕之后的效果如图1-8所示。</p>
                  <p><img src="http://epub.ituring.com.cn/api/storage/getbykey/screenshow?key=17089ea4c3d0be341d8e" alt="图像说明文字"></p>
                  <p>图1-8 添加别名</p>
                  <p>对于pip来说，安装包中自带了pip3.exe可执行文件，我们也可以直接使用<code>pip3</code>命令，无需额外配置。</p>
                  <h3 id="4-测试验证"><a href="#4-测试验证" class="headerlink" title="(4) 测试验证"></a>(4) 测试验证</h3>
                  <p>安装完成后，可以通过命令行测试一下安装是否成功。在“开始”菜单中搜索<code>cmd</code>，找到命令提示符，此时就进入命令行模式了。输入<code>python</code>，测试一下能否成功调用Python。如果添加了别名的话，可以输入<code>python3</code>测试，这里输入的是<code>python3</code>，测试结果如图1-9所示。</p>
                  <p><img src="http://epub.ituring.com.cn/api/storage/getbykey/screenshow?key=17089590fa9f68124670" alt="图像说明文字"></p>
                  <p>图1-9 测试验证页面</p>
                  <p>输出结果类似如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">$ python3</span><br><span class="line">Python 3.6.1 (v3.6.1:69c0db5, Mar 21 2017, 17:54:52) [MSC v.1900 32 bit (Intel)] on win32</span><br><span class="line">Type <span class="string">"help"</span>, <span class="string">"copyright"</span>, <span class="string">"credits"</span> <span class="keyword">or</span> <span class="string">"license"</span> <span class="keyword">for</span> more information.</span><br><span class="line">&gt;&gt;&gt; <span class="builtin-name">print</span>(<span class="string">'Hello World'</span>)</span><br><span class="line">Hello World</span><br><span class="line">&gt;&gt;&gt; exit()</span><br><span class="line">$ pip3 -V</span><br><span class="line">pip 9.0.1 <span class="keyword">from</span> c:\python36\lib\site-packages (python 3.6)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果出现了类似上面的提示，则证明Python 3和pip 3均安装成功；如果提示命令不存在，那么请检查下环境变量的配置情况。</p>
                  <h2 id="3-Linux下的安装"><a href="#3-Linux下的安装" class="headerlink" title="3. Linux下的安装"></a>3. Linux下的安装</h2>
                  <p>Linux下的安装方式有多种：命令安装、源码安装和Anaconda安装。</p>
                  <p>使用源码安装需要自行编译，时间较长。推荐使用系统自带的命令或Anaconda安装，简单、高效。这里分别讲解这3种安装方式。</p>
                  <h3 id="1-命令行安装"><a href="#1-命令行安装" class="headerlink" title="(1) 命令行安装"></a>(1) 命令行安装</h3>
                  <p>不同的Linux发行版本的安装方式又有不同，在此分别予以介绍。</p>
                  <h4 id="CentOS、Red-Hat"><a href="#CentOS、Red-Hat" class="headerlink" title="CentOS、Red Hat"></a>CentOS、Red Hat</h4>
                  <p>如果是CentOS或Red Hat版本，则使用<code>yum</code>命令安装即可。</p>
                  <p>下面列出了Python 3.5和Python 3.4两个版本的安装方法，可以自行选择。</p>
                  <p>Python 3.5版本：</p>
                  <figure class="highlight gml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo yum install -<span class="symbol">y</span> https:<span class="comment">//centos7.iuscommunity.org/ius-release.rpm</span></span><br><span class="line">sudo yum update</span><br><span class="line">sudo yum install -<span class="symbol">y</span> python35u python35u-libs python35u-devel python35u-pip</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>执行完毕后，便可以成功安装Python 3.5及pip 3了。</p>
                  <p>Python 3.4版本：</p>
                  <figure class="highlight properties">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">sudo</span> <span class="string">yum groupinstall -y development tools</span></span><br><span class="line"><span class="attr">sudo</span> <span class="string">yum install -y epel-release python34-devel  libxslt-devel libxml2-devel openssl-devel</span></span><br><span class="line"><span class="attr">sudo</span> <span class="string">yum install -y python34</span></span><br><span class="line"><span class="attr">sudo</span> <span class="string">yum install -y python34-setuptools</span></span><br><span class="line"><span class="attr">sudo</span> <span class="string">easy_install-3.4 pip</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>执行完毕后，便可以成功安装Python 3.4及pip 3了。</p>
                  <h4 id="Ubuntu、Debian和Deepin"><a href="#Ubuntu、Debian和Deepin" class="headerlink" title="Ubuntu、Debian和Deepin"></a>Ubuntu、Debian和Deepin</h4>
                  <p>首先安装Python 3，这里使用<code>apt-get</code>安装即可。在安装前，还需安装一些基础库，相关命令如下：</p>
                  <figure class="highlight q">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-<span class="built_in">get</span> install -y python3-<span class="built_in">dev</span> build-essential libssl-<span class="built_in">dev</span> libffi-<span class="built_in">dev</span> libxml2 libxml2-<span class="built_in">dev</span> libxslt1-<span class="built_in">dev</span> zlib1g-<span class="built_in">dev</span> libcurl4-openssl-<span class="built_in">dev</span></span><br><span class="line">sudo apt-<span class="built_in">get</span> install -y python3</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>执行完上述命令后，就可以成功安装Python 3了。</p>
                  <p>然后还需要安装pip 3，这里仍然使用<code>apt-get</code>安装即可，相关命令如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-<span class="builtin-name">get</span> install -y python3-pip</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>执行完毕后，便可以成功安装Python 3及pip 3了。</p>
                  <h3 id="2-源码安装"><a href="#2-源码安装" class="headerlink" title="(2) 源码安装"></a>(2) 源码安装</h3>
                  <p>如果命令行的安装方式有问题，还可以下载Python 3源码进行安装。</p>
                  <p>源码下载地址为<a href="https://www.python.org/ftp/python/" target="_blank" rel="noopener">https://www.python.org/ftp/python/</a>，可以自行选用想要的版本进行安装。这里以Python 3.6.2为例进行说明，安装路径设置为/usr/local/python3。</p>
                  <p>首先，创建安装目录，相关命令如下：</p>
                  <figure class="highlight maxima">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo <span class="built_in">mkdir</span> /usr/<span class="built_in">local</span>/python3</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>随后下载安装包并解压进入，相关命令如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">wget --no-check-certificate https:<span class="comment">//www.python.org/ftp/python/3.6.2/Python-3.6.2.tgz</span></span><br><span class="line">tar -xzvf Python<span class="number">-3.6</span><span class="number">.2</span>.tgz</span><br><span class="line">cd Python<span class="number">-3.6</span><span class="number">.2</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来，编译安装。所需的时间可能较长，请耐心等待，命令如下：</p>
                  <figure class="highlight gauss">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo ./configure --prefix=/usr/<span class="keyword">local</span>/python3</span><br><span class="line">sudo <span class="built_in">make</span></span><br><span class="line">sudo <span class="built_in">make</span> install</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>安装完成之后，创建Python 3链接，相关命令如下：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo ln -s <span class="regexp">/usr/</span>local<span class="regexp">/python3/</span>bin<span class="regexp">/python3 /u</span>sr<span class="regexp">/bin/</span>python3</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>随后下载pip安装包并安装，命令如下：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">wget --<span class="keyword">no</span>-check-certificate http<span class="variable">s:</span>//github.<span class="keyword">com</span>/pypa/pip/archive/<span class="number">9.0</span>.<span class="number">1</span>.tar.gz</span><br><span class="line">tar -xzvf <span class="number">9.0</span>.<span class="number">1</span>.tar.gz</span><br><span class="line"><span class="keyword">cd</span> pip-<span class="number">9.0</span>.<span class="number">1</span></span><br><span class="line"><span class="keyword">python3</span> setup.<span class="keyword">py</span> install</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>安装完成后再创建pip 3链接，相关命令如下：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo ln -s <span class="regexp">/usr/</span>local<span class="regexp">/python3/</span>bin<span class="regexp">/pip /u</span>sr<span class="regexp">/bin/</span>pip3</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就成功安装好了Python 3及pip 3。</p>
                  <h3 id="3-Anaconda安装"><a href="#3-Anaconda安装" class="headerlink" title="(3) Anaconda安装"></a>(3) Anaconda安装</h3>
                  <p>Anaconda同样支持Linux，其官方下载链接为<a href="http://epub.ituring.com.cn/article/edit/[https://www.continuum.io/downloads" target="_blank" rel="noopener">https://www.continuum.io/downloads</a>，选择Python 3版本的安装包下载即可，如图1-10所示。</p>
                  <p><img src="http://epub.ituring.com.cn/api/storage/getbykey/screenshow?key=1708a13922b218a1bbb2" alt="图像说明文字"></p>
                  <p>图1-10 Anaconda Linux下载页面</p>
                  <p>如果下载速度过慢，同样可以使用清华镜像，具体可参考Windows部分的介绍，在此不再赘述。</p>
                  <h3 id="4-测试验证-1"><a href="#4-测试验证-1" class="headerlink" title="(4) 测试验证"></a>(4) 测试验证</h3>
                  <p>在命令行界面下测试Python 3和pip 3是否安装成功：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">$ python3</span><br><span class="line">Python <span class="number">3.5</span>.<span class="number">2</span> (default, Nov <span class="number">17</span> <span class="number">2016</span>, <span class="number">17</span>:<span class="number">05</span>:<span class="number">23</span>) </span><br><span class="line">Type <span class="string">"help"</span>, <span class="string">"copyright"</span>, <span class="string">"credits"</span> or <span class="string">"license"</span> <span class="keyword">for</span> more information.</span><br><span class="line">&gt;&gt;&gt; <span class="keyword">exit</span>()</span><br><span class="line">$ pip3 -V</span><br><span class="line">pip <span class="number">8.1</span>.<span class="number">1</span> from <span class="regexp">/usr/</span>lib<span class="regexp">/python3/</span>dist-packages (python <span class="number">3.5</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>若出现类似上面的提示，则证明Python 3和pip 3安装成功。</p>
                  <h2 id="4-Mac下的安装"><a href="#4-Mac下的安装" class="headerlink" title="4. Mac下的安装"></a>4. Mac下的安装</h2>
                  <p>在Mac下同样有多种安装方式，如Homebrew、安装包安装、Anaconda安装等，这里推荐使用Homebrew安装。</p>
                  <h3 id="1-Homebrew安装"><a href="#1-Homebrew安装" class="headerlink" title="(1) Homebrew安装"></a>(1) Homebrew安装</h3>
                  <p>Homebrew是Mac平台下强大的包管理工具，其官方网站是<a href="https://brew.sh/" target="_blank" rel="noopener">https://brew.sh/</a>。</p>
                  <p>执行如下命令，即可安装Homebrew：</p>
                  <figure class="highlight sql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/<span class="keyword">install</span>/<span class="keyword">master</span>/<span class="keyword">install</span>)<span class="string">"</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>安装完成后，便可以使用<code>brew</code>命令安装Python 3和pip 3了：</p>
                  <figure class="highlight mipsasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">brew </span><span class="keyword">install </span>python3</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>命令执行完成后，我们发现Python 3和pip 3均已成功安装。</p>
                  <h3 id="2-安装包安装-1"><a href="#2-安装包安装-1" class="headerlink" title="(2) 安装包安装"></a>(2) 安装包安装</h3>
                  <p>可以到官方网站下载Python 3安装包。链接为<a href="https://www.python.org/downloads/" target="_blank" rel="noopener">https://www.python.org/downloads/</a>，页面如图1-2所示。</p>
                  <p>在Mac平台下，可以选择下载Mac OS X 64-bit/32-bit installer，下载完成后，打开安装包按照提示安装即可。</p>
                  <h3 id="3-Anaconda安装-1"><a href="#3-Anaconda安装-1" class="headerlink" title="(3) Anaconda安装"></a>(3) Anaconda安装</h3>
                  <p>Anaconda同样支持Mac，其官方下载链接为：<a href="http://epub.ituring.com.cn/article/edit/[https://www.continuum.io/downloads" target="_blank" rel="noopener">https://www.continuum.io/downloads</a>，选择Python 3版本的安装包下载即可，如图1-11所示。</p>
                  <p><img src="http://epub.ituring.com.cn/api/storage/getbykey/screenshow?key=17089b034fd975411c37" alt="图像说明文字"></p>
                  <p>图1-11 Anaconda Mac下载页面</p>
                  <p>如果下载速度过慢，同样可以使用清华镜像，具体可参考Windows部分的介绍，在此不再赘述。</p>
                  <h3 id="4-测试验证-2"><a href="#4-测试验证-2" class="headerlink" title="(4) 测试验证"></a>(4) 测试验证</h3>
                  <p>打开终端，在命令行界面中测试Python 3和pip 3是否成功安装，如图1-12所示。</p>
                  <p><img src="http://epub.ituring.com.cn/api/storage/getbykey/screenshow?key=1708788341be5f65d01e" alt="图像说明文字"></p>
                  <p>图1-12 测试验证页面</p>
                  <p>若出现上面的提示，则证明Python 3和pip 3安装成功。</p>
                  <p>本节中，我们介绍了3大平台Windows、Linux和Mac下Python 3的安装方式。安装完成后，我们便可以开启Python爬虫的征程了。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-25 09:30:39" itemprop="dateCreated datePublished" datetime="2018-01-25T09:30:39+08:00">2018-01-25</time>
                </span>
                <span id="/5059.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 1.1-Python3的安装" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>5.5k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>5 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5054.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5054.html" class="post-title-link" itemprop="url">[Python3网络爬虫开发实战] 1-开发环境配置</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>工欲善其事，必先利其器！</p>
                  <p>编写和运行程序之前我们必须要先把开发环境配置好，只有配置好了环境并且有了更方便的开发工具我们才能更加高效地用程序实现相应的功能，然而很多情况下我们可能在最开始就卡在环境配置上，如果这个过程花费了太多时间，想必学习的兴趣就下降了大半，所以本章专门来对本书中所有的环境配置做一下说明。</p>
                  <p>本章是本书使用的所有库及工具的安装过程讲解，为了使书的条理更加清晰，本书将环境配置的过程统一合并为一章，本章不必逐节阅读，可以在需要的时候进行查阅。</p>
                  <p>文中在介绍安装过程的时候会尽量兼顾各个平台，另外会将一些安装常见的错误指出，以便快速高效地搭建好编程环境。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-25 08:10:58" itemprop="dateCreated datePublished" datetime="2018-01-25T08:10:58+08:00">2018-01-25</time>
                </span>
                <span id="/5054.html" class="post-meta-item leancloud_visitors" data-flag-title="[Python3网络爬虫开发实战] 1-开发环境配置" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>279</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5052.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5052.html" class="post-title-link" itemprop="url">Python3网络爬虫开发实战教程</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="2022-年-Python3-网络爬虫教程"><a href="#2022-年-Python3-网络爬虫教程" class="headerlink" title="2022 年 Python3 网络爬虫教程"></a>2022 年 Python3 网络爬虫教程</h2>
                  <p>大家好，我是崔庆才，由于爬虫技术不断迭代升级，一些旧的教程已经过时、案例已经过期，最前沿的爬虫技术比如异步、JavaScript 逆向、安卓逆向、智能解析、WebAssembly、大规模分布式、Kubernetes 等技术层出不穷，我最近新出了一套最新最全面的 Python3 网络爬虫系列教程。</p>
                  <blockquote>
                    <p>博主自荐：截止 2022 年，可以将最前沿最全面的爬虫技术都涵盖的教程，如异步、JavaScript 逆向、安卓逆向、智能解析、WebAssembly、大规模分布式、Kubernetes 等，市面上目前就这一套了。</p>
                  </blockquote>
                  <p>最新教程对旧的爬虫技术内容进行了全面更新，搭建了全新的案例平台进行全面讲解，保证案例稳定有效不过期。</p>
                  <p>教程请移步：</p>
                  <p><a href="https://cuiqingcai.com/17777.html">【2022 版】Python3 网络爬虫学习教程</a></p>
                  <h2 id="2018-年-Python3-爬虫系列教程"><a href="#2018-年-Python3-爬虫系列教程" class="headerlink" title="2018 年 Python3 爬虫系列教程"></a>2018 年 Python3 爬虫系列教程</h2>
                  <p>以下为 2018 年版 Python3 网络爬虫系列教程</p>
                  <p>本内容来自于《Python3 网络爬虫开发实战》一书。 书籍购买地址： <a href="https://item.jd.com/12333540.html" target="_blank" rel="noopener">https://item.jd.com/12333540.html</a></p>
                  <p>本书通过多个实战案例详细介绍了 Python3 网络爬虫的知识，本书由图灵教育-人民邮电出版社出版发行，版权所有，禁止转载。</p>
                  <ul>
                    <li><a href="https://cuiqingcai.com/5054.html">1-开发环境配置</a></li>
                    <li><a href="https://cuiqingcai.com/5059.html">1.1-Python3 的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5081.html" title="[Python3网络爬虫开发实战] 1.2-请求库的安装">1.2-请求库的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5132.html" title="[Python3网络爬虫开发实战] 1.2.1-Requests的安装">1.2.1-Requests 的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5141.html" title="[Python3网络爬虫开发实战] 1.2.2-Selenium的安装">1.2.2-Selenium 的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5135.html" title="[Python3网络爬虫开发实战] 1.2.3-ChromeDriver的安装">1.2.3-ChromeDriver 的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5153.html" title="[Python3网络爬虫开发实战] 1.2.4-GeckoDriver的安装">1.2.4-GeckoDriver 的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5159.html" title="[Python3网络爬虫开发实战] 1.2.5-PhantomJS的安装">1.2.5-PhantomJS 的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5163.html" title="[Python3网络爬虫开发实战] 1.2.6-aiohttp的安装">1.2.6-aiohttp 的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5168.html" title="[Python3网络爬虫开发实战] 1.3-解析库的安装">1.3-解析库的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5180.html" title="[Python3网络爬虫开发实战] 1.3.1-lxml的安装">1.3.1-lxml 的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5183.html" title="[Python3网络爬虫开发实战] 1.3.2-Beautiful Soup的安装">1.3.2-Beautiful Soup 的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5186.html" title="[Python3网络爬虫开发实战] 1.3.3-pyquery的安装">1.3.3-pyquery 的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5189.html" title="[Python3网络爬虫开发实战] 1.3.4-tesserocr的安装">1.3.4-tesserocr 的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5197.html" title="[Python3网络爬虫开发实战] 1.4-数据库的安装">1.4-数据库的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5200.html" title="[Python3网络爬虫开发实战] 1.4.1-MySQL的安装">1.4.1-MySQL 的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5205.html" title="[Python3网络爬虫开发实战] 1.4.2-MongoDB安装">1.4.2-MongoDB 安装</a></li>
                    <li><a href="https://cuiqingcai.com/5219.html" title="[Python3网络爬虫开发实战] 1.4.3-Redis的安装">1.4.3-Redis 的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5224.html" title="[Python3网络爬虫开发实战] 1.5-存储库的安装">1.5-存储库的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5227.html" title="[Python3网络爬虫开发实战] 1.5.1-PyMySQL的安装">1.5.1-PyMySQL 的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5230.html" title="[Python3网络爬虫开发实战] 1.5.2-PyMongo的安装">1.5.2-PyMongo 的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5233.html" title="[Python3网络爬虫开发实战] 1.5.3-redis-py的安装">1.5.3-redis-py 的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5236.html" title="[Python3网络爬虫开发实战] 1.5.4-RedisDump的安装">1.5.4-RedisDump 的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5239.html" title="[Python3网络爬虫开发实战] 1.6-Web库的安装">1.6-Web 库的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5244.html" title="[Python3网络爬虫开发实战] 1.6.1-Flask的安装">1.6.1-Flask 的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5248.html" title="[Python3网络爬虫开发实战] 1.6.2-Tornado的安装">1.6.2-Tornado 的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5252.html" title="[Python3网络爬虫开发实战] 1.7-App爬取相关库的安装">1.7-App 爬取相关库的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5255.html" title="[Python3网络爬虫开发实战] 1.7.1-Charles的安装">1.7.1-Charles 的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5391.html" title="[Python3网络爬虫开发实战] 1.7.2-mitmproxy的安装">1.7.2-mitmproxy 的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5407.html" title="[Python3网络爬虫开发实战] 1.7.3-Appium的安装">1.7.3-Appium 的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5413.html" title="[Python3网络爬虫开发实战] 1.8-爬虫框架的安装">1.8-爬虫框架的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5416.html" title="[Python3网络爬虫开发实战] 1.8.1-pyspider的安装">1.8.1-pyspider 的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5421.html" title="[Python3网络爬虫开发实战] 1.8.2-Scrapy的安装">1.8.2-Scrapy 的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5428.html" title="[Python3网络爬虫开发实战] 1.8.3-Scrapy-Splash的安装">1.8.3-Scrapy-Splash 的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5432.html" title="[Python3网络爬虫开发实战] 1.8.4-Scrapy-Redis的安装">1.8.4-Scrapy-Redis 的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5435.html" title="[Python3网络爬虫开发实战] 1.9-部署相关库的安装">1.9-部署相关库的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5438.html" title="[Python3网络爬虫开发实战] 1.9.1-Docker的安装">1.9.1-Docker 的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5445.html" title="[Python3网络爬虫开发实战] 1.9.2-Scrapyd的安装">1.9.2-Scrapyd 的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5449.html" title="[Python3网络爬虫开发实战] 1.9.3-Scrapyd-Client的安装">1.9.3-Scrapyd-Client 的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5453.html" title="[Python3网络爬虫开发实战] 1.9.4-Scrapyd API的安装">1.9.4-Scrapyd API 的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5456.html" title="[Python3网络爬虫开发实战] 1.9.5-Scrapyrt的安装">1.9.5-Scrapyrt 的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5459.html" title="[Python3网络爬虫开发实战] 1.9.6-Gerapy的安装">1.9.6-Gerapy 的安装</a></li>
                    <li><a href="https://cuiqingcai.com/5462.html" title="[Python3网络爬虫开发实战] 2-爬虫基础">2-爬虫基础</a></li>
                    <li><a href="https://cuiqingcai.com/5465.html" title="[Python3网络爬虫开发实战] 2.1-HTTP基本原理">2.1-HTTP 基本原理</a></li>
                    <li><a href="https://cuiqingcai.com/5476.html" title="[Python3网络爬虫开发实战] 2.2-网页基础">2.2-网页基础</a></li>
                    <li><a href="https://cuiqingcai.com/5484.html" title="[Python3网络爬虫开发实战] 2.3-爬虫的基本原理">2.3-爬虫的基本原理</a></li>
                    <li><a href="https://cuiqingcai.com/5487.html" title="[Python3网络爬虫开发实战] 2.4-会话和Cookies">2.4-会话和 Cookies</a></li>
                    <li><a href="https://cuiqingcai.com/5491.html" title="[Python3网络爬虫开发实战] 2.5-代理的基本原理">2.5-代理的基本原理</a></li>
                    <li><a href="https://cuiqingcai.com/5494.html" title="[Python3网络爬虫开发实战] 3-基本库的使用">3-基本库的使用</a></li>
                    <li><a href="https://cuiqingcai.com/5497.html" title="[Python3网络爬虫开发实战] 3.1-使用urllib">3.1-使用 urllib</a></li>
                    <li><a href="https://cuiqingcai.com/5500.html" title="[Python3网络爬虫开发实战] 3.1.1-发送请求">3.1.1-发送请求</a></li>
                    <li><a href="https://cuiqingcai.com/5505.html" title="[Python3网络爬虫开发实战] 3.1.2-处理异常">3.1.2-处理异常</a></li>
                    <li><a href="https://cuiqingcai.com/5508.html" title="[Python3网络爬虫开发实战] 3.1.3-解析链接">3.1.3-解析链接</a></li>
                    <li><a href="https://cuiqingcai.com/5511.html" title="[Python3网络爬虫开发实战] 3.1.4-分析Robots协议">3.1.4-分析 Robots 协议</a></li>
                    <li><a href="https://cuiqingcai.com/5514.html" title="[Python3网络爬虫开发实战] 3.2-使用requests">3.2-使用 requests</a></li>
                    <li><a href="https://cuiqingcai.com/5517.html" title="[Python3网络爬虫开发实战] 3.2.1-基本用法">3.2.1-基本用法</a></li>
                    <li><a href="https://cuiqingcai.com/5523.html" title="[Python3网络爬虫开发实战] 3.2.2-高级用法">3.2.2-高级用法</a></li>
                    <li><a href="https://cuiqingcai.com/5530.html" title="[Python3网络爬虫开发实战] 3.3-正则表达式">3.3-正则表达式</a></li>
                    <li><a href="https://cuiqingcai.com/5534.html" title="[Python3网络爬虫开发实战] 3.4-抓取猫眼电影排行">3.4-抓取猫眼电影排行</a></li>
                    <li><a href="https://cuiqingcai.com/5542.html" title="[Python3网络爬虫开发实战] 4-解析库的使用">4-解析库的使用</a></li>
                    <li><a href="https://cuiqingcai.com/5545.html" title="[Python3网络爬虫开发实战] 4.1-使用XPath">4.1-使用 XPath</a></li>
                    <li><a href="https://cuiqingcai.com/5548.html" title="[Python3网络爬虫开发实战] 4.2-使用Beautiful Soup">4.2-使用 Beautiful Soup</a></li>
                    <li><a href="https://cuiqingcai.com/5551.html" title="[Python3网络爬虫开发实战] 4.3-使用pyquery">4.3-使用 pyquery</a></li>
                    <li><a href="https://cuiqingcai.com/5554.html" title="[Python3网络爬虫开发实战] 5-数据存储">5-数据存储</a></li>
                    <li><a href="https://cuiqingcai.com/5557.html" title="[Python3网络爬虫开发实战] 5.1-文件存储">5.1-文件存储</a></li>
                    <li><a href="https://cuiqingcai.com/5560.html" title="[Python3网络爬虫开发实战] 5.1.1-TXT文本存储">5.1.1-TXT 文本存储</a></li>
                    <li><a href="https://cuiqingcai.com/5564.html" title="[Python3网络爬虫开发实战] 5.1.2-JSON文件存储">5.1.2-JSON 文件存储</a></li>
                    <li><a href="https://cuiqingcai.com/5571.html" title="[Python3网络爬虫开发实战] 5.1.3-CSV文件存储">5.1.3-CSV 文件存储</a></li>
                    <li><a href="https://cuiqingcai.com/5575.html" title="[Python3网络爬虫开发实战] 5.2-关系型数据库存储">5.2-关系型数据库存储</a></li>
                    <li><a href="https://cuiqingcai.com/5578.html" title="[Python3网络爬虫开发实战] 5.2.1-MySQL存储">5.2.1-MySQL 存储</a></li>
                    <li><a href="https://cuiqingcai.com/5581.html" title="[Python3网络爬虫开发实战] 5.3-非关系型数据库存储">5.3-非关系型数据库存储</a></li>
                    <li><a href="https://cuiqingcai.com/5584.html" title="[Python3网络爬虫开发实战] 5.3.1-MongoDB存储">5.3.1-MongoDB 存储</a></li>
                    <li><a href="https://cuiqingcai.com/5587.html" title="[Python3网络爬虫开发实战] 5.3.2-Redis存储">5.3.2-Redis 存储</a></li>
                    <li><a href="https://cuiqingcai.com/5590.html" title="[Python3网络爬虫开发实战] 6-Ajax数据爬取">6-Ajax 数据爬取</a></li>
                    <li><a href="https://cuiqingcai.com/5593.html" title="[Python3网络爬虫开发实战] 6.1-什么是Ajax">6.1-什么是 Ajax</a></li>
                    <li><a href="https://cuiqingcai.com/5597.html" title="[Python3网络爬虫开发实战] 6.2-Ajax分析方法">6.2-Ajax 分析方法</a></li>
                    <li><a href="https://cuiqingcai.com/5609.html" title="[Python3网络爬虫开发实战] 6.3-Ajax结果提取">6.3-Ajax 结果提取</a></li>
                    <li><a href="https://cuiqingcai.com/5616.html" title="[Python3网络爬虫开发实战] 6.4-分析Ajax爬取今日头条街拍美图">6.4-分析 Ajax 爬取今日头条街拍美图</a></li>
                    <li><a href="https://cuiqingcai.com/5627.html" title="[Python3网络爬虫开发实战] 7-动态渲染页面爬取">7-动态渲染页面爬取</a></li>
                    <li><a href="https://cuiqingcai.com/5630.html" title="[Python3网络爬虫开发实战] 7.1-Selenium的使用">7.1-Selenium 的使用</a></li>
                    <li><a href="https://cuiqingcai.com/5638.html" title="[Python3网络爬虫开发实战] 7.2-Splash的使用">7.2-Splash 的使用</a></li>
                    <li><a href="https://cuiqingcai.com/5654.html" title="[Python3网络爬虫开发实战] 7.3-Splash负载均衡配置">7.3-Splash 负载均衡配置</a></li>
                    <li><a href="https://cuiqingcai.com/5657.html" title="[Python3网络爬虫开发实战] 7.4-使用Selenium爬取淘宝商品">7.4-使用 Selenium 爬取淘宝商品</a></li>
                    <li><a href="hhttps://cuiqingcai.com/7032.html">8-验证码的识别</a></li>
                    <li><a href="https://cuiqingcai.com/7035.html">8.1-图形验证码的识别</a></li>
                    <li><a href="https://cuiqingcai.com/7037.html">8.2-极验滑动验证码的识别</a></li>
                    <li><a href="https://cuiqingcai.com/7039.html">8.3-点触验证码的识别</a></li>
                    <li><a href="https://cuiqingcai.com/7041.html">8.4-微博宫格验证码的识别</a></li>
                    <li><a href="https://cuiqingcai.com/7043.html">9-代理的使用</a></li>
                    <li><a href="https://cuiqingcai.com/7045.html">9.1-代理的设置</a></li>
                    <li><a href="https://cuiqingcai.com/7048.html">9.2-代理池的维护</a></li>
                    <li><a href="https://cuiqingcai.com/7051.html">9.3-付费代理的使用</a></li>
                    <li><a href="https://cuiqingcai.com/8361.html">9.4-ADSL 拨号代理</a></li>
                    <li><a href="https://cuiqingcai.com/7844.html">9.5-使用代理爬取微信公众号文章</a></li>
                    <li><a href="https://cuiqingcai.com/5678.html">10-模拟登录</a></li>
                    <li><a href="https://cuiqingcai.com/8229.html">10.1-模拟登录并爬取 GitHub</a></li>
                    <li><a href="https://cuiqingcai.com/8243.html">10.2-Cookies 池的搭建</a></li>
                    <li><a href="https://cuiqingcai.com/5678.html">11-App 的爬取</a></li>
                    <li><a href="https://cuiqingcai.com/8247.html">11.1-Charles 的使用</a></li>
                    <li><a href="https://cuiqingcai.com/8260.html">11.2-mitmproxy 的使用</a></li>
                    <li><a href="https://cuiqingcai.com/8263.html">11.3-mitmdump 爬取“得到”App 电子书信息</a></li>
                    <li><a href="https://cuiqingcai.com/8290.html">11.4-Appium 的基本使用</a></li>
                    <li><a href="https://cuiqingcai.com/8293.html">11.5-Appium 爬取微信朋友圈</a></li>
                    <li><a href="https://cuiqingcai.com/8306.html">11.6-Appium+mitmdump 爬取京东商品</a></li>
                    <li><a href="https://cuiqingcai.com/5678.html">12-pyspider 框架的使用</a></li>
                    <li><a href="https://cuiqingcai.com/8309.html">12.1-pyspider 框架介绍</a></li>
                    <li><a href="https://cuiqingcai.com/8317.html">12.2-pyspider 的基本使用</a></li>
                    <li><a href="https://cuiqingcai.com/8320.html">12.3-pyspider 用法详解</a></li>
                    <li><a href="https://cuiqingcai.com/5678.html">13-Scrapy 框架的使用</a></li>
                    <li><a href="https://cuiqingcai.com/8364.html">13.1-Scrapy 框架介绍</a></li>
                    <li><a href="https://cuiqingcai.com/8337.html">13.2-Scrapy 入门</a></li>
                    <li><a href="https://cuiqingcai.com/8350.html">13.3-Selector 的用法</a></li>
                    <li><a href="https://cuiqingcai.com/8353.html">13.4-Spider 的用法</a></li>
                    <li><a href="https://cuiqingcai.com/5678.html">13.5-Downloader Middleware 的用法</a></li>
                    <li><a href="https://cuiqingcai.com/5678.html">13.6-Spider Middleware 的用法</a></li>
                    <li><a href="https://cuiqingcai.com/5678.html">13.7-Item Pipeline 的用法</a></li>
                    <li><a href="https://cuiqingcai.com/5678.html">13.8-Scrapy 对接 Selenium</a></li>
                    <li><a href="https://cuiqingcai.com/5678.html">13.9-Scrapy 对接 Splash</a></li>
                    <li><a href="https://cuiqingcai.com/5678.html">13.10-Scrapy 通用爬虫</a></li>
                    <li><a href="https://cuiqingcai.com/5678.html">13.11-Scrapyrt 的使用</a></li>
                    <li><a href="https://cuiqingcai.com/5678.html">13.12-Scrapy 对接 Docker</a></li>
                    <li><a href="https://cuiqingcai.com/5678.html">13.13-Scrapy 爬取新浪微博</a></li>
                    <li><a href="https://cuiqingcai.com/5678.html">14-分布式爬虫</a></li>
                    <li><a href="https://cuiqingcai.com/5678.html">14.1-分布式爬虫原理</a></li>
                    <li><a href="https://cuiqingcai.com/5678.html">14.2-Scrapy-Redis 源码解析</a></li>
                    <li><a href="https://cuiqingcai.com/5678.html">14.3-Scrapy 分布式实现</a></li>
                    <li><a href="https://cuiqingcai.com/5678.html">14.4-Bloom Filter 的对接</a></li>
                    <li><a href="https://cuiqingcai.com/5678.html">15-分布式爬虫的部署</a></li>
                    <li><a href="https://cuiqingcai.com/5678.html">15.1-Scrapyd 分布式部署</a></li>
                    <li><a href="https://cuiqingcai.com/5678.html">15.2-Scrapyd-Client 的使用</a></li>
                    <li><a href="https://cuiqingcai.com/5678.html">15.3-Scrapyd 对接 Docker</a></li>
                    <li><a href="https://cuiqingcai.com/5678.html">15.4-Scrapyd 批量部署</a></li>
                    <li><a href="https://cuiqingcai.com/5678.html">15.5-Gerapy 分布式管理</a></li>
                  </ul>
                  <p><img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/01/网络爬虫宣传图.jpg" alt=""> <img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/01/Python-3网格爬虫开发实战-立体图-857x1100.jpg" alt=""></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-25 08:04:33" itemprop="dateCreated datePublished" datetime="2018-01-25T08:04:33+08:00">2018-01-25</time>
                </span>
                <span id="/5052.html" class="post-meta-item leancloud_visitors" data-flag-title="Python3网络爬虫开发实战教程" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.5k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5006.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5006.html" class="post-title-link" itemprop="url">在阿里云上测试Gerapy教程</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="前几天，大才发了一个自己写的框架，介绍地址在这里，-GIT-地址在这里。"><a href="#前几天，大才发了一个自己写的框架，介绍地址在这里，-GIT-地址在这里。" class="headerlink" title="前几天，大才发了一个自己写的框架，介绍地址在这里， GIT 地址在这里。"></a>前几天，大才发了一个自己写的框架，介绍地址在<a href="https://cuiqingcai.com/4959.html">这里</a>， GIT 地址在<a href="https://github.com/Gerapy/Gerapy" target="_blank" rel="noopener">这里</a>。</h2>
                  <p>今天在阿里云上试用了一下，在这里做一个简单的说明。</p>
                  <h1 id="1、配置环境"><a href="#1、配置环境" class="headerlink" title="1、配置环境"></a>1、配置环境</h1>
                  <p>阿里云的版本是 2.7.5，所以用 pyenv 新安装了一个 3.6.4 的环境，安装后使用 pyenv global 3.6.4 即可使用 3.6.4 的环境，我个人比较喜欢这样，切换自如，互不影响。 如下图： <img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/01/Selection_020.png" alt=""> 接下来按照大才的文章，pip install gerapy 即可，这一步没有遇到什么问题。有问题的同学可以向大才提 issue。</p>
                  <h1 id="2-开启服务"><a href="#2-开启服务" class="headerlink" title="2. 开启服务"></a>2. 开启服务</h1>
                  <p>首先去阿里云的后台设置安全组 ，我的是这样： <img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/01/Selection_021.png" alt=""> 然后到命令窗口对 8000 和 6800 端口放行即可。 接着执行</p>
                  <blockquote>
                    <p>gerapy init cd gerapy gerapy migrate <strong> # 注意下一步 </strong> <strong>gerapy runserver 0.0.0.0:8000 【如果你是在本地，执行 gerapy runserver 即可，如果你是在阿里云上，你就要改成前面这样来执行】</strong></p>
                  </blockquote>
                  <p>现在在浏览器里访问：ip:8000 应该就可以看到主界面了 <img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/01/Selection_022.png" alt=""> 里面的各个的含义见大才的文章。</p>
                  <h1 id="3-创建项目"><a href="#3-创建项目" class="headerlink" title="3.创建项目"></a>3.创建项目</h1>
                  <p>在 gerapy 下的 projects 里面新建一个 scrapy 爬虫，在这里我搞的是最简单的：</p>
                  <blockquote>
                    <p>scrapy startproject gerapy_test cd gerapy_test scrapy genspider baidu www.baidu.com</p>
                  </blockquote>
                  <p>这样就是一个最简单的爬虫了，修改一个 settings.py 中的 ROBOTSTXT_OBEY=False, 然后修改一个 spiders 下面的 baidu.py, 这里随意，我这里设置的是输出返回的 response.url</p>
                  <h1 id="4-安装-scrapyd"><a href="#4-安装-scrapyd" class="headerlink" title="4.安装 scrapyd"></a>4.安装 scrapyd</h1>
                  <blockquote>
                    <p>pip install scrapyd</p>
                  </blockquote>
                  <p>安装好以后，命令行执行</p>
                  <blockquote>
                    <p>scrapyd</p>
                  </blockquote>
                  <p>然后浏览器中打开 ip:6800，如果你没有修改配置，应该这里会打不开，clients 那里配置的时候，也应该会显示为 error，就像这样： <img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/01/Selection_024.png" alt=""> 后来找了一下原因发现 scrapyd 默认打开的也是 127.0.0.1 <img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/01/Selection_025.png" alt=""> 所以这个时候就要改一下配置，具体可以参考<a href="https://piaosanlang.gitbooks.io/spiders/05day/section5.5.html" target="_blank" rel="noopener">这里</a>， 我是这么修改：</p>
                  <blockquote>
                    <p>vim ~/.scrapyd.conf [scrapyd] bind_address = 0.0.0.0</p>
                  </blockquote>
                  <p>在刷新一下，就会看到前面 error 变成了 normal <img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/01/Selection_026.png" alt=""></p>
                  <h1 id="5-打包，部署，调度"><a href="#5-打包，部署，调度" class="headerlink" title="5. 打包，部署，调度"></a>5. 打包，部署，调度</h1>
                  <p>这几步大才的文章里都有详细说明，打包完，部署，在进入 clients 的调度界面，点击 run 按钮即可跑爬虫了 <img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/01/Selection_027.png" alt=""><img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/01/Selection_028.png" alt=""> <img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/01/Selection_029-1.png" alt=""> 可以看到输出的结果了。</p>
                  <h1 id="6-结语"><a href="#6-结语" class="headerlink" title="6.结语"></a>6.结语</h1>
                  <p>建议大家可以试着用一下，很方便，我这里只是很简单的使用了一下。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/四毛" class="author" itemprop="url" rel="index">四毛</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-22 18:37:28" itemprop="dateCreated datePublished" datetime="2018-01-22T18:37:28+08:00">2018-01-22</time>
                </span>
                <span id="/5006.html" class="post-meta-item leancloud_visitors" data-flag-title="在阿里云上测试Gerapy教程" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/5001.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/5001.html" class="post-title-link" itemprop="url">TensorFlow Bi-LSTM实现序列标注</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>本节我们来尝试使用 TensorFlow 搭建一个双向 LSTM (Bi-LSTM) 深度学习模型来处理序列标注问题，主要目的是学习 Bi-LSTM 的用法。</p>
                  <h2 id="Bi-LSTM"><a href="#Bi-LSTM" class="headerlink" title="Bi-LSTM"></a>Bi-LSTM</h2>
                  <p>我们知道 RNN 是可以学习到文本上下文之间的联系的，输入是上文，输出是下文，但这样的结果是模型可以根据上文推出下文，而如果输入下文，想要推出上文就没有那么简单了，为了弥补这个缺陷，我们可以让模型从两个方向来学习，这就构成了双向 RNN。在某些任务中，双向 RNN 的表现比单向 RNN 要好，本文要实现的文本分词就是其中之一。不过本文使用的模型不是简单的双向 RNN，而是 RNN 的变种 — LSTM。 <img src="https://germey.gitbooks.io/ai/content/assets/2018-01-22-00-04-15.jpg" alt=""> 如图所示为 Bi-LSTM 的基本原理，输入层的数据会经过向前和向后两个方向推算，最后输出的隐含状态再进行 concat，再作为下一层的输入，原理其实和 LSTM 是类似的，就是多了双向计算和 concat 过程。</p>
                  <h2 id="数据处理"><a href="#数据处理" class="headerlink" title="数据处理"></a>数据处理</h2>
                  <p>本文的训练和测试数据使用的是已经做好序列标注的中文文本数据。序列标注，就是给一个汉语句子作为输入，以“BEMS”组成的序列串作为输出，然后再进行切词，进而得到输入句子的划分。其中，B 代表该字是词语中的起始字，M 代表是词语中的中间字，E 代表是词语中的结束字，S 则代表是单字成词。 这里的原始数据样例如下：</p>
                  <figure class="highlight jboss-cli">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">人<span class="string">/b</span>  们<span class="string">/e</span>  常<span class="string">/s</span>  说<span class="string">/s</span>  生<span class="string">/b</span>  活<span class="string">/e</span>  是<span class="string">/s</span>  一<span class="string">/s</span>  部<span class="string">/s</span>  教<span class="string">/b</span>  科<span class="string">/m</span>  书<span class="string">/e</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里一个字对应一个标注，我们首先需要对数据进行预处理，预处理的流程如下：</p>
                  <ul>
                    <li>将句子切分</li>
                    <li>将句子的的标点符号去掉</li>
                    <li>将每个字及对应的标注切分</li>
                    <li>去掉长度为 0 的无效句子</li>
                  </ul>
                  <p>首先我们将句子切分开来并去掉标点符号，代码实现如下：</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># Read origin data</span></span><br><span class="line"><span class="keyword">text</span> = <span class="built_in">open</span>(<span class="string">'data/data.txt'</span>, encoding=<span class="string">'utf-8'</span>).<span class="built_in">read</span>()</span><br><span class="line"><span class="comment"># Get split sentences</span></span><br><span class="line"><span class="keyword">sentences</span> = re.<span class="built_in">split</span>(<span class="string">'[，。！？、‘’“”]/[bems]'</span>, <span class="keyword">text</span>)</span><br><span class="line"><span class="comment"># Filter sentences whose length is 0</span></span><br><span class="line"><span class="keyword">sentences</span> = list(<span class="built_in">filter</span>(lambda x: x.strip(), <span class="keyword">sentences</span>))</span><br><span class="line"><span class="comment"># Strip sentences</span></span><br><span class="line"><span class="keyword">sentences</span> = list(map(lambda x: x.strip(), <span class="keyword">sentences</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们就可以将句子切分开来并做好了清洗，接下来我们还需要把每个句子中的字及标注转为 Numpy 数组，便于下一步制作词表和数据集，代码实现如下：</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import re</span><br><span class="line"><span class="comment"># To numpy array</span></span><br><span class="line"><span class="keyword">words</span>, labels = [], []</span><br><span class="line">print(<span class="string">'Start creating words and labels...'</span>)</span><br><span class="line"><span class="keyword">for</span> <span class="keyword">sentence</span> <span class="keyword">in</span> <span class="keyword">sentences</span>:</span><br><span class="line">    groups = re.findall(<span class="string">'(.)/(.)'</span>, <span class="keyword">sentence</span>)</span><br><span class="line">    arrays = np.asarray(groups)</span><br><span class="line">    <span class="keyword">words</span>.append(arrays[:, <span class="number">0</span>])</span><br><span class="line">    labels.append(arrays[:, <span class="number">1</span>])</span><br><span class="line">print(<span class="string">'Words Length'</span>, <span class="built_in">len</span>(<span class="keyword">words</span>), <span class="string">'Labels Length'</span>, <span class="built_in">len</span>(labels))</span><br><span class="line">print(<span class="string">'Words Example'</span>, <span class="keyword">words</span>[<span class="number">0</span>])</span><br><span class="line">print(<span class="string">'Labels Example'</span>, labels[<span class="number">0</span>])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们利用正则 re 库的 findall() 方法将字及标注分开，并分别添加到 words 和 labels 数组中，运行效果如下：</p>
                  <figure class="highlight arcade">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Words <span class="built_in">Length</span> <span class="number">321533</span> Labels <span class="built_in">Length</span> <span class="number">321533</span></span><br><span class="line">Words Example [<span class="string">'人'</span> <span class="string">'们'</span> <span class="string">'常'</span> <span class="string">'说'</span> <span class="string">'生'</span> <span class="string">'活'</span> <span class="string">'是'</span> <span class="string">'一'</span> <span class="string">'部'</span> <span class="string">'教'</span> <span class="string">'科'</span> <span class="string">'书'</span>]</span><br><span class="line">Labels Example [<span class="string">'b'</span> <span class="string">'e'</span> <span class="string">'s'</span> <span class="string">'s'</span> <span class="string">'b'</span> <span class="string">'e'</span> <span class="string">'s'</span> <span class="string">'s'</span> <span class="string">'s'</span> <span class="string">'b'</span> <span class="string">'m'</span> <span class="string">'e'</span>]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来我们有了这些数据就要开始制作词表了，词表制作起来无非就是输入词表和输出词表的不重复的正逆对应，制作词表的目的就是将输入的文字或标注转为 index，同时还能反向根据 index 获取对应的文字或标注，所以我们这里需要制作 word2id、id2word、tag2id、id2tag 四个字典。 为了解决 OOV 问题，我们还需要将无效字符也进行标注，这里我们统一取 0。制作时我们借助于 pandas 库的 Series 进行了去重和转换，另外还限制了每一句的最大长度，这里设置为 32，如果大于32，则截断，否则进行 padding，代码如下：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from itertools import chain</span><br><span class="line">import pandas <span class="keyword">as</span> pd</span><br><span class="line">import numpy <span class="keyword">as</span> np</span><br><span class="line"># Merge <span class="keyword">all</span> words</span><br><span class="line">all_words = <span class="keyword">list</span>(chain(*words))</span><br><span class="line"># All words <span class="keyword">to</span> Series</span><br><span class="line">all_words_sr = pd.Series(all_words)</span><br><span class="line"># Get value <span class="built_in">count</span>, <span class="built_in">index</span> changed <span class="keyword">to</span> <span class="keyword">set</span></span><br><span class="line">all_words_counts = all_words_sr.value_counts()</span><br><span class="line"># Get words <span class="keyword">set</span></span><br><span class="line">all_words_set = all_words_counts.<span class="built_in">index</span></span><br><span class="line"># Get words ids</span><br><span class="line">all_words_ids = <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(all_words_set) + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"># Dict <span class="keyword">to</span> transform</span><br><span class="line">word2id = pd.Series(all_words_ids, <span class="built_in">index</span>=all_words_set)</span><br><span class="line">id2word = pd.Series(all_words_set, <span class="built_in">index</span>=all_words_ids)</span><br><span class="line"></span><br><span class="line"># Tag <span class="keyword">set</span> <span class="built_in">and</span> ids</span><br><span class="line">tags_set = [<span class="string">'x'</span>, <span class="string">'s'</span>, <span class="string">'b'</span>, <span class="string">'m'</span>, <span class="string">'e'</span>]</span><br><span class="line">tags_ids = <span class="built_in">range</span>(<span class="built_in">len</span>(tags_set))</span><br><span class="line"></span><br><span class="line"># Dict <span class="keyword">to</span> transform</span><br><span class="line">tag2id = pd.Series(tags_ids, <span class="built_in">index</span>=tags_set)</span><br><span class="line">id2tag = pd.Series(tags_set, <span class="built_in">index</span>=tag2id)</span><br><span class="line"></span><br><span class="line">max_length = <span class="number">32</span></span><br><span class="line"></span><br><span class="line">def x_transform(words):</span><br><span class="line">    ids = <span class="keyword">list</span>(word2id[words])</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(ids) &gt;= max_length:</span><br><span class="line">        ids = ids[:max_length]</span><br><span class="line">    ids.<span class="built_in">extend</span>([<span class="number">0</span>] * (max_length - <span class="built_in">len</span>(ids)))</span><br><span class="line">    <span class="keyword">return</span> ids</span><br><span class="line"></span><br><span class="line">def y_transform(<span class="keyword">tags</span>):</span><br><span class="line">    ids = <span class="keyword">list</span>(tag2id[<span class="keyword">tags</span>])</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(ids) &gt;= max_length:</span><br><span class="line">        ids = ids[:max_length]</span><br><span class="line">    ids.<span class="built_in">extend</span>([<span class="number">0</span>] * (max_length - <span class="built_in">len</span>(ids)))</span><br><span class="line">    <span class="keyword">return</span> ids</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span>(<span class="string">'Starting transform...'</span>)</span><br><span class="line">data_x = <span class="keyword">list</span>(<span class="keyword">map</span>(lambda <span class="keyword">x</span>: x_transform(<span class="keyword">x</span>), words))</span><br><span class="line">data_y = <span class="keyword">list</span>(<span class="keyword">map</span>(lambda <span class="keyword">y</span>: y_transform(<span class="keyword">y</span>), labels))</span><br><span class="line">data_x = np.asarray(data_x)</span><br><span class="line">data_y = np.asarray(data_y)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们就完成了 word2id、id2word、tag2id、id2tag 四个字典的制作，并制作好了 Numpy 数组类型的 data_x 和 data_y，这里 data_x 和 data_y 单句示例如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Data X Example: [<span class="number">8</span>, <span class="number">43</span>, <span class="number">320</span>, <span class="number">88</span>, <span class="number">36</span>, <span class="number">198</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">41</span>, <span class="number">163</span>, <span class="number">124</span>, <span class="number">245</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">Data Y Example: [<span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到数据的 x 部分，原始文字和标注结果都转化成了词表中的 index，同时不够 32 个字符就以 0 补全。 接下来我们将其保存成 pickle 文件，以备训练和测试使用：</p>
                  <figure class="highlight lua">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">print</span>(<span class="string">'Starting pickle to file...'</span>)</span><br><span class="line">with <span class="built_in">open</span>(join(<span class="built_in">path</span>, <span class="string">'data.pkl'</span>), <span class="string">'wb'</span>) as f:</span><br><span class="line">    pickle.<span class="built_in">dump</span>(data_x, f)</span><br><span class="line">    pickle.<span class="built_in">dump</span>(data_y, f)</span><br><span class="line">    pickle.<span class="built_in">dump</span>(word2id, f)</span><br><span class="line">    pickle.<span class="built_in">dump</span>(id2word, f)</span><br><span class="line">    pickle.<span class="built_in">dump</span>(tag2id, f)</span><br><span class="line">    pickle.<span class="built_in">dump</span>(id2tag, f)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">'Pickle finished'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好，现在数据预处理部分就完成了。</p>
                  <h2 id="构造模型"><a href="#构造模型" class="headerlink" title="构造模型"></a>构造模型</h2>
                  <p>接下来我们就需要利用 pickle 文件中的数据来构建模型了，首先进行 pickle 文件的读取，然后将数据分为训练集、开发集、测试集，详细流程不再赘述，赋值为如下变量：</p>
                  <figure class="highlight autohotkey">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"># Load data</span><br><span class="line"><span class="built_in">    data_x,</span> dat<span class="built_in">a_y</span>, word2id, id2word, tag2id, id2tag = load_data()</span><br><span class="line">    # Split data</span><br><span class="line"><span class="built_in">    train_x,</span> train_y, dev_x, dev_y, test_x, test_y = get_data(dat<span class="built_in">a_x</span>, dat<span class="built_in">a_y</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来我们使用 TensorFlow 自带的 Dataset 数据结构构造输入输出，利用 Dataset 我们可以构造一个 iterator 迭代器，每调用一次 get_next() 方法，我们就可以得到一个 batch，这里 Dataset 的初始化我们使用 from_tensor_slices() 方法，然后调用其 batch() 方法来初始化每个数据集的 batch_size，接着初始化同一个 iterator，并绑定到三个数据集上声明为三个 initializer，这样每调用 initializer，就会将 iterator 切换到对应的数据集上，代码实现如下：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"># Train <span class="keyword">and</span> dev dataset</span><br><span class="line">train_dataset = tf.data.<span class="module-access"><span class="module"><span class="identifier">Dataset</span>.</span></span>from<span class="constructor">_tensor_slices((<span class="params">train_x</span>, <span class="params">train_y</span>)</span>)</span><br><span class="line">train_dataset = train_dataset.batch(<span class="module-access"><span class="module"><span class="identifier">FLAGS</span>.</span></span>train_batch_size)</span><br><span class="line"></span><br><span class="line">dev_dataset = tf.data.<span class="module-access"><span class="module"><span class="identifier">Dataset</span>.</span></span>from<span class="constructor">_tensor_slices((<span class="params">dev_x</span>, <span class="params">dev_y</span>)</span>)</span><br><span class="line">dev_dataset = dev_dataset.batch(<span class="module-access"><span class="module"><span class="identifier">FLAGS</span>.</span></span>dev_batch_size)</span><br><span class="line"></span><br><span class="line">test_dataset = tf.data.<span class="module-access"><span class="module"><span class="identifier">Dataset</span>.</span></span>from<span class="constructor">_tensor_slices((<span class="params">test_x</span>, <span class="params">test_y</span>)</span>)</span><br><span class="line">test_dataset = test_dataset.batch(<span class="module-access"><span class="module"><span class="identifier">FLAGS</span>.</span></span>test_batch_size)</span><br><span class="line"></span><br><span class="line"># A reinitializable iterator</span><br><span class="line">iterator = tf.data.<span class="module-access"><span class="module"><span class="identifier">Iterator</span>.</span></span>from<span class="constructor">_structure(<span class="params">train_dataset</span>.<span class="params">output_types</span>, <span class="params">train_dataset</span>.<span class="params">output_shapes</span>)</span></span><br><span class="line"></span><br><span class="line">train_initializer = iterator.make<span class="constructor">_initializer(<span class="params">train_dataset</span>)</span></span><br><span class="line">dev_initializer = iterator.make<span class="constructor">_initializer(<span class="params">dev_dataset</span>)</span></span><br><span class="line">test_initializer = iterator.make<span class="constructor">_initializer(<span class="params">test_dataset</span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>有了 Dataset 的 iterator，我们只需要调用一次 get_next() 方法即可得到 x 和 y_label 了，就不需要使用 placeholder 来声明了，代码如下：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"># Input Layer</span><br><span class="line"><span class="keyword">with</span> tf.variable<span class="constructor">_scope('<span class="params">inputs</span>')</span>:</span><br><span class="line">    x, y_label = iterator.get<span class="constructor">_next()</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来我们需要实现 embedding 层，调用 TensorFlow 的 embedding_lookup 即可实现，这里没有使用 Pre Train 的 embedding，代码实现如下：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"># Embedding Layer</span><br><span class="line"><span class="keyword">with</span> tf.variable<span class="constructor">_scope('<span class="params">embedding</span>')</span>:</span><br><span class="line">    embedding = tf.<span class="constructor">Variable(<span class="params">tf</span>.<span class="params">random_normal</span>([<span class="params">vocab_size</span>, FLAGS.<span class="params">embedding_size</span>])</span>, dtype=tf.float32)</span><br><span class="line">inputs = tf.nn.embedding<span class="constructor">_lookup(<span class="params">embedding</span>, <span class="params">x</span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来我们就需要实现双向 LSTM 了，这里我们要构造一个 2 层的 Bi-LSTM 网络，实现的时候我们首先需要声明 LSTM Cell 的列表，然后调用 stack_bidirectional_rnn() 方法即可：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">cell_fw = <span class="literal">[<span class="identifier">lstm_cell</span>(FLAGS.<span class="identifier">num_units</span>, <span class="identifier">keep_prob</span>) <span class="identifier">for</span> <span class="identifier">_</span> <span class="identifier">in</span> <span class="identifier">range</span>(FLAGS.<span class="identifier">num_layer</span>)]</span></span><br><span class="line">cell_bw = <span class="literal">[<span class="identifier">lstm_cell</span>(FLAGS.<span class="identifier">num_units</span>, <span class="identifier">keep_prob</span>) <span class="identifier">for</span> <span class="identifier">_</span> <span class="identifier">in</span> <span class="identifier">range</span>(FLAGS.<span class="identifier">num_layer</span>)]</span></span><br><span class="line">inputs = tf.unstack(inputs, <span class="module-access"><span class="module"><span class="identifier">FLAGS</span>.</span></span>time_step, axis=<span class="number">1</span>)</span><br><span class="line">output, _, _ = tf.contrib.rnn.stack<span class="constructor">_bidirectional_rnn(<span class="params">cell_fw</span>, <span class="params">cell_bw</span>, <span class="params">inputs</span>=<span class="params">inputs</span>, <span class="params">dtype</span>=<span class="params">tf</span>.<span class="params">float32</span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这个方法内部是首先对每一层的 LSTM 进行正反向计算，然后对输出隐层进行 concat，然后输入下一层再进行计算，这里值得注意的地方是，我们不能把 LSTM Cell 提前组合成 MultiRNNCell 再调用 bidirectional_dynamic_rnn() 进行计算，这样相当于只有最后一层才进行 concat，是错误的。 现在我们得到的 output 就是 Bi-LSTM 的最后输出结果了。 接下来我们需要对输出结果进行一下 stack() 操作转化为一个 Tensor，然后将其 reshape() 一下，转化为 [-1, num_units * 2] 的 shape：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">output</span> = tf.stack(output, axis=<span class="number">1</span>)</span><br><span class="line"><span class="attr">output</span> = tf.reshape(output, [-<span class="number">1</span>, FLAGS.num_units * <span class="number">2</span>])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们再经过一层全连接网络将维度进行转换：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"># Output Layer</span><br><span class="line">with <span class="keyword">tf</span>.variable_scope(<span class="string">'outputs'</span>):</span><br><span class="line">    <span class="keyword">w</span> = weight([FLAGS.num_units * <span class="number">2</span>, FLAGS.category_num])</span><br><span class="line">    <span class="keyword">b</span> = bias([FLAGS.category_num])</span><br><span class="line">    <span class="keyword">y</span> = <span class="keyword">tf</span>.matmul(output, <span class="keyword">w</span>) + <span class="keyword">b</span></span><br><span class="line">    y_predict = <span class="keyword">tf</span>.cast(<span class="keyword">tf</span>.argmax(<span class="keyword">y</span>, axis=<span class="number">1</span>), <span class="keyword">tf</span>.int32)</span><br><span class="line">    <span class="keyword">print</span>(<span class="string">'Output Y'</span>, y_predict)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样得到的最后的 y_predict 即为预测结果，shape 为 [batch_size]，即每一句都得到了一个最可能的结果标注。 接下来我们需要计算一下准确率和 Loss，准确率其实就是比较 y_predict 和 y_label 的相似度，Loss 即为二者交叉熵：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"># Reshape y_label</span><br><span class="line">y_label_reshape = tf.cast(tf.reshape(y_label, <span class="literal">[-<span class="number">1</span>]</span>), tf.<span class="built_in">int32</span>)</span><br><span class="line"># Prediction</span><br><span class="line">correct_prediction = tf.equal(y_predict, y_label_reshape)</span><br><span class="line">accuracy = tf.reduce<span class="constructor">_mean(<span class="params">tf</span>.<span class="params">cast</span>(<span class="params">correct_prediction</span>, <span class="params">tf</span>.<span class="params">float32</span>)</span>)</span><br><span class="line"># Loss</span><br><span class="line">cross_entropy = tf.reduce<span class="constructor">_mean(<span class="params">tf</span>.<span class="params">nn</span>.<span class="params">sparse_softmax_cross_entropy_with_logits</span>(<span class="params">labels</span>=<span class="params">y_label_reshape</span>, <span class="params">logits</span>=<span class="params">tf</span>.<span class="params">cast</span>(<span class="params">y</span>, <span class="params">tf</span>.<span class="params">float32</span>)</span>))</span><br><span class="line"># Train</span><br><span class="line">train = tf.train.<span class="constructor">AdamOptimizer(FLAGS.<span class="params">learning_rate</span>)</span>.minimize(cross_entropy, global_step=global_step)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里计算交叉熵使用的是 sparse_softmax_cross_entropy_with_logits() 方法，Optimizer 使用的是 Adam。 最后指定训练过程和测试过程即可，训练过程如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> range(FLAGS.epoch_num):</span><br><span class="line">    tf.train.global_step(sess, <span class="attribute">global_step_tensor</span>=global_step)</span><br><span class="line">    # Train</span><br><span class="line">    sess.<span class="builtin-name">run</span>(train_initializer)</span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">step</span> <span class="keyword">in</span> range(int(train_steps)):</span><br><span class="line">        smrs, loss, acc, gstep, _ = sess.<span class="builtin-name">run</span>([summaries, cross_entropy, accuracy, global_step, train], feed_dict=&#123;keep_prob: FLAGS.keep_prob&#125;)</span><br><span class="line">        # <span class="builtin-name">Print</span> log</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">step</span> % FLAGS.steps_per_print == 0:</span><br><span class="line">            <span class="builtin-name">print</span>(<span class="string">'Global Step'</span>, gstep, <span class="string">'Step'</span>, <span class="keyword">step</span>, <span class="string">'Train Loss'</span>, loss, <span class="string">'Accuracy'</span>, acc)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> epoch % FLAGS.epochs_per_dev == 0:</span><br><span class="line">        # Dev</span><br><span class="line">        sess.<span class="builtin-name">run</span>(dev_initializer)</span><br><span class="line">        <span class="keyword">for</span> <span class="keyword">step</span> <span class="keyword">in</span> range(int(dev_steps)):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">step</span> % FLAGS.steps_per_print == 0:</span><br><span class="line">                <span class="builtin-name">print</span>(<span class="string">'Dev Accuracy'</span>, sess.<span class="builtin-name">run</span>(accuracy, feed_dict=&#123;keep_prob: 1&#125;), <span class="string">'Step'</span>, <span class="keyword">step</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里训练时首先调用了 train_initializer，将 iterator 指向训练数据，这样每调用一次 get_next()，x 和 y_label 就会被赋值为训练数据的一个 batch，接下来打印输出了 Loss，Accuracy 等内容。另外对于开发集来说，每次进行验证的时候也需要重新调用 dev_initializer，这样 iterator 会再次指向开发集，这样每调用一次 get_next()，x 和 y_label 就会被赋值为开发集的一个 batch，然后进行验证。 对于测试来说，我们可以计算其准确率，然后将测试的结果输出出来，代码实现如下：</p>
                  <figure class="highlight sas">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sess.r<span class="meta">un(</span>test_initializer)</span><br><span class="line">for step <span class="meta">in</span><span class="meta"> range(</span>int(test_steps)):</span><br><span class="line">    x_results, y_predict_results, acc = sess.r<span class="meta">un(</span>[<span class="meta">x</span>, y_predict, accuracy], feed_dict=&#123;keep_prob: 1&#125;)</span><br><span class="line">    p<span class="meta">rint(</span><span class="string">'Test step'</span>, step, <span class="string">'Accuracy'</span>, acc)</span><br><span class="line">    y_predict_results = np.reshape(y_predict_results, x_results.shape)</span><br><span class="line">    for i <span class="meta">in</span><span class="meta"> range(</span>l<span class="meta">en(</span>x_results)):</span><br><span class="line">        x_result, y_predict_result = <span class="meta">list</span>(filter(lambda <span class="meta">x</span>: <span class="meta">x</span>, x_results[i])), <span class="meta">list</span>(</span><br><span class="line">            filter(lambda <span class="meta">x</span>: <span class="meta">x</span>, y_predict_results[i]))</span><br><span class="line">        x_text, y_predict_text = <span class="string">''</span>.jo<span class="meta">in(</span>id2word[x_result].values), <span class="string">''</span>.jo<span class="meta">in(</span>id2tag[y_predict_result].values)</span><br><span class="line">        p<span class="meta">rint(</span>x_text, y_predict_text)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里打印输出了当前测试的准确率，然后得到了测试结果，然后再结合词表将测试的真正结果打印出来即可。</p>
                  <h2 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h2>
                  <p>在训练过程中，我们需要构建模型图，然后调用训练部分的代码进行训练，输出结果类似如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Global Step <span class="number">0</span> Step <span class="number">0</span> Train Loss <span class="number">1.67181</span> Accuracy <span class="number">0.1475</span></span><br><span class="line">Global Step <span class="number">100</span> Step <span class="number">100</span> Train Loss <span class="number">0.210423</span> Accuracy <span class="number">0.928125</span></span><br><span class="line">Global Step <span class="number">200</span> Step <span class="number">200</span> Train Loss <span class="number">0.208561</span> Accuracy <span class="number">0.920625</span></span><br><span class="line">Global Step <span class="number">300</span> Step <span class="number">300</span> Train Loss <span class="number">0.185281</span> Accuracy <span class="number">0.939375</span></span><br><span class="line">Global Step <span class="number">400</span> Step <span class="number">400</span> Train Loss <span class="number">0.186069</span> Accuracy <span class="number">0.938125</span></span><br><span class="line">Global Step <span class="number">500</span> Step <span class="number">500</span> Train Loss <span class="number">0.165667</span> Accuracy <span class="number">0.94375</span></span><br><span class="line">Global Step <span class="number">600</span> Step <span class="number">600</span> Train Loss <span class="number">0.201692</span> Accuracy <span class="number">0.9275</span></span><br><span class="line">Global Step <span class="number">700</span> Step <span class="number">700</span> Train Loss <span class="number">0.13299</span> Accuracy <span class="number">0.954375</span></span><br><span class="line">...</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>随着训练的进行，准确率可以达到 96% 左右。 在测试阶段，输出了当前模型的准确率及真实测试输出结果，输出结果类似如下：</p>
                  <figure class="highlight subunit">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">Test </span>step 0 Accuracy 0.946125</span><br><span class="line">据新华社北京７月９日电连日来 sbmebebmmesbes</span><br><span class="line">董新辉为自己此生不能侍奉母亲而难过 bmesbebebebmmesbe</span><br><span class="line">...</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可见测试准确率在 95% 左右，对于测试数据，此处还输出了每句话的序列标注结果，如第一行结果中，“据”字对应的标注就是 s，代表单字成词，“新”字对应的标注是 b，代表词的起始，“华”字对应标注是 m，代表词的中间，“社”字对应的标注是 e，代表结束，这样 “据”、“新华社” 就可以被分成两个词了，可见还是有一定效果的。</p>
                  <h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2>
                  <p>本节通过搭建一个 Bi-LSTM 网络实现了序列标注，并可实现分词，准确率可达到 95% 左右，但是最主要的还是学习 Bi-LSTM 的用法，本实例代码较多，部分代码已经省略，完整代码见：<a href="https://github.com/AIDeepLearning/BiLSTMWordBreaker" target="_blank" rel="noopener">https://github.com/AIDeepLearning/BiLSTMWordBreaker</a>。</p>
                  <h2 id="参考来源"><a href="#参考来源" class="headerlink" title="参考来源"></a>参考来源</h2>
                  <ul>
                    <li><a href="http://blog.csdn.net/jerr__y/article/details/70471066" target="_blank" rel="noopener">TensorFlow入门 双端 LSTM 实现序列标注</a></li>
                    <li><a href="http://spaces.ac.cn/archives/3924/" target="_blank" rel="noopener">基于双向LSTM的seq2seq字标注</a></li>
                    <li><a href="https://www.leiphone.com/news/201711/zV7yM5W1dFrzs8W5.html" target="_blank" rel="noopener">TensorFlow全新的数据读取方式：Dataset API入门教程</a></li>
                    <li><a href="https://www.tensorflow.org/programmers_guide/datasets" target="_blank" rel="noopener">TensorFlow Importing Data</a></li>
                  </ul>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-22 02:18:38" itemprop="dateCreated datePublished" datetime="2018-01-22T02:18:38+08:00">2018-01-22</time>
                </span>
                <span id="/5001.html" class="post-meta-item leancloud_visitors" data-flag-title="TensorFlow Bi-LSTM实现序列标注" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>9.3k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>8 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/4989.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/4989.html" class="post-title-link" itemprop="url">Ansible扩展</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h1 id="Ansible简介"><a href="#Ansible简介" class="headerlink" title="Ansible简介"></a>Ansible简介</h1>
                  <p> Ansible是由Python开发的一个运维工具，因为工作需要接触到Ansible，经常会集成一些东西到Ansible，所以对Ansible的了解越来越多。 那Ansible到底是什么呢？在我的理解中，原来需要登录到服务器上，然后执行一堆命令才能完成一些操作。而Ansible就是来代替我们去执行那些命令。并且可以通过Ansible控制多台机器，在机器上进行任务的编排和执行，在Ansible中称为playbook。 那Ansible是如何做到的呢？简单点说，就是Ansible将我们要执行的命令生成一个脚本，然后通过sftp将脚本上传到要执行命令的服务器上，然后在通过ssh协议，执行这个脚本并将执行结果返回。 那Ansible具体是怎么做到的呢？下面从模块和插件来看一下Ansible是如何完成一个模块的执行 PS：下面的分析都是在对Ansible有一些具体使用经验之后，通过阅读源代码进一步得出的执行结论，所以希望在看本文时，是建立在对Ansible有一定了解的基础上，最起码对于Ansible的一些概念有了解，例如inventory，module，playbooks等 </p>
                  <h1 id="Ansible模块"><a href="#Ansible模块" class="headerlink" title="Ansible模块"></a>Ansible模块</h1>
                  <p> 模块是Ansible执行的最小单位，可以是由Python编写，也可以是Shell编写，也可以是由其他语言编写。模块中定义了具体的操作步骤以及实际使用过程中所需要的参数 执行的脚本就是根据模块生成一个可执行的脚本。 那Ansible是怎么样将这个脚本上传到服务器上，然后执行获取结果的呢？ </p>
                  <h1 id="Ansible插件"><a href="#Ansible插件" class="headerlink" title="Ansible插件"></a>Ansible插件</h1>
                  <h2 id="connection插件"><a href="#connection插件" class="headerlink" title="connection插件"></a><strong>connection插件</strong></h2>
                  <p>连接插件，根据指定的ssh参数连接指定的服务器，并切提供实际执行命令的接口</p>
                  <h2 id="shell插件"><a href="#shell插件" class="headerlink" title="shell插件"></a><strong>shell插件</strong></h2>
                  <p>命令插件，根据sh类型，来生成用于connection时要执行的命令</p>
                  <h2 id="strategy插件"><a href="#strategy插件" class="headerlink" title="strategy插件"></a><strong>strategy插件</strong></h2>
                  <p>执行策略插件，默认情况下是线性插件，就是一个任务接着一个任务的向下执行，此插件将任务丢到执行器去执行。</p>
                  <h2 id="action插件"><a href="#action插件" class="headerlink" title="action插件"></a><strong>action插件</strong></h2>
                  <p>动作插件，实质就是任务模块的所有动作，如果ansible的模块没有特别编写的action插件，默认情况下是normal或者async（这两个根据模块是否async来选择），normal和async中定义的就是模块的执行步骤。例如，本地创建临时文件，上传临时文件，执行脚本，删除脚本等等，如果想在所有的模块中增加一些特殊步骤，可以通过增加action插件的方式来扩展。 </p>
                  <h1 id="Ansible执行模块流程"><a href="#Ansible执行模块流程" class="headerlink" title="Ansible执行模块流程"></a>Ansible执行模块流程</h1>
                  <ol>
                    <li>ansible命令实质是通过ansible/cli/adhoc.py来运行，同时会收集参数信息<ol>
                        <li>设置Play信息，然后通过TaskQueueManager进行run，</li>
                        <li>TaskQueueManager需要Inventory(节点仓库)，variable_manager(收集变量),options(命令行中指定的参数),stdout_callback(回调函数)</li>
                      </ol>
                    </li>
                    <li>在task_queue_manager.py中找到run中<ol>
                        <li>初始化时会设置队列</li>
                        <li>会根据options，，variable_manager，passwords等信息设置成一个PlayContext信息(playbooks/playcontext.py)</li>
                        <li>设置插件(plugins)信息callback_loader(回调), strategy_loader(执行策略), module_loader(任务模块)</li>
                        <li>通过strategy_loader（strategy插件）的run（默认的strategy类型是linear，线性执行），去按照顺序执行所有的任务（执行一个模块，可能会执行多个任务）</li>
                        <li>在strategy_loader插件run之后，会判断action类型。如果是meta类型的话会单独执行(不是具体的ansible模块时)，而其他模块时，会加载到队列_queue_task</li>
                        <li>在队列中会调用WorkerProcess去处理，在workerproces实际的run之后，会使用TaskExecutor进行执行</li>
                        <li>在TaskExecutor中会设置connection插件，并且根据task的类型（模块。或是include等）获取action插件，就是对应的模块，如果模块有自定义的执行，则会执行自定义的action，如果没有的会使用normal或者async，这个是根据是否是任务的async属性来决定</li>
                        <li>在Action插件中定义着执行的顺序，及具体操作，例如生成临时目录，生成临时脚本，所以要在统一的模式下，集成一些额外的处理时，可以重写Action的方法</li>
                        <li>通过Connection插件来执行Action的各个操作步骤</li>
                      </ol>
                    </li>
                  </ol>
                  <h1 id="扩展Ansible实例"><a href="#扩展Ansible实例" class="headerlink" title="扩展Ansible实例"></a>扩展Ansible实例</h1>
                  <h2 id="执行节点Python环境扩展"><a href="#执行节点Python环境扩展" class="headerlink" title="执行节点Python环境扩展"></a>执行节点Python环境扩展</h2>
                  <p>实际需求中，我们扩展的一些Ansible模块需要使用三方库，但每个节点中安装这些库有些不易于管理。ansible执行模块的实质就是在节点的python环境下执行生成的脚本，所以我们采取的方案是，指定节点上的Python环境，将局域网内一个python环境作为<strong>nfs</strong>共享。通过扩展Action插件，增加节点上挂载nfs，待执行结束后再将节点上的nfs卸载。具体实施步骤如下： 扩展代码：</p>
                  <p>重写ActionBase的execute_module方法</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># execute_module</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> (absolute_import, division, print_function)</span><br><span class="line">__metaclass__ = type</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> pipes</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ansible.compat.six <span class="keyword">import</span> text_type, iteritems</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ansible <span class="keyword">import</span> constants <span class="keyword">as</span> C</span><br><span class="line"><span class="keyword">from</span> ansible.errors <span class="keyword">import</span> AnsibleError</span><br><span class="line"><span class="keyword">from</span> ansible.release <span class="keyword">import</span> __version__</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">from</span> __main__ <span class="keyword">import</span> display</span><br><span class="line"><span class="keyword">except</span> ImportError:</span><br><span class="line">    <span class="keyword">from</span> ansible.utils.display <span class="keyword">import</span> Display</span><br><span class="line">    display = Display()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MagicStackBase</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_mount_nfs</span><span class="params">(self, ansible_nfs_src, ansible_nfs_dest)</span>:</span></span><br><span class="line">        cmd = [<span class="string">'mount'</span>,ansible_nfs_src, ansible_nfs_dest]</span><br><span class="line">        cmd = [pipes.quote(c) <span class="keyword">for</span> c <span class="keyword">in</span> cmd]</span><br><span class="line">        cmd = <span class="string">' '</span>.join(cmd)</span><br><span class="line">        result = self._low_level_execute_command(cmd=cmd, sudoable=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_umount_nfs</span><span class="params">(self, ansible_nfs_dest)</span>:</span></span><br><span class="line">        cmd = [<span class="string">'umount'</span>, ansible_nfs_dest]</span><br><span class="line">        cmd = [pipes.quote(c) <span class="keyword">for</span> c <span class="keyword">in</span> cmd]</span><br><span class="line">        cmd = <span class="string">' '</span>.join(cmd)</span><br><span class="line">        result = self._low_level_execute_command(cmd=cmd, sudoable=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_execute_module</span><span class="params">(self, module_name=None, module_args=None, tmp=None, task_vars=None, persist_files=False, delete_remote_tmp=True)</span>:</span></span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        Transfer and run a module along with its arguments.</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># display.v(task_vars)</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> task_vars <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            task_vars = dict()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># if a module name was not specified for this execution, use</span></span><br><span class="line">        <span class="comment"># the action from the task</span></span><br><span class="line">        <span class="keyword">if</span> module_name <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            module_name = self._task.action</span><br><span class="line">        <span class="keyword">if</span> module_args <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            module_args = self._task.args</span><br><span class="line"></span><br><span class="line">        <span class="comment"># set check mode in the module arguments, if required</span></span><br><span class="line">        <span class="keyword">if</span> self._play_context.check_mode:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self._supports_check_mode:</span><br><span class="line">                <span class="keyword">raise</span> AnsibleError(<span class="string">"check mode is not supported for this operation"</span>)</span><br><span class="line">            module_args[<span class="string">'_ansible_check_mode'</span>] = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            module_args[<span class="string">'_ansible_check_mode'</span>] = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Get the connection user for permission checks</span></span><br><span class="line">        remote_user = task_vars.get(<span class="string">'ansible_ssh_user'</span>) <span class="keyword">or</span> self._play_context.remote_user</span><br><span class="line"></span><br><span class="line">        <span class="comment"># set no log in the module arguments, if required</span></span><br><span class="line">        module_args[<span class="string">'_ansible_no_log'</span>] = self._play_context.no_log <span class="keyword">or</span> C.DEFAULT_NO_TARGET_SYSLOG</span><br><span class="line"></span><br><span class="line">        <span class="comment"># set debug in the module arguments, if required</span></span><br><span class="line">        module_args[<span class="string">'_ansible_debug'</span>] = C.DEFAULT_DEBUG</span><br><span class="line"></span><br><span class="line">        <span class="comment"># let module know we are in diff mode</span></span><br><span class="line">        module_args[<span class="string">'_ansible_diff'</span>] = self._play_context.diff</span><br><span class="line"></span><br><span class="line">        <span class="comment"># let module know our verbosity</span></span><br><span class="line">        module_args[<span class="string">'_ansible_verbosity'</span>] = display.verbosity</span><br><span class="line"></span><br><span class="line">        <span class="comment"># give the module information about the ansible version</span></span><br><span class="line">        module_args[<span class="string">'_ansible_version'</span>] = __version__</span><br><span class="line"></span><br><span class="line">        <span class="comment"># set the syslog facility to be used in the module</span></span><br><span class="line">        module_args[<span class="string">'_ansible_syslog_facility'</span>] = task_vars.get(<span class="string">'ansible_syslog_facility'</span>, C.DEFAULT_SYSLOG_FACILITY)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># let module know about filesystems that selinux treats specially</span></span><br><span class="line">        module_args[<span class="string">'_ansible_selinux_special_fs'</span>] = C.DEFAULT_SELINUX_SPECIAL_FS</span><br><span class="line"></span><br><span class="line">        (module_style, shebang, module_data) = self._configure_module(module_name=module_name, module_args=module_args, task_vars=task_vars)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> shebang:</span><br><span class="line">            <span class="keyword">raise</span> AnsibleError(<span class="string">"module (%s) is missing interpreter line"</span> % module_name)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># get nfs info for mount python packages</span></span><br><span class="line">        ansible_nfs_src = task_vars.get(<span class="string">"ansible_nfs_src"</span>, <span class="literal">None</span>)</span><br><span class="line">        ansible_nfs_dest = task_vars.get(<span class="string">"ansible_nfs_dest"</span>, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># a remote tmp path may be necessary and not already created</span></span><br><span class="line">        remote_module_path = <span class="literal">None</span></span><br><span class="line">        args_file_path = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> tmp <span class="keyword">and</span> self._late_needs_tmp_path(tmp, module_style):</span><br><span class="line">            tmp = self._make_tmp_path(remote_user)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> tmp:</span><br><span class="line">            remote_module_filename = self._connection._shell.get_remote_filename(module_name)</span><br><span class="line">            remote_module_path = self._connection._shell.join_path(tmp, remote_module_filename)</span><br><span class="line">            <span class="keyword">if</span> module_style <span class="keyword">in</span> [<span class="string">'old'</span>, <span class="string">'non_native_want_json'</span>]:</span><br><span class="line">                <span class="comment"># we'll also need a temp file to hold our module arguments</span></span><br><span class="line">                args_file_path = self._connection._shell.join_path(tmp, <span class="string">'args'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> remote_module_path <span class="keyword">or</span> module_style != <span class="string">'new'</span>:</span><br><span class="line">            display.debug(<span class="string">"transferring module to remote"</span>)</span><br><span class="line">            self._transfer_data(remote_module_path, module_data)</span><br><span class="line">            <span class="keyword">if</span> module_style == <span class="string">'old'</span>:</span><br><span class="line">                <span class="comment"># we need to dump the module args to a k=v string in a file on</span></span><br><span class="line">                <span class="comment"># the remote system, which can be read and parsed by the module</span></span><br><span class="line">                args_data = <span class="string">""</span></span><br><span class="line">                <span class="keyword">for</span> k,v <span class="keyword">in</span> iteritems(module_args):</span><br><span class="line">                    args_data += <span class="string">'%s=%s '</span> % (k, pipes.quote(text_type(v)))</span><br><span class="line">                self._transfer_data(args_file_path, args_data)</span><br><span class="line">            <span class="keyword">elif</span> module_style == <span class="string">'non_native_want_json'</span>:</span><br><span class="line">                self._transfer_data(args_file_path, json.dumps(module_args))</span><br><span class="line">            display.debug(<span class="string">"done transferring module to remote"</span>)</span><br><span class="line"></span><br><span class="line">        environment_string = self._compute_environment_string()</span><br><span class="line"></span><br><span class="line">        remote_files = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> args_file_path:</span><br><span class="line">            remote_files = tmp, remote_module_path, args_file_path</span><br><span class="line">        <span class="keyword">elif</span> remote_module_path:</span><br><span class="line">            remote_files = tmp, remote_module_path</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Fix permissions of the tmp path and tmp files.  This should be</span></span><br><span class="line">        <span class="comment"># called after all files have been transferred.</span></span><br><span class="line">        <span class="keyword">if</span> remote_files:</span><br><span class="line">            self._fixup_perms2(remote_files, remote_user)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment"># mount nfs</span></span><br><span class="line">        <span class="keyword">if</span> ansible_nfs_src <span class="keyword">and</span> ansible_nfs_dest:</span><br><span class="line">            result = self._mount_nfs(ansible_nfs_src, ansible_nfs_dest)</span><br><span class="line">            <span class="keyword">if</span> result[<span class="string">'rc'</span>] != <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">raise</span> AnsibleError(<span class="string">"mount nfs failed!!! &#123;0&#125;"</span>.format(result[<span class="string">'stderr'</span>]))</span><br><span class="line"></span><br><span class="line">        cmd = <span class="string">""</span></span><br><span class="line">        in_data = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self._connection.has_pipelining <span class="keyword">and</span> self._play_context.pipelining <span class="keyword">and</span> <span class="keyword">not</span> C.DEFAULT_KEEP_REMOTE_FILES <span class="keyword">and</span> module_style == <span class="string">'new'</span>:</span><br><span class="line">            in_data = module_data</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> remote_module_path:</span><br><span class="line">                cmd = remote_module_path</span><br><span class="line"></span><br><span class="line">        rm_tmp = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> tmp <span class="keyword">and</span> <span class="string">"tmp"</span> <span class="keyword">in</span> tmp <span class="keyword">and</span> <span class="keyword">not</span> C.DEFAULT_KEEP_REMOTE_FILES <span class="keyword">and</span> <span class="keyword">not</span> persist_files <span class="keyword">and</span> delete_remote_tmp:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self._play_context.become <span class="keyword">or</span> self._play_context.become_user == <span class="string">'root'</span>:</span><br><span class="line">                <span class="comment"># not sudoing or sudoing to root, so can cleanup files in the same step</span></span><br><span class="line">                rm_tmp = tmp</span><br><span class="line"></span><br><span class="line">        cmd = self._connection._shell.build_module_command(environment_string, shebang, cmd, arg_path=args_file_path, rm_tmp=rm_tmp)</span><br><span class="line">        cmd = cmd.strip()</span><br><span class="line">        sudoable = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">if</span> module_name == <span class="string">"accelerate"</span>:</span><br><span class="line">            <span class="comment"># always run the accelerate module as the user</span></span><br><span class="line">            <span class="comment"># specified in the play, not the sudo_user</span></span><br><span class="line">            sudoable = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        res = self._low_level_execute_command(cmd, sudoable=sudoable, in_data=in_data)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># umount nfs</span></span><br><span class="line">        <span class="keyword">if</span> ansible_nfs_src <span class="keyword">and</span> ansible_nfs_dest:</span><br><span class="line">            result = self._umount_nfs(ansible_nfs_dest)</span><br><span class="line">            <span class="keyword">if</span> result[<span class="string">'rc'</span>] != <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">raise</span> AnsibleError(<span class="string">"umount nfs failed!!! &#123;0&#125;"</span>.format(result[<span class="string">'stderr'</span>]))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> tmp <span class="keyword">and</span> <span class="string">"tmp"</span> <span class="keyword">in</span> tmp <span class="keyword">and</span> <span class="keyword">not</span> C.DEFAULT_KEEP_REMOTE_FILES <span class="keyword">and</span> <span class="keyword">not</span> persist_files <span class="keyword">and</span> delete_remote_tmp:</span><br><span class="line">            <span class="keyword">if</span> self._play_context.become <span class="keyword">and</span> self._play_context.become_user != <span class="string">'root'</span>:</span><br><span class="line">                <span class="comment"># not sudoing to root, so maybe can't delete files as that other user</span></span><br><span class="line">                <span class="comment"># have to clean up temp files as original user in a second step</span></span><br><span class="line">                tmp_rm_cmd = self._connection._shell.remove(tmp, recurse=<span class="literal">True</span>)</span><br><span class="line">                tmp_rm_res = self._low_level_execute_command(tmp_rm_cmd, sudoable=<span class="literal">False</span>)</span><br><span class="line">                tmp_rm_data = self._parse_returned_data(tmp_rm_res)</span><br><span class="line">                <span class="keyword">if</span> tmp_rm_data.get(<span class="string">'rc'</span>, <span class="number">0</span>) != <span class="number">0</span>:</span><br><span class="line">                    display.warning(<span class="string">'Error deleting remote temporary files (rc: &#123;0&#125;, stderr: &#123;1&#125;)'</span>.format(tmp_rm_res.get(<span class="string">'rc'</span>), tmp_rm_res.get(<span class="string">'stderr'</span>, <span class="string">'No error string available.'</span>)))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># parse the main result</span></span><br><span class="line">        data = self._parse_returned_data(res)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># pre-split stdout into lines, if stdout is in the data and there</span></span><br><span class="line">        <span class="comment"># isn't already a stdout_lines value there</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">'stdout'</span> <span class="keyword">in</span> data <span class="keyword">and</span> <span class="string">'stdout_lines'</span> <span class="keyword">not</span> <span class="keyword">in</span> data:</span><br><span class="line">            data[<span class="string">'stdout_lines'</span>] = data.get(<span class="string">'stdout'</span>, <span class="string">u''</span>).splitlines()</span><br><span class="line"></span><br><span class="line">        display.debug(<span class="string">"done with _execute_module (%s, %s)"</span> % (module_name, module_args))</span><br><span class="line">        <span class="keyword">return</span> data</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>集成到normal.py和async.py中，记住要将这两个插件在ansible.cfg中进行配置</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> __future__ import (absolute_import, division, print_function)</span><br><span class="line">__metaclass__ = type</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ansible.plugins.action import ActionBase</span><br><span class="line"><span class="keyword">from</span> ansible.utils.vars import merge_hash</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> common.ansible_plugins import MagicStackBase</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class ActionModule(MagicStackBase, ActionBase):</span><br><span class="line"></span><br><span class="line">    def <span class="builtin-name">run</span>(self, <span class="attribute">tmp</span>=None, <span class="attribute">task_vars</span>=None):</span><br><span class="line">        <span class="keyword">if</span> task_vars is None:</span><br><span class="line">            task_vars = dict()</span><br><span class="line"></span><br><span class="line">        results = super(ActionModule, self).<span class="builtin-name">run</span>(tmp, task_vars)</span><br><span class="line">        # <span class="builtin-name">remove</span> as modules might hide due <span class="keyword">to</span> nolog</span><br><span class="line">        del results[<span class="string">'invocation'</span>][<span class="string">'module_args'</span>]</span><br><span class="line">        results = merge_hash(results, self._execute_module(<span class="attribute">tmp</span>=tmp, <span class="attribute">task_vars</span>=task_vars))</span><br><span class="line">        # <span class="builtin-name">Remove</span> special fields <span class="keyword">from</span> the result, which can only be set</span><br><span class="line">        # internally by the executor engine. We <span class="keyword">do</span> this only here <span class="keyword">in</span></span><br><span class="line">        # the <span class="string">'normal'</span> action, as other action plugins may <span class="builtin-name">set</span> this.</span><br><span class="line">        #</span><br><span class="line">        # We don<span class="string">'t want modules to determine that running the module fires</span></span><br><span class="line"><span class="string">        # notify handlers.  That'</span>s <span class="keyword">for</span> the playbook <span class="keyword">to</span> decide.</span><br><span class="line">        <span class="keyword">for</span> field <span class="keyword">in</span> (<span class="string">'_ansible_notify'</span>,):</span><br><span class="line">            <span class="keyword">if</span> field <span class="keyword">in</span> results:</span><br><span class="line">                results.pop(field)</span><br><span class="line"></span><br><span class="line">        return results</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <ul>
                    <li>配置ansible.cfg，将扩展的插件指定为ansible需要的action插件</li>
                    <li>重写插件方法，重点是execute_module</li>
                    <li>执行命令中需要指定Python环境，将需要的参数添加进去nfs挂载和卸载的参数</li>
                  </ul>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">ansible <span class="number">51</span> -m mysql_db -<span class="selector-tag">a</span> <span class="string">"state=dump name=all target=/tmp/test.sql"</span> -<span class="selector-tag">i</span> hosts -u root -v -e <span class="string">"ansible_nfs_src=172.16.30.170:/web/proxy_env/lib64/python2.7/site-packages ansible_nfs_dest=/root/.pyenv/versions/2.7.10/lib/python2.7/site-packages ansible_python_interpreter=/root/.pyenv/versions/2.7.10/bin/python"</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/孟先森" class="author" itemprop="url" rel="index">孟先森</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-21 15:18:39" itemprop="dateCreated datePublished" datetime="2018-01-21T15:18:39+08:00">2018-01-21</time>
                </span>
                <span id="/4989.html" class="post-meta-item leancloud_visitors" data-flag-title="Ansible扩展" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>10k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>9 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/4959.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/4959.html" class="post-title-link" itemprop="url">跟繁琐的命令行说拜拜！Gerapy分布式爬虫管理框架来袭！</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2>
                  <p>用 Python 做过爬虫的小伙伴可能接触过 Scrapy，GitHub：<a href="https://github.com/scrapy/scrapy" target="_blank" rel="noopener">https://github.com/scrapy/scrapy</a>。Scrapy 的确是一个非常强大的爬虫框架，爬取效率高，扩展性好，基本上是使用 Python 开发爬虫的必备利器。如果使用 Scrapy 做爬虫，那么在爬取时，我们当然完全可以使用自己的主机来完成爬取，但当爬取量非常大的时候，我们肯定不能在自己的机器上来运行爬虫了，一个好的方法就是将 Scrapy 部署到远程服务器上来执行。 所以，这时候就出现了另一个库 Scrapyd，GitHub：<a href="https://github.com/scrapy/scrapyd" target="_blank" rel="noopener">https://github.com/scrapy/scrapyd</a>，有了它我们只需要在远程服务器上安装一个 Scrapyd，启动这个服务，就可以将我们写的 Scrapy 项目部署到远程主机上了，Scrapyd 还提供了各种操作 API，可以自由地控制 Scrapy 项目的运行，API 文档：<a href="http://scrapyd.readthedocs.io/en/stable/api.html" target="_blank" rel="noopener">http://scrapyd.readthedocs.io/en/stable/api.html</a>，例如我们将 Scrapyd 安装在 IP 为 88.88.88.88 的服务器上，然后将 Scrapy 项目部署上去，这时候我们通过请求 API 就可以来控制 Scrapy 项目的运行了，命令如下：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl <span class="string">http:</span><span class="comment">//88.88.88.88:6800/schedule.json -d project=myproject -d spider=somespider</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就相当于启动了 myproject 项目的 somespider 爬虫，而不用我们再用命令行方式去启动爬虫，同时 Scrapyd 还提供了查看爬虫状态、取消爬虫任务、添加爬虫版本、删除爬虫版本等等的一系列 API，所以说，有了 Scrapyd，我们可以通过 API 来控制爬虫的运行，摆脱了命令行的依赖。 另外爬虫部署还是个麻烦事，因为我们需要将爬虫代码上传到远程服务器上，这个过程涉及到打包和上传两个过程，在 Scrapyd 中其实提供了这个部署的 API，叫做 addversion，但是它接受的内容是 egg 包文件，所以说要用这个接口，我们必须要把我们的 Scrapy 项目打包成 egg 文件，然后再利用文件上传的方式请求这个 addversion 接口才可以完成上传，这个过程又比较繁琐了，所以又出现了一个工具叫做 Scrapyd-Client，GitHub：<a href="https://github.com/scrapy/scrapyd-client" target="_blank" rel="noopener">https://github.com/scrapy/scrapyd-client</a>，利用它的 scrapyd-deploy 命令我们便可以完成打包和上传的两个功能，可谓是又方便了一步。 这样我们就已经解决了部署的问题，回过头来，如果我们要想实时查看服务器上 Scrapy 的运行状态，那该怎么办呢？像刚才说的，当然是请求 Scrapyd 的 API 了，如果我们想用 Python 程序来控制一下呢？我们还要用 requests 库一次次地请求这些 API ？这就太麻烦了吧，所以为了解决这个需求，Scrapyd-API 又出现了，GitHub：<a href="https://github.com/djm/python-scrapyd-api" target="_blank" rel="noopener">https://github.com/djm/python-scrapyd-api</a>，有了它我们可以只用简单的 Python 代码就可以实现 Scrapy 项目的监控和运行：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from scrapyd_api import ScrapydAPI</span><br><span class="line">scrapyd = <span class="constructor">ScrapydAPI('<span class="params">http</span>:<span class="operator">/</span><span class="operator">/</span>88.888.88.88:6800')</span></span><br><span class="line">scrapyd.<span class="built_in">list</span><span class="constructor">_jobs('<span class="params">project_name</span>')</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样它的返回结果就是各个 Scrapy 项目的运行情况。 例如：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">    <span class="string">'pending'</span>: [</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">'running'</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">'id'</span>: <span class="string">u'14a65...b27ce'</span>,</span><br><span class="line">            <span class="string">'spider'</span>: <span class="string">u'spider_name'</span>,</span><br><span class="line">            <span class="string">'start_time'</span>: <span class="string">u'2018-01-17 22:45:31.975358'</span></span><br><span class="line">        &#125;,</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">'finished'</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">'id'</span>: <span class="string">'34c23...b21ba'</span>,</span><br><span class="line">            <span class="string">'spider'</span>: <span class="string">'spider_name'</span>,</span><br><span class="line">            <span class="string">'start_time'</span>: <span class="string">'2018-01-11 22:45:31.975358'</span>,</span><br><span class="line">            <span class="string">'end_time'</span>: <span class="string">'2018-01-17 14:01:18.209680'</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们就可以看到 Scrapy 爬虫的运行状态了。 所以，有了它们，我们可以完成的是：</p>
                  <ul>
                    <li>通过 Scrapyd 完成 Scrapy 项目的部署</li>
                    <li>通过 Scrapyd 提供的 API 来控制 Scrapy 项目的启动及状态监控</li>
                    <li>通过 Scrapyd-Client 来简化 Scrapy 项目的部署</li>
                    <li>通过 Scrapyd-API 来通过 Python 控制 Scrapy 项目</li>
                  </ul>
                  <p>是不是方便多了？ 可是？真的达到最方便了吗？肯定没有！如果这一切的一切，从 Scrapy 的部署、启动到监控、日志查看，我们只需要鼠标键盘点几下就可以完成，那岂不是美滋滋？更或者说，连 Scrapy 代码都可以帮你自动生成，那岂不是爽爆了？ 有需求就有动力，没错，Gerapy 就是为此而生的，GitHub：<a href="https://github.com/Gerapy/Gerapy" target="_blank" rel="noopener">https://github.com/Gerapy/Gerapy</a>。 本节我们就来简单了解一下 Gerapy 分布式爬虫管理框架的使用方法。</p>
                  <h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2>
                  <p>Gerapy 是一款分布式爬虫管理框架，支持 Python 3，基于 Scrapy、Scrapyd、Scrapyd-Client、Scrapy-Redis、Scrapyd-API、Scrapy-Splash、Jinjia2、Django、Vue.js 开发，Gerapy 可以帮助我们：</p>
                  <ul>
                    <li>更方便地控制爬虫运行</li>
                    <li>更直观地查看爬虫状态</li>
                    <li>更实时地查看爬取结果</li>
                    <li>更简单地实现项目部署</li>
                    <li>更统一地实现主机管理</li>
                    <li>更轻松地编写爬虫代码</li>
                  </ul>
                  <p>安装非常简单，只需要运行 pip3 命令即可：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">$ pip3 <span class="keyword">install</span> gerapy</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>安装完成之后我们就可以使用 gerapy 命令了，输入 gerapy 便可以获取它的基本使用方法：</p>
                  <figure class="highlight fsharp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">$ gerapy</span><br><span class="line">Usage:</span><br><span class="line">  gerapy init [--folder=&lt;folder&gt;]</span><br><span class="line">  gerapy migrate</span><br><span class="line">  gerapy createsuperuser</span><br><span class="line">  gerapy runserver <span class="meta">[&lt;host:port&gt;]</span></span><br><span class="line">  gerapy makemigrations</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果出现上述结果，就证明 Gerapy 安装成功了。</p>
                  <h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2>
                  <p>接下来我们来开始使用 Gerapy，首先利用如下命令进行一下初始化，在任意路径下均可执行如下命令：</p>
                  <figure class="highlight elixir">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">$ </span>gerapy init</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>执行完毕之后，本地便会生成一个名字为 gerapy 的文件夹，接着进入该文件夹，可以看到有一个 projects 文件夹，我们后面会用到。 紧接着执行数据库初始化命令：</p>
                  <figure class="highlight properties">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">cd</span> <span class="string">gerapy</span></span><br><span class="line"><span class="attr">gerapy</span> <span class="string">migrate</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样它就会在 gerapy 目录下生成一个 SQLite 数据库，同时建立数据库表。 接着我们只需要再运行命令启动服务就好了：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">gerapy runserver</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们就可以看到 Gerapy 已经在 8000 端口上运行了。 全部的操作流程截图如下： <img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/01/WX20180120-021017@2x-1100x988.png" alt=""> 接下来我们在浏览器中打开 <a href="http://localhost:8000/，就可以看到" target="_blank" rel="noopener">http://localhost:8000/，就可以看到</a> Gerapy 的主界面了： <img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/01/WX20180120-021201@2x-1100x696.png" alt=""> 这里显示了主机、项目的状态，当然由于我们没有添加主机，所以所有的数目都是 0。 如果我们可以正常访问这个页面，那就证明 Gerapy 初始化都成功了。</p>
                  <h2 id="主机管理"><a href="#主机管理" class="headerlink" title="主机管理"></a>主机管理</h2>
                  <p>接下来我们可以点击左侧 Clients 选项卡，即主机管理页面，添加我们的 Scrapyd 远程服务，点击右上角的创建按钮即可添加我们需要管理的 Scrapyd 服务： <img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/01/WX20180120-022115@2x-1100x657.png" alt=""> 需要添加 IP、端口，以及名称，点击创建即可完成添加，点击返回即可看到当前添加的 Scrapyd 服务列表，样例如下所示： <img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/01/WX20180120-022320@2x-1100x690.png" alt=""> 这样我们可以在状态一栏看到各个 Scrapyd 服务是否可用，同时可以一目了然当前所有 Scrapyd 服务列表，另外我们还可以自由地进行编辑和删除。</p>
                  <h2 id="项目管理"><a href="#项目管理" class="headerlink" title="项目管理"></a>项目管理</h2>
                  <p>Gerapy 的核心功能当然是项目管理，在这里我们可以自由地配置、编辑、部署我们的 Scrapy 项目，点击左侧的 Projects ，即项目管理选项，我们可以看到如下空白的页面： <img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/01/WX20180120-023216@2x-1100x690.png" alt=""> 假设现在我们有一个 Scrapy 项目，如果我们想要进行管理和部署，还记得初始化过程中提到的 projects 文件夹吗？这时我们只需要将项目拖动到刚才 gerapy 运行目录的 projects 文件夹下，例如我这里写好了一个 Scrapy 项目，名字叫做 zhihusite，这时把它拖动到 projects 文件夹下： <img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/01/WX20180120-023937@2x.png" alt=""> 这时刷新页面，我们便可以看到 Gerapy 检测到了这个项目，同时它是不可配置、没有打包的： <img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/01/WX20180120-024621@2x-1100x629.png" alt=""> 这时我们可以点击部署按钮进行打包和部署，在右下角我们可以输入打包时的描述信息，类似于 Git 的 commit 信息，然后点击打包按钮，即可发现 Gerapy 会提示打包成功，同时在左侧显示打包的结果和打包名称： <img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/01/WX20180120-024945@2x-1100x283.png" alt=""> 打包成功之后，我们便可以进行部署了，我们可以选择需要部署的主机，点击后方的部署按钮进行部署，同时也可以批量选择主机进行部署，示例如下： <img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/01/15-11-1100x709.jpg" alt=""> 可以发现此方法相比 Scrapyd-Client 的命令行式部署，简直不能方便更多。</p>
                  <h2 id="监控任务"><a href="#监控任务" class="headerlink" title="监控任务"></a>监控任务</h2>
                  <p>部署完毕之后就可以回到主机管理页面进行任务调度了，任选一台主机，点击调度按钮即可进入任务管理页面，此页面可以查看当前 Scrapyd 服务的所有项目、所有爬虫及运行状态： <img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/01/15-12-1100x539.jpg" alt=""> 我们可以通过点击新任务、停止等按钮来实现任务的启动和停止等操作，同时也可以通过展开任务条目查看日志详情： <img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/01/15-13-1100x621.jpg" alt=""> 另外我们还可以随时点击停止按钮来取消 Scrapy 任务的运行。 这样我们就可以在此页面方便地管理每个 Scrapyd 服务上的 每个 Scrapy 项目的运行了。</p>
                  <h2 id="项目编辑"><a href="#项目编辑" class="headerlink" title="项目编辑"></a>项目编辑</h2>
                  <p>同时 Gerapy 还支持项目编辑功能，有了它我们不再需要 IDE 即可完成项目的编写，我们点击项目的编辑按钮即可进入到编辑页面，如图所示： <img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/01/WX20180120-030017@2x-1100x629.png" alt=""> 这样即使 Gerapy 部署在远程的服务器上，我们不方便用 IDE 打开，也不喜欢用 Vim 等编辑软件，我们可以借助于本功能方便地完成代码的编写。</p>
                  <h2 id="代码生成"><a href="#代码生成" class="headerlink" title="代码生成"></a>代码生成</h2>
                  <p>上述的项目主要针对的是我们已经写好的 Scrapy 项目，我们可以借助于 Gerapy 方便地完成编辑、部署、控制、监测等功能，而且这些项目的一些逻辑、配置都是已经写死在代码里面的，如果要修改的话，需要直接修改代码，即这些项目都是不可配置的。 在 Scrapy 中，其实提供了一个可配置化的爬虫 CrawlSpider，它可以利用一些规则来完成爬取规则和解析规则的配置，这样可配置化程度就非常高，这样我们只需要维护爬取规则、提取逻辑就可以了。如果要新增一个爬虫，我们只需要写好对应的规则即可，这类爬虫就叫做可配置化爬虫。 Gerapy 可以做到：我们写好爬虫规则，它帮我们自动生成 Scrapy 项目代码。 我们可以点击项目页面的右上角的创建按钮，增加一个可配置化爬虫，接着我们便可以在此处添加提取实体、爬取规则、抽取规则了，例如这里的解析器，我们可以配置解析成为哪个实体，每个字段使用怎样的解析方式，如 XPath 或 CSS 解析器、直接获取属性、直接添加值等多重方式，另外还可以指定处理器进行数据清洗，或直接指定正则表达式进行解析等等，通过这些流程我们可以做到任何字段的解析。 <img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/01/WX20180120-031400@2x-1100x687.png" alt=""> 再比如爬取规则，我们可以指定从哪个链接开始爬取，允许爬取的域名是什么，该链接提取哪些跟进的链接，用什么解析方法来处理等等配置。通过这些配置，我们可以完成爬取规则的设置。 <img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/01/WX20180120-031742@2x-1100x687.png" alt=""> 最后点击生成按钮即可完成代码的生成。 <img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/01/WX20180120-032023@2x-1100x687.png" alt=""> 生成的代码示例结果如图所示，可见其结构和 Scrapy 代码是完全一致的。 <img src="https://cdn.cuiqingcai.com/wp-content/uploads/2018/01/WX20180120-032249@2x-1100x570.png" alt=""> 生成代码之后，我们只需要像上述流程一样，把项目进行部署、启动就好了，不需要我们写任何一行代码，即可完成爬虫的编写、部署、控制、监测。</p>
                  <h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2>
                  <p>以上便是 Gerapy 分布式爬虫管理框架的基本用法，如需了解更多，可以访问其 GitHub：<a href="https://github.com/Gerapy/Gerapy" target="_blank" rel="noopener">https://github.com/Gerapy/Gerapy</a>。 如果觉得此框架有不足的地方，欢迎提 Issue，也欢迎发 Pull Request 来贡献代码，如果觉得 Gerapy 有所帮助，还望赐予一个 Star！非常感谢！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-20 03:34:10" itemprop="dateCreated datePublished" datetime="2018-01-20T03:34:10+08:00">2018-01-20</time>
                </span>
                <span id="/4959.html" class="post-meta-item leancloud_visitors" data-flag-title="跟繁琐的命令行说拜拜！Gerapy分布式爬虫管理框架来袭！" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>4.9k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>4 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/4934.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/4934.html" class="post-title-link" itemprop="url">TensorFlow LSTM MNIST分类</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>本节来介绍一下使用 RNN 的 LSTM 来做 MNIST 分类的方法，RNN 相比 CNN 来说，速度可能会慢，但可以节省更多的内存空间。</p>
                  <h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2>
                  <p>首先我们可以先初始化一些变量，如学习率、节点单元数、RNN 层数等：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">learning_rate</span> = <span class="number">1</span>e-<span class="number">3</span></span><br><span class="line"><span class="attr">num_units</span> = <span class="number">256</span></span><br><span class="line"><span class="attr">num_layer</span> = <span class="number">3</span></span><br><span class="line"><span class="attr">input_size</span> = <span class="number">28</span></span><br><span class="line"><span class="attr">time_step</span> = <span class="number">28</span></span><br><span class="line"><span class="attr">total_steps</span> = <span class="number">2000</span></span><br><span class="line"><span class="attr">category_num</span> = <span class="number">10</span></span><br><span class="line"><span class="attr">steps_per_validate</span> = <span class="number">100</span></span><br><span class="line"><span class="attr">steps_per_test</span> = <span class="number">500</span></span><br><span class="line"><span class="attr">batch_size</span> = tf.placeholder(tf.int32, [])</span><br><span class="line"><span class="attr">keep_prob</span> = tf.placeholder(tf.float32, [])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后还需要声明一下 MNIST 数据生成器：</p>
                  <figure class="highlight clean">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> tensorflow.examples.tutorials.mnist <span class="keyword">import</span> input_data</span><br><span class="line">mnist = input_data.read_data_sets(<span class="string">'MNIST_data/'</span>, one_hot=<span class="literal">True</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来常规声明一下输入的数据，输入数据用 x 表示，标注数据用 y_label 表示：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">x = tf.placeholder(tf.<span class="built_in">float</span>32, [None, <span class="number">784</span>])</span><br><span class="line">y_label = tf.placeholder(tf.<span class="built_in">float</span>32, [None, <span class="number">10</span>])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里输入的 x 维度是 [None, 784]，代表 batch_size 不确定，输入维度 784，y_label 同理。 接下来我们需要对输入的 x 进行 reshape 操作，因为我们需要将一张图分为多个 time_step 来输入，这样才能构建一个 RNN 序列，所以这里直接将 time_step 设成 28，这样一来 input_size 就变为了 28，batch_size 不变，所以reshape 的结果是一个三维的矩阵：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">x_shape</span> = tf.reshape(x, [-<span class="number">1</span>, time_step, input_size])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="RNN-层"><a href="#RNN-层" class="headerlink" title="RNN 层"></a>RNN 层</h2>
                  <p>接下来我们需要构建一个 RNN 模型了，这里我们使用的 RNN Cell 是 LSTMCell，而且要搭建一个三层的 RNN，所以这里还需要用到 MultiRNNCell，它的输入参数是 LSTMCell 的列表。 所以我们可以先声明一个方法用于创建 LSTMCell，方法如下：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">def cell(num_units):</span><br><span class="line">    cell = tf.nn.rnn_cell.<span class="constructor">BasicLSTMCell(<span class="params">num_units</span>=<span class="params">num_units</span>)</span></span><br><span class="line">    return <span class="constructor">DropoutWrapper(<span class="params">cell</span>, <span class="params">output_keep_prob</span>=<span class="params">keep_prob</span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里还加入了 Dropout，来减少训练过程中的过拟合。 接下来我们再利用它来构建多层的 RNN：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">cells = tf.nn.rnn_cell.<span class="constructor">MultiRNNCell([<span class="params">cell</span>(<span class="params">num_units</span>)</span> for _ <span class="keyword">in</span> range(num_layer)])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>注意这里使用了 for 循环，每循环一次新生成一个 LSTMCell，而不是直接使用乘法来扩展列表，因为这样会导致 LSTMCell 是同一个对象，导致构建完 MultiRNNCell 之后出现维度不匹配的问题。 接下来我们需要声明一个初始状态：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">h0 = cells.zero<span class="constructor">_state(<span class="params">batch_size</span>, <span class="params">dtype</span>=<span class="params">tf</span>.<span class="params">float32</span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后接下来调用 dynamic_rnn() 方法即可完成模型的构建了：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">output, hs = tf.nn.dynamic<span class="constructor">_rnn(<span class="params">cells</span>, <span class="params">inputs</span>=<span class="params">x_shape</span>, <span class="params">initial_state</span>=<span class="params">h0</span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里 inputs 的输入就是 x 做了 reshape 之后的结果，初始状态通过 initial_state 传入，其返回结果有两个，一个 output 是所有 time_step 的输出结果，赋值为 output，它是三维的，第一维长度等于 batch_size，第二维长度等于 time_step，第三维长度等于 num_units。另一个 hs 是隐含状态，是元组形式，长度即 RNN 的层数 3，每一个元素都包含了 c 和 h，即 LSTM 的两个隐含状态。 这样的话 output 的最终结果可以取最后一个 time_step 的结果，所以可以使用：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">output</span> = output[:, -<span class="number">1</span>, :]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>或者直接取隐藏状态最后一层的 h 也是相同的：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">h</span> = hs[-<span class="number">1</span>].h</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在此模型中，二者是等价的。但注意如果用于文本处理，可能由于文本长度不一，而 padding，导致二者不同。</p>
                  <h2 id="输出层"><a href="#输出层" class="headerlink" title="输出层"></a>输出层</h2>
                  <p>接下来我们再做一次线性变换和 Softmax 输出结果即可：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"># Output Layer</span><br><span class="line">w = tf.<span class="constructor">Variable(<span class="params">tf</span>.<span class="params">truncated_normal</span>([<span class="params">num_units</span>, <span class="params">category_num</span>], <span class="params">stddev</span>=0.1)</span>, dtype=tf.float32)</span><br><span class="line">b = tf.<span class="constructor">Variable(<span class="params">tf</span>.<span class="params">constant</span>(0.1, <span class="params">shape</span>=[<span class="params">category_num</span>])</span>, dtype=tf.float32)</span><br><span class="line">y = tf.matmul(output, w) + b</span><br><span class="line"># Loss</span><br><span class="line">cross_entropy = tf.nn.softmax<span class="constructor">_cross_entropy_with_logits(<span class="params">labels</span>=<span class="params">y_label</span>, <span class="params">logits</span>=<span class="params">y</span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里的 Loss 直接调用了 softmax_cross_entropy_with_logits 先计算了 Softmax，然后计算了交叉熵。</p>
                  <h2 id="训练和评估"><a href="#训练和评估" class="headerlink" title="训练和评估"></a>训练和评估</h2>
                  <p>最后再定义训练和评估的流程即可，在训练过程中每隔一定的 step 就输出 Train Accuracy 和 Test Accuracy：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># Train</span></span><br><span class="line">train = tf.train.AdamOptimizer(<span class="attribute">learning_rate</span>=learning_rate).minimize(cross_entropy)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Prediction</span></span><br><span class="line">correction_prediction = tf.equal(tf.argmax(y, <span class="attribute">axis</span>=1), tf.argmax(y_label, <span class="attribute">axis</span>=1))</span><br><span class="line">accuracy = tf.reduce_mean(tf.cast(correction_prediction, tf.float32))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Train</span></span><br><span class="line">with tf.Session() as sess:</span><br><span class="line">    sess.<span class="builtin-name">run</span>(tf.global_variables_initializer())</span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">step</span> <span class="keyword">in</span> range(total_steps + 1):</span><br><span class="line">        batch_x, batch_y = mnist.train.next_batch(100)</span><br><span class="line">        sess.<span class="builtin-name">run</span>(train, feed_dict=&#123;x: batch_x, y_label: batch_y, keep_prob: 0.5, batch_size: batch_x.shape[0]&#125;)</span><br><span class="line">        # Train Accuracy</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">step</span> % steps_per_validate == 0:</span><br><span class="line">            <span class="builtin-name">print</span>(<span class="string">'Train'</span>, <span class="keyword">step</span>, sess.<span class="builtin-name">run</span>(accuracy, feed_dict=&#123;x: batch_x, y_label: batch_y, keep_prob: 0.5,</span><br><span class="line">                                                               batch_size: batch_x.shape[0]&#125;))</span><br><span class="line">        # Test Accuracy</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">step</span> % steps_per_test == 0:</span><br><span class="line">            test_x, test_y = mnist.test.images, mnist.test.labels</span><br><span class="line">            <span class="builtin-name">print</span>(<span class="string">'Test'</span>, <span class="keyword">step</span>,</span><br><span class="line">                  sess.<span class="builtin-name">run</span>(accuracy, feed_dict=&#123;x: test_x, y_label: test_y, keep_prob: 1, batch_size: test_x.shape[0]&#125;))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2>
                  <p>直接运行之后，只训练了几轮就可以达到 98% 的准确率：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Train <span class="number">0</span> <span class="number">0.27</span></span><br><span class="line">Test <span class="number">0</span> <span class="number">0.2223</span></span><br><span class="line">Train <span class="number">100</span> <span class="number">0.87</span></span><br><span class="line">Train <span class="number">200</span> <span class="number">0.91</span></span><br><span class="line">Train <span class="number">300</span> <span class="number">0.94</span></span><br><span class="line">Train <span class="number">400</span> <span class="number">0.94</span></span><br><span class="line">Train <span class="number">500</span> <span class="number">0.99</span></span><br><span class="line">Test <span class="number">500</span> <span class="number">0.9595</span></span><br><span class="line">Train <span class="number">600</span> <span class="number">0.95</span></span><br><span class="line">Train <span class="number">700</span> <span class="number">0.97</span></span><br><span class="line">Train <span class="number">800</span> <span class="number">0.98</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看出来 LSTM 在做 MNIST 字符分类的任务上还是比较有效的。</p>
                  <h2 id="本节代码"><a href="#本节代码" class="headerlink" title="本节代码"></a>本节代码</h2>
                  <p>本节代码地址为：<a href="https://github.com/AIDeepLearning/LSTMClassification" target="_blank" rel="noopener">https://github.com/AIDeepLearning/LSTMClassification</a>。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2018-01-03 19:18:03" itemprop="dateCreated datePublished" datetime="2018-01-03T19:18:03+08:00">2018-01-03</time>
                </span>
                <span id="/4934.html" class="post-meta-item leancloud_visitors" data-flag-title="TensorFlow LSTM MNIST分类" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>3.5k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/4925.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/4925.html" class="post-title-link" itemprop="url">TensorFlow RNN Cell源码解析</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p> 本文介绍下 RNN 及几种变种的结构和对应的 TensorFlow 源码实现，另外通过简单的实例来实现 TensorFlow RNN 相关类的调用。</p>
                  <h2 id="RNN"><a href="#RNN" class="headerlink" title="RNN"></a>RNN</h2>
                  <p>RNN，循环神经网络，Recurrent Neural Networks。人们思考问题往往不是从零开始的，比如阅读时我们对每个词的理解都会依赖于前面看到的一些信息，而不是把前面看的内容全部抛弃再去理解某处的信息。应用到深度学习上面，如果我们想要学习去理解一些依赖上文的信息，RNN 便可以做到，它有一个循环的操作，可以使其可以保留之前学习到的内容。 RNN 的结构如下： <img src="https://germey.gitbooks.io/ai/content/assets/2017-12-27-22-35-41.jpg" alt=""> 在上图网络结构中，对于矩形块 A 的那部分，通过输入xt（t时刻的特征向量），它会输出一个结果ht（t时刻的状态或者输出）。网络中的循环结构使得某个时刻的状态能够传到下一个时刻。 这些循环的结构让 RNNs 看起来有些难以理解，但我们可以把 RNNs 看成是一个普通的网络做了多次复制后叠加在一起组成的，每一网络会把它的输出传递到下一个网络中。我们可以把 RNNs 在时间步上进行展开，就得到下图这样： <img src="https://germey.gitbooks.io/ai/content/assets/2017-12-27-22-37-24.jpg" alt=""> 所以最基本的 RNN Cell 输入就是 xt，它还会输出一个隐含内容传递到下一个 Cell，同时还会生成一个结果 ht，其最基本的结构如如下： <img src="https://germey.gitbooks.io/ai/content/assets/2017-12-27-23-59-19.jpg" alt=""> 仅仅是输入的 xt 和隐藏状态进行 concat，然后经过线性变换后经过一个 tanh 激活函数便输出了，另外隐含内容和输出结果是相同的内容。 我们来分析一下 TensorFlow 里面 RNN Cell 的实现。 TensorFlow 实现 RNN Cell 的位置在 python/ops/rnn<em>cell<em>impl.py，首先其实现了一个 RNNCell 类，继承了 Layer 类，其内部有三个比较重要的方法，state_size()、output_size()、__call</em></em>() 方法，其中 state_size() 和 output_size() 方法设置为类属性，可以当做属性来调用，实现如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">@property</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">state_size</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="string">"""size(s) of state(s) used by this cell.</span></span><br><span class="line"><span class="string">It can be represented by an Integer, a TensorShape or a tuple of Integers</span></span><br><span class="line"><span class="string">or TensorShapes.</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">    <span class="keyword">raise</span> NotImplementedError(<span class="string">"Abstract method"</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@property</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">output_size</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="string">"""Integer or TensorShape: size of outputs produced by this cell."""</span></span><br><span class="line">    <span class="keyword">raise</span> NotImplementedError(<span class="string">"Abstract method"</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>分别代表 Cell 的状态和输出维度，和 Cell 中的神经元数量有关，但这里两个方法都没有实现，意思是说我们必须要实现一个子类继承 RNNCell 类并实现这两个方法。 另外对于 <strong>call</strong>() 方法，实际上就是当初始化的对象直接被调用的时候触发的方法，实现如下：</p>
                  <figure class="highlight pf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">def __call__(<span class="literal">self</span>, inputs, <span class="keyword">state</span>, scope=None):</span><br><span class="line">    if scope is not None:</span><br><span class="line">        with vs.variable_scope(scope,</span><br><span class="line">                               custom_getter=<span class="literal">self</span>._rnn_get_variable) as scope:</span><br><span class="line">            return super(RNNCell, <span class="literal">self</span>).__call__(inputs, <span class="keyword">state</span>, scope=scope)</span><br><span class="line">    else:</span><br><span class="line">        with vs.variable_scope(vs.get_variable_scope(),</span><br><span class="line">                               custom_getter=<span class="literal">self</span>._rnn_get_variable):</span><br><span class="line">            return super(RNNCell, <span class="literal">self</span>).__call__(inputs, <span class="keyword">state</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>实际上是调用了父类 Layer 的 <strong>call</strong>() 方法，但父类中 <strong>call</strong>() 方法中又调用了 call() 方法，而 Layer 类的 call() 方法的实现如下：</p>
                  <figure class="highlight ruby">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">call</span><span class="params">(<span class="keyword">self</span>, inputs, **kwargs)</span></span><span class="symbol">:</span></span><br><span class="line">    <span class="keyword">return</span> inputs</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>父类的 call() 方法实现非常简单，所以要实现其真正的功能，只需要在继承 RNNCell 类的子类中实现 call() 方法即可。 接下来我们看下 RNN Cell 的最基本的实现，叫做 BasicRNNCell，其代码如下：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasicRNNCell</span><span class="params">(RNNCell)</span>:</span></span><br><span class="line">  <span class="string">"""The most basic RNN cell.</span></span><br><span class="line"><span class="string">  Args:</span></span><br><span class="line"><span class="string">    num_units: int, The number of units in the RNN cell.</span></span><br><span class="line"><span class="string">    activation: Nonlinearity to use.  Default: `tanh`.</span></span><br><span class="line"><span class="string">    reuse: (optional) Python boolean describing whether to reuse variables</span></span><br><span class="line"><span class="string">     in an existing scope.  If not `True`, and the existing scope already has</span></span><br><span class="line"><span class="string">     the given variables, an error is raised.</span></span><br><span class="line"><span class="string">  """</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, num_units, activation=None, reuse=None)</span>:</span></span><br><span class="line">    super(BasicRNNCell, self).__init__(_reuse=reuse)</span><br><span class="line">    self._num_units = num_units</span><br><span class="line">    self._activation = activation <span class="keyword">or</span> math_ops.tanh</span><br><span class="line">    self._linear = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="meta">  @property</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">state_size</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> self._num_units</span><br><span class="line"></span><br><span class="line"><span class="meta">  @property</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">output_size</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> self._num_units</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">call</span><span class="params">(self, inputs, state)</span>:</span></span><br><span class="line">    <span class="string">"""Most basic RNN: output = new_state = act(W * input + U * state + B)."""</span></span><br><span class="line">    <span class="keyword">if</span> self._linear <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">      self._linear = _Linear([inputs, state], self._num_units, <span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    output = self._activation(self._linear([inputs, state]))</span><br><span class="line">    <span class="keyword">return</span> output, output</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到在初始化的时候，最终要的一个参数是 num<em>units，意思就是这个 Cell 中神经元的个数，另外还有一个参数 activation 即默认使用的激活函数，默认使用的 tanh，reuse 代表该 Cell 是否可以被重新使用。 在 state<em>size()、output_size() 方法里，其返回的内容都是 num_units，即神经元的个数，接下来 call() 方法中，传入的参数为 inputs 和 state，即输入的 x 和 上一次的隐含状态，首先实例化了一个 _Linear 类，这个类实际上就是做线性变换的类，将二者传递过来，然后直接调用，就实现了 w * [inputs, state] + b 的线性变换，其中 _Linear 类的 __call</em></em>() 方法实现如下：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">def __call__(self, <span class="keyword">args</span>):</span><br><span class="line">    <span class="keyword">if</span> not self._is_sequence:</span><br><span class="line">        <span class="keyword">args</span> = [<span class="keyword">args</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(<span class="keyword">args</span>) == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">res</span> = math_ops.matmul(<span class="keyword">args</span>[<span class="number">0</span>], self._weights)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">res</span> = math_ops.matmul(array_ops.concat(<span class="keyword">args</span>, <span class="number">1</span>), self._weights)</span><br><span class="line">    <span class="keyword">if</span> self._build_bia<span class="variable">s:</span></span><br><span class="line">        <span class="keyword">res</span> = nn_ops.bias_add(<span class="keyword">res</span>, self._biases)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">res</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>很明显这里传递了 [inputs, state] 作为 <strong>call</strong>() 方法的 args，会执行 concat() 和 matmul() 方法，然后接着再执行 bias_add() 方法，这样就实现了线性变换。 最后回到 BasicRNNCell 的 call() 方法中，在 _linear() 方法外面又包括了一层 _activation() 方法，即对线性变换应用一次 tanh 激活函数处理，作为输出结果。 最后返回的结果是 output 和 output，第一个代表 output，第二个代表隐状态，其值也等于 output。 我们用一个实例来感受一下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import tensorflow as tf</span><br><span class="line"></span><br><span class="line">cell = tf<span class="selector-class">.nn</span><span class="selector-class">.rnn_cell</span>.BasicRNNCell(num_units=<span class="number">128</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(cell.state_size)</span></span></span><br><span class="line">inputs = tf.placeholder(tf<span class="selector-class">.float32</span>, shape=[<span class="number">32</span>, <span class="number">100</span>])</span><br><span class="line">h0 = cell.zero_state(<span class="number">32</span>, tf.float32)</span><br><span class="line">output, <span class="selector-tag">h1</span> = cell(inputs=inputs, state=h0)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(output, output.shape)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(h1, h1.shape)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们首先初始化了一个神经元个数为 128 的 BasicRNNCell 类，然后构造了一个 shape 为 [32, 100] 的变量作为 inputs，其代表 batch_size 为 32, 维度为 100，随后初始化了初始隐藏状态，调用了 zero_state() 方法，然后直接调用 cell，实际上是最终调用了其 call() 方法，最后得到 output 和 h1，打印输出结果：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">128</span></span><br><span class="line">Tensor(<span class="string">"basic_rnn_cell/Tanh:0"</span>, shape=(<span class="number">32</span>, <span class="number">128</span>), dtype=<span class="built_in">float</span>32) (<span class="number">32</span>, <span class="number">128</span>)</span><br><span class="line">Tensor(<span class="string">"basic_rnn_cell/Tanh:0"</span>, shape=(<span class="number">32</span>, <span class="number">128</span>), dtype=<span class="built_in">float</span>32) (<span class="number">32</span>, <span class="number">128</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，当输入变量维度为 100 的时候，经过一个 128 神经元 Cell 之后，输出维度变成了 128，其输出 shape 变成了 [32, 128]，且此时输出结果和隐藏状态是相同的。</p>
                  <h2 id="LSTM"><a href="#LSTM" class="headerlink" title="LSTM"></a>LSTM</h2>
                  <p>RNNs 的出现，主要是因为它们能够把以前的信息联系到现在，从而解决现在的问题。比如，利用前面的信息，能够帮助我们理解当前的内容。 有时候，我们在处理当前任务的时候，只需要看一下比较近的一些信息。比如在一个语言模型中，我们要通过上文来预测一下个词可能是什么，那么当我们看到 “the clouds are in the?”时，不需要更多的信息，我们就能够自然而然的想到下一个词应该是“sky”。在这样的情况下，我们所要预测的内容和相关信息之间的间隔很小，这种情况下 RNNs 就能够利用过去的信息， 很容易实现： <img src="https://germey.gitbooks.io/ai/content/assets/2017-12-27-23-55-28.jpg" alt=""> 但是如果我们想依赖前文距离非常远的信息时，普通的 RNN 就非常难以做到了，随着间隔信息的增大，RNN 难以对其做关联： <img src="https://germey.gitbooks.io/ai/content/assets/2017-12-27-23-57-15.jpg" alt=""> 但是 LSTM 可以用来解决这个问题。 LSTM，Long Short Term Memory Networks，是 RNN 的一个变种，经试验它可以用来解决更多问题，并取得了非常好的效果。 LSTM Cell 的结构如下： <img src="https://germey.gitbooks.io/ai/content/assets/2017-12-28-00-01-01.jpg" alt=""> LSTMs 最关键的地方在于 Cell 的状态 和 结构图上面的那条横穿的水平线。 Cell 状态的传输就像一条传送带，向量从整个 Cell 中穿过，只是做了少量的线性操作。这种结构能够很轻松地实现信息从整个 Cell 中穿过而不做改变。 <img src="https://germey.gitbooks.io/ai/content/assets/2017-12-28-00-02-30.jpg" alt=""> 若只有上面的那条水平线是没办法实现添加或者删除信息的，信息的操作是是通过一种叫做门的结构来实现的。 这里我们可以把门分为三个：遗忘门（Forget Gate）、传入门（Input Gate）、输出门（Output Gate）。</p>
                  <h3 id="遗忘门（Forget-Gate）"><a href="#遗忘门（Forget-Gate）" class="headerlink" title="遗忘门（Forget Gate）"></a>遗忘门（Forget Gate）</h3>
                  <p>首先是 LSTM 要决定让那些信息继续通过这个 Cell，这是通过 Forget Gate 的 sigmoid 神经层来实现的。它的输入是ht−1和xt，输出是一个数值都在 0，1 之间的向量，表示让 Ct−1 的各部分信息通过的比重。 0 表示“不让任何信息通过”， 1 表示“让所有信息通过”。 <img src="https://germey.gitbooks.io/ai/content/assets/2017-12-28-00-07-04.jpg" alt=""></p>
                  <h3 id="传入门（Input-Gate）"><a href="#传入门（Input-Gate）" class="headerlink" title="传入门（Input Gate）"></a>传入门（Input Gate）</h3>
                  <p>下一步是决定让多少新的信息加入到 Cell 中来，一个叫做 Input Gate 的 sigmoid 层决定哪些信息需要更新，一个 New Input 通过 tanh 生成一个向量，也就是备选的用来更新的内容，Ct~ 。在下一步，我们把这两部分联合起来，对 Cell 的状态进行一个更新。 <img src="https://germey.gitbooks.io/ai/content/assets/2017-12-28-00-10-02.jpg" alt=""> 在经过 Forget Gate 和 Input Gate 处理后，我们就可以对输入的 Ct-1 做更新了，即把Ct−1 更新为 Ct，首先我们把旧的状态 Ct−1 和 ft 相乘， 把一些不想保留的信息忘掉。然后加上 it∗Ct~，这部分信息就是我们要添加的新内容，这样就可以完成对 Ct-1 的更新。 <img src="https://germey.gitbooks.io/ai/content/assets/2017-12-28-00-13-18.jpg" alt=""></p>
                  <h3 id="输出门-（Output-Gate）"><a href="#输出门-（Output-Gate）" class="headerlink" title="输出门 （Output Gate）"></a>输出门 （Output Gate）</h3>
                  <p>最后我们需要来决定输出什么值，输出主要是依赖于 Cell 的状态 Ct，但是又不仅仅依赖于 Ct，而是需要经过一个过滤的处理。首先，我们还是使用一个 sigmoid 层来决定 Ct 中的哪部分信息会被输出。然后我们把 Ct 通过一个 tanh 激活函数处理，然后把其输出和 sigmoid 计算出来的权重相乘，这样就得到了最后输出的结果。 <img src="https://germey.gitbooks.io/ai/content/assets/2017-12-28-00-15-34.jpg" alt=""> 到了最后，其输出结果有三个内容，其中输出结果就是最上面的箭头代指的内容，即最终计算的结果，隐层包括两部分内容，一个是 Ct，一个是最下方的 ht，我们可以将其合并为一个变量来表示。 接下来我们来看下 LSTMCell 的 TensorFlow 代码实现。 首先它的类是 BasicLSTMCell 类，继承了 RNNCell 类，其初始化方法 init() 实现如下：</p>
                  <figure class="highlight ruby">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>, num_units, forget_bias=<span class="number">1.0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">               state_is_tuple=True, activation=None, reuse=None)</span></span><span class="symbol">:</span></span><br><span class="line">    <span class="keyword">super</span>(BasicLSTMCell, <span class="keyword">self</span>).__init_<span class="number">_</span>(_reuse=reuse)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="symbol">state_is_tuple:</span></span><br><span class="line">      logging.warn(<span class="string">"%s: Using a concatenated state is slower and will soon be "</span></span><br><span class="line">                   <span class="string">"deprecated.  Use state_is_tuple=True."</span>, <span class="keyword">self</span>)</span><br><span class="line">    <span class="keyword">self</span>._num_units = num_units</span><br><span class="line">    <span class="keyword">self</span>._forget_bias = forget_bias</span><br><span class="line">    <span class="keyword">self</span>._state_is_tuple = state_is_tuple</span><br><span class="line">    <span class="keyword">self</span>._activation = activation <span class="keyword">or</span> math_ops.tanh</span><br><span class="line">    <span class="keyword">self</span>._linear = None</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里必须传入的参数仍然是 num_units，即神经元的个数，然后 forget_bias 是初始化 Forget Gate 的偏置大小，state_is_tuple 指的是输出状态类型是元组类型，activation 代表默认激活函数，reuse 代表是否可以被重复使用。 接下来看下 state_size() 方法和 output_size() 方法，实现如下：</p>
                  <figure class="highlight ruby">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">@property</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">state_size</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">    <span class="keyword">return</span> (LSTMStateTuple(<span class="keyword">self</span>._num_units, <span class="keyword">self</span>._num_units)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">self</span>._state_is_tuple <span class="keyword">else</span> <span class="number">2</span> * <span class="keyword">self</span>._num_units)</span><br><span class="line"></span><br><span class="line">@property</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">output_size</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>._num_units</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里 state_size() 方法变了，因为输出的 state 需要将 Ct 和隐含状态合并，所以它需要包含两部分的内容，如果传入的参数 state_is_tuple 为 True 的话，状态会被表示成一个元组，否则会是 num_units 乘以 2 的数字，默认是元组形式。output_size() 方法则保持不变。 对于 call() 方法，其实现如下：</p>
                  <figure class="highlight nix">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">def call(self, inputs, state):</span><br><span class="line">    <span class="string">""</span><span class="string">"Long short-term memory cell (LSTM).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">      inputs: `2-D` tensor with shape `[batch_size x input_size]`.</span></span><br><span class="line"><span class="string">      state: An `LSTMStateTuple` of state tensors, each shaped</span></span><br><span class="line"><span class="string">        `[batch_size x self.state_size]`, if `state_is_tuple` has been set to</span></span><br><span class="line"><span class="string">        `True`.  Otherwise, a `Tensor` shaped</span></span><br><span class="line"><span class="string">        `[batch_size x 2 * self.state_size]`.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">      A pair containing the new hidden state, and the new state (either a</span></span><br><span class="line"><span class="string">        `LSTMStateTuple` or a concatenated state, depending on</span></span><br><span class="line"><span class="string">        `state_is_tuple`).</span></span><br><span class="line"><span class="string">    "</span><span class="string">""</span></span><br><span class="line">    <span class="attr">sigmoid</span> = math_ops.sigmoid</span><br><span class="line">    <span class="comment"># Parameters of gates are concatenated into one multiply for efficiency.</span></span><br><span class="line">    <span class="keyword">if</span> self._state_is_tuple:</span><br><span class="line">        c, <span class="attr">h</span> = state</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        c, <span class="attr">h</span> = array_ops.split(<span class="attr">value=state,</span> <span class="attr">num_or_size_splits=2,</span> <span class="attr">axis=1)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> self._linear is None:</span><br><span class="line">        self.<span class="attr">_linear</span> = _Linear([inputs, h], <span class="number">4</span> * self._num_units, True)</span><br><span class="line">    <span class="comment"># i = input_gate, j = new_input, f = forget_gate, o = output_gate</span></span><br><span class="line">    i, j, f, <span class="attr">o</span> = array_ops.split(</span><br><span class="line">        <span class="attr">value=self._linear([inputs,</span> h]), <span class="attr">num_or_size_splits=4,</span> <span class="attr">axis=1)</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">new_c</span> = (</span><br><span class="line">        c * sigmoid(f + self._forget_bias) + sigmoid(i) * self._activation(j))</span><br><span class="line">    <span class="attr">new_h</span> = self._activation(new_c) * sigmoid(o)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> self._state_is_tuple:</span><br><span class="line">        <span class="attr">new_state</span> = LSTMStateTuple(new_c, new_h)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="attr">new_state</span> = array_ops.concat([new_c, new_h], <span class="number">1</span>)</span><br><span class="line">    return new_h, new_state</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>首先为了获取 c, h，需要将其从 state 中分离开来，如果传入的 state 是元组的话可以直接分解，否则需要调用 split() 方法来分解：</p>
                  <figure class="highlight pf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">if <span class="literal">self</span>._state_is_tuple:</span><br><span class="line">    c, h = <span class="keyword">state</span></span><br><span class="line">else:</span><br><span class="line">    c, h = array_ops.split(value=<span class="keyword">state</span>, num_or_size_splits=<span class="number">2</span>, axis=<span class="number">1</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来定义了几个门的实现：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">i, j, f, o = array_ops.split(<span class="attribute">value</span>=self._linear([inputs, h]), <span class="attribute">num_or_size_splits</span>=4, <span class="attribute">axis</span>=1)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>放到一起来用 Linear 计算然后分成了 4 份，分别代表 Input Gate、New Input、Forget Gate、Output Gate，用 i、j、f、o 来表示，这时候四个变量都经过了线性变换，乘以权重并做了偏置操作。 接下来就是更新 Ct-1 为 Ct 和得到隐含状态输出了，都是遵循 LSTM 内部的公式实现：</p>
                  <figure class="highlight haxe">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">new</span><span class="type">_c</span> = (c * sigmoid(f + self._forget_bias) + sigmoid(i) * self._activation(j))</span><br><span class="line"><span class="keyword">new</span><span class="type">_h</span> = self._activation(<span class="keyword">new</span><span class="type">_c</span>) * sigmoid(o)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里值得注意的是还多加了一个 _forget_bias 变量，即设置了初始化偏置，以免初始输出为 0 的问题。 最后将 new_c 和 new_h 进行合并，如果要输出元组，那么就合并为元组，否则二者进行 concat 操作，返回的结果是 new_h、new_state，前者即 Cell 的输出结果，后者代表隐含状态：</p>
                  <figure class="highlight haxe">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">if</span> self._state_is_tuple:<span class="type"></span></span><br><span class="line"><span class="type">    new_state </span>= LSTMStateTuple(<span class="keyword">new</span><span class="type">_c</span>, <span class="keyword">new</span><span class="type">_h</span>)</span><br><span class="line"><span class="keyword">else</span>:<span class="type"></span></span><br><span class="line"><span class="type">    new_state </span>= array_ops.concat([<span class="keyword">new</span><span class="type">_c</span>, <span class="keyword">new</span><span class="type">_h</span>], <span class="number">1</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span><span class="type">_h</span>, <span class="keyword">new</span><span class="type">_state</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们再用一个实例来感受一下 BasicLSTMCell 的用法：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import tensorflow as tf</span><br><span class="line"></span><br><span class="line">cell = tf<span class="selector-class">.nn</span><span class="selector-class">.rnn_cell</span>.BasicLSTMCell(num_units=<span class="number">128</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(cell.state_size)</span></span></span><br><span class="line">inputs = tf.placeholder(tf<span class="selector-class">.float32</span>, shape=(<span class="number">32</span>, <span class="number">100</span>))</span><br><span class="line">h0 = cell.zero_state(<span class="number">32</span>, tf.float32)</span><br><span class="line">output, <span class="selector-tag">h1</span> = cell(inputs=inputs, state=h0)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(h1)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(h1.h, h1.h.shape)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(h1.c, h1.c.shape)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(output, output.shape)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们首先初始化了一个神经元个数为 128 的 BasicRNNCell 类，然后构造了一个 shape 为 [32, 100] 的变量作为 inputs，其代表 batch_size 为 32, 维度为 100，随后初始化了初始隐藏状态，调用了 zero_state() 方法，然后直接调用 cell，实际上是最终调用了其 call() 方法，最后得到 output 和 h1，此时 h1 是一个元组，它还可以分离成 h 和 c，分别打印其对象和维度，结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">LSTMStateTuple(c=<span class="number">128</span>, h=<span class="number">128</span>)</span><br><span class="line">LSTMStateTuple(c=&lt;tf.Tensor <span class="string">'add_1:0'</span> shape=(<span class="number">32</span>, <span class="number">128</span>) dtype=<span class="built_in">float</span>32&gt;, h=&lt;tf.Tensor <span class="string">'mul_2:0'</span> shape=(<span class="number">32</span>, <span class="number">128</span>) dtype=<span class="built_in">float</span>32&gt;)</span><br><span class="line">Tensor(<span class="string">"mul_2:0"</span>, shape=(<span class="number">32</span>, <span class="number">128</span>), dtype=<span class="built_in">float</span>32) (<span class="number">32</span>, <span class="number">128</span>)</span><br><span class="line">Tensor(<span class="string">"add_1:0"</span>, shape=(<span class="number">32</span>, <span class="number">128</span>), dtype=<span class="built_in">float</span>32) (<span class="number">32</span>, <span class="number">128</span>)</span><br><span class="line">Tensor(<span class="string">"mul_2:0"</span>, shape=(<span class="number">32</span>, <span class="number">128</span>), dtype=<span class="built_in">float</span>32) (<span class="number">32</span>, <span class="number">128</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到其维度都是 [32, 128]，而且 h1.h 和 output 是相同的。 另外 LSTM 有许多变种，其中一个比较有名的就是 Gers &amp; Schmidhuber (2000) 提出的，它在原来的基础上行添加了 Peephole Connections，使得遗忘门可以受 Ct-1 的影响。 <img src="https://germey.gitbooks.io/ai/content/assets/2017-12-28-00-51-47.jpg" alt=""> 另外还有一个变种就是将 Forget Gate 和 Input Gate 二者联合起来，做到要么遗忘老的输入新的，要么保留老的不输入新的。 <img src="https://germey.gitbooks.io/ai/content/assets/2017-12-28-00-54-07.jpg" alt=""> 但接下来还有一个更常用的变种，俺就是 GRU，它是由 Cho, et al. (2014) 提出的，在提出的同时他还提出了 Seq2Seq 模型，为 Generation Model 做好了铺垫。</p>
                  <h3 id="GRU"><a href="#GRU" class="headerlink" title="GRU"></a>GRU</h3>
                  <p>GRU，Gated Recurrent Unit，在 GRU 中，只有两个门：重置门（Reset Gate）和更新门（Update Gate）。同时在这个结构中，把 Ct 和隐藏状态进行了合并，整体结构比标准的 LSTM 结构要简单，而且这个结构后来也非常流行。 <img src="https://germey.gitbooks.io/ai/content/assets/2017-12-28-00-57-08.jpg" alt=""> 接下来我们看下 TensorFlow 中 GRUCell 的实现，代码如下：</p>
                  <figure class="highlight ruby">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GRUCell</span>(<span class="title">RNNCell</span>):</span></span><br><span class="line">  <span class="string">""</span><span class="string">"Gated Recurrent Unit cell (cf. http://arxiv.org/abs/1406.1078).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Args:</span></span><br><span class="line"><span class="string">    num_units: int, The number of units in the GRU cell.</span></span><br><span class="line"><span class="string">    activation: Nonlinearity to use.  Default: `tanh`.</span></span><br><span class="line"><span class="string">    reuse: (optional) Python boolean describing whether to reuse variables</span></span><br><span class="line"><span class="string">     in an existing scope.  If not `True`, and the existing scope already has</span></span><br><span class="line"><span class="string">     the given variables, an error is raised.</span></span><br><span class="line"><span class="string">    kernel_initializer: (optional) The initializer to use for the weight and</span></span><br><span class="line"><span class="string">    projection matrices.</span></span><br><span class="line"><span class="string">    bias_initializer: (optional) The initializer to use for the bias.</span></span><br><span class="line"><span class="string">  "</span><span class="string">""</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">               num_units,</span></span></span><br><span class="line"><span class="function"><span class="params">               activation=None,</span></span></span><br><span class="line"><span class="function"><span class="params">               reuse=None,</span></span></span><br><span class="line"><span class="function"><span class="params">               kernel_initializer=None,</span></span></span><br><span class="line"><span class="function"><span class="params">               bias_initializer=None)</span></span><span class="symbol">:</span></span><br><span class="line">    <span class="keyword">super</span>(GRUCell, <span class="keyword">self</span>).__init_<span class="number">_</span>(_reuse=reuse)</span><br><span class="line">    <span class="keyword">self</span>._num_units = num_units</span><br><span class="line">    <span class="keyword">self</span>._activation = activation <span class="keyword">or</span> math_ops.tanh</span><br><span class="line">    <span class="keyword">self</span>._kernel_initializer = kernel_initializer</span><br><span class="line">    <span class="keyword">self</span>._bias_initializer = bias_initializer</span><br><span class="line">    <span class="keyword">self</span>._gate_linear = None</span><br><span class="line">    <span class="keyword">self</span>._candidate_linear = None</span><br><span class="line"></span><br><span class="line">  @property</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">state_size</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>._num_units</span><br><span class="line"></span><br><span class="line">  @property</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">output_size</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>._num_units</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">call</span><span class="params">(<span class="keyword">self</span>, inputs, state)</span></span><span class="symbol">:</span></span><br><span class="line">    <span class="string">""</span><span class="string">"Gated recurrent unit (GRU) with nunits cells."</span><span class="string">""</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">self</span>._gate_linear is <span class="symbol">None:</span></span><br><span class="line">      bias_ones = <span class="keyword">self</span>._bias_initializer</span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">self</span>._bias_initializer is <span class="symbol">None:</span></span><br><span class="line">        bias_ones = init_ops.constant_initializer(<span class="number">1.0</span>, dtype=inputs.dtype)</span><br><span class="line">      with vs.variable_scope(<span class="string">"gates"</span>):  <span class="comment"># Reset gate and update gate.</span></span><br><span class="line">        <span class="keyword">self</span>._gate_linear = _Linear(</span><br><span class="line">            [inputs, state],</span><br><span class="line">            <span class="number">2</span> * <span class="keyword">self</span>._num_units,</span><br><span class="line">            True,</span><br><span class="line">            bias_initializer=bias_ones,</span><br><span class="line">            kernel_initializer=<span class="keyword">self</span>._kernel_initializer)</span><br><span class="line"></span><br><span class="line">    value = math_ops.sigmoid(<span class="keyword">self</span>._gate_linear([inputs, state]))</span><br><span class="line">    r, u = array_ops.split(value=value, num_or_size_splits=<span class="number">2</span>, axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    r_state = r * state</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">self</span>._candidate_linear is <span class="symbol">None:</span></span><br><span class="line">      with vs.variable_scope(<span class="string">"candidate"</span>)<span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>._candidate_linear = _Linear(</span><br><span class="line">            [inputs, r_state],</span><br><span class="line">            <span class="keyword">self</span>._num_units,</span><br><span class="line">            True,</span><br><span class="line">            bias_initializer=<span class="keyword">self</span>._bias_initializer,</span><br><span class="line">            kernel_initializer=<span class="keyword">self</span>._kernel_initializer)</span><br><span class="line">    c = <span class="keyword">self</span>._activation(<span class="keyword">self</span>._candidate_linear([inputs, r_state]))</span><br><span class="line">    new_h = u * state + (<span class="number">1</span> - u) * c</span><br><span class="line">    <span class="keyword">return</span> new_h, new_h</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在 state_size()、output_size() 方法里，其返回的内容都是 num_units，即神经元的个数。 接下来 call() 方法中，因为 Reset Gate rt 和 Update Gate zt 分别用变量 r、u 表示，它们需要先对 ht-1 即 state 和 xt 做合并，然后再实现线性变换，再调用 sigmod 函数得到：</p>
                  <figure class="highlight pf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">value = math_ops.sigmoid(<span class="literal">self</span>._gate_linear([inputs, <span class="keyword">state</span>]))</span><br><span class="line">r, u = array_ops.split(value=value, num_or_size_splits=<span class="number">2</span>, axis=<span class="number">1</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后需要求解 ht~，首先用 rt 和 ht-1 即 state 相乘：</p>
                  <figure class="highlight pf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">r_state = r * <span class="keyword">state</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后将其放到线性函数里面，在调用 tanh 激活函数即可：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">c = self.<span class="constructor">_activation(<span class="params">self</span>.<span class="params">_candidate_linear</span>([<span class="params">inputs</span>, <span class="params">r_state</span>])</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>最后计算隐含状态和输出结果，二者一致：</p>
                  <figure class="highlight haxe">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">new</span><span class="type">_h</span> = u * state + (<span class="number">1</span> - u) * c</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span><span class="type">_h</span>, <span class="keyword">new</span><span class="type">_h</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样即可返回得到输出结果和隐藏状态。 我们用一个实例感受一下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import tensorflow as tf</span><br><span class="line"></span><br><span class="line">cell = tf<span class="selector-class">.nn</span><span class="selector-class">.rnn_cell</span>.GRUCell(num_units=<span class="number">128</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(cell.state_size)</span></span></span><br><span class="line">inputs = tf.placeholder(tf<span class="selector-class">.float32</span>, shape=[<span class="number">32</span>, <span class="number">100</span>])</span><br><span class="line">h0 = cell.zero_state(<span class="number">32</span>, tf.float32)</span><br><span class="line">output, <span class="selector-tag">h1</span> = cell(inputs=inputs, state=h0)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(output, output.shape)</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(h1, h1.shape)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">128</span></span><br><span class="line">Tensor(<span class="string">"gru_cell/add:0"</span>, shape=(<span class="number">32</span>, <span class="number">128</span>), dtype=<span class="built_in">float</span>32) (<span class="number">32</span>, <span class="number">128</span>)</span><br><span class="line">Tensor(<span class="string">"gru_cell/add:0"</span>, shape=(<span class="number">32</span>, <span class="number">128</span>), dtype=<span class="built_in">float</span>32) (<span class="number">32</span>, <span class="number">128</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这个结果和 BasicRNNCell 并无二致，但 GRUCell 内部的结构使模型的效果更加优化，一般我们也会选取 GRUCell 来代替原生的 BasicRNNCell。</p>
                  <h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2>
                  <p>以上便是对 RNN 及一些变种的说明及代码原理分析和实例用法，此部分掌握之后对 Dynamic RNN、多层 RNN 及 RNN Cell 的改写会有很大帮助，需要好好掌握。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2017-12-28 01:54:02" itemprop="dateCreated datePublished" datetime="2017-12-28T01:54:02+08:00">2017-12-28</time>
                </span>
                <span id="/4925.html" class="post-meta-item leancloud_visitors" data-flag-title="TensorFlow RNN Cell源码解析" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>13k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>12 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/4921.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/4921.html" class="post-title-link" itemprop="url">TensorFlow MNIST高级学习</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>上一节使用了最简单的网络来处理了 MNIST 数据集，但只有 92% 的正确率，接下来我们使用卷积神经网络来实现更高的正确率。</p>
                  <h2 id="权重初始化"><a href="#权重初始化" class="headerlink" title="权重初始化"></a>权重初始化</h2>
                  <p>在上一节初始化 w 和 b 的时候，我们使用了置零初始化。但在卷积神经网络中，我们需要在初始化的时候权重加入少量噪声来打破对称性和避免零梯度，偏置项直接使用一个较小的正数来避免节点输出恒为零的问题。 所以权重我们可以使用截尾正态分布函数 truncated_normal() 来生成初始化张量，我们可以给它指定均值或标准差，均值默认是 0， 标准差默认是 1，例如我们生成一个 [10] 的张量，代码如下：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import tensorflow <span class="keyword">as</span> <span class="keyword">tf</span></span><br><span class="line">initial = <span class="keyword">tf</span>.truncated_normal([<span class="number">10</span>], stddev=<span class="number">0.1</span>)</span><br><span class="line">with <span class="keyword">tf</span>.Session() <span class="keyword">as</span> ses<span class="variable">s:</span></span><br><span class="line">    <span class="keyword">print</span>(sess.run(initial))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[<span class="number">-0.13058113</span>  <span class="number">0.03201858</span> <span class="number">-0.19349943</span> <span class="number">-0.06061752</span> <span class="number">-0.10267895</span> <span class="number">-0.11079147</span></span><br><span class="line">  <span class="number">0.1881365</span>  <span class="number">-0.01057311</span> <span class="number">-0.02797078</span>  <span class="number">0.01180232</span>]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外 constant() 方法是用于生成常量的方法，例如生成一个 [10] 的常量张量，代码如下：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import tensorflow <span class="keyword">as</span> <span class="keyword">tf</span></span><br><span class="line">initial = <span class="keyword">tf</span>.constant(<span class="number">0.2</span>, shape=[<span class="number">10</span>])</span><br><span class="line">with <span class="keyword">tf</span>.Session() <span class="keyword">as</span> ses<span class="variable">s:</span></span><br><span class="line">    <span class="keyword">print</span>(sess.run(initial))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[ <span class="number">0.2</span>  <span class="number">0.2</span>  <span class="number">0.2</span>  <span class="number">0.2</span>  <span class="number">0.2</span>  <span class="number">0.2</span>  <span class="number">0.2</span>  <span class="number">0.2</span>  <span class="number">0.2</span>  <span class="number">0.2</span>]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>所以这里我们可以将这两个方法封装成一个函数来尝试：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">def weight(shape, <span class="attribute">stddev</span>=0.1, <span class="attribute">mean</span>=0):</span><br><span class="line">    initial = tf.truncated_normal(<span class="attribute">shape</span>=shape, <span class="attribute">mean</span>=mean, <span class="attribute">stddev</span>=stddev)</span><br><span class="line">    return tf.Variable(initial)</span><br><span class="line"></span><br><span class="line">def bias(shape, value):</span><br><span class="line">    initial = tf.constant(<span class="attribute">value</span>=value, <span class="attribute">shape</span>=shape)</span><br><span class="line">    return tf.Variable(initial)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="卷积"><a href="#卷积" class="headerlink" title="卷积"></a>卷积</h2>
                  <p>这次我们需要使用卷积神经网络来处理图片，所以这里的核心部分就是卷积和池化了，首先我们来了解一下卷积和池化。 卷积常用的方法为 conv2d() ，它的 API 如下：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">tf.nn.conv2d(<span class="keyword">input</span>, <span class="keyword">filter</span>, strides, padding, use_cudnn_on_gpu=<span class="keyword">None</span>, <span class="type">name</span>=<span class="keyword">None</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这个方法是 TensorFlow 实现卷积常用的方法，也是搭建卷积神经网络的核心方法，参数介绍如下：</p>
                  <ul>
                    <li>input，指需要做卷积的输入图像，它要求是一个 Tensor，具有 [batch_size, in_height, in_width, in_channels] 这样的 shape，具体含义是 [batch_size 的图片数量, 图片高度, 图片宽度, 输入图像通道数]，注意这是一个 4 维的 Tensor，要求类型为 float32 和 float64 其中之一。</li>
                    <li>filter，相当于 CNN 中的卷积核，它要求是一个 Tensor，具有 [filter_height, filter_width, in_channels, out_channels] 这样的shape，具体含义是 [卷积核的高度，卷积核的宽度，输入图像通道数，输出通道数（即卷积核个数）]，要求类型与参数 input 相同，有一个地方需要注意，第三维 in_channels，就是参数 input 的第四维。</li>
                    <li>strides，卷积时在图像每一维的步长，这是一个一维的向量，长度 4，具有 [stride_batch_size, stride_in_height, stride_in_width, stride_in_channels] 这样的 shape，第一个元素代表在一个样本的特征图上移动，第二三个元素代表在特征图上的高、宽上移动，第四个元素代表在通道上移动。</li>
                    <li>padding，string 类型的量，只能是 SAME、VALID 其中之一，这个值决定了不同的卷积方式。</li>
                    <li>use_cudnn_on_gpu，布尔类型，是否使用 cudnn 加速，默认为true。</li>
                  </ul>
                  <p>返回的结果是 [batch_size, out_height, out_width, out_channels] 维度的结果。 我们这里拿一张 3x3 的图片，单通道（通道为1）的图片，拿一个 1x1 的卷积核进行卷积：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">input = tf.Variable(tf.random_normal([1, 3, 3, 1]))</span><br><span class="line">filter = tf.Variable(tf.random_normal([1, 1, 1, 1]))</span><br><span class="line">op = tf.nn.conv2d(input, filter, strides=[1, 1, 1, 1], <span class="attribute">padding</span>=<span class="string">'VALID'</span>)</span><br><span class="line"><span class="builtin-name">print</span>(op.shape)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">(<span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">1</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>很清晰，一张图片，拿一个 1x1 的核去做卷积，得到的结果输出是 3x3 的，输出通道为 1，batch_size 照旧。 再将卷积核扩大，用一个 3x3 的卷积核：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">input = tf.Variable(tf.random_normal([1, 3, 3, 1]))</span><br><span class="line">filter = tf.Variable(tf.random_normal([3, 3, 1, 1]))</span><br><span class="line">op = tf.nn.conv2d(input, filter, strides=[1, 1, 1, 1], <span class="attribute">padding</span>=<span class="string">'VALID'</span>)</span><br><span class="line"><span class="builtin-name">print</span>(op.shape)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>最后输出的是一个 1x1 的值。 将图片扩大为 7x7，卷积核仍然使用 3x3：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">input = tf.Variable(tf.random_normal([1, 7, 7, 1]))</span><br><span class="line">filter = tf.Variable(tf.random_normal([3, 3, 1, 1]))</span><br><span class="line">op = tf.nn.conv2d(input, filter, strides=[1, 1, 1, 1], <span class="attribute">padding</span>=<span class="string">'VALID'</span>)</span><br><span class="line"><span class="builtin-name">print</span>(op.shape)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">(<span class="number">1</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">1</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>最后输出的是一个 5x5 的值。 这时如果我们把 padding 模式改为 SAME，表示卷积核可以停留在图像边缘：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">input = tf.Variable(tf.random_normal([1, 7, 7, 1]))</span><br><span class="line">filter = tf.Variable(tf.random_normal([3, 3, 1, 1]))</span><br><span class="line">op = tf.nn.conv2d(input, filter, strides=[1, 1, 1, 1], <span class="attribute">padding</span>=<span class="string">'SAME'</span>)</span><br><span class="line"><span class="builtin-name">print</span>(op.shape)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">(<span class="number">1</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">1</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>则输出的内容和原图像是相同的。 这时如果更改 batch_size 和 out_channels，比如 batch_size 修改为 3，out_channels 修改为 6：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">input = tf.Variable(tf.random_normal([3, 7, 7, 1]))</span><br><span class="line">filter = tf.Variable(tf.random_normal([3, 3, 1, 6]))</span><br><span class="line">op = tf.nn.conv2d(input, filter, strides=[1, 1, 1, 1], <span class="attribute">padding</span>=<span class="string">'SAME'</span>)</span><br><span class="line"><span class="builtin-name">print</span>(op.shape)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">(<span class="number">3</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">6</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>输出结果的 batch_size 和 out_channels 会随之变化。 当 strides 的步长不为 1 的时候，我们将 stride_in_height 和 stride_in_width 修改为 2，相当于每次移动两步：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">input = tf.Variable(tf.random_normal([3, 7, 7, 1]))</span><br><span class="line">filter = tf.Variable(tf.random_normal([3, 3, 1, 6]))</span><br><span class="line">op = tf.nn.conv2d(input, filter, strides=[1, 2, 2, 1], <span class="attribute">padding</span>=<span class="string">'VALID'</span>)</span><br><span class="line"><span class="builtin-name">print</span>(op.shape)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">(<span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">6</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>最后我们用一个例子来感受一下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import tensorflow as tf</span><br><span class="line"></span><br><span class="line">input = tf.Variable(tf.random_normal([2, 4, 4, 5]))</span><br><span class="line">filter = tf.Variable(tf.random_normal([2, 2, 5, 2]))</span><br><span class="line">op = tf.nn.conv2d(input, filter, strides=[1, 1, 1, 1], <span class="attribute">padding</span>=<span class="string">'VALID'</span>)</span><br><span class="line">sess = tf.InteractiveSession()</span><br><span class="line">tf.global_variables_initializer().<span class="builtin-name">run</span>()</span><br><span class="line"><span class="builtin-name">print</span>(op.shape)</span><br><span class="line"><span class="builtin-name">print</span>(sess.<span class="builtin-name">run</span>(op))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里 input、filter 通过指定 shape 的方式调用 random_normal() 方法进行随机初始化，input 的维度为 [2, 4, 4, 5]，即 batch_size 为 2，图片是 4x4，输入通道数为 5，卷积核大小为 2x2，输入通道 5，输出通道 2，步长为 1，padding 方式选用 VALID，最后输出得到输出的 shape 和结果。 结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">(<span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">2</span>)</span><br><span class="line">[[[[  <span class="number">2.05039382</span>  <span class="number">-8.82934952</span>]</span><br><span class="line">   [ <span class="number">-9.77668381</span>   <span class="number">3.63882256</span>]</span><br><span class="line">   [ <span class="number">-4.46390772</span>  <span class="number">-5.91670704</span>]]</span><br><span class="line"></span><br><span class="line">  [[  <span class="number">8.41201782</span>  <span class="number">-6.72245312</span>]</span><br><span class="line">   [ <span class="number">-1.47592044</span>  <span class="number">13.03628349</span>]</span><br><span class="line">   [  <span class="number">5.44015312</span>   <span class="number">2.46059227</span>]]</span><br><span class="line"></span><br><span class="line">  [[ <span class="number">-3.18967772</span>   <span class="number">1.24733043</span>]</span><br><span class="line">   [<span class="number">-10.1108532</span>   <span class="number">-6.44734669</span>]</span><br><span class="line">   [  <span class="number">1.99426246</span>   <span class="number">2.91549349</span>]]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> [[[ <span class="number">-1.66685319</span>   <span class="number">0.32011557</span>]</span><br><span class="line">   [ <span class="number">-5.66163826</span>  <span class="number">-0.37670898</span>]</span><br><span class="line">   [ <span class="number">-0.74658942</span>   <span class="number">1.31723833</span>]]</span><br><span class="line"></span><br><span class="line">  [[ <span class="number">-5.85412216</span>  <span class="number">-0.29930949</span>]</span><br><span class="line">   [ <span class="number">-0.75974303</span>  <span class="number">-1.84006214</span>]</span><br><span class="line">   [ <span class="number">-2.05475235</span>   <span class="number">4.9572196</span> ]]</span><br><span class="line"></span><br><span class="line">  [[ <span class="number">-4.09344864</span>   <span class="number">1.39405775</span>]</span><br><span class="line">   [ <span class="number">-1.28887582</span>  <span class="number">-2.82365012</span>]</span><br><span class="line">   [  <span class="number">4.87360907</span>  <span class="number">10.8071022</span> ]]]]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到 input 维度为 [2, 4, 4, 5]，filter 维度为 [2, 2, 5, 2] 时，生成的结果维度为 [2, 3, 3, 2]。</p>
                  <h2 id="池化"><a href="#池化" class="headerlink" title="池化"></a>池化</h2>
                  <p>池化层往往在卷积层后面，通过池化来降低卷积层输出的特征向量，同时改善结果。 在这里介绍一个常用的最大值池化 max_pool() 方法，其 API 如下：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">tf.nn.max<span class="constructor">_pool(<span class="params">value</span>, <span class="params">ksize</span>, <span class="params">strides</span>, <span class="params">padding</span>, <span class="params">name</span>=None)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>是CNN当中的最大值池化操作，其实用法和卷积很类似。 参数介绍如下：</p>
                  <ul>
                    <li>value，需要池化的输入，一般池化层接在卷积层后面，所以输入通常是 feature map，依然是 [batch_size, height, width, channels] 这样的shape。</li>
                    <li>ksize，池化窗口的大小，取一个四维向量，一般是 [batch_size, height, width, channels]，因为我们不想在 batch 和 channels 上做池化，所以这两个维度设为了1。</li>
                    <li>strides，和卷积类似，窗口在每一个维度上滑动的步长，一般也是 [stride_batch_size, stride_height, stride_width, stride_channels]。</li>
                    <li>padding，和卷积类似，可以取 VALID、SAME，返回一个 Tensor，类型不变，shape 仍然是 [batch_size, height, width, channels] 这种形式。</li>
                  </ul>
                  <p>在这里输入为 [3, 7, 7, 2]，池化窗口设置为 [1, 2, 2, 1]，步长为 [1, 1, 1, 1]，padding 模式设置为 VALID。</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">input = tf.Variable(tf.random_normal([<span class="number">3</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">2</span>]))</span><br><span class="line">op = tf.nn.max_pool(input, ksize=[<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>], strides=[<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>], padding=<span class="string">'VALID'</span>)</span><br><span class="line">print(op.shape)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">(<span class="number">3</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">2</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>类似的原理，我们可以得到这样的的结果。</p>
                  <h2 id="卷积和池化"><a href="#卷积和池化" class="headerlink" title="卷积和池化"></a>卷积和池化</h2>
                  <p>所以了解了以上卷积和池化方法的用法，我们可以定义如下两个工具方法：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">def conv2d(input, filter, strides=[1, 1, 1, 1], <span class="attribute">padding</span>=<span class="string">'SAME'</span>):</span><br><span class="line">    return tf.nn.conv2d(input, filter, <span class="attribute">strides</span>=strides, <span class="attribute">padding</span>=padding)</span><br><span class="line"></span><br><span class="line">def max_pool(input, ksize=[1, 2, 2, 1], strides=[1, 2, 2, 1], <span class="attribute">padding</span>=<span class="string">'SAME'</span>):</span><br><span class="line">    return tf.nn.max_pool(input, <span class="attribute">ksize</span>=ksize, <span class="attribute">strides</span>=strides, <span class="attribute">padding</span>=padding)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这两个方法分别实现了卷积和池化，并设置了默认步长和核大小。 接下来就让我们开始神经网络的构建吧。</p>
                  <h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2>
                  <p>首先我们需要初始化一些数据，包括输入的 x 和对一个的标注 y_label：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">x = tf.placeholder(tf.<span class="built_in">float</span>32, shape=[None, <span class="number">784</span>])</span><br><span class="line">y_label = tf.placeholder(tf.<span class="built_in">float</span>32, shape=[None, <span class="number">10</span>])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="第一层卷积"><a href="#第一层卷积" class="headerlink" title="第一层卷积"></a>第一层卷积</h2>
                  <p>现在我们可以开始实现第一层了。它由一个卷积接一个 max pooling 完成。卷积在每个 5x5 的 patch 中算出 32 个特征。卷积的权重张量形状是 [5, 5, 1, 32]，前两个维度是 patch 的大小，接着是输入的通道数目，最后是输出的通道数目，而对于每一个输出通道都有一个对应的偏置量，我们首先初始化 w 和 b</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">w_conv1 = weight([<span class="number">5</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">32</span>])</span><br><span class="line">b_conv1 = bias([<span class="number">32</span>])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>为了用这一层，我们把 x 变成一个四维向量，其第 2、3 维对应图片的宽、高，最后一维代表图片的颜色通道数，因为是灰度图所以这里的通道数为 1，如果是彩色图，则为 3。 随后我们需要对图片做 reshape 操作，将其</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">x_reshape = tf.reshape(x, [<span class="number">-1</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">1</span>])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们把 x_reshape 和权值向量进行卷积，加上偏置项，然后应用 ReLU 激活函数，最后进行 max pooling：</p>
                  <figure class="highlight smali">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">h_conv1 = tf.nn.relu(conv2d(x_reshape, w_conv1) + b_conv1)</span><br><span class="line">h_pool1 = max_pool(h_conv1)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="第二层卷积"><a href="#第二层卷积" class="headerlink" title="第二层卷积"></a>第二层卷积</h2>
                  <p>现在我们已经实现了一层卷积，为了构建一个更深的网络，我们再继续增加一层卷积，将通道数变成 64，所以这里的初始化权重和偏置为：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">w_conv2 = weight([<span class="number">5</span>, <span class="number">5</span>, <span class="number">32</span>, <span class="number">64</span>])</span><br><span class="line">b_conv2 = bias([<span class="number">64</span>])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>随后我们把上一层池化结果 h_pool1 和权值向量进行卷积，加上偏置项，然后应用 ReLU 激活函数，最后进行 max pooling：</p>
                  <figure class="highlight smali">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">h_conv2 = tf.nn.relu(conv2d(h_pool1, w_conv2) + b_conv2)</span><br><span class="line">h_pool2 = max_pool(h_conv2)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="密集连接层"><a href="#密集连接层" class="headerlink" title="密集连接层"></a>密集连接层</h2>
                  <p>现在，图片尺寸减小到7x7，我们再加入一个有 1024 个神经元的全连接层，用于处理整个图片。我们把池化层输出的张量 reshape 成一些向量，乘上权重矩阵，加上偏置，然后对其使用 ReLU。</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">w_fc1 = weight([<span class="number">7</span> * <span class="number">7</span> * <span class="number">64</span>, <span class="number">1024</span>])</span><br><span class="line">b_fc1 = bias([<span class="number">1024</span>])</span><br><span class="line">h_pool2_flat = tf.reshape(h_pool2, [<span class="number">-1</span>, <span class="number">7</span> * <span class="number">7</span> * <span class="number">64</span>])</span><br><span class="line">h_fc1 = tf.nn.relu(tf.matmul(h_pool2_flat, w_fc1) + b_fc1)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="Dropout"><a href="#Dropout" class="headerlink" title="Dropout"></a>Dropout</h2>
                  <p>为了减少过拟合，我们在输出层之前加入 dropout。我们用一个 placeholder 来代表一个神经元的输出在 dropout 中保持不变的概率。这样我们可以在训练过程中启用 dropout，在测试过程中关闭 dropout。 TensorFlow 的 tf.nn.dropout 操作除了可以屏蔽神经元的输出外，还会自动处理神经元输出值的 scale，所以用 dropout 的时候可以不用考虑 scale。</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">keep_prob</span> = tf.placeholder(tf.float32)</span><br><span class="line"><span class="attr">h_fc1_dropout</span> = tf.nn.dropout(h_fc1, keep_prob=keep_prob)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="输出层"><a href="#输出层" class="headerlink" title="输出层"></a>输出层</h2>
                  <p>最后，我们添加一个 Softmax 输出层，这里我们需要将 1024 维转为 10 维，所以需要声明一个 [1024, 10] 的权重和 [10] 的偏置：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">w_fc2</span> = weight([<span class="number">1024</span>, <span class="number">10</span>])</span><br><span class="line"><span class="attr">b_fc1</span> = bias([<span class="number">10</span>])</span><br><span class="line"><span class="attr">y</span> = tf.nn.softmax(tf.matmul(h_fc1_dropout, w_fc2) + b_fc1)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="训练和评估模型"><a href="#训练和评估模型" class="headerlink" title="训练和评估模型"></a>训练和评估模型</h2>
                  <p>为了进行训练和评估，我们使用与之前简单的单层 Softmax 神经网络模型几乎相同的一套代码，只是我们会用更加复杂的 Adam 优化器来做梯度最速下降，在 feed_dict 中加入额外的参数 keep_prob 来控制 dropout 比例，然后每 100次 迭代输出一次日志：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># Loss</span></span><br><span class="line">cross_entropy = -tf.reduce_sum(y_label * tf.log(y))</span><br><span class="line">train = tf.train.AdamOptimizer(1e-4).minimize(cross_entropy)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Prediction</span></span><br><span class="line">correct_prediction = tf.equal(tf.argmax(y_label, <span class="attribute">axis</span>=1), tf.argmax(y, <span class="attribute">axis</span>=1))</span><br><span class="line">accuracy = tf.reduce_mean(tf.cast(correct_prediction, tf.float32))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Train</span></span><br><span class="line">with tf.Session() as sess:</span><br><span class="line">    sess.<span class="builtin-name">run</span>(tf.global_variables_initializer())</span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">step</span> <span class="keyword">in</span> range(total_steps + 1):</span><br><span class="line">        batch = mnist.train.next_batch(batch_size)</span><br><span class="line">        sess.<span class="builtin-name">run</span>(train, feed_dict=&#123;x: batch[0], y_label: batch[1], keep_prob: dropout_keep_prob&#125;)</span><br><span class="line">        # Train accuracy</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">step</span> % steps_per_test == 0:</span><br><span class="line">            <span class="builtin-name">print</span>(<span class="string">'Training Accuracy'</span>, <span class="keyword">step</span>,</span><br><span class="line">                  sess.<span class="builtin-name">run</span>(accuracy, feed_dict=&#123;x: batch[0], y_label: batch[1], keep_prob: 1&#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Final Test</span></span><br><span class="line"><span class="builtin-name">print</span>(<span class="string">'Test Accuracy'</span>, sess.<span class="builtin-name">run</span>(accuracy, feed_dict=&#123;x: mnist.test.images, y_label: mnist.test.labels, keep_prob: 1&#125;))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2>
                  <p>以上代码，在最终测试集上的准确率大概是99.2%。 运行结果：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Training Accuracy <span class="number">0</span> <span class="number">0.05</span></span><br><span class="line">Training Accuracy <span class="number">100</span> <span class="number">0.7</span></span><br><span class="line">Training Accuracy <span class="number">200</span> <span class="number">0.85</span></span><br><span class="line">Training Accuracy <span class="number">300</span> <span class="number">0.9</span></span><br><span class="line">Training Accuracy <span class="number">400</span> <span class="number">0.93</span></span><br><span class="line">Training Accuracy <span class="number">500</span> <span class="number">0.91</span></span><br><span class="line">Training Accuracy <span class="number">600</span> <span class="number">0.94</span></span><br><span class="line">Training Accuracy <span class="number">700</span> <span class="number">0.95</span></span><br><span class="line">Training Accuracy <span class="number">800</span> <span class="number">0.95</span></span><br><span class="line">Training Accuracy <span class="number">900</span> <span class="number">0.95</span></span><br><span class="line">Training Accuracy <span class="number">1000</span> <span class="number">0.97</span></span><br><span class="line">Training Accuracy <span class="number">1100</span> <span class="number">0.95</span></span><br><span class="line">Training Accuracy <span class="number">1200</span> <span class="number">0.96</span></span><br><span class="line">Training Accuracy <span class="number">1300</span> <span class="number">0.99</span></span><br><span class="line">Training Accuracy <span class="number">1400</span> <span class="number">0.98</span></span><br><span class="line">Training Accuracy <span class="number">1500</span> <span class="number">0.95</span></span><br><span class="line">Training Accuracy <span class="number">1600</span> <span class="number">0.97</span></span><br><span class="line">Training Accuracy <span class="number">1700</span> <span class="number">1.0</span></span><br><span class="line">Training Accuracy <span class="number">1800</span> <span class="number">0.95</span></span><br><span class="line">Training Accuracy <span class="number">1900</span> <span class="number">0.95</span></span><br><span class="line">Training Accuracy <span class="number">2000</span> <span class="number">0.95</span></span><br><span class="line">Training Accuracy <span class="number">2100</span> <span class="number">0.96</span></span><br><span class="line">Training Accuracy <span class="number">2200</span> <span class="number">0.96</span></span><br><span class="line">Training Accuracy <span class="number">2300</span> <span class="number">0.98</span></span><br><span class="line">Training Accuracy <span class="number">2400</span> <span class="number">0.97</span></span><br><span class="line">Training Accuracy <span class="number">2500</span> <span class="number">0.96</span></span><br><span class="line">Training Accuracy <span class="number">2600</span> <span class="number">0.99</span></span><br><span class="line">Training Accuracy <span class="number">2700</span> <span class="number">0.96</span></span><br><span class="line">Training Accuracy <span class="number">2800</span> <span class="number">0.98</span></span><br><span class="line">Training Accuracy <span class="number">2900</span> <span class="number">0.95</span></span><br><span class="line">Training Accuracy <span class="number">3000</span> <span class="number">0.99</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2>
                  <p>本节我们实现了卷积神经网络来处理图像相关问题，将准确率大大提高，可见神经网络是非常强大的。</p>
                  <h2 id="本节代码"><a href="#本节代码" class="headerlink" title="本节代码"></a>本节代码</h2>
                  <p>本节代码地址为：<a href="https://github.com/AIDeepLearning/MNIST" target="_blank" rel="noopener">https://github.com/AIDeepLearning/MNIST</a>。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2017-12-28 01:51:54" itemprop="dateCreated datePublished" datetime="2017-12-28T01:51:54+08:00">2017-12-28</time>
                </span>
                <span id="/4921.html" class="post-meta-item leancloud_visitors" data-flag-title="TensorFlow MNIST高级学习" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>8.9k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>8 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/4898.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/4898.html" class="post-title-link" itemprop="url">TensorFlow MNIST初级学习</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>我们本节要用 MNIST 数据集训练一个可以识别数据的深度学习模型来帮助识别手写数字。</p>
                  <h2 id="MNIST"><a href="#MNIST" class="headerlink" title="MNIST"></a>MNIST</h2>
                  <p>MNIST 是一个入门级计算机视觉数据集，包含了很多手写数字图片，如图所示： <img src="https://germey.gitbooks.io/ai/assets/2017-10-25-14-18-39.png" alt=""> 数据集中包含了图片和对应的标注，在 TensorFlow 中提供了这个数据集，我们可以用如下方法进行导入：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> tensorflow.examples.tutorials.mnist import input_data</span><br><span class="line">mnist = input_data.read_data_sets(<span class="string">'MNIST_data/'</span>, <span class="attribute">one_hot</span>=<span class="literal">True</span>)</span><br><span class="line"><span class="builtin-name">print</span>(mnist)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>输出结果如下：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Extracting MNIST_data/train-images-idx3-ubyte.gz</span><br><span class="line">Extracting MNIST_data/train-labels-idx1-ubyte.gz</span><br><span class="line">Extracting MNIST_data/t10k-images-idx3-ubyte.gz</span><br><span class="line">Extracting MNIST_data/t10k-labels-idx1-ubyte.gz</span><br><span class="line"><span class="constructor">Datasets(<span class="params">train</span>=&lt;<span class="params">tensorflow</span>.<span class="params">contrib</span>.<span class="params">learn</span>.<span class="params">python</span>.<span class="params">learn</span>.<span class="params">datasets</span>.<span class="params">mnist</span>.DataSet <span class="params">object</span> <span class="params">at</span> 0x101707ef0&gt;, <span class="params">validation</span>=&lt;<span class="params">tensorflow</span>.<span class="params">contrib</span>.<span class="params">learn</span>.<span class="params">python</span>.<span class="params">learn</span>.<span class="params">datasets</span>.<span class="params">mnist</span>.DataSet <span class="params">object</span> <span class="params">at</span> 0x1016ae4a8&gt;, <span class="params">test</span>=&lt;<span class="params">tensorflow</span>.<span class="params">contrib</span>.<span class="params">learn</span>.<span class="params">python</span>.<span class="params">learn</span>.<span class="params">datasets</span>.<span class="params">mnist</span>.DataSet <span class="params">object</span> <span class="params">at</span> 0x1016f9358&gt;)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里程序会首先下载 MNIST 数据集，然后解压并保存到刚刚制定好的 MNIST_data 文件夹中，然后输出数据集对象。 数据集中包含了 55000 行的训练数据集（mnist.train）、5000 行验证集（mnist.validation）和 10000 行的测试数据集（mnist.test），文件如下所示： <img src="https://germey.gitbooks.io/ai/assets/2017-10-25-14-26-54.jpg" alt=""> 正如前面提到的一样，每一个 MNIST 数据单元有两部分组成：一张包含手写数字的图片和一个对应的标签。我们把这些图片设为 xs，把这些标签设为 ys。训练数据集和测试数据集都包含 xs 和 ys，比如训练数据集的图片是 mnist.train.images ，训练数据集的标签是 mnist.train.labels，每张图片是 28 x 28 像素，即 784 个像素点，我们可以把它展开形成一个向量，即长度为 784 的向量。 所以训练集我们可以转化为 [55000, 784] 的向量，第一维就是训练集中包含的图片个数，第二维是图片的像素点表示的向量。</p>
                  <h2 id="Softmax"><a href="#Softmax" class="headerlink" title="Softmax"></a>Softmax</h2>
                  <p>Softmax 可以看成是一个激励（activation）函数或者链接（link）函数，把我们定义的线性函数的输出转换成我们想要的格式，也就是关于 10 个数字类的概率分布。因此，给定一张图片，它对于每一个数字的吻合度可以被 Softmax 函数转换成为一个概率值。Softmax 函数可以定义为： <img src="https://germey.gitbooks.io/ai/assets/2017-10-25-15-09-37.jpg" alt=""> 展开等式右边的子式，可以得到： <img src="https://germey.gitbooks.io/ai/assets/2017-10-25-15-10-04.jpg" alt=""> 比如判断一张图片中的动物是什么，可能的结果有三种，猫、狗、鸡，假如我们可以经过计算得出它们分别的得分为 3.2、5.1、-1.7，Softmax 的过程首先会对各个值进行次幂计算，分别为 24.5、164.0、0.18，然后计算各个次幂结果占总次幂结果的比重，这样就可以得到 0.13、0.87、0.00 这三个数值，所以这样我们就可以实现差别的放缩，即好的更好、差的更差。 如果要进一步求损失值可以进一步求对数然后取负值，这样 Softmax 后的值如果值越接近 1，那么得到的值越小，即损失越小，如果越远离 1，那么得到的值越大。</p>
                  <h2 id="实现回归模型"><a href="#实现回归模型" class="headerlink" title="实现回归模型"></a>实现回归模型</h2>
                  <p>首先导入 TensorFlow，命令如下：</p>
                  <figure class="highlight elm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来我们指定一个输入，在这里输入即为样本数据，如果是训练集那么则是 55000 x 784 的矩阵，如果是验证集则为 5000 x 784 的矩阵，如果是测试集则是 10000 x 784 的矩阵，所以它的行数是不确定的，但是列数是确定的。 所以可以先声明一个 placeholder 对象：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">x = tf.placeholder(tf.<span class="built_in">float</span>32, [None, <span class="number">784</span>])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里第一个参数指定了矩阵中每个数据的类型，第二个参数指定了数据的维度。 接下来我们需要构建第一层网络，表达式如下： <img src="https://germey.gitbooks.io/ai/assets/2017-10-25-15-27-25.jpg" alt=""> 这里实际上是对输入的 x 乘以 w 权重，然后加上一个偏置项作为输出，而这两个变量实际是在训练的过程中动态调优的，所以我们需要指定它们的类型为 Variable，代码如下：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">w = tf.<span class="constructor">Variable(<span class="params">tf</span>.<span class="params">zeros</span>([784, 10])</span>)</span><br><span class="line">b = tf.<span class="constructor">Variable(<span class="params">tf</span>.<span class="params">zeros</span>([10])</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来需要实现的就是上图所述的公式了，我们再进一步调用 Softmax 进行计算，得到 y：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">y</span> = <span class="keyword">tf</span>.<span class="keyword">nn</span>.softmax(<span class="keyword">tf</span>.matmul(<span class="keyword">x</span>, <span class="keyword">w</span>) + <span class="keyword">b</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过上面几行代码我们就已经把模型构建完毕了，结构非常简单。</p>
                  <h2 id="损失函数"><a href="#损失函数" class="headerlink" title="损失函数"></a>损失函数</h2>
                  <p>为了训练我们的模型，我们首先需要定义一个指标来评估这个模型是好的。其实，在机器学习，我们通常定义指标来表示一个模型是坏的，这个指标称为成本（cost）或损失（loss），然后尽量最小化这个指标。但是这两种方式是相同的。 一个非常常见的，非常漂亮的成本函数是“交叉熵”（cross-entropy）。交叉熵产生于信息论里面的信息压缩编码技术，但是它后来演变成为从博弈论到机器学习等其他领域里的重要技术手段。它的定义如下： <img src="https://germey.gitbooks.io/ai/assets/2017-10-25-15-45-09.jpg" alt=""> y 是我们预测的概率分布, y_label 是实际的分布，比较粗糙的理解是，交叉熵是用来衡量我们的预测用于描述真相的低效性。 我们可以首先定义 y_label，它的表达式是：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">y_label = tf.placeholder(tf.<span class="built_in">float</span>32, [None, <span class="number">10</span>])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来我们需要计算它们的交叉熵，代码如下：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">cross_entropy = tf.reduce<span class="constructor">_mean(-<span class="params">tf</span>.<span class="params">reduce_sum</span>(<span class="params">y_label</span> <span class="operator">*</span> <span class="params">tf</span>.<span class="params">log</span>(<span class="params">y</span>)</span>, reduction_indices=<span class="literal">[<span class="number">1</span>]</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>首先用 reduce_sum() 方法针对每一个维度进行求和，reduction_indices 是指定沿哪些维度进行求和。 然后调用 reduce_mean() 则求平均值，将一个向量中的所有元素求算平均值。 这样我们最后只需要优化这个交叉熵就好了。 所以这样我们再定义一个优化方法：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">train</span> = tf.train.GradientDescentOptimizer(<span class="number">0.5</span>).minimize(cross_entropy)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里使用了 GradientDescentOptimizer，在这里，我们要求 TensorFlow 用梯度下降算法（gradient descent algorithm）以 0.5 的学习速率最小化交叉熵。梯度下降算法（gradient descent algorithm）是一个简单的学习过程，TensorFlow 只需将每个变量一点点地往使成本不断降低的方向移动即可。</p>
                  <h2 id="运行模型"><a href="#运行模型" class="headerlink" title="运行模型"></a>运行模型</h2>
                  <p>定义好了以上内容之后，相当于我们已经构建好了一个计算图，即设置好了模型，我们把它放到 Session 里面运行即可：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">with</span> tf.<span class="constructor">Session()</span> <span class="keyword">as</span> sess:</span><br><span class="line">    sess.run(tf.global<span class="constructor">_variables_initializer()</span>)</span><br><span class="line">    for step <span class="keyword">in</span> range(total_steps + <span class="number">1</span>):</span><br><span class="line">        batch_x, batch_y = mnist.train.next<span class="constructor">_batch(<span class="params">batch_size</span>)</span></span><br><span class="line">        sess.run(train, feed_dict=&#123;x: batch_x, y_label: batch_y&#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>该循环的每个步骤中，我们都会随机抓取训练数据中的 batch_size 个批处理数据点，然后我们用这些数据点作为参数替换之前的占位符来运行 train。 这里需要一些变量的定义：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">batch_size</span> = <span class="number">100</span></span><br><span class="line"><span class="attr">total_steps</span> = <span class="number">5000</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="测试模型"><a href="#测试模型" class="headerlink" title="测试模型"></a>测试模型</h2>
                  <p>那么我们的模型性能如何呢？ 首先让我们找出那些预测正确的标签。tf.argmax() 是一个非常有用的函数，它能给出某个 Tensor 对象在某一维上的其数据最大值所在的索引值。由于标签向量是由 0,1 组成，因此最大值 1 所在的索引位置就是类别标签，比如 tf.argmax(y, 1) 返回的是模型对于任一输入 x 预测到的标签值，而 tf.argmax(y_label, 1) 代表正确的标签，我们可以用 tf.equal() 方法来检测我们的预测是否真实标签匹配（索引位置一样表示匹配）。</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">correct_prediction = tf.equal(tf.argmax(y, <span class="attribute">axis</span>=1), tf.argmax(y_label, <span class="attribute">axis</span>=1))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这行代码会给我们一组布尔值。为了确定正确预测项的比例，我们可以把布尔值转换成浮点数，然后取平均值。例如，[True, False, True, True] 会变成 [1, 0, 1, 1] ，取平均值后得到 0.75。</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">accuracy = tf.reduce<span class="constructor">_mean(<span class="params">tf</span>.<span class="params">cast</span>(<span class="params">correct_prediction</span>, <span class="params">tf</span>.<span class="params">float32</span>)</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>最后，我们计算所学习到的模型在测试数据集上面的正确率，定义如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">steps_per_test = 100</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">step</span> % steps_per_test == 0:</span><br><span class="line">    <span class="builtin-name">print</span>(<span class="keyword">step</span>, sess.<span class="builtin-name">run</span>(accuracy, feed_dict=&#123;x: mnist.test.images, y_label: mnist.test.labels&#125;))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这个最终结果值应该大约是92%。 这样我们就通过完成了训练和测试阶段，实现了一个基本的训练模型，后面我们会继续优化模型来达到更好的效果。 运行结果如下：</p>
                  <figure class="highlight basic">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">0 </span><span class="number">0.453</span></span><br><span class="line"><span class="symbol">100 </span><span class="number">0.8915</span></span><br><span class="line"><span class="symbol">200 </span><span class="number">0.9026</span></span><br><span class="line"><span class="symbol">300 </span><span class="number">0.9081</span></span><br><span class="line"><span class="symbol">400 </span><span class="number">0.9109</span></span><br><span class="line"><span class="symbol">500 </span><span class="number">0.9108</span></span><br><span class="line"><span class="symbol">600 </span><span class="number">0.9175</span></span><br><span class="line"><span class="symbol">700 </span><span class="number">0.9137</span></span><br><span class="line"><span class="symbol">800 </span><span class="number">0.9158</span></span><br><span class="line"><span class="symbol">900 </span><span class="number">0.9176</span></span><br><span class="line"><span class="symbol">1000 </span><span class="number">0.9167</span></span><br><span class="line"><span class="symbol">1100 </span><span class="number">0.9186</span></span><br><span class="line"><span class="symbol">1200 </span><span class="number">0.9206</span></span><br><span class="line"><span class="symbol">1300 </span><span class="number">0.9161</span></span><br><span class="line"><span class="symbol">1400 </span><span class="number">0.9218</span></span><br><span class="line"><span class="symbol">1500 </span><span class="number">0.9179</span></span><br><span class="line"><span class="symbol">1600 </span><span class="number">0.916</span></span><br><span class="line"><span class="symbol">1700 </span><span class="number">0.9196</span></span><br><span class="line"><span class="symbol">1800 </span><span class="number">0.9222</span></span><br><span class="line"><span class="symbol">1900 </span><span class="number">0.921</span></span><br><span class="line"><span class="symbol">2000 </span><span class="number">0.9223</span></span><br><span class="line"><span class="symbol">2100 </span><span class="number">0.9214</span></span><br><span class="line"><span class="symbol">2200 </span><span class="number">0.9191</span></span><br><span class="line"><span class="symbol">2300 </span><span class="number">0.9228</span></span><br><span class="line"><span class="symbol">2400 </span><span class="number">0.9228</span></span><br><span class="line"><span class="symbol">2500 </span><span class="number">0.9218</span></span><br><span class="line"><span class="symbol">2600 </span><span class="number">0.9197</span></span><br><span class="line"><span class="symbol">2700 </span><span class="number">0.9225</span></span><br><span class="line"><span class="symbol">2800 </span><span class="number">0.9238</span></span><br><span class="line"><span class="symbol">2900 </span><span class="number">0.9219</span></span><br><span class="line"><span class="symbol">3000 </span><span class="number">0.9224</span></span><br><span class="line"><span class="symbol">3100 </span><span class="number">0.9184</span></span><br><span class="line"><span class="symbol">3200 </span><span class="number">0.9253</span></span><br><span class="line"><span class="symbol">3300 </span><span class="number">0.9216</span></span><br><span class="line"><span class="symbol">3400 </span><span class="number">0.9218</span></span><br><span class="line"><span class="symbol">3500 </span><span class="number">0.9212</span></span><br><span class="line"><span class="symbol">3600 </span><span class="number">0.9225</span></span><br><span class="line"><span class="symbol">3700 </span><span class="number">0.9224</span></span><br><span class="line"><span class="symbol">3800 </span><span class="number">0.9225</span></span><br><span class="line"><span class="symbol">3900 </span><span class="number">0.9226</span></span><br><span class="line"><span class="symbol">4000 </span><span class="number">0.9201</span></span><br><span class="line"><span class="symbol">4100 </span><span class="number">0.9138</span></span><br><span class="line"><span class="symbol">4200 </span><span class="number">0.9184</span></span><br><span class="line"><span class="symbol">4300 </span><span class="number">0.9222</span></span><br><span class="line"><span class="symbol">4400 </span><span class="number">0.92</span></span><br><span class="line"><span class="symbol">4500 </span><span class="number">0.924</span></span><br><span class="line"><span class="symbol">4600 </span><span class="number">0.9234</span></span><br><span class="line"><span class="symbol">4700 </span><span class="number">0.9219</span></span><br><span class="line"><span class="symbol">4800 </span><span class="number">0.923</span></span><br><span class="line"><span class="symbol">4900 </span><span class="number">0.9254</span></span><br><span class="line"><span class="symbol">5000 </span><span class="number">0.9218</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2>
                  <p>本节通过一个 MNIST 数据集来简单体验了一下真实数据的训练和预测过程，但是准确率还不够高，后面我们会学习用卷积的方式来进行模型训练，准确率会更高。</p>
                  <h2 id="本节代码"><a href="#本节代码" class="headerlink" title="本节代码"></a>本节代码</h2>
                  <p>本节代码地址为：<a href="https://github.com/AIDeepLearning/MNIST" target="_blank" rel="noopener">https://github.com/AIDeepLearning/MNIST</a>。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2017-12-09 00:36:31" itemprop="dateCreated datePublished" datetime="2017-12-09T00:36:31+08:00">2017-12-09</time>
                </span>
                <span id="/4898.html" class="post-meta-item leancloud_visitors" data-flag-title="TensorFlow MNIST初级学习" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>4.8k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>4 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/4893.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/4893.html" class="post-title-link" itemprop="url">TensorFlow基础入门</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>本篇内容基于 Python3 TensorFlow 1.4 版本。</p>
                  <h2 id="本节内容"><a href="#本节内容" class="headerlink" title="本节内容"></a>本节内容</h2>
                  <p>本节通过最简单的示例 —— 平面拟合来说明 TensorFlow 的基本用法。</p>
                  <h2 id="构造数据"><a href="#构造数据" class="headerlink" title="构造数据"></a>构造数据</h2>
                  <p>TensorFlow 的引入方式是：</p>
                  <figure class="highlight elm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来我们构造一些随机的三维数据，然后用 TensorFlow 找到平面去拟合它，首先我们用 Numpy 生成随机三维点，其中变量 x 代表三维点的 (x, y) 坐标，是一个 2x100 的矩阵，即 100 个 (x, y)，然后变量 y 代表三位点的 z 坐标，我们用 Numpy 来生成这些随机的点：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> numpy as np</span><br><span class="line">x_data = np.<span class="built_in">float</span>32(np.random.rand(<span class="number">2</span>, <span class="number">100</span>))</span><br><span class="line">y_data = np.dot([<span class="number">0.300</span>, <span class="number">0.200</span>], x_data) + <span class="number">0.400</span></span><br><span class="line"></span><br><span class="line">print(x_data)</span><br><span class="line">print(y_data)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里利用 Numpy 的 random 模块的 rand() 方法生成了 2x100 的随机矩阵，这样就生成了 100 个 (x, y) 坐标，然后用了一个 dot() 方法算了矩阵乘法，用了一个长度为 2 的向量跟此矩阵相乘，得到一个长度为 100 的向量，然后再加上一个常量，得到 z 坐标，输出结果样例如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[[ <span class="number">0.97232962</span>  <span class="number">0.08897641</span>  <span class="number">0.54844421</span>  <span class="number">0.5877986</span>   <span class="number">0.5121088</span>   <span class="number">0.64716059</span></span><br><span class="line">   <span class="number">0.22353953</span>  <span class="number">0.18406206</span>  <span class="number">0.16782761</span>  <span class="number">0.97569454</span>  <span class="number">0.65686035</span>  <span class="number">0.75569868</span></span><br><span class="line">   <span class="number">0.35698661</span>  <span class="number">0.43332314</span>  <span class="number">0.41185728</span>  <span class="number">0.24801297</span>  <span class="number">0.50098598</span>  <span class="number">0.12025958</span></span><br><span class="line">   <span class="number">0.40650111</span>  <span class="number">0.51486945</span>  <span class="number">0.19292323</span>  <span class="number">0.03679928</span>  <span class="number">0.56501174</span>  <span class="number">0.5321334</span></span><br><span class="line">   <span class="number">0.71044683</span>  <span class="number">0.00318134</span>  <span class="number">0.76611853</span>  <span class="number">0.42602748</span>  <span class="number">0.33002195</span>  <span class="number">0.04414672</span></span><br><span class="line">   <span class="number">0.73208278</span>  <span class="number">0.62182301</span>  <span class="number">0.49471655</span>  <span class="number">0.8116194</span>   <span class="number">0.86148429</span>  <span class="number">0.48835048</span></span><br><span class="line">   <span class="number">0.69902027</span>  <span class="number">0.14901569</span>  <span class="number">0.18737803</span>  <span class="number">0.66826463</span>  <span class="number">0.43462989</span>  <span class="number">0.35768151</span></span><br><span class="line">   <span class="number">0.79315376</span>  <span class="number">0.0400687</span>   <span class="number">0.76952982</span>  <span class="number">0.12236254</span>  <span class="number">0.61519378</span>  <span class="number">0.92795062</span></span><br><span class="line">   <span class="number">0.84952474</span>  <span class="number">0.16663995</span>  <span class="number">0.13729768</span>  <span class="number">0.50603199</span>  <span class="number">0.38752931</span>  <span class="number">0.39529857</span></span><br><span class="line">   <span class="number">0.29228279</span>  <span class="number">0.09773371</span>  <span class="number">0.43220878</span>  <span class="number">0.2603009</span>   <span class="number">0.14576958</span>  <span class="number">0.21881725</span></span><br><span class="line">   <span class="number">0.64888018</span>  <span class="number">0.41048348</span>  <span class="number">0.27641159</span>  <span class="number">0.61700606</span>  <span class="number">0.49728736</span>  <span class="number">0.75936913</span></span><br><span class="line">   <span class="number">0.04028837</span>  <span class="number">0.88986284</span>  <span class="number">0.84112513</span>  <span class="number">0.34227493</span>  <span class="number">0.69162005</span>  <span class="number">0.89058989</span></span><br><span class="line">   <span class="number">0.39744586</span>  <span class="number">0.85080278</span>  <span class="number">0.37685293</span>  <span class="number">0.80529863</span>  <span class="number">0.31220895</span>  <span class="number">0.50500977</span></span><br><span class="line">   <span class="number">0.95800418</span>  <span class="number">0.43696108</span>  <span class="number">0.04143282</span>  <span class="number">0.05169986</span>  <span class="number">0.33503434</span>  <span class="number">0.1671818</span></span><br><span class="line">   <span class="number">0.10234453</span>  <span class="number">0.31241918</span>  <span class="number">0.23630807</span>  <span class="number">0.37890589</span>  <span class="number">0.63020509</span>  <span class="number">0.78184551</span></span><br><span class="line">   <span class="number">0.87924582</span>  <span class="number">0.99288088</span>  <span class="number">0.30762389</span>  <span class="number">0.43499199</span>  <span class="number">0.53140771</span>  <span class="number">0.43461791</span></span><br><span class="line">   <span class="number">0.23833922</span>  <span class="number">0.08681628</span>  <span class="number">0.74615192</span>  <span class="number">0.25835371</span>]</span><br><span class="line"> [ <span class="number">0.8174957</span>   <span class="number">0.26717573</span>  <span class="number">0.23811154</span>  <span class="number">0.02851068</span>  <span class="number">0.9627012</span>   <span class="number">0.36802396</span></span><br><span class="line">   <span class="number">0.50543582</span>  <span class="number">0.29964805</span>  <span class="number">0.44869211</span>  <span class="number">0.23191817</span>  <span class="number">0.77344608</span>  <span class="number">0.36636299</span></span><br><span class="line">   <span class="number">0.56170034</span>  <span class="number">0.37465382</span>  <span class="number">0.00471885</span>  <span class="number">0.19509546</span>  <span class="number">0.49715847</span>  <span class="number">0.15201907</span></span><br><span class="line">   <span class="number">0.5642485</span>   <span class="number">0.70218688</span>  <span class="number">0.6031307</span>   <span class="number">0.4705168</span>   <span class="number">0.98698962</span>  <span class="number">0.865367</span></span><br><span class="line">   <span class="number">0.36558965</span>  <span class="number">0.72073907</span>  <span class="number">0.83386165</span>  <span class="number">0.29963031</span>  <span class="number">0.72276717</span>  <span class="number">0.98171854</span></span><br><span class="line">   <span class="number">0.30932376</span>  <span class="number">0.52615297</span>  <span class="number">0.35522953</span>  <span class="number">0.13186514</span>  <span class="number">0.73437029</span>  <span class="number">0.03887378</span></span><br><span class="line">   <span class="number">0.1208882</span>   <span class="number">0.67004597</span>  <span class="number">0.83422536</span>  <span class="number">0.17487818</span>  <span class="number">0.71460873</span>  <span class="number">0.51926661</span></span><br><span class="line">   <span class="number">0.55297899</span>  <span class="number">0.78169805</span>  <span class="number">0.77547258</span>  <span class="number">0.92139858</span>  <span class="number">0.25020468</span>  <span class="number">0.70916855</span></span><br><span class="line">   <span class="number">0.68722379</span>  <span class="number">0.75378138</span>  <span class="number">0.30182058</span>  <span class="number">0.91982585</span>  <span class="number">0.93160367</span>  <span class="number">0.81539184</span></span><br><span class="line">   <span class="number">0.87977934</span>  <span class="number">0.07394848</span>  <span class="number">0.1004181</span>   <span class="number">0.48765802</span>  <span class="number">0.73601437</span>  <span class="number">0.59894943</span></span><br><span class="line">   <span class="number">0.34601998</span>  <span class="number">0.69065076</span>  <span class="number">0.6768015</span>   <span class="number">0.98533565</span>  <span class="number">0.83803362</span>  <span class="number">0.47194552</span></span><br><span class="line">   <span class="number">0.84103006</span>  <span class="number">0.84892255</span>  <span class="number">0.04474261</span>  <span class="number">0.02038293</span>  <span class="number">0.50802571</span>  <span class="number">0.15178065</span></span><br><span class="line">   <span class="number">0.86116213</span>  <span class="number">0.51097614</span>  <span class="number">0.44155359</span>  <span class="number">0.67713588</span>  <span class="number">0.66439205</span>  <span class="number">0.67885226</span></span><br><span class="line">   <span class="number">0.4243969</span>   <span class="number">0.35731083</span>  <span class="number">0.07878648</span>  <span class="number">0.53950399</span>  <span class="number">0.84162414</span>  <span class="number">0.24412845</span></span><br><span class="line">   <span class="number">0.61285144</span>  <span class="number">0.00316137</span>  <span class="number">0.67407191</span>  <span class="number">0.83218956</span>  <span class="number">0.94473189</span>  <span class="number">0.09813353</span></span><br><span class="line">   <span class="number">0.16728765</span>  <span class="number">0.95433819</span>  <span class="number">0.1416636</span>   <span class="number">0.4220584</span>   <span class="number">0.35413414</span>  <span class="number">0.55999744</span></span><br><span class="line">   <span class="number">0.94829601</span>  <span class="number">0.62568033</span>  <span class="number">0.89808714</span>  <span class="number">0.07021013</span>]]</span><br><span class="line">[ <span class="number">0.85519803</span>  <span class="number">0.48012807</span>  <span class="number">0.61215557</span>  <span class="number">0.58204171</span>  <span class="number">0.74617288</span>  <span class="number">0.66775297</span></span><br><span class="line">  <span class="number">0.56814902</span>  <span class="number">0.51514823</span>  <span class="number">0.5400867</span>   <span class="number">0.739092</span>    <span class="number">0.75174732</span>  <span class="number">0.6999822</span></span><br><span class="line">  <span class="number">0.61943605</span>  <span class="number">0.60492771</span>  <span class="number">0.52450095</span>  <span class="number">0.51342299</span>  <span class="number">0.64972749</span>  <span class="number">0.46648169</span></span><br><span class="line">  <span class="number">0.63480003</span>  <span class="number">0.69489821</span>  <span class="number">0.57850311</span>  <span class="number">0.50514314</span>  <span class="number">0.76690145</span>  <span class="number">0.73271342</span></span><br><span class="line">  <span class="number">0.68625198</span>  <span class="number">0.54510222</span>  <span class="number">0.79660789</span>  <span class="number">0.58773431</span>  <span class="number">0.64356002</span>  <span class="number">0.60958773</span></span><br><span class="line">  <span class="number">0.68148959</span>  <span class="number">0.6917775</span>   <span class="number">0.61946087</span>  <span class="number">0.66985885</span>  <span class="number">0.80531934</span>  <span class="number">0.5542799</span></span><br><span class="line">  <span class="number">0.63388372</span>  <span class="number">0.5787139</span>   <span class="number">0.62305848</span>  <span class="number">0.63545502</span>  <span class="number">0.67331071</span>  <span class="number">0.61115777</span></span><br><span class="line">  <span class="number">0.74854193</span>  <span class="number">0.56836022</span>  <span class="number">0.78595346</span>  <span class="number">0.62098848</span>  <span class="number">0.63459907</span>  <span class="number">0.8202189</span></span><br><span class="line">  <span class="number">0.79230218</span>  <span class="number">0.60074826</span>  <span class="number">0.50155342</span>  <span class="number">0.73577477</span>  <span class="number">0.70257953</span>  <span class="number">0.68166794</span></span><br><span class="line">  <span class="number">0.6636407</span>   <span class="number">0.44410981</span>  <span class="number">0.54974625</span>  <span class="number">0.57562188</span>  <span class="number">0.59093375</span>  <span class="number">0.58543506</span></span><br><span class="line">  <span class="number">0.66386805</span>  <span class="number">0.6612752</span>   <span class="number">0.61828378</span>  <span class="number">0.78216895</span>  <span class="number">0.71679293</span>  <span class="number">0.72219985</span></span><br><span class="line">  <span class="number">0.58029252</span>  <span class="number">0.83674336</span>  <span class="number">0.66128606</span>  <span class="number">0.50675907</span>  <span class="number">0.70909116</span>  <span class="number">0.6975331</span></span><br><span class="line">  <span class="number">0.69146618</span>  <span class="number">0.75743606</span>  <span class="number">0.6013666</span>   <span class="number">0.77701676</span>  <span class="number">0.6265411</span>   <span class="number">0.68727338</span></span><br><span class="line">  <span class="number">0.77228063</span>  <span class="number">0.60255049</span>  <span class="number">0.42818714</span>  <span class="number">0.52341076</span>  <span class="number">0.66883513</span>  <span class="number">0.49898023</span></span><br><span class="line">  <span class="number">0.55327365</span>  <span class="number">0.49435803</span>  <span class="number">0.6057068</span>   <span class="number">0.68010968</span>  <span class="number">0.77800791</span>  <span class="number">0.65418036</span></span><br><span class="line">  <span class="number">0.69723127</span>  <span class="number">0.8887319</span>   <span class="number">0.52061989</span>  <span class="number">0.61490928</span>  <span class="number">0.63024914</span>  <span class="number">0.64238486</span></span><br><span class="line">  <span class="number">0.66116097</span>  <span class="number">0.55118095</span>  <span class="number">0.80346301</span>  <span class="number">0.49154814</span>]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们就得到了一些三维的点。</p>
                  <h2 id="构造模型"><a href="#构造模型" class="headerlink" title="构造模型"></a>构造模型</h2>
                  <p>随后我们用 TensorFlow 来根据这些数据拟合一个平面，拟合的过程实际上就是寻找 (x, y) 和 z 的关系，即变量 x_data 和变量 y_data 的关系，而它们之间的关系刚才我们用了线性变换表示出来了，即 z = w * (x, y) + b，所以拟合的过程实际上就是找 w 和 b 的过程，所以这里我们就首先像设变量一样来设两个变量 w 和 b，代码如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">x = tf.placeholder(tf.<span class="built_in">float</span>32, [<span class="number">2</span>, <span class="number">100</span>])</span><br><span class="line">y_label = tf.placeholder(tf.<span class="built_in">float</span>32, [<span class="number">100</span>])</span><br><span class="line">b = tf.Variable(tf.zeros([<span class="number">1</span>]))</span><br><span class="line">w = tf.Variable(tf.random_uniform([<span class="number">2</span>], <span class="number">-1.0</span>, <span class="number">1.0</span>))</span><br><span class="line">y = tf.matmul(tf.reshape(w, [<span class="number">1</span>, <span class="number">2</span>]), x) + b</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在创建模型的时候，我们首先可以将现有的变量来表示出来，用 placeholder() 方法声明即可，一会我们在运行的时候传递给它真实的数据就好，第一个参数是数据类型，第二个参数是形状，因为 x_data 是 2x100 的矩阵，所以这里形状定义为 [2, 100]，而 y_data 是长度为 100 的向量，所以这里形状定义为 [100]，当然此处使用元组定义也可以，不过要写成 (100, )。 随后我们用 Variable 初始化了 TensorFlow 中的变量，b 初始化为一个常量，w 是一个随机初始化的 1x2 的向量，范围在 -1 和 1 之间，然后 y 再用 w、x、b 表示出来，其中 matmul() 方法就是 TensorFlow 中提供的矩阵乘法，类似 Numpy 的 dot() 方法。不过不同的是 matmul() 不支持向量和矩阵相乘，即不能 BroadCast，所以在这里做乘法前需要先调用 reshape() 一下转成 1x2 的标准矩阵，最后将结果表示为 y。 这样我们就构造出来了一个线性模型。 这里的 y 是我们模型中输出的值，而真实的数据却是我们输入的 y_data，即 y_label。</p>
                  <h2 id="损失函数"><a href="#损失函数" class="headerlink" title="损失函数"></a>损失函数</h2>
                  <p>要拟合这个平面的话，我们需要减小 y_label 和 y 的差距就好了，这个差距越小越好。 所以接下来我们可以定义一个损失函数，来代表模型实际输出值和真实值之间的差距，我们的目的就是来减小这个损失，代码实现如下：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">loss = tf.reduce<span class="constructor">_mean(<span class="params">tf</span>.<span class="params">square</span>(<span class="params">y</span> - <span class="params">y_label</span>)</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里调用了 square() 方法，传入 y_label 和 y 的差来求得平方和，然后使用 reduce_mean() 方法得到这个值的平均值，这就是现在模型的损失值，我们的目的就是减小这个损失值，所以接下来我们使用梯度下降的方法来减小这个损失值即可，定义如下代码：</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">optimizer</span> = tf.train.GradientDescentOptimizer(<span class="number">0.5</span>)</span><br><span class="line"><span class="attr">train</span> = optimizer.minimize(loss)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里定义了 GradientDescentOptimizer 优化，即使用梯度下降的方法来减小这个损失值，我们训练模型就是来模拟这个过程。</p>
                  <h2 id="运行模型"><a href="#运行模型" class="headerlink" title="运行模型"></a>运行模型</h2>
                  <p>最后我们将模型运行起来即可，运行时必须声明一个 Session 对象，然后初始化所有的变量，然后执行一步步的训练即可，实现如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">with tf.Session() as sess:</span><br><span class="line">    sess.<span class="builtin-name">run</span>(tf.global_variables_initializer())</span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">step</span> <span class="keyword">in</span> range(201):</span><br><span class="line">        sess.<span class="builtin-name">run</span>(train, feed_dict=&#123;x: x_data, y: y_data&#125;)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">step</span> % 10 == 0:</span><br><span class="line">            <span class="builtin-name">print</span>(<span class="keyword">step</span>, sess.<span class="builtin-name">run</span>(w), sess.<span class="builtin-name">run</span>(b))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里定义了 200 次循环，每一次循环都会执行一次梯度下降优化，每次循环都调用一次 run() 方法，传入的变量就是刚才定义个 train 对象，feed_dict 就把 placeholder 类型的变量赋值即可。随着训练的进行，损失会越来越小，w 和 b 也会被慢慢调整为拟合的值。 在这里每 10 次 循环我们都打印输出一下拟合的 w 和 b 的值，结果如下：</p>
                  <figure class="highlight basic">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">0 </span>[ <span class="number">0.31494665</span>  <span class="number">0.33602586</span>] [ <span class="number">0.84270978</span>]</span><br><span class="line"><span class="symbol">10 </span>[ <span class="number">0.19601417</span>  <span class="number">0.17301694</span>] [ <span class="number">0.47917289</span>]</span><br><span class="line"><span class="symbol">20 </span>[ <span class="number">0.23550016</span>  <span class="number">0.18053198</span>] [ <span class="number">0.44838765</span>]</span><br><span class="line"><span class="symbol">30 </span>[ <span class="number">0.26029009</span>  <span class="number">0.18700737</span>] [ <span class="number">0.43032286</span>]</span><br><span class="line"><span class="symbol">40 </span>[ <span class="number">0.27547371</span>  <span class="number">0.19152154</span>] [ <span class="number">0.41897511</span>]</span><br><span class="line"><span class="symbol">50 </span>[ <span class="number">0.28481475</span>  <span class="number">0.19454622</span>] [ <span class="number">0.41185945</span>]</span><br><span class="line"><span class="symbol">60 </span>[ <span class="number">0.29058149</span>  <span class="number">0.19652548</span>] [ <span class="number">0.40740564</span>]</span><br><span class="line"><span class="symbol">70 </span>[ <span class="number">0.2941508</span>   <span class="number">0.19780098</span>] [ <span class="number">0.40462157</span>]</span><br><span class="line"><span class="symbol">80 </span>[ <span class="number">0.29636407</span>  <span class="number">0.1986146</span> ] [ <span class="number">0.40288284</span>]</span><br><span class="line"><span class="symbol">90 </span>[ <span class="number">0.29773837</span>  <span class="number">0.19913</span>   ] [ <span class="number">0.40179768</span>]</span><br><span class="line"><span class="symbol">100 </span>[ <span class="number">0.29859257</span>  <span class="number">0.19945487</span>] [ <span class="number">0.40112072</span>]</span><br><span class="line"><span class="symbol">110 </span>[ <span class="number">0.29912385</span>  <span class="number">0.199659</span>  ] [ <span class="number">0.40069857</span>]</span><br><span class="line"><span class="symbol">120 </span>[ <span class="number">0.29945445</span>  <span class="number">0.19978693</span>] [ <span class="number">0.40043539</span>]</span><br><span class="line"><span class="symbol">130 </span>[ <span class="number">0.29966027</span>  <span class="number">0.19986697</span>] [ <span class="number">0.40027133</span>]</span><br><span class="line"><span class="symbol">140 </span>[ <span class="number">0.29978839</span>  <span class="number">0.19991697</span>] [ <span class="number">0.40016907</span>]</span><br><span class="line"><span class="symbol">150 </span>[ <span class="number">0.29986817</span>  <span class="number">0.19994824</span>] [ <span class="number">0.40010536</span>]</span><br><span class="line"><span class="symbol">160 </span>[ <span class="number">0.29991791</span>  <span class="number">0.1999677</span> ] [ <span class="number">0.40006563</span>]</span><br><span class="line"><span class="symbol">170 </span>[ <span class="number">0.29994887</span>  <span class="number">0.19997987</span>] [ <span class="number">0.40004089</span>]</span><br><span class="line"><span class="symbol">180 </span>[ <span class="number">0.29996812</span>  <span class="number">0.19998746</span>] [ <span class="number">0.40002549</span>]</span><br><span class="line"><span class="symbol">190 </span>[ <span class="number">0.29998016</span>  <span class="number">0.19999218</span>] [ <span class="number">0.40001586</span>]</span><br><span class="line"><span class="symbol">200 </span>[ <span class="number">0.29998764</span>  <span class="number">0.19999513</span>] [ <span class="number">0.40000987</span>]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到，随着训练的进行，w 和 b 也慢慢接近真实的值，拟合越来越精确，接近正确的值。</p>
                  <h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2>
                  <p>以上便是通过一个最简单的平面拟合的案例来说明了一下 TensorFlow 的用法，是不是很简单？</p>
                  <h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2>
                  <p>本节代码地址：<a href="https://github.com/AIDeepLearning/TensorFlowBasis" target="_blank" rel="noopener">https://github.com/AIDeepLearning/TensorFlowBasis</a>。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2017-12-09 00:24:47" itemprop="dateCreated datePublished" datetime="2017-12-09T00:24:47+08:00">2017-12-09</time>
                </span>
                <span id="/4893.html" class="post-meta-item leancloud_visitors" data-flag-title="TensorFlow基础入门" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>6.2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>6 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/4889.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Linux <i class="label-arrow"></i>
                  </a>
                  <a href="/4889.html" class="post-title-link" itemprop="url">小白学爬虫-批量部署Splash负载集群</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p><a href="http://cdn.cuiqingcai.com/wp-content/uploads/2016/10/QQ图片20161021225948.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2016/10/QQ图片20161021225948.jpg" alt=""></a> 部署公司生产环境的 Splash 集群无奈节点太多 差点被搞死·· 还好我有运维神器 Ansible，一次编撰终生可用啊！而且这玩意儿 等幂特性 扩容回滚 So Easy！！ 闲话少说开搞！</p>
                  <h2 id="安装-Ansible："><a href="#安装-Ansible：" class="headerlink" title="安装 Ansible："></a>安装 Ansible：</h2>
                  <p>看官方文档去：<a href="http://www.ansible.com.cn/index.html" target="_blank" rel="noopener">http://www.ansible.com.cn/index.html</a> 好像这个主控端不支持 Windows？ 大家虚拟机装个 Ubuntu 吧。</p>
                  <h2 id="闲话少扯直接上干货："><a href="#闲话少扯直接上干货：" class="headerlink" title="闲话少扯直接上干货："></a>闲话少扯直接上干货：</h2>
                  <p>整体目录如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">study@study:~/文档/ansible-examples$ tree Splash_Load_balancing_cluster</span><br><span class="line">Splash_Load_balancing_cluster</span><br><span class="line">├── group_vars</span><br><span class="line">│   └── all</span><br><span class="line">├── roles</span><br><span class="line">│   ├── common</span><br><span class="line">│   │   ├── files</span><br><span class="line">│   │   │   ├── CentOS-Base.repo</span><br><span class="line">│   │   │   ├── docker-ce.repo</span><br><span class="line">│   │   │   ├── epel.repo</span><br><span class="line">│   │   │   ├── ntp.conf</span><br><span class="line">│   │   │   └── RPM-GPG-KEY-EPEL-<span class="number">7</span></span><br><span class="line">│   │   ├── tasks</span><br><span class="line">│   │   │   └── main.yml</span><br><span class="line">│   │   └── templates</span><br><span class="line">│   ├── docker</span><br><span class="line">│   │   ├── handlers</span><br><span class="line">│   │   │   └── main.yml</span><br><span class="line">│   │   ├── tasks</span><br><span class="line">│   │   │   └── main.yml</span><br><span class="line">│   │   └── templates</span><br><span class="line">│   │       └── daemon<span class="selector-class">.json</span>.j2</span><br><span class="line">│   ├── haproxy</span><br><span class="line">│   │   ├── handlers</span><br><span class="line">│   │   │   └── main.yml</span><br><span class="line">│   │   ├── tasks</span><br><span class="line">│   │   │   └── main.yml</span><br><span class="line">│   │   └── templates</span><br><span class="line">│   │       └── haproxy<span class="selector-class">.cfg</span>.j2</span><br><span class="line">│   └── splash</span><br><span class="line">│       ├── files</span><br><span class="line">│       │   ├── filters</span><br><span class="line">│       │   │   └── default.txt</span><br><span class="line">│       │   ├── js-profiles</span><br><span class="line">│       │   ├── lua_modules</span><br><span class="line">│       │   └── proxy-profiles</span><br><span class="line">│       │       └── proxy.ini</span><br><span class="line">│       └── tasks</span><br><span class="line">│           └── main.yml</span><br><span class="line">├── site.retry</span><br><span class="line">└── site.yml</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>Group_vars： 里面定义全局使用的变量 Roles: 存放所有的规则目录 Roles/common :所有服务器初始化配置部署 Roles/common/filters :需要使用的文件或者文件夹 Roles/common/task：部署任务（main.yml 为入口必须要有） Roles/common/templates :配置模板（jinja2 模板语法 用于可变更的配置文件，可获取定义在 Group_vars 中的变量） Roles/Docker ：Docker 的安装配置 Roles/HAproxy ： HAproxy 的负载均衡配置 Roles/Splash : Splash 的镜像拉取配置部署以及启动 site.yml ： 启动入口</p>
                  <h2 id="使用方法："><a href="#使用方法：" class="headerlink" title="使用方法："></a>使用方法：</h2>
                  <h4 id="在你的-Inventory-文件定义好主机分组："><a href="#在你的-Inventory-文件定义好主机分组：" class="headerlink" title="在你的 Inventory 文件定义好主机分组："></a>在你的 Inventory 文件定义好主机分组：</h4>
                  <p>必须包括 HaProxy、和 Docker 两个分组如下：</p>
                  <figure class="highlight accesslog">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">study@study:~/文档/ansible-examples$ cat /etc/ansible/inventory/splash</span><br><span class="line"><span class="string">[docker]</span></span><br><span class="line"><span class="number">1.1.1.1</span></span><br><span class="line"><span class="string">[haproxy]</span></span><br><span class="line"><span class="number">10.253.20.25</span></span><br><span class="line"></span><br><span class="line"><span class="string">[splash_ports]</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h4 id="主控端新建-SSH-秘钥并发布到你你需要配置的所有主机！！！！（一定要注意如果本机当前工作用户在远程主机不存在额时候，需要指定-remote-user-这个参数）："><a href="#主控端新建-SSH-秘钥并发布到你你需要配置的所有主机！！！！（一定要注意如果本机当前工作用户在远程主机不存在额时候，需要指定-remote-user-这个参数）：" class="headerlink" title="主控端新建 SSH 秘钥并发布到你你需要配置的所有主机！！！！（一定要注意如果本机当前工作用户在远程主机不存在额时候，需要指定 remote_user 这个参数）："></a>主控端新建 SSH 秘钥并发布到你你需要配置的所有主机！！！！（一定要注意如果本机当前工作用户在远程主机不存在额时候，需要指定 remote_user 这个参数）：</h4>
                  <figure class="highlight elixir">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">study<span class="variable">@study</span><span class="symbol">:~/</span>文档/ansible-examples<span class="variable">$ </span>cat /etc/ansible/ansible.cfg</span><br><span class="line">[defaults]</span><br><span class="line">inventory= <span class="regexp">/etc/ansible</span><span class="regexp">/inventory/</span></span><br><span class="line"></span><br><span class="line">remote_user=root</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好了开始执行：</p>
                  <figure class="highlight elixir">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">study<span class="variable">@study</span><span class="symbol">:~/</span>文档/ansible-examples/Splash_Load_balancing_cluster<span class="variable">$ </span>ansible-playbook site.yml</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>效果就像这样：</p>
                  <figure class="highlight markdown">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">PLAY [all] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="emphasis">***</span></span><br><span class="line"></span><br><span class="line">TASK [Gathering Facts] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">ok: [10.1.4.101]</span><br><span class="line">ok: [10.1.4.100]</span><br><span class="line"></span><br><span class="line">TASK [common : Copy the CentOS repository definition] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span></span><br><span class="line">ok: [10.1.4.100]</span><br><span class="line">ok: [10.1.4.101]</span><br><span class="line"></span><br><span class="line">TASK [common : Copy the Docker repository definition] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span></span><br><span class="line">ok: [10.1.4.100]</span><br><span class="line">ok: [10.1.4.101]</span><br><span class="line"></span><br><span class="line">TASK [common : Create the repository for EPEL] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>**</span><br><span class="line">ok: [10.1.4.100]</span><br><span class="line">ok: [10.1.4.101]</span><br><span class="line"></span><br><span class="line">TASK [common : Create the GPG key for EPEL] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span></span><br><span class="line">ok: [10.1.4.100]</span><br><span class="line">ok: [10.1.4.101]</span><br><span class="line"></span><br><span class="line">TASK [common : Firewalld service stop] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span></span><br><span class="line">ok: [10.1.4.100]</span><br><span class="line">ok: [10.1.4.101]</span><br><span class="line"></span><br><span class="line">TASK [common : Chronyd service stop] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>**</span><br><span class="line">ok: [10.1.4.100]</span><br><span class="line">ok: [10.1.4.101]</span><br><span class="line"></span><br><span class="line">TASK [common : Install Ansible Base package] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="emphasis">***</span>*</span><br><span class="line">ok: [10.1.4.100] =&gt; (item=['libselinux-python', 'libsemanage-python', 'ntp'])</span><br><span class="line">ok: [10.1.4.101] =&gt; (item=['libselinux-python', 'libsemanage-python', 'ntp'])</span><br><span class="line"></span><br><span class="line">TASK [common : Configure SELinux to disable] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="emphasis">***</span>*</span><br><span class="line"> [WARNING]: SELinux state change will take effect next reboot</span><br><span class="line"></span><br><span class="line">ok: [10.1.4.100]</span><br><span class="line">ok: [10.1.4.101]</span><br><span class="line"></span><br><span class="line">TASK [common : Change TimeZone] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>**</span><br><span class="line">ok: [10.1.4.100]</span><br><span class="line">ok: [10.1.4.101]</span><br><span class="line"></span><br><span class="line">TASK [common : Copy NTP conf] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="emphasis">***</span>*</span><br><span class="line">ok: [10.1.4.100]</span><br><span class="line">ok: [10.1.4.101]</span><br><span class="line"></span><br><span class="line">TASK [common : NTP Start] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="emphasis">***</span></span><br><span class="line">ok: [10.1.4.100]</span><br><span class="line">ok: [10.1.4.101]</span><br><span class="line"></span><br><span class="line">PLAY [docker] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span></span><br><span class="line"></span><br><span class="line">TASK [Gathering Facts] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">ok: [10.1.4.101]</span><br><span class="line"></span><br><span class="line">TASK [docker : Install Docker package] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span></span><br><span class="line">ok: [10.1.4.101] =&gt; (item=['yum-utils', 'device-mapper-persistent-data', 'lvm2', 'docker-ce'])</span><br><span class="line"></span><br><span class="line">TASK [docker : Start Docker] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span></span><br><span class="line">ok: [10.1.4.101]</span><br><span class="line"></span><br><span class="line">TASK [docker : Create Docker Speed Configuration file] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="emphasis">***</span>*</span><br><span class="line">ok: [10.1.4.101]</span><br><span class="line"></span><br><span class="line">TASK [docker : Restart Docker] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="emphasis">***</span></span><br><span class="line">changed: [10.1.4.101]</span><br><span class="line"></span><br><span class="line">TASK [splash : pull splash] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span>*</span><br><span class="line">changed: [10.1.4.101]</span><br><span class="line"></span><br><span class="line">TASK [splash : Copy Splash module] <span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="strong">*****</span><span class="emphasis">***</span>*</span><br><span class="line">ok: [10.1.4.101] =&gt; (item=filters)</span><br><span class="line">ok: [10.1.4.101] =&gt; (item=js-profiles)</span><br><span class="line">ok: [10.1.4.101] =&gt; (item=lua_modules)</span><br><span class="line">ok: [10.1.4.101] =&gt; (item=proxy-profiles)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>静静等着跑完 就可以愉快的使用啦 ！ 需要增加节点的话直接把 IP 加载 Docker 分组下 重新执行一遍就可以了！ 需要注意如果 SSH 非默认的 22 端口还需要指定你的端口号！怎么指定 看看文档去 以上完毕！！！ 完整的看这儿：<a href="https://github.com/thsheep/ansible-examples" target="_blank" rel="noopener">https://github.com/thsheep/ansible-examples</a></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/哎哟卧槽" class="author" itemprop="url" rel="index">哎哟卧槽</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2017-12-02 11:32:07" itemprop="dateCreated datePublished" datetime="2017-12-02T11:32:07+08:00">2017-12-02</time>
                </span>
                <span id="/4889.html" class="post-meta-item leancloud_visitors" data-flag-title="小白学爬虫-批量部署Splash负载集群" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>6.7k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>6 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/4886.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/4886.html" class="post-title-link" itemprop="url">小白学爬虫-在无GUI的CentOS上使用Selenium+Chrome</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>2019 年 01 月 04 日 16:32:17 更新了新的 Chrome 镜像 将 Python 版本升级到了 3.7 Note: 推荐使用结尾提供的 Docker 镜像进行二次打包运行代码 各位小伙伴儿的采集日常是不是被 JavaScript 的各种点击事件折腾的欲仙欲死啊？好不容易找到个 Selenium+Chrome 可以解决问题！ 但是另一个 ▄█▀█● 的事实摆在面前，服务器都特么没有 GUI 啊·· <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2016/11/20160124759183737.gif" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2016/11/20160124759183737.gif" alt=""></a> 好吧！咱们要知难而上！决不能被这个点小困难打倒······· 然而摆在面前的事实是···· 他丫的各种装不上啊！坑爹啊！ 那么我来拯救你们于水火之间了！ <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2016/10/9555112.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2016/10/9555112.jpg" alt=""></a> 服务器如下：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="string">[root@spider01</span> <span class="string">~]#</span> <span class="string">hostnamectl</span></span><br><span class="line">   <span class="attr">Static hostname:</span> <span class="string">spider01</span></span><br><span class="line">         <span class="attr">Icon name:</span> <span class="string">computer-vm</span></span><br><span class="line">           <span class="attr">Chassis:</span> <span class="string">vm</span></span><br><span class="line">        <span class="attr">Machine ID:</span> <span class="string">1c4029c4e7fd42498e25bb75101f85b6</span></span><br><span class="line">           <span class="attr">Boot ID:</span> <span class="string">f5a67454b94b454fae3d75ef1ccab69f</span></span><br><span class="line">    <span class="attr">Virtualization:</span> <span class="string">kvm</span></span><br><span class="line">  <span class="attr">Operating System:</span> <span class="string">CentOS</span> <span class="string">Linux</span> <span class="number">7</span> <span class="string">(Core)</span></span><br><span class="line">       <span class="attr">CPE OS Name:</span> <span class="string">cpe:/o:centos:centos:7</span></span><br><span class="line">            <span class="attr">Kernel:</span> <span class="string">Linux</span> <span class="number">3.10</span><span class="number">.0</span><span class="number">-514.6</span><span class="number">.2</span><span class="string">.el7.x86_64</span></span><br><span class="line">      <span class="attr">Architecture:</span> <span class="string">x86-64</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>安装 Chromeium:</p>
                  <figure class="highlight autoit">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">## 安装yum源</span></span><br><span class="line">[root<span class="symbol">@spider01</span> ~]<span class="meta"># sudo yum install -y epel-release</span></span><br><span class="line"><span class="meta">## 安装Chrome</span></span><br><span class="line">[root<span class="symbol">@spider01</span> ~]<span class="meta"># yum install -y chromium</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>去这个地方：<a href="https://sites.google.com/a/chromium.org/chromedriver/downloads" target="_blank" rel="noopener">https://sites.google.com/a/chromium.org/chromedriver/downloads</a> 下载 ChromeDriver 驱动放在/usr/bin/目录下： 完成结果如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[<span class="symbol">root@</span>spider01 ~]# ll /usr/bin/ | grep chrom</span><br><span class="line">-rwxrwxrwx. <span class="number">1</span> root root   <span class="number">7500280</span> <span class="number">11</span>月 <span class="number">29</span> <span class="number">17</span>:<span class="number">32</span> chromedriver</span><br><span class="line">lrwxrwxrwx. <span class="number">1</span> root root        <span class="number">47</span> <span class="number">11</span>月 <span class="number">30</span> <span class="number">09</span>:<span class="number">35</span> chromium-browser -&gt; /usr/lib64/chromium-browser/chromium-browser.sh</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>安装 XVFB：</p>
                  <figure class="highlight autoit">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[root<span class="symbol">@spider01</span> ~]<span class="meta"># yum install Xvfb -y</span></span><br><span class="line">[root<span class="symbol">@spider01</span> ~]<span class="meta"># yum install xorg-x11-fonts* -y</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>新建在/usr/bin/ 一个名叫 xvfb-chromium 的文件写入以下内容：</p>
                  <figure class="highlight bash">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[root@spider01 ~]<span class="comment"># cat /usr/bin/xvfb-chromium</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">_kill_procs</span></span>() &#123;</span><br><span class="line">  <span class="built_in">kill</span> -TERM <span class="variable">$chromium</span></span><br><span class="line">  <span class="built_in">wait</span> <span class="variable">$chromium</span></span><br><span class="line">  <span class="built_in">kill</span> -TERM <span class="variable">$xvfb</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Setup a trap to catch SIGTERM and relay it to child processes</span></span><br><span class="line"><span class="built_in">trap</span> _kill_procs SIGTERM</span><br><span class="line"></span><br><span class="line">XVFB_WHD=<span class="variable">$&#123;XVFB_WHD:-1280x720x16&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Start Xvfb</span></span><br><span class="line">Xvfb :99 -ac -screen 0 <span class="variable">$XVFB_WHD</span> -nolisten tcp &amp;</span><br><span class="line">xvfb=$!</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> DISPLAY=:99</span><br><span class="line"></span><br><span class="line">chromium --no-sandbox --<span class="built_in">disable</span>-gpu<span class="variable">$@</span> &amp;</span><br><span class="line">chromium=$!</span><br><span class="line"></span><br><span class="line"><span class="built_in">wait</span> <span class="variable">$chromium</span></span><br><span class="line"><span class="built_in">wait</span> <span class="variable">$xvfb</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>更改软连接：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">## 更改Chrome启动的软连接</span><br><span class="line">[<span class="symbol">root@</span>spider01 ~]# ln -s /usr/lib64/chromium-browser/chromium-browser.sh /usr/bin/chromium</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[<span class="symbol">root@</span>spider01 ~]# rm -rf /usr/bin/chromium-browser</span><br><span class="line"></span><br><span class="line">[<span class="symbol">root@</span>spider01 ~]# ln -s /usr/bin/xvfb-chromium /usr/bin/chromium-browser</span><br><span class="line"></span><br><span class="line">[<span class="symbol">root@</span>spider01 ~]# ln -s /usr/bin/xvfb-chromium /usr/bin/google-chrome</span><br><span class="line"></span><br><span class="line">[<span class="symbol">root@</span>spider01 ~]# ll /usr/bin/ | grep chrom*</span><br><span class="line">-rwxrwxrwx. <span class="number">1</span> root root   <span class="number">7500280</span> <span class="number">11</span>月 <span class="number">29</span> <span class="number">17</span>:<span class="number">32</span> chromedriver</span><br><span class="line">lrwxrwxrwx. <span class="number">1</span> root root        <span class="number">47</span> <span class="number">11</span>月 <span class="number">30</span> <span class="number">09</span>:<span class="number">47</span> chromium -&gt; /usr/lib64/chromium-browser/chromium-browser.sh</span><br><span class="line">lrwxrwxrwx. <span class="number">1</span> root root        <span class="number">22</span> <span class="number">11</span>月 <span class="number">30</span> <span class="number">09</span>:<span class="number">48</span> chromium-browser -&gt; /usr/bin/xvfb-chromium</span><br><span class="line">-rwxr-xr-x. <span class="number">1</span> root root     <span class="number">73848</span> <span class="number">12</span>月  <span class="number">7</span> <span class="number">2016</span> chronyc</span><br><span class="line">lrwxrwxrwx. <span class="number">1</span> root root        <span class="number">22</span> <span class="number">11</span>月 <span class="number">30</span> <span class="number">09</span>:<span class="number">48</span> google-chrome -&gt; /usr/bin/xvfb-chromium</span><br><span class="line">-rwxrwxrwx. <span class="number">1</span> root root       <span class="number">387</span> <span class="number">11</span>月 <span class="number">29</span> <span class="number">18</span>:<span class="number">16</span> xvfb-chromium</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>来瞅瞅能不能用哦：</p>
                  <figure class="highlight ruby">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">&gt;&gt;</span>&gt; from selenium import webdriver</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; options = webdriver.ChromeOptions()</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; options.add_argument(<span class="string">'--headless'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; options.add_argument(<span class="string">'--no-sandbox'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; options.add_argument(<span class="string">'--disable-extensions'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; options.add_argument(<span class="string">'--disable-gpu'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; driver = webdriver.Chrome(options=options)</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; driver.get(<span class="string">"http://www.baidu.com"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; driver.find_element_by_xpath(<span class="string">"./*//input[@id='kw']"</span>).send_keys(<span class="string">"哎哟卧槽"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; driver.find_element_by_xpath(<span class="string">"./*//input[@id='su']"</span>).click()</span><br><span class="line"><span class="meta">&gt;&gt;</span>&gt; driver.page_source</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><a href="http://cdn.cuiqingcai.com/wp-content/uploads/2016/10/QQ图片20161021223818.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2016/10/QQ图片20161021223818.jpg" alt=""></a><strong>No problem！！！！</strong> 好了部署完了！当然 Docker 这么火贼适合懒人了！来来 看这儿 Docker 版的 妥妥滴！</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">docker pull thsheep/python:<span class="number">3.7</span>-debian-chrome</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>做好了 Python3.7 和 Chrome 集成 需要自己使用 Dockerfile 来重新打包安装你需要的 Python 包。</p>
                  <h3 id="Note-请按照以下方式初始化-Webdriver！！！！！！！！"><a href="#Note-请按照以下方式初始化-Webdriver！！！！！！！！" class="headerlink" title="Note: 请按照以下方式初始化 Webdriver！！！！！！！！"></a><strong>Note: 请按照以下方式初始化 Webdriver！！！！！！！！</strong></h3>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from selenium import webdriver</span><br><span class="line"></span><br><span class="line">options = webdriver.<span class="constructor">ChromeOptions()</span></span><br><span class="line">options.add<span class="constructor">_argument('--<span class="params">headless</span>')</span></span><br><span class="line">options.add<span class="constructor">_argument('--<span class="params">no</span>-<span class="params">sandbox</span>')</span></span><br><span class="line">options.add<span class="constructor">_argument('--<span class="params">disable</span>-<span class="params">extensions</span>')</span></span><br><span class="line">options.add<span class="constructor">_argument('--<span class="params">disable</span>-<span class="params">gpu</span>')</span></span><br><span class="line"></span><br><span class="line">driver = webdriver.<span class="constructor">Chrome(<span class="params">options</span>=<span class="params">options</span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="否则会出现无法初始化-Webdriver-的情况"><a href="#否则会出现无法初始化-Webdriver-的情况" class="headerlink" title="否则会出现无法初始化 Webdriver 的情况"></a>否则会出现无法初始化 Webdriver 的情况</h2>
                  <h2 id="顺便一提！！！！这个玩意儿从事-Web-测试工作的小伙伴可以用！！！！！！！！"><a href="#顺便一提！！！！这个玩意儿从事-Web-测试工作的小伙伴可以用！！！！！！！！" class="headerlink" title="顺便一提！！！！这个玩意儿从事 Web 测试工作的小伙伴可以用！！！！！！！！"></a>顺便一提！！！！这个玩意儿从事 Web 测试工作的小伙伴可以用！！！！！！！！</h2>
                  <p>下面是 Dockerfile 文件：</p>
                  <figure class="highlight jboss-cli">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">FROM python<span class="function">:3.7-stretch</span></span><br><span class="line"></span><br><span class="line">ENV DBUS_SESSION_BUS_ADDRESS=<span class="string">/dev/null</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#============================================</span></span><br><span class="line"><span class="comment"># Google Chrome</span></span><br><span class="line"><span class="comment">#============================================</span></span><br><span class="line">RUN wget -q -O - https:<span class="string">//dl-ssl.google.com/linux/linux_signing_key.pub</span> | apt-key add - &amp;&amp; \</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"deb http://dl.google.com/linux/chrome/deb/ stable main"</span> &gt;&gt; <span class="string">/etc/apt/sources.list.d/google-chrome.list</span> &amp;&amp; \</span><br><span class="line">apt-get update -qqy &amp;&amp; \</span><br><span class="line">apt-get -qqy install google-chrome-stable unzip&amp;&amp; \</span><br><span class="line">rm <span class="string">/etc/apt/sources.list.d/google-chrome.list</span> &amp;&amp; \</span><br><span class="line">rm -rf <span class="string">/var/lib/apt/lists/</span>* <span class="string">/var/cache/apt/</span>*</span><br><span class="line"></span><br><span class="line"><span class="comment">#==================</span></span><br><span class="line"><span class="comment"># Chrome driver</span></span><br><span class="line"><span class="comment"># CHROME_DRIVER_VERSION 需要根据上面安装的Chrome版本来设置（最好设置成最新版本）</span></span><br><span class="line"><span class="comment"># http://chromedriver.chromium.org/downloads 版本号在这页面上查看</span></span><br><span class="line"><span class="comment">#==================</span></span><br><span class="line">ARG CHROME_DRIVER_VERSION=2.45</span><br><span class="line">RUN wget -O <span class="string">/tmp/chromedriver.zip</span> https:<span class="string">//chromedriver.storage.googleapis.com/</span>$CHROME_DRIVER_VERSION/chromedriver_linux64.zip &amp;&amp; \</span><br><span class="line">rm -rf <span class="string">/opt/selenium/chromedriver</span> &amp;&amp; \</span><br><span class="line">unzip <span class="string">/tmp/chromedriver.zip</span> -d <span class="string">/opt/selenium</span> &amp;&amp; \</span><br><span class="line">rm <span class="string">/tmp/chromedriver.zip</span> &amp;&amp; \</span><br><span class="line">mv <span class="string">/opt/selenium/chromedriver</span> <span class="string">/opt/selenium/chromedriver-</span>$CHROME_DRIVER_VERSION &amp;&amp; \</span><br><span class="line">chmod 755 <span class="string">/opt/selenium/chromedriver-</span>$CHROME_DRIVER_VERSION &amp;&amp; \</span><br><span class="line">ln -fs <span class="string">/opt/selenium/chromedriver-</span>$CHROME_DRIVER_VERSION <span class="string">/usr/bin/chromedriver</span></span><br><span class="line"></span><br><span class="line">RUN google-chrome-stable <span class="params">--version</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/哎哟卧槽" class="author" itemprop="url" rel="index">哎哟卧槽</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2017-11-30 10:32:12" itemprop="dateCreated datePublished" datetime="2017-11-30T10:32:12+08:00">2017-11-30</time>
                </span>
                <span id="/4886.html" class="post-meta-item leancloud_visitors" data-flag-title="小白学爬虫-在无GUI的CentOS上使用Selenium+Chrome" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>4.7k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>4 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/4880.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/4880.html" class="post-title-link" itemprop="url">小白学爬虫-设置Selenium+Chrome代理</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p><a href="http://cdn.cuiqingcai.com/wp-content/uploads/2016/11/20160124759183737.gif" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2016/11/20160124759183737.gif" alt=""></a> 微博登录限制了错误次数···加上 Cookie 大批账号被封需要从 Cookie 池中 剔除被封的账号··· 需要使用代理··· 无赖百度了大半天都是特么的啥玩意儿？？？结果换成了 Google 手到擒来 分分钟解决（那么问题来了？百度除了卖假药还会干啥？） <strong>Selenium+Chrome 认证代理不能通过 options 处理。只能换个方法使用扩展解决</strong> 原文地址：<a href="https://stackoverflow.com/questions/29983106/how-can-i-set-proxy-with-authentication-in-selenium-chrome-web-driver-using-pyth#answer-30953780" target="_blank" rel="noopener">https://stackoverflow.com/questions/29983106/how-can-i-set-proxy-with-authentication-in-selenium-chrome-web-driver-using-pyth#answer-30953780</a> （Stack Overflow 这是个好地方啊） <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2016/10/9555112.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2016/10/9555112.jpg" alt=""></a> 走你！</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time    : 2017/11/15 9:50</span></span><br><span class="line"><span class="comment"># @Author  : 哎哟卧槽</span></span><br><span class="line"><span class="comment"># @Site    :</span></span><br><span class="line"><span class="comment"># @File    : pubilc.py</span></span><br><span class="line"><span class="comment"># @Software: PyCharm</span></span><br><span class="line"></span><br><span class="line">import string</span><br><span class="line">import zipfile</span><br><span class="line"></span><br><span class="line">def create_proxyauth_extension(proxy_host, proxy_port,</span><br><span class="line">                               proxy_username, proxy_password,</span><br><span class="line">                               <span class="attribute">scheme</span>=<span class="string">'http'</span>, <span class="attribute">plugin_path</span>=None):</span><br><span class="line">    <span class="string">""</span><span class="string">"代理认证插件</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    args:</span></span><br><span class="line"><span class="string">        proxy_host (str): 你的代理地址或者域名（str类型）</span></span><br><span class="line"><span class="string">        proxy_port (int): 代理端口号（int类型）</span></span><br><span class="line"><span class="string">        proxy_username (str):用户名（字符串）</span></span><br><span class="line"><span class="string">        proxy_password (str): 密码 （字符串）</span></span><br><span class="line"><span class="string">    kwargs:</span></span><br><span class="line"><span class="string">        scheme (str): 代理方式 默认http</span></span><br><span class="line"><span class="string">        plugin_path (str): 扩展的绝对路径</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    return str -&gt; plugin_path</span></span><br><span class="line"><span class="string">    "</span><span class="string">""</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> plugin_path is None:</span><br><span class="line">        plugin_path = <span class="string">'vimm_chrome_proxyauth_plugin.zip'</span></span><br><span class="line"></span><br><span class="line">    manifest_json = <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">        "</span>version<span class="string">": "</span>1.0.0<span class="string">",</span></span><br><span class="line"><span class="string">        "</span>manifest_version<span class="string">": 2,</span></span><br><span class="line"><span class="string">        "</span>name<span class="string">": "</span>Chrome Proxy<span class="string">",</span></span><br><span class="line"><span class="string">        "</span>permissions<span class="string">": [</span></span><br><span class="line"><span class="string">            "</span>proxy<span class="string">",</span></span><br><span class="line"><span class="string">            "</span>tabs<span class="string">",</span></span><br><span class="line"><span class="string">            "</span>unlimitedStorage<span class="string">",</span></span><br><span class="line"><span class="string">            "</span>storage<span class="string">",</span></span><br><span class="line"><span class="string">            "</span>&lt;all_urls&gt;<span class="string">",</span></span><br><span class="line"><span class="string">            "</span>webRequest<span class="string">",</span></span><br><span class="line"><span class="string">            "</span>webRequestBlocking<span class="string">"</span></span><br><span class="line"><span class="string">        ],</span></span><br><span class="line"><span class="string">        "</span>background<span class="string">": &#123;</span></span><br><span class="line"><span class="string">            "</span>scripts<span class="string">": ["</span>background.js<span class="string">"]</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        "</span>minimum_chrome_version<span class="string">":"</span>22.0.0<span class="string">"</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    "</span><span class="string">""</span></span><br><span class="line"></span><br><span class="line">    background_js = string.Template(</span><br><span class="line">    <span class="string">""</span><span class="string">"</span></span><br><span class="line"><span class="string">    var config = &#123;</span></span><br><span class="line"><span class="string">            mode: "</span>fixed_servers<span class="string">",</span></span><br><span class="line"><span class="string">            rules: &#123;</span></span><br><span class="line"><span class="string">              singleProxy: &#123;</span></span><br><span class="line"><span class="string">                scheme: "</span><span class="variable">$&#123;scheme&#125;</span><span class="string">",</span></span><br><span class="line"><span class="string">                host: "</span><span class="variable">$&#123;host&#125;</span><span class="string">",</span></span><br><span class="line"><span class="string">                port: parseInt(<span class="variable">$&#123;port&#125;</span>)</span></span><br><span class="line"><span class="string">              &#125;,</span></span><br><span class="line"><span class="string">              bypassList: ["</span>foobar.com<span class="string">"]</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">          &#125;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    chrome.proxy.settings.set(&#123;value: config, scope: "</span>regular<span class="string">"&#125;, function() &#123;&#125;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    function callbackFn(details) &#123;</span></span><br><span class="line"><span class="string">        return &#123;</span></span><br><span class="line"><span class="string">            authCredentials: &#123;</span></span><br><span class="line"><span class="string">                username: "</span><span class="variable">$&#123;username&#125;</span><span class="string">",</span></span><br><span class="line"><span class="string">                password: "</span><span class="variable">$&#123;password&#125;</span><span class="string">"</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        &#125;;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    chrome.webRequest.onAuthRequired.addListener(</span></span><br><span class="line"><span class="string">                callbackFn,</span></span><br><span class="line"><span class="string">                &#123;urls: ["</span>&lt;all_urls&gt;<span class="string">"]&#125;,</span></span><br><span class="line"><span class="string">                ['blocking']</span></span><br><span class="line"><span class="string">    );</span></span><br><span class="line"><span class="string">    "</span><span class="string">""</span></span><br><span class="line">    ).substitute(</span><br><span class="line">        <span class="attribute">host</span>=proxy_host,</span><br><span class="line">        <span class="attribute">port</span>=proxy_port,</span><br><span class="line">        <span class="attribute">username</span>=proxy_username,</span><br><span class="line">        <span class="attribute">password</span>=proxy_password,</span><br><span class="line">        <span class="attribute">scheme</span>=scheme,</span><br><span class="line">    )</span><br><span class="line">    with zipfile.ZipFile(plugin_path, <span class="string">'w'</span>) as zp:</span><br><span class="line">        zp.writestr(<span class="string">"manifest.json"</span>, manifest_json)</span><br><span class="line">        zp.writestr(<span class="string">"background.js"</span>, background_js)</span><br><span class="line"></span><br><span class="line">    return plugin_path</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>使用方法：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> selenium import webdriver</span><br><span class="line"><span class="keyword">from</span> common.pubilc import create_proxyauth_extension</span><br><span class="line"></span><br><span class="line">proxyauth_plugin_path = create_proxyauth_extension(</span><br><span class="line">    <span class="attribute">proxy_host</span>=<span class="string">"XXXXX.com"</span>,</span><br><span class="line">    <span class="attribute">proxy_port</span>=9020,</span><br><span class="line">    <span class="attribute">proxy_username</span>=<span class="string">"XXXXXXX"</span>,</span><br><span class="line">    <span class="attribute">proxy_password</span>=<span class="string">"XXXXXXX"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">co = webdriver.ChromeOptions()</span><br><span class="line"><span class="comment"># co.add_argument("--start-maximized")</span></span><br><span class="line">co.add_extension(proxyauth_plugin_path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome(<span class="attribute">executable_path</span>=<span class="string">"C:\chromedriver.exe"</span>, <span class="attribute">chrome_options</span>=co)</span><br><span class="line">driver.<span class="builtin-name">get</span>(<span class="string">"http://ip138.com/"</span>)</span><br><span class="line"><span class="builtin-name">print</span>(driver.page_source)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>无认证代理：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">options = webdriver.<span class="constructor">ChromeOptions()</span></span><br><span class="line">options.add<span class="constructor">_argument('--<span class="params">proxy</span>-<span class="params">server</span>=<span class="params">http</span>:<span class="operator">/</span><span class="operator">/</span><span class="params">ip</span>:<span class="params">port</span>')</span></span><br><span class="line">driver = webdriver.<span class="constructor">Chrome(<span class="params">executable_path</span>=<span class="string">"C:\chromedriver.exe"</span>, <span class="params">chrome_options</span>=0ptions)</span></span><br><span class="line">driver.get(<span class="string">"http://ip138.com/"</span>)</span><br><span class="line">print(driver.page_source)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上完毕 So Easy</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/哎哟卧槽" class="author" itemprop="url" rel="index">哎哟卧槽</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2017-11-18 11:13:54" itemprop="dateCreated datePublished" datetime="2017-11-18T11:13:54+08:00">2017-11-18</time>
                </span>
                <span id="/4880.html" class="post-meta-item leancloud_visitors" data-flag-title="小白学爬虫-设置Selenium+Chrome代理" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.9k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/4853.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/4853.html" class="post-title-link" itemprop="url">一个采集系统的构建</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>整个系统: <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2017/10/WX20171017-225541.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2017/10/WX20171017-225541.png" alt=""></a> 采集系统： <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2017/10/WX20171017-225831.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2017/10/WX20171017-225831.png" alt=""></a></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/哎哟卧槽" class="author" itemprop="url" rel="index">哎哟卧槽</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2017-10-17 23:00:23" itemprop="dateCreated datePublished" datetime="2017-10-17T23:00:23+08:00">2017-10-17</time>
                </span>
                <span id="/4853.html" class="post-meta-item leancloud_visitors" data-flag-title="一个采集系统的构建" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>10</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/4833.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Java <i class="label-arrow"></i>
                  </a>
                  <a href="/4833.html" class="post-title-link" itemprop="url">java基础之数据类型</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p><strong><strong>PS：此文章为小白提供，大佬请绕道！！！！</strong></strong> <strong>首先特别感谢大才哥给我提供这个平台，未来我希望把java这个版块的内容补全。</strong> 今天要讲的是数据类型，最最最基础的内容~ java标识符、数据类型、关键字 开始我们先看下如何注释java代码。 标识符：类名，方法名，变量。 有三种方式分别为 //表示注释一行代码 /<em> 表示注释一行或者多行代码 (从上面到下面都是注释的代码） </em>/ 下面还有一种注释方式叫做文档注释。 /<strong> 通常这样表示 */ 文档注释一般写在代码开头用来简述你所做程序的具体内容，在这之前我们首先看一下javadoc命令，我先编写一个简答的代码： package com.briup.chap02; /</strong> @author Twinkle @version 1.0 It’s a text file <em>/ public class PrimitiveType{ public static void main(String[] args){ byte b = 123; byte b1 = 300; } } 我们javadoc -d 生成目录 编译文件 编译成功后，我们打开刚刚生成doc里打开index.html看一下，大概是这样的： 类概要 类： Student 说明： It’s a text file 这样我们就可以看出文档注释的意义了，他可以显示在你编译出来文档的说明里，但有人会发现为啥我们编写出来的author没有出来呀？ 因为他的最前面有一个@，我们需要编写的时候把它加上去才能显示出来，现在我们来试一下， —javadoc -d bin/doc-author -version src/PrimitiveType.java，这样作者和版本信息就出来了 一.类名 这边我们要记住一些代码的基本格式： 类名的写法：Student（前面首字母要大写） 方法和变量的写法：genderItem（前面单词小写，后面单词开头要大写） 常量写法：MAX_PAGE（常量大写，中间一般加下划线） 二.关键字 关键字其实就是电脑里面已经定义好的有特殊意义的标识符，像int,for，double什么的都是关键字。具体意思请百度一下～ 三.数据类型 数据类型是这篇文章的重点，我们来看下这些基本的数据类型 类型 二进制位 例 范围 byte 8位 11111111～01111111 -2^7~2^7-1 short 16位 16个二进制代码 -2^15~2^15-1 int 32位 32个二进制代码 -2^31~2^31-1 long 64位 64个二进制代码 -2^63~2^63-1 浮点型: float 32位 32个二进制代码 double 64位 64个二进制代码 布尔型： boolean 只有false和true两种类型。 具体解释一下为什么会有这么多类型呢？而且二进制位为什么还不一样？ 类型多的原因是因为有些数值本身就很小，传递给大的数据类型的话，虽然可以进去，但是有些二进制位就空闲了，占用了多余的内存却没有什么作用，所以才会有这么多的类型。 我们知道编程最终的目的是我们把代码传递给硬件，通过硬件来工作，但是呢，硬件只识别二进制代码，所以java会有一个把它的代码转化为二进制代码的过渡，上面的二进制位就是二进制码的数目，我们要想看他的范围有多大，可以这样算，二进制的第一位为标志符，通俗一点讲就是正负号，后面还有n位的话它的范围就是-|2^n|～|2^n-1| 如果我们定义的类型超出这个范围的话(也就是盆子里已经装满了东西如果再加），java就会报错，超出指定的范围，所以当我们定义数据类型的时候要搞清楚各数据类型的范围。 还有一个特殊的数据类型：char (‘字符’) char的具体位数要结合unicode编码。问题又来了,unicode编码又是什么鬼！unicode编码是一个字符集，里面包含了中，日，韩，三种文字，我们可以通过char的方法来打印出字符:char(‘u\unicode编码’)，unicode表具体百度一下哈～ 数据类型转换： 显式转换：也就是强制转换 隐式转换：由JVM虚拟机自行转换 数据类型的强制转换：int a = (强制转换类型)b 转换规则:从存储范围大的类型到存储范围小的类型。 具体规则为：double→float→long→int→short(char)→byte byte b =10; byte a = (int) b; 如果我们把int类型的b转换给byte类型的a的话，会出现溢出现象，所以会报错。 所以正确强制转换的方式为～～： byte b = 10; int（或者更大的类型） a =(int) b; java基本的数据类型就讲到这里啦~ <em>*--可能发布的内容有点混乱，我会尽快把前面的补齐~有疑问的话可以到大才哥的群里找我哈~</em></em></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/Twinkle" class="author" itemprop="url" rel="index">Twinkle</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2017-09-27 18:17:06" itemprop="dateCreated datePublished" datetime="2017-09-27T18:17:06+08:00">2017-09-27</time>
                </span>
                <span id="/4833.html" class="post-meta-item leancloud_visitors" data-flag-title="java基础之数据类型" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.9k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/4826.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 未分类 <i class="label-arrow"></i>
                  </a>
                  <a href="/4826.html" class="post-title-link" itemprop="url">小白进阶第七篇（Splash负载均衡）</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>对于 Scrapy 处理 Ajax 处理方式当然是同家兄弟 Splash 比较靠谱！ 但是 Splash 有个很坑爹的毛病就是负载承受相对较小·· 一不留神就 GG 了·········· 然后也就没有然后了~~！ 所以准备给 Splash 做一个负载均衡；后端放一大堆的 Splash 这样总不会 GG 了吧。 就算其中一个 GG 了还有其它的可替代不是？ 废话不多少开整·· 环境是基于： CentOS 7.3 Docker 17.06.2-ce Splash 3.0 HAproxy 1.7.9 （CentOS 大家可以将 yum 切换为阿里云的 yum 源 Docker 同理）</p>
                  <h4 id="阿里-yum-源：-http-mirrors-aliyun-com-help-centos-照葫芦画瓢做一遍（你是-CentOS7-啊！！！！不要选成其他版本了）"><a href="#阿里-yum-源：-http-mirrors-aliyun-com-help-centos-照葫芦画瓢做一遍（你是-CentOS7-啊！！！！不要选成其他版本了）" class="headerlink" title="阿里 yum 源： http://mirrors.aliyun.com/help/centos  照葫芦画瓢做一遍（你是 CentOS7 啊！！！！不要选成其他版本了）"></a>阿里 yum 源： <a href="http://mirrors.aliyun.com/help/centos" target="_blank" rel="noopener">http://mirrors.aliyun.com/help/centos</a> 照葫芦画瓢做一遍（你是 CentOS7 啊！！！！不要选成其他版本了）</h4>
                  <h2 id="注意以下只需要在你需要运行-splash-的机器上安装即可"><a href="#注意以下只需要在你需要运行-splash-的机器上安装即可" class="headerlink" title="注意以下只需要在你需要运行 splash 的机器上安装即可"></a><strong>注意以下只需要在你需要运行 splash 的机器上安装即可</strong></h2>
                  <h4 id="阿里-Docker-源："><a href="#阿里-Docker-源：" class="headerlink" title="阿里 Docker 源："></a>阿里 Docker 源：</h4>
                  <figure class="highlight sql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># step 1: 安装必要的一些系统工具</span></span><br><span class="line"></span><br><span class="line">sudo yum <span class="keyword">install</span> -y yum-utils device-mapper-persistent-<span class="keyword">data</span> lvm2</span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 2: 添加软件源信息</span></span><br><span class="line"></span><br><span class="line">sudo yum-config-manager <span class="comment">--add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 3: 更新并安装 Docker-CE</span></span><br><span class="line"></span><br><span class="line">sudo yum makecache <span class="keyword">fast</span></span><br><span class="line">sudo yum -y <span class="keyword">install</span> docker-ce</span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 4: 开启Docker服务</span></span><br><span class="line"></span><br><span class="line">sudo service docker <span class="keyword">start</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h4 id="安装-Docker-加速器："><a href="#安装-Docker-加速器：" class="headerlink" title="安装 Docker 加速器："></a>安装 Docker 加速器：</h4>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl -sSL http<span class="variable">s:</span>//<span class="built_in">get</span>.daocloud.io/daotools/set_mirror.<span class="keyword">sh</span> | <span class="keyword">sh</span> -s http://<span class="number">8050</span>f360.<span class="keyword">m</span>.daocloud.io</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h4 id="重启-Docker："><a href="#重启-Docker：" class="headerlink" title="重启 Docker："></a>重启 Docker：</h4>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">systemctl restart docker</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样可以极快的速度拉取镜像。 获取 splash 最新的 docker 镜像：</p>
                  <figure class="highlight crmsh">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">docker pull scrapinghub/splash:<span class="literal">master</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h4 id="关闭所有机器防火墙-firewalld-网络安全的环境关闭，不安全的环境请放行端口，自行百度"><a href="#关闭所有机器防火墙-firewalld-网络安全的环境关闭，不安全的环境请放行端口，自行百度" class="headerlink" title="关闭所有机器防火墙 firewalld(网络安全的环境关闭，不安全的环境请放行端口，自行百度):"></a>关闭所有机器防火墙 firewalld(网络安全的环境关闭，不安全的环境请放行端口，自行百度):</h4>
                  <figure class="highlight gauss">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">systemctl <span class="keyword">disable</span> firewalld</span><br><span class="line"></span><br><span class="line">systemctl <span class="keyword">stop</span> firewalld</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h4 id="创建-Splash-配置文件目录："><a href="#创建-Splash-配置文件目录：" class="headerlink" title="创建 Splash 配置文件目录："></a>创建 Splash 配置文件目录：</h4>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"># 存放过滤规则文件的目录</span><br><span class="line"></span><br><span class="line">[<span class="symbol">root@</span>localhost ~]# mkdir filters</span><br><span class="line"></span><br><span class="line"># 存放JavaScript文件目录</span><br><span class="line"></span><br><span class="line">[<span class="symbol">root@</span>localhost ~]# mkdir js-profiles</span><br><span class="line"></span><br><span class="line"># 存放lua模块的目录</span><br><span class="line"></span><br><span class="line">[<span class="symbol">root@</span>localhost ~]# mkdir lua_modules</span><br><span class="line"></span><br><span class="line"># 存放代理文件的目录</span><br><span class="line"></span><br><span class="line">[<span class="symbol">root@</span>localhost ~]# mkdir proxy-profiles</span><br><span class="line"></span><br><span class="line"># 创建完成如下：</span><br><span class="line"></span><br><span class="line">[<span class="symbol">root@</span>localhost ~]# pwd</span><br><span class="line">/root</span><br><span class="line">[<span class="symbol">root@</span>localhost ~]# ll</span><br><span class="line">total <span class="number">4</span></span><br><span class="line">drwxr-xr-x. <span class="number">2</span> root root   <span class="number">25</span> Sep <span class="number">26</span> <span class="number">03</span>:<span class="number">00</span> filters</span><br><span class="line">drwxr-xr-x. <span class="number">2</span> root root    <span class="number">6</span> Sep <span class="number">25</span> <span class="number">21</span>:<span class="number">08</span> js-profiles</span><br><span class="line">drwxr-xr-x. <span class="number">2</span> root root    <span class="number">6</span> Sep <span class="number">25</span> <span class="number">21</span>:<span class="number">08</span> lua_modules</span><br><span class="line">drwxr-xr-x. <span class="number">2</span> root root   <span class="number">32</span> Sep <span class="number">25</span> <span class="number">21</span>:<span class="number">08</span> proxy-profiles</span><br><span class="line">[<span class="symbol">root@</span>localhost ~]#</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h4 id="启动-Splash："><a href="#启动-Splash：" class="headerlink" title="启动 Splash："></a>启动 Splash：</h4>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">docker run -d -p <span class="number">8050</span>:<span class="number">8050</span> --memory=<span class="number">5.0</span>G --restart=always  --name splash       -v <span class="regexp">/root/</span>proxy-<span class="string">profiles:</span><span class="regexp">/etc/</span>splash<span class="regexp">/proxy-profiles       -v /</span>root<span class="regexp">/js-profiles:/</span>etc<span class="regexp">/splash/</span>js-profiles       -v <span class="regexp">/root/</span><span class="string">lua_modules:</span><span class="regexp">/etc/</span>splash<span class="regexp">/lua_modules       -v /</span>root<span class="regexp">/filters:/</span>etc<span class="regexp">/splash/</span>filters       scrapinghub/<span class="string">splash:</span>master --maxrss <span class="number">4500</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>docker run 启动一个容器 -d 后台启动 -p 8050:8050 将容器的 8050 端口和物理机的 8050 端口绑定（可以从 8050 端口访问容器服务应用） —memory=5.0G 容器最大使用内存为 5.0GB，超出这个限制会被主进程杀死（使用 free -mg 查看并酌情设置你的内存使用） —restart=always 容器退出后无条件重启（满了 5GB 被杀死，然后重启 释放内存） —name splash 容器的名字叫 splash（可以忽略） -v <strong>**</strong> 三个-v 参数是将宿主机的目录挂载进容器，便于容器能够直接访问挂载目录中的内容 scrapinghub/splash:master 用于启动容器的镜像 —maxrss 4500 Splash 最大内存使用为 4500MB</p>
                  <h4 id="查看容器是否启动："><a href="#查看容器是否启动：" class="headerlink" title="查看容器是否启动："></a>查看容器是否启动：</h4>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[<span class="symbol">root@</span>localhost ~]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE                       COMMAND                  CREATED             STATUS              PORTS                              NAMES</span><br><span class="line"><span class="number">1</span>b34f7933095        scrapinghub/splash:master   <span class="string">"python3 /app/bin/..."</span>   <span class="number">4</span> hours ago         Up <span class="number">4</span> hours          <span class="number">5023</span>/tcp, <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">8050</span>-&gt;<span class="number">8050</span>/tcp   splash</span><br><span class="line">[<span class="symbol">root@</span>localhost ~]#</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h4 id="访问-Splash-是否正常工作："><a href="#访问-Splash-是否正常工作：" class="headerlink" title="访问 Splash 是否正常工作："></a>访问 Splash 是否正常工作：</h4>
                  <p><a href="http://cdn.cuiqingcai.com/wp-content/uploads/2017/09/测试.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2017/09/测试.png" alt=""></a></p>
                  <h2 id="请注意：以上操作只需要在你需要运行-splash-的机器上安装即可"><a href="#请注意：以上操作只需要在你需要运行-splash-的机器上安装即可" class="headerlink" title="请注意：以上操作只需要在你需要运行 splash 的机器上安装即可"></a><strong>请注意：以上操作只需要在你需要运行 splash 的机器上安装即可</strong></h2>
                  <h1 id="安装-HAproxy-实现负载均衡："><a href="#安装-HAproxy-实现负载均衡：" class="headerlink" title="安装 HAproxy 实现负载均衡："></a>安装 HAproxy 实现负载均衡：</h1>
                  <h4 id="安装-zlib-devel（HAproxy-使用-gzip-功能）："><a href="#安装-zlib-devel（HAproxy-使用-gzip-功能）：" class="headerlink" title="安装 zlib-devel（HAproxy 使用 gzip 功能）："></a>安装 zlib-devel（HAproxy 使用 gzip 功能）：</h4>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">yum <span class="keyword">install</span> zlib-devel -y</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h4 id="安装-HAproxy："><a href="#安装-HAproxy：" class="headerlink" title="安装 HAproxy："></a>安装 HAproxy：</h4>
                  <figure class="highlight autoit">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta"># 个人喜好 源码放在这个目录</span></span><br><span class="line">[root<span class="symbol">@localhost</span> examples]<span class="meta"># cd /usr/local/src/</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 安装wget</span></span><br><span class="line">[root<span class="symbol">@localhost</span> src]<span class="meta">#yum install wget -y</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 下载HAproxy安装包</span></span><br><span class="line">[root<span class="symbol">@localhost</span> src]<span class="meta"># wget http://www.haproxy.org/download/1.7/src/haproxy-1.7.9.tar.gz</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 解压</span></span><br><span class="line">[root<span class="symbol">@localhost</span> src]<span class="meta"># tar -zxvf haproxy-1.7.9.tar.gz</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 进入目录</span></span><br><span class="line">[root<span class="symbol">@localhost</span> src]<span class="meta"># cd haproxy-1.7.9</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 编译</span></span><br><span class="line">[root<span class="symbol">@localhost</span> src]<span class="meta"># make TARGET=linux2628 PREFIX=/usr/local/haproxy-1.7.9 USE_ZLIB=yes</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 安装</span></span><br><span class="line">[root<span class="symbol">@localhost</span> src]<span class="meta"># make install</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 拷贝启动文件到目录</span></span><br><span class="line">[root<span class="symbol">@localhost</span> src]<span class="meta"># cp /usr/local/sbin/haproxy /usr/sbin/</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 测试版本</span></span><br><span class="line">[root<span class="symbol">@localhost</span> src]<span class="meta"># haproxy -v</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 拷贝启动文件到启动目录</span></span><br><span class="line">[root<span class="symbol">@localhost</span> src]<span class="meta"># cp examples/haproxy.init /etc/init.d/haproxy</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 赋予可执行权限</span></span><br><span class="line">[root<span class="symbol">@localhost</span> src]<span class="meta"># chmod 755 /etc/init.d/haproxy</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 创建配置文件目录</span></span><br><span class="line">[root<span class="symbol">@localhost</span> src]<span class="meta"># mkdir /etc/haproxy</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 创建数据目录</span></span><br><span class="line">[root<span class="symbol">@localhost</span> src]<span class="meta"># mkdir /var/lib/haproxy</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 创建运行文件目录</span></span><br><span class="line">[root<span class="symbol">@localhost</span> src]<span class="meta"># mkdir /var/run/haproxy</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 设置日志</span></span><br><span class="line">[root<span class="symbol">@localhost</span> src]<span class="meta"># vim /etc/rsyslog.conf</span></span><br><span class="line"><span class="meta"># 第15行  $ModLoad imudp #打开注释</span></span><br><span class="line"><span class="meta"># 第16行  $UDPServerRun 514 #打开注释</span></span><br><span class="line"><span class="meta"># 第74行  local3.* /var/log/haproxy.log #local3的路径</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 创建日志文件</span></span><br><span class="line">[root<span class="symbol">@localhost</span> src]<span class="meta"># touch /var/log/haproxy.log</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 设置权限</span></span><br><span class="line">[root<span class="symbol">@localhost</span> src]<span class="meta">#  chown -R haproxy.haproxy /var/log/haproxy.log</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 启动日志服务</span></span><br><span class="line">[root<span class="symbol">@localhost</span> src]<span class="meta"># systemctl restart rsyslog.service</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h4 id="配置-HAproxy-Conf："><a href="#配置-HAproxy-Conf：" class="headerlink" title="配置 HAproxy Conf："></a>配置 HAproxy Conf：</h4>
                  <figure class="highlight autoit">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[root<span class="symbol">@localhost</span> src]<span class="meta"># vim /etc/haproxy/haproxy.cfg</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>写入以下内容：</p>
                  <figure class="highlight properties">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># HAProxy 1.7 config for Splash. It assumes Splash instances are executed</span></span><br><span class="line"><span class="comment"># on the same machine and connected to HAProxy using Docker links.</span></span><br><span class="line"><span class="attr">global</span></span><br><span class="line"><span class="comment">    # raise it if necessary</span></span><br><span class="line">    <span class="attr">maxconn</span> <span class="string">512</span></span><br><span class="line"><span class="comment">    # required for stats page</span></span><br><span class="line">    <span class="attr">stats</span> <span class="string">socket /tmp/haproxy</span></span><br><span class="line"></span><br><span class="line"><span class="attr">userlist</span> <span class="string">users</span></span><br><span class="line">    <span class="attr">user</span> <span class="string">user insecure-password userpass</span></span><br><span class="line"></span><br><span class="line"><span class="attr">defaults</span></span><br><span class="line">    <span class="attr">log</span> <span class="string">global</span></span><br><span class="line">    <span class="attr">mode</span> <span class="string">http</span></span><br><span class="line"></span><br><span class="line"><span class="comment">    # remove requests from a queue when clients disconnect;</span></span><br><span class="line"><span class="comment">    # see https://cbonte.github.io/haproxy-dconv/1.7/configuration.html#4.2-option%20abortonclose</span></span><br><span class="line">    <span class="attr">option</span> <span class="string">abortonclose</span></span><br><span class="line"></span><br><span class="line"><span class="comment">    # gzip can save quite a lot of traffic with json, html or base64 data</span></span><br><span class="line"><span class="comment">    # compression algo gzip</span></span><br><span class="line">    <span class="attr">compression</span> <span class="string">type text/html text/plain application/json</span></span><br><span class="line"></span><br><span class="line"><span class="comment">    # increase these values if you want to</span></span><br><span class="line"><span class="comment">    # allow longer request queues in HAProxy</span></span><br><span class="line">    <span class="attr">timeout</span> <span class="string">connect 3600s</span></span><br><span class="line">    <span class="attr">timeout</span> <span class="string">client 3600s</span></span><br><span class="line">    <span class="attr">timeout</span> <span class="string">server 3600s</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># visit 0.0.0.0:8036 to see HAProxy stats page</span></span><br><span class="line"><span class="attr">listen</span> <span class="string">stats</span></span><br><span class="line">    <span class="attr">bind</span> <span class="string">*:8036</span></span><br><span class="line">    <span class="attr">mode</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">stats</span> <span class="string">enable</span></span><br><span class="line">    <span class="attr">stats</span> <span class="string">hide-version</span></span><br><span class="line">    <span class="attr">stats</span> <span class="string">show-legends</span></span><br><span class="line">    <span class="attr">stats</span> <span class="string">show-desc Splash Cluster</span></span><br><span class="line">    <span class="attr">stats</span> <span class="string">uri /</span></span><br><span class="line">    <span class="attr">stats</span> <span class="string">refresh 10s</span></span><br><span class="line">    <span class="attr">stats</span> <span class="string">realm Haproxy\ Statistics</span></span><br><span class="line">    <span class="attr">stats</span> <span class="string">auth    admin:adminpass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Splash Cluster configuration</span></span><br><span class="line"><span class="comment"># 代理服务器监听全局的8050端口</span></span><br><span class="line"><span class="attr">frontend</span> <span class="string">http-in</span></span><br><span class="line">    <span class="attr">bind</span> <span class="string">*:8050</span></span><br><span class="line"><span class="comment">    # 如果你需要开启Splash的访问认证</span></span><br><span class="line"><span class="comment">    # 则注释default_backend splash-cluster</span></span><br><span class="line"><span class="comment">    # 并放开其余default_backend splash-cluster 之上的其余注释</span></span><br><span class="line"><span class="comment">    # 账号密码为user  userpass</span></span><br><span class="line"><span class="comment">    # acl auth_ok http_auth(users)</span></span><br><span class="line"><span class="comment">    # http-request auth realm Splash if !auth_ok</span></span><br><span class="line"><span class="comment">    # http-request allow if auth_ok</span></span><br><span class="line"><span class="comment">    # http-request deny</span></span><br><span class="line"></span><br><span class="line"><span class="comment">    # acl staticfiles path_beg /_harviewer/</span></span><br><span class="line"><span class="comment">    # acl misc path / /info /_debug /debug</span></span><br><span class="line"></span><br><span class="line"><span class="comment">    # use_backend splash-cluster if auth_ok !staticfiles !misc</span></span><br><span class="line"><span class="comment">    # use_backend splash-misc if auth_ok staticfiles</span></span><br><span class="line"><span class="comment">    # use_backend splash-misc if auth_ok misc</span></span><br><span class="line">    <span class="attr">default_backend</span> <span class="string">splash-cluster</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">backend</span> <span class="string">splash-cluster</span></span><br><span class="line">    <span class="attr">option</span> <span class="string">httpchk GET /</span></span><br><span class="line">    <span class="attr">balance</span> <span class="string">leastconn</span></span><br><span class="line"></span><br><span class="line"><span class="comment">    # try another instance when connection is dropped</span></span><br><span class="line">    <span class="attr">retries</span> <span class="string">2</span></span><br><span class="line">    <span class="attr">option</span> <span class="string">redispatch</span></span><br><span class="line"><span class="comment">    # 将下面IP地址替换为你自己的Splash服务IP和端口</span></span><br><span class="line"><span class="comment">    # 按照以下格式一次增加其余的Splash服务器</span></span><br><span class="line">    <span class="attr">server</span> <span class="string">splash-0 10.10.1.41:8050 check maxconn 5 inter 2s fall 10 observe layer4</span></span><br><span class="line">    <span class="attr">server</span> <span class="string">splash-1 10.10.1.42:8050 check maxconn 5 inter 2s fall 10 observe layer4</span></span><br><span class="line">    <span class="attr">server</span> <span class="string">splash-2 10.10.1.32:8050 check maxconn 5 inter 2s fall 10 observe layer4</span></span><br><span class="line"></span><br><span class="line"><span class="attr">backend</span> <span class="string">splash-misc</span></span><br><span class="line">    <span class="attr">balance</span> <span class="string">roundrobin</span></span><br><span class="line"><span class="comment">    # 将下面IP地址替换为你自己的Splash服务IP和端口</span></span><br><span class="line"><span class="comment">    # 按照以下格式一次增加其余的Splash服务器</span></span><br><span class="line">    <span class="attr">server</span> <span class="string">splash-0 10.10.1.41:8050 check fall 15</span></span><br><span class="line">    <span class="attr">server</span> <span class="string">splash-1 10.10.1.42:8050 check fall 15</span></span><br><span class="line">    <span class="attr">server</span> <span class="string">splash-2 10.10.1.32:8050 check fall 15</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h4 id="启动-HAproxy："><a href="#启动-HAproxy：" class="headerlink" title="启动 HAproxy："></a>启动 HAproxy：</h4>
                  <figure class="highlight autoit">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta"># 启动HAproxy</span></span><br><span class="line">[root<span class="symbol">@localhost</span> src]<span class="meta"># /etc/init.d/haproxy start</span></span><br><span class="line">Restarting haproxy (via systemctl):                        [  OK  ]</span><br><span class="line"></span><br><span class="line"><span class="meta"># 如果出现错误则使用：</span></span><br><span class="line">[root<span class="symbol">@localhost</span> examples]<span class="meta"># systemctl status haproxy.service</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 查看报错</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>查看 HAproxy 状态： <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2017/09/监控面板.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2017/09/监控面板.png" alt=""></a> 用户名和密码为： admin adminpass</p>
                  <h4 id="查看-HAproxy-负载是否生效："><a href="#查看-HAproxy-负载是否生效：" class="headerlink" title="查看 HAproxy 负载是否生效："></a>查看 HAproxy 负载是否生效：</h4>
                  <p><a href="http://cdn.cuiqingcai.com/wp-content/uploads/2017/09/结果.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2017/09/结果.png" alt=""></a> 完美！！！收工！！ 注意：HAproxy 这台服务器没有安装 Splash 服务，是负载到其余安装有 Splash 的服务器上提供的服务器哦！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/哎哟卧槽" class="author" itemprop="url" rel="index">哎哟卧槽</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2017-09-26 16:21:52" itemprop="dateCreated datePublished" datetime="2017-09-26T16:21:52+08:00">2017-09-26</time>
                </span>
                <span id="/4826.html" class="post-meta-item leancloud_visitors" data-flag-title="小白进阶第七篇（Splash负载均衡）" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>6.1k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>6 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/4816.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/4816.html" class="post-title-link" itemprop="url">自建免费PYTHON爬虫代理IP池</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>大家好，我还是小四毛，不是崔老师！！！！崔老师在隔壁，哈哈哈。</p>
                  <p><a href="http://cdn.cuiqingcai.com/wp-content/uploads/2016/10/9555112.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2016/10/9555112.jpg" alt=""></a></p>
                  <h2 id="写了一个从网上抓取代理-IP，然后构建代理-IP-池的脚本，放在了这里：https-github-com-xiaosimao-IP-POOL"><a href="#写了一个从网上抓取代理-IP，然后构建代理-IP-池的脚本，放在了这里：https-github-com-xiaosimao-IP-POOL" class="headerlink" title="写了一个从网上抓取代理 IP，然后构建代理 IP 池的脚本，放在了这里：https://github.com/xiaosimao/IP_POOL"></a>写了一个从网上抓取代理 IP，然后构建代理 IP 池的脚本，放在了这里：<a href="https://github.com/xiaosimao/IP_POOL" target="_blank" rel="noopener">https://github.com/xiaosimao/IP_POOL</a></h2>
                  <h2 id="以后应该还会有很多的改动，-欢迎有兴趣的同学-star，以便及时可以收到改动的通知。"><a href="#以后应该还会有很多的改动，-欢迎有兴趣的同学-star，以便及时可以收到改动的通知。" class="headerlink" title="以后应该还会有很多的改动， 欢迎有兴趣的同学 star，以便及时可以收到改动的通知。"></a>以后应该还会有很多的改动， 欢迎有兴趣的同学 star，以便及时可以收到改动的通知。</h2>
                  <h2 id="目前是从以下几个网站获取-IP：66ip，xicidaili，data5u，proxydb。"><a href="#目前是从以下几个网站获取-IP：66ip，xicidaili，data5u，proxydb。" class="headerlink" title="目前是从以下几个网站获取 IP：66ip，xicidaili，data5u，proxydb。"></a>目前是从以下几个网站获取 IP：66ip，xicidaili，data5u，proxydb。</h2>
                  <h2 id="具体的使用方法文档在-readme-md-中，-欢迎交流。"><a href="#具体的使用方法文档在-readme-md-中，-欢迎交流。" class="headerlink" title="具体的使用方法文档在 readme.md 中， 欢迎交流。"></a>具体的使用方法文档在 readme.md 中， 欢迎交流。</h2>
                  <h2 id="如果你需要从别的网站获得，-那么可以在配置文件中进行相关的配置即可，-如果实在不想自己写，也可以提-issue-给我，我会看情况更新到代码中。"><a href="#如果你需要从别的网站获得，-那么可以在配置文件中进行相关的配置即可，-如果实在不想自己写，也可以提-issue-给我，我会看情况更新到代码中。" class="headerlink" title="如果你需要从别的网站获得， 那么可以在配置文件中进行相关的配置即可， 如果实在不想自己写，也可以提 issue 给我，我会看情况更新到代码中。"></a>如果你需要从别的网站获得， 那么可以在配置文件中进行相关的配置即可， 如果实在不想自己写，也可以提 issue 给我，我会看情况更新到代码中。</h2>
                  <h2 id="一般情况下，只要配置一下配置项就可以从新的网站获取-IP，最大限度减少写代码的时间。"><a href="#一般情况下，只要配置一下配置项就可以从新的网站获取-IP，最大限度减少写代码的时间。" class="headerlink" title="一般情况下，只要配置一下配置项就可以从新的网站获取 IP，最大限度减少写代码的时间。"></a>一般情况下，只要配置一下配置项就可以从新的网站获取 IP，最大限度减少写代码的时间。</h2>
                  <h2 id="免费的-ip，质量不敢保证，目前测试的目标网站为百度和https-httpbin-org-get，-还是获得了一些通过测试的-IP，下面是截图。"><a href="#免费的-ip，质量不敢保证，目前测试的目标网站为百度和https-httpbin-org-get，-还是获得了一些通过测试的-IP，下面是截图。" class="headerlink" title="免费的 ip，质量不敢保证，目前测试的目标网站为百度和https://httpbin.org/get， 还是获得了一些通过测试的 IP，下面是截图。"></a>免费的 ip，质量不敢保证，目前测试的目标网站为百度和<a href="https://httpbin.org/get，" target="_blank" rel="noopener">https://httpbin.org/get，</a> 还是获得了一些通过测试的 IP，下面是截图。</h2>
                  <p><a href="http://cdn.cuiqingcai.com/wp-content/uploads/2017/09/数据库截图.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2017/09/数据库截图.png" alt=""></a></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/四毛" class="author" itemprop="url" rel="index">四毛</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2017-09-22 14:47:08" itemprop="dateCreated datePublished" datetime="2017-09-22T14:47:08+08:00">2017-09-22</time>
                </span>
                <span id="/4816.html" class="post-meta-item leancloud_visitors" data-flag-title="自建免费PYTHON爬虫代理IP池" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>390</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/4804.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Net <i class="label-arrow"></i>
                  </a>
                  <a href="/4804.html" class="post-title-link" itemprop="url">HTTP 206 获取文件部分内容和范围请求</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>HTTP 2xx 范围内的状态码表明了“客户端发送的请求已经被服务器接受并且被成功处理了”。 HTTP/1.1 200 OK 是 HTTP 请求成功后的标准响应，当你在浏览器中打开某个网站后,你通常会得到一个 200 状态码。HTTP/1.1 206 状态码表示的是“客户端通过发送范围请求头Range抓取到了资源的部分数据” 这种请求通常用来:</p>
                  <ul>
                    <li>学习http头和状态</li>
                    <li>解决网路问题</li>
                    <li>解决大文件下载问题</li>
                    <li>解决CDN和原始HTTP服务器问题</li>
                    <li>使用工具例如lftp,wget,telnet测试断电续传</li>
                    <li>测试将一个大文件分割成多个部分同时下载</li>
                  </ul>
                  <h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2>
                  <p>查看服务器是否支持 HTTP 206：</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="string">curl</span> <span class="string">-I</span> <span class="string">https://raw.githubusercontent.com/Germey/LaravelGeetest/master/README.md</span></span><br><span class="line"><span class="string">HTTP/1.1</span> <span class="number">200</span> <span class="string">OK</span></span><br><span class="line"><span class="attr">Content-Security-Policy:</span> <span class="string">default-src</span> <span class="string">'none'</span><span class="string">;</span> <span class="string">style-src</span> <span class="string">'unsafe-inline'</span></span><br><span class="line"><span class="attr">Strict-Transport-Security:</span> <span class="string">max-age=31536000</span></span><br><span class="line"><span class="attr">X-Content-Type-Options:</span> <span class="string">nosniff</span></span><br><span class="line"><span class="attr">X-Frame-Options:</span> <span class="string">deny</span></span><br><span class="line"><span class="attr">X-XSS-Protection:</span> <span class="number">1</span><span class="string">;</span> <span class="string">mode=block</span></span><br><span class="line"><span class="attr">ETag:</span> <span class="string">"b29f4639b76cd7f94a4b36b05be6c85acfe478f1"</span></span><br><span class="line"><span class="attr">Content-Type:</span> <span class="string">text/plain;</span> <span class="string">charset=utf-8</span></span><br><span class="line"><span class="attr">Cache-Control:</span> <span class="string">max-age=300</span></span><br><span class="line"><span class="attr">X-Geo-Block-List:</span></span><br><span class="line"><span class="attr">X-GitHub-Request-Id:</span> <span class="string">850A:16D2:30128BA:3341504:59BBC946</span></span><br><span class="line"><span class="attr">Content-Length:</span> <span class="number">8709</span></span><br><span class="line"><span class="attr">Accept-Ranges:</span> <span class="string">bytes</span></span><br><span class="line"><span class="attr">Date:</span> <span class="string">Fri,</span> <span class="number">15</span> <span class="string">Sep</span> <span class="number">2017</span> <span class="number">12</span><span class="string">:36:31</span> <span class="string">GMT</span></span><br><span class="line"><span class="attr">Via:</span> <span class="number">1.1</span> <span class="string">varnish</span></span><br><span class="line"><span class="attr">Connection:</span> <span class="string">keep-alive</span></span><br><span class="line"><span class="attr">X-Served-By:</span> <span class="string">cache-nrt6123-NRT</span></span><br><span class="line"><span class="attr">X-Cache:</span> <span class="string">HIT</span></span><br><span class="line"><span class="attr">X-Cache-Hits:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">X-Timer:</span> <span class="string">S1505478991.145862,VS0,VE1</span></span><br><span class="line"><span class="attr">Vary:</span> <span class="string">Authorization,Accept-Encoding</span></span><br><span class="line"><span class="attr">Access-Control-Allow-Origin:</span> <span class="string">*</span></span><br><span class="line"><span class="attr">X-Fastly-Request-ID:</span> <span class="string">ee23d80d2ba507ec0a70c880a075df0d2671aa4d</span></span><br><span class="line"><span class="attr">Expires:</span> <span class="string">Fri,</span> <span class="number">15</span> <span class="string">Sep</span> <span class="number">2017</span> <span class="number">12</span><span class="string">:41:31</span> <span class="string">GMT</span></span><br><span class="line"><span class="attr">Source-Age:</span> <span class="number">8</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中有两个我们比较关注的请求头： Accept-Ranges: bytes：该响应头表明服务器支持 Range 请求，以及服务器所支持的单位是字节。同时服务器支持断点续传，以及支持同时下载文件的多个部分，也就是说下载工具可以利用范围请求加速下载该文件。Accept-Ranges: none 响应头表示服务器不支持范围请求。 Content-Length: 8709 ：Content-Length 响应头表明了响应实体的大小,也就是真实的图片文件的大小是 8709 字节 (8.7K)。</p>
                  <h2 id="发送"><a href="#发送" class="headerlink" title="发送"></a>发送</h2>
                  <p>利用 CURL 可以指定请求范围。 获取前 500 字节：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl --header <span class="string">"Range: bytes=0-500"</span> https:<span class="regexp">//</span>raw.githubusercontent.com<span class="regexp">/Germey/</span>LaravelGeetest<span class="regexp">/master/</span>README.md</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>后 500 字节：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl --header <span class="string">"Range: bytes=-500"</span> https:<span class="regexp">//</span>raw.githubusercontent.com<span class="regexp">/Germey/</span>LaravelGeetest<span class="regexp">/master/</span>README.md</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>从 500 - 1000 字节：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl --header <span class="string">"Range: bytes=500-1000"</span> https:<span class="regexp">//</span>raw.githubusercontent.com<span class="regexp">/Germey/</span>LaravelGeetest<span class="regexp">/master/</span>README.md</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>从 500 - 末尾字节：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">curl --header <span class="string">"Range: bytes=500-"</span> https:<span class="regexp">//</span>raw.githubusercontent.com<span class="regexp">/Germey/</span>LaravelGeetest<span class="regexp">/master/</span>README.md</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="开启"><a href="#开启" class="headerlink" title="开启"></a>开启</h2>
                  <p>大部分web服务器都原生支持字节范围请求. Apache 2.x用户可以在httpd.conf中尝试 <a href="http://httpd.apache.org/docs/2.2/mod/mod_headers.html" target="_blank" rel="noopener">mod_headers</a>:</p>
                  <figure class="highlight lasso">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">Header</span> <span class="built_in">set</span> Accept<span class="params">-Ranges</span> <span class="built_in">bytes</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2017-09-15 20:46:16" itemprop="dateCreated datePublished" datetime="2017-09-15T20:46:16+08:00">2017-09-15</time>
                </span>
                <span id="/4804.html" class="post-meta-item leancloud_visitors" data-flag-title="HTTP 206 获取文件部分内容和范围请求" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.9k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/4791.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/4791.html" class="post-title-link" itemprop="url">轻型爬虫框架</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h1 id="大家好，我是四毛-不是崔老师。"><a href="#大家好，我是四毛-不是崔老师。" class="headerlink" title="大家好，我是四毛,   不是崔老师。"></a>大家好，我是四毛, 不是崔老师。</h1>
                  <h1 id="恩，今天的内容很短-主要都写在了-README-md-里面。"><a href="#恩，今天的内容很短-主要都写在了-README-md-里面。" class="headerlink" title="恩，今天的内容很短, 主要都写在了 README.md 里面。"></a>恩，今天的内容很短, 主要都写在了 README.md 里面。</h1>
                  <p><a href="http://cdn.cuiqingcai.com/wp-content/uploads/2017/02/QQ图片20170205084843.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2017/02/QQ图片20170205084843.jpg" alt=""></a></p>
                  <h3 id="写了一个将爬虫基本步骤都封装起来的小框架，地址在https-github-com-xiaosimao-AiSpider，-欢迎-Star。"><a href="#写了一个将爬虫基本步骤都封装起来的小框架，地址在https-github-com-xiaosimao-AiSpider，-欢迎-Star。" class="headerlink" title="写了一个将爬虫基本步骤都封装起来的小框架，地址在https://github.com/xiaosimao/AiSpider， 欢迎 Star。"></a><strong>写了一个将爬虫基本步骤都封装起来的小框架，地址在<a href="https://github.com/xiaosimao/AiSpider" target="_blank" rel="noopener">https://github.com/xiaosimao/AiSpider</a>， 欢迎 Star。</strong></h3>
                  <h3 id="写的很基础，很简单，大道至简（对，其实就是不会写）。"><a href="#写的很基础，很简单，大道至简（对，其实就是不会写）。" class="headerlink" title="写的很基础，很简单，大道至简（对，其实就是不会写）。"></a><strong>写的很基础，很简单，大道至简（对，其实就是不会写）。</strong></h3>
                  <p><strong>最近也在学一些设计模式的东西。</strong></p>
                  <h3 id="欢迎有兴趣的同学共同研究，readme-md-中有我的微信（加的时候麻烦注明一下来自静觅），提出存在的问题和你的想法，这样大家可以共同讨论，共同进步。"><a href="#欢迎有兴趣的同学共同研究，readme-md-中有我的微信（加的时候麻烦注明一下来自静觅），提出存在的问题和你的想法，这样大家可以共同讨论，共同进步。" class="headerlink" title="欢迎有兴趣的同学共同研究，readme.md 中有我的微信（加的时候麻烦注明一下来自静觅），提出存在的问题和你的想法，这样大家可以共同讨论，共同进步。"></a><strong>欢迎有兴趣的同学共同研究，readme.md 中有我的微信（加的时候麻烦注明一下来自静觅），提出存在的问题和你的想法，这样大家可以共同讨论，共同进步。</strong></h3>
                  <h1 id="BE-A-SPIDERMAN。"><a href="#BE-A-SPIDERMAN。" class="headerlink" title="BE A SPIDERMAN。"></a><em><strong>BE A SPIDERMAN。</strong></em></h1>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/四毛" class="author" itemprop="url" rel="index">四毛</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2017-09-12 17:02:38" itemprop="dateCreated datePublished" datetime="2017-09-12T17:02:38+08:00">2017-09-12</time>
                </span>
                <span id="/4791.html" class="post-meta-item leancloud_visitors" data-flag-title="轻型爬虫框架" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>240</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/4778.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/4778.html" class="post-title-link" itemprop="url">Neo4j简介及Py2Neo的用法</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>Neo4j是一个世界领先的开源图形数据库，由 Java 编写。图形数据库也就意味着它的数据并非保存在表或集合中，而是保存为节点以及节点之间的关系。 Neo4j 的数据由下面几部分构成：</p>
                  <ul>
                    <li>节点</li>
                    <li>边</li>
                    <li>属性</li>
                  </ul>
                  <p>Neo4j 除了顶点（Node）和边（Relationship），还有一种重要的部分——属性。无论是顶点还是边，都可以有任意多的属性。属性的存放类似于一个 HashMap，Key 为一个字符串，而 Value 必须是基本类型或者是基本类型数组。 在Neo4j中，节点以及边都能够包含保存值的属性，此外：</p>
                  <ul>
                    <li>可以为节点设置零或多个标签（例如 Author 或 Book）</li>
                    <li>每个关系都对应一种类型（例如 WROTE 或 FRIEND_OF）</li>
                    <li>关系总是从一个节点指向另一个节点（但可以在不考虑指向性的情况下进行查询）</li>
                  </ul>
                  <p>具体介绍可以参考：<a href="https://www.w3cschool.cn/neo4j" target="_blank" rel="noopener">https://www.w3cschool.cn/neo4j</a>。</p>
                  <h2 id="Neo4j的特点"><a href="#Neo4j的特点" class="headerlink" title="Neo4j的特点"></a>Neo4j的特点</h2>
                  <ul>
                    <li>它拥有简单的查询语言 Neo4j CQL</li>
                    <li>它遵循属性图数据模型</li>
                    <li>它通过使用 Apache Lucence 支持索引</li>
                    <li>它支持 UNIQUE 约束</li>
                    <li>它包含一个用于执行 CQL 命令的 UI：Neo4j 数据浏览器</li>
                    <li>它支持完整的 ACID（原子性，一致性，隔离性和持久性）规则</li>
                    <li>它采用原生图形库与本地 GPE（图形处理引擎）</li>
                    <li>它支持查询的数据导出到 Json 和 XLS 格式</li>
                    <li>它提供了 REST API，可以被任何编程语言（如 Java，Spring，Scala 等）访问</li>
                    <li>它提供了可以通过任何 UI MVC 框架（如 Node JS ）访问的 Java 脚本</li>
                    <li>它支持两种 Java API：Cypher API 和 Native Java API 来开发 Java 应用程序</li>
                  </ul>
                  <h2 id="Neo4j安装"><a href="#Neo4j安装" class="headerlink" title="Neo4j安装"></a>Neo4j安装</h2>
                  <p>可以到官网直接下载安装包安装即可，链接：<a href="https://neo4j.com/download/" target="_blank" rel="noopener">https://neo4j.com/download/</a>。</p>
                  <h2 id="Neo4j-CQL命令"><a href="#Neo4j-CQL命令" class="headerlink" title="Neo4j CQL命令"></a>Neo4j CQL命令</h2>
                  <p>Neo4j 的 CQL 是非常重要的命令，类似于 SQL 语句，具体的用法可以参考：<a href="https://www.w3cschool.cn/neo4j/neo4j_cql_introduction.html" target="_blank" rel="noopener">https://www.w3cschool.cn/neo4j/neo4j_cql_introduction.html</a>。</p>
                  <h2 id="Py2Neo用法"><a href="#Py2Neo用法" class="headerlink" title="Py2Neo用法"></a>Py2Neo用法</h2>
                  <p>Py2Neo 是用来对接 Neo4j 的 Python 库，接下来对其详细介绍。</p>
                  <h3 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h3>
                  <ul>
                    <li>官方文档：<a href="http://py2neo.org/v3/index.html" target="_blank" rel="noopener">http://py2neo.org/v3/index.html</a></li>
                    <li>GitHub：<a href="https://github.com/technige/py2neo" target="_blank" rel="noopener">https://github.com/technige/py2neo</a></li>
                  </ul>
                  <h3 id="安装方法"><a href="#安装方法" class="headerlink" title="安装方法"></a>安装方法</h3>
                  <p>使用 Pip 安装即可：</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip3 <span class="keyword">install</span> py2neo</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="Node-amp-Relationship"><a href="#Node-amp-Relationship" class="headerlink" title="Node &amp; Relationship"></a>Node &amp; Relationship</h3>
                  <p>Neo4j 里面最重要的两个数据结构就是节点和关系，即 Node 和 Relationship，可以通过 Node 或 Relationship 对象创建，实例如下：</p>
                  <figure class="highlight crmsh">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from py2neo import <span class="keyword">Node</span><span class="title">, Relationship</span></span><br><span class="line"></span><br><span class="line">a = <span class="keyword">Node</span><span class="title">('Person</span>', <span class="attr">name=</span>'Alice')</span><br><span class="line">b = <span class="keyword">Node</span><span class="title">('Person</span>', <span class="attr">name=</span>'Bob')</span><br><span class="line">r = Relationship(a, 'KNOWS', b)</span><br><span class="line">print(a, b, r)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">(<span class="selector-tag">alice</span><span class="selector-pseudo">:Person</span> &#123;<span class="attribute">name</span>:<span class="string">"Alice"</span>&#125;) (<span class="selector-tag">bob</span><span class="selector-pseudo">:Person</span> &#123;<span class="attribute">name</span>:<span class="string">"Bob"</span>&#125;) (<span class="selector-tag">alice</span>)<span class="selector-tag">-</span><span class="selector-attr">[:KNOWS]</span><span class="selector-tag">-</span>&gt;(<span class="selector-tag">bob</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们就成功创建了两个 Node 和两个 Node 之间的 Relationship。 Node 和 Relationship 都继承了 PropertyDict 类，它可以赋值很多属性，类似于字典的形式，例如可以通过如下方式对 Node 或 Relationship 进行属性赋值，接着上面的代码，实例如下:</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">a</span>[<span class="string">'age'</span>] = <span class="number">20</span></span><br><span class="line"><span class="selector-tag">b</span>[<span class="string">'age'</span>] = <span class="number">21</span></span><br><span class="line">r[<span class="string">'time'</span>] = <span class="string">'2017/08/31'</span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(a, b, r)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">(<span class="selector-tag">alice</span><span class="selector-pseudo">:Person</span> &#123;<span class="attribute">age</span>:<span class="number">20</span>,name:<span class="string">"Alice"</span>&#125;) (<span class="selector-tag">bob</span><span class="selector-pseudo">:Person</span> &#123;<span class="attribute">age</span>:<span class="number">21</span>,name:<span class="string">"Bob"</span>&#125;) (<span class="selector-tag">alice</span>)<span class="selector-tag">-</span><span class="selector-attr">[:KNOWS &#123;time:<span class="string">"2017/08/31"</span>&#125;]</span><span class="selector-tag">-</span>&gt;(<span class="selector-tag">bob</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可见通过类似字典的操作方法就可以成功实现属性赋值。 另外还可以通过 setdefault() 方法赋值默认属性，例如：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">a</span>.setdefault(<span class="string">'location'</span>, <span class="string">'北京'</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(a)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">(<span class="selector-tag">alice</span><span class="selector-pseudo">:Person</span> &#123;<span class="attribute">age</span>:<span class="number">20</span>,location:<span class="string">"北京"</span>,name:<span class="string">"Alice"</span>&#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可见没有给 a 对象赋值 location 属性，现在就会使用默认属性。 但如果赋值了 location 属性，则它会覆盖默认属性，例如：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">a</span>[<span class="string">'location'</span>] = <span class="string">'上海'</span></span><br><span class="line"><span class="selector-tag">a</span>.setdefault(<span class="string">'location'</span>, <span class="string">'北京'</span>)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(a)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">(<span class="selector-tag">alice</span><span class="selector-pseudo">:Person</span> &#123;<span class="attribute">age</span>:<span class="number">20</span>,location:<span class="string">"上海"</span>,name:<span class="string">"Alice"</span>&#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外也可以使用 update() 方法对属性批量更新，接着上面的例子实例如下：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">data = &#123;</span><br><span class="line">    <span class="string">'name'</span>: <span class="string">'Amy'</span>,</span><br><span class="line">    <span class="string">'age'</span>: <span class="number">21</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">a</span>.update(data)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(a)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">(<span class="selector-tag">alice</span><span class="selector-pseudo">:Person</span> &#123;<span class="attribute">age</span>:<span class="number">21</span>,location:<span class="string">"上海"</span>,name:<span class="string">"Amy"</span>&#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到这里更新了 a 对象的 name 和 age 属性，没有更新 location 属性，则 name 和 age 属性会更新，location 属性则会保留。</p>
                  <h3 id="Subgraph"><a href="#Subgraph" class="headerlink" title="Subgraph"></a>Subgraph</h3>
                  <p>Subgraph，子图，是 Node 和 Relationship 的集合，最简单的构造子图的方式是通过关系运算符，实例如下：</p>
                  <figure class="highlight crmsh">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from py2neo import <span class="keyword">Node</span><span class="title">, Relationship</span></span><br><span class="line"></span><br><span class="line">a = <span class="keyword">Node</span><span class="title">('Person</span>', <span class="attr">name=</span>'Alice')</span><br><span class="line">b = <span class="keyword">Node</span><span class="title">('Person</span>', <span class="attr">name=</span>'Bob')</span><br><span class="line">r = Relationship(a, 'KNOWS', b)</span><br><span class="line">s = a | b | r</span><br><span class="line">print(s)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight clojure">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">(&#123;(<span class="name">alice:Person</span> &#123;name:<span class="string">"Alice"</span>&#125;), (<span class="name">bob:Person</span> &#123;name:<span class="string">"Bob"</span>&#125;)&#125;, &#123;(<span class="name">alice</span>)-[<span class="symbol">:KNOWS</span>]-&gt;(<span class="name">bob</span>)&#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就组成了一个 Subgraph。 另外还可以通过 nodes() 和 relationships() 方法获取所有的 Node 和 Relationship，实例如下：</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">print(<span class="name">s</span>.nodes())</span><br><span class="line">print(<span class="name">s</span>.relationships())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">frozenset(&#123;(<span class="name">alice</span><span class="symbol">:Person</span> &#123;name:<span class="string">"Alice"</span>&#125;), (<span class="name">bob</span><span class="symbol">:Person</span> &#123;name:<span class="string">"Bob"</span>&#125;)&#125;)</span><br><span class="line">frozenset(&#123;(<span class="name">alice</span>)-[<span class="symbol">:KNOWS</span>]-&gt;(<span class="name">bob</span>)&#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到结果是 frozenset 类型。 另外还可以利用 &amp; 取 Subgraph 的交集，例如：</p>
                  <figure class="highlight 1c">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">s1 = a <span class="string">| b | r</span></span><br><span class="line">s2 = a <span class="string">| b</span></span><br><span class="line">print(s1 <span class="meta">&amp; s2)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight clojure">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">(&#123;(<span class="name">alice:Person</span> &#123;name:<span class="string">"Alice"</span>&#125;), (<span class="name">bob:Person</span> &#123;name:<span class="string">"Bob"</span>&#125;)&#125;, &#123;&#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到结果是二者的交集。 另外我们还可以分别利用 keys()、labels()、nodes()、relationships()、types() 分别获取 Subgraph 的 Key、Label、Node、Relationship、Relationship Type，实例如下：</p>
                  <figure class="highlight gauss">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">s = a | b | r</span><br><span class="line"><span class="keyword">print</span>(s.<span class="built_in">keys</span>())</span><br><span class="line"><span class="keyword">print</span>(s.<span class="built_in">labels</span>())</span><br><span class="line"><span class="keyword">print</span>(s.<span class="built_in">nodes</span>())</span><br><span class="line"><span class="keyword">print</span>(s.<span class="built_in">relationships</span>())</span><br><span class="line"><span class="keyword">print</span>(s.<span class="built_in">types</span>())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">frozenset(&#123;'name'&#125;)</span><br><span class="line">frozenset(&#123;'Person'&#125;)</span><br><span class="line">frozenset(&#123;(<span class="name">alice</span><span class="symbol">:Person</span> &#123;name:<span class="string">"Alice"</span>&#125;), (<span class="name">bob</span><span class="symbol">:Person</span> &#123;name:<span class="string">"Bob"</span>&#125;)&#125;)</span><br><span class="line">frozenset(&#123;(<span class="name">alice</span>)-[<span class="symbol">:KNOWS</span>]-&gt;(<span class="name">bob</span>)&#125;)</span><br><span class="line">frozenset(&#123;'KNOWS'&#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外还可以用 order() 或 size() 方法来获取 Subgraph 的 Node 数量和 Relationship 数量，实例如下：</p>
                  <figure class="highlight crmsh">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from py2neo import <span class="keyword">Node</span><span class="title">, Relationship</span>, size, order</span><br><span class="line">s = a | b | r</span><br><span class="line">print(order(s))</span><br><span class="line">print(size(s))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">1</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="Walkable"><a href="#Walkable" class="headerlink" title="Walkable"></a>Walkable</h3>
                  <p>Walkable 是增加了遍历信息的 Subgraph，我们通过 + 号便可以构建一个 Walkable 对象，例如：</p>
                  <figure class="highlight crmsh">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from py2neo import <span class="keyword">Node</span><span class="title">, Relationship</span></span><br><span class="line"></span><br><span class="line">a = <span class="keyword">Node</span><span class="title">('Person</span>', <span class="attr">name=</span>'Alice')</span><br><span class="line">b = <span class="keyword">Node</span><span class="title">('Person</span>', <span class="attr">name=</span>'Bob')</span><br><span class="line">c = <span class="keyword">Node</span><span class="title">('Person</span>', <span class="attr">name=</span>'Mike')</span><br><span class="line">ab = Relationship(a, <span class="string">"KNOWS"</span>, b)</span><br><span class="line">ac = Relationship(a, <span class="string">"KNOWS"</span>, c)</span><br><span class="line">w = ab + Relationship(b, <span class="string">"LIKES"</span>, c) + ac</span><br><span class="line">print(w)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight elixir">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">(alice)-[<span class="symbol">:KNOWS</span>]-&gt;(bob)-[<span class="symbol">:LIKES</span>]-&gt;(mike)&lt;-[<span class="symbol">:KNOWS</span>]-(alice)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们就形成了一个 Walkable 对象。 另外我们可以调用 walk() 方法实现遍历，实例如下：</p>
                  <figure class="highlight applescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> py2neo import walk</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="built_in">item</span> <span class="keyword">in</span> walk(w):</span><br><span class="line">    print(<span class="built_in">item</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">(<span class="selector-tag">alice</span><span class="selector-pseudo">:Person</span> &#123;<span class="attribute">name</span>:<span class="string">"Alice"</span>&#125;)</span><br><span class="line">(<span class="selector-tag">alice</span>)<span class="selector-tag">-</span><span class="selector-attr">[:KNOWS]</span><span class="selector-tag">-</span>&gt;(<span class="selector-tag">bob</span>)</span><br><span class="line">(<span class="selector-tag">bob</span><span class="selector-pseudo">:Person</span> &#123;<span class="attribute">name</span>:<span class="string">"Bob"</span>&#125;)</span><br><span class="line">(<span class="selector-tag">bob</span>)<span class="selector-tag">-</span><span class="selector-attr">[:LIKES]</span><span class="selector-tag">-</span>&gt;(<span class="selector-tag">mike</span>)</span><br><span class="line">(<span class="selector-tag">mike</span><span class="selector-pseudo">:Person</span> &#123;<span class="attribute">name</span>:<span class="string">"Mike"</span>&#125;)</span><br><span class="line">(<span class="selector-tag">alice</span>)<span class="selector-tag">-</span><span class="selector-attr">[:KNOWS]</span><span class="selector-tag">-</span>&gt;(<span class="selector-tag">mike</span>)</span><br><span class="line">(<span class="selector-tag">alice</span><span class="selector-pseudo">:Person</span> &#123;<span class="attribute">name</span>:<span class="string">"Alice"</span>&#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到它从 a 这个 Node 开始遍历，然后到 b，再到 c，最后重新回到 a。 另外还可以利用 start_node()、end_node()、nodes()、relationships() 方法来获取起始 Node、终止 Node、所有 Node 和 Relationship，例如：</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">print(<span class="name">w</span>.start_node())</span><br><span class="line">print(<span class="name">w</span>.end_node())</span><br><span class="line">print(<span class="name">w</span>.nodes())</span><br><span class="line">print(<span class="name">w</span>.relationships())</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight clojure">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">(<span class="name">alice:Person</span> &#123;name:<span class="string">"Alice"</span>&#125;)</span><br><span class="line">(<span class="name">alice:Person</span> &#123;name:<span class="string">"Alice"</span>&#125;)</span><br><span class="line">((<span class="name">alice:Person</span> &#123;name:<span class="string">"Alice"</span>&#125;), (<span class="name">bob:Person</span> &#123;name:<span class="string">"Bob"</span>&#125;), (<span class="name">mike:Person</span> &#123;name:<span class="string">"Mike"</span>&#125;), (<span class="name">alice:Person</span> &#123;name:<span class="string">"Alice"</span>&#125;))</span><br><span class="line">((<span class="name">alice</span>)-[<span class="symbol">:KNOWS</span>]-&gt;(<span class="name">bob</span>), (<span class="name">bob</span>)-[<span class="symbol">:LIKES</span>]-&gt;(<span class="name">mike</span>), (<span class="name">alice</span>)-[<span class="symbol">:KNOWS</span>]-&gt;(<span class="name">mike</span>))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到本例中起始和终止 Node 都是同一个，这和 walk() 方法得到的结果是一致的。</p>
                  <h3 id="Graph"><a href="#Graph" class="headerlink" title="Graph"></a>Graph</h3>
                  <p>在 database 模块中包含了和 Neo4j 数据交互的 API，最重要的当属 Graph，它代表了 Neo4j 的图数据库，同时 Graph 也提供了许多方法来操作 Neo4j 数据库。 Graph 在初始化的时候需要传入连接的 URI，初始化参数有 bolt、secure、host、http_port、https_port、bolt_port、user、password，详情说明可以参考：<a href="http://py2neo.org/v3/database.html#py2neo.database.Graph" target="_blank" rel="noopener">http://py2neo.org/v3/database.html#py2neo.database.Graph</a>。 初始化的实例如下：</p>
                  <figure class="highlight isbl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">from</span> <span class="variable">py2neo</span> <span class="variable">import</span> <span class="variable">Graph</span></span><br><span class="line"><span class="variable">graph_1</span> = <span class="function"><span class="title">Graph</span>()</span></span><br><span class="line"><span class="variable">graph_2</span> = <span class="function"><span class="title">Graph</span>(<span class="variable">host</span>=<span class="string">"localhost"</span>)</span></span><br><span class="line"><span class="variable">graph_3</span> = <span class="function"><span class="title">Graph</span>(<span class="string">"http://localhost:7474/db/data/"</span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外我们还可以利用 create() 方法传入 Subgraph 对象来将关系图添加到数据库中，实例如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> py2neo import Node, Relationship, Graph</span><br><span class="line"></span><br><span class="line">a = Node(<span class="string">'Person'</span>, <span class="attribute">name</span>=<span class="string">'Alice'</span>)</span><br><span class="line">b = Node(<span class="string">'Person'</span>, <span class="attribute">name</span>=<span class="string">'Bob'</span>)</span><br><span class="line">r = Relationship(a, <span class="string">'KNOWS'</span>, b)</span><br><span class="line">s = a | b | r</span><br><span class="line">graph = Graph(<span class="attribute">password</span>=<span class="string">'123456'</span>)</span><br><span class="line">graph.create(s)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里必须确保 Neo4j 正常运行，其密码为 123456，这里调用 create() 方法即可完成图的创建，结果如下： <img src="https://germey.gitbooks.io/ai/content/assets/2017-08-31-21-35-08.jpg" alt=""> 另外我们也可以单独添加单个 Node 或 Relationship，实例如下：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> py2neo <span class="keyword">import</span> Graph, Node, Relationship</span><br><span class="line"></span><br><span class="line">graph = Graph(<span class="keyword">password</span>=<span class="string">'123456'</span>)</span><br><span class="line">a = Node(<span class="string">'Person'</span>, <span class="type">name</span>=<span class="string">'Alice'</span>)</span><br><span class="line">graph.<span class="keyword">create</span>(a)</span><br><span class="line">b = Node(<span class="string">'Person'</span>, <span class="type">name</span>=<span class="string">'Bob'</span>)</span><br><span class="line">ab = Relationship(a, <span class="string">'KNOWS'</span>, b)</span><br><span class="line">graph.<span class="keyword">create</span>(ab)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下： <img src="https://germey.gitbooks.io/ai/content/assets/2017-08-31-22-00-02.jpg" alt=""> 另外还可以利用 data() 方法来获取查询结果：</p>
                  <figure class="highlight haskell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="title">from</span> py2neo <span class="keyword">import</span> Graph</span><br><span class="line"></span><br><span class="line"><span class="title">graph</span> = <span class="type">Graph</span>(password='<span class="number">123456</span>')</span><br><span class="line"><span class="class"><span class="keyword">data</span> = graph.<span class="keyword">data</span>('<span class="type">MATCH</span> (<span class="title">p</span>:<span class="type">Person</span>) return p')</span></span><br><span class="line"><span class="title">print</span>(<span class="class"><span class="keyword">data</span>)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight clojure">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[&#123;'p': (<span class="name">e0d0f96:Person</span> &#123;name:<span class="string">"Alice"</span>&#125;)&#125;, &#123;'p': (<span class="name">cfe57d0:Person</span> &#123;name:<span class="string">"Bob"</span>&#125;)&#125;]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里是通过 CQL 语句实现的查询，输出结果即 CQL 语句的返回结果，是列表形式。 另外输出结果还可以直接转化为 DataFrame 对象，实例如下：</p>
                  <figure class="highlight haskell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="title">from</span> py2neo <span class="keyword">import</span> Graph</span><br><span class="line"><span class="title">from</span> pandas <span class="keyword">import</span> DataFrame</span><br><span class="line"><span class="title">graph</span> = <span class="type">Graph</span>(password='<span class="number">123456</span>')</span><br><span class="line"><span class="class"><span class="keyword">data</span> = graph.<span class="keyword">data</span>('<span class="type">MATCH</span> (<span class="title">p</span>:<span class="type">Person</span>) return p')</span></span><br><span class="line"><span class="title">df</span> = <span class="type">DataFrame</span>(<span class="class"><span class="keyword">data</span>)</span></span><br><span class="line"><span class="title">print</span>(df)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">                   p</span><br><span class="line"><span class="number">0</span>  &#123;<span class="string">'name'</span>: <span class="string">'Alice'</span>&#125;</span><br><span class="line"><span class="number">1</span>    &#123;<span class="string">'name'</span>: <span class="string">'Bob'</span>&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外可以使用 find_one() 或 find() 方法进行 Node 的查找，可以利用 match() 或 match_one() 方法对 Relationship 进行查找：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> py2neo import Graph</span><br><span class="line"></span><br><span class="line">graph = Graph(<span class="attribute">password</span>=<span class="string">'123456'</span>)</span><br><span class="line">node = graph.find_one(<span class="attribute">label</span>=<span class="string">'Person'</span>)</span><br><span class="line"><span class="builtin-name">print</span>(node)</span><br><span class="line">relationship = graph.match_one(<span class="attribute">rel_type</span>=<span class="string">'KNOWS'</span>)</span><br><span class="line"><span class="builtin-name">print</span>(relationship)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">(<span class="selector-tag">c7402c7</span><span class="selector-pseudo">:Person</span> &#123;<span class="attribute">age</span>:<span class="number">21</span>,name:<span class="string">"Alice"</span>&#125;)</span><br><span class="line">(<span class="selector-tag">c7402c7</span>)<span class="selector-tag">-</span><span class="selector-attr">[:KNOWS]</span><span class="selector-tag">-</span>&gt;(<span class="selector-tag">e2c42fc</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果想要更新 Node 的某个属性可以使用 push() 方法，例如：</p>
                  <figure class="highlight crmsh">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from py2neo import Graph, <span class="keyword">Node</span><span class="title"></span></span><br><span class="line"><span class="title"></span></span><br><span class="line"><span class="title">graph</span> = Graph(<span class="attr">password=</span>'<span class="number">123456</span>')</span><br><span class="line">a = <span class="keyword">Node</span><span class="title">('Person</span>', <span class="attr">name=</span>'Alice')</span><br><span class="line"><span class="keyword">node</span> <span class="title">= graph</span>.find_one(<span class="attr">label=</span>'Person')</span><br><span class="line"><span class="keyword">node</span><span class="title">['age</span>'] = <span class="number">21</span></span><br><span class="line">graph.push(<span class="keyword">node</span><span class="title">)</span></span><br><span class="line"><span class="title">print</span>(graph.find_one(<span class="attr">label=</span>'Person'))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">(<span class="selector-tag">a90a763</span><span class="selector-pseudo">:Person</span> &#123;<span class="attribute">age</span>:<span class="number">21</span>,name:<span class="string">"Alice"</span>&#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果想要删除某个 Node 可以使用 delete() 方法，例如：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> py2neo import Graph</span><br><span class="line"></span><br><span class="line">graph = Graph(<span class="attribute">password</span>=<span class="string">'123456'</span>)</span><br><span class="line">node = graph.find_one(<span class="attribute">label</span>=<span class="string">'Person'</span>)</span><br><span class="line">relationship = graph.match_one(<span class="attribute">rel_type</span>=<span class="string">'KNOWS'</span>)</span><br><span class="line">graph.delete(relationship)</span><br><span class="line">graph.delete(node)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在删除 Node 时必须先删除其对应的 Relationship，否则无法删除 Node。 另外我们也可以通过 run() 方法直接执行 CQL 语句，例如：</p>
                  <figure class="highlight haskell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="title">from</span> py2neo <span class="keyword">import</span> Graph</span><br><span class="line"></span><br><span class="line"><span class="title">graph</span> = <span class="type">Graph</span>(password='<span class="number">123456</span>')</span><br><span class="line"><span class="class"><span class="keyword">data</span> = graph.run('<span class="type">MATCH</span> (<span class="title">p</span>:<span class="type">Person</span>) <span class="type">RETURN</span> p <span class="type">LIMIT</span> 5')</span></span><br><span class="line"><span class="title">print</span>(list(<span class="class"><span class="keyword">data</span>))</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight clojure">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[(<span class="name">'p':</span> (<span class="name">b6f61ff:Person</span> &#123;age:20,name:<span class="string">"Alice"</span>&#125;)), (<span class="name">'p':</span> (<span class="name">cc238b1:Person</span> &#123;age:20,name:<span class="string">"Alice"</span>&#125;)), (<span class="name">'p':</span> (<span class="name">b09e672:Person</span> &#123;age:20,name:<span class="string">"Alice"</span>&#125;))]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="NodeSelector"><a href="#NodeSelector" class="headerlink" title="NodeSelector"></a>NodeSelector</h3>
                  <p>Graph 有时候用起来不太方便，比如如果要根据多个条件进行 Node 的查询是做不到的，在这里更方便的查询方法是利用 NodeSelector，我们首先新建如下的 Node 和 Relationship，实例如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> py2neo import Graph, Node, Relationship</span><br><span class="line"></span><br><span class="line">graph = Graph(<span class="attribute">password</span>=<span class="string">'123456'</span>)</span><br><span class="line">a = Node(<span class="string">'Person'</span>, <span class="attribute">name</span>=<span class="string">'Alice'</span>, <span class="attribute">age</span>=21, <span class="attribute">location</span>=<span class="string">'广州'</span>)</span><br><span class="line">b = Node(<span class="string">'Person'</span>, <span class="attribute">name</span>=<span class="string">'Bob'</span>, <span class="attribute">age</span>=22, <span class="attribute">location</span>=<span class="string">'上海'</span>)</span><br><span class="line">c = Node(<span class="string">'Person'</span>, <span class="attribute">name</span>=<span class="string">'Mike'</span>, <span class="attribute">age</span>=21, <span class="attribute">location</span>=<span class="string">'北京'</span>)</span><br><span class="line">r1 = Relationship(a, <span class="string">'KNOWS'</span>, b)</span><br><span class="line">r2 = Relationship(b, <span class="string">'KNOWS'</span>, c)</span><br><span class="line">graph.create(a)</span><br><span class="line">graph.create(r1)</span><br><span class="line">graph.create(r2)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果： <img src="https://germey.gitbooks.io/ai/content/assets/2017-08-31-23-38-27.jpg" alt=""> 在这里我们用 NodeSelector 来筛选 age 为 21 的 Person Node，实例如下：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> py2neo import Graph, NodeSelector</span><br><span class="line"></span><br><span class="line">graph = Graph(<span class="attribute">password</span>=<span class="string">'123456'</span>)</span><br><span class="line">selector = NodeSelector(graph)</span><br><span class="line">persons = selector.select(<span class="string">'Person'</span>, <span class="attribute">age</span>=21)</span><br><span class="line"><span class="builtin-name">print</span>(list(persons))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[(<span class="string">d195b2e:</span>Person &#123;<span class="string">age:</span><span class="number">21</span>,<span class="string">location:</span><span class="string">"广州"</span>,<span class="string">name:</span><span class="string">"Alice"</span>&#125;), (<span class="string">eefe475:</span>Person &#123;<span class="string">age:</span><span class="number">21</span>,<span class="string">location:</span><span class="string">"北京"</span>,<span class="string">name:</span><span class="string">"Mike"</span>&#125;)]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外也可以使用 where() 进行更复杂的查询，例如查找 name 是 A 开头的 Person Node，实例如下：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> py2neo <span class="keyword">import</span> Graph, NodeSelector</span><br><span class="line"></span><br><span class="line">graph = Graph(<span class="keyword">password</span>=<span class="string">'123456'</span>)</span><br><span class="line">selector = NodeSelector(graph)</span><br><span class="line">persons = selector.<span class="keyword">select</span>(<span class="string">'Person'</span>).<span class="keyword">where</span>(<span class="string">'_.name =~ "A.*"'</span>)</span><br><span class="line">print(list(persons))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight clojure">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[(<span class="name">bcd8072:Person</span> &#123;age:21,location:<span class="string">"广州"</span>,name:<span class="string">"Alice"</span>&#125;)]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里用了正则表达式匹配查询。 另外也可以使用 order_by() 进行排序：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from py2neo import Graph, NodeSelector</span><br><span class="line"></span><br><span class="line">graph = <span class="constructor">Graph(<span class="params">password</span>='123456')</span></span><br><span class="line">selector = <span class="constructor">NodeSelector(<span class="params">graph</span>)</span></span><br><span class="line">persons = selector.select('Person').order<span class="constructor">_by('<span class="params">_</span>.<span class="params">age</span>')</span></span><br><span class="line">print(<span class="built_in">list</span>(persons))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[(<span class="string">e3fc3d7:</span>Person &#123;<span class="string">age:</span><span class="number">21</span>,<span class="string">location:</span><span class="string">"广州"</span>,<span class="string">name:</span><span class="string">"Alice"</span>&#125;), (<span class="string">da0179d:</span>Person &#123;<span class="string">age:</span><span class="number">21</span>,<span class="string">location:</span><span class="string">"北京"</span>,<span class="string">name:</span><span class="string">"Mike"</span>&#125;), (<span class="string">cafa16e:</span>Person &#123;<span class="string">age:</span><span class="number">22</span>,<span class="string">location:</span><span class="string">"上海"</span>,<span class="string">name:</span><span class="string">"Bob"</span>&#125;)]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>前面返回的都是列表，如果要查询单个节点的话，可以使用 first() 方法，实例如下：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> py2neo <span class="keyword">import</span> Graph, NodeSelector</span><br><span class="line"></span><br><span class="line">graph = Graph(<span class="keyword">password</span>=<span class="string">'123456'</span>)</span><br><span class="line">selector = NodeSelector(graph)</span><br><span class="line">person = selector.<span class="keyword">select</span>(<span class="string">'Person'</span>).<span class="keyword">where</span>(<span class="string">'_.name =~ "A.*"'</span>).first()</span><br><span class="line">print(person)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">(<span class="selector-tag">ea81c04</span><span class="selector-pseudo">:Person</span> &#123;<span class="attribute">age</span>:<span class="number">21</span>,location:<span class="string">"广州"</span>,name:<span class="string">"Alice"</span>&#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>更详细的内容可以查看：<a href="http://py2neo.org/v3/database.html#cypher-utilities" target="_blank" rel="noopener">http://py2neo.org/v3/database.html#cypher-utilities</a>。</p>
                  <h3 id="OGM"><a href="#OGM" class="headerlink" title="OGM"></a>OGM</h3>
                  <p>OGM 类似于 ORM，意为 Object Graph Mapping，这样可以实现一个对象和 Node 的关联，例如：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> py2neo.ogm <span class="keyword">import</span> GraphObject, Property, RelatedTo, RelatedFrom</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="symbol">Movie</span>(<span class="symbol">GraphObject</span>):</span><br><span class="line">    <span class="symbol">__primarykey__</span> = '<span class="symbol">title</span>'</span><br><span class="line"></span><br><span class="line">    <span class="symbol">title</span> = <span class="symbol">Property</span>()</span><br><span class="line">    <span class="symbol">released</span> = <span class="symbol">Property</span>()</span><br><span class="line">    <span class="symbol">actors</span> = <span class="symbol">RelatedFrom</span>('<span class="symbol">Person</span>', '<span class="symbol">ACTED_IN</span>')</span><br><span class="line">    <span class="symbol">directors</span> = <span class="symbol">RelatedFrom</span>('<span class="symbol">Person</span>', '<span class="symbol">DIRECTED</span>')</span><br><span class="line">    <span class="symbol">producers</span> = <span class="symbol">RelatedFrom</span>('<span class="symbol">Person</span>', '<span class="symbol">PRODUCED</span>')</span><br><span class="line"></span><br><span class="line"><span class="symbol">class</span> <span class="symbol">Person</span>(<span class="symbol">GraphObject</span>):</span><br><span class="line">    <span class="symbol">__primarykey__</span> = '<span class="symbol">name</span>'</span><br><span class="line"></span><br><span class="line">    <span class="symbol">name</span> = <span class="symbol">Property</span>()</span><br><span class="line">    <span class="symbol">born</span> = <span class="symbol">Property</span>()</span><br><span class="line">    <span class="symbol">acted_in</span> = <span class="symbol">RelatedTo</span>('<span class="symbol">Movie</span>')</span><br><span class="line">    <span class="symbol">directed</span> = <span class="symbol">RelatedTo</span>('<span class="symbol">Movie</span>')</span><br><span class="line">    <span class="symbol">produced</span> = <span class="symbol">RelatedTo</span>('<span class="symbol">Movie</span>')</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们可以用它来结合 Graph 查询，例如：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> py2neo import Graph</span><br><span class="line"><span class="keyword">from</span> py2neo.ogm import GraphObject, Property</span><br><span class="line"></span><br><span class="line">graph = Graph(<span class="attribute">password</span>=<span class="string">'123456'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Person(GraphObject):</span><br><span class="line">    __primarykey__ = <span class="string">'name'</span></span><br><span class="line"></span><br><span class="line">    name = Property()</span><br><span class="line">    age = Property()</span><br><span class="line">    location = Property()</span><br><span class="line"></span><br><span class="line">person = Person.select(graph).where(<span class="attribute">age</span>=21).first()</span><br><span class="line"><span class="builtin-name">print</span>(person)</span><br><span class="line"><span class="builtin-name">print</span>(person.name)</span><br><span class="line"><span class="builtin-name">print</span>(person.age)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;Person <span class="attribute">name</span>=<span class="string">'Alice'</span>&gt;</span><br><span class="line">Alice</span><br><span class="line">21</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们就成功实现了对象和 Node 的映射。 我们可以用它动态改变 Node 的属性，例如修改某个 Node 的 age 属性，实例如下：</p>
                  <figure class="highlight crmsh">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">person = Person.select(graph).where(<span class="attr">age=</span><span class="number">21</span>).first()</span><br><span class="line">print(person.__ogm__.<span class="keyword">node</span><span class="title">)</span></span><br><span class="line"><span class="title">person</span>.age = <span class="number">22</span></span><br><span class="line">print(person.__ogm__.<span class="keyword">node</span><span class="title">)</span></span><br><span class="line"><span class="title">graph</span>.push(person)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">(<span class="selector-tag">ccf5640</span><span class="selector-pseudo">:Person</span> &#123;<span class="attribute">age</span>:<span class="number">21</span>,location:<span class="string">"北京"</span>,name:<span class="string">"Mike"</span>&#125;)</span><br><span class="line">(<span class="selector-tag">ccf5640</span><span class="selector-pseudo">:Person</span> &#123;<span class="attribute">age</span>:<span class="number">22</span>,location:<span class="string">"北京"</span>,name:<span class="string">"Mike"</span>&#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外我们也可以通过映射关系进行 Relationship 的调整，例如通过 Relationship 添加一个关联 Node，实例如下：</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> py2neo <span class="keyword">import</span> Graph</span><br><span class="line"><span class="keyword">from</span> py2neo.ogm <span class="keyword">import</span> GraphObject, Property, RelatedTo</span><br><span class="line"></span><br><span class="line">graph = Graph(<span class="keyword">password</span>=<span class="string">'123456'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Person(GraphObject):</span><br><span class="line">    __primarykey__ = <span class="string">'name'</span></span><br><span class="line"></span><br><span class="line">    <span class="type">name</span> = Property()</span><br><span class="line">    age = Property()</span><br><span class="line">    <span class="keyword">location</span> = Property()</span><br><span class="line">    knows = RelatedTo(<span class="string">'Person'</span>, <span class="string">'KNOWS'</span>)</span><br><span class="line"></span><br><span class="line">person = Person.<span class="keyword">select</span>(graph).<span class="keyword">where</span>(age=<span class="number">21</span>).first()</span><br><span class="line">print(list(person.knows))</span><br><span class="line">new_person = Person()</span><br><span class="line">new_person.name = <span class="string">'Durant'</span></span><br><span class="line">new_person.age = <span class="number">28</span></span><br><span class="line">person.knows.<span class="keyword">add</span>(new_person)</span><br><span class="line">print(list(person.knows))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight fsharp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">[&lt;Person name='Bob'&gt;]</span></span><br><span class="line"><span class="meta">[&lt;Person name='Bob'&gt;, &lt;Person name='Durant'&gt;]</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们就完成了 Node 和 Relationship 的添加，同时由于设置了 primarykey 为 name，所以不会重复添加。 但是注意此时数据库并没有更新，只是对象更新了，如果要更新到数据库中还需要调用 Graph 对象的 push() 或 pull() 方法，添加如下代码即可：</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">graph</span><span class="selector-class">.push</span>(<span class="selector-tag">person</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>也可以通过 remove() 方法移除某个关联 Node，实例如下：</p>
                  <figure class="highlight fortran">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">person = Person.<span class="keyword">select</span>(graph).<span class="keyword">where</span>(<span class="keyword">name</span>=<span class="string">'Alice'</span>).first()</span><br><span class="line"><span class="keyword">target</span> = Person.<span class="keyword">select</span>(graph).<span class="keyword">where</span>(<span class="keyword">name</span>=<span class="string">'Durant'</span>).first()</span><br><span class="line">person.knows.remove(<span class="keyword">target</span>)</span><br><span class="line">graph.push(person)</span><br><span class="line">graph.delete(<span class="keyword">target</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里 target 是 name 为 Durant 的 Node，代码运行完毕后即可删除关联 Relationship 和删除 Node。 以上便是 OGM 的用法，查询修改非常方便，推荐使用此方法进行 Node 和 Relationship 的修改。 更多内容可以查看：<a href="http://py2neo.org/v3/ogm.html#module-py2neo.ogm" target="_blank" rel="noopener">http://py2neo.org/v3/ogm.html#module-py2neo.ogm</a>。</p>
                  <h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2>
                  <p>以上便是对 Neo4j 的相关介绍。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2017-09-01 01:29:20" itemprop="dateCreated datePublished" datetime="2017-09-01T01:29:20+08:00">2017-09-01</time>
                </span>
                <span id="/4778.html" class="post-meta-item leancloud_visitors" data-flag-title="Neo4j简介及Py2Neo的用法" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>12k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>11 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/4759.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/4759.html" class="post-title-link" itemprop="url">记scikit-learn贝叶斯文本分类的坑（弄了个笨办法解决了，有其它办法的小哥儿请指点）</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>基本步骤： 1、训练素材分类： 我是参考官方的目录结构： <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2017/08/s01.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2017/08/s01.png" alt=""></a> 每个目录中放对应的文本，一个 txt 文件一篇对应的文章：就像下面这样 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2017/08/s02.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2017/08/s02.png" alt=""></a> 需要注意的是所有素材比例请保持在相同的比例（根据训练结果酌情调整、不可比例过于悬殊、容易造成过拟合（通俗点就是大部分文章都给你分到素材最多的那个类别去了）） 废话不多说直接上代码吧（测试代码的丑得一逼；将就着看看吧） 需要一个小工具： pip install chinese-tokenizer 这是训练器：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> jieba</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="keyword">from</span> chinese_tokenizer.tokenizer <span class="keyword">import</span> Tokenizer</span><br><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> load_files</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> CountVectorizer, TfidfTransformer</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"><span class="keyword">from</span> sklearn.naive_bayes <span class="keyword">import</span> MultinomialNB</span><br><span class="line"><span class="keyword">from</span> sklearn.externals <span class="keyword">import</span> joblib</span><br><span class="line"></span><br><span class="line">jie_ba_tokenizer = Tokenizer().jie_ba_tokenizer</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载数据集</span></span><br><span class="line">training_data = load_files(<span class="string">'./data'</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line"><span class="comment"># x_train txt内容 y_train 是类别（正 负 中 ）</span></span><br><span class="line">x_train, _, y_train, _ = train_test_split(training_data.data, training_data.target)</span><br><span class="line">print(<span class="string">'开始建模.....'</span>)</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'training_data.target'</span>, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(json.dumps(training_data.target_names))</span><br><span class="line"><span class="comment"># tokenizer参数是用来对文本进行分词的函数（就是上面我们结巴分词）</span></span><br><span class="line">count_vect = CountVectorizer(tokenizer=jieba_tokenizer)</span><br><span class="line"></span><br><span class="line">tfidf_transformer = TfidfTransformer()</span><br><span class="line">X_train_counts = count_vect.fit_transform(x_train)</span><br><span class="line"></span><br><span class="line">X_train_tfidf = tfidf_transformer.fit_transform(X_train_counts)</span><br><span class="line">print(<span class="string">'正在训练分类器.....'</span>)</span><br><span class="line"><span class="comment"># 多项式贝叶斯分类器训练</span></span><br><span class="line">clf = MultinomialNB().fit(X_train_tfidf, y_train)</span><br><span class="line"><span class="comment"># 保存分类器（好在其它程序中使用）</span></span><br><span class="line">joblib.dump(clf, <span class="string">'model.pkl'</span>)</span><br><span class="line"><span class="comment"># 保存矢量化（坑在这儿！！需要使用和训练器相同的 矢量器 不然会报错！！！！！！ 提示 ValueError dimension mismatch··）</span></span><br><span class="line">joblib.dump(count_vect, <span class="string">'count_vect'</span>)</span><br><span class="line">print(<span class="string">"分类器的相关信息："</span>)</span><br><span class="line">print(clf)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>下面是是使用训练好的分类器分类文章： <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2017/08/s03.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2017/08/s03.png" alt=""></a> 需要分类的文章放在 predict_data 目录中：照样是一篇文章一个 txt 文件</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"># -*- coding: utf<span class="number">-8</span> -*-</span><br><span class="line"># @<span class="type">Time</span>    : <span class="number">2017</span>/<span class="number">8</span>/<span class="number">23</span> <span class="number">18</span>:<span class="number">02</span></span><br><span class="line"># @Author  : 哎哟卧槽</span><br><span class="line"># @Site    :</span><br><span class="line"># @File    : 贝叶斯分类器.py</span><br><span class="line"># @Software: PyCharm</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> jieba</span><br><span class="line"><span class="keyword">import</span> <span class="type">json</span></span><br><span class="line"><span class="keyword">from</span> sklearn.datasets <span class="keyword">import</span> load_files</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> CountVectorizer, TfidfTransformer</span><br><span class="line"><span class="keyword">from</span> sklearn.externals <span class="keyword">import</span> joblib</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 加载分类器</span><br><span class="line">clf = joblib.<span class="keyword">load</span>(<span class="string">'model.pkl'</span>)</span><br><span class="line"></span><br><span class="line">count_vect = joblib.<span class="keyword">load</span>(<span class="string">'count_vect'</span>)</span><br><span class="line">testing_data = load_files(<span class="string">'./predict_data'</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">target_names = <span class="type">json</span>.loads(<span class="keyword">open</span>(<span class="string">'training_data.target'</span>, <span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>).<span class="keyword">read</span>())</span><br><span class="line">#     # 字符串处理</span><br><span class="line">tfidf_transformer = TfidfTransformer()</span><br><span class="line"></span><br><span class="line">X_new_counts = count_vect.<span class="keyword">transform</span>(testing_data.data)</span><br><span class="line">X_new_tfidf = tfidf_transformer.fit_transform(X_new_counts)</span><br><span class="line"># 进行预测</span><br><span class="line">predicted = clf.predict(X_new_tfidf)</span><br><span class="line"><span class="keyword">for</span> title, category <span class="keyword">in</span> zip(testing_data.filenames, predicted):</span><br><span class="line">    print(<span class="string">'%r =&gt; %s'</span> % (title, target_names[category]))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这个样子将训练好的分类器在新的程序中使用时候 就不报错： ValueError dimension mismatch·· 这儿有个 demo 仅供参考：<a href="https://github.com/thsheep/sklearn_naive_bayes_classification" target="_blank" rel="noopener">GitHub 地址</a></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/哎哟卧槽" class="author" itemprop="url" rel="index">哎哟卧槽</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2017-08-23 18:49:44" itemprop="dateCreated datePublished" datetime="2017-08-23T18:49:44+08:00">2017-08-23</time>
                </span>
                <span id="/4759.html" class="post-meta-item leancloud_visitors" data-flag-title="记scikit-learn贝叶斯文本分类的坑（弄了个笨办法解决了，有其它办法的小哥儿请指点）" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.4k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/4725.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/4725.html" class="post-title-link" itemprop="url">小白进阶之Scrapy第五篇（Scrapy-Splash配合CrawlSpider；瞎几把整的）</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>估摸着各位小伙伴儿被想使用 CrawlSpider 的 Rule 来抓取 JS，相当受折磨； CrawlSpider Rule 总是不能和 Splash 结合。 废话不多说，手疼····</p>
                  <h1 id="方法-1："><a href="#方法-1：" class="headerlink" title="方法 1："></a><strong>方法 1：</strong></h1>
                  <p>写一个自定义的函数，使用 Rule 中的 process_request 参数；来替换掉 Rule 本身 Request 的逻辑。 参考官方文档： <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2017/07/QQ20170712-002911.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2017/07/QQ20170712-002911.png" alt=""></a> 1、将请求更换为 SplashRequest 请求： 2、每次请求将本次请求的 URL 使用 Meta 参数传递下去； 3、重写 _requests_to_follow 方法：替换响应 Response 的 URL 为我们传递的 URL（否则会格式为 Splash 的地址） 就像下面这样</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySpider</span><span class="params">(CrawlSpider)</span>:</span></span><br><span class="line"></span><br><span class="line">    name = <span class="string">'innda'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start_requests</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">yield</span> SplashRequest(url, dont_process_response=<span class="literal">True</span>, args=&#123;<span class="string">'wait'</span>: <span class="number">0.5</span>&#125;, meta=&#123;<span class="string">'real_url'</span>: url&#125;)</span><br><span class="line"></span><br><span class="line">    rules = (</span><br><span class="line">        Rule(LinkExtractor(allow=(<span class="string">'node_\d+\.htm'</span>,)), process_request=<span class="string">'splash_request'</span>, follow=<span class="literal">True</span>),</span><br><span class="line">        Rule(LinkExtractor(allow=(<span class="string">'content_\d+\.htm'</span>,)), callback=<span class="string">"one_parse"</span>)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">splash_request</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :param request: Request对象（是一个字典；怎么取值就不说了吧！！）</span></span><br><span class="line"><span class="string">        :return: SplashRequest的请求</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># dont_process_response=True 参数表示不更改响应对象类型（默认为：HTMLResponse；更改后为：SplashTextResponse）</span></span><br><span class="line">        <span class="comment"># args=&#123;'wait': 0.5&#125; 表示传递等待参数0.5（Splash会渲染0.5s的时间）</span></span><br><span class="line">        <span class="comment"># meta 传递请求的当前请求的URL</span></span><br><span class="line">        <span class="keyword">return</span> SplashRequest(url=request.url, dont_process_response=<span class="literal">True</span>, args=&#123;<span class="string">'wait'</span>: <span class="number">0.5</span>&#125;, meta=&#123;<span class="string">'real_url'</span>: request.url&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_requests_to_follow</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        <span class="string">"""重写的函数哈！这个函数是Rule的一个方法</span></span><br><span class="line"><span class="string">        :param response: 这货是啥看名字都知道了吧（这货也是个字典，然后你懂的ｄ(･∀･*)♪ﾟ）</span></span><br><span class="line"><span class="string">        :return: 追踪的Request</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(response, HtmlResponse):</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        seen = set()</span><br><span class="line">        <span class="comment"># 将Response的URL更改为我们传递下来的URL</span></span><br><span class="line">        <span class="comment"># 需要注意哈！ 不能直接直接改！只能通过Response.replace这个魔术方法来改！（当然你改无所谓啦！反正会用报错来报复你 (`皿´) ）并且！！！</span></span><br><span class="line">        <span class="comment"># 敲黑板！！！！划重点！！！！！注意了！！！ 这货只能赋给一个新的对象（你说变量也行，怎么说都行！(*ﾟ∀ﾟ)=3）</span></span><br><span class="line">        newresponse = response.replace(url=response.meta.get(<span class="string">'real_url'</span>))</span><br><span class="line">        <span class="keyword">for</span> n, rule <span class="keyword">in</span> enumerate(self._rules):</span><br><span class="line">            <span class="comment"># 我要长一点不然有人看不见------------------------------------newresponse 看见没！别忘了改！！！</span></span><br><span class="line">            links = [lnk <span class="keyword">for</span> lnk <span class="keyword">in</span> rule.link_extractor.extract_links(newresponse)</span><br><span class="line">                     <span class="keyword">if</span> lnk <span class="keyword">not</span> <span class="keyword">in</span> seen]</span><br><span class="line">            <span class="keyword">if</span> links <span class="keyword">and</span> rule.process_links:</span><br><span class="line">                links = rule.process_links(links)</span><br><span class="line">            <span class="keyword">for</span> link <span class="keyword">in</span> links:</span><br><span class="line">                seen.add(link)</span><br><span class="line">                r = self._build_request(n, link)</span><br><span class="line">                <span class="keyword">yield</span> rule.process_request(r)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">one_parse</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        print(response.url)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h2 id="方法-2"><a href="#方法-2" class="headerlink" title="方法 2:"></a>方法 2:</h2>
                  <p>这就很简单啦！干掉类型检查就是了(/≧▽≦)/ 就像这样：</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySpider</span><span class="params">(CrawlSpider)</span>:</span></span><br><span class="line"></span><br><span class="line">    name = <span class="string">'innda'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start_requests</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">yield</span> SplashRequest(url, args=&#123;<span class="string">'wait'</span>: <span class="number">0.5</span>&#125;)</span><br><span class="line"></span><br><span class="line">    rules = (</span><br><span class="line">        Rule(LinkExtractor(allow=(<span class="string">'node_\d+\.htm'</span>,)), process_request=<span class="string">'splash_request'</span>, follow=<span class="literal">True</span>),</span><br><span class="line">        Rule(LinkExtractor(allow=(<span class="string">'content_\d+\.htm'</span>,)), callback=<span class="string">"one_parse"</span>)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">splash_request</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :param request: Request对象（是一个字典；怎么取值就不说了吧！！）</span></span><br><span class="line"><span class="string">        :return: SplashRequest的请求</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># dont_process_response=True 参数表示不更改响应对象类型（默认为：HTMLResponse；更改后为：SplashTextResponse）</span></span><br><span class="line">        <span class="comment"># args=&#123;'wait': 0.5&#125; 表示传递等待参数0.5（Splash会渲染0.5s的时间）</span></span><br><span class="line">        <span class="comment"># meta 传递请求的当前请求的URL</span></span><br><span class="line">        <span class="keyword">return</span> SplashRequest(url=request.url, args=&#123;<span class="string">'wait'</span>: <span class="number">0.5</span>&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_requests_to_follow</span><span class="params">(self, response)</span>:</span></span><br><span class="line">        <span class="string">"""重写的函数哈！这个函数是Rule的一个方法</span></span><br><span class="line"><span class="string">        :param response: 这货是啥看名字都知道了吧（这货也是个字典，然后你懂的ｄ(･∀･*)♪ﾟ）</span></span><br><span class="line"><span class="string">        :return: 追踪的Request</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># *************请注意我就是被注释注释掉的类型检查o(TωT)o </span></span><br><span class="line">        <span class="comment"># if not isinstance(response, HtmlResponse):</span></span><br><span class="line">        <span class="comment">#     return</span></span><br><span class="line">        <span class="comment"># ************************************************</span></span><br><span class="line">        seen = set()</span><br><span class="line">        <span class="comment"># 将Response的URL更改为我们传递下来的URL</span></span><br><span class="line">        <span class="comment"># 需要注意哈！ 不能直接直接改！只能通过Response.replace这个魔术方法来改！并且！！！</span></span><br><span class="line">        <span class="comment"># 敲黑板！！！！划重点！！！！！注意了！！！ 这货只能赋给一个新的对象（你说变量也行，怎么说都行！(*ﾟ∀ﾟ)=3）</span></span><br><span class="line">        <span class="comment"># newresponse = response.replace(url=response.meta.get('real_url'))</span></span><br><span class="line">        <span class="keyword">for</span> n, rule <span class="keyword">in</span> enumerate(self._rules):</span><br><span class="line">            <span class="comment"># 我要长一点不然有人看不见------------------------------------newresponse 看见没！别忘了改！！！</span></span><br><span class="line">            links = [lnk <span class="keyword">for</span> lnk <span class="keyword">in</span> rule.link_extractor.extract_links(response)</span><br><span class="line">                     <span class="keyword">if</span> lnk <span class="keyword">not</span> <span class="keyword">in</span> seen]</span><br><span class="line">            <span class="keyword">if</span> links <span class="keyword">and</span> rule.process_links:</span><br><span class="line">                links = rule.process_links(links)</span><br><span class="line">            <span class="keyword">for</span> link <span class="keyword">in</span> links:</span><br><span class="line">                seen.add(link)</span><br><span class="line">                r = self._build_request(n, link)</span><br><span class="line">                <span class="keyword">yield</span> rule.process_request(r)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上完毕@_@!!</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/哎哟卧槽" class="author" itemprop="url" rel="index">哎哟卧槽</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2017-07-12 00:48:25" itemprop="dateCreated datePublished" datetime="2017-07-12T00:48:25+08:00">2017-07-12</time>
                </span>
                <span id="/4725.html" class="post-meta-item leancloud_visitors" data-flag-title="小白进阶之Scrapy第五篇（Scrapy-Splash配合CrawlSpider；瞎几把整的）" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>3.4k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <script>
              document.querySelectorAll('.random').forEach(item => item.src = "https://picsum.photos/id/" + Math.floor(Math.random() * Math.floor(300)) + "/200/133")

            </script>
            <nav class="pagination">
              <a class="extend prev" rel="prev" href="/page/12/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><span class="page-number current">13</span><a class="page-number" href="/page/14/">14</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/14/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
            </nav>
          </div>
          <script>
            window.addEventListener('tabs:register', () =>
            {
              let
              {
                activeClass
              } = CONFIG.comments;
              if (CONFIG.comments.storage)
              {
                activeClass = localStorage.getItem('comments_active') || activeClass;
              }
              if (activeClass)
              {
                let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
                if (activeTab)
                {
                  activeTab.click();
                }
              }
            });
            if (CONFIG.comments.storage)
            {
              window.addEventListener('tabs:click', event =>
              {
                if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
                let commentClass = event.target.classList[1];
                localStorage.setItem('comments_active', commentClass);
              });
            }

          </script>
        </div>
        <div class="toggle sidebar-toggle">
          <span class="toggle-line toggle-line-first"></span>
          <span class="toggle-line toggle-line-middle"></span>
          <span class="toggle-line toggle-line-last"></span>
        </div>
        <aside class="sidebar">
          <div class="sidebar-inner">
            <ul class="sidebar-nav motion-element">
              <li class="sidebar-nav-toc"> 文章目录 </li>
              <li class="sidebar-nav-overview"> 站点概览 </li>
            </ul>
            <!--noindex-->
            <div class="post-toc-wrap sidebar-panel">
            </div>
            <!--/noindex-->
            <div class="site-overview-wrap sidebar-panel">
              <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <img class="site-author-image" itemprop="image" alt="崔庆才" src="/images/avatar.png">
                <p class="site-author-name" itemprop="name">崔庆才</p>
                <div class="site-description" itemprop="description">静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。</div>
              </div>
              <div class="site-state-wrap motion-element">
                <nav class="site-state">
                  <div class="site-state-item site-state-posts">
                    <a href="/archives/">
                      <span class="site-state-item-count">710</span>
                      <span class="site-state-item-name">日志</span>
                    </a>
                  </div>
                  <div class="site-state-item site-state-categories">
                    <a href="/categories/">
                      <span class="site-state-item-count">43</span>
                      <span class="site-state-item-name">分类</span></a>
                  </div>
                  <div class="site-state-item site-state-tags">
                    <a href="/tags/">
                      <span class="site-state-item-count">260</span>
                      <span class="site-state-item-name">标签</span></a>
                  </div>
                </nav>
              </div>
              <div class="links-of-author motion-element">
                <span class="links-of-author-item">
                  <a href="https://github.com/Germey" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Germey" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
                </span>
                <span class="links-of-author-item">
                  <a href="mailto:cqc@cuiqingcai.com.com" title="邮件 → mailto:cqc@cuiqingcai.com.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>邮件</a>
                </span>
                <span class="links-of-author-item">
                  <a href="https://weibo.com/cuiqingcai" title="微博 → https:&#x2F;&#x2F;weibo.com&#x2F;cuiqingcai" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>微博</a>
                </span>
                <span class="links-of-author-item">
                  <a href="https://www.zhihu.com/people/Germey" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;Germey" rel="noopener" target="_blank"><i class="fa fa-magic fa-fw"></i>知乎</a>
                </span>
              </div>
            </div>
            <div style=" width: 100%;" class="sidebar-panel sidebar-panel-image sidebar-panel-active">
              <a href="https://item.jd.com/13527222.html" target="_blank" rel="noopener">
                <img src="https://cdn.cuiqingcai.com/ei5og.jpg" style=" width: 100%;">
              </a>
            </div>
            <div class="sidebar-panel sidebar-panel-categories sidebar-panel-active">
              <h4 class="name"> 分类 </h4>
              <div class="content">
                <ul class="category-list">
                  <li class="category-list-item"><a class="category-list-link" href="/categories/API/">API</a><span class="category-list-count">6</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/C-C/">C/C++</a><span class="category-list-count">23</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Claude/">Claude</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Gemini/">Gemini</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Google-SERP/">Google SERP</a><span class="category-list-count">2</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/HTML/">HTML</a><span class="category-list-count">14</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">5</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/">JavaScript</a><span class="category-list-count">26</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">14</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Luma/">Luma</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Markdown/">Markdown</a><span class="category-list-count">2</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Midjourney/">Midjourney</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Nano-Banana/">Nano Banana</a><span class="category-list-count">2</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Net/">Net</a><span class="category-list-count">4</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Nexior/">Nexior</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Other/">Other</a><span class="category-list-count">40</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a><span class="category-list-count">27</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Paper/">Paper</a><span class="category-list-count">2</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Producer/">Producer</a><span class="category-list-count">2</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">303</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/SeeDance/">SeeDance</a><span class="category-list-count">5</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/SeeDream/">SeeDream</a><span class="category-list-count">3</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Sora/">Sora</a><span class="category-list-count">2</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/TypeScript/">TypeScript</a><span class="category-list-count">2</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Veo/">Veo</a><span class="category-list-count">3</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/nano-banana/">nano-banana</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E5%B1%95%E7%A4%BA/">个人展示</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E6%97%A5%E8%AE%B0/">个人日记</a><span class="category-list-count">9</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E8%AE%B0%E5%BD%95/">个人记录</a><span class="category-list-count">6</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E9%9A%8F%E7%AC%94/">个人随笔</a><span class="category-list-count">21</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/">人工智能</a><span class="category-list-count">6</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/">安装配置</a><span class="category-list-count">59</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%9D%82%E8%B0%88/">技术杂谈</a><span class="category-list-count">96</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9C%AA%E5%88%86%E7%B1%BB/">未分类</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">深度学习</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E7%88%AC%E8%99%AB/">爬虫</a><span class="category-list-count">4</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E7%94%9F%E6%B4%BB%E7%AC%94%E8%AE%B0/">生活笔记</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E7%A6%8F%E5%88%A9%E4%B8%93%E5%8C%BA/">福利专区</a><span class="category-list-count">6</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E8%81%8C%E4%BD%8D%E6%8E%A8%E8%8D%90/">职位推荐</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E8%89%BA%E6%9C%AF%E4%BA%8C%E7%BB%B4%E7%A0%81/">艺术二维码</a><span class="category-list-count">1</span></li>
                </ul>
              </div>
            </div>
            <div class="sidebar-panel sidebar-panel-friends sidebar-panel-active">
              <h4 class="name"> 友情链接 </h4>
              <ul class="friends">
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/j2dub.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.findhao.net/" target="_blank" rel="noopener">FindHao</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/6apxu.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.51dev.com/" target="_blank" rel="noopener">IT技术社区</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/bqlbs.png">
                  </span>
                  <span class="link">
                    <a href="http://www.urselect.com/" target="_blank" rel="noopener">优社电商</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/8s88c.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.yuanrenxue.com/" target="_blank" rel="noopener">猿人学</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/2wgg5.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.yunlifang.cn/" target="_blank" rel="noopener">云立方</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="http://qianxunclub.com/favicon.png">
                  </span>
                  <span class="link">
                    <a href="http://qianxunclub.com/" target="_blank" rel="noopener">千寻啊千寻</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/0044u.jpg">
                  </span>
                  <span class="link">
                    <a href="http://kodcloud.com/" target="_blank" rel="noopener">可道云</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/ygnpn.jpg">
                  </span>
                  <span class="link">
                    <a href="http://www.kunkundashen.cn/" target="_blank" rel="noopener">坤坤大神</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/x714o.jpg">
                  </span>
                  <span class="link">
                    <a href="http://www.hubwiz.com/" target="_blank" rel="noopener">汇智网</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/44hxf.png">
                  </span>
                  <span class="link">
                    <a href="http://redstonewill.com/" target="_blank" rel="noopener">红色石头</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/wkaus.jpg">
                  </span>
                  <span class="link">
                    <a href="https://zhaoshuai.me/" target="_blank" rel="noopener">碎念</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/pgo0r.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.chenwenguan.com/" target="_blank" rel="noopener">陈文管的博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/kk82a.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.lxlinux.net/" target="_blank" rel="noopener">良许Linux教程网</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/lj0t2.jpg">
                  </span>
                  <span class="link">
                    <a href="https://tanqingbo.cn/" target="_blank" rel="noopener">IT码农</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/i8cdr.png">
                  </span>
                  <span class="link">
                    <a href="https://junyiseo.com/" target="_blank" rel="noopener">均益个人博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/chwv2.png">
                  </span>
                  <span class="link">
                    <a href="https://brucedone.com/" target="_blank" rel="noopener">大鱼的鱼塘</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://www.91vps.com/favicon.ico">
                  </span>
                  <span class="link">
                    <a href="http://www.91vps.com/" target="_blank" rel="noopener">91VPS</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://webpage.qidian.qq.com/qidian/chatv3-gray/favicon.ico">
                  </span>
                  <span class="link">
                    <a href="https://www.qg.net/" target="_blank" rel="noopener">青果网络</a>
                  </span>
                </li>
              </ul>
            </div>
            <div class="sidebar-panel sidebar-panel-tags sidebar-panel-active">
              <h4 class="name"> 标签云 </h4>
              <div class="content">
                <a href="/tags/2022/" style="font-size: 20px;">2022</a> <a href="/tags/2048/" style="font-size: 10px;">2048</a> <a href="/tags/ACE-Data/" style="font-size: 13px;">ACE Data</a> <a href="/tags/ADSL/" style="font-size: 10px;">ADSL</a> <a href="/tags/AI%E7%BC%96%E7%A8%8B/" style="font-size: 10px;">AI编程</a> <a href="/tags/API/" style="font-size: 19px;">API</a> <a href="/tags/Ajax/" style="font-size: 12px;">Ajax</a> <a href="/tags/Audios/" style="font-size: 11px;">Audios</a> <a href="/tags/Bootstrap/" style="font-size: 11px;">Bootstrap</a> <a href="/tags/Bug/" style="font-size: 10px;">Bug</a> <a href="/tags/CDN/" style="font-size: 10px;">CDN</a> <a href="/tags/CQC/" style="font-size: 10px;">CQC</a> <a href="/tags/CSS/" style="font-size: 10px;">CSS</a> <a href="/tags/CSS-%E5%8F%8D%E7%88%AC%E8%99%AB/" style="font-size: 10px;">CSS 反爬虫</a> <a href="/tags/CV/" style="font-size: 10px;">CV</a> <a href="/tags/ChatGPT/" style="font-size: 10px;">ChatGPT</a> <a href="/tags/Cookie/" style="font-size: 10px;">Cookie</a> <a href="/tags/Django/" style="font-size: 10px;">Django</a> <a href="/tags/Eclipse/" style="font-size: 11px;">Eclipse</a> <a href="/tags/Elasticsearch/" style="font-size: 10px;">Elasticsearch</a> <a href="/tags/FTP/" style="font-size: 10px;">FTP</a> <a href="/tags/Flux/" style="font-size: 10px;">Flux</a> <a href="/tags/Gemini/" style="font-size: 10px;">Gemini</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/GitHub/" style="font-size: 13px;">GitHub</a> <a href="/tags/Google-SERP/" style="font-size: 11px;">Google SERP</a> <a href="/tags/HTML5/" style="font-size: 10px;">HTML5</a> <a href="/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="/tags/Hailuo/" style="font-size: 10px;">Hailuo</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/Hook/" style="font-size: 10px;">Hook</a> <a href="/tags/IP/" style="font-size: 10px;">IP</a> <a href="/tags/IT/" style="font-size: 10px;">IT</a> <a href="/tags/Images/" style="font-size: 11px;">Images</a> <a href="/tags/JSON/" style="font-size: 10px;">JSON</a> <a href="/tags/JSP/" style="font-size: 10px;">JSP</a> <a href="/tags/JavaScript/" style="font-size: 14px;">JavaScript</a> <a href="/tags/K8s/" style="font-size: 10px;">K8s</a> <a href="/tags/LOGO/" style="font-size: 10px;">LOGO</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/Luma/" style="font-size: 10px;">Luma</a> <a href="/tags/MIUI/" style="font-size: 10px;">MIUI</a> <a href="/tags/Markdown/" style="font-size: 10px;">Markdown</a> <a href="/tags/Midjourney/" style="font-size: 12px;">Midjourney</a> <a href="/tags/MongoDB/" style="font-size: 11px;">MongoDB</a> <a href="/tags/MySQL/" style="font-size: 10px;">MySQL</a> <a href="/tags/Mysql/" style="font-size: 10px;">Mysql</a> <a href="/tags/NBA/" style="font-size: 10px;">NBA</a> <a href="/tags/Nano-Banana/" style="font-size: 11px;">Nano Banana</a> <a href="/tags/Nexior/" style="font-size: 10px;">Nexior</a> <a href="/tags/OCR/" style="font-size: 10px;">OCR</a> <a href="/tags/OpenCV/" style="font-size: 10px;">OpenCV</a> <a href="/tags/PHP/" style="font-size: 11px;">PHP</a> <a href="/tags/PPT/" style="font-size: 10px;">PPT</a> <a href="/tags/PS/" style="font-size: 10px;">PS</a> <a href="/tags/Pathlib/" style="font-size: 10px;">Pathlib</a> <a href="/tags/PhantomJS/" style="font-size: 10px;">PhantomJS</a> <a href="/tags/Playwright/" style="font-size: 10px;">Playwright</a> <a href="/tags/Producer/" style="font-size: 11px;">Producer</a> <a href="/tags/Python/" style="font-size: 16px;">Python</a> <a href="/tags/Python-%E7%88%AC%E8%99%AB/" style="font-size: 17px;">Python 爬虫</a> <a href="/tags/Python3/" style="font-size: 11px;">Python3</a> <a href="/tags/Python3%E7%88%AC%E8%99%AB%E6%95%99%E7%A8%8B/" style="font-size: 12px;">Python3爬虫教程</a> <a href="/tags/Pythonic/" style="font-size: 10px;">Pythonic</a> <a href="/tags/Python%E7%88%AC%E8%99%AB/" style="font-size: 18px;">Python爬虫</a> <a href="/tags/Python%E7%88%AC%E8%99%AB%E4%B9%A6/" style="font-size: 12px;">Python爬虫书</a> <a href="/tags/Python%E7%88%AC%E8%99%AB%E6%95%99%E7%A8%8B/" style="font-size: 15px;">Python爬虫教程</a> <a href="/tags/QQ/" style="font-size: 10px;">QQ</a> <a href="/tags/RabbitMQ/" style="font-size: 10px;">RabbitMQ</a> <a href="/tags/ReCAPTCHA/" style="font-size: 10px;">ReCAPTCHA</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/Riffusion/" style="font-size: 11px;">Riffusion</a> <a href="/tags/SAE/" style="font-size: 10px;">SAE</a> <a href="/tags/SSH/" style="font-size: 10px;">SSH</a> <a href="/tags/SVG/" style="font-size: 10px;">SVG</a> <a href="/tags/Scrapy-redis/" style="font-size: 10px;">Scrapy-redis</a> <a href="/tags/Scrapy%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 10px;">Scrapy分布式</a> <a href="/tags/SeeDance/" style="font-size: 14px;">SeeDance</a> <a href="/tags/SeeDream/" style="font-size: 12px;">SeeDream</a> <a href="/tags/Selenium/" style="font-size: 11px;">Selenium</a> <a href="/tags/Session/" style="font-size: 10px;">Session</a> <a href="/tags/Shell/" style="font-size: 10px;">Shell</a> <a href="/tags/Sora/" style="font-size: 10px;">Sora</a> <a href="/tags/Sora2/" style="font-size: 11px;">Sora2</a> <a href="/tags/Suno/" style="font-size: 11px;">Suno</a> <a href="/tags/TKE/" style="font-size: 10px;">TKE</a> <a href="/tags/TXT/" style="font-size: 10px;">TXT</a> <a href="/tags/Terminal/" style="font-size: 10px;">Terminal</a> <a href="/tags/Ubuntu/" style="font-size: 11px;">Ubuntu</a> <a href="/tags/VS-Code/" style="font-size: 10px;">VS Code</a> <a href="/tags/Veo/" style="font-size: 13px;">Veo</a> <a href="/tags/Vercel/" style="font-size: 10px;">Vercel</a> <a href="/tags/Videos/" style="font-size: 12px;">Videos</a> <a href="/tags/Vs-Code/" style="font-size: 10px;">Vs Code</a> <a href="/tags/Vue/" style="font-size: 11px;">Vue</a> <a href="/tags/Web/" style="font-size: 10px;">Web</a> <a href="/tags/Webpack/" style="font-size: 10px;">Webpack</a> <a href="/tags/Web%E7%BD%91%E9%A1%B5/" style="font-size: 10px;">Web网页</a> <a href="/tags/Windows/" style="font-size: 10px;">Windows</a> <a href="/tags/Winpcap/" style="font-size: 10px;">Winpcap</a>
              </div>
              <script>
                const tagsColors = ['#00a67c', '#5cb85c', '#d9534f', '#567e95', '#b37333', '#f4843d', '#15a287']
                const tagsElements = document.querySelectorAll('.sidebar-panel-tags .content a')
                tagsElements.forEach((item) =>
                {
                  item.style.backgroundColor = tagsColors[Math.floor(Math.random() * tagsColors.length)]
                })

              </script>
            </div>
          </div>
        </aside>
        <div id="sidebar-dimmer"></div>
      </div>
    </main>
    <footer class="footer">
      <div class="footer-inner">
        <div class="copyright">
          <span class="author" itemprop="copyrightHolder">崔庆才丨静觅</span> &copy; <span itemprop="copyrightYear">2026</span>
          <span class="with-love">
            <i class="fa fa-heart"></i>
          </span>
          <a href="https://cuiqingcai.com/sitemap.xml" style="display:none" title="爬虫教程" target="_blank"><strong>爬虫教程</strong></a>
          <a href="https://cuiqingcai.com/sitemap.html" style="display:none" title="爬虫教程" target="_blank"><strong>爬虫教程</strong></a>
          <span class="post-meta-divider">|</span>
          <span class="post-meta-item-icon">
            <i class="fa fa-chart-area"></i>
          </span>
          <span title="站点总字数">3.5m</span>
          <span class="post-meta-divider">|</span>
          <span class="post-meta-item-icon">
            <i class="fa fa-coffee"></i>
          </span>
          <span title="站点阅读时长">52:30</span>
        </div>
        <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动 </div>
        <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">京ICP备18015597号-1 </a>
        </div>
        <script>
          (function ()
          {
            function leancloudSelector(url)
            {
              url = encodeURI(url);
              return document.getElementById(url).querySelector('.leancloud-visitors-count');
            }

            function addCount(Counter)
            {
              var visitors = document.querySelector('.leancloud_visitors');
              var url = decodeURI(visitors.id);
              var title = visitors.dataset.flagTitle;
              Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify(
              {
                url
              }))).then(response => response.json()).then((
              {
                results
              }) =>
              {
                if (results.length > 0)
                {
                  var counter = results[0];
                  leancloudSelector(url).innerText = counter.time + 1;
                  Counter('put', '/classes/Counter/' + counter.objectId,
                  {
                    time:
                    {
                      '__op': 'Increment',
                      'amount': 1
                    }
                  }).catch(error =>
                  {
                    console.error('Failed to save visitor count', error);
                  });
                }
                else
                {
                  Counter('post', '/classes/Counter',
                  {
                    title,
                    url,
                    time: 1
                  }).then(response => response.json()).then(() =>
                  {
                    leancloudSelector(url).innerText = 1;
                  }).catch(error =>
                  {
                    console.error('Failed to create', error);
                  });
                }
              }).catch(error =>
              {
                console.error('LeanCloud Counter Error', error);
              });
            }

            function showTime(Counter)
            {
              var visitors = document.querySelectorAll('.leancloud_visitors');
              var entries = [...visitors].map(element =>
              {
                return decodeURI(element.id);
              });
              Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify(
              {
                url:
                {
                  '$in': entries
                }
              }))).then(response => response.json()).then((
              {
                results
              }) =>
              {
                for (let url of entries)
                {
                  let target = results.find(item => item.url === url);
                  leancloudSelector(url).innerText = target ? target.time : 0;
                }
              }).catch(error =>
              {
                console.error('LeanCloud Counter Error', error);
              });
            }
            let
            {
              app_id,
              app_key,
              server_url
            } = {
              "enable": true,
              "app_id": "6X5dRQ0pnPWJgYy8SXOg0uID-gzGzoHsz",
              "app_key": "ziLDVEy73ne5HtFTiGstzHMS",
              "server_url": "https://6x5drq0p.lc-cn-n1-shared.com",
              "security": false
            };

            function fetchData(api_server)
            {
              var Counter = (method, url, data) =>
              {
                return fetch(`${api_server}/1.1${url}`,
                {
                  method,
                  headers:
                  {
                    'X-LC-Id': app_id,
                    'X-LC-Key': app_key,
                    'Content-Type': 'application/json',
                  },
                  body: JSON.stringify(data)
                });
              };
              if (CONFIG.page.isPost)
              {
                if (CONFIG.hostname !== location.hostname) return;
                addCount(Counter);
              }
              else if (document.querySelectorAll('.post-title-link').length >= 1)
              {
                showTime(Counter);
              }
            }
            let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;
            if (api_server)
            {
              fetchData(api_server);
            }
            else
            {
              fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id).then(response => response.json()).then((
              {
                api_server
              }) =>
              {
                fetchData('https://' + api_server);
              });
            }
          })();

        </script>
      </div>
      <div class="footer-stat">
        <span id="cnzz_stat_icon_1279355174"></span>
        <script type="text/javascript">
          document.write(unescape("%3Cspan id='cnzz_stat_icon_1279355174'%3E%3C/span%3E%3Cscript src='https://v1.cnzz.com/z_stat.php%3Fid%3D1279355174%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"));

        </script>
      </div>
    </footer>
  </div>
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script src="/js/utils.js"></script>
  <script src="/.js"></script>
  <script src="/js/schemes/pisces.js"></script>
  <script src="/.js"></script>
  <script src="/js/next-boot.js"></script>
  <script src="/.js"></script>
  <script>
    (function ()
    {
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x = document.getElementsByTagName("link");
      //Find the last canonical URL
      if (x.length > 0)
      {
        for (i = 0; i < x.length; i++)
        {
          if (x[i].rel.toLowerCase() == 'canonical' && x[i].href)
          {
            canonicalURL = x[i].href;
          }
        }
      }
      //Get protocol
      if (!canonicalURL)
      {
        curProtocol = window.location.protocol.split(':')[0];
      }
      else
      {
        curProtocol = canonicalURL.split(':')[0];
      }
      //Get current URL if the canonical URL does not exist
      if (!canonicalURL) canonicalURL = window.location.href;
      //Assign script content. Replace current URL with the canonical URL
      ! function ()
      {
        var e = /([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,
          r = canonicalURL,
          t = document.referrer;
        if (!e.test(r))
        {
          var n = (String(curProtocol).toLowerCase() === 'https') ? "https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif" : "//api.share.baidu.com/s.gif";
          t ? (n += "?r=" + encodeURIComponent(document.referrer), r && (n += "&l=" + r)) : r && (n += "?l=" + r);
          var i = new Image;
          i.src = n
        }
      }(window);
    })();

  </script>
  <script src="/js/local-search.js"></script>
  <script src="/.js"></script>
</body>

</html>
