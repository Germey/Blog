<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
  <meta name="theme-color" content="#222">
  <meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>
  <script id="hexo-configurations">
    var NexT = window.NexT ||
    {};
    var CONFIG = {
      "hostname": "cuiqingcai.com",
      "root": "/",
      "scheme": "Pisces",
      "version": "7.8.0",
      "exturl": false,
      "sidebar":
      {
        "position": "right",
        "width": 360,
        "display": "post",
        "padding": 18,
        "offset": 12,
        "onmobile": false,
        "widgets": [
          {
            "type": "image",
            "name": "阿布云",
            "enable": false,
            "url": "https://www.abuyun.com/http-proxy/introduce.html",
            "src": "https://cdn.cuiqingcai.com/88au8.jpg",
            "width": "100%"
      },
          {
            "type": "image",
            "name": "爬虫书",
            "url": "https://item.jd.com/13527222.html",
            "src": "https://cdn.cuiqingcai.com/ei5og.jpg",
            "width": "100%",
            "enable": true
      },
          {
            "type": "categories",
            "name": "分类",
            "enable": true
      },
          {
            "type": "image",
            "name": "IPIDEA",
            "url": "http://www.ipidea.net/?utm-source=cqc&utm-keyword=?cqc",
            "src": "https://cdn.cuiqingcai.com/0ywun.png",
            "width": "100%",
            "enable": false
      },
          {
            "type": "image",
            "name": "Storm Proxies",
            "src": "https://cdn.cuiqingcai.com/a2zad8.png",
            "url": "https://www.stormproxies.cn/?keyword=jingmi",
            "width": "100%",
            "enable": false
      },
          {
            "type": "friends",
            "name": "友情链接",
            "enable": true
      },
          {
            "type": "hot",
            "name": "猜你喜欢",
            "enable": true
      },
          {
            "type": "tags",
            "name": "标签云",
            "enable": true
      }]
      },
      "copycode":
      {
        "enable": true,
        "show_result": true,
        "style": "mac"
      },
      "back2top":
      {
        "enable": true,
        "sidebar": false,
        "scrollpercent": true
      },
      "bookmark":
      {
        "enable": false,
        "color": "#222",
        "save": "auto"
      },
      "fancybox": false,
      "mediumzoom": false,
      "lazyload": false,
      "pangu": true,
      "comments":
      {
        "style": "tabs",
        "active": "gitalk",
        "storage": true,
        "lazyload": false,
        "nav": null,
        "activeClass": "gitalk"
      },
      "algolia":
      {
        "hits":
        {
          "per_page": 10
        },
        "labels":
        {
          "input_placeholder": "Search for Posts",
          "hits_empty": "We didn't find any results for the search: ${query}",
          "hits_stats": "${hits} results found in ${time} ms"
        }
      },
      "localsearch":
      {
        "enable": true,
        "trigger": "auto",
        "top_n_per_article": 10,
        "unescape": false,
        "preload": false
      },
      "motion":
      {
        "enable": false,
        "async": false,
        "transition":
        {
          "post_block": "bounceDownIn",
          "post_header": "slideDownIn",
          "post_body": "slideDownIn",
          "coll_header": "slideLeftIn",
          "sidebar": "slideUpIn"
        }
      },
      "path": "search.xml"
    };

  </script>
  <meta name="keywords" content="爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书,静觅,崔庆才">
  <meta name="robots" content="index,follow">
  <meta name="GOOGLEBOT" content="index,follow">
  <meta name="author" content="静觅丨崔庆才的个人站点">
  <meta name="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  <meta property="og:type" content="website">
  <meta property="og:title" content="静觅">
  <meta property="og:url" content="https://cuiqingcai.com/page/15/index.html">
  <meta property="og:site_name" content="静觅">
  <meta property="og:description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  <meta property="og:locale" content="zh_CN">
  <meta property="article:author" content="崔庆才">
  <meta property="article:tag" content="爬虫教程">
  <meta property="article:tag" content="爬虫">
  <meta property="article:tag" content="Python">
  <meta property="article:tag" content="Python爬虫">
  <meta property="article:tag" content="Python爬虫教程">
  <meta property="article:tag" content="爬虫书">
  <meta property="article:tag" content="静觅">
  <meta property="article:tag" content="崔庆才">
  <meta name="twitter:card" content="summary">
  <link rel="canonical" href="https://cuiqingcai.com/page/15/">
  <script id="page-configurations">
    // https://hexo.io/docs/variables.html
    CONFIG.page = {
      sidebar: "",
      isHome: true,
      isPost: false,
      lang: 'zh-CN'
    };

  </script>
  <title>静觅丨崔庆才的个人站点 - Python爬虫教程</title>
  <meta name="google-site-verification" content="p_bIcnvirkFzG2dYKuNDivKD8-STet5W7D-01woA2fc" />
  <meta name="sogou_site_verification" content="kBOV53NQqT" />
  <noscript>
    <style>
      .use-motion .brand,
      .use-motion .menu-item,
      .sidebar-inner,
      .use-motion .post-block,
      .use-motion .pagination,
      .use-motion .comments,
      .use-motion .post-header,
      .use-motion .post-body,
      .use-motion .collection-header
      {
        opacity: initial;
      }

      .use-motion .site-title,
      .use-motion .site-subtitle
      {
        opacity: initial;
        top: initial;
      }

      .use-motion .logo-line-before i
      {
        left: initial;
      }

      .use-motion .logo-line-after i
      {
        right: initial;
      }

    </style>
  </noscript>
  <link rel="alternate" href="/atom.xml" title="静觅" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner">
        <div class="site-brand-container">
          <div class="site-nav-toggle">
            <div class="toggle" aria-label="切换导航栏">
              <span class="toggle-line toggle-line-first"></span>
              <span class="toggle-line toggle-line-middle"></span>
              <span class="toggle-line toggle-line-last"></span>
            </div>
          </div>
          <div class="site-meta">
            <a href="/" class="brand" rel="start">
              <span class="logo-line-before"><i></i></span>
              <h1 class="site-title">静觅 <span class="site-subtitle"> 崔庆才的个人站点 - Python爬虫教程 </span>
              </h1>
              <span class="logo-line-after"><i></i></span>
            </a>
          </div>
          <div class="site-nav-right">
            <div class="toggle popup-trigger">
              <i class="fa fa-search fa-fw fa-lg"></i>
            </div>
          </div>
        </div>
        <nav class="site-nav">
          <ul id="menu" class="main-menu menu">
            <li class="menu-item menu-item-home">
              <a href="/" rel="section">首页</a>
            </li>
            <li class="menu-item menu-item-archives">
              <a href="/archives/" rel="section">文章列表</a>
            </li>
            <li class="menu-item menu-item-tags">
              <a href="/tags/" rel="section">文章标签</a>
            </li>
            <li class="menu-item menu-item-categories">
              <a href="/categories/" rel="section">文章分类</a>
            </li>
            <li class="menu-item menu-item-about">
              <a href="/about/" rel="section">关于博主</a>
            </li>
            <li class="menu-item menu-item-message">
              <a href="/message/" rel="section">给我留言</a>
            </li>
            <li class="menu-item menu-item-search">
              <a role="button" class="popup-trigger">搜索 </a>
            </li>
          </ul>
        </nav>
        <div class="search-pop-overlay">
          <div class="popup search-popup">
            <div class="search-header">
              <span class="search-icon">
                <i class="fa fa-search"></i>
              </span>
              <div class="search-input-container">
                <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input">
              </div>
              <span class="popup-btn-close">
                <i class="fa fa-times-circle"></i>
              </span>
            </div>
            <div id="search-result">
              <div id="no-result">
                <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>
    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
      <span>0%</span>
    </div>
    <div class="reading-progress-bar"></div>
    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div class="content index posts-expand">
            <div class="carousel">
              <div id="wowslider-container">
                <div class="ws_images">
                  <ul>
                    <li><a target="_blank" href="https://item.jd.com/13527222.html"><img title="Python3网络爬虫开发实战（第二版）上市了！" src="https://cdn.cuiqingcai.com/prwgs.png" /></a></li>
                    <li><a target="_blank" href="https://t.lagou.com/fRCBRsRCSN6FA"><img title="52讲轻松搞定网络爬虫" src="https://cdn.cuiqingcai.com/fqq5e.png" /></a></li>
                    <li><a target="_blank" href="https://cuiqingcai.com/4320.html"><img title="Python3网络爬虫开发视频教程" src="https://cdn.cuiqingcai.com/bjrny.jpg" /></a></li>
                    <li><a target="_blank" href="https://cuiqingcai.com/5094.html"><img title="爬虫代理哪家强？十大付费代理详细对比评测出炉！" src="https://cdn.cuiqingcai.com/nifs6.jpg" /></a></li>
                  </ul>
                </div>
                <div class="ws_thumbs">
                  <div>
                    <a target="_blank" href="#"><img src="https://cdn.cuiqingcai.com/prwgs.png" /></a>
                    <a target="_blank" href="#"><img src="https://cdn.cuiqingcai.com/fqq5e.png" /></a>
                    <a target="_blank" href="#"><img src="https://cdn.cuiqingcai.com/bjrny.jpg" /></a>
                    <a target="_blank" href="#"><img src="https://cdn.cuiqingcai.com/nifs6.jpg" /></a>
                  </div>
                </div>
                <div class="ws_shadow"></div>
              </div>
            </div>
            <link rel="stylesheet" href="/lib/wowslide/slide.css">
            <script src="/lib/wowslide/jquery.min.js"></script>
            <script src="/lib/wowslide/slider.js"></script>
            <script>
              jQuery("#wowslider-container").wowSlider(
              {
                effect: "cube",
                prev: "",
                next: "",
                duration: 20 * 100,
                delay: 100 * 100,
                width: 716,
                height: 297,
                autoPlay: true,
                playPause: true,
                stopOnHover: false,
                loop: false,
                bullets: 0,
                caption: true,
                captionEffect: "slide",
                controls: true,
                onBeforeStep: 0,
                images: 0
              });

            </script>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2636.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/2636.html" class="post-title-link" itemprop="url">Python爬虫利器六之PyQuery的用法</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="2022-年最新-Python3-网络爬虫教程"><a href="#2022-年最新-Python3-网络爬虫教程" class="headerlink" title="2022 年最新 Python3 网络爬虫教程"></a>2022 年最新 Python3 网络爬虫教程</h2>
                  <p>大家好，我是崔庆才，由于爬虫技术不断迭代升级，一些旧的教程已经过时、案例已经过期，最前沿的爬虫技术比如异步、JavaScript 逆向、安卓逆向、智能解析、WebAssembly、大规模分布式、Kubernetes 等技术层出不穷，我最近新出了一套最新最全面的 Python3 网络爬虫系列教程。</p>
                  <blockquote>
                    <p>博主自荐：截止 2022 年，可以将最前沿最全面的爬虫技术都涵盖的教程，如异步、JavaScript 逆向、安卓逆向、智能解析、WebAssembly、大规模分布式、Kubernetes 等，市面上目前就这一套了。</p>
                  </blockquote>
                  <p>最新教程对旧的爬虫技术内容进行了全面更新，搭建了全新的案例平台进行全面讲解，保证案例稳定有效不过期。</p>
                  <p>教程请移步：</p>
                  <p><a href="https://cuiqingcai.com/17777.html">【2022 版】Python3 网络爬虫学习教程</a></p>
                  <p>如下为原文。</p>
                  <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2>
                  <p>你是否觉得 XPath 的用法多少有点晦涩难记呢？ 你是否觉得 BeautifulSoup 的语法多少有些悭吝难懂呢？ 你是否甚至还在苦苦研究正则表达式却因为少些了一个点而抓狂呢？ 你是否已经有了一些前端基础了解选择器却与另外一些奇怪的选择器语法混淆了呢？ 嗯，那么，前端大大们的福音来了，PyQuery 来了，乍听名字，你一定联想到了 jQuery，如果你对 jQuery 熟悉，那么 PyQuery 来解析文档就是不二之选！包括我在内！ PyQuery 是 Python 仿照 jQuery 的严格实现。语法与 jQuery 几乎完全相同，所以不用再去费心去记一些奇怪的方法了。 天下竟然有这等好事？我都等不及了！</p>
                  <h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2>
                  <p>有这等神器还不赶紧安装了！来！</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip <span class="keyword">install</span> pyquery</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>还是原来的配方，还是熟悉的味道。</p>
                  <h2 id="参考来源"><a href="#参考来源" class="headerlink" title="参考来源"></a>参考来源</h2>
                  <p>本文内容参考官方文档，更多内容，大家可以去官方文档学习，毕竟那里才是最原汁原味的。 目前版本 1.2.4 (2016/3/24) <a href="https://pythonhosted.org/pyquery/" target="_blank" rel="noopener">官方文档</a></p>
                  <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2>
                  <blockquote>
                    <p>pyquery allows you to make jquery queries on xml documents. The API is as much as possible the similar to jquery. pyquery uses lxml for fast xml and html manipulation. This is not (or at least not yet) a library to produce or interact with javascript code. I just liked the jquery API and I missed it in python so I told myself “Hey let’s make jquery in python”. This is the result. It can be used for many purposes, one idea that I might try in the future is to use it for templating with pure http templates that you modify using pyquery. I can also be used for web scrapping or for theming applications with Deliverance.</p>
                  </blockquote>
                  <p>pyquery 可让你用 jQuery 的语法来对 xml 进行操作。这I和 jQuery 十分类似。如果利用 lxml，pyquery 对 xml 和 html 的处理将更快。 这个库不是（至少还不是）一个可以和 JavaScript交互的代码库，它只是非常像 jQuery API 而已。</p>
                  <h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2>
                  <p>在这里介绍四种初始化方式。 （1）直接字符串</p>
                  <figure class="highlight perl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from pyquery import PyQuery as pq</span><br><span class="line">doc = p<span class="string">q("&lt;html&gt;&lt;/html&gt;")</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>pq 参数可以直接传入 HTML 代码，doc 现在就相当于 jQuery 里面的 $ 符号了。 （2）lxml.etree</p>
                  <figure class="highlight perl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from lxml import etree</span><br><span class="line">doc = p<span class="string">q(etree.fromstring("&lt;html&gt;&lt;/html&gt;")</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以首先用 lxml 的 etree 处理一下代码，这样如果你的 HTML 代码出现一些不完整或者疏漏，都会自动转化为完整清晰结构的 HTML代码。 （3）直接传URL</p>
                  <figure class="highlight perl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from pyquery import PyQuery as pq</span><br><span class="line">doc = p<span class="string">q('http://www.baidu.com')</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里就像直接请求了一个网页一样，类似用 urllib2 来直接请求这个链接，得到 HTML 代码。 （4）传文件</p>
                  <figure class="highlight perl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from pyquery import PyQuery as pq</span><br><span class="line">doc = p<span class="string">q(filename='hello.html')</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以直接传某个路径的文件名。</p>
                  <h2 id="快速体验"><a href="#快速体验" class="headerlink" title="快速体验"></a>快速体验</h2>
                  <p>现在我们以本地文件为例，传入一个名字为 hello.html 的文件，文件内容为</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span>first item<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link2.html"</span>&gt;</span>second item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0 active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link3.html"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"bold"</span>&gt;</span>third item<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1 active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link4.html"</span>&gt;</span>fourth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link5.html"</span>&gt;</span>fifth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>编写如下程序</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> pyquery import PyQuery as pq</span><br><span class="line">doc = pq(<span class="attribute">filename</span>=<span class="string">'hello.html'</span>)</span><br><span class="line"><span class="builtin-name">print</span> doc.html()</span><br><span class="line"><span class="builtin-name">print</span> type(doc)</span><br><span class="line">li = doc(<span class="string">'li'</span>)</span><br><span class="line"><span class="builtin-name">print</span> type(li)</span><br><span class="line"><span class="builtin-name">print</span> li.text()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">    &lt;ul&gt;</span><br><span class="line">         &lt;li class=<span class="string">"item-0"</span>&gt;<span class="keyword">first</span> <span class="keyword">item</span>&lt;/li&gt;</span><br><span class="line">         &lt;li class=<span class="string">"item-1"</span>&gt;&lt;<span class="keyword">a</span> href=<span class="string">"link2.html"</span>&gt;<span class="keyword">second</span> <span class="keyword">item</span>&lt;/<span class="keyword">a</span>&gt;&lt;/li&gt;</span><br><span class="line">         &lt;li class=<span class="string">"item-0 active"</span>&gt;&lt;<span class="keyword">a</span> href=<span class="string">"link3.html"</span>&gt;&lt;span class=<span class="string">"bold"</span>&gt;<span class="keyword">third</span> <span class="keyword">item</span>&lt;/span&gt;&lt;/<span class="keyword">a</span>&gt;&lt;/li&gt;</span><br><span class="line">         &lt;li class=<span class="string">"item-1 active"</span>&gt;&lt;<span class="keyword">a</span> href=<span class="string">"link4.html"</span>&gt;<span class="keyword">fourth</span> <span class="keyword">item</span>&lt;/<span class="keyword">a</span>&gt;&lt;/li&gt;</span><br><span class="line">         &lt;li class=<span class="string">"item-0"</span>&gt;&lt;<span class="keyword">a</span> href=<span class="string">"link5.html"</span>&gt;<span class="keyword">fifth</span> <span class="keyword">item</span>&lt;/<span class="keyword">a</span>&gt;&lt;/li&gt;</span><br><span class="line">     &lt;/ul&gt;</span><br><span class="line"> </span><br><span class="line">&lt;class <span class="string">'pyquery.pyquery.PyQuery'</span>&gt;</span><br><span class="line">&lt;class <span class="string">'pyquery.pyquery.PyQuery'</span>&gt;</span><br><span class="line"><span class="keyword">first</span> <span class="keyword">item</span> <span class="keyword">second</span> <span class="keyword">item</span> <span class="keyword">third</span> <span class="keyword">item</span> <span class="keyword">fourth</span> <span class="keyword">item</span> <span class="keyword">fifth</span> <span class="keyword">item</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>看，回忆一下 jQuery 的语法，是不是运行结果都是一样的呢？ 在这里我们注意到了一点，PyQuery 初始化之后，返回类型是 PyQuery，利用了选择器筛选一次之后，返回结果的类型依然还是 PyQuery，这简直和 jQuery 如出一辙，不能更赞！然而想一下 BeautifulSoup 和 XPath 返回的是什么？列表！一种不能再进行二次筛选（在这里指依然利用 BeautifulSoup 或者 XPath 语法）的对象！ 然而比比 PyQuery，哦我简直太爱它了！</p>
                  <h2 id="属性操作"><a href="#属性操作" class="headerlink" title="属性操作"></a>属性操作</h2>
                  <p>你可以完全按照 jQuery 的语法来进行 PyQuery 的操作。</p>
                  <figure class="highlight perl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from pyquery import PyQuery as pq</span><br><span class="line"></span><br><span class="line">p = p<span class="string">q('&lt;p id="hello" class="hello"&gt;&lt;/p&gt;')</span>(<span class="string">'p'</span>)</span><br><span class="line"><span class="keyword">print</span> p.attr(<span class="string">"id"</span>)</span><br><span class="line"><span class="keyword">print</span> p.attr(<span class="string">"id"</span>, <span class="string">"plop"</span>)</span><br><span class="line"><span class="keyword">print</span> p.attr(<span class="string">"id"</span>, <span class="string">"hello"</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">hello</span><br><span class="line">&lt;p <span class="attribute">id</span>=<span class="string">"plop"</span> <span class="attribute">class</span>=<span class="string">"hello"</span>/&gt;</span><br><span class="line">&lt;p <span class="attribute">id</span>=<span class="string">"hello"</span> <span class="attribute">class</span>=<span class="string">"hello"</span>/&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>再来一发</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> pyquery import PyQuery as pq</span><br><span class="line"></span><br><span class="line">p = pq(<span class="string">'&lt;p id="hello" class="hello"&gt;&lt;/p&gt;'</span>)(<span class="string">'p'</span>)</span><br><span class="line"><span class="builtin-name">print</span> p.addClass(<span class="string">'beauty'</span>)</span><br><span class="line"><span class="builtin-name">print</span> p.removeClass(<span class="string">'hello'</span>)</span><br><span class="line"><span class="builtin-name">print</span> p.css(<span class="string">'font-size'</span>, <span class="string">'16px'</span>)</span><br><span class="line"><span class="builtin-name">print</span> p.css(&#123;<span class="string">'background-color'</span>: <span class="string">'yellow'</span>&#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;p <span class="attribute">id</span>=<span class="string">"hello"</span> <span class="attribute">class</span>=<span class="string">"hello beauty"</span>/&gt;</span><br><span class="line">&lt;p <span class="attribute">id</span>=<span class="string">"hello"</span> <span class="attribute">class</span>=<span class="string">"beauty"</span>/&gt;</span><br><span class="line">&lt;p <span class="attribute">id</span>=<span class="string">"hello"</span> <span class="attribute">class</span>=<span class="string">"beauty"</span> <span class="attribute">style</span>=<span class="string">"font-size: 16px"</span>/&gt;</span><br><span class="line">&lt;p <span class="attribute">id</span>=<span class="string">"hello"</span> <span class="attribute">class</span>=<span class="string">"beauty"</span> <span class="attribute">style</span>=<span class="string">"font-size: 16px; background-color: yellow"</span>/&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>依旧是那么优雅与自信！ 在这里我们发现了，这是一连串的操作，而 p 是一直在原来的结果上变化的。 <strong>因此执行上述操作之后，p 本身也发生了变化。</strong></p>
                  <h2 id="DOM操作"><a href="#DOM操作" class="headerlink" title="DOM操作"></a>DOM操作</h2>
                  <p>同样的原汁原味的 jQuery 语法</p>
                  <figure class="highlight vbnet">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> pyquery import PyQuery <span class="keyword">as</span> pq</span><br><span class="line"></span><br><span class="line">p = pq(<span class="comment">'<span class="doctag">&lt;p id="hello" class="hello"&gt;</span><span class="doctag">&lt;/p&gt;</span>')('p')</span></span><br><span class="line">print p.append(<span class="comment">' check out <span class="doctag">&lt;a href="http://reddit.com/r/python"&gt;</span><span class="doctag">&lt;span&gt;</span>reddit<span class="doctag">&lt;/span&gt;</span><span class="doctag">&lt;/a&gt;</span>')</span></span><br><span class="line">print p.prepend(<span class="comment">'Oh yes!')</span></span><br><span class="line">d = pq(<span class="comment">'<span class="doctag">&lt;div class="wrap"&gt;</span><span class="doctag">&lt;div id="test"&gt;</span><span class="doctag">&lt;a href="http://cuiqingcai.com"&gt;</span>Germy<span class="doctag">&lt;/a&gt;</span><span class="doctag">&lt;/div&gt;</span><span class="doctag">&lt;/div&gt;</span>')</span></span><br><span class="line">p.prependTo(d(<span class="comment">'#test'))</span></span><br><span class="line">print p</span><br><span class="line">print d</span><br><span class="line">d.empty()</span><br><span class="line">print d</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"hello"</span> <span class="attr">class</span>=<span class="string">"hello"</span>&gt;</span> check out <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://reddit.com/r/python"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>reddit<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"hello"</span> <span class="attr">class</span>=<span class="string">"hello"</span>&gt;</span>Oh yes! check out <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://reddit.com/r/python"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>reddit<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"hello"</span> <span class="attr">class</span>=<span class="string">"hello"</span>&gt;</span>Oh yes! check out <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://reddit.com/r/python"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>reddit<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrap"</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"test"</span>&gt;</span><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">"hello"</span> <span class="attr">class</span>=<span class="string">"hello"</span>&gt;</span>Oh yes! check out <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://reddit.com/r/python"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>reddit<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"http://cuiqingcai.com"</span>&gt;</span>Germy<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrap"</span>/&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这不需要多解释了吧。 DOM 操作也是与 jQuery 如出一辙。</p>
                  <h2 id="遍历"><a href="#遍历" class="headerlink" title="遍历"></a>遍历</h2>
                  <p>遍历用到 items 方法返回对象列表，或者用 lambda</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> pyquery import PyQuery as pq</span><br><span class="line">doc = pq(<span class="attribute">filename</span>=<span class="string">'hello.html'</span>)</span><br><span class="line">lis = doc(<span class="string">'li'</span>)</span><br><span class="line"><span class="keyword">for</span> li <span class="keyword">in</span> lis.items():</span><br><span class="line">    <span class="builtin-name">print</span> li.html()</span><br><span class="line"></span><br><span class="line"><span class="builtin-name">print</span> lis.each(lambda e: e)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">first</span> <span class="keyword">item</span></span><br><span class="line">&lt;<span class="keyword">a</span> href=<span class="string">"link2.html"</span>&gt;<span class="keyword">second</span> <span class="keyword">item</span>&lt;/<span class="keyword">a</span>&gt;</span><br><span class="line">&lt;<span class="keyword">a</span> href=<span class="string">"link3.html"</span>&gt;&lt;span class=<span class="string">"bold"</span>&gt;<span class="keyword">third</span> <span class="keyword">item</span>&lt;/span&gt;&lt;/<span class="keyword">a</span>&gt;</span><br><span class="line">&lt;<span class="keyword">a</span> href=<span class="string">"link4.html"</span>&gt;<span class="keyword">fourth</span> <span class="keyword">item</span>&lt;/<span class="keyword">a</span>&gt;</span><br><span class="line">&lt;<span class="keyword">a</span> href=<span class="string">"link5.html"</span>&gt;<span class="keyword">fifth</span> <span class="keyword">item</span>&lt;/<span class="keyword">a</span>&gt;</span><br><span class="line">&lt;li class=<span class="string">"item-0"</span>&gt;<span class="keyword">first</span> <span class="keyword">item</span>&lt;/li&gt;</span><br><span class="line"> &lt;li class=<span class="string">"item-1"</span>&gt;&lt;<span class="keyword">a</span> href=<span class="string">"link2.html"</span>&gt;<span class="keyword">second</span> <span class="keyword">item</span>&lt;/<span class="keyword">a</span>&gt;&lt;/li&gt;</span><br><span class="line"> &lt;li class=<span class="string">"item-0 active"</span>&gt;&lt;<span class="keyword">a</span> href=<span class="string">"link3.html"</span>&gt;&lt;span class=<span class="string">"bold"</span>&gt;<span class="keyword">third</span> <span class="keyword">item</span>&lt;/span&gt;&lt;/<span class="keyword">a</span>&gt;&lt;/li&gt;</span><br><span class="line"> &lt;li class=<span class="string">"item-1 active"</span>&gt;&lt;<span class="keyword">a</span> href=<span class="string">"link4.html"</span>&gt;<span class="keyword">fourth</span> <span class="keyword">item</span>&lt;/<span class="keyword">a</span>&gt;&lt;/li&gt;</span><br><span class="line"> &lt;li class=<span class="string">"item-0"</span>&gt;&lt;<span class="keyword">a</span> href=<span class="string">"link5.html"</span>&gt;<span class="keyword">fifth</span> <span class="keyword">item</span>&lt;/<span class="keyword">a</span>&gt;&lt;/li&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>不过最常用的还是 items 方法</p>
                  <h2 id="网页请求"><a href="#网页请求" class="headerlink" title="网页请求"></a>网页请求</h2>
                  <p>PyQuery 本身还有网页请求功能，而且会把请求下来的网页代码转为 PyQuery 对象。</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> pyquery import PyQuery as pq</span><br><span class="line"><span class="builtin-name">print</span> pq(<span class="string">'http://cuiqingcai.com/'</span>, headers=&#123;<span class="string">'user-agent'</span>: <span class="string">'pyquery'</span>&#125;)</span><br><span class="line"><span class="builtin-name">print</span> pq(<span class="string">'http://httpbin.org/post'</span>, &#123;<span class="string">'foo'</span>: <span class="string">'bar'</span>&#125;, <span class="attribute">method</span>=<span class="string">'post'</span>, <span class="attribute">verify</span>=<span class="literal">True</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>感受一下，GET，POST，样样通。</p>
                  <h2 id="Ajax"><a href="#Ajax" class="headerlink" title="Ajax"></a>Ajax</h2>
                  <p>PyQuery 同样支持 Ajax 操作，带有 get 和 post 方法，不过不常用，一般我们不会用 PyQuery 来做网络请求，仅仅是用来解析。 <a href="https://pythonhosted.org/pyquery/ajax.html" target="_blank" rel="noopener">PyQueryAjax</a></p>
                  <h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2>
                  <p>最后少不了的，API大放送。 <a href="https://pythonhosted.org/pyquery/api.html" target="_blank" rel="noopener">API</a> 原汁原味最全的API，都在里面了！如果你对 jQuery 语法不熟，强烈建议先学习下 jQuery，再回来看 PyQuery，你会感到异常亲切！</p>
                  <h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2>
                  <p>用完了 PyQuery，我已经深深爱上了他！ 你呢？</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2016-03-24 01:44:18" itemprop="dateCreated datePublished" datetime="2016-03-24T01:44:18+08:00">2016-03-24</time>
                </span>
                <span id="/2636.html" class="post-meta-item leancloud_visitors" data-flag-title="Python爬虫利器六之PyQuery的用法" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>6.5k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>6 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2621.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/2621.html" class="post-title-link" itemprop="url">Python爬虫利器三之Xpath语法与lxml库的用法</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="2022-年最新-Python3-网络爬虫教程"><a href="#2022-年最新-Python3-网络爬虫教程" class="headerlink" title="2022 年最新 Python3 网络爬虫教程"></a>2022 年最新 Python3 网络爬虫教程</h2>
                  <p>大家好，我是崔庆才，由于爬虫技术不断迭代升级，一些旧的教程已经过时、案例已经过期，最前沿的爬虫技术比如异步、JavaScript 逆向、安卓逆向、智能解析、WebAssembly、大规模分布式、Kubernetes 等技术层出不穷，我最近新出了一套最新最全面的 Python3 网络爬虫系列教程。</p>
                  <blockquote>
                    <p>博主自荐：截止 2022 年，可以将最前沿最全面的爬虫技术都涵盖的教程，如异步、JavaScript 逆向、安卓逆向、智能解析、WebAssembly、大规模分布式、Kubernetes 等，市面上目前就这一套了。</p>
                  </blockquote>
                  <p>最新教程对旧的爬虫技术内容进行了全面更新，搭建了全新的案例平台进行全面讲解，保证案例稳定有效不过期。</p>
                  <p>教程请移步：</p>
                  <p><a href="https://cuiqingcai.com/17777.html">【2022 版】Python3 网络爬虫学习教程</a></p>
                  <h2 id="原文"><a href="#原文" class="headerlink" title="原文"></a>原文</h2>
                  <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2>
                  <p>前面我们介绍了 BeautifulSoup 的用法，这个已经是非常强大的库了，不过还有一些比较流行的解析库，例如 lxml，使用的是 Xpath 语法，同样是效率比较高的解析方法。如果大家对 BeautifulSoup 使用不太习惯的话，可以尝试下 Xpath。</p>
                  <h2 id="参考来源"><a href="#参考来源" class="headerlink" title="参考来源"></a>参考来源</h2>
                  <p>lxml用法源自 lxml python 官方文档，更多内容请直接参阅官方文档，本文对其进行翻译与整理。 <a href="http://lxml.de/index.html" target="_blank" rel="noopener">lxml</a> XPath语法参考 w3school <a href="http://www.w3school.com.cn/xpath/index.asp" target="_blank" rel="noopener">w3school</a></p>
                  <h2 id="视频资源"><a href="#视频资源" class="headerlink" title="视频资源"></a>视频资源</h2>
                  <p>如果你对 XPath 不熟悉的话，可以看下这个视频资源： <a href="https://www.imooc.com/learn/950" target="_blank" rel="noopener">web端功能自动化定位元素</a></p>
                  <h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip <span class="keyword">install</span> lxml</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>利用 pip 安装即可</p>
                  <h2 id="XPath语法"><a href="#XPath语法" class="headerlink" title="XPath语法"></a>XPath语法</h2>
                  <p>XPath 是一门在 XML 文档中查找信息的语言。XPath 可用来在 XML 文档中对元素和属性进行遍历。XPath 是 W3C XSLT 标准的主要元素，并且 XQuery 和 XPointer 都构建于 XPath 表达之上。</p>
                  <h3 id="节点关系"><a href="#节点关系" class="headerlink" title="节点关系"></a>节点关系</h3>
                  <p>（1）父（Parent） 每个元素以及属性都有一个父。 在下面的例子中，book 元素是 title、author、year 以及 price 元素的父：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">book</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Harry Potter<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">author</span>&gt;</span>J K. Rowling<span class="tag">&lt;/<span class="name">author</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">year</span>&gt;</span>2005<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">price</span>&gt;</span>29.99<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">book</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>（2）子（Children） 元素节点可有零个、一个或多个子。 在下面的例子中，title、author、year 以及 price 元素都是 book 元素的子：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">book</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Harry Potter<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">author</span>&gt;</span>J K. Rowling<span class="tag">&lt;/<span class="name">author</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">year</span>&gt;</span>2005<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">price</span>&gt;</span>29.99<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">book</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>（3）同胞（Sibling） 拥有相同的父的节点 在下面的例子中，title、author、year 以及 price 元素都是同胞：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">book</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Harry Potter<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">author</span>&gt;</span>J K. Rowling<span class="tag">&lt;/<span class="name">author</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">year</span>&gt;</span>2005<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">price</span>&gt;</span>29.99<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">book</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>（4）先辈（Ancestor） 某节点的父、父的父，等等。 在下面的例子中，title 元素的先辈是 book 元素和 bookstore 元素：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">bookstore</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">book</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Harry Potter<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">author</span>&gt;</span>J K. Rowling<span class="tag">&lt;/<span class="name">author</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">year</span>&gt;</span>2005<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">price</span>&gt;</span>29.99<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">book</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">bookstore</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>（5）后代（Descendant） 某个节点的子，子的子，等等。 在下面的例子中，bookstore 的后代是 book、title、author、year 以及 price 元素：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">bookstore</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">book</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Harry Potter<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">author</span>&gt;</span>J K. Rowling<span class="tag">&lt;/<span class="name">author</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">year</span>&gt;</span>2005<span class="tag">&lt;/<span class="name">year</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">price</span>&gt;</span>29.99<span class="tag">&lt;/<span class="name">price</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">book</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">bookstore</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="选取节点"><a href="#选取节点" class="headerlink" title="选取节点"></a>选取节点</h3>
                  <p>XPath 使用路径表达式在 XML 文档中选取节点。节点是通过沿着路径或者 step 来选取的。</p>
                  <h3 id="下面列出了最有用的路径表达式："><a href="#下面列出了最有用的路径表达式：" class="headerlink" title="下面列出了最有用的路径表达式："></a>下面列出了最有用的路径表达式：</h3>
                  <p>表达式</p>
                  <p>描述</p>
                  <p>nodename</p>
                  <p>选取此节点的所有子节点。</p>
                  <p>/</p>
                  <p>从根节点选取。</p>
                  <p>//</p>
                  <p>从匹配选择的当前节点选择文档中的节点，而不考虑它们的位置。</p>
                  <p>.</p>
                  <p>选取当前节点。</p>
                  <p>..</p>
                  <p>选取当前节点的父节点。</p>
                  <p>@</p>
                  <p>选取属性。</p>
                  <p><strong>实例</strong> 在下面的表格中，我们已列出了一些路径表达式以及表达式的结果：</p>
                  <p>路径表达式</p>
                  <p>结果</p>
                  <p>bookstore</p>
                  <p>选取 bookstore 元素的所有子节点。</p>
                  <p>/bookstore</p>
                  <p>选取根元素 bookstore。注释：假如路径起始于正斜杠( / )，则此路径始终代表到某元素的绝对路径！</p>
                  <p>bookstore/book</p>
                  <p>选取属于 bookstore 的子元素的所有 book 元素。</p>
                  <p>//book</p>
                  <p>选取所有 book 子元素，而不管它们在文档中的位置。</p>
                  <p>bookstore//book</p>
                  <p>选择属于 bookstore 元素的后代的所有 book 元素，而不管它们位于 bookstore 之下的什么位置。</p>
                  <p>//@lang</p>
                  <p>选取名为 lang 的所有属性。</p>
                  <h3 id="谓语（Predicates）"><a href="#谓语（Predicates）" class="headerlink" title="谓语（Predicates）"></a>谓语（Predicates）</h3>
                  <p>谓语用来查找某个特定的节点或者包含某个指定的值的节点。 谓语被嵌在方括号中。 <strong>实例</strong> 在下面的表格中，我们列出了带有谓语的一些路径表达式，以及表达式的结果：</p>
                  <p>路径表达式</p>
                  <p>结果</p>
                  <p>/bookstore/book[1]</p>
                  <p>选取属于 bookstore 子元素的第一个 book 元素。</p>
                  <p>/bookstore/book[last()]</p>
                  <p>选取属于 bookstore 子元素的最后一个 book 元素。</p>
                  <p>/bookstore/book[last()-1]</p>
                  <p>选取属于 bookstore 子元素的倒数第二个 book 元素。</p>
                  <p>/bookstore/book[position()&lt;3]</p>
                  <p>选取最前面的两个属于 bookstore 元素的子元素的 book 元素。</p>
                  <p>//title[@lang]</p>
                  <p>选取所有拥有名为 lang 的属性的 title 元素。</p>
                  <p>//title[@lang=’eng’]</p>
                  <p>选取所有 title 元素，且这些元素拥有值为 eng 的 lang 属性。</p>
                  <p>/bookstore/book[price&gt;35.00]</p>
                  <p>选取 bookstore 元素的所有 book 元素，且其中的 price 元素的值须大于 35.00。</p>
                  <p>/bookstore/book[price&gt;35.00]/title</p>
                  <p>选取 bookstore 元素中的 book 元素的所有 title 元素，且其中的 price 元素的值须大于 35.00。</p>
                  <h3 id="选取未知节点"><a href="#选取未知节点" class="headerlink" title="选取未知节点"></a>选取未知节点</h3>
                  <p>XPath 通配符可用来选取未知的 XML 元素。</p>
                  <p>通配符</p>
                  <p>描述</p>
                  <p>*</p>
                  <p>匹配任何元素节点。</p>
                  <p>@*</p>
                  <p>匹配任何属性节点。</p>
                  <p>node()</p>
                  <p>匹配任何类型的节点。</p>
                  <p><strong>实例</strong> 在下面的表格中，我们列出了一些路径表达式，以及这些表达式的结果：</p>
                  <p>路径表达式</p>
                  <p>结果</p>
                  <p>/bookstore/*</p>
                  <p>选取 bookstore 元素的所有子元素。</p>
                  <p>//*</p>
                  <p>选取文档中的所有元素。</p>
                  <p>//title[@*]</p>
                  <p>选取所有带有属性的 title 元素。</p>
                  <h3 id="选取若干路径"><a href="#选取若干路径" class="headerlink" title="选取若干路径"></a>选取若干路径</h3>
                  <p>通过在路径表达式中使用“|”运算符，您可以选取若干个路径。 <strong>实例</strong> 在下面的表格中，我们列出了一些路径表达式，以及这些表达式的结果：</p>
                  <p>路径表达式</p>
                  <p>结果</p>
                  <p>//book/title | //book/price</p>
                  <p>选取 book 元素的所有 title 和 price 元素。</p>
                  <p>//title | //price</p>
                  <p>选取文档中的所有 title 和 price 元素。</p>
                  <p>/bookstore/book/title | //price</p>
                  <p>选取属于 bookstore 元素的 book 元素的所有 title 元素，以及文档中所有的 price 元素。</p>
                  <h3 id="XPath-运算符"><a href="#XPath-运算符" class="headerlink" title="XPath 运算符"></a>XPath 运算符</h3>
                  <p>下面列出了可用在 XPath 表达式中的运算符：</p>
                  <p>运算符</p>
                  <p>描述</p>
                  <p>实例</p>
                  <p>返回值</p>
                  <p>|</p>
                  <p>计算两个节点集</p>
                  <p>//book | //cd</p>
                  <p>返回所有拥有 book 和 cd 元素的节点集</p>
                  <p>+</p>
                  <p>加法</p>
                  <p>6 + 4</p>
                  <p>10</p>
                  <p>-</p>
                  <p>减法</p>
                  <p>6 - 4</p>
                  <p>2</p>
                  <p>*</p>
                  <p>乘法</p>
                  <p>6 * 4</p>
                  <p>24</p>
                  <p>div</p>
                  <p>除法</p>
                  <p>8 div 4</p>
                  <p>2</p>
                  <p>\=</p>
                  <p>等于</p>
                  <p>price=9.80</p>
                  <p>如果 price 是 9.80，则返回 true。如果 price 是 9.90，则返回 false。</p>
                  <p>!=</p>
                  <p>不等于</p>
                  <p>price!=9.80</p>
                  <p>如果 price 是 9.90，则返回 true。如果 price 是 9.80，则返回 false。</p>
                  <p>&lt;</p>
                  <p>小于</p>
                  <p>price&lt;9.80</p>
                  <p>如果 price 是 9.00，则返回 true。如果 price 是 9.90，则返回 false。</p>
                  <p>&lt;=</p>
                  <p>小于或等于</p>
                  <p>price&lt;=9.80</p>
                  <p>如果 price 是 9.00，则返回 true。如果 price 是 9.90，则返回 false。</p>
                  <p>></p>
                  <p>大于</p>
                  <p>price&gt;9.80</p>
                  <p>如果 price 是 9.90，则返回 true。如果 price 是 9.80，则返回 false。</p>
                  <p>>=</p>
                  <p>大于或等于</p>
                  <p>price&gt;=9.80</p>
                  <p>如果 price 是 9.90，则返回 true。如果 price 是 9.70，则返回 false。</p>
                  <p>or</p>
                  <p>或</p>
                  <p>price=9.80 or price=9.70</p>
                  <p>如果 price 是 9.80，则返回 true。如果 price 是 9.50，则返回 false。</p>
                  <p>and</p>
                  <p>与</p>
                  <p>price&gt;9.00 and price&lt;9.90</p>
                  <p>如果 price 是 9.80，则返回 true。如果 price 是 8.50，则返回 false。</p>
                  <p>mod</p>
                  <p>计算除法的余数</p>
                  <p>5 mod 2</p>
                  <p>1</p>
                  <h2 id="lxml用法"><a href="#lxml用法" class="headerlink" title="lxml用法"></a>lxml用法</h2>
                  <h3 id="初步使用"><a href="#初步使用" class="headerlink" title="初步使用"></a>初步使用</h3>
                  <p>首先我们利用它来解析 HTML 代码，先来一个小例子来感受一下它的基本用法。</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">from lxml import etree</span><br><span class="line">text = '''</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link1.html"</span>&gt;</span>first item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link2.html"</span>&gt;</span>second item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-inactive"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link3.html"</span>&gt;</span>third item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link4.html"</span>&gt;</span>fourth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link5.html"</span>&gt;</span>fifth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">'''</span><br><span class="line">html = etree.HTML(text)</span><br><span class="line">result = etree.tostring(html)</span><br><span class="line">print(result)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>首先我们使用 lxml 的 etree 库，然后利用 etree.HTML 初始化，然后我们将其打印出来。 其中，这里体现了 lxml 的一个非常实用的功能就是自动修正 html 代码，大家应该注意到了，最后一个 li 标签，其实我把尾标签删掉了，是不闭合的。不过，lxml 因为继承了 libxml2 的特性，具有自动修正 HTML 代码的功能。 所以输出结果是这样的</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link1.html"</span>&gt;</span>first item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link2.html"</span>&gt;</span>second item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-inactive"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link3.html"</span>&gt;</span>third item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link4.html"</span>&gt;</span>fourth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link5.html"</span>&gt;</span>fifth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>不仅补全了 li 标签，还添加了 body，html 标签。</p>
                  <h3 id="文件读取"><a href="#文件读取" class="headerlink" title="文件读取"></a>文件读取</h3>
                  <p>除了直接读取字符串，还支持从文件读取内容。比如我们新建一个文件叫做 hello.html，内容为</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link1.html"</span>&gt;</span>first item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link2.html"</span>&gt;</span>second item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-inactive"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link3.html"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"bold"</span>&gt;</span>third item<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-1"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link4.html"</span>&gt;</span>fourth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item-0"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"link5.html"</span>&gt;</span>fifth item<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>利用 parse 方法来读取文件。</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> lxml import etree</span><br><span class="line">html = etree.parse(<span class="string">'hello.html'</span>)</span><br><span class="line">result = etree.tostring(html, <span class="attribute">pretty_print</span>=<span class="literal">True</span>)</span><br><span class="line"><span class="builtin-name">print</span>(result)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>同样可以得到相同的结果。</p>
                  <h3 id="XPath实例测试"><a href="#XPath实例测试" class="headerlink" title="XPath实例测试"></a>XPath实例测试</h3>
                  <p>依然以上一段程序为例 （1）获取所有的 <li> 标签</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> lxml import etree</span><br><span class="line">html = etree.parse(<span class="string">'hello.html'</span>)</span><br><span class="line"><span class="builtin-name">print</span> type(html)</span><br><span class="line">result = html.xpath(<span class="string">'//li'</span>)</span><br><span class="line"><span class="builtin-name">print</span> result</span><br><span class="line"><span class="builtin-name">print</span> len(result)</span><br><span class="line"><span class="builtin-name">print</span> type(result)</span><br><span class="line"><span class="builtin-name">print</span> type(result[0])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果</p>
                  <figure class="highlight fsharp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;<span class="class"><span class="keyword">type</span> '<span class="title">lxml</span>.<span class="title">etree</span>.<span class="title">_ElementTree</span>'&gt;</span></span><br><span class="line"><span class="meta">[&lt;Element li at 0x1014e0e18&gt;, &lt;Element li at 0x1014e0ef0&gt;, &lt;Element li at 0x1014e0f38&gt;, &lt;Element li at 0x1014e0f80&gt;, &lt;Element li at 0x1014e0fc8&gt;]</span></span><br><span class="line"><span class="number">5</span></span><br><span class="line">&lt;<span class="class"><span class="keyword">type</span> '<span class="title">list</span>'&gt;</span></span><br><span class="line">&lt;<span class="class"><span class="keyword">type</span> '<span class="title">lxml</span>.<span class="title">etree</span>.<span class="title">_Element</span>'&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可见，etree.parse 的类型是 ElementTree，通过调用 xpath 以后，得到了一个列表，包含了 5 个 <li> 元素，每个元素都是 Element 类型 （2）获取
                    <li> 标签的所有 class
                  </p>
                  <figure class="highlight isbl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable"><span class="class">result</span></span> = <span class="variable">html.xpath</span>(<span class="string">'//li/@class'</span>)</span><br><span class="line"><span class="variable">print</span> <span class="variable"><span class="class">result</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[<span class="symbol">'item-0</span>', <span class="symbol">'item-1</span>', <span class="symbol">'item-inactive</span>', <span class="symbol">'item-1</span>', <span class="symbol">'item-0</span>']</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>（3）获取 <li> 标签下 href 为 link1.html 的 <a> 标签</p>
                  <figure class="highlight cos">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">result = html.xpath('<span class="comment">//li/a[@href="link1.html"]')</span></span><br><span class="line"><span class="keyword">print</span> result</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果</p>
                  <figure class="highlight fsharp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">[&lt;Element a at 0x10ffaae18&gt;]</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>（4）获取 <li> 标签下的所有 <span> 标签 注意这么写是不对的</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">result</span> = html.xpath(<span class="string">'//li/span'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>因为 / 是用来获取子元素的，而 <span> 并不是 <li> 的子元素，所以，要用双斜杠</p>
                  <figure class="highlight isbl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable"><span class="class">result</span></span> = <span class="variable">html.xpath</span>(<span class="string">'//li//span'</span>)</span><br><span class="line"><span class="variable">print</span> <span class="variable"><span class="class">result</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果</p>
                  <figure class="highlight fsharp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">[&lt;Element span at 0x10d698e18&gt;]</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>（5）获取 <li> 标签下的所有 class，不包括
                    <li>
                  </p>
                  <figure class="highlight cos">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">result = html.xpath('<span class="comment">//li/a//@class')</span></span><br><span class="line"><span class="keyword">print</span> result</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[<span class="symbol">'blod</span>']</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>（6）获取最后一个 <li> 的 <a> 的 href</p>
                  <figure class="highlight cos">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">result = html.xpath('<span class="comment">//li[last()]/a/@href')</span></span><br><span class="line"><span class="keyword">print</span> result</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果</p>
                  <figure class="highlight scheme">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[<span class="symbol">'link5.html</span>']</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>（7）获取倒数第二个元素的内容</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">result</span> = html.xpath(<span class="string">'//li[last()-1]/a'</span>)</span><br><span class="line">print <span class="built_in">result</span>[<span class="number">0</span>].<span class="keyword">text</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果</p>
                  <figure class="highlight applescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">fourth</span> <span class="built_in">item</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>（8）获取 class 为 bold 的标签名</p>
                  <figure class="highlight crmsh">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">result = html.<span class="keyword">xpath</span>('//*[@<span class="attr">class=</span><span class="string">"bold"</span>]')</span><br><span class="line">print result[<span class="number">0</span>].<span class="keyword">tag</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">span</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过以上实例的练习，相信大家对 XPath 的基本用法有了基本的了解。也可以利用 text 方法来获取元素的内容。 大家多加练习！</p>
                  <h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2>
                  <p>XPath 是一个非常好用的解析方法，同时也作为爬虫学习的基础，在后面的 selenium 以及 scrapy 框架中都会涉及到这部分知识，希望大家可以把它的语法掌握清楚，为后面的深入研究做好铺垫。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2016-03-23 23:19:25" itemprop="dateCreated datePublished" datetime="2016-03-23T23:19:25+08:00">2016-03-23</time>
                </span>
                <span id="/2621.html" class="post-meta-item leancloud_visitors" data-flag-title="Python爬虫利器三之Xpath语法与lxml库的用法" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>7.5k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>7 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2599.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/2599.html" class="post-title-link" itemprop="url">Python爬虫利器五之Selenium的用法</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="2022-年最新-Python3-网络爬虫教程"><a href="#2022-年最新-Python3-网络爬虫教程" class="headerlink" title="2022 年最新 Python3 网络爬虫教程"></a>2022 年最新 Python3 网络爬虫教程</h2>
                  <p>大家好，我是崔庆才，由于爬虫技术不断迭代升级，一些旧的教程已经过时、案例已经过期，最前沿的爬虫技术比如异步、JavaScript 逆向、安卓逆向、智能解析、WebAssembly、大规模分布式、Kubernetes 等技术层出不穷，我最近新出了一套最新最全面的 Python3 网络爬虫系列教程。</p>
                  <blockquote>
                    <p>博主自荐：截止 2022 年，可以将最前沿最全面的爬虫技术都涵盖的教程，如异步、JavaScript 逆向、安卓逆向、智能解析、WebAssembly、大规模分布式、Kubernetes 等，市面上目前就这一套了。</p>
                  </blockquote>
                  <p>最新教程对旧的爬虫技术内容进行了全面更新，搭建了全新的案例平台进行全面讲解，保证案例稳定有效不过期。</p>
                  <p>教程请移步：</p>
                  <p><a href="https://cuiqingcai.com/17777.html">【2022 版】Python3 网络爬虫学习教程</a></p>
                  <p>如下为原文。</p>
                  <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2>
                  <p>在上一节我们学习了 PhantomJS 的基本用法，归根结底它是一个没有界面的浏览器，而且运行的是 JavaScript 脚本，然而这就能写爬虫了吗？这又和Python有什么关系？说好的Python爬虫呢？库都学完了你给我看这个？客官别急，接下来我们介绍的这个工具，统统解决掉你的疑惑。</p>
                  <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2>
                  <p>Selenium 是什么？一句话，自动化测试工具。它支持各种浏览器，包括 Chrome，Safari，Firefox 等主流界面式浏览器，如果你在这些浏览器里面安装一个 Selenium 的插件，那么便可以方便地实现Web界面的测试。换句话说叫 Selenium 支持这些浏览器驱动。话说回来，PhantomJS不也是一个浏览器吗，那么 Selenium 支持不？答案是肯定的，这样二者便可以实现无缝对接了。 然后又有什么好消息呢？Selenium支持多种语言开发，比如 Java，C，Ruby等等，有 Python 吗？那是必须的！哦这可真是天大的好消息啊。 嗯，所以呢？安装一下 Python 的 Selenium 库，再安装好 PhantomJS，不就可以实现 Python＋Selenium＋PhantomJS 的无缝对接了嘛！PhantomJS 用来渲染解析JS，Selenium 用来驱动以及与 Python 的对接，Python 进行后期的处理，完美的三剑客！ 有人问，为什么不直接用浏览器而用一个没界面的 PhantomJS 呢？答案是：效率高！ Selenium 有两个版本，目前最新版本是 2.53.1（2016/3/22）</p>
                  <blockquote>
                    <p>Selenium 2，又名 WebDriver，它的主要新功能是集成了 Selenium 1.0 以及 WebDriver（WebDriver 曾经是 Selenium 的竞争对手）。也就是说 Selenium 2 是 Selenium 和 WebDriver 两个项目的合并，即 Selenium 2 兼容 Selenium，它既支持 Selenium API 也支持 WebDriver API。</p>
                  </blockquote>
                  <p>更多详情可以查看 Webdriver 的简介。 <a href="http://www.51testing.com/zhuanti/webdriver.htm" target="_blank" rel="noopener">Webdriver</a> 嗯，通过以上描述，我们应该对 Selenium 有了大概对认识，接下来就让我们开始进入动态爬取的新世界吧。 本文参考内容来自 <a href="http://www.seleniumhq.org/docs/index.jsp" target="_blank" rel="noopener">Selenium官网</a> <a href="http://selenium-python.readthedocs.org/index.html" target="_blank" rel="noopener">SeleniumPython文档</a></p>
                  <h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2>
                  <p>首先安装 Selenium</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">pip <span class="keyword">install</span> selenium</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>或者下载源码 <a href="https://pypi.python.org/pypi/selenium" target="_blank" rel="noopener">下载源码</a> 然后解压后运行下面的命令进行安装</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">python</span> setup.<span class="keyword">py</span> install</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>安装好了之后我们便开始探索抓取方法了。</p>
                  <h2 id="快速开始"><a href="#快速开始" class="headerlink" title="快速开始"></a>快速开始</h2>
                  <h3 id="初步体验"><a href="#初步体验" class="headerlink" title="初步体验"></a>初步体验</h3>
                  <p>我们先来一个小例子感受一下 Selenium，这里我们用 Chrome 浏览器来测试，方便查看效果，到真正爬取的时候换回 PhantomJS 即可。</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.<span class="keyword">get</span>(<span class="string">'http://www.baidu.com/'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行这段代码，会自动打开浏览器，然后访问百度。 如果程序执行错误，浏览器没有打开，那么应该是没有装 Chrome 浏览器或者 Chrome 驱动没有配置在环境变量里。下载驱动，然后将驱动文件路径配置在环境变量即可。 <a href="https://sites.google.com/a/chromium.org/chromedriver/downloads" target="_blank" rel="noopener">浏览器驱动下载</a> 比如我的是 Mac OS，就把下载好的文件放在 /usr/bin 目录下就可以了。</p>
                  <h3 id="模拟提交"><a href="#模拟提交" class="headerlink" title="模拟提交"></a>模拟提交</h3>
                  <p>下面的代码实现了模拟提交提交搜索的功能，首先等页面加载完成，然后输入到搜索框文本，点击提交。</p>
                  <figure class="highlight sqf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> selenium import webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.keys import Keys</span><br><span class="line"></span><br><span class="line"><span class="built_in">driver</span> = webdriver.Chrome()</span><br><span class="line"><span class="built_in">driver</span>.get(<span class="string">"http://www.python.org"</span>)</span><br><span class="line"><span class="built_in">assert</span> <span class="string">"Python"</span> <span class="built_in">in</span> <span class="built_in">driver</span>.title</span><br><span class="line">elem = <span class="built_in">driver</span>.find_element_by_name(<span class="string">"q"</span>)</span><br><span class="line">elem.send_keys(<span class="string">"pycon"</span>)</span><br><span class="line">elem.send_keys(Keys.RETURN)</span><br><span class="line">print <span class="built_in">driver</span>.page_source</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>同样是在 Chrome 里面测试，感受一下。</p>
                  <blockquote>
                    <p>The driver.get method will navigate to a page given by the URL. WebDriver will wait until the page has fully loaded (that is, the “onload” event has fired) before returning control to your test or script. It’s worth noting that if your page uses a lot of AJAX on load then WebDriver may not know when it has completely loaded.</p>
                  </blockquote>
                  <p>其中 driver.get 方法会打开请求的URL，WebDriver 会等待页面完全加载完成之后才会返回，即程序会等待页面的所有内容加载完成，JS渲染完毕之后才继续往下执行。注意：如果这里用到了特别多的 Ajax 的话，程序可能不知道是否已经完全加载完毕。</p>
                  <blockquote>
                    <p>WebDriver offers a number of ways to find elements using one of the find<em>element_by</em>* methods. For example, the input text element can be located by its name attribute using find_element_by_name method</p>
                  </blockquote>
                  <p>WebDriver 提供了许多寻找网页元素的方法，譬如 find<em>element_by</em>* 的方法。例如一个输入框可以通过 find_element_by_name 方法寻找 name 属性来确定。</p>
                  <blockquote>
                    <p>Next we are sending keys, this is similar to entering keys using your keyboard. Special keys can be send using Keys class imported from selenium.webdriver.common.keys</p>
                  </blockquote>
                  <p>然后我们输入来文本然后模拟点击了回车，就像我们敲击键盘一样。我们可以利用 Keys 这个类来模拟键盘输入。 最后最重要的一点 <strong>获取网页渲染后的源代码。</strong> 输出 <strong>page_source</strong> 属性即可。 这样，我们就可以做到网页的动态爬取了。</p>
                  <h3 id="测试用例"><a href="#测试用例" class="headerlink" title="测试用例"></a>测试用例</h3>
                  <p>有了以上特性，我们当然可以用来写测试样例了。</p>
                  <figure class="highlight ruby">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import unittest</span><br><span class="line">from selenium import webdriver</span><br><span class="line">from selenium.webdriver.common.keys import Keys</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PythonOrgSearch</span>(<span class="title">unittest</span>.<span class="title">TestCase</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setUp</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.driver = webdriver.Chrome()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_search_in_python_org</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        driver = <span class="keyword">self</span>.driver</span><br><span class="line">        driver.get(<span class="string">"http://www.python.org"</span>)</span><br><span class="line">        <span class="keyword">self</span>.assertIn(<span class="string">"Python"</span>, driver.title)</span><br><span class="line">        elem = driver.find_element_by_name(<span class="string">"q"</span>)</span><br><span class="line">        elem.send_keys(<span class="string">"pycon"</span>)</span><br><span class="line">        elem.send_keys(Keys.RETURN)</span><br><span class="line">        assert <span class="string">"No results found."</span> <span class="keyword">not</span> <span class="keyword">in</span> driver.page_source</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.driver.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name_<span class="number">_</span> == <span class="string">"__main__"</span><span class="symbol">:</span></span><br><span class="line">    unittest.main()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行程序，同样的功能，我们将其封装为测试标准类的形式。</p>
                  <blockquote>
                    <p>The test case class is inherited from unittest.TestCase. Inheriting from TestCase class is the way to tell unittest module that this is a test case. The setUp is part of initialization, this method will get called before every test function which you are going to write in this test case class. The test case method should always start with characters test. The tearDown method will get called after every test method. This is a place to do all cleanup actions. You can also call quit method instead of close. The quit will exit the entire browser, whereas close will close a tab, but if it is the only tab opened, by default most browser will exit entirely.</p>
                  </blockquote>
                  <p>测试用例是继承了 unittest.TestCase 类，继承这个类表明这是一个测试类。setUp方法是初始化的方法，这个方法会在每个测试类中自动调用。每一个测试方法命名都有规范，必须以 test 开头，会自动执行。最后的 tearDown 方法会在每一个测试方法结束之后调用。这相当于最后的析构方法。在这个方法里写的是 close 方法，你还可以写 quit 方法。不过 close 方法相当于关闭了这个 TAB 选项卡，然而 quit 是退出了整个浏览器。当你只开启了一个 TAB 选项卡的时候，关闭的时候也会将整个浏览器关闭。</p>
                  <h2 id="页面操作"><a href="#页面操作" class="headerlink" title="页面操作"></a>页面操作</h2>
                  <h3 id="页面交互"><a href="#页面交互" class="headerlink" title="页面交互"></a>页面交互</h3>
                  <p>仅仅抓取页面没有多大卵用，我们真正要做的是做到和页面交互，比如点击，输入等等。那么前提就是要找到页面中的元素。WebDriver提供了各种方法来寻找元素。例如下面有一个表单输入框。</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;<span class="keyword">input</span> <span class="keyword">type</span>="text" <span class="type">name</span>="passwd" id="passwd-id" /&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们可以这样获取它</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">element</span> = driver.find_element_by_id(<span class="string">"passwd-id"</span>)</span><br><span class="line"><span class="attr">element</span> = driver.find_element_by_name(<span class="string">"passwd"</span>)</span><br><span class="line"><span class="attr">element</span> = driver.find_elements_by_tag_name(<span class="string">"input"</span>)</span><br><span class="line"><span class="attr">element</span> = driver.find_element_by_xpath(<span class="string">"//input[@id='passwd-id']"</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>你还可以通过它的文本链接来获取，但是要小心，文本必须完全匹配才可以，所以这并不是一个很好的匹配方式。 而且你在用 xpath 的时候还需要注意的是，如果有多个元素匹配了 xpath，它只会返回第一个匹配的元素。如果没有找到，那么会抛出 NoSuchElementException 的异常。 获取了元素之后，下一步当然就是向文本输入内容了，可以利用下面的方法</p>
                  <figure class="highlight less">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">element</span><span class="selector-class">.send_keys</span>(<span class="string">"some text"</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>同样你还可以利用 Keys 这个类来模拟点击某个按键。</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">element</span><span class="selector-class">.send_keys</span>("<span class="selector-tag">and</span> <span class="selector-tag">some</span>", <span class="selector-tag">Keys</span><span class="selector-class">.ARROW_DOWN</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>你可以对任何获取到到元素使用 send_keys 方法，就像你在 GMail 里面点击发送键一样。不过这样会导致的结果就是输入的文本不会自动清除。所以输入的文本都会在原来的基础上继续输入。你可以用下面的方法来清除输入文本的内容。</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">element</span>.<span class="built_in">clear</span>()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样输入的文本会被清除。</p>
                  <h3 id="填充表单"><a href="#填充表单" class="headerlink" title="填充表单"></a>填充表单</h3>
                  <p>我们已经知道了怎样向文本框中输入文字，但是其它的表单元素呢？例如下拉选项卡的的处理可以如下</p>
                  <figure class="highlight sql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">element = driver.find_element_by_xpath("//<span class="keyword">select</span>[@<span class="keyword">name</span>=<span class="string">'name'</span>]<span class="string">")</span></span><br><span class="line"><span class="string">all_options = element.find_elements_by_tag_name("</span><span class="keyword">option</span><span class="string">")</span></span><br><span class="line"><span class="string">for option in all_options:</span></span><br><span class="line"><span class="string">    print("</span><span class="keyword">Value</span> <span class="keyword">is</span>: %s<span class="string">" % option.get_attribute("</span><span class="keyword">value</span><span class="string">"))</span></span><br><span class="line"><span class="string">    option.click()</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>首先获取了第一个 select 元素，也就是下拉选项卡。然后轮流设置了 select 选项卡中的每一个 option 选项。你可以看到，这并不是一个非常有效的方法。 其实 WebDriver 中提供了一个叫 Select 的方法，可以帮助我们完成这些事情。</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> <span class="keyword">Select</span></span><br><span class="line"><span class="keyword">select</span> = <span class="keyword">Select</span>(driver.find_element_by_name(<span class="string">'name'</span>))</span><br><span class="line"><span class="keyword">select</span>.select_by_index(<span class="keyword">index</span>)</span><br><span class="line"><span class="keyword">select</span>.select_by_visible_text("text")</span><br><span class="line"><span class="keyword">select</span>.select_by_value(<span class="keyword">value</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如你所见，它可以根据索引来选择，可以根据值来选择，可以根据文字来选择。是十分方便的。 全部取消选择怎么办呢？很简单</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">select = <span class="constructor">Select(<span class="params">driver</span>.<span class="params">find_element_by_id</span>('<span class="params">id</span>')</span>)</span><br><span class="line">select.deselect<span class="constructor">_all()</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样便可以取消所有的选择。 另外我们还可以通过下面的方法获取所有的已选选项。</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">select</span> = Select(driver.find_element_by_xpath(<span class="string">"xpath"</span>))</span><br><span class="line"><span class="attr">all_selected_options</span> = select.all_selected_options</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>获取所有可选选项是</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">options</span> = <span class="keyword">select</span>.<span class="keyword">options</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果你把表单都填好了，最后肯定要提交表单对吧。怎吗提交呢？很简单</p>
                  <figure class="highlight less">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">driver</span><span class="selector-class">.find_element_by_id</span>(<span class="string">"submit"</span>)<span class="selector-class">.click</span>()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就相当于模拟点击了 submit 按钮，做到表单提交。 当然你也可以单独提交某个元素</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">element</span><span class="selector-class">.submit</span>()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>方法，WebDriver 会在表单中寻找它所在的表单，如果发现这个元素并没有被表单所包围，那么程序会抛出 NoSuchElementException 的异常。</p>
                  <h3 id="元素拖拽"><a href="#元素拖拽" class="headerlink" title="元素拖拽"></a>元素拖拽</h3>
                  <p>要完成元素的拖拽，首先你需要指定被拖动的元素和拖动目标元素，然后利用 ActionChains 类来实现。</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">element = driver.find_element_by_name("source")</span><br><span class="line">target = driver.find_element_by_name("target")</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ActionChains</span><br><span class="line">action_chains = ActionChains(driver)</span><br><span class="line">action_chains.drag_and_drop(element, target).<span class="keyword">perform</span>()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就实现了元素从 source 拖动到 target 的操作。</p>
                  <h3 id="页面切换"><a href="#页面切换" class="headerlink" title="页面切换"></a>页面切换</h3>
                  <p>一个浏览器肯定会有很多窗口，所以我们肯定要有方法来实现窗口的切换。切换窗口的方法如下</p>
                  <figure class="highlight ceylon">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">driver.<span class="keyword">switch</span><span class="number">_</span>to<span class="number">_</span>window(<span class="string">"windowName"</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外你可以使用 window_handles 方法来获取每个窗口的操作对象。例如</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">for</span> <span class="selector-tag">handle</span> <span class="selector-tag">in</span> <span class="selector-tag">driver</span><span class="selector-class">.window_handles</span>:</span><br><span class="line">    <span class="selector-tag">driver</span><span class="selector-class">.switch_to_window</span>(<span class="selector-tag">handle</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外切换 frame 的方法如下</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">driver</span><span class="selector-class">.switch_to_frame</span>("<span class="selector-tag">frameName</span><span class="selector-class">.0</span><span class="selector-class">.child</span>")</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样焦点会切换到一个 name 为 child 的 frame 上。</p>
                  <h3 id="弹窗处理"><a href="#弹窗处理" class="headerlink" title="弹窗处理"></a>弹窗处理</h3>
                  <p>当你出发了某个事件之后，页面出现了弹窗提示，那么你怎样来处理这个提示或者获取提示信息呢？</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">alert</span> = driver.switch_to_alert()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过上述方法可以获取弹窗对象。</p>
                  <h3 id="历史记录"><a href="#历史记录" class="headerlink" title="历史记录"></a>历史记录</h3>
                  <p>那么怎样来操作页面的前进和后退功能呢？</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">driver</span><span class="selector-class">.forward</span>()</span><br><span class="line"><span class="selector-tag">driver</span><span class="selector-class">.back</span>()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>嗯，简洁明了。</p>
                  <h3 id="Cookies处理"><a href="#Cookies处理" class="headerlink" title="Cookies处理"></a>Cookies处理</h3>
                  <p>为页面添加 Cookies，用法如下</p>
                  <figure class="highlight applescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># Go to the correct domain</span></span><br><span class="line">driver.<span class="keyword">get</span>(<span class="string">"http://www.example.com"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Now set the cookie. This one's valid for the entire domain</span></span><br><span class="line">cookie = &#123;‘<span class="built_in">name</span>’ : ‘foo’, ‘value’ : ‘bar’&#125;</span><br><span class="line">driver.add_cookie(cookie)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>获取页面 Cookies，用法如下</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># Go to the correct domain</span></span><br><span class="line">driver.<span class="builtin-name">get</span>(<span class="string">"http://www.example.com"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># And now output all the available cookies for the current URL</span></span><br><span class="line">driver.get_cookies()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上便是 Cookies 的处理，同样是非常简单的。</p>
                  <h2 id="元素选取"><a href="#元素选取" class="headerlink" title="元素选取"></a>元素选取</h2>
                  <p>关于元素的选取，有如下的API 单个元素选取</p>
                  <blockquote>
                    <ul>
                      <li>find_element_by_id</li>
                      <li>find_element_by_name</li>
                      <li>find_element_by_xpath</li>
                      <li>find_element_by_link_text</li>
                      <li>find_element_by_partial_link_text</li>
                      <li>find_element_by_tag_name</li>
                      <li>find_element_by_class_name</li>
                      <li>find_element_by_css_selector</li>
                    </ul>
                  </blockquote>
                  <p>多个元素选取</p>
                  <blockquote>
                    <ul>
                      <li>find_elements_by_name</li>
                      <li>find_elements_by_xpath</li>
                      <li>find_elements_by_link_text</li>
                      <li>find_elements_by_partial_link_text</li>
                      <li>find_elements_by_tag_name</li>
                      <li>find_elements_by_class_name</li>
                      <li>find_elements_by_css_selector</li>
                    </ul>
                  </blockquote>
                  <p>另外还可以利用 By 类来确定哪种选择方式</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> selenium.webdriver.common.<span class="keyword">by</span> <span class="keyword">import</span> <span class="keyword">By</span></span><br><span class="line"></span><br><span class="line">driver.find_element(<span class="keyword">By</span>.XPATH, <span class="string">'//button[text()="Some text"]'</span>)</span><br><span class="line">driver.find_elements(<span class="keyword">By</span>.XPATH, <span class="string">'//button'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>By 类的一些属性如下</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">ID</span> = <span class="string">"id"</span></span><br><span class="line"><span class="attr">XPATH</span> = <span class="string">"xpath"</span></span><br><span class="line"><span class="attr">LINK_TEXT</span> = <span class="string">"link text"</span></span><br><span class="line"><span class="attr">PARTIAL_LINK_TEXT</span> = <span class="string">"partial link text"</span></span><br><span class="line"><span class="attr">NAME</span> = <span class="string">"name"</span></span><br><span class="line"><span class="attr">TAG_NAME</span> = <span class="string">"tag name"</span></span><br><span class="line"><span class="attr">CLASS_NAME</span> = <span class="string">"class name"</span></span><br><span class="line"><span class="attr">CSS_SELECTOR</span> = <span class="string">"css selector"</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>更详细的元素选择方法参见官方文档 <a href="http://selenium-python.readthedocs.org/en/latest/locating-elements.html" target="_blank" rel="noopener">元素选择</a></p>
                  <h2 id="页面等待"><a href="#页面等待" class="headerlink" title="页面等待"></a>页面等待</h2>
                  <p>这是非常重要的一部分，现在的网页越来越多采用了 Ajax 技术，这样程序便不能确定何时某个元素完全加载出来了。这会让元素定位困难而且会提高产生 ElementNotVisibleException 的概率。 所以 Selenium 提供了两种等待方式，一种是隐式等待，一种是显式等待。 隐式等待是等待特定的时间，显式等待是指定某一条件直到这个条件成立时继续执行。</p>
                  <h3 id="显式等待"><a href="#显式等待" class="headerlink" title="显式等待"></a>显式等待</h3>
                  <p>显式等待指定某个条件，然后设置最长等待时间。如果在这个时间还没有找到元素，那么便会抛出异常了。</p>
                  <figure class="highlight vbnet">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> selenium import webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.<span class="keyword">by</span> import <span class="keyword">By</span></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui import WebDriverWait</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support import expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line">driver.<span class="keyword">get</span>(<span class="string">"http://somedomain/url_that_delays_loading"</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    element = WebDriverWait(driver, <span class="number">10</span>).<span class="keyword">until</span>(</span><br><span class="line">        EC.presence_of_element_located((<span class="keyword">By</span>.ID, <span class="string">"myDynamicElement"</span>))</span><br><span class="line">    )</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    driver.quit()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>程序默认会 500ms 调用一次来查看元素是否已经生成，如果本来元素就是存在的，那么会立即返回。 下面是一些内置的等待条件，你可以直接调用这些条件，而不用自己写某些等待条件了。</p>
                  <blockquote>
                    <ul>
                      <li>title_is</li>
                      <li>title_contains</li>
                      <li>presence_of_element_located</li>
                      <li>visibility_of_element_located</li>
                      <li>visibility_of</li>
                      <li>presence_of_all_elements_located</li>
                      <li>text_to_be_present_in_element</li>
                      <li>text_to_be_present_in_element_value</li>
                      <li>frame_to_be_available_and_switch_to_it</li>
                      <li>invisibility_of_element_located</li>
                      <li>element_to_be_clickable - it is Displayed and Enabled.</li>
                      <li>staleness_of</li>
                      <li>element_to_be_selected</li>
                      <li>element_located_to_be_selected</li>
                      <li>element_selection_state_to_be</li>
                      <li>element_located_selection_state_to_be</li>
                      <li>alert_is_present</li>
                    </ul>
                  </blockquote>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">from</span> selenium.webdriver.support import expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"></span><br><span class="line"><span class="built_in">wait</span> = WebDriverWait(driver, <span class="number">10</span>)</span><br><span class="line"><span class="keyword">element</span> = <span class="built_in">wait</span>.<span class="keyword">until</span>(EC.element_to_be_clickable((By.ID,<span class="string">'someid'</span>)))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="隐式等待"><a href="#隐式等待" class="headerlink" title="隐式等待"></a>隐式等待</h3>
                  <p>隐式等待比较简单，就是简单地设置一个等待时间，单位为秒。</p>
                  <figure class="highlight sqf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">from</span> selenium import webdriver</span><br><span class="line"></span><br><span class="line"><span class="built_in">driver</span> = webdriver.Chrome()</span><br><span class="line"><span class="built_in">driver</span>.implicitly_wait(<span class="number">10</span>) <span class="meta"># seconds</span></span><br><span class="line"><span class="built_in">driver</span>.get(<span class="string">"http://somedomain/url_that_delays_loading"</span>)</span><br><span class="line">myDynamicElement = <span class="built_in">driver</span>.find_element_by_id(<span class="string">"myDynamicElement"</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>当然如果不设置，默认等待时间为0。</p>
                  <h2 id="程序框架"><a href="#程序框架" class="headerlink" title="程序框架"></a>程序框架</h2>
                  <p>对于页面测试和分析，官方提供了一个比较明晰的代码结构，可以参考。 <a href="http://selenium-python.readthedocs.org/en/latest/page-objects.html" target="_blank" rel="noopener">页面测试架构</a></p>
                  <h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2>
                  <p>到最后，肯定是放松最全最重要的API了，比较多，希望大家可以多加练习。 <a href="http://selenium-python.readthedocs.org/en/latest/api.html" target="_blank" rel="noopener">API</a></p>
                  <h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2>
                  <p>以上就是 Selenium 的基本用法，我们讲解了页面交互，页面渲染之后的源代码的获取。这样，即使页面是 JS 渲染而成的，我们也可以手到擒来了。就是这么溜！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2016-03-22 21:50:53" itemprop="dateCreated datePublished" datetime="2016-03-22T21:50:53+08:00">2016-03-22</time>
                </span>
                <span id="/2599.html" class="post-meta-item leancloud_visitors" data-flag-title="Python爬虫利器五之Selenium的用法" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>9.8k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>9 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2577.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/2577.html" class="post-title-link" itemprop="url">Python爬虫利器四之PhantomJS的用法</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="2022-年最新-Python3-网络爬虫教程"><a href="#2022-年最新-Python3-网络爬虫教程" class="headerlink" title="2022 年最新 Python3 网络爬虫教程"></a>2022 年最新 Python3 网络爬虫教程</h2>
                  <p>大家好，我是崔庆才，由于爬虫技术不断迭代升级，一些旧的教程已经过时、案例已经过期，最前沿的爬虫技术比如异步、JavaScript 逆向、安卓逆向、智能解析、WebAssembly、大规模分布式、Kubernetes 等技术层出不穷，我最近新出了一套最新最全面的 Python3 网络爬虫系列教程。</p>
                  <blockquote>
                    <p>博主自荐：截止 2022 年，可以将最前沿最全面的爬虫技术都涵盖的教程，如异步、JavaScript 逆向、安卓逆向、智能解析、WebAssembly、大规模分布式、Kubernetes 等，市面上目前就这一套了。</p>
                  </blockquote>
                  <p>最新教程对旧的爬虫技术内容进行了全面更新，搭建了全新的案例平台进行全面讲解，保证案例稳定有效不过期。</p>
                  <p>教程请移步：</p>
                  <p><a href="https://cuiqingcai.com/17777.html">【2022 版】Python3 网络爬虫学习教程</a></p>
                  <p>如下为原文。</p>
                  <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2>
                  <p>大家有没有发现之前我们写的爬虫都有一个共性，就是只能爬取单纯的 html 代码，如果页面是 JS 渲染的该怎么办呢？如果我们单纯去分析一个个后台的请求，手动去摸索 JS 渲染的到的一些结果，那简直没天理了。所以，我们需要有一些好用的工具来帮助我们像浏览器一样渲染 JS 处理的页面。 其中有一个比较常用的工具，那就是 <a href="http://phantomjs.org/" target="_blank" rel="noopener">PhantomJS</a></p>
                  <blockquote>
                    <p>Full web stack No browser required</p>
                    <p>PhantomJS is a headless WebKit scriptable with a JavaScript API. It has <strong>fast</strong> and<strong>native</strong> support for various web standards: DOM handling, CSS selector, JSON, Canvas, and SVG.</p>
                  </blockquote>
                  <p>PhantomJS 是一个无界面的,可脚本编程的 WebKit 浏览器引擎。它原生支持多种 web 标准：DOM 操作，CSS 选择器，JSON，Canvas 以及 SVG。 好，接下来我们就一起来了解一下这个神奇好用的库的用法吧。</p>
                  <h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2>
                  <p>PhantomJS 安装方法有两种，一种是下载源码之后自己来编译，另一种是直接下载编译好的二进制文件。然而自己编译需要的时间太长，而且需要挺多的磁盘空间。官方推荐直接下载二进制文件然后安装。 大家可以依照自己的开发平台选择不同的包进行下载 <a href="http://phantomjs.org/download.html" target="_blank" rel="noopener">下载地址</a> 当然如果你不嫌麻烦，可以选择 <a href="http://phantomjs.org/build.html" target="_blank" rel="noopener">下载源码</a> 然后自己编译。 目前（2016/3/21）最新发行版本是 v2.1， 安装完成之后命令行输入</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">phantomjs -v</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果正常显示版本号，那么证明安装成功了。如果提示错误，那么请重新安装。 本文介绍大部分内容来自于官方文档，博主对其进行了整理，学习更多请参考 <a href="http://phantomjs.org/quick-start.html" target="_blank" rel="noopener">官方文档</a></p>
                  <h2 id="快速开始"><a href="#快速开始" class="headerlink" title="快速开始"></a>快速开始</h2>
                  <h3 id="第一个程序"><a href="#第一个程序" class="headerlink" title="第一个程序"></a>第一个程序</h3>
                  <p>第一个程序当然是 Hello World，新建一个 js 文件。命名为 helloworld.js</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">console.log(<span class="string">'Hello, world!'</span>);</span><br><span class="line">phantom.<span class="keyword">exit</span>();</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>命令行输入</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">phantomjs</span> <span class="selector-tag">helloworld</span><span class="selector-class">.js</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>程序输出了 Hello，world！程序第二句话终止了 phantom 的执行。 <strong>注意：<code>phantom.exit();</code>这句话非常重要，否则程序将永远不会终止。</strong></p>
                  <h3 id="页面加载"><a href="#页面加载" class="headerlink" title="页面加载"></a>页面加载</h3>
                  <p>可以利用 phantom 来实现页面的加载，下面的例子实现了页面的加载并将页面保存为一张图片。</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">var page = require(<span class="string">'webpage'</span>).create();</span><br><span class="line">page.open(<span class="string">'http://cuiqingcai.com'</span>, <span class="keyword">function</span> (status) &#123;</span><br><span class="line">    console.log(<span class="string">"Status: "</span> + status);</span><br><span class="line">    <span class="keyword">if</span> (status === <span class="string">"success"</span>) &#123;</span><br><span class="line">        page.render(<span class="string">'example.png'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    phantom.<span class="keyword">exit</span>();</span><br><span class="line">&#125;);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>首先创建了一个 webpage 对象，然后加载本站点主页，判断响应状态，如果成功，那么保存截图为 example.png 以上代码命名为 pageload.js，命令行</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">phantomjs</span> <span class="selector-tag">pageload</span><span class="selector-class">.js</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>发现执行成功，然后目录下多了一张图片，example.png <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2016/03/example-e1458570294781.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2016/03/example-e1458570294781.png" alt="example"></a> 因为这个 render 方法，phantom 经常会用到网页截图的功能。</p>
                  <h3 id="测试页面加载速度"><a href="#测试页面加载速度" class="headerlink" title="测试页面加载速度"></a>测试页面加载速度</h3>
                  <p>下面这个例子计算了一个页面的加载速度，同时还用到了命令行传参的特性。新建文件保存为 loadspeed.js</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">var<span class="built_in"> page </span>= require(<span class="string">'webpage'</span>).create(),</span><br><span class="line"> <span class="built_in"> system </span>= require(<span class="string">'system'</span>),</span><br><span class="line">  t, address;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (system.args.length === 1) &#123;</span><br><span class="line">  console.log(<span class="string">'Usage: loadspeed.js &lt;some URL&gt;'</span>);</span><br><span class="line">  phantom.exit();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">t = Date.now();</span><br><span class="line">address = system.args[1];</span><br><span class="line">page.open(address, function(status) &#123;</span><br><span class="line">  <span class="keyword">if</span> (status !== <span class="string">'success'</span>) &#123;</span><br><span class="line">    console.log(<span class="string">'FAIL to load the address'</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    t = Date.now() - t;</span><br><span class="line">    console.log(<span class="string">'Loading '</span> + system.args[1]);</span><br><span class="line">    console.log(<span class="string">'Loading time '</span> + t + <span class="string">' msec'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  phantom.exit();</span><br><span class="line">&#125;);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>程序判断了参数的多少，如果参数不够，那么终止运行。然后记录了打开页面的时间，请求页面之后，再纪录当前时间，二者之差就是页面加载速度。</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">phantomjs loadspeed.js <span class="string">http:</span><span class="comment">//cuiqingcai.com</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Loading http:<span class="comment">//cuiqingcai.com</span></span><br><span class="line">Loading time <span class="number">11678</span> msec</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这个时间包括 JS 渲染的时间，当然和网速也有关。</p>
                  <h3 id="代码评估"><a href="#代码评估" class="headerlink" title="代码评估"></a>代码评估</h3>
                  <blockquote>
                    <p>To evaluate JavaScript code in the context of the web page, use <code>evaluate()</code> function. The execution is “sandboxed”, there is no way for the code to access any JavaScript objects and variables outside its own page context. An object can be returned from <code>evaluate()</code>, however it is limited to simple objects and can’t contain functions or closures.</p>
                  </blockquote>
                  <p>利用 evaluate 方法我们可以获取网页的源代码。这个执行是“沙盒式”的，它不会去执行网页外的 JavaScript 代码。evalute 方法可以返回一个对象，然而返回值仅限于对象，不能包含函数（或闭包）</p>
                  <figure class="highlight qml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">var</span> <span class="built_in">url</span> = <span class="string">'http://www.baidu.com'</span>;</span><br><span class="line"><span class="keyword">var</span> page = <span class="built_in">require</span>(<span class="string">'webpage'</span>).create();</span><br><span class="line">page.open(<span class="built_in">url</span>, <span class="function"><span class="keyword">function</span>(<span class="params">status</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> title = page.evaluate(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">document</span>.title;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Page title is '</span> + title);</span><br><span class="line">  phantom.exit();</span><br><span class="line">&#125;);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上代码获取了百度的网站标题。</p>
                  <figure class="highlight maxima">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Page <span class="built_in">title</span> <span class="built_in">is</span> 百度一下，你就知道</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>任何来自于网页并且包括来自 evaluate() 内部代码的控制台信息，默认不会显示。 需要重写这个行为，使用 onConsoleMessage 回调函数，示例可以改写成</p>
                  <figure class="highlight qml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">var</span> <span class="built_in">url</span> = <span class="string">'http://www.baidu.com'</span>;</span><br><span class="line"><span class="keyword">var</span> page = <span class="built_in">require</span>(<span class="string">'webpage'</span>).create();</span><br><span class="line">page.onConsoleMessage = <span class="function"><span class="keyword">function</span> (<span class="params">msg</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(msg);</span><br><span class="line">&#125;;</span><br><span class="line">page.open(<span class="built_in">url</span>, <span class="function"><span class="keyword">function</span> (<span class="params">status</span>) </span>&#123;</span><br><span class="line">    page.evaluate(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">document</span>.title);</span><br><span class="line">    &#125;);</span><br><span class="line">    phantom.exit();</span><br><span class="line">&#125;);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样的话，如果你用浏览器打开百度首页，打开调试工具的 console，可以看到控制台输出信息。 重写了 onConsoleMessage 方法之后，可以发现控制台输出的结果和我们需要输出的标题都打印出来了。</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">一张网页，要经历怎样的过程，才能抵达用户面前？</span><br><span class="line">一位新人，要经历怎样的成长，才能站在技术之巅？</span><br><span class="line">探寻这里的秘密；</span><br><span class="line">体验这里的挑战；</span><br><span class="line">成为这里的主人；</span><br><span class="line">加入百度，加入网页搜索，你，可以影响世界。</span><br><span class="line"></span><br><span class="line">请将简历发送至 %c ps_recruiter<span class="meta">@baidu</span>.com（ 邮件标题请以“姓名-应聘XX职位-来自console”命名） <span class="string">color:</span>red</span><br><span class="line">职位介绍：<span class="string">http:</span><span class="comment">//dwz.cn/hr2013</span></span><br><span class="line">百度一下，你就知道</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>啊，我没有在为百度打广告！</p>
                  <h2 id="屏幕捕获"><a href="#屏幕捕获" class="headerlink" title="屏幕捕获"></a>屏幕捕获</h2>
                  <blockquote>
                    <p>Since PhantomJS is using WebKit, a real layout and rendering engine, it can capture a web page as a screenshot. Because PhantomJS can render anything on the web page, it can be used to convert contents not only in HTML and CSS, but also SVG and Canvas.</p>
                  </blockquote>
                  <p>因为 PhantomJS 使用了 WebKit 内核，是一个真正的布局和渲染引擎，它可以像屏幕截图一样捕获一个 web 界面。因为它可以渲染网页中的人和元素，所以它不仅用到 HTML，CSS 的内容转化，还用在 SVG，Canvas。可见其功能是相当强大的。 下面的例子就捕获了 github 网页的截图。上文有类似内容，不再演示。</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">var page = require(<span class="string">'webpage'</span>).create();</span><br><span class="line">page.open(<span class="string">'http://github.com/'</span>, <span class="keyword">function</span>() &#123;</span><br><span class="line">  page.render(<span class="string">'github.png'</span>);</span><br><span class="line">  phantom.<span class="keyword">exit</span>();</span><br><span class="line">&#125;);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>除了 png 格式的转换，PhantomJS 还支持 jpg，gif，pdf 等格式。 <a href="https://github.com/ariya/phantomjs/blob/master/examples/rasterize.js" target="_blank" rel="noopener">测试样例</a> 其中最重要的方法便是 viewportSize 和 clipRect 属性。 viewportSize 是视区的大小，你可以理解为你打开了一个浏览器，然后把浏览器窗口拖到了多大。 clipRect 是裁切矩形的大小，需要四个参数，前两个是基准点，后两个参数是宽高。 通过下面的小例子感受一下。</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">var page = require(<span class="string">'webpage'</span>).create();</span><br><span class="line"><span class="comment">//viewportSize being the actual size of the headless browser</span></span><br><span class="line">page.viewportSize = &#123; <span class="string">width:</span> <span class="number">1024</span>, <span class="string">height:</span> <span class="number">768</span> &#125;;</span><br><span class="line"><span class="comment">//the clipRect is the portion of the page you are taking a screenshot of</span></span><br><span class="line">page.clipRect = &#123; <span class="string">top:</span> <span class="number">0</span>, <span class="string">left:</span> <span class="number">0</span>, <span class="string">width:</span> <span class="number">1024</span>, <span class="string">height:</span> <span class="number">768</span> &#125;;</span><br><span class="line"><span class="comment">//the rest of the code is the same as the previous example</span></span><br><span class="line">page.open(<span class="string">'http://cuiqingcai.com/'</span>, function() &#123;</span><br><span class="line">  page.render(<span class="string">'germy.png'</span>);</span><br><span class="line">  phantom.exit();</span><br><span class="line">&#125;);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2016/03/germy.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2016/03/germy.png" alt="germy"></a> 就相当于把浏览器窗口拖到了 1024x768 大小，然后从左上角裁切出了 1024x768 的页面。</p>
                  <h2 id="网络监听"><a href="#网络监听" class="headerlink" title="网络监听"></a>网络监听</h2>
                  <blockquote>
                    <p>Because PhantomJS permits the inspection of network traffic, it is suitable to build various analysis on the network behavior and performance.</p>
                  </blockquote>
                  <p>因为 PhantomJS 有网络通信的检查功能，它也很适合用来做网络行为的分析。</p>
                  <blockquote>
                    <p>When a page requests a resource from a remote server, both the request and the response can be tracked via onResourceRequested and onResourceReceived callback.</p>
                  </blockquote>
                  <p>当接受到请求时，可以通过改写 onResourceRequested 和 onResourceReceived 回调函数来实现接收到资源请求和资源接受完毕的监听。例如</p>
                  <figure class="highlight qml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">var</span> <span class="built_in">url</span> = <span class="string">'http://www.cuiqingcai.com'</span>;</span><br><span class="line"><span class="keyword">var</span> page = <span class="built_in">require</span>(<span class="string">'webpage'</span>).create();</span><br><span class="line">page.onResourceRequested = <span class="function"><span class="keyword">function</span>(<span class="params">request</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Request '</span> + <span class="built_in">JSON</span>.stringify(request, <span class="literal">undefined</span>, <span class="number">4</span>));</span><br><span class="line">&#125;;</span><br><span class="line">page.onResourceReceived = <span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Receive '</span> + <span class="built_in">JSON</span>.stringify(response, <span class="literal">undefined</span>, <span class="number">4</span>));</span><br><span class="line">&#125;;</span><br><span class="line">page.open(<span class="built_in">url</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果会打印出所有资源的请求和接收状态，以 JSON 格式输出。</p>
                  <h2 id="页面自动化处理"><a href="#页面自动化处理" class="headerlink" title="页面自动化处理"></a>页面自动化处理</h2>
                  <blockquote>
                    <p>Because PhantomJS can load and manipulate a web page, it is perfect to carry out various page automations.</p>
                  </blockquote>
                  <p>因为 PhantomJS 可以加载和操作一个 web 页面，所以用来自动化处理也是非常适合的。</p>
                  <h3 id="DOM-操作"><a href="#DOM-操作" class="headerlink" title="DOM 操作"></a>DOM 操作</h3>
                  <blockquote>
                    <p>Since the script is executed as if it is running on a web browser, standard DOM scripting and CSS selectors work just fine.</p>
                  </blockquote>
                  <p>脚本都是像在浏览器中运行的，所以标准的 JavaScript 的 DOM 操作和 CSS 选择器也是生效的。 例如下面的例子就修改了 User-Agent，然后还返回了页面中某元素的内容。</p>
                  <figure class="highlight lua">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">var page = <span class="built_in">require</span>(<span class="string">'webpage'</span>).<span class="built_in">create</span>();</span><br><span class="line">console.<span class="built_in">log</span>(<span class="string">'The default user agent is '</span> + page.settings.userAgent);</span><br><span class="line">page.settings.userAgent = <span class="string">'SpecialAgent'</span>;</span><br><span class="line">page.<span class="built_in">open</span>(<span class="string">'http://www.httpuseragent.org'</span>, <span class="function"><span class="keyword">function</span><span class="params">(status)</span></span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">status</span> !== <span class="string">'success'</span>) &#123;</span><br><span class="line">    console.<span class="built_in">log</span>(<span class="string">'Unable to access network'</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    var ua = page.evaluate(<span class="function"><span class="keyword">function</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">return</span> document.getElementById(<span class="string">'myagent'</span>).textContent;</span><br><span class="line">    &#125;);</span><br><span class="line">    console.<span class="built_in">log</span>(ua);</span><br><span class="line">  &#125;</span><br><span class="line">  phantom.<span class="built_in">exit</span>();</span><br><span class="line">&#125;);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">The<span class="built_in"> default user </span>agent is Mozilla/5.0 (Macintosh; Intel Mac OS X) AppleWebKit/538.1 (KHTML, like Gecko) PhantomJS/2.1.0 Safari/538.1</span><br><span class="line">Your Http<span class="built_in"> User </span>Agent string is: SpecialAgent</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>首先打印出了默认的 User-Agent，然后通过修改它，请求验证 User-Agent 的一个站点，通过选择器得到了修改后的 User-Agent。</p>
                  <h3 id="使用附加库"><a href="#使用附加库" class="headerlink" title="使用附加库"></a>使用附加库</h3>
                  <p>在 1.6 版本之后允许添加外部的 JS 库，比如下面的例子添加了 jQuery，然后执行了 jQuery 代码。</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">var page = require(<span class="string">'webpage'</span>).create();</span><br><span class="line">page.open(<span class="string">'http://www.sample.com'</span>, <span class="keyword">function</span>() &#123;</span><br><span class="line">  page.includeJs(<span class="string">"http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"</span>, <span class="keyword">function</span>() &#123;</span><br><span class="line">    page.evaluate(<span class="keyword">function</span>() &#123;</span><br><span class="line">      $(<span class="string">"button"</span>).click();</span><br><span class="line">    &#125;);</span><br><span class="line">    phantom.<span class="keyword">exit</span>()</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>引用了 jQuery 之后，我们便可以在下面写一些 jQuery 代码了。</p>
                  <h2 id="Webpage-对象"><a href="#Webpage-对象" class="headerlink" title="Webpage 对象"></a>Webpage 对象</h2>
                  <p>在前面我们介绍了 webpage 对象的几个方法和属性，其实它本身还有其它很多的属性。具体的内容可以参考 <a href="http://phantomjs.org/page-automation.html" target="_blank" rel="noopener">Webpage</a> <a href="https://github.com/ariya/phantomjs/blob/master/examples/page_events.js" target="_blank" rel="noopener">Webpage 用例</a> 里面介绍了 webpage 的所有属性，方法，回调。</p>
                  <h2 id="命令行"><a href="#命令行" class="headerlink" title="命令行"></a>命令行</h2>
                  <p>Command-line Options PhantomJS 提供的命令行选项有：</p>
                  <blockquote>
                    <p>--help or -h lists all possible command-line options. Halts immediately, will not run a script passed as argument. ［帮助列表］ —version or -v prints out the version of PhantomJS. Halts immediately, will not run a script passed as argument. ［查看版本］ —cookies-file=/path/to/cookies.txt specifies the file name to store the persistent Cookies. ［指定存放 cookies 的路径］ —disk-cache=[true|false] enables disk cache (at desktop services cache storage location, default is false). Also accepted: [yes|no]. ［硬盘缓存开关，默认为关］ —ignore-ssl-errors=[true|false] ignores SSL errors, such as expired or self-signed certificate errors (default is false). Also accepted: [yes|no]. ［忽略 ssl 错误，默认不忽略］ —load-images=[true|false] load all inlined images (default is true). Also accepted: [yes|no]. ［加载图片，默认为加载］ —local-storage-path=/some/path path to save LocalStorage content and WebSQL content. ［本地存储路径，如本地文件和 SQL 文件等］ —local-storage-quota=number maximum size to allow for data. ［本地文件最大大小］ —local-to-remote-url-access=[true|false] allows local content to access remote URL (default is false). Also accepted: [yes|no]. ［是否允许远程加载文件，默认不允许］ —max-disk-cache-size=size limits the size of disk cache (in KB). ［最大缓存空间］ —output-encoding=encoding sets the encoding used for terminal output (default is utf8). ［默认输出编码，默认 utf8］ —remote-debugger-port starts the script in a debug harness and listens on the specified port ［远程调试端口］ —remote-debugger-autorun runs the script in the debugger immediately: ‘yes’ or ‘no’ (default) ［在调试环境下是否立即执行脚本，默认否］ —proxy=address:port specifies the proxy server to use (e.g. —proxy=192.168.1.42:8080). ［代理］ —proxy-type=[http|socks5|none] specifies the type of the proxy server (default is http). ［代理类型，默认 http］ —proxy-auth specifies the authentication information for the proxy, e.g. —proxy-auth=username:password). ［代理认证］ —script-encoding=encoding sets the encoding used for the starting script (default is utf8). ［脚本编码，默认 utf8］ —ssl-protocol=[sslv3|sslv2|tlsv1|any’] sets the SSL protocol for secure connections (default is SSLv3). ［SSL 协议，默认 SSLv3］ —ssl-certificates-path=<val> Sets the location for custom CA certificates (if none set, uses system default). ［SSL 证书路径，默认系统默认路径］ —web-security=[true|false] enables web security and forbids cross-domain XHR (default is true). Also accepted: [yes|no]. ［是否开启安全保护和禁止异站 Ajax，默认开启保护］ —webdriver starts in ‘Remote WebDriver mode’ (embedded GhostDriver): ‘[[:]]’ (default ‘127.0.0.1:8910’) ［以远程 WebDriver 模式启动］ —webdriver-selenium-grid-hub URL to the Selenium Grid HUB: ‘URLTOHUB’ (default ‘none’) (NOTE: works only together with ‘—webdriver’) ［Selenium 接口］ —config=/path/to/config.json can utilize a JavaScript Object Notation (JSON) configuration file instead of passing in multiple command-line optionss ［所有的命令行配置从 config.json 中读取］</p>
                  </blockquote>
                  <p>注：JSON 文件配置格式</p>
                  <figure class="highlight arcade">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">/* Same as: --ignore-ssl-errors=true */</span></span><br><span class="line">  <span class="string">"ignoreSslErrors"</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Same as: --max-disk-cache-size=1000 */</span></span><br><span class="line">  <span class="string">"maxDiskCacheSize"</span>: <span class="number">1000</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Same as: --output-encoding=utf8 */</span></span><br><span class="line">  <span class="string">"outputEncoding"</span>: <span class="string">"utf8"</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* etc. */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">There are some keys that <span class="keyword">do</span> not translate directly:</span><br><span class="line"></span><br><span class="line"> * --disk-<span class="function"><span class="params">cache</span> =&gt;</span> diskCacheEnabled</span><br><span class="line"> * --load-<span class="function"><span class="params">images</span> =&gt;</span> autoLoadImages</span><br><span class="line"> * --local-storage-<span class="function"><span class="params">path</span> =&gt;</span> offlineStoragePath</span><br><span class="line"> * --local-storage-<span class="function"><span class="params">quota</span> =&gt;</span> offlineStorageDefaultQuota</span><br><span class="line"> * --local-to-remote-url-<span class="function"><span class="params">access</span> =&gt;</span> localToRemoteUrlAccessEnabled</span><br><span class="line"> * --web-<span class="function"><span class="params">security</span> =&gt;</span> webSecurityEnabled</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上是命令行的基本配置</p>
                  <h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2>
                  <p>在此提供官方文档实例，多对照实例练习，使用起来会更得心应手。 <a href="http://phantomjs.org/examples/index.html" target="_blank" rel="noopener">官方实例</a></p>
                  <h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2>
                  <p>以上是博主对 PhantomJS 官方文档的基本总结和翻译，如有差错，希望大家可以指正。另外可能有的小伙伴觉得这个工具和 Python 有什么关系？不要急，后面会有 Python 和 PhantomJS 的综合使用的。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2016-03-22 00:56:03" itemprop="dateCreated datePublished" datetime="2016-03-22T00:56:03+08:00">2016-03-22</time>
                </span>
                <span id="/2577.html" class="post-meta-item leancloud_visitors" data-flag-title="Python爬虫利器四之PhantomJS的用法" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>10k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>9 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2556.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/2556.html" class="post-title-link" itemprop="url">Python爬虫利器一之Requests库的用法</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="2022-年最新-Python3-网络爬虫教程"><a href="#2022-年最新-Python3-网络爬虫教程" class="headerlink" title="2022 年最新 Python3 网络爬虫教程"></a>2022 年最新 Python3 网络爬虫教程</h2>
                  <p>大家好，我是崔庆才，由于爬虫技术不断迭代升级，一些旧的教程已经过时、案例已经过期，最前沿的爬虫技术比如异步、JavaScript 逆向、安卓逆向、智能解析、WebAssembly、大规模分布式、Kubernetes 等技术层出不穷，我最近新出了一套最新最全面的 Python3 网络爬虫系列教程。</p>
                  <blockquote>
                    <p>博主自荐：截止 2022 年，可以将最前沿最全面的爬虫技术都涵盖的教程，如异步、JavaScript 逆向、安卓逆向、智能解析、WebAssembly、大规模分布式、Kubernetes 等，市面上目前就这一套了。</p>
                  </blockquote>
                  <p>最新教程对旧的爬虫技术内容进行了全面更新，搭建了全新的案例平台进行全面讲解，保证案例稳定有效不过期。</p>
                  <p>教程请移步：</p>
                  <p><a href="https://cuiqingcai.com/17777.html">【2022 版】Python3 网络爬虫学习教程</a></p>
                  <p>如下为原文。</p>
                  <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2>
                  <p>之前我们用了 urllib 库，这个作为入门的工具还是不错的，对了解一些爬虫的基本理念，掌握爬虫爬取的流程有所帮助。入门之后，我们就需要学习一些更加高级的内容和工具来方便我们的爬取。那么这一节来简单介绍一下 requests 库的基本用法。 <strong>注：Python 版本依然基于 2.7</strong></p>
                  <h2 id="官方文档"><a href="#官方文档" class="headerlink" title="官方文档"></a>官方文档</h2>
                  <p>以下内容大多来自于官方文档，本文进行了一些修改和总结。要了解更多可以参考 <a href="http://docs.python-requests.org/en/master/" target="_blank" rel="noopener">官方文档</a></p>
                  <h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2>
                  <p>利用 pip 安装</p>
                  <figure class="highlight cmake">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">$ pip <span class="keyword">install</span> requests</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>或者利用 easy_install</p>
                  <figure class="highlight elixir">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">$ </span>easy_install requests</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过以上两种方法均可以完成安装。</p>
                  <h2 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h2>
                  <p>首先我们引入一个小例子来感受一下</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">r = requests.<span class="builtin-name">get</span>(<span class="string">'http://cuiqingcai.com'</span>)</span><br><span class="line"><span class="builtin-name">print</span> type(r)</span><br><span class="line"><span class="builtin-name">print</span> r.status_code</span><br><span class="line"><span class="builtin-name">print</span> r.encoding</span><br><span class="line"><span class="comment">#print r.text</span></span><br><span class="line"><span class="builtin-name">print</span> r.cookies</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上代码我们请求了本站点的网址，然后打印出了返回结果的类型，状态码，编码方式，Cookies等内容。 运行结果如下</p>
                  <figure class="highlight apache">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="section">&lt;class 'requests.models.Response'&gt;</span></span><br><span class="line"><span class="attribute">200</span></span><br><span class="line"><span class="attribute">UTF</span>-8</span><br><span class="line"><span class="section">&lt;RequestsCookieJar[]&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>怎样，是不是很方便。别急，更方便的在后面呢。</p>
                  <h2 id="基本请求"><a href="#基本请求" class="headerlink" title="基本请求"></a>基本请求</h2>
                  <p>requests库提供了http所有的基本请求方式。例如</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">r</span> = requests.post(<span class="string">"http://httpbin.org/post"</span>)</span><br><span class="line"><span class="attr">r</span> = requests.put(<span class="string">"http://httpbin.org/put"</span>)</span><br><span class="line"><span class="attr">r</span> = requests.delete(<span class="string">"http://httpbin.org/delete"</span>)</span><br><span class="line"><span class="attr">r</span> = requests.head(<span class="string">"http://httpbin.org/get"</span>)</span><br><span class="line"><span class="attr">r</span> = requests.options(<span class="string">"http://httpbin.org/get"</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>嗯，一句话搞定。</p>
                  <h2 id="基本GET请求"><a href="#基本GET请求" class="headerlink" title="基本GET请求"></a>基本GET请求</h2>
                  <p>最基本的GET请求可以直接用get方法</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">r</span> = requests.get(<span class="string">"http://httpbin.org/get"</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果想要加参数，可以利用 params 参数</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">payload = &#123;<span class="string">'key1'</span>: <span class="string">'value1'</span>, <span class="string">'key2'</span>: <span class="string">'value2'</span>&#125;</span><br><span class="line">r = requests.<span class="builtin-name">get</span>(<span class="string">"http://httpbin.org/get"</span>, <span class="attribute">params</span>=payload)</span><br><span class="line"><span class="builtin-name">print</span> r.url</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果</p>
                  <figure class="highlight avrasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">http:</span>//httpbin<span class="meta">.org</span>/get?key2=value2&amp;key1=value1</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果想请求JSON文件，可以利用 json() 方法解析 例如自己写一个JSON文件命名为a.json，内容如下</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[<span class="string">"foo"</span>, <span class="string">"bar"</span>, &#123;</span><br><span class="line">  <span class="attr">"foo"</span>: <span class="string">"bar"</span></span><br><span class="line">&#125;]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>利用如下程序请求并解析</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">r = requests.<span class="builtin-name">get</span>(<span class="string">"a.json"</span>)</span><br><span class="line"><span class="builtin-name">print</span> r.text</span><br><span class="line"><span class="builtin-name">print</span> r.json()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下，其中一个是直接输出内容，另外一个方法是利用 json() 方法解析，感受下它们的不同</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">[<span class="string">"foo"</span>, <span class="string">"bar"</span>, &#123;</span><br><span class="line"> <span class="string">"foo"</span>: <span class="string">"bar"</span></span><br><span class="line"> &#125;]</span><br><span class="line"> [<span class="string">u'foo'</span>, <span class="string">u'bar'</span>, &#123;<span class="string">u'foo'</span>: <span class="string">u'bar'</span>&#125;]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果想获取来自服务器的原始套接字响应，可以取得 r.raw 。 不过需要在初始请求中设置 stream=True 。</p>
                  <figure class="highlight llvm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">r = requests.get('https://github.com/timeline.json', stream=True)</span><br><span class="line">r.raw</span><br><span class="line">&lt;requests.packages.urllib<span class="number">3</span>.response.HTTPResponse object at <span class="number">0x101194810</span>&gt;</span><br><span class="line">r.raw.read(<span class="number">10</span>)</span><br><span class="line">'\<span class="keyword">x</span><span class="number">1</span>f\<span class="keyword">x</span><span class="number">8</span>b\<span class="keyword">x</span><span class="number">08</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">00</span>\<span class="keyword">x</span><span class="number">03</span>'</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样就获取了网页原始套接字内容。 如果想添加 headers，可以传 headers 参数</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">payload = &#123;<span class="string">'key1'</span>: <span class="string">'value1'</span>, <span class="string">'key2'</span>: <span class="string">'value2'</span>&#125;</span><br><span class="line">headers = &#123;<span class="string">'content-type'</span>: <span class="string">'application/json'</span>&#125;</span><br><span class="line">r = requests.<span class="builtin-name">get</span>(<span class="string">"http://httpbin.org/get"</span>, <span class="attribute">params</span>=payload, <span class="attribute">headers</span>=headers)</span><br><span class="line"><span class="builtin-name">print</span> r.url</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过headers参数可以增加请求头中的headers信息</p>
                  <h2 id="基本POST请求"><a href="#基本POST请求" class="headerlink" title="基本POST请求"></a>基本POST请求</h2>
                  <p>对于 POST 请求来说，我们一般需要为它增加一些参数。那么最基本的传参方法可以利用 data 这个参数。</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">payload = &#123;<span class="string">'key1'</span>: <span class="string">'value1'</span>, <span class="string">'key2'</span>: <span class="string">'value2'</span>&#125;</span><br><span class="line">r = requests.post(<span class="string">"http://httpbin.org/post"</span>, <span class="attribute">data</span>=payload)</span><br><span class="line"><span class="builtin-name">print</span> r.text</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"args"</span>: &#123;&#125;, </span><br><span class="line">  <span class="attr">"data"</span>: <span class="string">""</span>, </span><br><span class="line">  <span class="attr">"files"</span>: &#123;&#125;, </span><br><span class="line">  <span class="attr">"form"</span>: &#123;</span><br><span class="line">    <span class="attr">"key1"</span>: <span class="string">"value1"</span>, </span><br><span class="line">    <span class="attr">"key2"</span>: <span class="string">"value2"</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="attr">"headers"</span>: &#123;</span><br><span class="line">    <span class="attr">"Accept"</span>: <span class="string">"*/*"</span>, </span><br><span class="line">    <span class="attr">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>, </span><br><span class="line">    <span class="attr">"Content-Length"</span>: <span class="string">"23"</span>, </span><br><span class="line">    <span class="attr">"Content-Type"</span>: <span class="string">"application/x-www-form-urlencoded"</span>, </span><br><span class="line">    <span class="attr">"Host"</span>: <span class="string">"httpbin.org"</span>, </span><br><span class="line">    <span class="attr">"User-Agent"</span>: <span class="string">"python-requests/2.9.1"</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="attr">"json"</span>: <span class="literal">null</span>, </span><br><span class="line">  <span class="attr">"url"</span>: <span class="string">"http://httpbin.org/post"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到参数传成功了，然后服务器返回了我们传的数据。 有时候我们需要传送的信息不是表单形式的，需要我们传JSON格式的数据过去，所以我们可以用 json.dumps() 方法把表单数据序列化。</p>
                  <figure class="highlight haskell">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="title">url</span> = 'http://httpbin.org/post'</span><br><span class="line"><span class="title">payload</span> = &#123;'some': '<span class="class"><span class="keyword">data</span>'&#125;</span></span><br><span class="line"><span class="title">r</span> = requests.post(url, <span class="class"><span class="keyword">data</span>=json.dumps(<span class="title">payload</span>))</span></span><br><span class="line"><span class="title">print</span> r.text</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"args"</span>: &#123;&#125;, </span><br><span class="line">  <span class="attr">"data"</span>: <span class="string">"&#123;\"some\": \"data\"&#125;"</span>, </span><br><span class="line">  <span class="attr">"files"</span>: &#123;&#125;, </span><br><span class="line">  <span class="attr">"form"</span>: &#123;&#125;, </span><br><span class="line">  <span class="attr">"headers"</span>: &#123;</span><br><span class="line">    <span class="attr">"Accept"</span>: <span class="string">"*/*"</span>, </span><br><span class="line">    <span class="attr">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>, </span><br><span class="line">    <span class="attr">"Content-Length"</span>: <span class="string">"16"</span>, </span><br><span class="line">    <span class="attr">"Host"</span>: <span class="string">"httpbin.org"</span>, </span><br><span class="line">    <span class="attr">"User-Agent"</span>: <span class="string">"python-requests/2.9.1"</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="attr">"json"</span>: &#123;</span><br><span class="line">    <span class="attr">"some"</span>: <span class="string">"data"</span></span><br><span class="line">  &#125;,  </span><br><span class="line">  <span class="attr">"url"</span>: <span class="string">"http://httpbin.org/post"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过上述方法，我们可以POST JSON格式的数据 如果想要上传文件，那么直接用 file 参数即可 新建一个 a.txt 的文件，内容写上 Hello World!</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://httpbin.org/post'</span></span><br><span class="line"><span class="keyword">files</span> = &#123;<span class="string">'file'</span>: <span class="keyword">open</span>(<span class="string">'test.txt'</span>, <span class="string">'rb'</span>)&#125;</span><br><span class="line">r = requests.post(url, <span class="keyword">files</span>=<span class="keyword">files</span>)</span><br><span class="line"><span class="keyword">print</span> r.text</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以看到运行结果如下</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"args"</span>: &#123;&#125;, </span><br><span class="line">  <span class="attr">"data"</span>: <span class="string">""</span>, </span><br><span class="line">  <span class="attr">"files"</span>: &#123;</span><br><span class="line">    <span class="attr">"file"</span>: <span class="string">"Hello World!"</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="attr">"form"</span>: &#123;&#125;, </span><br><span class="line">  <span class="attr">"headers"</span>: &#123;</span><br><span class="line">    <span class="attr">"Accept"</span>: <span class="string">"*/*"</span>, </span><br><span class="line">    <span class="attr">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>, </span><br><span class="line">    <span class="attr">"Content-Length"</span>: <span class="string">"156"</span>, </span><br><span class="line">    <span class="attr">"Content-Type"</span>: <span class="string">"multipart/form-data; boundary=7d8eb5ff99a04c11bb3e862ce78d7000"</span>, </span><br><span class="line">    <span class="attr">"Host"</span>: <span class="string">"httpbin.org"</span>, </span><br><span class="line">    <span class="attr">"User-Agent"</span>: <span class="string">"python-requests/2.9.1"</span></span><br><span class="line">  &#125;, </span><br><span class="line">  <span class="attr">"json"</span>: <span class="literal">null</span>, </span><br><span class="line">  <span class="attr">"url"</span>: <span class="string">"http://httpbin.org/post"</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们便成功完成了一个文件的上传。 requests 是支持流式上传的，这允许你发送大的数据流或文件而无需先把它们读入内存。要使用流式上传，仅需为你的请求体提供一个类文件对象即可</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">'massive-body'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    requests.<span class="built_in">post</span>(<span class="string">'http://some.url/streamed'</span>, data=f)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这是一个非常实用方便的功能。</p>
                  <h2 id="Cookies"><a href="#Cookies" class="headerlink" title="Cookies"></a>Cookies</h2>
                  <p>如果一个响应中包含了cookie，那么我们可以利用 cookies 变量来拿到</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://example.com'</span></span><br><span class="line">r = requests.<span class="builtin-name">get</span>(url)</span><br><span class="line"><span class="builtin-name">print</span> r.cookies</span><br><span class="line"><span class="builtin-name">print</span> r.cookies[<span class="string">'example_cookie_name'</span>]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上程序仅是样例，可以用 cookies 变量来得到站点的 cookies 另外可以利用 cookies 变量来向服务器发送 cookies 信息</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://httpbin.org/cookies'</span></span><br><span class="line">cookies = dict(<span class="attribute">cookies_are</span>=<span class="string">'working'</span>)</span><br><span class="line">r = requests.<span class="builtin-name">get</span>(url, <span class="attribute">cookies</span>=cookies)</span><br><span class="line"><span class="builtin-name">print</span> r.text</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果</p>
                  <figure class="highlight scilab">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="string">'&#123;"</span>cookies<span class="string">": &#123;"</span>cookies_are<span class="string">": "</span>working<span class="string">"&#125;&#125;'</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以已经成功向服务器发送了 cookies</p>
                  <h2 id="超时配置"><a href="#超时配置" class="headerlink" title="超时配置"></a>超时配置</h2>
                  <p>可以利用 timeout 变量来配置最大请求时间</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">requests.<span class="builtin-name">get</span>(<span class="string">'http://github.com'</span>, <span class="attribute">timeout</span>=0.001)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><strong>注：timeout 仅对连接过程有效，与响应体的下载无关。</strong> 也就是说，这个时间只限制请求的时间。即使返回的 response 包含很大内容，下载需要一定时间，然而这并没有什么卵用。</p>
                  <h2 id="会话对象"><a href="#会话对象" class="headerlink" title="会话对象"></a>会话对象</h2>
                  <p>在以上的请求中，每次请求其实都相当于发起了一个新的请求。也就是相当于我们每个请求都用了不同的浏览器单独打开的效果。也就是它并不是指的一个会话，即使请求的是同一个网址。比如</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">requests.<span class="builtin-name">get</span>(<span class="string">'http://httpbin.org/cookies/set/sessioncookie/123456789'</span>)</span><br><span class="line">r = requests.<span class="builtin-name">get</span>(<span class="string">"http://httpbin.org/cookies"</span>)</span><br><span class="line"><span class="builtin-name">print</span>(r.text)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果是</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"cookies"</span>: &#123;&#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>很明显，这不在一个会话中，无法获取 cookies，那么在一些站点中，我们需要保持一个持久的会话怎么办呢？就像用一个浏览器逛淘宝一样，在不同的选项卡之间跳转，这样其实就是建立了一个长久会话。 解决方案如下</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">s = requests.Session()</span><br><span class="line">s.<span class="builtin-name">get</span>(<span class="string">'http://httpbin.org/cookies/set/sessioncookie/123456789'</span>)</span><br><span class="line">r = s.<span class="builtin-name">get</span>(<span class="string">"http://httpbin.org/cookies"</span>)</span><br><span class="line"><span class="builtin-name">print</span>(r.text)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里我们请求了两次，一次是设置 cookies，一次是获得 cookies 运行结果</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"cookies"</span>: &#123;</span><br><span class="line">    <span class="attr">"sessioncookie"</span>: <span class="string">"123456789"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>发现可以成功获取到 cookies 了，这就是建立一个会话到作用。体会一下。 那么既然会话是一个全局的变量，那么我们肯定可以用来全局的配置了。</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">s = requests.<span class="keyword">Session</span>()</span><br><span class="line">s.headers.<span class="keyword">update</span>(&#123;<span class="string">'x-test'</span>: <span class="string">'true'</span>&#125;)</span><br><span class="line">r = s.<span class="keyword">get</span>(<span class="string">'http://httpbin.org/headers'</span>, headers=&#123;<span class="string">'x-test2'</span>: <span class="string">'true'</span>&#125;)</span><br><span class="line">print r.text</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过 s.headers.update 方法设置了 headers 的变量。然后我们又在请求中设置了一个 headers，那么会出现什么结果？ 很简单，两个变量都传送过去了。 运行结果</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"headers"</span>: &#123;</span><br><span class="line">    <span class="attr">"Accept"</span>: <span class="string">"*/*"</span>, </span><br><span class="line">    <span class="attr">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>, </span><br><span class="line">    <span class="attr">"Host"</span>: <span class="string">"httpbin.org"</span>, </span><br><span class="line">    <span class="attr">"User-Agent"</span>: <span class="string">"python-requests/2.9.1"</span>, </span><br><span class="line">    <span class="attr">"X-Test"</span>: <span class="string">"true"</span>, </span><br><span class="line">    <span class="attr">"X-Test2"</span>: <span class="string">"true"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果get方法传的headers 同样也是 x-test 呢？</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">r</span> = s.get(<span class="string">'http://httpbin.org/headers'</span>, headers=&#123;<span class="string">'x-test'</span>: <span class="string">'true'</span>&#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>嗯，它会覆盖掉全局的配置</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"headers"</span>: &#123;</span><br><span class="line">    <span class="attr">"Accept"</span>: <span class="string">"*/*"</span>, </span><br><span class="line">    <span class="attr">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>, </span><br><span class="line">    <span class="attr">"Host"</span>: <span class="string">"httpbin.org"</span>, </span><br><span class="line">    <span class="attr">"User-Agent"</span>: <span class="string">"python-requests/2.9.1"</span>, </span><br><span class="line">    <span class="attr">"X-Test"</span>: <span class="string">"true"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>那如果不想要全局配置中的一个变量了呢？很简单，设置为 None 即可</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">r</span> = s.get(<span class="string">'http://httpbin.org/headers'</span>, headers=&#123;<span class="string">'x-test'</span>: None&#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果</p>
                  <figure class="highlight json">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"headers"</span>: &#123;</span><br><span class="line">    <span class="attr">"Accept"</span>: <span class="string">"*/*"</span>, </span><br><span class="line">    <span class="attr">"Accept-Encoding"</span>: <span class="string">"gzip, deflate"</span>, </span><br><span class="line">    <span class="attr">"Host"</span>: <span class="string">"httpbin.org"</span>, </span><br><span class="line">    <span class="attr">"User-Agent"</span>: <span class="string">"python-requests/2.9.1"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>嗯，以上就是 session 会话的基本用法</p>
                  <h2 id="SSL证书验证"><a href="#SSL证书验证" class="headerlink" title="SSL证书验证"></a>SSL证书验证</h2>
                  <p>现在随处可见 https 开头的网站，Requests可以为HTTPS请求验证SSL证书，就像web浏览器一样。要想检查某个主机的SSL证书，你可以使用 verify 参数 现在 12306 证书不是无效的嘛，来测试一下</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">r = requests.<span class="builtin-name">get</span>(<span class="string">'https://kyfw.12306.cn/otn/'</span>, <span class="attribute">verify</span>=<span class="literal">True</span>)</span><br><span class="line"><span class="builtin-name">print</span> r.text</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">requests</span><span class="selector-class">.exceptions</span><span class="selector-class">.SSLError</span>: <span class="selector-attr">[SSL: CERTIFICATE_VERIFY_FAILED]</span> <span class="selector-tag">certificate</span> <span class="selector-tag">verify</span> <span class="selector-tag">failed</span> (_<span class="selector-tag">ssl</span><span class="selector-class">.c</span><span class="selector-pseudo">:590)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>果真如此 来试下 github 的</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">r = requests.<span class="builtin-name">get</span>(<span class="string">'https://github.com'</span>, <span class="attribute">verify</span>=<span class="literal">True</span>)</span><br><span class="line"><span class="builtin-name">print</span> r.text</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>嗯，正常请求，内容我就不输出了。 如果我们想跳过刚才 12306 的证书验证，把 verify 设置为 False 即可</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">r = requests.<span class="builtin-name">get</span>(<span class="string">'https://kyfw.12306.cn/otn/'</span>, <span class="attribute">verify</span>=<span class="literal">False</span>)</span><br><span class="line"><span class="builtin-name">print</span> r.text</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>发现就可以正常请求了。在默认情况下 verify 是 True，所以如果需要的话，需要手动设置下这个变量。</p>
                  <h2 id="代理"><a href="#代理" class="headerlink" title="代理"></a>代理</h2>
                  <p>如果需要使用代理，你可以通过为任意请求方法提供 proxies 参数来配置单个请求</p>
                  <figure class="highlight nix">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="attr">proxies</span> = &#123;</span><br><span class="line">  <span class="string">"https"</span>: <span class="string">"http://41.118.132.69:4433"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="attr">r</span> = requests.post(<span class="string">"http://httpbin.org/post"</span>, <span class="attr">proxies=proxies)</span></span><br><span class="line">print r.text</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>也可以通过环境变量 HTTP_PROXY 和 HTTPS_PROXY 来配置代理</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">HTTP_PROXY</span>=<span class="string">"http://10.10.1.10:3128"</span></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">HTTPS_PROXY</span>=<span class="string">"http://10.10.1.10:1080"</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过以上方式，可以方便地设置代理。</p>
                  <h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2>
                  <p>以上讲解了 requests 中最常用的参数，如果需要用到更多，请参考官方文档 API <a href="http://docs.python-requests.org/en/master/api/" target="_blank" rel="noopener">API</a></p>
                  <h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2>
                  <p>以上总结了一下 requests 的基本用法，如果你对爬虫有了一定的基础，那么肯定可以很快上手，在此就不多赘述了。 练习才是王道，大家尽快投注于实践中吧。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2016-03-19 21:05:03" itemprop="dateCreated datePublished" datetime="2016-03-19T21:05:03+08:00">2016-03-19</time>
                </span>
                <span id="/2556.html" class="post-meta-item leancloud_visitors" data-flag-title="Python爬虫利器一之Requests库的用法" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>7.6k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>7 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2529.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> JavaScript <i class="label-arrow"></i>
                  </a>
                  <a href="/2529.html" class="post-title-link" itemprop="url">jQuery易忽略的知识点总结</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2>
                  <p>之前在用jQuery，不过有时候用着用着一些用法发现并没有用到过，比较陌生，现在重新梳理一下，把易忽略的知识点总结一下，长期更新。 参考梳理来源： <a href="http://www.imooc.com/learn/11" target="_blank" rel="noopener">慕课网</a></p>
                  <h2 id="sele1-sele2-seleN选择器"><a href="#sele1-sele2-seleN选择器" class="headerlink" title="sele1,sele2,seleN选择器"></a>sele1,sele2,seleN选择器</h2>
                  <p>有时需要精确的选择任意<strong>多个指定的元素</strong>，类似于从文具盒中挑选出多根自已喜欢的笔，就需要调用sele1,sele2,seleN选择器，它的调用格式如下： <code>$(“sele1,sele2,seleN”)</code> 其中参数sele1、sele2到seleN为有效选择器，每个选择器之间用“，”号隔开，它们可以是之前提及的各种类型选择器，如<code>$(“#id”)、$(“.class”)、$(“selector”)</code>选择器等。 例如，通过选择器获取其中的任意两个元素，并将它们显示的内容设为相同，如图所示： <a href="http://img.mukewang.com/528705b000012a1102890134.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/528705b000012a1102890134.jpg" alt=""></a> 在浏览器中显示的效果： <a href="http://img.mukewang.com/528705c700010e6d04720207.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/528705c700010e6d04720207.jpg" alt=""></a> 虽然页面中添加了三个元素，但是通过使用<code>$(“div,p”)</code>选择器方式获取了其中的
                  <div>和<p>元素，并设置它们显示的内容。</p>
                    <h2 id="prev-next选择器"><a href="#prev-next选择器" class="headerlink" title="prev + next选择器"></a>prev + next选择器</h2>
                    <p>俗话说“远亲不如近邻”，而通过<code>prev + next</code>选择器就可以查找与“prev”元素紧邻的下一个“next”元素，格式如下： <code>$(“prev + next”)</code> 其中参数prev为任何有效的选择器，参数“next”为另外一个有效选择器，它们之间的“+”表示一种上下的层次关系，也就是说，“prev”元素最紧邻的下一个元素由“next”选择器返回的并且只返回唯的一个元素。 例如，使用<code>prev + next</code>选择器，获取
                    <p>元素最近邻的下一个元素，如下图所示： <a href="http://img.mukewang.com/5292e68c000191c204000224.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/5292e68c000191c204000224.jpg" alt=""></a> 在浏览器中显示的效果： <a href="http://img.mukewang.com/5292ebe60001dc2b03350376.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/5292ebe60001dc2b03350376.jpg" alt=""></a></p>
                    <h2 id="prev-siblings选择器"><a href="#prev-siblings选择器" class="headerlink" title="prev ~ siblings选择器"></a>prev ~ siblings选择器</h2>
                    <p>与上一节中介绍的<code>prev + next</code>层次选择器相同，<code>prev ~ siblings</code>选择器也是查找prev 元素之后的相邻元素，但前者只获取第一个相邻的元素，而后者则获取prev 元素后面全部相邻的元素，它的调用格式如下： <code>$(“prev ~ siblings”)</code> 其中参数prev与siblings两者之间通过“~”符号形成一种层次相邻的关系，表明siblings选择器获取的元素都是prev元素之后的同辈元素。 例如，使用<code>prev ~ next</code>选择器，获取
                    <p>元素后面相邻的全部元素，并设置它们在页面中显示的内容，如下图所示： <a href="http://img.mukewang.com/5292fc460001105a03310216.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/5292fc460001105a03310216.jpg" alt=""></a> 在浏览器中显示的效果： <a href="http://img.mukewang.com/5292fc690001e15d04200411.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/5292fc690001e15d04200411.jpg" alt=""></a> 可以看出，调用<code>$(&quot;p~span&quot;)</code>选择器代码，获取了
                    <p>元素下面两个(全部)的<span>元素，该元素不包含<p>元素上面的元素和不属于同辈范围的元素。</p>
                        <h2 id="contains-text-过滤选择器"><a href="#contains-text-过滤选择器" class="headerlink" title=":contains(text)过滤选择器"></a>:contains(text)过滤选择器</h2>
                        <p>与上一节介绍的:eq(index)选择器按索引查找元素相比，有时候我们可能希望按照<strong>文本内容</strong>来查找一个或多个元素，那么使用<code>:contains(text)</code>选择器会更加方便， 它的功能是选择<strong>包含</strong>指定字符串的全部元素，它通常与其他元素结合使用，获取包含“text”字符串内容的全部元素对象。其中参数<code>text</code>表示页面中的文字。 例如: <a href="http://img.mukewang.com/529c067b00014cad03480210.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/529c067b00014cad03480210.jpg" alt=""></a> 在浏览器中显示的效果： <a href="http://img.mukewang.com/529c069b0001879204890294.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/529c069b0001879204890294.jpg" alt=""></a> 从图中可以看出，调用<code>li:contains(&#39;土豪&#39;)</code>代码，可以很方便地获取<li>中<strong>包含</strong>‘土豪’字符内容的全部元素，并且只要与选择的元素中或子元素中包含该字符内容，就可以被选中。 注意：<code>li:contains(&#39;土豪&#39;)</code> 土豪为什么必须加单引号呢？因为它是一个字符串，而不是一个变量，所以不加单或双引号的话是会报错的。</p>
                        <h2 id="has-selector-过滤选择器"><a href="#has-selector-过滤选择器" class="headerlink" title=":has(selector)过滤选择器"></a>:has(selector)过滤选择器</h2>
                        <p>除了在上一小节介绍的使用包含的字符串内容过滤元素之外，还可以使用包含的元素名称来过滤，<code>:has(selector)</code>过滤选择器的功能是获取选择器中包含指定元素名称的全部元素，其中<code>selector</code>参数就是包含的元素名称，是被包含元素。 例如：获取指定包含某个元素名的全部<li>元素，并改变它们显示文字的颜色，如下图所示： <a href="http://img.mukewang.com/529c1a8300017dd003040210.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/529c1a8300017dd003040210.jpg" alt=""></a> 在浏览器中显示的效果： <a href="http://img.mukewang.com/529c1aab00017a4d04890294.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/529c1aab00017a4d04890294.jpg" alt=""></a> 可以看出，通过使用<code>$(&quot;li:has(&#39;p&#39;)&quot;)</code>选择器代码，获取了包含<p>元素的全部
                          <li>元素，并通过css方法改变了这些元素在页面中显示的文字样式。
                        </p>
                        <h2 id="hidden过滤选择器"><a href="#hidden过滤选择器" class="headerlink" title=":hidden过滤选择器"></a>:hidden过滤选择器</h2>
                        <p><code>:hidden</code>过滤选择器的功能是获取全部不可见的元素，这些不可见的元素中包括type属性值为hidden的元素。 例如，调用<code>:hidden</code>选择器获取不可见的
                        <p>元素，并将该元素的内容显示在
                        <div>元素中，如下图所示： <a href="http://img.mukewang.com/529c1c5a00011bc303620165.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/529c1c5a00011bc303620165.jpg" alt=""></a> 在浏览器中显示的效果： <a href="http://img.mukewang.com/529c1c760001eaf304890212.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/529c1c760001eaf304890212.jpg" alt=""></a> 从图中可以看出，先调用<code>$(&quot;p:hidden&quot;)</code>代码获取隐藏的<p>元素，并调用该元素的html()方法获取该元素中的内容，最后将该内容显示在
                          <div>元素中。</p>
                    <h2 id="visible过滤选择器"><a href="#visible过滤选择器" class="headerlink" title=":visible过滤选择器"></a>:visible过滤选择器</h2>
                    <p>与上一节的<code>:hidden</code>过滤选择器相反，<code>:visible</code>过滤选择器获取的是全部可见的元素，也就是说，只要不将元素的display属性值设置为“none”，那么，都可以通过该选择器获取。 例如，使用<code>:visible</code>选择器获取可见的
                    <p>元素，并将该元素的内容显示在
                    <div>元素中，如下图所示： <a href="http://img.mukewang.com/529c2106000192f303620159.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/529c2106000192f303620159.jpg" alt=""></a> 在浏览器中显示的效果： <a href="http://img.mukewang.com/529c212000016e8e04890193.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/529c212000016e8e04890193.jpg" alt=""></a> 从图中可以看出，调用<code>$(&quot;p:visible&quot;)</code>选择器代码，获取那个可见的<p>元素，并调用<code>html()</code>方法获取该元素的内容，最后将该内容显示在
                      <div>元素中。</p>
                        <h2 id="input表单选择器"><a href="#input表单选择器" class="headerlink" title=":input表单选择器"></a>:input表单选择器</h2>
                        <p>如何获取表单全部元素？<code>:input</code>表单选择器可以实现，它的功能是返回<strong>全部的表单元素</strong>，不仅包括所有<input>标记的表单元素，而且还包括<textarea>、<select> 和 <button>标记的表单元素，因此，它选择的表单元素是最广的。 如下图所示，使用<code>:input</code>表单选择器获取表单元素，并向这些元素增加一个CSS样式类别，修改它们在页面中显示的边框颜色。 <img src="http://img.mukewang.com/52970dc4000102ab03820242.jpg" alt=""> 在浏览器中显示的效果： <img src="http://img.mukewang.com/52970dd300016ac304760305.jpg" alt=""> 可以看出，通过调用$(“#frmTest :input”)表单选择器代码获取了表单中的全部元素，并使用addClass()方法修改它们在页面中显示的边框颜色。addClass()方法的功能是为元素添加指定的样式类别名称，它的更多使用将会在后续章节中进行详细介绍。</p>
<h2 id="text表单文本选择器"><a href="#text表单文本选择器" class="headerlink" title=":text表单文本选择器"></a>:text表单文本选择器</h2><p><code>:text</code>表单文本选择器可以获取表单中全部单行的文本输入框元素，单行的文本输入框就像一个不换行的字条工具，使用非常广泛。 例如，在表单中添加多个元素，使用<code>:text</code>选择器获取单行的文本输入框元素，并修改字的边框颜色，如下图所示： <img src="http://img.mukewang.com/5297107600011ddf04240201.jpg" alt=""> 在浏览器中显示的效果： <img src="http://img.mukewang.com/52971086000125ea04440275.jpg" alt=""> 从图中可以看出，通过<code>:text</code>表单选择器只获取单行的文本输入框元素，对于<textarea>区域文本、按钮元素无效。</p>
<h2 id="password表单密码选择器"><a href="#password表单密码选择器" class="headerlink" title=":password表单密码选择器"></a>:password表单密码选择器</h2><p>如果想要获取密码输入文本框，可以使用<code>:password</code>选择器，它的功能是获取表单中全部的密码输入文本框元素。 例如，在表单中添加多个输入框元素，使用<code>:password</code>获取密码输入文本框元素，并修改它的边框颜色，如下图所示： <img src="http://img.mukewang.com/529713cd000159b804810217.jpg" alt=""> 在浏览器中显示的效果： <img src="http://img.mukewang.com/529713e50001b30004510309.jpg" alt=""> 从图中可以看出，在多个文本输入框中，使用:password选择器只能获取表单中的密码输入文本框，并使用addClass()方法改变它的边框颜色。</p>
<h2 id="radio单选按钮选择器"><a href="#radio单选按钮选择器" class="headerlink" title=":radio单选按钮选择器"></a>:radio单选按钮选择器</h2><p>表单中的单选按钮常用于多项数据中仅选择其一，而使用<code>:radio</code>选择器可轻松获取表单中的<strong>全部单选按钮</strong>元素。 例如，在表单中添加多种类型的表单元素，使用<code>:radio</code>选择器获取并隐藏这些元素中的全部单选按钮元素，如下图所示： <img src="http://img.mukewang.com/529715580001099503830280.jpg" alt=""> <code>hide()</code>方法的功能是隐藏指定的元素。 在浏览器中显示的效果： <img src="http://img.mukewang.com/529715c60001ca0504500321.jpg" alt=""> 以上是:radio选择器的效果。</p>
<h2 id="checkbox复选框选择器"><a href="#checkbox复选框选择器" class="headerlink" title=":checkbox复选框选择器"></a>:checkbox复选框选择器</h2><p>表单中的复选框常用于多项数据的选择，使用<code>:checkbox</code>选择器可以快速定位并获取表单中的复选框元素。 例如，在表单中增加多个不同类型的元素，使用<code>:checkbox</code>选择器获取其中的全部复选框元素，并将它们全部设为选中状态，如下图所示： <a href="http://img.mukewang.com/52971ac700017fbf03830322.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/52971ac700017fbf03830322.jpg" alt=""></a> 在浏览器中显示的效果： <a href="http://img.mukewang.com/52971afe0001750304500280.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/52971afe0001750304500280.jpg" alt=""></a> 这样便实现了选中 checkbox 的效果，做<strong>全选</strong>的时候比较方便。</p>
<h2 id="submit提交按钮选择器"><a href="#submit提交按钮选择器" class="headerlink" title=":submit提交按钮选择器"></a>:submit提交按钮选择器</h2><p>通常情况下，一个表单中只允许有一个“type”属性值为“submit”的提交按钮，使用<code>:submit</code>选择器可获取表单中的这个<strong>提交按钮</strong>元素。 例如，在表单中添加多个不同类型的按钮，使用<code>:submit</code>选择器获取其中的提交按钮，并使用<code>attr()</code>方法修改按钮显示的文本内容，如下图所示： <a href="http://img.mukewang.com/52b2584e000129a804330199.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/52b2584e000129a804330199.jpg" alt=""></a> 在浏览器中显示的效果： <a href="http://img.mukewang.com/52b258c60001e23604500280.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/52b258c60001e23604500280.jpg" alt=""></a> 从图中可以看出，使用<code>:submit</code>选择器从三种类型按钮中获取了提交按钮，并使用<code>attr()</code>方法将该按钮显示的文字修改为“点我就提交了”。</p>
<h2 id="button表单按钮选择器"><a href="#button表单按钮选择器" class="headerlink" title=":button表单按钮选择器"></a>:button表单按钮选择器</h2><p>表单中包含许多类型的按钮，而使用<code>:button</code>选择器能获取且只能获取“type”属性值为“button”的<input>和<button>这两类普通按钮元素。 例如，在表单中添加多种类型的按钮元素，使用<code>:button</code>选择器获取其中的普通按钮元素，并修改它们的边框色，如下图所示： <a href="http://img.mukewang.com/52b286a50001862e04740207.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/52b286a50001862e04740207.jpg" alt=""></a> 在浏览器中显示的效果： <a href="http://img.mukewang.com/52b286e100017beb04530252.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/52b286e100017beb04530252.jpg" alt=""></a> 从图中可以看出，使用<code>:button</code>选择器只能获取两种类型的普通按钮，且修改了它们的边框颜色，并未获取表单中的“提交按钮”。</p>
<h2 id="checked选中状态选择器"><a href="#checked选中状态选择器" class="headerlink" title=":checked选中状态选择器"></a>:checked选中状态选择器</h2><p>有一些元素存在选中状态，如复选框、单选按钮元素，选中时“checked”属性值为“checked”，调用:checked可以获取处于选中状态的全部元素。 例如，在表单中添加多个复选框和单选按钮，其中有一些元素处于选中状态，使用<code>:checked</code><strong>获取</strong>并<strong>隐藏</strong>处于选中状态的元素，如下图所示： <a href="http://img.mukewang.com/52b28b1500017db404530386.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/52b28b1500017db404530386.jpg" alt=""></a> 在浏览器中显示的效果： <a href="http://img.mukewang.com/52b28b3b00015c7f04500290.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/52b28b3b00015c7f04500290.jpg" alt=""></a> 从图中可以看出，使用<code>:checked</code>选择器可以获取处于选中状态的元素，并调用<code>hide()</code>方法将它们进行隐藏。</p>
<h2 id="selected选中状态选择器"><a href="#selected选中状态选择器" class="headerlink" title=":selected选中状态选择器"></a>:selected选中状态选择器</h2><p>与<code>:checked</code>选择器相比，<code>:selected</code>选择器只能获取<select>下拉列表框中全部处于选中状态的<option>选项元素。 例如，在一个添加多个<option>选项的下拉列表框中，使用<code>:selected</code>选择器修改处于选中状态的内容值，如下图所示： <a href="http://img.mukewang.com/52b28d15000198f404430262.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/52b28d15000198f404430262.jpg" alt=""></a> 在浏览器中显示的效果： <a href="http://img.mukewang.com/52b28d370001a09004570304.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/52b28d370001a09004570304.jpg" alt=""></a> 从图中可以看出，使用<code>:selected</code>选择器获取处于选中状态的<option>元素，并调用<code>text()</code>方法修改这些选中状态元素显示的内容。<code>text()</code>方法的功能是获取或设置元素的文本内容，该方法在后续将有详细的介绍。</p>
<h2 id="first-child子元素过滤选择器"><a href="#first-child子元素过滤选择器" class="headerlink" title=":first-child子元素过滤选择器"></a>:first-child子元素过滤选择器</h2><p>通过上面章节的学习，我们知道使用<code>:first</code>过滤选择器可以获取指定父元素中的首个子元素，但该选择器返回的只有一个元素，并不是一个集合，而使用<code>:first-child</code>子元素过滤选择器则可以获取每个父元素中返回的首个子元素，它是一个集合，常用多个集合数据的选择处理。 如下图，如果想把页面中每个ul中的第一个li获取到，并改变其颜色。则可以使用 <code>: first-child</code> <a href="http://img.mukewang.com/529c2a9000014a0e03500322.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/529c2a9000014a0e03500322.jpg" alt=""></a> 在浏览器中显示的效果： <a href="http://img.mukewang.com/529c2ab600011b5804890326.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/529c2ab600011b5804890326.jpg" alt=""></a> 通过<code>$(&quot;li:first-child&quot;)</code>选择器代码，获取了两个<ul>父元素中的第一个<li>元素，并使用<code>css()</code>方法修改了它们在页面中显示的文字颜色。</p>
<h2 id="替换内容"><a href="#替换内容" class="headerlink" title="替换内容"></a>替换内容</h2><p><code>replaceWith()</code>和<code>replaceAll()</code>方法都可以用于替换元素或元素中的内容，但它们调用时，内容和被替换元素所在的位置不同，分别为如下所示： <code>**$(selector).replaceWith(content)**</code>和<code>**$(content).replaceAll(selector)**</code> 参数selector为被替换的元素，content为替换的内容。 例如，调用<code>replaceWith()</code>方法将页面中<span>元素替换成一段HTML字符串，如下图所示： <a href="http://img.mukewang.com/52bcdc2c0001b69c04750130.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/52bcdc2c0001b69c04750130.jpg" alt=""></a> 在浏览器中显示的效果： <a href="http://img.mukewang.com/52bcdc4f0001e25f04830237.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/52bcdc4f0001e25f04830237.jpg" alt=""></a> 从图中可以看出，使用<code>replaceWith()</code>方法替换类别名为“green”的<span>元素，替换之后，旧元素完全由新替换的元素所取代。</p>
<h2 id="使用wrap-和wrapInner-方法包裹元素和内容"><a href="#使用wrap-和wrapInner-方法包裹元素和内容" class="headerlink" title="使用wrap()和wrapInner()方法包裹元素和内容"></a>使用wrap()和wrapInner()方法包裹元素和内容</h2><p><code>wrap()</code>和<code>wrapInner()</code>方法都可以进行元素的包裹，但前者用于包裹元素本身，后者则用于包裹元素中的内容，它们的调用格式分别为： <code>**$(selector).wrap(wrapper)**</code>和<code>**$(selector).wrapInner(wrapper)**</code> 参数selector为被包裹的元素，wrapper参数为包裹元素的格式。 例如，调用<code>wrap()</code>方法，将<span>用<div>元素包裹起来，如下图所示： <a href="http://img.mukewang.com/52bcdea700016dbf03980120.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/52bcdea700016dbf03980120.jpg" alt=""></a> 在浏览器中显示的效果： <a href="http://img.mukewang.com/52bcdf080001301504830245.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/52bcdf080001301504830245.jpg" alt=""></a> 从图中可以看出，红色区域的<span>元素被蓝色边框的<div>元素通过<code>wrap()</code>方法包裹起来</p>
<h2 id="使用remove-和empty-方法删除元素"><a href="#使用remove-和empty-方法删除元素" class="headerlink" title="使用remove()和empty()方法删除元素"></a>使用remove()和empty()方法删除元素</h2><p><code>remove()</code>方法删除所选元素本身和子元素，该方法可以通过添加过滤参数指定需要删除的某些元素，而<code>empty()</code>方法则只删除所选元素的子元素。 例如，调用<code>remove()</code>方法删除<span>元素中类别名为“red”的，如下图所示： <a href="http://img.mukewang.com/52bceff500018e0702910171.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/52bceff500018e0702910171.jpg" alt=""></a> 在浏览器中显示的效果： <a href="http://img.mukewang.com/52bcf01c00013b5004830297.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/52bcf01c00013b5004830297.jpg" alt=""></a> 从图中可以看出，使用<code>remove(&quot;.red&quot;)</code>方法只是把<span>元素中类别名为“red”的这部分元素给删除了。</p>
<h2 id="使用hover-方法切换事件"><a href="#使用hover-方法切换事件" class="headerlink" title="使用hover()方法切换事件"></a>使用hover()方法切换事件</h2><p><code>hover()</code>方法的功能是当鼠标移到所选元素上时，执行方法中的第一个函数，鼠标移出时，执行方法中的第二个函数，实现事件的切实效果，调用格式如下： <code>**$(selector).hover(over****，****out);**</code> over参数为移到所选元素上触发的函数，out参数为移出元素时触发的函数。 例如，当鼠标移到<div>元素上时，元素中的字体变成金黄色，如下图所示： <a href="http://img.mukewang.com/52d22c9900013dbd03190241.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/52d22c9900013dbd03190241.jpg" alt=""></a> 在浏览器中显示的效果： <a href="http://img.mukewang.com/52d22cba0001163f04670262.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/52d22cba0001163f04670262.jpg" alt=""></a> 从图中可以看出，使用<code>hover()</code>方法执行两个函数，当鼠标移在元素上时调用<code>addClass()</code>方法增加一个样式，移出时，调用<code>removeClass()</code>方法移除该样式。</p>
<h2 id="使用toggle-方法绑定多个函数"><a href="#使用toggle-方法绑定多个函数" class="headerlink" title="使用toggle()方法绑定多个函数"></a>使用toggle()方法绑定多个函数</h2><p><code>toggle()</code>方法可以在元素的click事件中绑定两个或两个以上的函数，同时，它还可以实现元素的隐藏与显示的切换，绑定多个函数的调用格式如下： <code>**$(selector).toggle(fun1(),fun2(),funN(),...)**</code> 其中，fun1，fun2就是多个函数的名称 例如，使用<code>toggle()</code>方法，当每次点击<div>元素时，显示不同内容，如下图所示： <a href="http://img.mukewang.com/52d22e3a0001c56d02980289.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/52d22e3a0001c56d02980289.jpg" alt=""></a> 在浏览器中显示的效果： <a href="http://img.mukewang.com/52d22e570001902a04670335.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/52d22e570001902a04670335.jpg" alt=""></a> 从图中可以看出，每次点击<div>元素时，都依次执行<code>toggle()</code>方法绑定的函数，当执行到最后一个函数时，再次点击将又返回执行第一个函数。 注意：toggle()方法支持目前主流稳定的jQuery版本1.8.2，在1.9.0之后的版本是不支持的。</p>
<h2 id="使用one-方法绑定元素的一次性事件"><a href="#使用one-方法绑定元素的一次性事件" class="headerlink" title="使用one()方法绑定元素的一次性事件"></a>使用one()方法绑定元素的一次性事件</h2><p><code>one()</code>方法可以绑定元素任何有效的事件，但这种方法绑定的事件只会触发一次，它的调用格式如下： <code>**$(selector).one(event,[data],fun)**</code> 参数event为事件名称，data为触发事件时携带的数据，fun为触发该事件时执行的函数。 例如，使用one方法绑定<div>元素的单击事件，在事件执行的函数中，累计执行的次数，并将该次数显示在页面中，如下图所示： <a href="http://img.mukewang.com/52d231bd000192fb04310219.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/52d231bd000192fb04310219.jpg" alt=""></a> 在浏览器中显示的效果： <a href="http://img.mukewang.com/52d231dd00011da004890293.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/52d231dd00011da004890293.jpg" alt=""></a> 从图中可以看出，由于使用了<code>one()</code>方法绑定<div>元素的单击事件，因为事件函数只能执行一次，执行完成后，无论如何单击，都不再触发。</p>
<h2 id="调用animate-方法制作移动位置的动画"><a href="#调用animate-方法制作移动位置的动画" class="headerlink" title="调用animate()方法制作移动位置的动画"></a>调用animate()方法制作移动位置的动画</h2><p>调用<code>animate()</code>方法不仅可以制作简单渐渐变大的动画效果，而且还能制作移动位置的动画，在移动位置之前，必须将被移元素的“position”属性值设为“absolute”或“relative”，否则，该元素移动不了。 例如，调用<code>animate()</code>方法先将图片向右移动90px，然后，再将图片宽度与高度分别增加30px，如下图所示： <a href="http://img.mukewang.com/52dcc4eb0001c08e03410291.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/52dcc4eb0001c08e03410291.jpg" alt=""></a> 在浏览器中显示的效果： <a href="http://img.mukewang.com/52dcc50b0001ba2205060337.jpg" target="_blank" rel="noopener"><img src="http://img.mukewang.com/52dcc50b0001ba2205060337.jpg" alt=""></a> 从图中可以看出，图片先向右移动了“90px”，然后，移动成功后，再在原来的基础之上以动画的效果增大30px，增加成功后，显示“执行完成！”的字样。</p>
<p>s</p>
</p>
      
    </div>

  </div>

  
  
  

  <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-user"></i>
      </span>
      <span class="post-meta-item-text">作者</span>
      <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2016-03-16 14:12:32" itemprop="dateCreated datePublished"
            datetime="2016-03-16T14:12:32+08:00">2016-03-16</time>
    </span>

    
    <span id="/2529.html" class="post-meta-item leancloud_visitors" data-flag-title="jQuery易忽略的知识点总结"
          title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
        <span class="post-meta-item-text">本文字数：</span>
      <span>6.2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
        <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>6 分钟</span>
    </span>

  </div>

</article>

    <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2491.html">
  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.png">
    <meta itemprop="name" content="崔庆才">
    <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  </span>
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="静觅">
  </span>
  <header class="post-header">
    <h2 class="post-title" itemprop="name headline">
      <a class="label"> Other <i class="label-arrow"></i>
      </a>
      <a href="/2491.html" class="post-title-link" itemprop="url">PhpStorm使用File Watchers自动编译less</a>
    </h2>
  </header>
  <div class="post-body" itemprop="articleBody">
    <div class="thumb">
      <img itemprop="contentUrl" class="random">
    </div>
    <div class="excerpt">
      <p>
      <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
      <p>PhpStorm 可以使用 File Watchers 自动编译 Less，有了这个 IDE，妈妈再也不用担心我的 Less 编译了。下面说一下我的配置过程。 下面的例子以 Mac OS X 为例。</p>
      <h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2>
      <h3 id="1-配置-npm"><a href="#1-配置-npm" class="headerlink" title="1.配置 npm"></a>1.配置 npm</h3>
      <figure class="highlight mipsasm">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="keyword">brew </span><span class="keyword">install </span>npm</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>更多平台安装方式 <a href="https://www.npmjs.com/" target="_blank" rel="noopener">npm</a></p>
      <h3 id="2-安装-lessc"><a href="#2-安装-lessc" class="headerlink" title="2.安装 lessc"></a>2.安装 lessc</h3>
      <figure class="highlight cmake">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">npm <span class="keyword">install</span> <span class="keyword">less</span> -g</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>安装完毕后查看安装路径</p>
      <figure class="highlight bash">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="built_in">which</span> lessc</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>Mac OS X 的结果是</p>
      <figure class="highlight awk">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/bin/</span>lessc</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <h3 id="3-配置-PhpStorm"><a href="#3-配置-PhpStorm" class="headerlink" title="3.配置 PhpStorm"></a>3.配置 PhpStorm</h3>
      <p>打开 PhpStorm，Preferences-&gt;Tools-&gt;File Watchers 点击加号新增 Less Template，然后点击编辑按钮编辑，页面如下 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2016/02/56926F1E-D626-4E66-925D-15971F993F30.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2016/02/56926F1E-D626-4E66-925D-15971F993F30-1024x557.jpg" alt="56926F1E-D626-4E66-925D-15971F993F30"></a> 其中需要配置两个地方</p>
      <h4 id="Program："><a href="#Program：" class="headerlink" title="Program："></a>Program：</h4>
      <p>配置为 lessc 的路径，这边配置为 /usr/local/bin/lessc</p>
      <h4 id="Output-paths-to-refresh："><a href="#Output-paths-to-refresh：" class="headerlink" title="Output paths to refresh："></a>Output paths to refresh：</h4>
      <figure class="highlight groovy">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">$FileParentDir(less)<span class="string">$/css/$</span>FileDirPathFromParent(less)<span class="string">$/$FileNameWithoutExtension$.css</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>在这里简单解释下这个路径的意思。</p>
      <blockquote>
        <p>例如项目名为 project，less 文件我们放置在 project/public/less/manage/style.less $FileParentDir(less)$ 是获取 less 目录的路径，也就是 project/public $FileDirPathFromParent(less)$ 是获取 less 文件到 less 目录的路径，也就是 manage $FileNameWithoutExtension$ 是获取 less 文件不带后缀的名字，也就是 style 经过如上拼接，生成的内容为 project/public/css/manage/style.css</p>
      </blockquote>
      <p>所以，不论我们的 less 文件如何放置，都可以生成相对路径的 css 文件。 配置完成之后，我们新建 less 目录，任意编辑一个 less 文件，都会在 css 目录下生成相应的文件。</p>
      <h2 id="简单配置"><a href="#简单配置" class="headerlink" title="简单配置"></a>简单配置</h2>
      <p>当然，如果你的 less 文件就直接在 less 目录下，可以简单配置以上的 Output Path 如下 ../css/$FileNameWithoutExtension$.css 这也是一种比较常用的配置方法。 如果目录结构简单，可以采取以上方式。</p>
      </p>
    </div>
  </div>
  <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-user"></i>
      </span>
      <span class="post-meta-item-text">作者</span>
      <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      <time title="创建时间：2016-02-25 14:16:39" itemprop="dateCreated datePublished" datetime="2016-02-25T14:16:39+08:00">2016-02-25</time>
    </span>
    <span id="/2491.html" class="post-meta-item leancloud_visitors" data-flag-title="PhpStorm使用File Watchers自动编译less" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>949</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
  </div>
</article>

    <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2469.html">
  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.png">
    <meta itemprop="name" content="崔庆才">
    <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  </span>
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="静觅">
  </span>
  <header class="post-header">
    <h2 class="post-title" itemprop="name headline">
      <a class="label"> JavaScript <i class="label-arrow"></i>
      </a>
      <a href="/2469.html" class="post-title-link" itemprop="url">JavaScript与jQuery基本用法总结</a>
    </h2>
  </header>
  <div class="post-body" itemprop="articleBody">
    <div class="thumb">
      <img itemprop="contentUrl" class="random">
    </div>
    <div class="excerpt">
      <p>
      <h2 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h2>
      <ol>
        <li><a href="http://cuiqingcai.com/1253.html">JavaScript高级用法一之事件响应与网页交互</a> 2. <a href="http://cuiqingcai.com/1257.html">JavaScript高级用法二之内置对象</a> 3. <a href="http://cuiqingcai.com/1263.html">JavaScript高级用法三之浏览器对象</a> 4. <a href="http://cuiqingcai.com/1278.html">JavaScript高级用法四之DOM对象</a> 5. <a href="http://cuiqingcai.com/1444.html">JavaScript高级用法五之常用对象</a></li>
      </ol>
      <h2 id="jQuery"><a href="#jQuery" class="headerlink" title="jQuery"></a>jQuery</h2>
      <ol>
        <li><a href="http://cuiqingcai.com/1544.html">jQuery应用一之验证插件validate的使用</a> 2. <a href="http://cuiqingcai.com/1573.html">jQuery应用二之邮箱下拉列表自动补全</a> 3. <a href="http://cuiqingcai.com/1585.html">jQuery应用三之图片浏览插件LightBox</a> 4. <a href="http://cuiqingcai.com/1592.html">jQuery应用四之图片局部放大插件jQZoom</a> 5. <a href="http://cuiqingcai.com/1680.html">jQuery应用五之瀑布流效果的实现</a></li>
      </ol>
      </p>
    </div>
  </div>
  <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-user"></i>
      </span>
      <span class="post-meta-item-text">作者</span>
      <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      <time title="创建时间：2016-02-11 21:50:19" itemprop="dateCreated datePublished" datetime="2016-02-11T21:50:19+08:00">2016-02-11</time>
    </span>
    <span id="/2469.html" class="post-meta-item leancloud_visitors" data-flag-title="JavaScript与jQuery基本用法总结" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>250</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
  </div>
</article>

    <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2467.html">
  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.png">
    <meta itemprop="name" content="崔庆才">
    <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  </span>
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="静觅">
  </span>
  <header class="post-header">
    <h2 class="post-title" itemprop="name headline">
      <a class="label"> C/C++ <i class="label-arrow"></i>
      </a>
      <a href="/2467.html" class="post-title-link" itemprop="url">OpenGL绘图学习总结</a>
    </h2>
  </header>
  <div class="post-body" itemprop="articleBody">
    <div class="thumb">
      <img itemprop="contentUrl" class="random">
    </div>
    <div class="excerpt">
      <p>
      <h2 id="目录索引"><a href="#目录索引" class="headerlink" title="目录索引"></a>目录索引</h2>
      <ol>
        <li><a href="http://cuiqingcai.com/1597.html">OpenGL绘图实例一之机器人的绘制</a> 2. <a href="http://cuiqingcai.com/1613.html">OpenGL绘图实例二之直线和圆弧的绘制</a> 3. O<a href="http://cuiqingcai.com/1640.html">penGL绘图实例三之种子填充算法</a> 4. <a href="http://cuiqingcai.com/1649.html">OpenGL绘图实例四之区域颜色填充</a> 5. <a href="http://cuiqingcai.com/1658.html">OpenGL绘图实例五之平移缩放旋转</a> 6. <a href="http://cuiqingcai.com/1776.html">OpenGL绘图实例六之鼠标监听事件</a> 7. <a href="http://cuiqingcai.com/1783.html">OpenGL绘图实例七之鼠标设色取点绘图</a> 7. <a href="http://cuiqingcai.com/1802.html">OpenGL绘图实例八之图形的移动删除存盘</a> 9. <a href="http://cuiqingcai.com/1860.html">OpenGL绘图实例九之3D绘图基础</a> 10. <a href="http://cuiqingcai.com/1867.html">OpenGL绘图实例十之绘制3D机器人</a></li>
      </ol>
      </p>
    </div>
  </div>
  <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-user"></i>
      </span>
      <span class="post-meta-item-text">作者</span>
      <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      <time title="创建时间：2016-02-11 21:42:24" itemprop="dateCreated datePublished" datetime="2016-02-11T21:42:24+08:00">2016-02-11</time>
    </span>
    <span id="/2467.html" class="post-meta-item leancloud_visitors" data-flag-title="OpenGL绘图学习总结" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>211</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
  </div>
</article>

    <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2465.html">
  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.png">
    <meta itemprop="name" content="崔庆才">
    <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  </span>
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="静觅">
  </span>
  <header class="post-header">
    <h2 class="post-title" itemprop="name headline">
      <a class="label"> C/C++ <i class="label-arrow"></i>
      </a>
      <a href="/2465.html" class="post-title-link" itemprop="url">Winpcap网络编程学习探究</a>
    </h2>
  </header>
  <div class="post-body" itemprop="articleBody">
    <div class="thumb">
      <img itemprop="contentUrl" class="random">
    </div>
    <div class="excerpt">
      <p>
      <h2 id="目录索引"><a href="#目录索引" class="headerlink" title="目录索引"></a>目录索引</h2>
      <p>1. <a href="http://cuiqingcai.com/1890.html">Winpcap网络编程一之前言，实验要求，实验目标</a> 2. <a href="http://cuiqingcai.com/1898.html">Winpcap网络编程二之环境配置，Eclipse配置C/C++环境</a> 3. <a href="http://cuiqingcai.com/1906.html">Winpcap网络编程三之环境配置，Eclipse配置Winpcap环境</a> 4. <a href="http://cuiqingcai.com/1913.html">Winpcap网络编程四之环境配置，VS配置Winpcap环境</a> 5. <a href="http://cuiqingcai.com/1918.html">Winpcap网络编程五之ARP协议获得MAC表及主机通信</a> 6. <a href="http://cuiqingcai.com/1922.html">Winpcap网络编程六之两台主机通过中间主机通信</a></p>
      </p>
    </div>
  </div>
  <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-user"></i>
      </span>
      <span class="post-meta-item-text">作者</span>
      <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      <time title="创建时间：2016-02-11 21:27:53" itemprop="dateCreated datePublished" datetime="2016-02-11T21:27:53+08:00">2016-02-11</time>
    </span>
    <span id="/2465.html" class="post-meta-item leancloud_visitors" data-flag-title="Winpcap网络编程学习探究" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>196</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
  </div>
</article>

    <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2443.html">
  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.png">
    <meta itemprop="name" content="崔庆才">
    <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  </span>
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="静觅">
  </span>
  <header class="post-header">
    <h2 class="post-title" itemprop="name headline">
      <a class="label"> Python <i class="label-arrow"></i>
      </a>
      <a href="/2443.html" class="post-title-link" itemprop="url">Python爬虫进阶二之PySpider框架安装配置</a>
    </h2>
  </header>
  <div class="post-body" itemprop="articleBody">
    <div class="thumb">
      <img itemprop="contentUrl" class="random">
    </div>
    <div class="excerpt">
      <p>
      <h2 id="2022-年最新-Python3-网络爬虫教程"><a href="#2022-年最新-Python3-网络爬虫教程" class="headerlink" title="2022 年最新 Python3 网络爬虫教程"></a>2022 年最新 Python3 网络爬虫教程</h2>
      <p>大家好，我是崔庆才，由于爬虫技术不断迭代升级，一些旧的教程已经过时、案例已经过期，最前沿的爬虫技术比如异步、JavaScript 逆向、安卓逆向、智能解析、WebAssembly、大规模分布式、Kubernetes 等技术层出不穷，我最近新出了一套最新最全面的 Python3 网络爬虫系列教程。</p>
      <blockquote>
        <p>博主自荐：截止 2022 年，可以将最前沿最全面的爬虫技术都涵盖的教程，如异步、JavaScript 逆向、安卓逆向、智能解析、WebAssembly、大规模分布式、Kubernetes 等，市面上目前就这一套了。</p>
      </blockquote>
      <p>最新教程对旧的爬虫技术内容进行了全面更新，搭建了全新的案例平台进行全面讲解，保证案例稳定有效不过期。</p>
      <p>教程请移步：</p>
      <p><a href="https://cuiqingcai.com/17777.html">【2022 版】Python3 网络爬虫学习教程</a></p>
      <p>如下为原文。</p>
      <h2 id="关于"><a href="#关于" class="headerlink" title="关于"></a>关于</h2>
      <p>首先，在此附上项目的地址，以及官方文档 <a href="https://github.com/binux/pyspider" target="_blank" rel="noopener">PySpider</a> <a href="http://docs.pyspider.org/en/latest/" target="_blank" rel="noopener">官方文档</a></p>
      <h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2>
      <h3 id="1-pip"><a href="#1-pip" class="headerlink" title="1. pip"></a>1. pip</h3>
      <p>首先确保你已经安装了 pip，若没有安装，请参照 <a href="http://pip-cn.readthedocs.org/en/latest/installing.html" target="_blank" rel="noopener">pip 安装</a></p>
      <h3 id="2-phantomjs"><a href="#2-phantomjs" class="headerlink" title="2. phantomjs"></a>2. phantomjs</h3>
      <p>PhantomJS 是一个基于 WebKit 的服务器端 JavaScript API。它全面支持 web 而不需浏览器支持，其快速、原生支持各种 Web 标准：DOM 处理、CSS 选择器、JSON、Canvas 和 SVG。 PhantomJS 可以用于页面自动化、网络监测、网页截屏以及无界面测试等。 <a href="http://phantomjs.org/download.html" target="_blank" rel="noopener">安装</a> 以上附有官方安装方式，如果你是 Ubuntu 或 Mac OS X 用户，可以直接用命令来安装 Ubuntu:</p>
      <figure class="highlight routeros">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">sudo apt-<span class="builtin-name">get</span> install phantomjs</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>Mac OS X:</p>
      <figure class="highlight mipsasm">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="keyword">brew </span><span class="keyword">install </span>phantomjs</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <h3 id="3-pyspider"><a href="#3-pyspider" class="headerlink" title="3. pyspider"></a>3. pyspider</h3>
      <p>直接利用 pip 安装即可</p>
      <figure class="highlight cmake">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">pip <span class="keyword">install</span> pyspider</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>如果你是 Ubuntu 用户，请提前安装好以下支持类库</p>
      <figure class="highlight vim">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">sudo apt-<span class="built_in">get</span> install <span class="keyword">python</span> <span class="keyword">python</span>-dev <span class="keyword">python</span>-distribute <span class="keyword">python</span>-pip libcurl4-openssl-dev libxml2-dev libxslt1-dev <span class="keyword">python</span>-lxml</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>测试 如果安装过程没有提示任何错误，那就证明一些 OK。 命令行输入</p>
      <figure class="highlight ada">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">pyspider <span class="keyword">all</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>然后浏览器访问 <a href="http://localhost:5000" target="_blank" rel="noopener">http://localhost:5000</a> 观察一下效果，如果可以正常出现 PySpider 的页面，那证明一切 OK 在此附图一张，这是我写了几个爬虫之后的界面。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2016/02/2016-02-11-20.55.36.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2016/02/2016-02-11-20.55.36-1024x355.png" alt="2016-02-11 20.55.36"></a> 好，接下来我会进一步介绍这个框架的使用。</p>
      <h2 id="常见错误"><a href="#常见错误" class="headerlink" title="常见错误"></a>常见错误</h2>
      <p>我曾遇到过的一个错误： <a href="http://cuiqingcai.com/2703.html">PySpider HTTP 599: SSL certificate problem 错误的解决方法</a> ，后来在作者那发了 issue 得到了答案，其他的暂时没什么问题。 不过发现有的小伙伴提了各种各样的问题啊，不过我确实都没遇到过，我再 Win10，Linux Ubuntu，Linux CentOS，Mac OS X 都成功运行。不过确实有些奇怪的问题，跑着跑着崩了，一点就崩了我也就比较纳闷了。 如果大家有问题，可以看看作者项目里面有没有类似的 issue，另外也推荐大家直接到作者的 GitHub 上发 issue。 毕竟，这个框架不是我写的。 在此附上 Issue 地址： <a href="https://github.com/binux/pyspider/issues" target="_blank" rel="noopener">PySpider Issue</a></p>
      </p>
    </div>
  </div>
  <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-user"></i>
      </span>
      <span class="post-meta-item-text">作者</span>
      <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      <time title="创建时间：2016-02-11 21:00:04" itemprop="dateCreated datePublished" datetime="2016-02-11T21:00:04+08:00">2016-02-11</time>
    </span>
    <span id="/2443.html" class="post-meta-item leancloud_visitors" data-flag-title="Python爬虫进阶二之PySpider框架安装配置" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
  </div>
</article>

    <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2433.html">
  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.png">
    <meta itemprop="name" content="崔庆才">
    <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  </span>
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="静觅">
  </span>
  <header class="post-header">
    <h2 class="post-title" itemprop="name headline">
      <a class="label"> Python <i class="label-arrow"></i>
      </a>
      <a href="/2433.html" class="post-title-link" itemprop="url">Python爬虫进阶一之爬虫框架概述</a>
    </h2>
  </header>
  <div class="post-body" itemprop="articleBody">
    <div class="thumb">
      <img itemprop="contentUrl" class="random">
    </div>
    <div class="excerpt">
      <p>
      <h2 id="2022-年最新-Python3-网络爬虫教程"><a href="#2022-年最新-Python3-网络爬虫教程" class="headerlink" title="2022 年最新 Python3 网络爬虫教程"></a>2022 年最新 Python3 网络爬虫教程</h2>
      <p>大家好，我是崔庆才，由于爬虫技术不断迭代升级，一些旧的教程已经过时、案例已经过期，最前沿的爬虫技术比如异步、JavaScript 逆向、安卓逆向、智能解析、WebAssembly、大规模分布式、Kubernetes 等技术层出不穷，我最近新出了一套最新最全面的 Python3 网络爬虫系列教程。</p>
      <blockquote>
        <p>博主自荐：截止 2022 年，可以将最前沿最全面的爬虫技术都涵盖的教程，如异步、JavaScript 逆向、安卓逆向、智能解析、WebAssembly、大规模分布式、Kubernetes 等，市面上目前就这一套了。</p>
      </blockquote>
      <p>最新教程对旧的爬虫技术内容进行了全面更新，搭建了全新的案例平台进行全面讲解，保证案例稳定有效不过期。</p>
      <p>教程请移步：</p>
      <p><a href="https://cuiqingcai.com/17777.html">【2022 版】Python3 网络爬虫学习教程</a></p>
      <p>如下为原文。</p>
      <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
      <p>爬虫入门之后，我们有两条路可以走。 一个是继续深入学习，以及关于设计模式的一些知识，强化Python相关知识，自己动手造轮子，继续为自己的爬虫增加分布式，多线程等功能扩展。另一条路便是学习一些优秀的框架，先把这些框架用熟，可以确保能够应付一些基本的爬虫任务，也就是所谓的解决温饱问题，然后再深入学习它的源码等知识，进一步强化。 就个人而言，前一种方法其实就是自己动手造轮子，前人其实已经有了一些比较好的框架，可以直接拿来用，但是为了自己能够研究得更加深入和对爬虫有更全面的了解，自己动手去多做。后一种方法就是直接拿来前人已经写好的比较优秀的框架，拿来用好，首先确保可以完成你想要完成的任务，然后自己再深入研究学习。第一种而言，自己探索的多，对爬虫的知识掌握会比较透彻。第二种，拿别人的来用，自己方便了，可是可能就会没有了深入研究框架的心情，还有可能思路被束缚。 不过个人而言，我自己偏向后者。造轮子是不错，但是就算你造轮子，你这不也是在基础类库上造轮子么？能拿来用的就拿来用，学了框架的作用是确保自己可以满足一些爬虫需求，这是最基本的温饱问题。倘若你一直在造轮子，到最后都没造出什么来，别人找你写个爬虫研究了这么长时间了都写不出来，岂不是有点得不偿失？所以，进阶爬虫我还是建议学习一下框架，作为自己的几把武器。至少，我们可以做到了，就像你拿了把枪上战场了，至少，你是可以打击敌人的，比你一直在磨刀好的多吧？</p>
      <h2 id="框架概述"><a href="#框架概述" class="headerlink" title="框架概述"></a>框架概述</h2>
      <p>博主接触了几个爬虫框架，其中比较好用的是 Scrapy 和PySpider。就个人而言，pyspider上手更简单，操作更加简便，因为它增加了 WEB 界面，写爬虫迅速，集成了phantomjs，可以用来抓取js渲染的页面。Scrapy自定义程度高，比 PySpider更底层一些，适合学习研究，需要学习的相关知识多，不过自己拿来研究分布式和多线程等等是非常合适的。 在这里博主会一一把自己的学习经验写出来与大家分享，希望大家可以喜欢，也希望可以给大家一些帮助。</p>
      <h2 id="PySpider"><a href="#PySpider" class="headerlink" title="PySpider"></a>PySpider</h2>
      <p><a href="https://github.com/binux/pyspider" target="_blank" rel="noopener">PySpider</a>是<a href="https://github.com/binux" target="_blank" rel="noopener">binux</a>做的一个爬虫架构的开源化实现。主要的功能需求是：</p>
      <ul>
        <li>抓取、更新调度多站点的特定的页面</li>
        <li>需要对页面进行结构化信息提取</li>
        <li>灵活可扩展，稳定可监控</li>
      </ul>
      <p>而这也是绝大多数python爬虫的需求 —— 定向抓取，结构化化解析。但是面对结构迥异的各种网站，单一的抓取模式并不一定能满足，灵活的抓取控制是必须的。为了达到这个目的，单纯的配置文件往往不够灵活，于是，通过脚本去控制抓取是最后的选择。 而去重调度，队列，抓取，异常处理，监控等功能作为框架，提供给抓取脚本，并保证灵活性。最后加上web的编辑调试环境，以及web任务监控，即成为了这套框架。 pyspider的设计基础是：<strong>以python脚本驱动的抓取环模型爬虫</strong></p>
      <ul>
        <li>通过python脚本进行结构化信息的提取，follow链接调度抓取控制，实现最大的灵活性</li>
        <li>通过web化的脚本编写、调试环境。web展现调度状态</li>
        <li>抓取环模型成熟稳定，模块间相互独立，通过消息队列连接，从单进程到多机分布式灵活拓展</li>
      </ul>
      <p><img src="http://blog.binux.me/assets/image/pyspider-arch.png" alt="pyspider-arch"></p>
      <p>pyspider的架构主要分为 scheduler（调度器）, fetcher（抓取器）, processor（脚本执行）：</p>
      <ul>
        <li>各个组件间使用消息队列连接，除了scheduler是单点的，fetcher 和 processor 都是可以多实例分布式部署的。 scheduler 负责整体的调度控制</li>
        <li>任务由 scheduler 发起调度，fetcher 抓取网页内容， processor 执行预先编写的python脚本，输出结果或产生新的提链任务（发往 scheduler），形成闭环。</li>
        <li>每个脚本可以灵活使用各种python库对页面进行解析，使用框架API控制下一步抓取动作，通过设置回调控制解析动作。</li>
      </ul>
      <h2 id="Scrapy"><a href="#Scrapy" class="headerlink" title="Scrapy"></a>Scrapy</h2>
      <blockquote>
        <p>Scrapy是一个为了爬取网站数据，提取结构性数据而编写的应用框架。 可以应用在包括数据挖掘，信息处理或存储历史数据等一系列的程序中。 其最初是为了页面抓取 (更确切来说, 网络抓取 )所设计的， 也可以应用在获取API所返回的数据(例如 Amazon Associates Web Services ) 或者通用的网络爬虫。Scrapy用途广泛，可以用于数据挖掘、监测和自动化测试</p>
      </blockquote>
      <p>Scrapy 使用了 Twisted 异步网络库来处理网络通讯。整体架构大致如下</p>
      <p><img src="http://newtonblogimg.qiniudn.com/Scrapy%20Architecture.png" alt="Scrapy"></p>
      <p>Scrapy主要包括了以下组件：</p>
      <ul>
        <li>引擎(Scrapy): 用来处理整个系统的数据流处理, 触发事务(框架核心)</li>
        <li>调度器(Scheduler): 用来接受引擎发过来的请求, 压入队列中, 并在引擎再次请求的时候返回. 可以想像成一个URL（抓取网页的网址或者说是链接）的优先队列, 由它来决定下一个要抓取的网址是什么, 同时去除重复的网址</li>
        <li>下载器(Downloader): 用于下载网页内容, 并将网页内容返回给蜘蛛(Scrapy下载器是建立在twisted这个高效的异步模型上的)</li>
        <li>爬虫(Spiders): 爬虫是主要干活的, 用于从特定的网页中提取自己需要的信息, 即所谓的实体(Item)。用户也可以从中提取出链接,让Scrapy继续抓取下一个页面</li>
        <li>项目管道(Pipeline): 负责处理爬虫从网页中抽取的实体，主要的功能是持久化实体、验证实体的有效性、清除不需要的信息。当页面被爬虫解析后，将被发送到项目管道，并经过几个特定的次序处理数据。</li>
        <li>下载器中间件(Downloader Middlewares): 位于Scrapy引擎和下载器之间的框架，主要是处理Scrapy引擎与下载器之间的请求及响应。</li>
        <li>爬虫中间件(Spider Middlewares): 介于Scrapy引擎和爬虫之间的框架，主要工作是处理蜘蛛的响应输入和请求输出。</li>
        <li>调度中间件(Scheduler Middewares): 介于Scrapy引擎和调度之间的中间件，从Scrapy引擎发送到调度的请求和响应。</li>
      </ul>
      <p>Scrapy运行流程大概如下：</p>
      <ul>
        <li>首先，引擎从调度器中取出一个链接(URL)用于接下来的抓取</li>
        <li>引擎把URL封装成一个请求(Request)传给下载器，下载器把资源下载下来，并封装成应答包(Response)</li>
        <li>然后，爬虫解析Response</li>
        <li>若是解析出实体（Item）,则交给实体管道进行进一步的处理。</li>
        <li>若是解析出的是链接（URL）,则把URL交给Scheduler等待抓取</li>
      </ul>
      <h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2>
      <p>对这两个框架进行基本的介绍之后，接下来我会介绍这两个框架的安装以及框架的使用方法，希望对大家有帮助。</p>
      </p>
    </div>
  </div>
  <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-user"></i>
      </span>
      <span class="post-meta-item-text">作者</span>
      <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      <time title="创建时间：2016-02-11 20:29:29" itemprop="dateCreated datePublished" datetime="2016-02-11T20:29:29+08:00">2016-02-11</time>
    </span>
    <span id="/2433.html" class="post-meta-item leancloud_visitors" data-flag-title="Python爬虫进阶一之爬虫框架概述" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
  </div>
</article>

    <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2416.html">
  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.png">
    <meta itemprop="name" content="崔庆才">
    <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  </span>
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="静觅">
  </span>
  <header class="post-header">
    <h2 class="post-title" itemprop="name headline">
      <a class="label"> 个人随笔 <i class="label-arrow"></i>
      </a>
      <a href="/2416.html" class="post-title-link" itemprop="url">弃用多说，改用畅言</a>
    </h2>
  </header>
  <div class="post-body" itemprop="articleBody">
    <div class="thumb">
      <img itemprop="contentUrl" class="random">
    </div>
    <div class="excerpt">
      <p>
      <p>最近博客的多说评论总是抽风，先来吐槽一下。 刚在整理评论的时候吓我一跳，之前我的好多评论都没了，是的，是只有我自己的评论没有了，而其它人的评论还有。摸不着头脑的我打开多说后台管理，哦天，我之前所有的评论和回复全部自动转为垃圾评论了，八百多条啊，废了一会功夫好不容易批量还原了。结果刷新页面一看，咦，还是没有，重新刷一下后台，竟然再次把我的评论设成垃圾评论了，后来又退出重新绑定了其它平台的账号，总算还原回来了。 然后我就继续开始回复大家的评论呀，结果要发布评论的时候，点一下发布，按钮就卡在正在发布这里不动了。打开浏览器看一下 Ajax 出了什么问题，结果出现了一个 create_json 报了个 500 服务器错误，查看页面信息显示参数配置不正确还是怎么了，没错，是显示我的站点多说评论配置不正确。那，其它人怎么评论上来的？ 另外，之前，多说崩溃了已经不知道多少次了。 真是不爽的多说。 另外，多说还有一个非常令人发指的行为，会自动同步用户文章，收集用户信息，同步我们社交账号，即使是修改用户信息也要进行备份，这尼玛发展一定程度，多说还真有可能有利用这些用户信息谋利，甚至可能利用各个用户的文章做一个个性化阅读推荐也说不定。当然最开始的时候我只是觉得多说比较火，当时用上了也感觉比较方便，加上最初网站没几个东西，心想同步就同步呗，然后就一直用着了。现在再想想，也是可怕。 果断！弃用！弃用！弃用！ 搜索了网上比较热门的评论插件，发现了畅言。使用了 WordPress 插件。 于是用上了，不过还是有一些令我感到不是太友好的地方，简单在此提一下。 嗯，首先我是比较追求美感的，界面问题。首先我会关注有没有个性化主题定制这个功能，畅言还是有的，支持 CSS 自定义。不过这个功能比较蛋疼，如果你不选择已经提供的主题，而是选择自定义 CSS 样式的话，你需要把所有样式重写一遍，它缺省继承了默认主题。比如我如果想在浅色主题红色风格基础上修改几个样式的话，这是办不到的，除非重写所有的红色风格样式，这就鸡肋了。建议可以选择继承某个默认主题的功能，然后自定义的 CSS 是在这个基础上设置的功能。而且我看 WAP 版本并没有自定义 CSS，非常建议增加这个功能。最后我还是选择了红色主题，不过自定义样式就写在了站点全局样式表里面了，以此解决。 其次，同步本地评论功能，由于换了插件，所以评论都留在了本地了。同步完成之后，我并不能在畅言后台管理看到我刚才同步的评论，但是新发的评论是可以看到的，页面也是可以正常显示的。只是不能在线管理早先的原始评论了。 另外，头像问题，其实我个人非常不能忍受一个账号没有头像的行为，简直是大逆不道。畅言有个 QQ 快速登录的功能，然而，登录之后竟然不能获取我的 QQ 头像！不知道是不是我这边的问题，如果大家正常希望可以反馈我一下。另外，QQ 登录之后怎么会给我取了一个奇怪的用户名，叫什么 cmcccc，有点醉。而微博的快速登录的昵称和头像都是正常的，然而每次评论的时候都会默认勾选那个同步到微博的按钮，这个可以默认取消么？ 还有，希望可以增加更多的平台的支持，比如微信、GitHub、脸书、推特等平台啦。 最后，有没有发表文章自动分享到各个平台的功能？我暂时没有发现。这点多说还是做得比较好的。 以上。 嗯，总之换上畅言之后用起来还是比较开心的，嘿嘿主要是改好了样式，看起来一阵舒爽。 昂，没错，我就是颜控！ 有时候，我会因为一个样式不合我意而执着地去修改，即使要花费几个小时。 有时候，我会因为一个应用的图标（没错，就是说的图标）太丑了而卸载掉，即使是它的功能再怎么好。 有时候，我会因为一个屏幕膜有一点点损伤而去重新买一个新的。额，其实是因为今天给电脑贴膜折角了，我又花了几十块重新买了一个新的。 有时候，我就是一个强迫症，在写上面三句话的时候，第一句原本是在第二行的，然而因为看起来长度参差不齐我就把它移动到了最上面。嗯，这第四句话要写得更长才行。 好啦，貌似跑题了，时候不早啦，大家晚安。 嗯，换上调教好的美美的畅言还是很开心的，文章前后呼应，拜～ <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2016/02/屏幕快照-2016-02-03-03.43.51.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2016/02/屏幕快照-2016-02-03-03.43.51-1024x622.png" alt="屏幕快照 2016-02-03 03.43.51"></a> 美美哒～</p>
      </p>
    </div>
  </div>
  <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-user"></i>
      </span>
      <span class="post-meta-item-text">作者</span>
      <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      <time title="创建时间：2016-02-03 03:36:48" itemprop="dateCreated datePublished" datetime="2016-02-03T03:36:48+08:00">2016-02-03</time>
    </span>
    <span id="/2416.html" class="post-meta-item leancloud_visitors" data-flag-title="弃用多说，改用畅言" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.7k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
  </div>
</article>

    <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2401.html">
  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.png">
    <meta itemprop="name" content="崔庆才">
    <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  </span>
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="静觅">
  </span>
  <header class="post-header">
    <h2 class="post-title" itemprop="name headline">
      <a class="label"> 个人日记 <i class="label-arrow"></i>
      </a>
      <a href="/2401.html" class="post-title-link" itemprop="url">强势回归博客，顺便祝大家小年快乐</a>
    </h2>
  </header>
  <div class="post-body" itemprop="articleBody">
    <div class="thumb">
      <img itemprop="contentUrl" class="random">
    </div>
    <div class="excerpt">
      <p>
      <p>Hello，时隔一个多月，终于再次回到博客啦，首先跟大家说声抱歉，许多评论没有及时回复感到非常抱歉，希望我现在给大家的回复为时不晚。 距离上次在博客上写日记过去了几个月了吧。那时的我刚刚结束大学三年级。而现在，大四上半学期已经过半啦。这半年的时间可以说忙也可以说不忙。不忙是说这半年以来的课程比较轻松，只有四门选修课，学业负担比较轻。忙是说半年以来各种错综复杂的事情，许多事情需要好好安排一下时间才可以好好把握各个“进程”的合理分配。 那么就从我上次日记开始总结一下吧。 当时更新是去年七月十二日，刚大三放假不久。那个暑假前期过得可谓是心惊胆战呀，当时为了保研北京航空航天大学一直在紧张地复习准备。包括复习备考三年的专业课，还有准备C语言的上机考试。七月二十八二十九那两天机考和面试，不负众望，我顺利拿到了北京航空航天大学计算机科学与技术学院的Offer，心里的石头也落了地，当时看到通过面试的消息时真的激动得说不出口，这也算是我人生中为数不多的重大十字路口做出的一个选择吧。 面试结束之后，我便留在了导师那边做项目，一些大数据处理和爬虫的项目。不过当时的项目个人感觉比较简单，所以就在整个八月份找了一份实习，PHP研发工程师的岗位，之前准备保研也一直没有找工作，这也算是我找的第一份工作吧，不求赚神马，只求充实一下我的假期，也学习一些新的东西。 在这里顺便安利一下，公司名称是佳信德润，主打品牌是<a href="http://www.lingxi360.com/index.php" target="_blank" rel="noopener">灵析</a>，北京三环。在那边工作真的感觉特别舒心，虽然是创业公司，但是CEO玛丽老板（女哦）还有负责技术的柱子哥真的超级热情，为人特别好，谈吐之间就有一种亲切的感觉，那边的小伙伴十几个，相处地也十分融洽。在那边工作你不会有一种被忽视和指使的感觉，你可以随意向老板们发表自己的看法，甚至你可以与他们探讨代码问题，甚至公司某处的装饰啦，哪里的餐馆不错啦等等。有次我眼睛发炎，玛丽老板和柱子哥还特别关心我，亲自送到我医院，在这里再次说声谢谢，不知道你们是不是可以看到。我还记得小伙伴们一起拍公司写真，真的超赞。当然最主要的还是一起商讨项目进度，代码问题，接触到我之前没有接触过的新知识。在这里你可以负责许多事情，最大限度地发挥你的光和热。不是我打广告，如果有小伙伴们有意向做PHP，非常推荐你们过去，可以去他们<a href="http://www.lingxi360.com/index.php" target="_blank" rel="noopener">官网</a>发应聘哦。相信我，不会坑你的。 实习时间真的过得很快，转眼一个月过去了，九月份来了，大四开学啦。 因为需要开学以后办一些保研的相关手续，另外重要的事当然是陪妹纸啦嘿嘿，你懂得。 开学之后就开始忙一些项目了。大四的课程不紧，趁着这大四的时光，多学点东西，以后这样的日子真不多了，好好珍惜。 所以大四上学期的基调是，专注陪妹子，业余撸代码，顺便做做外包。请叫我全职男朋友，兼职程序猿。 这半年以来做的项目不算多。首先，学习了Laravel框架，嗯，保证你学完之后就不想用其他的框架了。最开始是帮我的叔叔做一个拍电影的网站，规模还比较大，一直在完善中。另外在暑假实习的过程中发现了公司自己写了一款CMS框架，自己觉得还有许多功能可以添加，一些架构可以继续完善，所以决定自己写一个CMS，不仅算是练手，也算是造轮子吧。毕竟你写好了就是你自己的，用起来都是那么自然，假如来了个外包神马的，轻松应对分分钟的事，神马深度定制都是浮云。当然还有帮爸爸妈妈写的一个微信平台，在微信订餐售卖东西，嗯，这叫做自己动手实现O2O。另外就是一些零零散散的小外包，没事可以赚点外快养活一下自己。 最近刚刚入手了自己人生中的第一台MAC，当然还是要感谢父亲大人的支持，自己的手头还是比较紧的，你懂得。 嗯摒弃Windows，感觉撸代码的快感不止提升了几管气，也希望它可以陪我度过接下来许多年的学习时光。在这里也安利一下一个小店，微博上的<a href="http://weibo.com/u/2067562447?is_hot=1" target="_blank" rel="noopener">小闷小闷</a>，水果从她这里买，价格真的是十分公道啊，正品无误了，入手十几天了，感觉逼格提升了，心情也舒畅了，多年的Windows卡顿症也治好了～ 嗯，接下来的时间，爸爸妈妈年前工作辛苦，接下来几天我要去帮他们分担一下工作啦。 最后，恭祝大家小年快乐，工作顺心，别跟钱过不去，开心最重要～ 欢欢喜喜过大年啦～</p>
      </p>
    </div>
  </div>
  <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-user"></i>
      </span>
      <span class="post-meta-item-text">作者</span>
      <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      <time title="创建时间：2016-02-01 20:20:53" itemprop="dateCreated datePublished" datetime="2016-02-01T20:20:53+08:00">2016-02-01</time>
    </span>
    <span id="/2401.html" class="post-meta-item leancloud_visitors" data-flag-title="强势回归博客，顺便祝大家小年快乐" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.7k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
  </div>
</article>

    <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2353.html">
  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.png">
    <meta itemprop="name" content="崔庆才">
    <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  </span>
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="静觅">
  </span>
  <header class="post-header">
    <h2 class="post-title" itemprop="name headline">
      <a class="label"> HTML <i class="label-arrow"></i>
      </a>
      <a href="/2353.html" class="post-title-link" itemprop="url">关于HTML内联元素一侧留白的浅谈</a>
    </h2>
  </header>
  <div class="post-body" itemprop="articleBody">
    <div class="thumb">
      <img itemprop="contentUrl" class="random">
    </div>
    <div class="excerpt">
      <p>
      <h2 id="问题来源"><a href="#问题来源" class="headerlink" title="问题来源"></a>问题来源</h2>
      <p>在写代码的时候遇到了如下问题： 使用了 bootstrap 框架来编写了一个页面，其中 input 元素两侧留有空白。然而用 JS 动态添加的同样的元素却不会出现这种情况。具体截图表现如下： <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151226212230.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151226212230.png" alt="20151226212230"></a> 我们可以发现，第一行和而三行的代码是完全一样的，可是呈现的结果是截然不同的。 <a href="http://res.cuiqingcai.com/demo/inline.html" target="_blank" rel="noopener">在线测试样例</a> 大家是不是觉得很奇怪？没错，我也是。中间的那个缝隙是哪里来的呢？</p>
      <h2 id="刨根问底"><a href="#刨根问底" class="headerlink" title="刨根问底"></a>刨根问底</h2>
      <p>在这里感谢 <a href="http://wonderlee.me" target="_blank" rel="noopener">wonder</a> 同学的大力相助，才得以找到问题的所在。 出现此问题的原因在于：</p>
      <blockquote>
        <p>html 中的内联元素在书写代码时，如果两元素代码之间有换行，浏览器会将其解释为空格。而这个空格是会被当作一个空白节点（nodeType 等于 3 的节点，就是文字节点）</p>
      </blockquote>
      <p>所以，因为代码中我使元素呈现 inline 的属性，然后两个代码之间具有换行，所以二者之间出现了空白。正常情况下，二者之间是不应该出现空白的。然而用 jQuery 生成元素的时候，因为是用的 + 连接符，所以换行符被忽略了。也就是代码是连接起来的，所以二者之间便不会出现空白。 解决方法： 1.将原代码中的 input 写到一行。如下：</p>
      <figure class="highlight pgsql">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">&lt;div <span class="keyword">class</span>="form-group"&gt;</span><br><span class="line">    &lt;<span class="keyword">input</span> <span class="keyword">class</span>="form-control inline span3" <span class="type">name</span>="education[school][]" <span class="keyword">type</span>="text" <span class="keyword">value</span>="123"&gt;&lt;<span class="keyword">input</span> <span class="keyword">class</span>="form-control inline span3" <span class="type">name</span>="education[date][]" <span class="keyword">type</span>="text" <span class="keyword">value</span>="456"&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>2.或者在 JS 代码中加入换行符。如下：</p>
      <figure class="highlight scala">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">$(<span class="symbol">'butto</span>n').on(<span class="symbol">'clic</span>k', function() &#123;</span><br><span class="line">        $('&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"form-group"</span>&gt;'+</span><br><span class="line">            '&lt;input <span class="class"><span class="keyword">class</span></span>=<span class="string">"form-control inline span3"</span> name=<span class="string">"education[school][]"</span> <span class="class"><span class="keyword">type</span></span>=<span class="string">"text"</span> value=<span class="string">""</span>&gt;\n'+</span><br><span class="line">            '&lt;input <span class="class"><span class="keyword">class</span></span>=<span class="string">"form-control inline span3"</span> name=<span class="string">"education[date][]"</span> <span class="class"><span class="keyword">type</span></span>=<span class="string">"text"</span> value=<span class="string">""</span>&gt;'+</span><br><span class="line">        '&lt;/div&gt;').appendTo($(<span class="string">".content"</span>));</span><br><span class="line">    &#125;);</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>以上两种方式，解决方法都比较简单实用。其他的改变 padding 或者 margin 的方法就不推荐了。 好了，那么明白了之后，我们肯定要可以举一反三的，来探究一下如果是块级元素会不会这样呢？</p>
      <h2 id="举一反三"><a href="#举一反三" class="headerlink" title="举一反三"></a>举一反三</h2>
      <p>好的，让我们试一下块级元素如果设置为 inline 的话会不会也这样。 把 input 标签改成 div，然后给它加上 display: inline 属性，加一下背景颜色区分，观察一下效果。 代码如下：</p>
      <figure class="highlight xml">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"zh-CN"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>点击按钮添加元素<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"content"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span>hello1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item"</span>&gt;</span>hello2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"//cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.item</span> &#123;</span></span><br><span class="line">        display: inline;</span><br><span class="line"><span class="css">        <span class="selector-tag">background</span>: <span class="selector-id">#555</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>观察一下效果 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151226220135.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151226220135.png" alt="20151226220135"></a> 嗯，果然，它的间距还是出现了。 那么改成 display: inline-block 呢？</p>
      <figure class="highlight css">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line">        <span class="attribute">display</span>: inline-block;</span><br><span class="line">        <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">        <span class="attribute">background</span>: <span class="number">#555</span>;</span><br><span class="line">    &#125;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p><a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151226220326.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151226220326.png" alt="20151226220326"></a> 可见间距还是有的。 我们把 div 的换行去掉，看一下。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151226220443.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151226220443.png" alt="20151226220443"></a> Perfect！它已经消失不见了！ 以上，在 chrome，edge，ie11 测试通过。</p>
      <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
      <p>通过以上研究我们可以得出如下结论： 内联元素，代码中带有换行，会出现空白间距。块级元素，设置了内联样式，且代码中带有换行，也会出现空白间距。 解决方法是删除代码中的换行即可。 以上是在写程序过程中发现的现象，希望能对大家有帮助！</p>
      </p>
    </div>
  </div>
  <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-user"></i>
      </span>
      <span class="post-meta-item-text">作者</span>
      <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      <time title="创建时间：2016-01-02 22:08:42" itemprop="dateCreated datePublished" datetime="2016-01-02T22:08:42+08:00">2016-01-02</time>
    </span>
    <span id="/2353.html" class="post-meta-item leancloud_visitors" data-flag-title="关于HTML内联元素一侧留白的浅谈" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.4k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
  </div>
</article>

    <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/455.html">
  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.png">
    <meta itemprop="name" content="崔庆才">
    <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  </span>
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="静觅">
  </span>
  <header class="post-header">
    <h2 class="post-title" itemprop="name headline">
      <a class="label"> Other <i class="label-arrow"></i>
      </a>
      <a href="/455.html" class="post-title-link" itemprop="url">干货！IT小伙伴们实用的网站及工具大集合！持续更新！</a>
    </h2>
  </header>
  <div class="post-body" itemprop="articleBody">
    <div class="thumb">
      <img itemprop="contentUrl" class="random">
    </div>
    <div class="excerpt">
      <p>
      <p>1.Git 还在担心自己辛辛苦苦写的代码被误删了吗？还在担心自己改错了代码不能挽回吗？还在苦恼于多人开发合作找不到一个好的工具吗？那么用 Git 就对了，Git 是一个开源的分布式版本控制系统，用以有效、高速的处理从很小到非常大的项目版本管理。有了它，代码托管不是问题，版本控制不再苦恼，多人开发变得简单易行。 链接：<a href="http://git-scm.com/" target="_blank" rel="noopener">http://git-scm.com/</a> <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124142208-e1416810150194.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124142208-1024x341.jpg" alt="QQ截图20141124142208"></a> 2.GitHub 学会了 Git 之后，我们把代码托管到哪里呢？在此推荐给大家两个网站，GitHub，一个是国外免费的代码托管平台。许许多多的开源项目几乎都托管在上面，你也可以在上面搜一些你需要的源代码，丰富资源应有尽有，如果还不知道这个，是不是已经 Out 了呢？ 链接：<a href="https://github.com/" target="_blank" rel="noopener">https://github.com/</a> <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124142704-e1416810453291.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124142704-1024x415.jpg" alt="QQ截图20141124142704"></a> 3.GitCafe 和 GitHub 一样，也是一个免费的代码托管平台。GitHub 是国外的，GitCafe 是国内的。两者功能几乎相同，不喜欢英文版的朋友可以来 GitCafe 尝尝鲜。 链接：<a href="http://gitcafe.com/" target="_blank" rel="noopener">http://gitcafe.com/</a> <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124143049-e1416810670667.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124143049-1024x484.jpg" alt="QQ截图20141124143049"></a> 4.七牛云存储 还在为自己项目的图片等资源没处存放而着急吗？还在担心图片加载耗费你主机大量流量吗？还在为你自己的网站加载速度过慢而揪心吗？云时代，就要用云存储。 比如我有一个虚拟主机是每月限流量的，而大量的图片加载占据了我网站访问流量的大部分，这时我们就可以考虑将图片移植到七牛云存储上，图片通过七牛来加载，节省宝贵的主机空间和流量。比如我的个人网站已经移植到了七牛，所有网页图片的加载都是从七牛上获取，速度快而且省流量。而且免费的七牛还提供了图片处理，比如压缩，水印等各种图片加工方式，想要什么有什么。 链接：<a href="http://www.qiniu.com/" target="_blank" rel="noopener">http://www.qiniu.com/</a> <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124143837-e1416811137547.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124143837-1024x432.jpg" alt="QQ截图20141124143837"></a> 5.云适配 有时候我们做出的网站没有用到响应式布局，也可能我们的网站 DIV 的像素宽度已经规定成具体的多少像素了。所以，用手机访问的时候可能就会出现这样那样的问题，或者显示得很小，或者整个布局全都乱掉了。这时，我们需要把自己的网站适配一下，那么在此推荐一个网站，云适配。插入一行代码，通过在线修改和生成手机适配效果，得到手机访问的网页最佳适配效果，方便而又快捷。这时电脑和手机均能看到最佳适配效果了。 链接：<a href="http://www.yunshipei.com/" target="_blank" rel="noopener">http://www.yunshipei.com/</a> <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124144434-e1416811549465.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124144434-1024x404.jpg" alt="QQ截图20141124144434"></a> 6.聚合数据 大家在开发过程中，可能会用到各种各样的数据，想找一些接口来提供一些数据。比如天气预报查询，火车时刻表查询，彩票查询，身份证查询等等。有了这个接口，直接调用即可。各种各样的 API 接口满足你。 链接：<a href="http://www.juhe.cn/" target="_blank" rel="noopener">http://www.juhe.cn/</a> <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124150336-e1416812634424.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124150336-1024x439.jpg" alt="QQ截图20141124150336"></a> 7.够快云库 够快云库，是基于云存储的团队协作性文件管理平台。 团队成员可以同步共享资料，即时沟通交流，便捷移动办公，从而实现团队的 100％高效运作。比如团队开发过程中有什么要共享的资料，就可以放到里面。支持在线编辑和修改，小组讨论合作等方式。 链接：<a href="http://www.gokuai.com/" target="_blank" rel="noopener">http://www.gokuai.com/</a><a href="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124150727-e1416812868208.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124150727-1024x370.jpg" alt="QQ截图20141124150727"></a> 8.SAE SAE 的强大不用多说了，强大的虚拟主机提供商。提供各种各样的编程语言在线运行，同时提供云存储 Storage，各种数据库，应用十分广泛。不仅提供代码托管，还提供在线服务器运行，JAVA，PHP，Python 等等的支持应有尽有，在这里你可以假设你自己的网站，你的应用接口，你的创意应用。好不好，用用就知道。另外还有 JAE（京东），BAE（百度），功能类似，也推荐一下。 链接：<a href="http://sae.sina.com.cn/" target="_blank" rel="noopener">http://sae.sina.com.cn/</a> <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124151607-e1416813413924.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124151607-1024x360.jpg" alt="QQ截图20141124151607"></a> 9.多备份 多备份提供了主机的文件备份及数据库的备份。可能对于文件的备份大家都已经有其他方法了，不过数据库的自动备份现在还没有多少有效的解决方法，人工备份又显得比较麻烦。如果数据库有数据丢失，那就不好找回了。在此推荐一个网站：多备份。提供主机的文件自动备份和数据库自动备份，方便快捷。 链接：<a href="http://www.dbfen.com/" target="_blank" rel="noopener">http://www.dbfen.com/</a> <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124152121-e1416813698270.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124152121-1024x410.jpg" alt="QQ截图20141124152121"></a> 10.慕课网 学习 IT 知识哪家强？在此为大家推荐一个全免费的学习网站，资源丰富，还提供了比较创新的学习和练习相结合的方式。感觉非常不错，讲解得也很有条理，推荐一下。 链接：<a href="http://www.imooc.com/" target="_blank" rel="noopener">http://www.imooc.com/</a> <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124152408-e1416813887400.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124152408-1024x410.jpg" alt="QQ截图20141124152408"></a> 11.W3SCHOOL 这也是一个非常棒的学习网站，讲解简单易懂，我的 PHP 入门，HTML，JS，CSS 入门都是从这里学到的，感觉讲解非常不错。 链接：<a href="http://www.w3school.com.cn/" target="_blank" rel="noopener">http://www.w3school.com.cn/</a> <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124152659-e1416814040907.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124152659-1024x393.jpg" alt="QQ截图20141124152659"></a> 12.阿里云 感觉比较不错的主机提供商，提供免费备案，对于 ECS 的管理做得非常好，数据恢复和备份及监控也应有尽有，另外提供了 SLB，RDS，CDN 等等的支持，个人感觉很不错的主机提供商。就是价格略贵！ 链接：<a href="http://www.aliyun.com/" target="_blank" rel="noopener">http://www.aliyun.com/</a> <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124153235.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124153235-1024x322.jpg" alt="QQ截图20141124153235"></a> 13.DNSPod 免费的域名解析提供商，管理方便，简洁高效。非常人性化的提示，还提供域名 D 监控等功能，方便实用。 链接：<a href="https://www.dnspod.cn/" target="_blank" rel="noopener">https://www.dnspod.cn/</a> <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124153637-e1416814632344.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124153637.jpg" alt="QQ截图20141124153637"></a> 14.WordPress 一款开源的 PHP 框架，搭建个人博客网站最实用的选择之一。我的个人网站就是基于此搭建，甚至你都不需要懂 PHP 你就可以搭建自己的个人网站。提供强大的后台文章管理和插件及主题管理，几乎可以满足个人网站所有需求。 P.S.找个好的网站模板，你就相当于成功了一大半。 链接：<a href="http://cn.wordpress.org/" target="_blank" rel="noopener">http://cn.wordpress.org/</a> <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124154227-e1416814969553.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124154227.jpg" alt="QQ截图20141124154227"></a> 15.BootStrap 一个强大的前端框架，有了它你再也不需要敲那么多行的样式表，再也不用一点点地调试难看的 DIV 了。直接调用各种 CSS 样式，分分钟写出好看的网页界面。按钮、表格、进度条、提示框、输入框、菜单，应有尽有。 链接：<a href="http://www.bootcss.com/" target="_blank" rel="noopener">http://www.bootcss.com/</a> <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124154554.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124154554-1024x428.jpg" alt="QQ截图20141124154554"></a> 16.芒果广告 如果你开发了自己的移动应用，想添加广告来赚钱，推荐芒果广告。它是一个综合的移动广告平台，聚合了百度广告、多盟广告、易传媒等等广大广告商，可以自己定制广告显示的内容及样式，可以选择各种广告的投放比例。广告点击量、展现量详细报告、收入分析详细数据应有尽有。推荐一下。 链接：<a href="http://www.adsmogo.com/" target="_blank" rel="noopener">http://www.adsmogo.com/</a> <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124154953.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124154953-1024x488.jpg" alt="QQ截图20141124154953"></a> 17.极光推送 极光推送，使得开发者可以即时地向其应用程序的用户推送通知或者消息，与用户保持互动，从而有效地提高留存率，提升用户体验</p>
      <p>平台提供整合了 Android 推送、iOS 推送的统一推送服务。让用户可以更好地接收你推送的内容。 链接：<a href="https://www.jpush.cn/" target="_blank" rel="noopener">https://www.jpush.cn/</a> <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124155237.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124155237-1024x434.jpg" alt="QQ截图20141124155237"></a> 18.Bmob 提供强大的后台接口支持，移动开发过程中可能需要各种各样的后台接口，直接利用这个，你可以创建自己的后台接口。它还提供了强大的游戏后端支持数据，文档和教程也是非常的完备，为移动开发带来相当大的便利。 链接：<a href="http://www.bmob.cn/" target="_blank" rel="noopener">http://www.bmob.cn/</a> <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124155600.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124155600-1024x560.jpg" alt="QQ截图20141124155600"></a></p>
      <p>19.有道云笔记 大多数人都听说过吧？在学习或者开发过程中可能会有各种各样的知识点，好记性不如烂笔头。最好的方式就是记录下来。在此推荐一个笔记，有道云笔记。在使用了各种笔记工具之后，发现还是有道好用。它提供了个人云笔记，云协作等功能，做到 PC、手机、平板等多处同步。占用小，界面美观，使用方便。 链接：<a href="http://note.youdao.com/" target="_blank" rel="noopener">http://note.youdao.com/</a> <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124160008.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124160008-1024x496.jpg" alt="QQ截图20141124160008"></a> 20.Coding 集合了 GitHub 和 SAE 的功能，利用 Git 上传代码，并对代码进行托管，而且提供了一键部署和运行的功能。提供了代码监控功能，通过自动化静态代码分析等管理工具，发现代码问题，获取代码度量信息，及时了解代码质量状况。一个新兴网站，推荐一下！ 链接：<a href="https://coding.net" target="_blank" rel="noopener">https://coding.net</a> <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124161059.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124161059-1024x349.jpg" alt="QQ截图20141124161059"></a> 21.SendCloud 开发过程中你可能会遇到邮件发送的功能，用了 SendCloud，一切都方便多了，它提供免费的邮件代发功能。邮件发送的难题，就交给它来解决吧。 链接：<a href="http://sendcloud.sohu.com/" target="_blank" rel="noopener">http://sendcloud.sohu.com/</a> <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124161409.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124161409-1024x403.jpg" alt="QQ截图20141124161409"></a> 22.蒲公英 有时候你发布 Android 市场，发布 Appstore，会花费相当多的时间才能得到审核通过。那么在团队之间，想团队之间提供内测功能，那么就可以用到它啦，这里提供了一个发布应用的平台，发布之后，生成链接和二维码，即可实现下载测试，简单方便。 链接：<a href="http://www.pgyer.com/" target="_blank" rel="noopener">http://www.pgyer.com/</a> <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124161757.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124161757-1024x396.jpg" alt="QQ截图20141124161757"></a> 23.DCloud HTML5 现在已经定稿，用 HTML5 开发 APP 的浪潮即将袭来，在此提供一个免费的开发网站。它提供了一个 HBuilder 的工具，以及 H5APP 开发文档及 H5APP 的开发框架 MUI 框架，有了它，H5APP 的开发变得相当简单，而我也在蠢蠢欲动。 链接：<a href="http://www.dcloud.io/" target="_blank" rel="noopener">http://www.dcloud.io/</a> <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124162042.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124162042-1024x485.jpg" alt="QQ截图20141124162042"></a> 24.青云 提供免费的云服务器、云存储、云数据库的功能。同时提供多个开放 API，功能实用，非常强大。 链接：<a href="https://www.qingcloud.com/" target="_blank" rel="noopener">https://www.qingcloud.com/</a> <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124162338.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124162338-1024x425.jpg" alt="QQ截图20141124162338"></a> 25.云测 开发了应用之后到哪里去测试？选择云测没错。它提供应用云测试、手机游戏测试，提供崩溃分析。一切测试由它来搞定。 链接：<a href="http://www.testin.cn" target="_blank" rel="noopener">http://www.testin.cn</a> <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124162721.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2014/11/QQ截图20141124162721-1024x403.jpg" alt="QQ截图20141124162721"></a> 26.Meteor Meteor 是一个构建在 Node.js 之上的平台，用来开发实时网页程序。Meteor 位于程序数据库和用户界面之间，保持二者之间的数据同步更新。 链接：<a href="https://www.meteor.com/" target="_blank" rel="noopener">https://www.meteor.com/</a> <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/屏幕快照-2016-02-21-14.04.17.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/屏幕快照-2016-02-21-14.04.17-1024x462.png" alt="屏幕快照 2016-02-21 14.04.17"></a> 暂时先分享给大家这么多！如果有好的网站或者应用推荐，欢迎与我交流，可以评论，可以留言！以上是一些比较实用的网站和工具的分享！希望能给大家的生活和开发带来一定的便利！Thanks！</p>
      </p>
    </div>
  </div>
  <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-user"></i>
      </span>
      <span class="post-meta-item-text">作者</span>
      <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      <time title="创建时间：2015-12-24 16:32:36" itemprop="dateCreated datePublished" datetime="2015-12-24T16:32:36+08:00">2015-12-24</time>
    </span>
    <span id="/455.html" class="post-meta-item leancloud_visitors" data-flag-title="干货！IT小伙伴们实用的网站及工具大集合！持续更新！" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
  </div>
</article>

    <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2322.html">
  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.png">
    <meta itemprop="name" content="崔庆才">
    <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  </span>
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="静觅">
  </span>
  <header class="post-header">
    <h2 class="post-title" itemprop="name headline">
      <a class="label"> Other <i class="label-arrow"></i>
      </a>
      <a href="/2322.html" class="post-title-link" itemprop="url">使用PGP加密你的文件</a>
    </h2>
  </header>
  <div class="post-body" itemprop="articleBody">
    <div class="thumb">
      <img itemprop="contentUrl" class="random">
    </div>
    <div class="excerpt">
      <p>
      <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2>
      <p>有时候，一些文件是不想公开让被人看到的，或者只想某些特定的人看到。 比如说，你要上交一个实验报告啦，老师给了一个 FTP 上传目录，但是你只想让老师看到报告，而不想公开给同学们看。这时候，就需要加密一下你的文件啦。 那么有什么好的加密方式呢？PGP，你的不二之选。</p>
      <h2 id="PGP-加密原理"><a href="#PGP-加密原理" class="headerlink" title="PGP 加密原理"></a>PGP 加密原理</h2>
      <p>用直白的话来讲就是 对方给你一个公钥，他自己也保存了一个私钥，你利用他的公钥来加密，只有对方自己用自己私钥才能解密。由于其他的人没有拿到私钥，所以解不开的，即使是你自己，也解不开的。所以，这样就保证了，只有你和对方可以查看内容。 引用详解原理：</p>
      <blockquote>
        <p>PGP(Pretty Good Privacy)，是一个基于 RSA 公钥加密体系的邮件加密软件。可以用它对邮件保密以防止非授权者阅读，它还能对邮件加上数字签名从而使收信人可以确认邮件的发送者，并能确信邮件没有被篡改。它可以提供一种安全的通讯方式，而事先并不需要任何保密的渠道用来传递密匙。它采用了一种 RSA 和传统加密的杂合算法，用于数字签名的邮件文摘算法，加密前压缩等，还有一个良好的人机工程设计。它的功能强大，有很快的速度。 PGP 是一种供大众使用的加密软件。电子邮件通过开放的网络传输，网络上的其他人都可以监听或者截取邮件，来获得邮件的内容，因而邮件的安全问题就比较突出了。保护信息不被第三者获得，这就需要加密技术。还有一个问题就是信息认证，如何让收信人确信邮件没有被第三者篡改，这就需要数字签名技术。RSA 公钥体系的特点使它非常适合用来满足上述两个要求：保密性（Privacy)和认证性（Authentication）。 RSA（Rivest-Shamir-Adleman）算法是一种基于大数不可能质因数分解假设的公匙体系。简单地说就是找两个很大的质数，一个公开即公钥，另一个不告诉任何人，即私钥。这两个密匙是互补的，就是说用公匙加密的密文可以用私匙解密，反过来也一样。 假设甲要寄信给乙，他们互相知道对方的公匙。甲就用乙的公匙加密邮件寄出，乙收到后就可以用自己的私匙解密出甲的原文。由于没别人知道乙的私匙，所以即使是甲本人也无法解密那封信，这就解决了信件保密的问题。另一方面由于每个人都知道乙的公匙，他们都可以给乙发信，那么乙就无法确信是不是甲的来信。这时候就需要用数字签名来认证。</p>
      </blockquote>
      <h2 id="加密流程"><a href="#加密流程" class="headerlink" title="加密流程"></a>加密流程</h2>
      <p>在 Windows 下，有一个非常强大的工具，叫做 PGP Desktop，可以利用这个来加密。 <a href="http://pan.baidu.com/s/1dEznwe1" target="_blank" rel="noopener">下载链接</a> 这个是 64 位的安装包，安装过程我就不详细描述了，比较简单。如果你的系统是 32 位，那么请再寻找一下其他的安装包。 安装之后，搜索一下开始菜单或者安装目录，找到 PGP Desktop，打开它。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151215003158.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151215003158.png" alt="20151215003158"></a> 打开之后界面是这个样子的 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151215003312.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151215003312-1024x664.png" alt="20151215003312"></a> 恩，别人应该给了你公钥了对吧，比如，这次老师的公钥是</p>
      <figure class="highlight excel">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">-----BEGIN PGP PUBLIC KEY BLOCK-----</span><br><span class="line">Versi<span class="symbol">on:</span> PGPfreeware <span class="number">6.5</span>.<span class="number">8</span> for non-commercial use &lt;ht<span class="symbol">tp:</span>//www.pgp.com&gt;</span><br><span class="line"></span><br><span class="line">mQCNA1NKJuwAAAEEAMvdBmw1TTTkLTL6w9C28MhtVnsWtNeHVJl98CFCzOveyKDH</span><br><span class="line">KGPf/RA4moDUE1IkkUelRKJV1O2JlcqBZPOGI/FII/<span class="number">6</span>yq/DbNHKOKhz6fgbbdgxh</span><br><span class="line">UArjUSthA/BPnodTcEtGZHlGSvK7n3TcWmGY700YB9crWpbyHfVQ7KLGc3SlAAUR</span><br><span class="line">tCF0ZXN0NGNyeXB0byA8dGVzdDRjcnlwdG9AMTYzLmNvbT6JAJUDBRBTSibs9VDs</span><br><span class="line">osZzdKUBAQzxBACr3UpakH7SMtU9OgHHZCARE4xKVChTBCh9kquhhU5Kr9Er0AHy</span><br><span class="line">UWO1BD+z58VTu9XPR2/NSrCOGNwfZVqZTY8eTUTuQVJKpAR9CNtRi0B6yQa8pQVm</span><br><span class="line"><span class="number">7</span>vfEqzBcsWcPkOzfRU75Ubdc+IxZkdMcPfPnzn1kU2cTKUIlM5+cy/+qvw==</span><br><span class="line">=nNyG</span><br><span class="line">-----END PGP PUBLIC KEY BLOCK-----</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>来，添加一下，有一个非常简单的方法就是直接右键粘贴，然后确定就好了。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151215003737.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151215003737.png" alt="20151215003737"></a> <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151215003953.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151215003953.png" alt="20151215003953"></a> 然后，你可以把这个公钥加到你的 Master Keys 里。 点击，菜单中的 Tools -&gt; PGP Options -&gt; Master Keys -&gt; Add -&gt; add -&gt; OK，按照图示箭头操作即可。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151215011210.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151215011210-1024x596.png" alt="20151215011210"></a> 然后，确定，邮件点一下 添加到 Master Keys。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151215011305.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151215011305.png" alt="20151215011305"></a> 会提示成功添加。然后接下来就进行加密吧。 点左侧的 PGP ZIP，然后 New PGP Zip，然后选择文件，点击确定。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151215004710.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151215004710.png" alt="20151215004710"></a> 然后直接下一步 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151215004802.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151215004802.png" alt="20151215004802"></a> 直接下一步 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151215011736.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151215011736.png" alt="20151215011736"></a> 然后下一步，选择导出路径即可 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151215011755.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151215011755.png" alt="20151215011755"></a> 下一步，导出成功，加密完成。 导出的文件格式就是原文件名加了 pgp 后缀，只有对方的私钥可以解开。 当然如果有不死心的小伙伴想破解，自己试试咯~</p>
      <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
      <p>以上，为了便于演示，我直接将秘钥添加到了 Master Key 中，其实这个 Master Key 当然最好是你自己专属的秘钥咯，不过无所谓啦，我们只是为了演示一下加密过程，利用这个公钥加密，不要在意这些细节。 小伙伴们体验一下吧！</p>
      </p>
    </div>
  </div>
  <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-user"></i>
      </span>
      <span class="post-meta-item-text">作者</span>
      <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      <time title="创建时间：2015-12-15 01:23:40" itemprop="dateCreated datePublished" datetime="2015-12-15T01:23:40+08:00">2015-12-15</time>
    </span>
    <span id="/2322.html" class="post-meta-item leancloud_visitors" data-flag-title="使用PGP加密你的文件" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
  </div>
</article>

    <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2286.html">
  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.png">
    <meta itemprop="name" content="崔庆才">
    <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  </span>
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="静觅">
  </span>
  <header class="post-header">
    <h2 class="post-title" itemprop="name headline">
      <a class="label"> Other <i class="label-arrow"></i>
      </a>
      <a href="/2286.html" class="post-title-link" itemprop="url">计算机网络探究四之使用FreeNAS提供网络硬盘</a>
    </h2>
  </header>
  <div class="post-body" itemprop="articleBody">
    <div class="thumb">
      <img itemprop="contentUrl" class="random">
    </div>
    <div class="excerpt">
      <p>
      <h2 id="FreeNAS-简介"><a href="#FreeNAS-简介" class="headerlink" title="FreeNAS 简介"></a>FreeNAS 简介</h2>
      <p>FreeNAS 是什么？ FreeNAS 是一款广受赞誉的开源免费 NAS 操作系统。它能把普通台式机瞬间变成一台多功能 NAS 服务器。不但适用于企业文件共享，同样适用于打造家庭媒体中心。 FreeNAS 支持多种共享协议，包括 SMB/CIFS、NFS、AFP、WebDAV、iSCSI、FTP/TFTP、RSync 等。 <a href="http://www.getnas.com/" target="_blank" rel="noopener">官方网站</a></p>
      <h2 id="iSCSI"><a href="#iSCSI" class="headerlink" title="iSCSI"></a>iSCSI</h2>
      <p>iSCSI 技术是一种由 IBM 公司研究开发的，是一个供硬件设备使用的可以在 IP 协议的上层运行的 SCSI 指令集，这种指令集合可以实现在 IP 网络上运行 SCSI 协议，使其能够在诸如高速千兆以太网上进行路由选择。iSCSI 技术是一种新储存技术，该技术是将现有 SCSI 接口与以太网络(Ethernet)技术结合，使服务器可与使用 IP 网络的储存装置互相交换资料。 iSCSI：Internet 小型计算机系统接口 （iSCSI：Internet Small Computer System Interface）。</p>
      <h2 id="本篇目标"><a href="#本篇目标" class="headerlink" title="本篇目标"></a>本篇目标</h2>
      <p>那么本篇文章的目标就是记录一下怎样使用 FreeNAS 配置一个输入我们的网络存储服务。</p>
      <h2 id="下载安装"><a href="#下载安装" class="headerlink" title="下载安装"></a>下载安装</h2>
      <p>首先我们要下载 FreeNAS 的镜像，由于 FreeNAS 9 对系统的要求比较高，在这里我们用到的是 FreeNAS 8。 <a href="http://pan.baidu.com/s/1geb2C1t" target="_blank" rel="noopener">镜像下载</a> 下载完成之后我们利用 VMware 安装即可。 安装界面提供了四个选项：</p>
      <ol>
        <li>Install/Upgrade 安装/升级</li>
        <li>Shell 终端</li>
        <li>Reboot System 重启系统</li>
        <li>Shutdown System 关闭系统</li>
      </ol>
      <p><img src="http://7xnt0e.com1.z0.glb.clouddn.com/wp-content/uploads/2015/01/20150129171248.png" alt="20150129171248"> 使用键盘上的方向键切换菜单，选择第一项，按回车键确认。 接下来系统会提示选择 FreeNAS 系统盘，在如下图所示的界面中会显示出所有可以用作安装 FreeNAS 系统的设备。你需要根据自己界面上显示的实际内容进行选择，此处应该选择我们准备作为 FreeNAS 系统盘的另一块 U 盘，选择好以后按回车键确认。 <img src="http://7xnt0e.com1.z0.glb.clouddn.com/wp-content/uploads/2015/01/20150129171601.png" alt="20150129171601"> 此时，界面上显示了一些警告信息，大意为“你选择作为 FreeNAS 系统盘的设备上的所有数据都会被清空，而且该设备将完全被系统占用，不能用作数据存储。” 按回车键确认。 <img src="http://7xnt0e.com1.z0.glb.clouddn.com/wp-content/uploads/2015/01/20150129171850.png" alt="20150129171850"> 确认后，系统开始执行安装，如下图所示。 <img src="http://7xnt0e.com1.z0.glb.clouddn.com/wp-content/uploads/2015/01/20150129172137.png" alt="20150129172137"> 系统安装完成后会给出成功提示，提醒我们移除安装盘，如下图。不用理会，按回车键继续。 <img src="http://7xnt0e.com1.z0.glb.clouddn.com/wp-content/uploads/2015/01/20150129172300.png" alt="20150129172300"> 此时，系统又回到了最初的安装界面，如下图所示。用方向键切换选择第四项，按回车键关闭系统。 <img src="http://7xnt0e.com1.z0.glb.clouddn.com/wp-content/uploads/2015/01/20150129172526.png" alt="20150129172526"> 待系统完全关闭以后，再次启动电脑，并设置从 U 盘系统盘引导，成功启动以后，看到如下所示的界面，代表系统已经安装完成。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151213171035.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151213171035.png" alt="20151213171035"></a> 接下来，你可以使用浏览器访问界面中给出的 IP 地址打开 FreeNAS 的 WebGUI 管理界面了。</p>
      <h2 id="网页配置"><a href="#网页配置" class="headerlink" title="网页配置"></a>网页配置</h2>
      <p>接下来，我们就可以通过浏览器来配置我们的 FreeNAS 了。 通过系统的提示，我们访问以下链接即可： <a href="http://192.168.231.131/" target="_blank" rel="noopener">http://192.168.231.131/</a> <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151213171159.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151213171159-1024x549.png" alt="20151213171159"></a> 访问之后，可以看到如上内容。 点击 setting，先切换一下语言，简体中文。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151213171352.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151213171352.png" alt="20151213171352"></a> 接下来我们便开始 iSCSI 的配置啦。</p>
      <h2 id="iSCSI-配置"><a href="#iSCSI-配置" class="headerlink" title="iSCSI 配置"></a>iSCSI 配置</h2>
      <p>1.首先开启 iSCSI 服务，然后点击右侧的设置图标进入设置界面。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151213173030.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151213173030.png" alt="20151213173030"></a> 2.添加 iSCSI 端口，选择默认设置即可。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151213171558.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151213171558.png" alt="20151213171558"></a> 3.添加网络授权信息 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151213171648.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151213171648.png" alt="20151213171648"></a> 两个全部填写为 ALL 即可。 4.添加 iSCSI 用户信息 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151213171733.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151213171733.png" alt="20151213171733"></a> 填入用户信息和秘钥即可，下方的输入框是加密可选的。 5.添加 iSCSI 属性信息 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151213171855.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151213171855.png" alt="20151213171855"></a> 6.添加存储设备 在这里我们首先要添加一块磁盘，在 VMware 中的设置里添加一块磁盘，在这里分配为 20G。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151213171951.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151213171951.png" alt="20151213171951"></a><a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151213172007.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151213172007.png" alt="20151213172007"></a> 在 FreeNAS 设置界面中，添加扩展设备。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151213172115.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151213172115.png" alt="20151213172115"></a> 7.关联目标 将用户信息和磁盘信息关联起来。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151213172143.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151213172143.png" alt="20151213172143"></a> 通过以上流程，我们便完成了一个网络硬盘的配置。</p>
      <h2 id="Windows-使用"><a href="#Windows-使用" class="headerlink" title="Windows 使用"></a>Windows 使用</h2>
      <p>好，配置好了网络硬盘，那么我们就在 Windows 下使用一下吧，Windows 7 以上的系统自带了 iSCSI 服务。 我们可以直接在控制面板里面找到它。在控制面板中搜索。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151213172329.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151213172329.png" alt="20151213172329"></a> 然后，会出现一个属性设置窗口。点击发现，发现门户，输入刚才 FreeNAS 的地址即可。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151213172518.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151213172518.png" alt="20151213172518"></a> 接下来在目标的选项卡中我们会看到刚才配置的一个目标，点击下方的连接即可。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151213172541.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151213172541.png" alt="20151213172541"></a> 连接成功之后，我们便可以完成连接了。 打开磁盘设置，我们便可以看到那个 20G 的磁盘了，然后新建简单卷。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151213172806.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151213172806.png" alt="20151213172806"></a> 格式化为 NTFS 系统，刷新一下，打开计算机。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151213172840.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151213172840.png" alt="20151213172840"></a> 我们可以发现，一个新的网络磁盘便安装成功啦。 可以向其中放置任何文件，与其他的磁盘没有任何区别！</p>
      <h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2>
      <p>FreeNAS 是一个非常强大的工具，在这里我们只涉及到了 iSCSI 服务的使用，还有更多等待着我们的探索，小伙伴们快来试验一下吧。</p>
      </p>
    </div>
  </div>
  <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-user"></i>
      </span>
      <span class="post-meta-item-text">作者</span>
      <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      <time title="创建时间：2015-12-13 17:42:50" itemprop="dateCreated datePublished" datetime="2015-12-13T17:42:50+08:00">2015-12-13</time>
    </span>
    <span id="/2286.html" class="post-meta-item leancloud_visitors" data-flag-title="计算机网络探究四之使用FreeNAS提供网络硬盘" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
  </div>
</article>

    <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2266.html">
  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.png">
    <meta itemprop="name" content="崔庆才">
    <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  </span>
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="静觅">
  </span>
  <header class="post-header">
    <h2 class="post-title" itemprop="name headline">
      <a class="label"> C/C++ <i class="label-arrow"></i>
      </a>
      <a href="/2266.html" class="post-title-link" itemprop="url">VS中OpenSSL环境配置示例</a>
    </h2>
  </header>
  <div class="post-body" itemprop="articleBody">
    <div class="thumb">
      <img itemprop="contentUrl" class="random">
    </div>
    <div class="excerpt">
      <p>
      <p>最近在研究信息安全，需要用到 OpenSSL 库，我用到的开发 IDE 是 VS2012，所以，在这里也记录一下我配置 VS2012 的 OpenSSL 库的过程。</p>
      <h2 id="下载-OpenSSL-库"><a href="#下载-OpenSSL-库" class="headerlink" title="下载 OpenSSL 库"></a>下载 OpenSSL 库</h2>
      <p>OpenSSL 库大家可以自行下载源码然后用 ruby 进行编译，另外我们也可以选择直接下载编译好的类库。 这里我们利用的后者，在此提供一个下载链接。 <a href="http://pan.baidu.com/s/1dEs1nxR" target="_blank" rel="noopener">OpenSSL-Win32</a> 下载完成之后解压，比如我的放到了 D 盘。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151207162627.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151207162627.png" alt="20151207162627"></a></p>
      <h2 id="新建项目"><a href="#新建项目" class="headerlink" title="新建项目"></a>新建项目</h2>
      <p>首先，我们找一段测试代码，在此利用的是 AES 算法的示例。</p>
      <figure class="highlight cpp">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;openssl/aes.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> key[<span class="number">16</span>+<span class="number">1</span>] = <span class="string">"my-key-i-choosed"</span>; <span class="comment">// 128bits key (应该是真正的随机数才好)</span></span><br><span class="line">	<span class="keyword">char</span> pt1[<span class="number">16</span>+<span class="number">5</span>+<span class="number">1</span>] = <span class="string">"0123456789abcdef12345"</span>;   <span class="comment">// 明文</span></span><br><span class="line">	<span class="keyword">char</span> ct[<span class="number">16</span>+<span class="number">5</span>+<span class="number">1</span>];  <span class="comment">// 密文</span></span><br><span class="line">	<span class="keyword">char</span> pt2[<span class="number">16</span>+<span class="number">5</span>+<span class="number">1</span>]; <span class="comment">// 解密后的明文</span></span><br><span class="line"></span><br><span class="line">	AES_KEY k;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> iv1[<span class="number">16</span>+<span class="number">1</span>] = &#123;<span class="string">"1023456789abcdef"</span>&#125;; <span class="comment">// 16+1，加密用</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> iv2[<span class="number">16</span>+<span class="number">1</span>] = &#123;<span class="string">"1023456789abcdef"</span>&#125;; <span class="comment">// 16+1，解密用</span></span><br><span class="line"></span><br><span class="line">	&#123;	<span class="comment">// single blcok test</span></span><br><span class="line">		AES_set_encrypt_key(key, <span class="number">16</span>*<span class="number">8</span>, &amp;k);</span><br><span class="line">		AES_encrypt((<span class="keyword">unsigned</span> <span class="keyword">char</span>*)pt1, (<span class="keyword">unsigned</span> <span class="keyword">char</span>*)ct, &amp;k);</span><br><span class="line"></span><br><span class="line">		AES_set_decrypt_key(key, <span class="number">16</span>*<span class="number">8</span>, &amp;k);</span><br><span class="line">		AES_decrypt((<span class="keyword">unsigned</span> <span class="keyword">char</span>*)ct, (<span class="keyword">unsigned</span> <span class="keyword">char</span>*)pt2, &amp;k);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">memcmp</span>(pt1, pt2, <span class="number">16</span>)==<span class="number">0</span>)</span><br><span class="line">			<span class="built_in">puts</span>(<span class="string">"AES block ok"</span>);</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			<span class="built_in">puts</span>(<span class="string">"AES block err"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	&#123;	<span class="comment">// cfb mode (stream mode)</span></span><br><span class="line">		<span class="keyword">int</span> num=<span class="number">0</span>;</span><br><span class="line">		AES_set_encrypt_key(key, <span class="number">16</span>*<span class="number">8</span>, &amp;k);</span><br><span class="line">		AES_cfb128_encrypt((<span class="keyword">unsigned</span> <span class="keyword">char</span>*)pt1, (<span class="keyword">unsigned</span> <span class="keyword">char</span>*)ct,</span><br><span class="line">			<span class="number">16</span>+<span class="number">5</span>, &amp;k, (<span class="keyword">unsigned</span> <span class="keyword">char</span>*)iv1, &amp;num, AES_ENCRYPT);</span><br><span class="line"></span><br><span class="line">		num=<span class="number">0</span>;</span><br><span class="line">		AES_set_encrypt_key(key, <span class="number">16</span>*<span class="number">8</span>, &amp;k); <span class="comment">// MUST as enc</span></span><br><span class="line">		AES_cfb128_encrypt((<span class="keyword">unsigned</span> <span class="keyword">char</span>*)ct, (<span class="keyword">unsigned</span> <span class="keyword">char</span>*)pt2,</span><br><span class="line">			<span class="number">16</span>+<span class="number">5</span>, &amp;k, (<span class="keyword">unsigned</span> <span class="keyword">char</span>*)iv2, &amp;num, AES_DECRYPT);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">memcmp</span>(pt1, pt2, <span class="number">16</span>+<span class="number">5</span>)==<span class="number">0</span>)</span><br><span class="line">			<span class="built_in">puts</span>(<span class="string">"AES CFB mode ok"</span>);</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			<span class="built_in">puts</span>(<span class="string">"AES CFB mode err"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	system(<span class="string">"pause"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>接下来新建一个项目，win32 控制台程序，空项目，完成。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151207161749.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151207161749.png" alt="20151207161749"></a> <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151207161824.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151207161824.png" alt="20151207161824"></a> 新建源文件，我取名叫做 aes.cpp，将代码复制进去，可以看到代码最初是在报错的。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151207162418.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151207162418.png" alt="20151207162418"></a> 好，接下来我们进行环境配置。</p>
      <h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2>
      <p>右键项目名称，弹出一个菜单，选择属性。 在 VC++目录选项卡中，添加包含目录和库目录。 在这里，我的包含目录就是刚才解压的 OpenSSL 目录的 include 目录，库目录则是 lib 目录。 <strong>注意：分号要是英文分号，英文分号！</strong> <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151207162929.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151207162929.png" alt="20151207162929"></a> 接下来选择连接器选项卡，输入 libeay.lib 和 ssleay32.lib 两个附加依赖项。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151207163915.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151207163915.png" alt="20151207163915"></a> 现在右击项目，重新生成。 我们可以看到，程序可以正常生成 exe 了。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151207164034.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151207164034.png" alt="20151207164034"></a> 但是直接运行的话会报错，是因为缺少 dll 文件。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151207164304.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151207164304.png" alt="20151207164304"></a> 之后，将项目中的 libeay32.dll 和 ssleay32.dll 文件放入项目的 debug 目录即可。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151207164444.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151207164444.png" alt="20151207164444"></a> 最后项目的 debug 目录如下 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151207164405.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151207164405.png" alt="20151207164405"></a> 重新运行 exe 程序，发现已经正常运行。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151207164736.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/12/20151207164736.png" alt="20151207164736"></a> 至此，VS 配置 OpenSSL 环境的过程已经全部完成。 其他项目类似，大家可以试着配一下。 如有问题，欢迎留言交流~</p>
      </p>
    </div>
  </div>
  <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-user"></i>
      </span>
      <span class="post-meta-item-text">作者</span>
      <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      <time title="创建时间：2015-12-07 16:50:54" itemprop="dateCreated datePublished" datetime="2015-12-07T16:50:54+08:00">2015-12-07</time>
    </span>
    <span id="/2266.html" class="post-meta-item leancloud_visitors" data-flag-title="VS中OpenSSL环境配置示例" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.9k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
  </div>
</article>

    <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2249.html">
  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.png">
    <meta itemprop="name" content="崔庆才">
    <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  </span>
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="静觅">
  </span>
  <header class="post-header">
    <h2 class="post-title" itemprop="name headline">
      <a class="label"> Linux <i class="label-arrow"></i>
      </a>
      <a href="/2249.html" class="post-title-link" itemprop="url">WordPress从Apache迁移到Apache过程</a>
    </h2>
  </header>
  <div class="post-body" itemprop="articleBody">
    <div class="thumb">
      <img itemprop="contentUrl" class="random">
    </div>
    <div class="excerpt">
      <p>
      <p>最近服务器要过期了，需要进行迁移，新服务器如果上面配置的是 Apache 服务器该怎么办呢？ 系统：Ubuntu 14.04</p>
      <h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2>
      <p>首先新主机上配置好 apache 环境，这个就不多说了，直接执行下面的命令即可。</p>
      <figure class="highlight smali">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">sudo apt-get install apache2</span><br><span class="line">sudo apt-get install php5 php5-cgi php5-mysql php5-curl php5-gd php5-idn php-pear php5-imagick php5-imap php5-mcrypt php5-memcache php5-mhash php5-ming php5-pspell php5-recode php5-snmp php5-tidy php5-xmlrpc php5-sqlite php5-xsl</span><br><span class="line">sudo apt-get install mysql-server mysql-client</span><br><span class="line">sudo apt-get install libapache2-mod-php5</span><br><span class="line">sudo apt-get install libapache2-mod-auth-mysql</span><br><span class="line">sudo apt-get install phpmyadmin</span><br><span class="line">sudo ln -s /usr/share/phpmyadmin/ /var/www/html/phpmyadmin</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>通过以上配置，新主机便可以实现 lamp 环境的配置了。</p>
      <h2 id="代码迁移"><a href="#代码迁移" class="headerlink" title="代码迁移"></a>代码迁移</h2>
      <p>首先旧主主机上打包一下代码，比如一个文件夹名字叫 wonder</p>
      <figure class="highlight css">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="selector-tag">tar</span> <span class="selector-tag">-zcvf</span> <span class="selector-tag">wonder</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span> <span class="selector-tag">wonder</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>然后，打包完成之后，便会出现一个名字叫做 wonder.tar.gz 的文件 可以利用 wget 方式直接下载。</p>
      <figure class="highlight groovy">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">wget <span class="string">http:</span><span class="comment">//xxx.xxx.xxx.xxx/wonder.tar.gz</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>下载完成之后，直接解压即可。 这样代码就取到了。</p>
      <h2 id="数据库迁移"><a href="#数据库迁移" class="headerlink" title="数据库迁移"></a>数据库迁移</h2>
      <p>数据库迁移无非就是在 phpmyadmin 之间导入导出，这个很简单。 但是重要的一点是，需要把 wp-options 表中的两个 URL 配置改掉，比如原来是一个域名链接，现在需要改为 IP+文件名。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/11/20151128144223.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/11/20151128144223-1024x351.png" alt="20151128144223"></a> 否则，浏览器会提示重定向循环的问题。</p>
      <h2 id="服务器配置"><a href="#服务器配置" class="headerlink" title="服务器配置"></a>服务器配置</h2>
      <p>首先我们需要将域名解析到这个主机。 配置示例域名：wonderlee.me <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/11/20151128144413.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/11/20151128144413.png" alt="20151128144413"></a> 然后配置一下，vhost，在 apache 下配置是这样的 首先在 /etc/apache2/apache2.conf 中加入如下两行</p>
      <figure class="highlight autoit">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="meta"># <span class="meta-keyword">Include</span> all the user configurations:</span></span><br><span class="line">Include httpd.conf</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>然后我们需要在 httpd.conf 配置一下域名解析 新建一个 /etc/apach2/httpd.conf，加入如下内容</p>
      <figure class="highlight angelscript">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">ServerName <span class="number">115.28</span><span class="number">.24</span><span class="number">.44</span>:<span class="number">80</span></span><br><span class="line"></span><br><span class="line">&lt;VirtualHost <span class="number">115.28</span><span class="number">.24</span><span class="number">.44</span>:<span class="number">80</span>&gt;</span><br><span class="line">  DocumentRoot /var/www/html</span><br><span class="line">  ServerName   <span class="number">115.28</span><span class="number">.24</span><span class="number">.44</span></span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">&lt;VirtualHost <span class="number">115.28</span><span class="number">.24</span><span class="number">.44</span>:<span class="number">80</span>&gt;</span><br><span class="line">  DocumentRoot /var/www/html/wonder</span><br><span class="line">  ServerName   wonderlee.me</span><br><span class="line">  ServerAlias  wonderlee.me</span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>然后执行服务器重启操作。</p>
      <figure class="highlight routeros">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">sudo<span class="built_in"> service </span>apache2 restart</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>好，这样的话我们的域名配置解析就好了。 输入 wonderlee.me 即可解析到 wonder 文件夹啦。 可以输入你的域名试试看，已经可以了吧。 然后我们需要开启 rewrite 模块。 输入命令</p>
      <figure class="highlight coq">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">sudo a2enmod <span class="built_in">rewrite</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>然后修改 /etc/apache2/apache2.conf 文件</p>
      <figure class="highlight apache">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="section">&lt;Directory /var/www/&gt;</span></span><br><span class="line">	<span class="attribute"><span class="nomarkup">Options</span></span> Indexes FollowSymLinks</span><br><span class="line">	<span class="attribute">AllowOverride</span> None</span><br><span class="line">	<span class="attribute">Require</span> <span class="literal">all</span> granted</span><br><span class="line"><span class="section">&lt;/Directory&gt;</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>改为</p>
      <figure class="highlight apache">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="section">&lt;Directory /var/www/&gt;</span></span><br><span class="line">	<span class="attribute"><span class="nomarkup">Options</span></span> Indexes FollowSymLinks</span><br><span class="line">	<span class="attribute">AllowOverride</span> <span class="literal">All</span></span><br><span class="line">	<span class="attribute">Require</span> <span class="literal">all</span> granted</span><br><span class="line"><span class="section">&lt;/Directory&gt;</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>即可，结束之后重启一下服务器。</p>
      <figure class="highlight routeros">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">sudo<span class="built_in"> service </span>apache2 restart</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>在项目目录下新建一个文件 .htaccess，来支持重写</p>
      <figure class="highlight apache">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="comment"># BEGIN WordPress</span></span><br><span class="line"><span class="section">&lt;IfModule mod_rewrite.c&gt;</span></span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteEngine</span></span> <span class="literal">On</span></span><br><span class="line"><span class="attribute">RewriteBase</span> /wonder/</span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteRule</span></span> ^index\.php$ -<span class="meta"> [L]</span></span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteCond</span></span> <span class="variable">%&#123;REQUEST_FILENAME&#125;</span> !-f</span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteCond</span></span> <span class="variable">%&#123;REQUEST_FILENAME&#125;</span> !-d</span><br><span class="line"><span class="attribute"><span class="nomarkup">RewriteRule</span></span> . /wonder/index.php<span class="meta"> [L]</span></span><br><span class="line"><span class="section">&lt;/IfModule&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># END WordPress</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>好，这样，重写过程就完成啦。</p>
      <h2 id="网站配置"><a href="#网站配置" class="headerlink" title="网站配置"></a>网站配置</h2>
      <p>最后，需要将网站的配置修改一下，比如固定链接 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/11/20151128145507.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/11/20151128145507.png" alt="20151128145507"></a> 比如网站的基地址 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/11/20151128145620.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/11/20151128145620.png" alt="20151128145620"></a> 至此，网站配置工作全部完成，欢乐地上网体验一下吧 如有问题，欢迎留言。</p>
      </p>
    </div>
  </div>
  <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-user"></i>
      </span>
      <span class="post-meta-item-text">作者</span>
      <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      <time title="创建时间：2015-11-28 14:59:07" itemprop="dateCreated datePublished" datetime="2015-11-28T14:59:07+08:00">2015-11-28</time>
    </span>
    <span id="/2249.html" class="post-meta-item leancloud_visitors" data-flag-title="WordPress从Apache迁移到Apache过程" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
  </div>
</article>

    <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2227.html">
  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.png">
    <meta itemprop="name" content="崔庆才">
    <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  </span>
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="静觅">
  </span>
  <header class="post-header">
    <h2 class="post-title" itemprop="name headline">
      <a class="label"> Linux <i class="label-arrow"></i>
      </a>
      <a href="/2227.html" class="post-title-link" itemprop="url">WordPress从Apache迁移到Nginx过程</a>
    </h2>
  </header>
  <div class="post-body" itemprop="articleBody">
    <div class="thumb">
      <img itemprop="contentUrl" class="random">
    </div>
    <div class="excerpt">
      <p>
      <p>之前一直都用 Apache 服务器，由于网站访问量比较大，另外加上旧服务器快到期了，准备迁移到新的服务器上，所以决定采用 Nginx 服务器。 迁移过程比较心酸，之前一直用 apache，对 nginx 服务器配置不熟悉，踩了很多坑。下面说一下我的网站从旧主机（配有 apache 服务器）迁移到新主机（配有 nginx 服务器）的过程。</p>
      <h2 id="代码迁移"><a href="#代码迁移" class="headerlink" title="代码迁移"></a>代码迁移</h2>
      <p>这个过程其实也是比较心酸的，查看了一下目录结构占用空间已经足足快 1 个 G 了，可想而知里面占用的大部分空间是上传的图片素材。 不过要是迁移全部图片的话工程量实在是巨大。不过，好消息是我从开始就使用了七牛 CDN 加速，所以，上传的图片会自动存放到七牛，只不过也在主机本地留了备份而已，所以，我可以安心地删掉它们了。 那么对代码进行瘦身之后，这里就有两种方法来迁移了： 1.可以用 git 上传到 github，然后用另一台主机把代码拉下来即可，在此不再赘述。 2.打包上传，然后直接在另一台主机上下载下来，由于我的两台主机在同一局域网内，所以我直接采用了这种方式，传输速度快。</p>
      <h3 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h3>
      <p>由于代码中含有 .git 目录，所以这部分我们不需要打包，那么压缩时我们就需要排除这个文件夹。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/11/20151113155701-e1447401563242.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/11/20151113155701-e1447401563242.png" alt="20151113155701"></a> 文件夹名叫 cqc，那么我们就打包一下，排除.git 目录，使用如下命令</p>
      <figure class="highlight stylus">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">tar -zcvf cqc<span class="selector-class">.tar</span><span class="selector-class">.gz</span> --exclude=cqc/<span class="selector-class">.git</span> cqc</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>运行结束后会出现 cqc.tar.gz 文件，这就是目录压缩包。 然后我们只需要在另一台主机上输入</p>
      <figure class="highlight groovy">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">wget <span class="string">http:</span><span class="comment">//xxx.xxx.xxx.xxx/cqc.tar.gz</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>即可完成下载，速度可是嗖嗖的 然后解压即可，代码便完成了迁移。</p>
      <h2 id="数据库迁移"><a href="#数据库迁移" class="headerlink" title="数据库迁移"></a>数据库迁移</h2>
      <p>数据库用二者的 phpmyadmin 导出和上传即可。我导出 .sql 文件，大小为 9M，而 phpMyAdmin 的上传限制大小是 2M，怎么办？其实我们可以压缩 .sql 文件为 zip 格式，压缩之后就有了 1.4M 了，分分钟完成上传。要知道 phpMyAdmin 可是支持 .sql.zip 文件的。 接下来是一个比较重要的部分，那就是配置一下站点信息。直接修改数据库的两个 URL。 分别是 siteurl 和 home，一定要修改为 <a href="http://xxx.xxx.xxx.xxx/cqc" target="_blank" rel="noopener">http://xxx.xxx.xxx.xxx/cqc</a> 的形式，也就是把原来的域名改成 IP 加目录的形式，要不然网站是无法访问的，会出现多重循环定向的提示。 好，其他的没什么问题，连接数据库错误的话就修改一下目录的 wp-config.php 文件吧，连接数据库的信息修改正确就好了。</p>
      <h2 id="配置-vhosts"><a href="#配置-vhosts" class="headerlink" title="配置 vhosts"></a>配置 vhosts</h2>
      <p>和 apache 一样，我们多个域名肯定要可以解析到不同的目录吧，nginx 当然也是支持的。 接下来我们需要把新域名解析到 cqc 目录，在 nginx 下怎么做呢？其实还是比较简单的。 在 /etc/nginx 目录下可以新建一个 vhosts 文件夹。在这里我们要解析 cqc 目录，那么我就新建一个 cqc.conf 文件。 现在例如我要把 blog.cuiqingcai.com 解析到 cqc 文件夹，配置如下</p>
      <figure class="highlight nginx">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">	<span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">	<span class="attribute">server_name</span> cuiqingcai.com blog.cuiqingcai.com;</span><br><span class="line"></span><br><span class="line">	<span class="attribute">index</span> index.html index.htm index.php;</span><br><span class="line">	<span class="attribute">root</span> /var/www/cqc;</span><br><span class="line"></span><br><span class="line">	<span class="attribute">location</span> / &#123;</span><br><span class="line"></span><br><span class="line">		<span class="attribute">if</span> (!-e <span class="variable">$request_filename</span>) &#123;</span><br><span class="line">			<span class="attribute">rewrite</span><span class="regexp"> ^([_0-9a-zA-Z-]+)?(/wp-.*)</span> <span class="variable">$2</span> <span class="literal">last</span>;</span><br><span class="line">			<span class="attribute">rewrite</span><span class="regexp"> ^([_0-9a-zA-Z-]+)?(/.*\.php)$</span> <span class="variable">$2</span> <span class="literal">last</span>;</span><br><span class="line">			<span class="attribute">rewrite</span><span class="regexp"> ^</span> /index.php <span class="literal">last</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="attribute">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line">		<span class="attribute">fastcgi_pass</span> <span class="number">127.0.0.1:9000</span>;</span><br><span class="line">	<span class="comment">#	# With php5-fpm:</span></span><br><span class="line">	<span class="comment">#	fastcgi_pass unix:/var/run/php5-fpm.sock;</span></span><br><span class="line">		<span class="attribute">fastcgi_index</span> index.php;</span><br><span class="line">		<span class="attribute">fastcgi_param</span> SCRIPT_FILENAME /var/www/cqc<span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">		<span class="attribute">include</span> fastcgi_params;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>其中</p>
      <figure class="highlight nginx">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line"></span><br><span class="line">		<span class="attribute">if</span> (!-e <span class="variable">$request_filename</span>) &#123;</span><br><span class="line">			<span class="attribute">rewrite</span><span class="regexp"> ^([_0-9a-zA-Z-]+)?(/wp-.*)</span> <span class="variable">$2</span> <span class="literal">last</span>;</span><br><span class="line">			<span class="attribute">rewrite</span><span class="regexp"> ^([_0-9a-zA-Z-]+)?(/.*\.php)$</span> <span class="variable">$2</span> <span class="literal">last</span>;</span><br><span class="line">			<span class="attribute">rewrite</span><span class="regexp"> ^</span> /index.php <span class="literal">last</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>这一部分是伪静态重写，因为我的博客用的是 wordpress，所以伪静态重写是这样的。当然还有其他的重写方式可以尝试。 之后在 /etc/nginx/nginx.conf 中的 http{} 中添加一行</p>
      <figure class="highlight gradle">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="keyword">include</span> <span class="regexp">/etc/</span>nginx<span class="regexp">/vhosts/</span>cqc.conf;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>则代表引用了这个文件。 注意，还要把 域名设置一下，添加一条 A 记录到主机上。 好了，一切大功告成了。</p>
      <h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2>
      <p>迁移和配置的过程坑实在是太多了，列列吧，警醒世人呐。 （1）代码迁移过程上传 git，整个项目差不多 1 个 G，由于数据量太大，导致内存不够无法正常上传。后来删除了图片，发现项目还是很大，结果发现是 .git 目录已经占用了上百兆，后来打包排除这个目录迁移的。 （2）数据库迁移的时候由于 phpMyAdmin 上传大小限制，修改了一番上传大小结果发现没生效，还倒腾了一下 php-fpm，后来发现可以直接上传压缩包，那就分分钟完成了。 （3）配置完之后发现网站首页正常访问了，可是其他页面全部出现了 404 错误，后来配置了一番伪静态解析发现配置代码直接写在了 localhost server 里面，后来发现可以直接新写一个 server，然后配置域名 servername，然后配置伪静态重写才成功。 总之，坎坷是多，但是，自己慢慢摸索出来，也是一种不错的体验。 当你成功之后，会觉得世界又是那么美好。</p>
      </p>
    </div>
  </div>
  <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-user"></i>
      </span>
      <span class="post-meta-item-text">作者</span>
      <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      <time title="创建时间：2015-11-13 16:59:27" itemprop="dateCreated datePublished" datetime="2015-11-13T16:59:27+08:00">2015-11-13</time>
    </span>
    <span id="/2227.html" class="post-meta-item leancloud_visitors" data-flag-title="WordPress从Apache迁移到Nginx过程" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.5k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
  </div>
</article>

    <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2200.html">
  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.png">
    <meta itemprop="name" content="崔庆才">
    <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  </span>
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="静觅">
  </span>
  <header class="post-header">
    <h2 class="post-title" itemprop="name headline">
      <a class="label"> Java <i class="label-arrow"></i>
      </a>
      <a href="/2200.html" class="post-title-link" itemprop="url">Android开发之2048安卓版</a>
    </h2>
  </header>
  <div class="post-body" itemprop="articleBody">
    <div class="thumb">
      <img itemprop="contentUrl" class="random">
    </div>
    <div class="excerpt">
      <p>
      <p>之前是在eclipse上写的，后面换成了android sudio。 2048游戏的UI整体可以采用线性布局，即LinearLayout，其中嵌套一个线性布局和一个GridLayout，内嵌的线性布局填充文本框，以显示分数，GridLayout中填充4x4的继承自FrameLayout的card类作为主要的游戏界面。由于大部分操作都在GridLayout中进行，可以自定义一个继承自GridLayout的类GameView，类中定义判定上下左右滑动的方法和每次滑动后自动添加一个随机数字的方法以及每次滑动后判断游戏是否可以继续进行的方法。 主布局activity_main.xml代码如下</p>
      <figure class="highlight stylus">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">&lt;LinearLayout xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="line">    xmlns:tools=<span class="string">"http://schemas.android.com/tools"</span></span><br><span class="line">    android:id=<span class="string">"@+id/container"</span></span><br><span class="line">	<span class="comment">//match_parent表示布局充满整个屏幕</span></span><br><span class="line">    android:layout_width=<span class="string">"match_parent"</span></span><br><span class="line">    android:layout_height=<span class="string">"match_parent"</span></span><br><span class="line">    tools:context=<span class="string">"com.example.administractor.game2048.MainActivity"</span></span><br><span class="line">	<span class="comment">//里面的组件垂直放置</span></span><br><span class="line">    android:orientation=<span class="string">"vertical"</span></span><br><span class="line">    tools:ignore=<span class="string">"MergeRootFrame"</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;LinearLayout</span><br><span class="line">	<span class="comment">//宽度充满整个屏幕，高度自适应。</span></span><br><span class="line">        android:layout_width=<span class="string">"fill_parent"</span></span><br><span class="line">        android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">        android:orientation=<span class="string">"horizontal"</span> &gt;</span><br><span class="line">		<span class="comment">//显示当前分数的文本框</span></span><br><span class="line">        &lt;TextView android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">            android:layout_height=<span class="string">"wrap_content"</span></span><br><span class="line">            android:text=<span class="string">"Your Score:"</span>/&gt;</span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:id=<span class="string">"@+id/tvScore"</span></span><br><span class="line">            android:layout_width=<span class="string">"wrap_content"</span></span><br><span class="line">            android:layout_height=<span class="string">"wrap_content"</span>/&gt;</span><br><span class="line">    &lt;/LinearLayout&gt;</span><br><span class="line">	<span class="comment">//使用自定义的GridLayout</span></span><br><span class="line">    &lt;com<span class="selector-class">.example</span><span class="selector-class">.administractor</span><span class="selector-class">.game2048</span>.GameView</span><br><span class="line">        android:layout_width=<span class="string">"fill_parent"</span></span><br><span class="line">        android:layout_height=<span class="string">"0dp"</span></span><br><span class="line">        android:layout_weight=<span class="string">"1"</span></span><br><span class="line">        android:id=<span class="string">"@+id/GameView"</span> &gt;</span><br><span class="line">    &lt;/com<span class="selector-class">.example</span><span class="selector-class">.administractor</span><span class="selector-class">.game2048</span>.GameView&gt;</span><br><span class="line">&lt;/LinearLayout&gt;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>GameView.java：</p>
      <figure class="highlight reasonml">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">package com.example.administrator.game2048;</span><br><span class="line"></span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">import android.app.AlertDialog;</span><br><span class="line">import android.content.Context;</span><br><span class="line">import android.content.DialogInterface;</span><br><span class="line">import android.graphics.Point;</span><br><span class="line">import android.util.AttributeSet;</span><br><span class="line">import android.view.MotionEvent;</span><br><span class="line">import android.view.View;</span><br><span class="line">import android.widget.GridLayout;</span><br><span class="line"></span><br><span class="line">public <span class="keyword">class</span> GameView extends GridLayout &#123;</span><br><span class="line"><span class="comment">//调用类构造方法</span></span><br><span class="line">    public <span class="constructor">GameView(Context <span class="params">context</span>, AttributeSet <span class="params">attrs</span>, <span class="params">int</span> <span class="params">defStyle</span>)</span> &#123;</span><br><span class="line">        super(context, attrs, defStyle);</span><br><span class="line">        <span class="comment">//初始化游戏</span></span><br><span class="line">		<span class="constructor">InitGameView()</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="constructor">GameView(Context <span class="params">context</span>, AttributeSet <span class="params">attrs</span>)</span> &#123;</span><br><span class="line">        super(context, attrs);</span><br><span class="line">        <span class="constructor">InitGameView()</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="constructor">GameView(Context <span class="params">context</span>)</span> &#123;</span><br><span class="line">        super(context);</span><br><span class="line">        <span class="constructor">InitGameView()</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> void <span class="constructor">InitGameView()</span>&#123;</span><br><span class="line">		<span class="comment">//设置为4x4个方格</span></span><br><span class="line">        set<span class="constructor">ColumnCount(4)</span>;</span><br><span class="line">		<span class="comment">//设置背景颜色</span></span><br><span class="line">        set<span class="constructor">BackgroundColor(0xffeee4da)</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//判定滑动方向</span></span><br><span class="line">        set<span class="constructor">OnTouchListener(<span class="params">new</span> OnTouchListener()</span> &#123;</span><br><span class="line">            <span class="keyword">private</span> <span class="built_in">float</span> startx,starty,offsetx,offsety;</span><br><span class="line">            @Override</span><br><span class="line">            public boolean on<span class="constructor">Touch(View <span class="params">v</span>, MotionEvent <span class="params">event</span>)</span> &#123;</span><br><span class="line">                switch(event.get<span class="constructor">Action()</span>)&#123;</span><br><span class="line">                    case MotionEvent.ACTION_DOWN:</span><br><span class="line">                        startx=event.get<span class="constructor">X()</span>;</span><br><span class="line">                        starty=event.get<span class="constructor">Y()</span>;</span><br><span class="line">                        break;</span><br><span class="line">                    case MotionEvent.ACTION_UP:</span><br><span class="line">                        offsetx=event.get<span class="constructor">X()</span>-startx;</span><br><span class="line">                        offsety=event.get<span class="constructor">Y()</span>-starty;</span><br><span class="line">                        <span class="keyword">if</span>(<span class="module-access"><span class="module"><span class="identifier">Math</span>.</span></span>abs(offsetx)&gt;<span class="module-access"><span class="module"><span class="identifier">Math</span>.</span></span>abs(offsety))&#123;</span><br><span class="line">                            <span class="keyword">if</span>(offsetx&lt;-<span class="number">5</span>)&#123;</span><br><span class="line">                                swipe<span class="constructor">Left()</span>;</span><br><span class="line">                            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(offsetx&gt;<span class="number">5</span>)&#123;</span><br><span class="line">                                swipe<span class="constructor">Right()</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                            <span class="keyword">if</span>(offsety&lt;-<span class="number">5</span>)&#123;</span><br><span class="line">                                swipe<span class="constructor">Up()</span>;</span><br><span class="line">                            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(offsetx&gt;<span class="number">3</span>)&#123;</span><br><span class="line">                                swipe<span class="constructor">Down()</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        break;</span><br><span class="line">                &#125;</span><br><span class="line">                return <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//适应不同大小的屏幕</span></span><br><span class="line">    @Override</span><br><span class="line">    protected void on<span class="constructor">SizeChanged(<span class="params">int</span> <span class="params">w</span>, <span class="params">int</span> <span class="params">h</span>, <span class="params">int</span> <span class="params">oldw</span>, <span class="params">int</span> <span class="params">oldh</span>)</span> &#123;</span><br><span class="line">        super.on<span class="constructor">SizeChanged(<span class="params">w</span>, <span class="params">h</span>, <span class="params">oldw</span>, <span class="params">oldh</span>)</span>;</span><br><span class="line">        <span class="built_in">int</span> cardWidth=(<span class="module-access"><span class="module"><span class="identifier">Math</span>.</span></span>min(h, w))/<span class="number">4</span>;</span><br><span class="line">        add<span class="constructor">Cards(<span class="params">cardWidth</span>,<span class="params">cardWidth</span>)</span>;</span><br><span class="line">        start<span class="constructor">Game()</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//在4x4的方格上添加满卡片</span></span><br><span class="line">    public void add<span class="constructor">Cards(<span class="params">int</span> <span class="params">cardwidth</span>,<span class="params">int</span> <span class="params">cardheight</span>)</span>&#123;</span><br><span class="line">        Card c;</span><br><span class="line">        for (<span class="built_in">int</span> y = <span class="number">0</span>; y &lt; <span class="number">4</span>; y++) &#123;</span><br><span class="line">            for (<span class="built_in">int</span> x = <span class="number">0</span>; x &lt; <span class="number">4</span>; x++) &#123;</span><br><span class="line">                c=<span class="keyword">new</span> <span class="constructor">Card(<span class="params">getContext</span>()</span>);</span><br><span class="line">                c.set<span class="constructor">Num(0)</span>;</span><br><span class="line">                add<span class="constructor">View(<span class="params">c</span>, <span class="params">cardwidth</span>, <span class="params">cardheight</span>)</span>;</span><br><span class="line">                cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>=c;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//游戏开始时每个卡片默认值设为0，并随机添加两张带数字的卡片</span></span><br><span class="line">    <span class="keyword">private</span> void start<span class="constructor">Game()</span>&#123;</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">MainActivity</span>.</span></span>get<span class="constructor">MainActivity()</span>.clear<span class="constructor">Score()</span>;</span><br><span class="line">        for (<span class="built_in">int</span> y = <span class="number">0</span>; y &lt; <span class="number">4</span>; y++) &#123;</span><br><span class="line">            for (<span class="built_in">int</span> x = <span class="number">0</span>; x &lt; <span class="number">4</span>; x++) &#123;</span><br><span class="line">                cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.set<span class="constructor">Num(0)</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        add<span class="constructor">RandomNum()</span>;</span><br><span class="line">        add<span class="constructor">RandomNum()</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> void add<span class="constructor">RandomNum()</span> &#123;</span><br><span class="line">		<span class="comment">//使用emptypoints将数字为0的card提取出来，并随即选择一个空card赋值</span></span><br><span class="line">        emptyPoints.clear<span class="literal">()</span>;</span><br><span class="line">        for (<span class="built_in">int</span> y = <span class="number">0</span>; y &lt; <span class="number">4</span>; y++) &#123;</span><br><span class="line">            for (<span class="built_in">int</span> x = <span class="number">0</span>; x &lt; <span class="number">4</span>; x++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.get<span class="constructor">Num()</span>&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">                    emptyPoints.add(<span class="keyword">new</span> <span class="constructor">Point(<span class="params">x</span>,<span class="params">y</span>)</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Point p=emptyPoints.remove((<span class="built_in">int</span>)(<span class="module-access"><span class="module"><span class="identifier">Math</span>.</span></span>random<span class="literal">()</span>*emptyPoints.size<span class="literal">()</span>));</span><br><span class="line">		<span class="comment">//2和4出现的概率控制在1：9</span></span><br><span class="line">        cardmap<span class="literal">[<span class="identifier">p</span>.<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">p</span>.<span class="identifier">y</span>]</span>.set<span class="constructor">Num(Math.<span class="params">random</span>()</span>&gt;<span class="number">0.1</span>?<span class="number">2</span>:<span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//左滑方法</span></span><br><span class="line">    <span class="keyword">private</span> void swipe<span class="constructor">Left()</span>&#123;</span><br><span class="line">		<span class="comment">//merge作为判断能否滑动的flag</span></span><br><span class="line">        boolean merge = <span class="literal">false</span>;</span><br><span class="line">        for (<span class="built_in">int</span> y = <span class="number">0</span>; y &lt; <span class="number">4</span>; y++) &#123;</span><br><span class="line">            for (<span class="built_in">int</span> x = <span class="number">0</span>; x &lt; <span class="number">4</span>; x++) &#123;</span><br><span class="line">                for (<span class="built_in">int</span> x1 = x+<span class="number">1</span>; x1 &lt;<span class="number">4</span>; x1++) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(cardmap<span class="literal">[<span class="identifier">x1</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.get<span class="constructor">Num()</span>&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                        <span class="keyword">if</span>(cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.get<span class="constructor">Num()</span>&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">                            cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.set<span class="constructor">Num(<span class="params">cardmap</span>[<span class="params">x1</span>][<span class="params">y</span>].<span class="params">getNum</span>()</span>);</span><br><span class="line">                            cardmap<span class="literal">[<span class="identifier">x1</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.set<span class="constructor">Num(0)</span>;</span><br><span class="line">                            merge=<span class="literal">true</span>;</span><br><span class="line">                            x--;</span><br><span class="line">                        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.equal(cardmap<span class="literal">[<span class="identifier">x1</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>))&#123;</span><br><span class="line">                            cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.set<span class="constructor">Num(<span class="params">cardmap</span>[<span class="params">x</span>][<span class="params">y</span>].<span class="params">getNum</span>()</span>*<span class="number">2</span>);</span><br><span class="line">                            cardmap<span class="literal">[<span class="identifier">x1</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.set<span class="constructor">Num(0)</span>;</span><br><span class="line">                            <span class="module-access"><span class="module"><span class="identifier">MainActivity</span>.</span></span>get<span class="constructor">MainActivity()</span>.add<span class="constructor">Score(<span class="params">cardmap</span>[<span class="params">x</span>][<span class="params">y</span>].<span class="params">getNum</span>()</span>);</span><br><span class="line">                            merge=<span class="literal">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        break;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(merge)&#123;</span><br><span class="line">            add<span class="constructor">RandomNum()</span>;</span><br><span class="line">            check<span class="constructor">Complete()</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//下滑</span></span><br><span class="line">    <span class="keyword">private</span> void swipe<span class="constructor">Down()</span>&#123;</span><br><span class="line"></span><br><span class="line">        boolean merge = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        for (<span class="built_in">int</span> x = <span class="number">0</span>; x &lt; <span class="number">4</span>; x++) &#123;</span><br><span class="line">            for (<span class="built_in">int</span> y = <span class="number">3</span>; y &gt;=<span class="number">0</span>; y--) &#123;</span><br><span class="line"></span><br><span class="line">                for (<span class="built_in">int</span> y1 = y-<span class="number">1</span>; y1 &gt;=<span class="number">0</span>; y1--) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y1</span>]</span>.get<span class="constructor">Num()</span>&gt;<span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.get<span class="constructor">Num()</span>&lt;=<span class="number">0</span>) &#123;</span><br><span class="line">                            cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.set<span class="constructor">Num(<span class="params">cardmap</span>[<span class="params">x</span>][<span class="params">y1</span>].<span class="params">getNum</span>()</span>);</span><br><span class="line">                            cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y1</span>]</span>.set<span class="constructor">Num(0)</span>;</span><br><span class="line"></span><br><span class="line">                            y++;</span><br><span class="line">                            merge = <span class="literal">true</span>;</span><br><span class="line">                        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.equal(cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y1</span>]</span>)) &#123;</span><br><span class="line">                            cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.set<span class="constructor">Num(<span class="params">cardmap</span>[<span class="params">x</span>][<span class="params">y</span>].<span class="params">getNum</span>()</span>*<span class="number">2</span>);</span><br><span class="line">                            cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y1</span>]</span>.set<span class="constructor">Num(0)</span>;</span><br><span class="line">                            <span class="module-access"><span class="module"><span class="identifier">MainActivity</span>.</span></span>get<span class="constructor">MainActivity()</span>.add<span class="constructor">Score(<span class="params">cardmap</span>[<span class="params">x</span>][<span class="params">y</span>].<span class="params">getNum</span>()</span>);</span><br><span class="line">                            merge = <span class="literal">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        break;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (merge) &#123;</span><br><span class="line">            add<span class="constructor">RandomNum()</span>;</span><br><span class="line">            check<span class="constructor">Complete()</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//上滑</span></span><br><span class="line">    <span class="keyword">private</span> void swipe<span class="constructor">Up()</span>&#123;</span><br><span class="line"></span><br><span class="line">        boolean merge = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        for (<span class="built_in">int</span> x = <span class="number">0</span>; x &lt; <span class="number">4</span>; x++) &#123;</span><br><span class="line">            for (<span class="built_in">int</span> y = <span class="number">0</span>; y &lt; <span class="number">4</span>; y++) &#123;</span><br><span class="line"></span><br><span class="line">                for (<span class="built_in">int</span> y1 = y+<span class="number">1</span>; y1 &lt; <span class="number">4</span>; y1++) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y1</span>]</span>.get<span class="constructor">Num()</span>&gt;<span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.get<span class="constructor">Num()</span>&lt;=<span class="number">0</span>) &#123;</span><br><span class="line">                            cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.set<span class="constructor">Num(<span class="params">cardmap</span>[<span class="params">x</span>][<span class="params">y1</span>].<span class="params">getNum</span>()</span>);</span><br><span class="line">                            cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y1</span>]</span>.set<span class="constructor">Num(0)</span>;</span><br><span class="line"></span><br><span class="line">                            y--;</span><br><span class="line"></span><br><span class="line">                            merge = <span class="literal">true</span>;</span><br><span class="line">                        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.equal(cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y1</span>]</span>)) &#123;</span><br><span class="line">                            cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.set<span class="constructor">Num(<span class="params">cardmap</span>[<span class="params">x</span>][<span class="params">y</span>].<span class="params">getNum</span>()</span>*<span class="number">2</span>);</span><br><span class="line">                            cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y1</span>]</span>.set<span class="constructor">Num(0)</span>;</span><br><span class="line">                            <span class="module-access"><span class="module"><span class="identifier">MainActivity</span>.</span></span>get<span class="constructor">MainActivity()</span>.add<span class="constructor">Score(<span class="params">cardmap</span>[<span class="params">x</span>][<span class="params">y</span>].<span class="params">getNum</span>()</span>);</span><br><span class="line">                            merge = <span class="literal">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        break;</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (merge) &#123;</span><br><span class="line">            add<span class="constructor">RandomNum()</span>;</span><br><span class="line">            check<span class="constructor">Complete()</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//右滑</span></span><br><span class="line">    <span class="keyword">private</span> void swipe<span class="constructor">Right()</span>&#123;</span><br><span class="line">        boolean merge = <span class="literal">false</span>;</span><br><span class="line">        for (<span class="built_in">int</span> y = <span class="number">0</span>; y &lt; <span class="number">4</span>; y++) &#123;</span><br><span class="line">            for (<span class="built_in">int</span> x = <span class="number">3</span>; x &gt;=<span class="number">0</span>; x--) &#123;</span><br><span class="line">                for (<span class="built_in">int</span> x1 = x-<span class="number">1</span>; x1 &gt;=<span class="number">0</span>; x1--) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(cardmap<span class="literal">[<span class="identifier">x1</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.get<span class="constructor">Num()</span>&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                        <span class="keyword">if</span>(cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.get<span class="constructor">Num()</span>&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">                            cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.set<span class="constructor">Num(<span class="params">cardmap</span>[<span class="params">x1</span>][<span class="params">y</span>].<span class="params">getNum</span>()</span>);</span><br><span class="line">                            cardmap<span class="literal">[<span class="identifier">x1</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.set<span class="constructor">Num(0)</span>;</span><br><span class="line">                            x++;</span><br><span class="line">                            merge=<span class="literal">true</span>;</span><br><span class="line">                        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.equal(cardmap<span class="literal">[<span class="identifier">x1</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>))&#123;</span><br><span class="line">                            cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.set<span class="constructor">Num(<span class="params">cardmap</span>[<span class="params">x</span>][<span class="params">y</span>].<span class="params">getNum</span>()</span>*<span class="number">2</span>);</span><br><span class="line">                            cardmap<span class="literal">[<span class="identifier">x1</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.set<span class="constructor">Num(0)</span>;</span><br><span class="line">                            <span class="module-access"><span class="module"><span class="identifier">MainActivity</span>.</span></span>get<span class="constructor">MainActivity()</span>.add<span class="constructor">Score(<span class="params">cardmap</span>[<span class="params">x</span>][<span class="params">y</span>].<span class="params">getNum</span>()</span>);</span><br><span class="line">                            merge=<span class="literal">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        break;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(merge)&#123;</span><br><span class="line">            add<span class="constructor">RandomNum()</span>;</span><br><span class="line">            check<span class="constructor">Complete()</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//如果有空卡片或者相邻的值相同卡片则游戏还能进行</span></span><br><span class="line">    public void check<span class="constructor">Complete()</span>&#123;</span><br><span class="line">        boolean complete=<span class="literal">true</span>;</span><br><span class="line">        ALL:</span><br><span class="line">        for (<span class="built_in">int</span> y = <span class="number">0</span>; y &lt;<span class="number">4</span>; y++) &#123;</span><br><span class="line">            for (<span class="built_in">int</span> x = <span class="number">0</span>; x &lt;<span class="number">4</span>; x++) &#123;</span><br><span class="line">                <span class="keyword">if</span>(cardmap<span class="literal">[<span class="identifier">x</span>]</span><span class="literal">[<span class="identifier">y</span>]</span>.get<span class="constructor">Num()</span>==<span class="number">0</span><span class="pattern-match"><span class="operator">||</span></span></span><br><span class="line"><span class="pattern-match">                        x&gt;0<span class="operator">&amp;&amp;</span>cardmap[x][y].equal(cardmap[x-1][y])<span class="operator">||</span></span></span><br><span class="line"><span class="pattern-match">                        x&lt;3<span class="operator">&amp;&amp;</span>cardmap[x][y].equal(cardmap[x+1][y])<span class="operator">||</span></span></span><br><span class="line"><span class="pattern-match">                        y&gt;0<span class="operator">&amp;&amp;</span>cardmap[x][y].equal(cardmap[x][y-1])<span class="operator">||</span></span></span><br><span class="line"><span class="pattern-match">                        y&lt;3<span class="operator">&amp;&amp;</span>cardmap[x][y].equal(cardmap[x][y+1]))&#123;</span></span><br><span class="line"><span class="pattern-match">                    complete=<span class="literal">false</span>;</span></span><br><span class="line"><span class="pattern-match">                    break <span class="constructor">ALL</span>;</span></span><br><span class="line"><span class="pattern-match">                &#125;</span></span><br><span class="line"><span class="pattern-match">            &#125;</span></span><br><span class="line"><span class="pattern-match">        &#125;</span></span><br><span class="line"><span class="pattern-match">		<span class="operator">/</span><span class="operator">/</span>游戏结束弹出alert提示窗口</span></span><br><span class="line"><span class="pattern-match">        <span class="keyword">if</span>(complete)&#123;</span></span><br><span class="line"><span class="pattern-match">            <span class="keyword">new</span> <span class="constructor">AlertDialog</span>.<span class="constructor">Builder(<span class="params">getContext</span>()</span>).set<span class="constructor">Title(<span class="string">"大林哥温馨提示"</span>)</span>.set<span class="constructor">Message(<span class="string">"游戏结束"</span>)</span>.set<span class="constructor">PositiveButton(<span class="string">"重来"</span>,<span class="params">new</span> DialogInterface.OnClickListener()</span> &#123;</span></span><br><span class="line"><span class="pattern-match"></span></span><br><span class="line"><span class="pattern-match">                @<span class="constructor">Override</span></span></span><br><span class="line"><span class="pattern-match">                public void on<span class="constructor">Click(DialogInterface <span class="params">arg0</span>, <span class="params">int</span> <span class="params">arg1</span>)</span> &#123;</span></span><br><span class="line"><span class="pattern-match">                    start<span class="constructor">Game()</span>;</span></span><br><span class="line"><span class="pattern-match">                &#125;</span></span><br><span class="line"><span class="pattern-match">            &#125;).show();</span></span><br><span class="line"><span class="pattern-match">        &#125;</span></span><br><span class="line"><span class="pattern-match"></span></span><br><span class="line"><span class="pattern-match">    &#125;</span></span><br><span class="line"><span class="pattern-match">    <span class="keyword">private</span> <span class="constructor">Card</span>[][] cardmap=<span class="keyword">new</span> <span class="constructor">Card</span>[4][4];</span></span><br><span class="line"><span class="pattern-match">    <span class="keyword">private</span> <span class="constructor">List</span>&lt;<span class="constructor">Point</span>&gt; empty<span class="constructor">Points</span>=<span class="keyword">new</span> <span class="constructor">ArrayList</span>&lt;<span class="constructor">Point</span>&gt;();</span></span><br><span class="line"><span class="pattern-match">&#125;</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>主类MainActivity.java：</p>
      <figure class="highlight java">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="keyword">package</span> com.example.administrator.game2048;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.app.Activity;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MainActivity</span><span class="params">()</span></span>&#123;</span><br><span class="line">        mainActivity=<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        tvscore = (TextView) findViewById(R.id.tvScore);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clearScore</span><span class="params">()</span></span>&#123;</span><br><span class="line">        score=<span class="number">0</span>;</span><br><span class="line">        showScore();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showScore</span><span class="params">()</span></span>&#123;</span><br><span class="line">        tvscore.setText(score+<span class="string">""</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addScore</span><span class="params">(<span class="keyword">int</span> s)</span></span>&#123;</span><br><span class="line">        score+=s;</span><br><span class="line">        showScore();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> TextView tvscore;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> score=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> MainActivity mainActivity=<span class="keyword">null</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MainActivity <span class="title">getMainActivity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mainActivity;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>Card.java：</p>
      <figure class="highlight angelscript">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">package com.example.administrator.game2048;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.content.Context;</span><br><span class="line"><span class="keyword">import</span> android.view.Gravity;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.FrameLayout;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="symbol">Card</span> <span class="symbol">extends</span> <span class="symbol">FrameLayout</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Card(Context context) &#123;</span><br><span class="line">        <span class="keyword">super</span>(context);</span><br><span class="line">        LayoutParams lp = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        View background = new View(getContext());</span><br><span class="line">		<span class="comment">//参数-1表示layoutparams填充满整个父容器</span></span><br><span class="line">        lp = new LayoutParams(<span class="number">-1</span>, <span class="number">-1</span>);</span><br><span class="line">		<span class="comment">//设置卡片之间有10像素的间隔</span></span><br><span class="line">        lp.setMargins(<span class="number">10</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        background.setBackgroundColor(<span class="number">0x33ffffff</span>);</span><br><span class="line">        addView(background, lp);</span><br><span class="line"></span><br><span class="line">        label = new TextView(getContext());</span><br><span class="line">        label.setTextSize(<span class="number">28</span>);</span><br><span class="line">        label.setGravity(Gravity.CENTER);</span><br><span class="line"></span><br><span class="line">        lp = new LayoutParams(<span class="number">-1</span>, <span class="number">-1</span>);</span><br><span class="line">        lp.setMargins(<span class="number">10</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        addView(label, lp);</span><br><span class="line"></span><br><span class="line">        setNum(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> n=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> getNum()&#123;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//设置数字及对应的背景颜色</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> setNum(<span class="built_in">int</span> n)&#123;</span><br><span class="line">        <span class="keyword">this</span>.n=n;</span><br><span class="line">        <span class="keyword">if</span>(n&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">            label.setText(<span class="string">""</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            label.setText(n+<span class="string">""</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">switch</span> (n) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                label.setBackgroundColor(<span class="number">0x00000000</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                label.setBackgroundColor(<span class="number">0xffeee4da</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">                label.setBackgroundColor(<span class="number">0xffede0c8</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">                label.setBackgroundColor(<span class="number">0xfff2b179</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">16</span>:</span><br><span class="line">                label.setBackgroundColor(<span class="number">0xfff59563</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">32</span>:</span><br><span class="line">                label.setBackgroundColor(<span class="number">0xfff67c5f</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">64</span>:</span><br><span class="line">                label.setBackgroundColor(<span class="number">0xfff65e3b</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">128</span>:</span><br><span class="line">                label.setBackgroundColor(<span class="number">0xffedcf72</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">256</span>:</span><br><span class="line">                label.setBackgroundColor(<span class="number">0xffedcc61</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">512</span>:</span><br><span class="line">                label.setBackgroundColor(<span class="number">0xffedc850</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1024</span>:</span><br><span class="line">                label.setBackgroundColor(<span class="number">0xffedc53f</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2048</span>:</span><br><span class="line">                label.setBackgroundColor(<span class="number">0xffedc22e</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                label.setBackgroundColor(<span class="number">0xff3c3a32</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//判断卡片是否相等</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span>ean equal(Card o)&#123;</span><br><span class="line">        <span class="keyword">return</span> getNum()==o.getNum();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> TextView label;</span><br><span class="line">&#125;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p> <img src="http://img.blog.csdn.net/20151031225217834?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""> <img src="http://img.blog.csdn.net/20151031225316437?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt=""></p>
      </p>
    </div>
  </div>
  <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-user"></i>
      </span>
      <span class="post-meta-item-text">作者</span>
      <span><a href="/authors/大龄锅" class="author" itemprop="url" rel="index">大龄锅</a></span>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      <time title="创建时间：2015-11-07 15:06:58" itemprop="dateCreated datePublished" datetime="2015-11-07T15:06:58+08:00">2015-11-07</time>
    </span>
    <span id="/2200.html" class="post-meta-item leancloud_visitors" data-flag-title="Android开发之2048安卓版" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>10k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>9 分钟</span>
    </span>
  </div>
</article>

    <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2188.html">
  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.png">
    <meta itemprop="name" content="崔庆才">
    <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  </span>
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="静觅">
  </span>
  <header class="post-header">
    <h2 class="post-title" itemprop="name headline">
      <a class="label"> Net <i class="label-arrow"></i>
      </a>
      <a href="/2188.html" class="post-title-link" itemprop="url">计算机网络探究三之搭建并连接VPN服务器</a>
    </h2>
  </header>
  <div class="post-body" itemprop="articleBody">
    <div class="thumb">
      <img itemprop="contentUrl" class="random">
    </div>
    <div class="excerpt">
      <p>
      <h2 id="openvpn-原理"><a href="#openvpn-原理" class="headerlink" title="openvpn 原理"></a>openvpn 原理</h2>
      <p>VPN 直译就是虚拟专用通道，是提供给企业之间或者个人与公司之间安全数据传输的隧道，OpenVPN 无疑是 Linux 下开源 VPN 的先锋，提供了良好的性能和友好的用户 GUI。 它大量使用了 OpenSSL 加密库中的 SSLv3/TLSv1 协议函数库。 目前 OpenVPN 能在 Solaris、Linux、OpenBSD、FreeBSD、NetBSD、Mac OS X 与 Microsoft Windows 以及 Android 和 iOS 上运行，并包含了许多安全性的功能。它并不是一个基于 Web 的 VPN 软件，也不与 IPsec 及其他 VPN 软件包兼容。 openvpn 通过使用公开密钥（非对称密钥，加密解密使用不同的 key，一个称为 Publice key，另外一个是 Private key）对数据进行加密的。这种方式称为 TLS 加密。 openvpn 使用 TLS 加密的工作过程是，首先 VPN Sevrver 端和 VPN Client 端要有相同的 CA 证书，双方通过交换证书验证双方的合法性，用于决定是否建立 VPN 连接。 然后使用对方的 CA 证书，把自己目前使用的数据加密方法加密后发送给对方，由于使用的是对方 CA 证书加密，所以只有对方 CA 证书对应的 Private key 才能解密该数据，这样就保证了此密钥的安全性，并且此密钥是定期改变的，对于窃听者来说，可能还没有破解出此密钥，VPN 通信双方可能就已经更换密钥了。 扩展阅读： <a href="http://baike.baidu.com/link?url=ssl8SkkfVHTcjm9UCzJ8AsJOhIHMYcxuIisO4pqyqaZF6llwP1r0fgLvYEmAg_zYhFWauFzfEyXmEmFcaprG2K" target="_blank" rel="noopener">openvpn</a></p>
      <h2 id="安装-openvpn"><a href="#安装-openvpn" class="headerlink" title="安装 openvpn"></a>安装 openvpn</h2>
      <p>首先，你需要有一台长期运行的服务器，大家可以用自己的闲置的电脑或者买一台阿里云啦。 我的服务器是 Ubuntu 14.04，下面就演示一下我的配置过程。 安装</p>
      <figure class="highlight q">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">sudo apt-<span class="built_in">get</span> -y install openvpn libssl-<span class="built_in">dev</span> openssl</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>查看下版本并记录下来</p>
      <figure class="highlight ada">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">openvpn <span class="comment">--version</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p><a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151030145358.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151030145358.jpg" alt="20151030145358"></a> 在这里我们的版本是 2.3.2</p>
      <h2 id="安装-easy-rsa"><a href="#安装-easy-rsa" class="headerlink" title="安装 easy-rsa"></a>安装 easy-rsa</h2>
      <p>easy-rsa 是用来制作 openvpn 相关证书的，使用如下命令安装</p>
      <figure class="highlight routeros">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">sudo apt-<span class="builtin-name">get</span> -y install easy-rsa</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>好，一切准备就绪后，我们就开始制作证书啦，我们需要制作的有三个证书 CA 证书、Server 端证书、Client 端证书。行动起来。</p>
      <h2 id="制作-CA-证书"><a href="#制作-CA-证书" class="headerlink" title="制作 CA 证书"></a>制作 CA 证书</h2>
      <p>openvpn 与 easy-rsa 安装完毕后，我们需要在/etc/openvpn/目录下创建 easy-rsa 文件夹，如下</p>
      <figure class="highlight awk">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">sudo mkdir <span class="regexp">/etc/</span>openvpn<span class="regexp">/easy-rsa/</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>然后把/usr/share/easy-rsa/目录下的所有文件全部复制到/etc/openvpn/easy-rsa/下</p>
      <figure class="highlight awk">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">sudo cp -r <span class="regexp">/usr/</span>share<span class="regexp">/easy-rsa/</span>* <span class="regexp">/etc/</span>openvpn<span class="regexp">/easy-rsa/</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>当然，我们也可以直接在/usr/share/easy-rsa/制作相关的证书，但是为了后续的管理证书的方便，我们还是把 easy-rsa 放在了 openvpn 的启动目录下。 <strong>注意：由于我们现在使用的是 ubuntu 系统，所以我们必须切换到 root 用户下才能制作相关证书，否则 easy-rsa 会报错。如果是 centos 系统，则不存在此问题。</strong> 切换到 root 用户下，使用如下命令：</p>
      <figure class="highlight ebnf">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="attribute">sudo su</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>在开始制作 CA 证书之前，我们还需要编辑 vars 文件，修改如下相关选项内容即可</p>
      <figure class="highlight awk">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">sudo vi <span class="regexp">/etc/</span>openvpn<span class="regexp">/easy-rsa/</span>vars</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <figure class="highlight routeros">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">KEY_COUNTRY</span>=<span class="string">"CN"</span></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">KEY_PROVINCE</span>=<span class="string">"SD"</span></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">KEY_CITY</span>=<span class="string">"JiNan"</span></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">KEY_ORG</span>=<span class="string">"germy"</span></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">KEY_EMAIL</span>=<span class="string">"cqc@cuiqingcai.com"</span></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">KEY_OU</span>=<span class="string">"germy"</span></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">KEY_NAME</span>=<span class="string">"germy"</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>如图所示 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151030150125.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151030150125.jpg" alt="20151030150125"></a> 之后，我们需要利用这个文件来制作我们的证书，保存一下。 然后一个很重要的一步，赋予权限，否则在制作证书的时候，值还是初始化的值。</p>
      <figure class="highlight awk">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">sudo chmod <span class="number">777</span> <span class="regexp">/etc/</span>openvpn<span class="regexp">/easy-rsa/</span>vars</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>vars 文件主要用于设置证书的相关组织信息，红色部分的内容可以根据自己的实际情况自行修改。 其中 export KEY_NAME=”germy” 这个要记住下，我们下面在制作 Server 端证书时，会使用到。 <strong>注意：以上内容，我们也可以使用系统默认的，也就是说不进行修改也是可以使用的。</strong> 然后使用 source vars 命令使其生效，如下：</p>
      <figure class="highlight vim">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="keyword">source</span> vars</span><br><span class="line">./clean-<span class="keyword">all</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>注意：执行 clean-all 命令会删除，当前目录下的 keys 文件夹。 现在开始正式制作 CA 证书，使用如下命令：</p>
      <figure class="highlight jboss-cli">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="keyword">cd</span> <span class="string">/etc/openvpn/easy-rsa/</span></span><br><span class="line"><span class="string">./build-ca</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>一路回车即可。 制作完成后，我们可以查看 keys 目录里有什么东西。 如果你的目录下出现了 ca.crt 和 ca.key 两个文件，其中 ca.crt 就是我们所说的 CA 证书。如此，CA 证书制作完毕。 现在把该 CA 证书的 ca.crt 文件复制到 openvpn 的启动目录/etc/openvpn 下，如下：</p>
      <figure class="highlight vim">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="keyword">cp</span> <span class="built_in">keys</span>/<span class="keyword">ca</span>.crt /etc/openvpn/</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <h2 id="制作-Server-端证书"><a href="#制作-Server-端证书" class="headerlink" title="制作 Server 端证书"></a>制作 Server 端证书</h2>
      <p>CA 证书制作完成后，我们现在开始制作 Server 端证书。如下：</p>
      <figure class="highlight n1ql">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">./<span class="keyword">build</span>-<span class="keyword">key</span>-server germy</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>上述命令中 germy，就是我们前面 vars 文件中设置的 KEY_NAME 查看 keys 目录 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151030150704.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151030150704.jpg" alt="20151030150704"></a> 如果可以发现出现了 germy.crt，germy.csr，germy.key 文件，就说明成功了。 现在再为服务器生成加密交换时的 Diffie-Hellman 文件，如下：</p>
      <figure class="highlight jboss-cli">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="string">./build-dh</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>你会发现目录下多了一个 dh2048.pem 文件。 以上操作完毕后，把 germy.crt，germy.key，dh2048.pem 复制到 /etc/openvpn/ 目录下，如下：</p>
      <figure class="highlight awk">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">cd <span class="regexp">/etc/</span>openvpn<span class="regexp">/easy-rsa/</span></span><br><span class="line">cp keys<span class="regexp">/germy.crt keys/g</span>ermy.key keys<span class="regexp">/dh2048.pem /</span>etc<span class="regexp">/openvpn/</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>如此，Server 端证书就制作完毕。</p>
      <h2 id="制作-Client-端证书"><a href="#制作-Client-端证书" class="headerlink" title="制作 Client 端证书"></a>制作 Client 端证书</h2>
      <p>Server 端证书制作完成后，我们现在开始制作 Client 端证书，如下：</p>
      <figure class="highlight n1ql">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">./<span class="keyword">build</span>-<span class="keyword">key</span> cqc</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>其中上述命令的 cqc 就是客户端证书名称，可以自定义 如果发现 keys 目录已经生成了 cqc.csr、cqc.crt 和 cqc.key 这个三个文件。其中 cqc.crt 和 cqc.key 两个文件是我们要使用的。 如此，Client 端证书就制作完毕。</p>
      <h2 id="配置-Server-端"><a href="#配置-Server-端" class="headerlink" title="配置 Server 端"></a>配置 Server 端</h2>
      <p>所有证书制作完毕后，我们现在开始配置 Server 端。Server 端的配置文件，我们可以从 openvpn 自带的模版中进行复制。如下：</p>
      <figure class="highlight awk">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">cp <span class="regexp">/usr/</span>share<span class="regexp">/doc/</span>openvpn<span class="regexp">/examples/</span>sample-config-files<span class="regexp">/server.conf.gz /</span>etc<span class="regexp">/openvpn/</span></span><br><span class="line">cd <span class="regexp">/etc/</span>openvpn<span class="regexp">/</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>解压 server.conf.gz 文件，使用如下命令：</p>
      <figure class="highlight css">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="selector-tag">gzip</span> <span class="selector-tag">-d</span> <span class="selector-tag">server</span><span class="selector-class">.conf</span><span class="selector-class">.gz</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>注意：上述命令的意思是解压 server.conf.gz 文件后，然后删除原文件。 现在我们来修改 server.conf 文件 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151030151728.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151030151728.jpg" alt="20151030151728"></a> 一共要修改 3 处文件 （1）修改了 openvpn 运行时使用的协议，由原来的 UDP 协议修改为 TCP 协议。生成环境建议使用 TCP 协议。 （2）修改了 openvpn 服务器的相关证书，由原来的 server.csr、server.key 修改为 germy.crt、germy.key。 （3）修改了 Diffie-Hellman 文件，由原来的 dh1024.pem 修改为 dh2048.pem。 配置文件修改完毕后，我们现在来启动 openvpn，使用如下命令：</p>
      <figure class="highlight awk">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="regexp">/etc/i</span>nit.d<span class="regexp">/openvpn start</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>至此，服务器端的 VPN 已经配置完毕了。</p>
      <h2 id="客户端的配置"><a href="#客户端的配置" class="headerlink" title="客户端的配置"></a>客户端的配置</h2>
      <p>服务器端配置好了，我们需要用另一台机器来连接，这里我们的客户端依然是 Ubuntu 14.04 首先我们需要从服务器上取到刚才生成的证书文件，那么我们需要的有什么呢？ <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151030152200.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151030152200.jpg" alt="20151030152200"></a> 首先这三个，ca.crt，cqc.crt，cqc.key 另外是一个模板，它是 /usr/share/doc/openvpn/examples/sample-config-files/client.conf 把这四个文件下载下来，然后放到客户端里。 比如我们保存到客户机的 home/user 文件夹下 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151030152421.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151030152421.jpg" alt="20151030152421"></a> 把 client.conf 文件重命名为 client.ovpn 然后修改下面 4 处</p>
      <figure class="highlight css">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="selector-tag">proto</span> <span class="selector-tag">tcp</span></span><br><span class="line"><span class="selector-tag">remote</span> 121<span class="selector-class">.42</span><span class="selector-class">.14</span><span class="selector-class">.158</span> 1194</span><br><span class="line"><span class="selector-tag">ca</span> <span class="selector-tag">ca</span><span class="selector-class">.crt</span></span><br><span class="line"><span class="selector-tag">cert</span> <span class="selector-tag">cqc</span><span class="selector-class">.crt</span></span><br><span class="line"><span class="selector-tag">key</span> <span class="selector-tag">cqc</span><span class="selector-class">.key</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>其中 remote 就是你的服务器地址 配置好了之后，我们运行</p>
      <figure class="highlight ada">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">sudo openvpn <span class="comment">--config client.ovpn</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>如果最后的结果是 Sequence Completed 那就证明连接成功啦。 输入</p>
      <figure class="highlight ebnf">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="attribute">ifconfig</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>你会发现多了一个 tun0 适配器，这就是 openvpn 的适配器。 至此，openvpn 的配置和连接就全部完成啦。</p>
      <h2 id="参考来源"><a href="#参考来源" class="headerlink" title="参考来源"></a>参考来源</h2>
      <p><a href="http://www.myhack58.com/Article/sort099/sort0102/2015/65155_4.htm" target="_blank" rel="noopener">参考文献</a> 如有问题，欢迎留言交流。</p>
      </p>
    </div>
  </div>
  <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-user"></i>
      </span>
      <span class="post-meta-item-text">作者</span>
      <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      <time title="创建时间：2015-10-30 15:33:28" itemprop="dateCreated datePublished" datetime="2015-10-30T15:33:28+08:00">2015-10-30</time>
    </span>
    <span id="/2188.html" class="post-meta-item leancloud_visitors" data-flag-title="计算机网络探究三之搭建并连接VPN服务器" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.7k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
  </div>
</article>

    <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2185.html">
  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.png">
    <meta itemprop="name" content="崔庆才">
    <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  </span>
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="静觅">
  </span>
  <header class="post-header">
    <h2 class="post-title" itemprop="name headline">
      <a class="label"> HTML <i class="label-arrow"></i>
      </a>
      <a href="/2185.html" class="post-title-link" itemprop="url">HTML5中Device Orientation的特性</a>
    </h2>
  </header>
  <div class="post-body" itemprop="articleBody">
    <div class="thumb">
      <img itemprop="contentUrl" class="random">
    </div>
    <div class="excerpt">
      <p>
      <p>HTML5中包含一个帮助检测device orientation的特性，使用这个特性可以在移动设备浏览器中判断用户设备的旋转重力方向。</p>
      <h2 id="基本知识"><a href="#基本知识" class="headerlink" title="基本知识"></a>基本知识</h2>
      <p>Alpha, Beta, Gamma角度旋转。 当用户旋转手机的时候，HTML5中定义了三个轴方向的旋转，如下： <a href="http://www.gbtags.com/gb/networks/uploadimg/48ca06d6-fef5-4c18-9379-a49b6b9db3af.png" target="_blank" rel="noopener"><img src="http://www.gbtags.com/gb/networks/uploadimgthumb/48ca06d6-fef5-4c18-9379-a49b6b9db3af.png" alt=""></a> 上图可以看考，分别是z，x，y轴，对应分别是：Alpha，Beta，Gamma，下面图将更清楚的展示： <a href="http://www.gbtags.com/gb/networks/uploadimg/13a73e08-da9a-47a0-be1d-9d8dea6c2f98.png" target="_blank" rel="noopener"><img src="http://www.gbtags.com/gb/networks/uploadimgthumb/13a73e08-da9a-47a0-be1d-9d8dea6c2f98.png" alt=""></a> 上图是Alpha旋转，　围绕Z轴旋转（绿线旋转方向，水平） <img src="http://www.gbtags.com/gb/networks/uploadimgthumb/3803a433-29b7-48e8-8abe-b9c48270047c.png" alt=""> 上图是Beta旋转，　围绕X轴旋转（绿线旋转方向，前后） <img src="http://www.gbtags.com/gb/networks/uploadimgthumb/cbb478f5-4490-48f1-af44-0b9e73844057.png" alt=""> 上图是Beta旋转，　围绕Y轴旋转（绿线旋转方向，左右）</p>
      <h2 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h2>
      <ul>
        <li>alpha: <em>(float 类型 )</em>以z方向为轴心的旋转角度 浮点数类型，只读属性，取值范围为0到360（不等于360）。</li>
        <li>beta: <em>(float 类型 )</em>以x方向为轴心的旋转角度 浮点数类型，只读属性，取值范围为-180到180（不等于180）。</li>
        <li>gamma: <em>(float 类型 )</em>以y方向为轴心的旋转角度 浮点数类型，只读属性，取值范围为-180到180（不等于180）。</li>
      </ul>
      <h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2>
      <p><a href="http://www.gbtags.com/gb/share/4247.htm" target="_blank" rel="noopener">原文链接</a></p>
      </p>
    </div>
  </div>
  <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-user"></i>
      </span>
      <span class="post-meta-item-text">作者</span>
      <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      <time title="创建时间：2015-10-28 19:24:09" itemprop="dateCreated datePublished" datetime="2015-10-28T19:24:09+08:00">2015-10-28</time>
    </span>
    <span id="/2185.html" class="post-meta-item leancloud_visitors" data-flag-title="HTML5中Device Orientation的特性" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>440</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
  </div>
</article>

    <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2138.html">
  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.png">
    <meta itemprop="name" content="崔庆才">
    <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  </span>
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="静觅">
  </span>
  <header class="post-header">
    <h2 class="post-title" itemprop="name headline">
      <a class="label"> Net <i class="label-arrow"></i>
      </a>
      <a href="/2138.html" class="post-title-link" itemprop="url">计算机网络探究二之利用PHP实现登录验证之后上网</a>
    </h2>
  </header>
  <div class="post-body" itemprop="articleBody">
    <div class="thumb">
      <img itemprop="contentUrl" class="random">
    </div>
    <div class="excerpt">
      <p>
      <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
      <p>在上一篇文章中，客户机可以借助路由机直接上网，并没有什么登录限制。接下来我们将加入上网登录验证，只有输入了正确的用户名和密码才可以通过验证，然后才可以访问互联网。 接下来，就跟随我用 PHP 来实现登录验证吧。</p>
      <h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2>
      <p>在这之前，你需要配置一下 LAMP 环境，也就是 Apache，MySQL，PHP 开发环境，依次执行如下命令即可。</p>
      <figure class="highlight smali">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">sudo apt-get install apache2</span><br><span class="line">sudo apt-get install php5 php5-cgi php5-mysql php5-curl php5-gd php5-idn php-pear php5-imagick php5-imap php5-mcrypt php5-memcache php5-mhash php5-ming php5-pspell php5-recode php5-snmp php5-tidy php5-xmlrpc php5-sqlite php5-xsl</span><br><span class="line">sudo apt-get install mysql-server mysql-client</span><br><span class="line">sudo apt-get install libapache2-mod-php5</span><br><span class="line">sudo apt-get install libapache2-mod-auth-mysql</span><br><span class="line">sudo apt-get install phpmyadmin</span><br><span class="line">sudo ln -s /usr/share/phpmyadmin/ /var/www/html/phpmyadmin</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>如果配置出现问题，请查阅相关资料。 apache 默认的目录为 /var/www/html，我们这时访问 <a href="http://localhost" target="_blank" rel="noopener">localhost</a> 或者 <a href="http://192.168.122.4" target="_blank" rel="noopener">192.168.122.4</a>，都可以出现 apache 的欢迎界面，就证明我们配置成功了。</p>
      <h2 id="路由初始设置"><a href="#路由初始设置" class="headerlink" title="路由初始设置"></a>路由初始设置</h2>
      <p>为了在登录之前限制主机的上网，我们需要利用 iptables 规则来对数据包的转发加以限制。同时，将网页重定向到本机的登录界面。 初始路由设置如下</p>
      <figure class="highlight routeros">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">iptables -F</span><br><span class="line">iptables -t<span class="built_in"> nat </span>-F</span><br><span class="line">iptables -t<span class="built_in"> mangle </span>-F</span><br><span class="line">iptables -P INPUT ACCEPT</span><br><span class="line">iptables -P FORWARD ACCEPT</span><br><span class="line">iptables -t<span class="built_in"> nat </span>-A POSTROUTING -o eth0 -j MASQUERADE</span><br><span class="line">iptables -t<span class="built_in"> filter </span>-A FORWARD -s 192.168.122.0/24 -o eth0 -j REJECT</span><br><span class="line">iptables -t<span class="built_in"> filter </span>-A FORWARD -s 192.168.122.0/24 -d 119.29.29.29/32 -j ACCEPT</span><br><span class="line">iptables -t<span class="built_in"> nat </span>-A PREROUTING -s 192.168.122.0/24 -p tcp -j DNAT --to 192.168.122.4</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>首先清除所有的 iptables 规则，然后设置前一篇我们说的 IP 伪装，这时可以客户机可以通过主机上网。 接下来的一条规则则禁用了来自 192.168.122.0 网段的所有 IP 的数据包转发，然后设置可访问 DNS 服务器，最后一条则设置了所有的 tcp 连接自动跳转到 192.168.122.4，也就是我们刚才配置的服务器。 可以把以上规则保存为脚本，比如叫 init.sh 来运行，也可以添加到 /etc/rc.local 中，开机自动运行。</p>
      <h2 id="登录页面"><a href="#登录页面" class="headerlink" title="登录页面"></a>登录页面</h2>
      <p>访问到 192.168.122.4 时，我们需要给用户呈现的当然不是刚才显示的 apache 欢迎页面，而是登录的输入框以及登录按钮界面。 所以，登录界面代码如下</p>
      <figure class="highlight xml">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"zh-CN"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Auth Login<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Bootstrap --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"css/bootstrap.min.css"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"auth"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"input-group"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"input-group-addon"</span> <span class="attr">id</span>=<span class="string">"basic-addon1"</span>&gt;</span>Username<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"Username"</span> <span class="attr">aria-describedby</span>=<span class="string">"basic-addon1"</span> <span class="attr">name</span>=<span class="string">"username"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"input-group"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"input-group-addon"</span> <span class="attr">id</span>=<span class="string">"basic-addon1"</span>&gt;</span>Password<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"Password"</span> <span class="attr">aria-describedby</span>=<span class="string">"basic-addon1"</span> <span class="attr">name</span>=<span class="string">"password"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"login"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span> <span class="attr">value</span>=<span class="string">"Login"</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">id</span>=<span class="string">"logout"</span> <span class="attr">class</span>=<span class="string">"btn btn-primary"</span> <span class="attr">value</span>=<span class="string">"Logout"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- jQuery (necessary for Bootstrap's JavaScript plugins) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Include all compiled plugins (below), or include individual files as needed --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/bootstrap.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">    form &#123;</span><br><span class="line"><span class="css">      <span class="selector-tag">max-width</span><span class="selector-pseudo">:400px</span>;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">margin</span><span class="selector-pseudo">:0</span> <span class="selector-tag">auto</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="css">    <span class="selector-class">.input-group</span> &#123;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">margin-bottom</span><span class="selector-pseudo">:20px</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">	$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">		$(<span class="string">"#login"</span>).on(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">			$(<span class="string">"#auth"</span>).attr(<span class="string">"action"</span>, <span class="string">"/login.php"</span>);</span></span><br><span class="line"><span class="javascript">			$(<span class="string">"#auth"</span>).submit();</span></span><br><span class="line">		&#125;);</span><br><span class="line"><span class="javascript">		$(<span class="string">"#logout"</span>).on(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">			$(<span class="string">"#auth"</span>).attr(<span class="string">"action"</span>, <span class="string">"/logout.php"</span>);</span></span><br><span class="line"><span class="javascript">			$(<span class="string">"#auth"</span>).submit();</span></span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>其中的 js，jquery 文件请大家自行引入。 预览一下效果 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151008151728.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151008151728.png" alt="20151008151728"></a> 在这里我们设置了两个按钮，一个是登录，一个是下线。</p>
      <h2 id="数据库查询验证"><a href="#数据库查询验证" class="headerlink" title="数据库查询验证"></a>数据库查询验证</h2>
      <p>接下来我们新建一个数据库，例如我新建了一个数据库叫 auth，然后数据表 user，里面有三个字段。分别是 id，username，password，我插入了一条数据。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151008152059.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151008152059.png" alt="20151008152059"></a> 接下来我们就尝试一下登录，提交到 login.php 文件验证一下。</p>
      <figure class="highlight xml">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">	$mysql_server_name = <span class="string">"localhost"</span>;</span></span><br><span class="line"><span class="php">	$mysql_username = <span class="string">"root"</span>;</span></span><br><span class="line"><span class="php">	$mysql_password = <span class="string">"123456"</span>;</span></span><br><span class="line"><span class="php">	$mysql_database = <span class="string">"auth"</span>;</span></span><br><span class="line"><span class="php">	$username = @$_POST[<span class="string">'username'</span>];</span></span><br><span class="line"><span class="php">	$password = @$_POST[<span class="string">'password'</span>];</span></span><br><span class="line"><span class="php">	$ip=$_SERVER[<span class="string">"REMOTE_ADDR"</span>];</span></span><br><span class="line"><span class="php">	$conn=mysql_connect($mysql_server_name, $mysql_username,</span></span><br><span class="line"><span class="php">                        $mysql_password);</span></span><br><span class="line"><span class="php">	<span class="keyword">if</span> ($conn) &#123;</span></span><br><span class="line"><span class="php">		$sql = <span class="string">"select * from user where username = '"</span>.$username.<span class="string">"'"</span>;</span></span><br><span class="line"><span class="php">		$result = mysql_fetch_array(mysql_db_query($mysql_database, $sql, $conn));</span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> ($result) &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">if</span> ($result[<span class="string">'password'</span>] == $password) &#123;</span></span><br><span class="line"><span class="php">				$status = <span class="number">-1</span>;</span></span><br><span class="line"><span class="php">				system(<span class="string">"sudo ./bash/login.sh $ip"</span>, $status);</span></span><br><span class="line"><span class="php">				<span class="keyword">if</span> ($status == <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="php">					<span class="keyword">echo</span> <span class="string">"Login Successfully"</span>;</span></span><br><span class="line"><span class="php">				&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">					<span class="keyword">echo</span> <span class="string">"Login Failed"</span>;</span></span><br><span class="line"><span class="php">				&#125;</span></span><br><span class="line"><span class="php">			&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">				<span class="keyword">echo</span> <span class="string">"Wrong Password"</span>;</span></span><br><span class="line"><span class="php">			&#125;</span></span><br><span class="line"><span class="php">		&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">echo</span> <span class="string">"Not"</span>;</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">	&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">die</span>(<span class="string">"Could Not Connect"</span>);</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>其中，最重要的部分莫过于</p>
      <figure class="highlight perl">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="keyword">system</span>(<span class="string">"sudo ./bash/login.sh $ip"</span>, $status);</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>这一行代码了，此处便是登录验证用户名和密码之后执行的一个 Linux 脚本命令。 在这里我把要执行的脚本写入了 login.sh 文件中，传入的参数便是 ip 地址。 那么 login.sh 里面发生了什么事情呢，我们来看一下。</p>
      <figure class="highlight routeros">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">iptables -t<span class="built_in"> nat </span>-D PREROUTING -s <span class="variable">$1</span>/32 -j ACCEPT</span><br><span class="line">iptables -t<span class="built_in"> nat </span>-D PREROUTING -s <span class="variable">$1</span>/32 -p tcp -j ACCEPT</span><br><span class="line">iptables -t<span class="built_in"> filter </span>-D FORWARD -s <span class="variable">$1</span>/32 -o eth0 -j ACCEPT</span><br><span class="line">iptables -t<span class="built_in"> nat </span>-I PREROUTING -s <span class="variable">$1</span>/32 -j ACCEPT</span><br><span class="line">iptables -t<span class="built_in"> nat </span>-I PREROUTING -s <span class="variable">$1</span>/32 -p tcp -j ACCEPT</span><br><span class="line">iptables -t<span class="built_in"> filter </span>-I FORWARD -s <span class="variable">$1</span>/32 -o eth0 -j ACCEPT</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>$1 的意思就是获取第一个参数，在这里就是 IP 地址，脚本主要做的事情就是放行来自这个 IP 地址的数据包，让其正常访问互联网。 保存脚本后，记得给脚本赋予权限</p>
      <figure class="highlight angelscript">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">sudo chmod <span class="number">777</span> login.sh</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>-D 的意思就是删除，因为 iptables 是可以添加多次相同的规则的，在添加之前删除一下，以防止多次添加。 在这里</p>
      <figure class="highlight armasm">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="symbol">sudo</span> ./<span class="keyword">bash/login.sh </span>$<span class="built_in">ip</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>执行命令脚本前，我们加了 sudo，意思就是管理员身份运行，但是仍然可能导致权限问题，因为命令的执行者是 PHP（其实是 www-data），而并不是 root 用户，所以我们需要修改一下执行权限。 首先通过 PHP 文件获取执行该命令的用户是叫什么，比如新建一个 info.php 文件，输入如下内容：</p>
      <figure class="highlight xml">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">    <span class="keyword">echo</span> shell_exec(<span class="string">"id -a"</span>);</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>看一下运行结果 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151008153424.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151008153424.png" alt="20151008153424"></a> 嗯，果然，执行用户是 www-data，这样我们只需要给 www-data 添加一个执行权限就好了。 修改 /etc/sudoers 文件 添加一行</p>
      <figure class="highlight fortran">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">www-<span class="keyword">data</span> <span class="built_in">ALL</span>=(<span class="built_in">ALL</span>) NOPASSWD:<span class="built_in">ALL</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>意思是 www-data 以 root 身份运行并且不需要密码。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151008153700.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151008153700.png" alt="20151008153700"></a> 好，保存之后，我们尝试一下，就可以登录啦。</p>
      <h2 id="测试登录"><a href="#测试登录" class="headerlink" title="测试登录"></a>测试登录</h2>
      <p>在路由主机（Ubuntu Route）里面，初始化一下 iptables 规则，然后查看当前规则。 我们发现当前访问都是被阻止的，而且 tcp 连接会自动跳转到 192.168.122.4 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151008154216.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151008154216.png" alt="20151008154216"></a> 现在我们登录客户机，随机打开一个网址，比如百度，就发现自动跳转到了登录界面 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151008154629.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151008154629.png" alt="20151008154629"></a> 输入用户名密码，尝试登陆，比如之前插入数据库的是 cqc，123456，输入之后登录。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151008162712.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151008162712.png" alt="20151008162712"></a> 提示登录成功之后，我们便可以欢乐地上网啦。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151008162926.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151008162926.png" alt="20151008162926"></a> 好，这样我们就完成了验证之后上网啦。</p>
      <h2 id="下线操作"><a href="#下线操作" class="headerlink" title="下线操作"></a>下线操作</h2>
      <p>同样的，下线操作我们同样写一个 logout.php</p>
      <figure class="highlight xml">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">	$mysql_server_name = <span class="string">"localhost"</span>;</span></span><br><span class="line"><span class="php">	$mysql_username = <span class="string">"root"</span>;</span></span><br><span class="line"><span class="php">	$mysql_password = <span class="string">"123456"</span>;</span></span><br><span class="line"><span class="php">	$mysql_database = <span class="string">"auth"</span>;</span></span><br><span class="line"><span class="php">	$username = @$_POST[<span class="string">'username'</span>];</span></span><br><span class="line"><span class="php">	$password = @$_POST[<span class="string">'password'</span>];</span></span><br><span class="line"><span class="php">	$ip=$_SERVER[<span class="string">"REMOTE_ADDR"</span>];</span></span><br><span class="line"><span class="php">	<span class="keyword">echo</span> $ip;</span></span><br><span class="line"><span class="php">	$conn=mysql_connect($mysql_server_name, $mysql_username,</span></span><br><span class="line"><span class="php">                        $mysql_password);</span></span><br><span class="line"><span class="php">	<span class="keyword">if</span> ($conn) &#123;</span></span><br><span class="line"><span class="php">		$sql = <span class="string">"select * from user where username = '"</span>.$username.<span class="string">"'"</span>;</span></span><br><span class="line"><span class="php">		$result = mysql_fetch_array(mysql_db_query($mysql_database, $sql, $conn));</span></span><br><span class="line"><span class="php">		<span class="keyword">if</span> ($result) &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">if</span> ($result[<span class="string">'password'</span>] == $password) &#123;</span></span><br><span class="line"><span class="php">				$status = <span class="number">-1</span>;</span></span><br><span class="line"><span class="php">				system(<span class="string">"sudo ./bash/logout.sh $ip"</span>, $status);</span></span><br><span class="line"><span class="php">				<span class="keyword">if</span> ($status == <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="php">					<span class="keyword">echo</span> <span class="string">"Login Successfully"</span>;</span></span><br><span class="line"><span class="php">				&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">					<span class="keyword">echo</span> <span class="string">"Login Failed"</span>;</span></span><br><span class="line"><span class="php">				&#125;</span></span><br><span class="line"><span class="php">			&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">				<span class="keyword">echo</span> <span class="string">"Wrong Password"</span>;</span></span><br><span class="line"><span class="php">			&#125;</span></span><br><span class="line"><span class="php">		&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">echo</span> <span class="string">"Not"</span>;</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">	&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">die</span>(<span class="string">"Could Not Connect"</span>);</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>登出的脚本如下，其实就是单纯去除了刚才添加的路由规则</p>
      <figure class="highlight routeros">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">iptables -t<span class="built_in"> nat </span>-D PREROUTING -s <span class="variable">$1</span>/32 -j ACCEPT</span><br><span class="line">iptables -t<span class="built_in"> nat </span>-D PREROUTING -s <span class="variable">$1</span>/32 -p tcp -j ACCEPT</span><br><span class="line">iptables -t<span class="built_in"> filter </span>-D FORWARD -s <span class="variable">$1</span>/32 -o eth0 -j ACCEPT</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>配置方式和登录一样，大家可以尝试下。</p>
      <h2 id="源代码"><a href="#源代码" class="headerlink" title="源代码"></a>源代码</h2>
      <p>在这里提供大家源代码下载 <a href="https://github.com/cqcre/PHPLogin" target="_blank" rel="noopener">源码下载</a> 如有问题，欢迎交流。</p>
      </p>
    </div>
  </div>
  <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-user"></i>
      </span>
      <span class="post-meta-item-text">作者</span>
      <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      <time title="创建时间：2015-10-08 00:27:44" itemprop="dateCreated datePublished" datetime="2015-10-08T00:27:44+08:00">2015-10-08</time>
    </span>
    <span id="/2138.html" class="post-meta-item leancloud_visitors" data-flag-title="计算机网络探究二之利用PHP实现登录验证之后上网" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>6.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>6 分钟</span>
    </span>
  </div>
</article>

    <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2126.html">
  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.png">
    <meta itemprop="name" content="崔庆才">
    <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  </span>
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="静觅">
  </span>
  <header class="post-header">
    <h2 class="post-title" itemprop="name headline">
      <a class="label"> Net <i class="label-arrow"></i>
      </a>
      <a href="/2126.html" class="post-title-link" itemprop="url">计算机网络探究一之利用双网卡主机共享上网</a>
    </h2>
  </header>
  <div class="post-body" itemprop="articleBody">
    <div class="thumb">
      <img itemprop="contentUrl" class="random">
    </div>
    <div class="excerpt">
      <p>
      <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
      <p>大家好，这次我们需要实现的是实现双网卡主机共享上网，就是一台主机通过连接另一台可以访问外网的双网卡主机来正常上网。所以我们需要两台机器来进行测试，在这里我们用的是两台 Ubuntu 14.04，其中一台是单网卡，一台是双网卡。废话不多说，行动起来吧。</p>
      <h2 id="配置系统"><a href="#配置系统" class="headerlink" title="配置系统"></a>配置系统</h2>
      <p>博主使用了 Vmware 来安装了两台 Ubuntu 主机，一台当路由机，名称是 Ubuntu Route，另一台是客户机，名称是 Ubuntu Desktop，具体的网络配置如下： Ubuntu Route： 一个网卡 eth0 通过 NAT 方式来与外部主机共享上网，这个网卡也就是 VMnet8 网卡，网段是 192.168.231.0 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151007164043.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151007164043.png" alt="20151007164043"></a> 另一个网卡 eth1 连接了一个自定义的仅主机模式的网卡 VMnet2，网段是 192.168.122.0 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151007164114.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151007164114.png" alt="20151007164114"></a> 网络适配器设置如下，eth0 开启了 DHCP，ech1 没有开启 DHCP <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151007164343.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151007164343.png" alt="20151007164343"></a> Ubuntu Desktop： 一个网卡 eth0 连接刚才那个自定义的仅主机模式的网卡 VMnet2，网段是 192.168.122.0 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151007164821.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151007164821.png" alt="20151007164821"></a> 好了，以上就是基本硬件的配置</p>
      <h2 id="设置-IP"><a href="#设置-IP" class="headerlink" title="设置 IP"></a>设置 IP</h2>
      <p>接下来我们设置一下 Ubuntu Route 的 IP 地址，修改 /etc/network/interfaces</p>
      <figure class="highlight routeros">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">auto lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line">auto eth0</span><br><span class="line">iface eth0 inet dhcp</span><br><span class="line">auto eth1</span><br><span class="line">iface eth1 inet static</span><br><span class="line">address 192.168.122.4</span><br><span class="line">netmask 255.255.255.0</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>在这里，eth0 因为我们在 VMware 里面设置了 DHCP，所以这里我们设置 dhcp 即可，eth1 需要手动配置一下，我们分配了 192.168.122.4 这个 IP 地址，当然你可以随意指定，子网掩码如上，不需要写网关，因为它本身作为一个路由。 可以通过执行如下命令来使之生效</p>
      <figure class="highlight awk">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">sudo <span class="regexp">/etc/i</span>nit.d<span class="regexp">/networking restart</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>如果上述方法不行，则可以尝试使用关闭网卡和开启网卡的命令。</p>
      <figure class="highlight properties">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="attr">sudo</span> <span class="string">ifup eth0</span></span><br><span class="line"><span class="attr">sudo</span> <span class="string">ifdown eth0</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>eth1 的开启和关闭同上</p>
      <h2 id="开启路由转发"><a href="#开启路由转发" class="headerlink" title="开启路由转发"></a>开启路由转发</h2>
      <p>修改 /etc/sysctl.conf 文件，将</p>
      <figure class="highlight ini">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="attr">net.ipv4.ip_forward</span>=<span class="number">1</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>这一行取消注释，代表开启了路由转发功能。 也可以通过执行</p>
      <figure class="highlight awk">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">echo <span class="number">1</span> &gt; <span class="regexp">/proc/</span>sys<span class="regexp">/net/i</span>pv4<span class="regexp">/ip_forward</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>命令来实现</p>
      <h2 id="设置-iptables-规则"><a href="#设置-iptables-规则" class="headerlink" title="设置 iptables 规则"></a>设置 iptables 规则</h2>
      <p>iptables 是非常重要的一个环节，如果大家不熟悉，可以去搜相关资料了解一下。 执行如下命令，来设置一下 iptables 规则，可以直接在命令行逐条执行，也可以写成一个脚本来执行。</p>
      <figure class="highlight routeros">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">iptables -F</span><br><span class="line">iptables -t<span class="built_in"> nat </span>-F</span><br><span class="line">iptables -t<span class="built_in"> mangle </span>-F</span><br><span class="line">iptables -P INPUT ACCEPT</span><br><span class="line">iptables -P FORWARD ACCEPT</span><br><span class="line">iptables -t<span class="built_in"> nat </span>-A POSTROUTING -o eth0 -j MASQUERADE</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>其中最后一条是最重要的，代表将数据包通过 eth0 网卡来转发，也是 IP 伪装的一个常用方法，有了这条指令，从 eth1 网卡流经的一些数据包可以通过 eth0 来转发，这样就相当于连通了两个网卡，这样与 eth1 网卡连接的主机便可以上网了。</p>
      <h2 id="客户主机设置"><a href="#客户主机设置" class="headerlink" title="客户主机设置"></a>客户主机设置</h2>
      <p>因为客户机的 eth0 连接了 VMnet2 网卡，而 VMnet2 网卡又与路由主机的 eth1 连接，我们只需要简单设置一下 IP 地址就好了。 修改 /etc/network/interfaces</p>
      <figure class="highlight angelscript">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="built_in">auto</span> eth0</span><br><span class="line">iface eth0 inet static</span><br><span class="line">address <span class="number">192.168</span><span class="number">.122</span><span class="number">.5</span></span><br><span class="line">netmask <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">gateway <span class="number">192.168</span><span class="number">.122</span><span class="number">.4</span></span><br><span class="line">dns-nameservers <span class="number">119.29</span><span class="number">.29</span><span class="number">.29</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>这里很重要的一个设置就是网关，设置成路由主机的 IP 地址。 设置完了同样重启一下网卡使其生效。 还可以选择性设置下 DNS 服务器。 至此，所有配置都完成了，测试一下吧。</p>
      <h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2>
      <p>我们在客户机里打开浏览器，输入随意一个网页测试一下。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151007172000.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151007172000.png" alt="20151007172000"></a> 嗯，客户机可以正常上网啦，一切都是那么轻松加愉快！ 如有问题，欢迎留言交流~</p>
      </p>
    </div>
  </div>
  <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-user"></i>
      </span>
      <span class="post-meta-item-text">作者</span>
      <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      <time title="创建时间：2015-10-07 17:23:37" itemprop="dateCreated datePublished" datetime="2015-10-07T17:23:37+08:00">2015-10-07</time>
    </span>
    <span id="/2126.html" class="post-meta-item leancloud_visitors" data-flag-title="计算机网络探究一之利用双网卡主机共享上网" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.7k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
  </div>
</article>

    <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2083.html">
  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.png">
    <meta itemprop="name" content="崔庆才">
    <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  </span>
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="静觅">
  </span>
  <header class="post-header">
    <h2 class="post-title" itemprop="name headline">
      <a class="label"> Python <i class="label-arrow"></i>
      </a>
      <a href="/2083.html" class="post-title-link" itemprop="url">Python爬虫实战三之实现山东大学无线网络掉线自动重连</a>
    </h2>
  </header>
  <div class="post-body" itemprop="articleBody">
    <div class="thumb">
      <img itemprop="contentUrl" class="random">
    </div>
    <div class="excerpt">
      <p>
      <h2 id="2022-年最新-Python3-网络爬虫教程"><a href="#2022-年最新-Python3-网络爬虫教程" class="headerlink" title="2022 年最新 Python3 网络爬虫教程"></a>2022 年最新 Python3 网络爬虫教程</h2>
      <p>大家好，我是崔庆才，由于爬虫技术不断迭代升级，一些旧的教程已经过时、案例已经过期，最前沿的爬虫技术比如异步、JavaScript 逆向、安卓逆向、智能解析、WebAssembly、大规模分布式、Kubernetes 等技术层出不穷，我最近新出了一套最新最全面的 Python3 网络爬虫系列教程。</p>
      <blockquote>
        <p>博主自荐：截止 2022 年，可以将最前沿最全面的爬虫技术都涵盖的教程，如异步、JavaScript 逆向、安卓逆向、智能解析、WebAssembly、大规模分布式、Kubernetes 等，市面上目前就这一套了。</p>
      </blockquote>
      <p>最新教程对旧的爬虫技术内容进行了全面更新，搭建了全新的案例平台进行全面讲解，保证案例稳定有效不过期。</p>
      <p>教程请移步：</p>
      <p><a href="https://cuiqingcai.com/17777.html">【2022 版】Python3 网络爬虫学习教程</a></p>
      <p>如下为原文。</p>
      <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
      <p>最近山大软件园校区 QLSC_STU 无线网掉线掉的厉害，连上之后平均十分钟左右掉线一次，很是让人心烦，还能不能愉快地上自习了？能忍吗？反正我是不能忍了，嗯，自己动手，丰衣足食！写个程序解决掉它！ 假若你不能连这个无线，那就照照思路啦～</p>
      <h2 id="决战前夕"><a href="#决战前夕" class="headerlink" title="决战前夕"></a>决战前夕</h2>
      <p>首先我们看一下那个验证页面是咋样滴，上个图先 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150920192557.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150920192557.png" alt="20150920192557"></a> 嘿，这界面还算可以把，需要我们输入的东西就是俩，一个就是学号，另一个是身份证号后六位，然后就可以登录，享受免费的无线网啦。 不过不知道谁设置了个登录时长，一段时间后就会掉线了，于是，自动模拟登陆系统就要应运而生啦。 来，我们先点击一下连接，看一下浏览器怎么工作的。 按下 F12，监听网络，我们点击第一个响应，也就是 login.jsp，看一下。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150920192957.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150920192957-1024x661.png" alt="20150920192957"></a> 我们具体看一下 headers，里面 form 提交了什么东西，真的是茫茫多的数据啊。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150920193146.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150920193146.png" alt="20150920193146"></a> 嗯，一目了然 POST 的数据和提交的地址。 让我们来分析几个数据吧：</p>
      <blockquote>
        <p>ClientIP：当前客户端的 IP 地址，在山大软件园校区这个地址是 211.87 开头的</p>
        <p>timeoutvalue：连接等待时间，也就是俗话说的 timeout</p>
        <p>StartTime：登录时间，也就是在你登录的那一刻的时间戳，这个时间戳是 13 位的，精确到了毫秒，不过一般是 10 位的，我们加 3 个 0 就好了</p>
        <p>shkOvertime：登录持续时间，这个数据默认是 720，也就是 12 分钟之后，登录就失效了，自动掉线，我们可以手动更改</p>
        <p>username：学号</p>
        <p>password：密码，也就是我们身份证号后六位</p>
      </blockquote>
      <p>我们需要在登录的时候把 form 表单中的所有信息都 POST 一下，然后就可以完成登录啦。 万事俱备，只欠东风，来来来，程序写起来！</p>
      <h2 id="一触即发"><a href="#一触即发" class="headerlink" title="一触即发"></a>一触即发</h2>
      <p>说走咱就走啊，天上的星星参北斗啊！ 登陆地址：Request URL:<a href="http://192.168.8.10/portal/login.jsp?Flag=0" target="_blank" rel="noopener">http://192.168.8.10/portal/login.jsp?Flag=0</a> 首先，我们需要验证一下 IP 地址，先写一个获取 IP 地址的函数，首先判断当前 IP 是不是 211.87 开头的，如果是的话，证明连接的 IP 是有效的。 首先我们写一个获取本机 IP 的方法：</p>
      <figure class="highlight properties">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="meta">self.ip_pre</span> = <span class="string">"211.87"</span></span><br><span class="line"><span class="comment">#获取本机无线IP</span></span><br><span class="line">    <span class="attr">def</span> <span class="string">getIP(self):</span></span><br><span class="line">        <span class="attr">local_iP</span> = <span class="string">socket.gethostbyname(socket.gethostname())</span></span><br><span class="line">        <span class="attr">if</span> <span class="string">self.ip_pre in str(local_iP):</span></span><br><span class="line">            <span class="attr">return</span> <span class="string">str(local_iP)</span></span><br><span class="line">        <span class="attr">ip_lists</span> = <span class="string">socket.gethostbyname_ex(socket.gethostname())</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">for</span> <span class="string">ip_list in ip_lists:</span></span><br><span class="line">            <span class="attr">if</span> <span class="string">isinstance(ip_list, list):</span></span><br><span class="line">                <span class="attr">for</span> <span class="string">i in ip_list:</span></span><br><span class="line">                    <span class="attr">if</span> <span class="string">self.ip_pre in str(i):</span></span><br><span class="line">                        <span class="attr">return</span> <span class="string">str(i)</span></span><br><span class="line">            <span class="attr">elif</span> <span class="string">type(ip_list) is types.StringType:</span></span><br><span class="line">                <span class="attr">if</span> <span class="string">self.ip_pre in ip_list:</span></span><br><span class="line">                    <span class="attr">return</span> <span class="string">ip_list</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>这个方法利用了 gethostbyname 和 gethostbyname_ex 方法，获取了各个网卡的 IP 地址，遍历一下，找到那个 211.87 开头的 IP，返回 接下来，获取到 IP 之后，我们便可以构建 form，然后进行模拟登陆了。</p>
      <figure class="highlight ruby">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="comment">#模拟登录</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        print <span class="keyword">self</span>.getCurrentTime(), u<span class="string">"正在尝试认证QLSC_STU无线网络"</span></span><br><span class="line">        ip = <span class="keyword">self</span>.getIP()</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">"username"</span>: <span class="keyword">self</span>.username,</span><br><span class="line">            <span class="string">"password"</span>: <span class="keyword">self</span>.password,</span><br><span class="line">            <span class="string">"serverType"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"isSavePass"</span>: <span class="string">"on"</span>,</span><br><span class="line">            <span class="string">"Submit1"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"Language"</span>: <span class="string">"Chinese"</span>,</span><br><span class="line">            <span class="string">"ClientIP"</span>: <span class="keyword">self</span>.getIP(),</span><br><span class="line">            <span class="string">"timeoutvalue"</span>: <span class="number">45</span>,</span><br><span class="line">            <span class="string">"heartbeat"</span>: <span class="number">240</span>,</span><br><span class="line">            <span class="string">"fastwebornot"</span>: False,</span><br><span class="line">            <span class="string">"StartTime"</span>: <span class="keyword">self</span>.getNowTime(),</span><br><span class="line">            <span class="comment">#持续时间，超过这个时间自动掉线，可进行设置</span></span><br><span class="line">            <span class="string">"shkOvertime"</span>: <span class="keyword">self</span>.overtime,</span><br><span class="line">            <span class="string">"strOSName"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"iAdptIndex"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strAdptName"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strAdptStdName"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strFileEncoding"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"PhysAddr"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"bDHCPEnabled"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strIPAddrArray"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strMaskArray"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strMask"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"iDHCPDelayTime"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"iDHCPTryTimes"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strOldPrivateIP"</span>: <span class="keyword">self</span>.getIP(),</span><br><span class="line">            <span class="string">"strOldPublicIP"</span>: <span class="keyword">self</span>.getIP(),</span><br><span class="line">            <span class="string">"strPrivateIP"</span>: <span class="keyword">self</span>.getIP(),</span><br><span class="line">            <span class="string">"PublicIP"</span>: <span class="keyword">self</span>.getIP(),</span><br><span class="line">            <span class="string">"iIPCONFIG"</span><span class="symbol">:</span><span class="number">0</span>,</span><br><span class="line">            <span class="string">"sHttpPrefix"</span>: <span class="string">"http://192.168.8.10"</span>,</span><br><span class="line">            <span class="string">"title"</span>: <span class="string">"CAMS Portal"</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">#消息头</span></span><br><span class="line">        headers = &#123;</span><br><span class="line">            <span class="string">'User-Agent'</span> : <span class="string">'Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/38.0.2125.111 Safari/537.36'</span>,</span><br><span class="line">            <span class="string">'Host'</span>: <span class="string">'192.168.8.10'</span>,</span><br><span class="line">            <span class="string">'Origin'</span>: <span class="string">'http://192.168.8.10'</span>,</span><br><span class="line">            <span class="string">'Referer'</span>: <span class="string">'http://192.168.8.10/portal/index_default.jsp?Language=Chinese'</span></span><br><span class="line">        &#125;</span><br><span class="line">        post_data = urllib.urlencode(data)</span><br><span class="line">        login_url = <span class="string">"http://192.168.8.10/portal/login.jsp?Flag=0"</span></span><br><span class="line">        request = urllib2.Request(login_url, post_data, headers)</span><br><span class="line">        response = urllib2.urlopen(request)</span><br><span class="line">        result = response.read().decode(<span class="string">'gbk'</span>)</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>比较多的内容就在于 form 表单的数据内容以及请求头，后来利用 urllib2 的 urlopen 方法实现模拟登陆。 如果大家对此不熟悉，可以参见 <a href="http://cuiqingcai.com/947.html">Urllib 的基本使用</a> 这样，登录后的结果就会保存在 result 变量中，我们只需要从 result 中提取出我们需要的数据就可以了。</p>
      <h2 id="乘胜追击"><a href="#乘胜追击" class="headerlink" title="乘胜追击"></a>乘胜追击</h2>
      <p>接下来，我们就分析一下数据啦，结果有这么几种：</p>
      <blockquote>
        <p>1.登录成功 2.已经登录 3.用户不存在 4.密码错误 5.未知错误</p>
      </blockquote>
      <p>好，利用 result 分析一下结果</p>
      <figure class="highlight python">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="comment">#打印登录结果</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getLoginResult</span><span class="params">(self, result)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">u"用户上线成功"</span> <span class="keyword">in</span> result:</span><br><span class="line">            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">u"用户上线成功,在线时长为"</span>,self.overtime/<span class="number">60</span>,<span class="string">"分钟"</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">u"您已经建立了连接"</span> <span class="keyword">in</span> result:</span><br><span class="line">            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">u"您已经建立了连接,无需重复登陆"</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">u"用户不存在"</span> <span class="keyword">in</span> result:</span><br><span class="line">            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">u"用户不存在，请检查学号是否正确"</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">u"用户密码错误"</span> <span class="keyword">in</span> result:</span><br><span class="line">            pattern = re.compile(<span class="string">'&lt;td class="tWhite"&gt;.*?2553:(.*?)&lt;/b&gt;.*?&lt;/td&gt;'</span>, re.S)</span><br><span class="line">            res = re.search(pattern, result)</span><br><span class="line">            <span class="keyword">if</span> res:</span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(),res.group(<span class="number">1</span>),<span class="string">u"请重新修改密码"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">u"未知错误，请检查学号密码是否正确"</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>通过字符串匹配和正则表达式，我们分辨并提取出了上述五种情况。 增加循环检测 既然是检测网络是否断开，那么我们只需要每隔一段时间检测一下就好了，那就 10 秒吧。 因为这个 10 秒是可配置的，为了方便配置，统一配置到<strong>init</strong>方法里面。</p>
      <figure class="highlight ini">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="comment">#检测间隔时间，单位为秒</span></span><br><span class="line"><span class="attr">self.every</span> = <span class="number">10</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>然后，我们写一个循环来检测一下</p>
      <figure class="highlight python">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            nowIP = self.getIP()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> nowIP:</span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(), <span class="string">u"请检查是否正常连接QLSC_STU无线网络"</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(),<span class="string">u"成功连接了QLSC_STU网络,本机IP为"</span>,nowIP</span><br><span class="line">                self.login()</span><br><span class="line">                <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                    can_connect = self.canConnect()</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> can_connect:</span><br><span class="line">                        nowIP = self.getIP()</span><br><span class="line">                        <span class="keyword">if</span> <span class="keyword">not</span> nowIP:</span><br><span class="line">                            <span class="keyword">print</span> self.getCurrentTime(), <span class="string">u"当前已经断线，请确保连接上了QLSC_STU网络"</span></span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            <span class="keyword">print</span> self.getCurrentTime(), <span class="string">u"当前已经断线，正在尝试重新连接"</span></span><br><span class="line">                            self.login()</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">print</span> self.getCurrentTime(), <span class="string">u"当前网络连接正常"</span></span><br><span class="line">                    time.sleep(self.every)</span><br><span class="line">            time.sleep(self.every)</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>其中我们用到了 canConnect 方法，这个就是检测网络是否已经断开的方法，我们可以利用 ping 百度的方法来检测一下。 方法实现如下</p>
      <figure class="highlight livecodeserver">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="comment">#判断当前是否可以联网</span></span><br><span class="line">    def canConnect(self):</span><br><span class="line">        fnull = <span class="built_in">open</span>(os.devnull, <span class="string">'w'</span>)</span><br><span class="line">        <span class="built_in">result</span> = subprocess.call(<span class="string">'ping www.baidu.com'</span>, <span class="built_in">shell</span> = True, <span class="keyword">stdout</span> = fnull, <span class="keyword">stderr</span> = fnull)</span><br><span class="line">        fnull.<span class="built_in">close</span>()</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">result</span>:</span><br><span class="line">            <span class="literal">return</span> False</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="literal">return</span> True</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>好啦，所有的要点我们已经逐一击破，等着凯旋吧</p>
      <h2 id="收拾战场"><a href="#收拾战场" class="headerlink" title="收拾战场"></a>收拾战场</h2>
      <p>好了，所有的代码要点已经被我们攻破了，接下来就整理一下，让他们组合起来，变成一个应用程序吧。</p>
      <figure class="highlight python">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">__author__ = <span class="string">'CQC'</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> types</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Login</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#初始化</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment">#学号密码</span></span><br><span class="line">        self.username = <span class="string">'201200131012'</span></span><br><span class="line">        self.password = <span class="string">'XXXXXX'</span></span><br><span class="line">        <span class="comment">#山大无线STU的IP网段</span></span><br><span class="line">        self.ip_pre = <span class="string">'211.87'</span></span><br><span class="line">        <span class="comment">#登录时长</span></span><br><span class="line">        self.overtime = <span class="number">720</span></span><br><span class="line">        <span class="comment">#检测间隔时间，单位为秒</span></span><br><span class="line">        self.every = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#模拟登录</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> self.getCurrentTime(), <span class="string">u"正在尝试认证QLSC_STU无线网络"</span></span><br><span class="line">        ip = self.getIP()</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">"username"</span>: self.username,</span><br><span class="line">            <span class="string">"password"</span>: self.password,</span><br><span class="line">            <span class="string">"serverType"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"isSavePass"</span>: <span class="string">"on"</span>,</span><br><span class="line">            <span class="string">"Submit1"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"Language"</span>: <span class="string">"Chinese"</span>,</span><br><span class="line">            <span class="string">"ClientIP"</span>: self.getIP(),</span><br><span class="line">            <span class="string">"timeoutvalue"</span>: <span class="number">45</span>,</span><br><span class="line">            <span class="string">"heartbeat"</span>: <span class="number">240</span>,</span><br><span class="line">            <span class="string">"fastwebornot"</span>: <span class="literal">False</span>,</span><br><span class="line">            <span class="string">"StartTime"</span>: self.getNowTime(),</span><br><span class="line">            <span class="comment">#持续时间，超过这个时间自动掉线，可进行设置</span></span><br><span class="line">            <span class="string">"shkOvertime"</span>: self.overtime,</span><br><span class="line">            <span class="string">"strOSName"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"iAdptIndex"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strAdptName"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strAdptStdName"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strFileEncoding"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"PhysAddr"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"bDHCPEnabled"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strIPAddrArray"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strMaskArray"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strMask"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"iDHCPDelayTime"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"iDHCPTryTimes"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strOldPrivateIP"</span>: self.getIP(),</span><br><span class="line">            <span class="string">"strOldPublicIP"</span>: self.getIP(),</span><br><span class="line">            <span class="string">"strPrivateIP"</span>: self.getIP(),</span><br><span class="line">            <span class="string">"PublicIP"</span>: self.getIP(),</span><br><span class="line">            <span class="string">"iIPCONFIG"</span>:<span class="number">0</span>,</span><br><span class="line">            <span class="string">"sHttpPrefix"</span>: <span class="string">"http://192.168.8.10"</span>,</span><br><span class="line">            <span class="string">"title"</span>: <span class="string">"CAMS Portal"</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">#消息头</span></span><br><span class="line">        headers = &#123;</span><br><span class="line">            <span class="string">'User-Agent'</span> : <span class="string">'Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/38.0.2125.111 Safari/537.36'</span>,</span><br><span class="line">            <span class="string">'Host'</span>: <span class="string">'192.168.8.10'</span>,</span><br><span class="line">            <span class="string">'Origin'</span>: <span class="string">'http://192.168.8.10'</span>,</span><br><span class="line">            <span class="string">'Referer'</span>: <span class="string">'http://192.168.8.10/portal/index_default.jsp?Language=Chinese'</span></span><br><span class="line">        &#125;</span><br><span class="line">        post_data = urllib.urlencode(data)</span><br><span class="line">        login_url = <span class="string">"http://192.168.8.10/portal/login.jsp?Flag=0"</span></span><br><span class="line">        request = urllib2.Request(login_url, post_data, headers)</span><br><span class="line">        response = urllib2.urlopen(request)</span><br><span class="line">        result = response.read().decode(<span class="string">'gbk'</span>)</span><br><span class="line">        self.getLoginResult(result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">#打印登录结果</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getLoginResult</span><span class="params">(self, result)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">u"用户上线成功"</span> <span class="keyword">in</span> result:</span><br><span class="line">            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">u"用户上线成功,在线时长为"</span>,self.overtime/<span class="number">60</span>,<span class="string">"分钟"</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">u"您已经建立了连接"</span> <span class="keyword">in</span> result:</span><br><span class="line">            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">u"您已经建立了连接,无需重复登陆"</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">u"用户不存在"</span> <span class="keyword">in</span> result:</span><br><span class="line">            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">u"用户不存在，请检查学号是否正确"</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">u"用户密码错误"</span> <span class="keyword">in</span> result:</span><br><span class="line">            pattern = re.compile(<span class="string">'&lt;td class="tWhite"&gt;.*?2553:(.*?)&lt;/b&gt;.*?&lt;/td&gt;'</span>, re.S)</span><br><span class="line">            res = re.search(pattern, result)</span><br><span class="line">            <span class="keyword">if</span> res:</span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(),res.group(<span class="number">1</span>),<span class="string">u"请重新修改密码"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">u"未知错误，请检查学号密码是否正确"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取当前时间戳，13位</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getNowTime</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> str(int(time.time()))+<span class="string">"000"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取本机无线IP</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getIP</span><span class="params">(self)</span>:</span></span><br><span class="line">        local_iP = socket.gethostbyname(socket.gethostname())</span><br><span class="line">        <span class="keyword">if</span> self.ip_pre <span class="keyword">in</span> str(local_iP):</span><br><span class="line">            <span class="keyword">return</span> str(local_iP)</span><br><span class="line">        ip_lists = socket.gethostbyname_ex(socket.gethostname())</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> ip_list <span class="keyword">in</span> ip_lists:</span><br><span class="line">            <span class="keyword">if</span> isinstance(ip_list, list):</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> ip_list:</span><br><span class="line">                    <span class="keyword">if</span> self.ip_pre <span class="keyword">in</span> str(i):</span><br><span class="line">                        <span class="keyword">return</span> str(i)</span><br><span class="line">            <span class="keyword">elif</span> type(ip_list) <span class="keyword">is</span> types.StringType:</span><br><span class="line">                <span class="keyword">if</span> self.ip_pre <span class="keyword">in</span> ip_list:</span><br><span class="line">                    <span class="keyword">return</span> ip_list</span><br><span class="line"></span><br><span class="line">    <span class="comment">#判断当前是否可以联网</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">canConnect</span><span class="params">(self)</span>:</span></span><br><span class="line">        fnull = open(os.devnull, <span class="string">'w'</span>)</span><br><span class="line">        result = subprocess.call(<span class="string">'ping www.baidu.com'</span>, shell = <span class="literal">True</span>, stdout = fnull, stderr = fnull)</span><br><span class="line">        fnull.close()</span><br><span class="line">        <span class="keyword">if</span> result:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取当前时间</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getCurrentTime</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> time.strftime(<span class="string">'[%Y-%m-%d %H:%M:%S]'</span>,time.localtime(time.time()))</span><br><span class="line"></span><br><span class="line">    <span class="comment">#主函数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> self.getCurrentTime(), <span class="string">u"您好，欢迎使用模拟登陆系统"</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            nowIP = self.getIP()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> nowIP:</span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(), <span class="string">u"请检查是否正常连接QLSC_STU无线网络"</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(),<span class="string">u"成功连接了QLSC_STU网络,本机IP为"</span>,nowIP</span><br><span class="line">                self.login()</span><br><span class="line">                <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                    can_connect = self.canConnect()</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> can_connect:</span><br><span class="line">                        nowIP = self.getIP()</span><br><span class="line">                        <span class="keyword">if</span> <span class="keyword">not</span> nowIP:</span><br><span class="line">                            <span class="keyword">print</span> self.getCurrentTime(), <span class="string">u"当前已经掉线，请确保连接上了QLSC_STU网络"</span></span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            <span class="keyword">print</span> self.getCurrentTime(), <span class="string">u"当前已经掉线，正在尝试重新连接"</span></span><br><span class="line">                            self.login()</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">print</span> self.getCurrentTime(), <span class="string">u"当前网络连接正常"</span></span><br><span class="line">                    time.sleep(self.every)</span><br><span class="line">            time.sleep(self.every)</span><br><span class="line"></span><br><span class="line">login = Login()</span><br><span class="line">login.main()</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>来，我们来运行一下，看下效果吧！ 执行</p>
      <figure class="highlight vim">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="keyword">python</span> login.<span class="keyword">py</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>当前是可以联网的，我分别在网页上操作执行了断开，操作，程序自动检测到掉线，自动重新连接。 接下来我直接断开了 QLSC_STU 网络的链接，程序同样检测到 QLSC_STU 这个热点没有连接上，提示用户链接。 接下来我重新连接上了这个热点，由于刚才已经登录上线，且持续时间较短，网络自动恢复正常。 下面是运行结果： <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150920205618.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150920205618.png" alt="20150920205618"></a> 嗯，这样我们就是实现了自动掉线的检测和模拟登录。</p>
      <h2 id="凯旋而归"><a href="#凯旋而归" class="headerlink" title="凯旋而归"></a>凯旋而归</h2>
      <p>咿呀伊尔哟，想约妹子上自习吗？那就赶紧来试试吧！一网在手，天下我有！追男神女神都不再是梦想！ 如果有问题，欢迎留言讨论，代码肯定有不完善的地方，仅供参考。</p>
      </p>
    </div>
  </div>
  <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-user"></i>
      </span>
      <span class="post-meta-item-text">作者</span>
      <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      <time title="创建时间：2015-09-20 21:01:06" itemprop="dateCreated datePublished" datetime="2015-09-20T21:01:06+08:00">2015-09-20</time>
    </span>
    <span id="/2083.html" class="post-meta-item leancloud_visitors" data-flag-title="Python爬虫实战三之实现山东大学无线网络掉线自动重连" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>8.7k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>8 分钟</span>
    </span>
  </div>
</article>

    <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2076.html">
  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.png">
    <meta itemprop="name" content="崔庆才">
    <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  </span>
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="静觅">
  </span>
  <header class="post-header">
    <h2 class="post-title" itemprop="name headline">
      <a class="label"> Other <i class="label-arrow"></i>
      </a>
      <a href="/2076.html" class="post-title-link" itemprop="url">浅谈CSRF攻击方式</a>
    </h2>
  </header>
  <div class="post-body" itemprop="articleBody">
    <div class="thumb">
      <img itemprop="contentUrl" class="random">
    </div>
    <div class="excerpt">
      <p>
      <h2 id="CSRF是什么？"><a href="#CSRF是什么？" class="headerlink" title="CSRF是什么？"></a><strong>CSRF是什么？</strong></h2>
      <p>CSRF（Cross-site request forgery），中文名称：跨站请求伪造，也被称为：one click attack/session riding，缩写为：CSRF/XSRF。</p>
      <h2 id="CSRF可以做什么？"><a href="#CSRF可以做什么？" class="headerlink" title="CSRF可以做什么？"></a><strong>CSRF可以做什么？</strong></h2>
      <p>你这可以这么理解CSRF攻击：攻击者盗用了你的身份，以你的名义发送恶意请求。CSRF能够做的事情包括：以你名义发送邮件，发消息，盗取你的账号，甚至于购买商品，虚拟货币转账……造成的问题包括：个人隐私泄露以及财产安全。</p>
      <h2 id="CSRF漏洞现状"><a href="#CSRF漏洞现状" class="headerlink" title="CSRF漏洞现状"></a><strong>CSRF漏洞现状</strong></h2>
      <p>CSRF这种攻击方式在2000年已经被国外的安全人员提出，但在国内，直到06年才开始被关注，08年，国内外的多个大型社区和交互网站分别爆出CSRF漏洞，如：NYTimes.com（纽约时报）、Metafilter（一个大型的BLOG网站），YouTube和百度HI……而现在，互联网上的许多站点仍对此毫无防备，以至于安全业界称CSRF为“沉睡的巨人”。</p>
      <h2 id="CSRF的原理"><a href="#CSRF的原理" class="headerlink" title="CSRF的原理"></a><strong>CSRF的原理</strong></h2>
      <p>下图简单阐述了CSRF攻击的思想： <img src="http://pic002.cnblogs.com/img/hyddd/200904/2009040916453171.jpg" alt=""> 从上图可以看出，要完成一次CSRF攻击，受害者必须依次完成两个步骤：</p>
      <blockquote>
        <p>　　1.登录受信任网站A，并在本地生成Cookie。 2.在不登出A的情况下，访问危险网站B。</p>
      </blockquote>
      <p>看到这里，你也许会说：“如果我不满足以上两个条件中的一个，我就不会受到CSRF的攻击”。是的，确实如此，但你不能保证以下情况不会发生：</p>
      <blockquote>
        <p>　　1.你不能保证你登录了一个网站后，不再打开一个tab页面并访问另外的网站。 2.你不能保证你关闭浏览器了后，你本地的Cookie立刻过期，你上次的会话已经结束。（事实上，关闭浏览器不能结束一个会话，但大多数人都会错误的认为关闭浏览器就等于退出登录/结束会话了……） 3.上图中所谓的攻击网站，可能是一个存在其他漏洞的可信任的经常被人访问的网站。</p>
      </blockquote>
      <p>上面大概地讲了一下CSRF攻击的思想，下面我将用几个例子详细说说具体的CSRF攻击，这里我以一个银行转账的操作作为例子（仅仅是例子，真实的银行网站没这么傻:&gt;）</p>
      <h3 id="示例1："><a href="#示例1：" class="headerlink" title="示例1："></a><strong>示例1：</strong></h3>
      <p>银行网站A，它以GET请求来完成银行转账的操作，如：<a href="http://www.mybank.com/Transfer.php?toBankId=11&amp;money=1000" target="_blank" rel="noopener">http://www.mybank.com/Transfer.php?toBankId=11&amp;money=1000</a> 危险网站B，它里面有一段HTML的代码如下：</p>
      <figure class="highlight xml">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">http://www.mybank.com/Transfer.php?toBankId</span>=<span class="string">11&amp;money</span>=<span class="string">1000</span>&gt;</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>首先，你登录了银行网站A，然后访问危险网站B，噢，这时你会发现你的银行账户少了1000块…… 为什么会这样呢？原因是银行网站A违反了HTTP规范，使用GET请求更新资源。在访问危险网站B的之前，你已经登录了银行网站A，而B中的<img>以GET的方式请求第三方资源（这里的第三方就是指银行网站了，原本这是一个合法的请求，但这里被不法分子利用了），所以你的浏览器会带上你的银行网站A的Cookie发出Get请求，去获取资源“<a href="http://www.mybank.com/Transfer.php?toBankId=11&amp;money=1000”，结果银行网站服务器收到请求后，认为这是一个更新资源操作（转账操作），所以就立刻进行转账操作" target="_blank" rel="noopener">http://www.mybank.com/Transfer.php?toBankId=11&amp;money=1000”，结果银行网站服务器收到请求后，认为这是一个更新资源操作（转账操作），所以就立刻进行转账操作</a>……</p>
      <h3 id="示例2："><a href="#示例2：" class="headerlink" title="　　示例2："></a>　　<strong>示例2：</strong></h3>
      <p>为了杜绝上面的问题，银行决定改用POST请求完成转账操作。 银行网站A的WEB表单如下：</p>
      <figure class="highlight xml">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">　　<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"Transfer.php"</span> <span class="attr">method</span>=<span class="string">"POST"</span>&gt;</span></span><br><span class="line">　　　　<span class="tag">&lt;<span class="name">p</span>&gt;</span>ToBankId: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"toBankId"</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">　　　　<span class="tag">&lt;<span class="name">p</span>&gt;</span>Money: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"money"</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">　　　　<span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Transfer"</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">　　<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>后台处理页面Transfer.php如下：</p>
      <figure class="highlight xml">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">　　<span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">　　　　session_start();</span></span><br><span class="line"><span class="php">　　　　<span class="keyword">if</span> (<span class="keyword">isset</span>($_REQUEST[<span class="string">'toBankId'</span>] &amp;&amp;　<span class="keyword">isset</span>($_REQUEST[<span class="string">'money'</span>]))</span></span><br><span class="line"><span class="php">　　　　&#123;</span></span><br><span class="line"><span class="php">　　　　    buy_stocks($_REQUEST[<span class="string">'toBankId'</span>],　$_REQUEST[<span class="string">'money'</span>]);</span></span><br><span class="line"><span class="php">　　　　&#125;</span></span><br><span class="line"><span class="php">　　<span class="meta">?&gt;</span></span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>危险网站B，仍然只是包含那句HTML代码：</p>
      <figure class="highlight xml">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">http://www.mybank.com/Transfer.php?toBankId</span>=<span class="string">11&amp;money</span>=<span class="string">1000</span>&gt;</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>和示例1中的操作一样，你首先登录了银行网站A，然后访问危险网站B，结果…..和示例1一样，你再次没了1000块～T_T，这次事故的原因是：银行后台使用了$_REQUEST去获取请求的数据，而$_REQUEST既可以获取GET请求的数据，也可以获取POST请求的数据，这就造成了在后台处理程序无法区分这到底是GET请求的数据还是POST请求的数据。在PHP中，可以使用$_GET和$_POST分别获取GET请求和POST请求的数据。在JAVA中，用于获取请求数据request一样存在不能区分GET请求数据和POST数据的问题。</p>
      <h3 id="示例3："><a href="#示例3：" class="headerlink" title="　　示例3："></a>　　<strong>示例3：</strong></h3>
      <p>经过前面2个惨痛的教训，银行决定把获取请求数据的方法也改了，改用$_POST，只获取POST请求的数据，后台处理页面Transfer.php代码如下：</p>
      <figure class="highlight xml">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">　　<span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">　　　　session_start();</span></span><br><span class="line"><span class="php">　　　　<span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'toBankId'</span>] &amp;&amp;　<span class="keyword">isset</span>($_POST[<span class="string">'money'</span>]))</span></span><br><span class="line"><span class="php">　　　　&#123;</span></span><br><span class="line"><span class="php">　　　　    buy_stocks($_POST[<span class="string">'toBankId'</span>],　$_POST[<span class="string">'money'</span>]);</span></span><br><span class="line"><span class="php">　　　　&#125;</span></span><br><span class="line"><span class="php">　　<span class="meta">?&gt;</span></span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>然而，危险网站B与时俱进，它改了一下代码：</p>
      <figure class="highlight xml">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">　　<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">　　　　<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="actionscript">　　　　　　<span class="function"><span class="keyword">function</span> <span class="title">steal</span><span class="params">()</span></span></span></span><br><span class="line">　　　　　　&#123;</span><br><span class="line"><span class="javascript">          　　　　 iframe = <span class="built_in">document</span>.frames[<span class="string">"steal"</span>];</span></span><br><span class="line"><span class="actionscript">　　     　　      iframe.document.Submit(<span class="string">"transfer"</span>);</span></span><br><span class="line">　　　　　　&#125;</span><br><span class="line">　　　　<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">　　<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">　　<span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">"steal()"</span>&gt;</span></span><br><span class="line">　　　　<span class="tag">&lt;<span class="name">iframe</span> <span class="attr">name</span>=<span class="string">"steal"</span> <span class="attr">display</span>=<span class="string">"none"</span>&gt;</span></span><br><span class="line">　　　　　　<span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">name</span>=<span class="string">"transfer"</span>　<span class="attr">action</span>=<span class="string">"http://www.myBank.com/Transfer.php"</span>&gt;</span></span><br><span class="line">　　　　　　　　<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"toBankId"</span> <span class="attr">value</span>=<span class="string">"11"</span>&gt;</span></span><br><span class="line">　　　　　　　　<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"money"</span> <span class="attr">value</span>=<span class="string">"1000"</span>&gt;</span></span><br><span class="line">　　　　　　<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">　　　　<span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line">　　<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>如果用户仍是继续上面的操作，很不幸，结果将会是再次不见1000块……因为这里危险网站B暗地里发送了POST请求到银行! 总结一下上面3个例子，CSRF主要的攻击模式基本上是以上的3种，其中以第1,2种最为严重，因为触发条件很简单，一个<img>就可以了，而第3种比较麻烦，需要使用JavaScript，所以使用的机会会比前面的少很多，但无论是哪种情况，只要触发了CSRF攻击，后果都有可能很严重。 理解上面的3种攻击模式，其实可以看出，CSRF攻击是源于WEB的隐式身份验证机制！WEB的身份验证机制虽然可以保证一个请求是来自于某个用户的浏览器，但却无法保证该请求是用户批准发送的！</p>
      <h2 id="CSRF的防御"><a href="#CSRF的防御" class="headerlink" title="CSRF的防御"></a><strong>CSRF的防御</strong></h2>
      <p>我总结了一下看到的资料，CSRF的防御可以从服务端和客户端两方面着手，防御效果是从服务端着手效果比较好，现在一般的CSRF防御也都在服务端进行。</p>
      <h3 id="1-服务端进行CSRF防御"><a href="#1-服务端进行CSRF防御" class="headerlink" title="　　1.服务端进行CSRF防御"></a>　　<strong>1.服务端进行CSRF防御</strong></h3>
      <p>服务端的CSRF方式方法很多样，但总的思想都是一致的，就是在客户端页面增加伪随机数。 (1).Cookie Hashing(所有表单都包含同一个伪随机值)： 这可能是最简单的解决方案了，因为攻击者不能获得第三方的Cookie(理论上)，所以表单中的数据也就构造失败了:&gt;</p>
      <figure class="highlight xml">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">　　<span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">　　　　<span class="comment">//构造加密的Cookie信息</span></span></span><br><span class="line"><span class="php">　　　　$value = “DefenseSCRF”;</span></span><br><span class="line"><span class="php">　　　　setcookie(”cookie”, $value, time()+<span class="number">3600</span>);</span></span><br><span class="line"><span class="php">　　<span class="meta">?&gt;</span></span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>在表单里增加Hash值，以认证这确实是用户发送的请求。</p>
      <figure class="highlight django">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="xml">　　<span class="php"><span class="meta">&lt;?php</span></span></span></span><br><span class="line"><span class="xml">　　　　$hash = md5($_COOKIE['cookie']);</span></span><br><span class="line"><span class="xml">　　?&gt;</span></span><br><span class="line"><span class="xml">　　<span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">”POST”</span> <span class="attr">action</span>=<span class="string">”transfer.php”</span>&gt;</span></span></span><br><span class="line"><span class="xml">　　　　<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">”text”</span> <span class="attr">name</span>=<span class="string">”toBankId”</span>&gt;</span></span></span><br><span class="line"><span class="xml">　　　　<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">”text”</span> <span class="attr">name</span>=<span class="string">”money”</span>&gt;</span></span></span><br><span class="line"><span class="xml">　　　　<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">”hidden”</span> <span class="attr">name</span>=<span class="string">”hash”</span> <span class="attr">value</span>=<span class="string">”</span>&lt;?=<span class="string">$hash;?</span>&gt;</span>”&gt;</span></span><br><span class="line"><span class="xml">　　　　<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">”submit”</span> <span class="attr">name</span>=<span class="string">”submit”</span> <span class="attr">value</span>=<span class="string">”Submit”</span>&gt;</span></span></span><br><span class="line"><span class="xml">　　<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>然后在服务器端进行Hash值验证</p>
      <figure class="highlight xml">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">      <span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">　　      <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'check'</span>])) &#123;</span></span><br><span class="line"><span class="php">     　　      $hash = md5($_COOKIE[<span class="string">'cookie'</span>]);</span></span><br><span class="line"><span class="php">          　　 <span class="keyword">if</span>($_POST[<span class="string">'check'</span>] == $hash) &#123;</span></span><br><span class="line"><span class="php">               　　 doJob();</span></span><br><span class="line"><span class="php">　　           &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">　　　　　　　　<span class="comment">//...</span></span></span><br><span class="line"><span class="php">          　　 &#125;</span></span><br><span class="line"><span class="php">　　      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">　　　　　　<span class="comment">//...</span></span></span><br><span class="line"><span class="php">　　      &#125;</span></span><br><span class="line"><span class="php">      <span class="meta">?&gt;</span></span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>这个方法个人觉得已经可以杜绝99%的CSRF攻击了，那还有1%呢….由于用户的Cookie很容易由于网站的XSS漏洞而被盗取，这就另外的1%。一般的攻击者看到有需要算Hash值，基本都会放弃了，某些除外，所以如果需要100%的杜绝，这个不是最好的方法。</p>
      <h3 id="2-验证码"><a href="#2-验证码" class="headerlink" title="2.验证码"></a>2.验证码</h3>
      <p>这个方案的思路是：每次的用户提交都需要用户在表单中填写一个图片上的随机字符串，厄….这个方案可以完全解决CSRF，但个人觉得在易用性方面似乎不是太好，还有听闻是验证码图片的使用涉及了一个被称为MHTML的Bug，可能在某些版本的微软IE中受影响。</p>
      <h2 id="原文链接"><a href="#原文链接" class="headerlink" title="原文链接"></a>原文链接</h2>
      <p>在网上发现这篇文章说得很明了，转载啦，非常感谢原作者的辛苦付出。 <a href="http://www.cnblogs.com/hyddd/archive/2009/04/09/1432744.html" target="_blank" rel="noopener">原文出处</a></p>
      </p>
    </div>
  </div>
  <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-user"></i>
      </span>
      <span class="post-meta-item-text">作者</span>
      <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      <time title="创建时间：2015-09-17 23:08:41" itemprop="dateCreated datePublished" datetime="2015-09-17T23:08:41+08:00">2015-09-17</time>
    </span>
    <span id="/2076.html" class="post-meta-item leancloud_visitors" data-flag-title="浅谈CSRF攻击方式" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>4.4k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4 分钟</span>
    </span>
  </div>
</article>

    <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2057.html">
  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.png">
    <meta itemprop="name" content="崔庆才">
    <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  </span>
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="静觅">
  </span>
  <header class="post-header">
    <h2 class="post-title" itemprop="name headline">
      <a class="label"> Other <i class="label-arrow"></i>
      </a>
      <a href="/2057.html" class="post-title-link" itemprop="url">怎样把你的SAE利用起来</a>
    </h2>
  </header>
  <div class="post-body" itemprop="articleBody">
    <div class="thumb">
      <img itemprop="contentUrl" class="random">
    </div>
    <div class="excerpt">
      <p>
      <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
      <p>博主没事就喜欢瞎倒腾，今天登录自己的 SAE 一看，很久之前挂的几个应用早已杳无人烟，才消耗几个云豆，真是觉得太浪费了。所以博主就瞎倒腾一下，准备好好利用起自己的云豆，尽可能地为我提供服务。 好了，废话不多说，让我们开始动起来！</p>
      <h2 id="新建应用"><a href="#新建应用" class="headerlink" title="新建应用"></a>新建应用</h2>
      <p>既然想利用好里面的服务，那么我们就需要新建一个专属应用，取个专属名称，那么我名字叫崔庆才，那就叫 cuiqingcai 好了，幸运的是，并没有同名应用，可以使用，不错不错。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150912153748.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150912153748.png" alt="20150912153748"></a></p>
      <h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h2>
      <p>SAE 上最近出了一种独享数据库，不像之前的数据库一样每建一个应用自动生成一个数据库，这个数据库就像平常我们用到的 phpMyAdmin 一样一样的。可以新建好多个数据库，可以远程连接，可以登录网页设置。 有了这个，如果你没有 VPS，也不需要去买个 RDS 来用啦！ <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150912152842.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150912152842.png" alt="20150912152842"></a> 首先建立好应用之后，到应用管理界面去，点击你的 MySQL，然后就会让你选择是哪一种数据库，右边的独享型 MySQL 是 SAE 新出的，功能也非常强，可以建立数据库，可以建用户，授权数据库，监控数据等等。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150912153909.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150912153909-1024x538.png" alt="20150912153909"></a> 点击独享型 MySQL，创建属于自己的数据库吧。创建好了，建立自己的账户，登进来，一切都是那么轻松加愉快，以后有什么需要数据库，扔到这里就好了。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150912154219.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150912154219-1024x432.png" alt="20150912154219"></a> 好，相信这个一定非常简单，小伙伴们快试一下吧！</p>
      <h2 id="Storage"><a href="#Storage" class="headerlink" title="Storage"></a>Storage</h2>
      <p>新浪云中提供了 SCS，也是一个云存储服务，但是费用太坑了，而且不是消耗云豆的，然而应用中的 Storage 是使用云豆的，如果不是什么私密存储的话，还是可以利用一下的。 在这里我想让它发挥 SCS 的作用并绑定到我的域名上，这样通过 scs.cuiqingcai.com 便可以访问了。 我们新建一个 Storage Domain <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150912155842.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150912155842-1024x368.png" alt="20150912155842"></a> 上传一张图片进去，比如 1.jpg，上传后访问一下 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150912160138.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150912160138.png" alt="20150912160138"></a> 恩，轻松加愉快！接下来，我发现这个域名简直太难记了，我要换成自己的域名，比如 scs.cuiqingcai.com 这样，图片就可以通过 scs.cuiqingcai.com/1.jpg 来访问了。那么怎么配置呢？</p>
      <h3 id="1-绑定域名"><a href="#1-绑定域名" class="headerlink" title="1.绑定域名"></a>1.绑定域名</h3>
      <p>到应用首页里面，点击域名绑定，SAE 会告诉你两条要解析的内容，自己设置一下 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150912160935.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150912160935.png" alt="20150912160935"></a> 接下来我们需要配置一下代码</p>
      <h3 id="2-修改-config-yaml"><a href="#2-修改-config-yaml" class="headerlink" title="2.修改 config.yaml"></a>2.修改 config.yaml</h3>
      <p>需要在代码管理中，更改一下 config.yaml 文件，让它做一个跳转。 比如我的代码中 config.yaml 文件就更改为</p>
      <figure class="highlight groovy">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="string">name:</span> cuiqingcai</span><br><span class="line"><span class="string">version:</span> <span class="number">1</span></span><br><span class="line"><span class="string">handle:</span></span><br><span class="line">	- <span class="string">rewrite:</span> <span class="keyword">if</span> (path ~ <span class="string">"/(.*)"</span>) goto <span class="string">"http://cuiqingcai-scs.stor.sinaapp.com/$1"</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>其实就是加了一条 reweite 语句，把所有的路径定位到新地址的新路径中。 接下来，我访问一下 scs.cuiqingcai.com/1.jpg，嗯，图片出来了！这样，又一个免费的 CDN 建好了！ <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150912161437.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150912161437.png" alt="20150912161437"></a> 嗯，如果有什么图片需要存放，它会是你的一个非常好的选择！ 上传的话，SAE 提供了上传的客户端，大家可以自行下载尝试。 之后博主将研究一下怎样配置上传的接口，这样我们就可以通过程序来上传了，我也很期待呢！</p>
      <h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2>
      <p>以上是博主瞎倒腾的，可以为自己提供一些方便，大家尝试下吧，如有问题，欢迎留言交流！</p>
      </p>
    </div>
  </div>
  <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-user"></i>
      </span>
      <span class="post-meta-item-text">作者</span>
      <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      <time title="创建时间：2015-09-12 16:17:41" itemprop="dateCreated datePublished" datetime="2015-09-12T16:17:41+08:00">2015-09-12</time>
    </span>
    <span id="/2057.html" class="post-meta-item leancloud_visitors" data-flag-title="怎样把你的SAE利用起来" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
  </div>
</article>

    <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2036.html">
  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.png">
    <meta itemprop="name" content="崔庆才">
    <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  </span>
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="静觅">
  </span>
  <header class="post-header">
    <h2 class="post-title" itemprop="name headline">
      <a class="label"> Linux <i class="label-arrow"></i>
      </a>
      <a href="/2036.html" class="post-title-link" itemprop="url">Ubuntu Linux配置Nginx+MySQL+PHP+phpMyAdmin详细步骤</a>
    </h2>
  </header>
  <div class="post-body" itemprop="articleBody">
    <div class="thumb">
      <img itemprop="contentUrl" class="random">
    </div>
    <div class="excerpt">
      <p>
      <p>博主之前一直用的是 apache，随着网站负荷量增高，感觉 apache 稍微有点力不从心了。随着 nginx 越来越流行，而且其功能强大，博主准备采用 nginx 作为自己的服务器啦。 每当到了环境配置的时候，博主便会去网上各种搜集资料，然而感觉他们讲的都条理不一，有的地方并不符合自己的配置习惯，所以博主习惯自己配置的同时把配置过程总结一下，方便自己，也方便大家。 好，接下来我们就开始我们的环境配置之旅吧。</p>
      <h2 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h2>
      <h3 id="1-更新源"><a href="#1-更新源" class="headerlink" title="1.更新源"></a>1.更新源</h3>
      <figure class="highlight pgsql">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">update</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <h3 id="2-安装-nginx"><a href="#2-安装-nginx" class="headerlink" title="2.安装 nginx"></a>2.安装 nginx</h3>
      <figure class="highlight routeros">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">sudo apt-<span class="builtin-name">get</span> install nginx</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <h3 id="3-检查是否安装成功"><a href="#3-检查是否安装成功" class="headerlink" title="3.检查是否安装成功"></a>3.检查是否安装成功</h3>
      <p>输入 localhost 或者远程地址，若出现 Welcome To Nginx 则证明安装成功。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150911144903.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150911144903.png" alt="20150911144903"></a> 如果没有看到，可以运行</p>
      <figure class="highlight nginx">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="attribute">sudo</span> killall apache2</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>杀掉 apache 进程，因为可能 80 端口被占用了。</p>
      <h3 id="4-更改运行目录"><a href="#4-更改运行目录" class="headerlink" title="4.更改运行目录"></a>4.更改运行目录</h3>
      <p>默认的 nginx 目录是/usr/share/nginx/html，我们将其修改为/var/www，当然可以根据个人习惯灵活更改。 修改/etc/nginx/sites-available/default 文件</p>
      <figure class="highlight awk">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">root <span class="regexp">/usr/</span>share<span class="regexp">/nginx/</span>html;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>更改为</p>
      <figure class="highlight actionscript">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">root /<span class="keyword">var</span>/www</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>再将</p>
      <figure class="highlight n1ql">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="keyword">index</span> <span class="keyword">index</span>.html <span class="keyword">index</span>.htm;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>更改为</p>
      <figure class="highlight n1ql">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="keyword">index</span> <span class="keyword">index</span>.html <span class="keyword">index</span>.php <span class="keyword">index</span>.htm;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>重启 nginx</p>
      <figure class="highlight routeros">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">sudo<span class="built_in"> service </span>nginx restart</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>我们在/var/www 目录下新建 index.html 文件，写入一些测试文字。 重新访问 localhost 或者远程地址，可以看到刚才设置的 index.html 文件中的内容，说明目录已经更改成功了。</p>
      <h2 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h2>
      <p>安装 PHP 以及相关扩展。</p>
      <figure class="highlight smali">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">sudo apt-get install php5 php5-cgi php5-mysql php5-curl php5-gd php5-idn php-pear php5-imagick php5-imap php5-mcrypt php5-memcache php5-mhash php5-ming php5-pspell php5-recode php5-snmp php5-tidy php5-xmlrpc php5-sqlite php5-xsl</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>执行上述指令即可。 此时有的小伙伴想要测试运行 PHP 文件了，然而很悲剧地告诉你是不可以的，因为你还没有配置 fastcgi，继续往下看。</p>
      <h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2>
      <p>执行如下命令，安装 MySQL 服务端和客户端。</p>
      <figure class="highlight sql">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">sudo apt-get <span class="keyword">install</span> mysql-<span class="keyword">server</span> mysql-<span class="keyword">client</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>在安装时可能提示你输入 root 用户的密码，设置即可。</p>
      <h2 id="phpMyAdmin"><a href="#phpMyAdmin" class="headerlink" title="phpMyAdmin"></a>phpMyAdmin</h2>
      <p>执行如下命令，安装 phpMyAdmin。</p>
      <figure class="highlight routeros">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">sudo apt-<span class="builtin-name">get</span> install phpmyadmin</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>创建软连接</p>
      <figure class="highlight awk">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">sudo ln -s <span class="regexp">/usr/</span>share<span class="regexp">/phpmyadmin/</span> <span class="regexp">/var/</span>www<span class="regexp">/phpmyadmin</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>我们将创建一个根目录为/var/www，链接名为 phpmyadmin 的文件，指向/usr/share/phpmyadmin</p>
      <h2 id="spawn-fcgi"><a href="#spawn-fcgi" class="headerlink" title="spawn-fcgi"></a>spawn-fcgi</h2>
      <h3 id="1-安装-fastcgi"><a href="#1-安装-fastcgi" class="headerlink" title="1.安装 fastcgi"></a>1.安装 fastcgi</h3>
      <figure class="highlight routeros">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">sudo apt-<span class="builtin-name">get</span> install spawn-fcgi</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <h3 id="2-配置-fastcgi"><a href="#2-配置-fastcgi" class="headerlink" title="2.配置 fastcgi"></a>2.配置 fastcgi</h3>
      <p>修改 /etc/nginx/fastcgi_params 文件，增加下面一行</p>
      <figure class="highlight nginx">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="attribute">fastcgi_param</span> SCRIPT_FILENAME <span class="variable">$document_root</span><span class="variable">$fastcgi_script_name</span>;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>修改/etc/php5/cgi/php.ini 文件，将下面一行取消注释</p>
      <figure class="highlight ini">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="attr">cgi.fix_pathinfo</span>=<span class="number">1</span><span class="comment">;</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>这样 php-cgi 方能正常使用 SCRIPT_FILENAME 这个变量 修改/etc/nginx/sites-available/default 文件，我们之前修改的目录地址是/var/www，将</p>
      <figure class="highlight vala">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="meta">#location ~ \.php$ &#123;</span></span><br><span class="line"><span class="meta">#	fastcgi_split_path_info ^(.+\.php)(/.+)$;</span></span><br><span class="line"><span class="meta">#	# NOTE: You should have "cgi.fix_pathinfo = 0;" in php.ini</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#	# With php5-cgi alone:</span></span><br><span class="line"><span class="meta">#	fastcgi_pass 127.0.0.1:9000;</span></span><br><span class="line"><span class="meta">#	# With php5-fpm:</span></span><br><span class="line"><span class="meta">#	fastcgi_pass unix:/var/run/php5-fpm.sock;</span></span><br><span class="line"><span class="meta">#	fastcgi_index index.php;</span></span><br><span class="line"><span class="meta">#	include fastcgi_params;</span></span><br><span class="line"><span class="meta">#&#125;</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>修改为</p>
      <figure class="highlight nginx">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="attribute">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line"><span class="comment">#	fastcgi_split_path_info ^(.+\.php)(/.+)$;</span></span><br><span class="line"><span class="comment">#	# <span class="doctag">NOTE:</span> You should have "cgi.fix_pathinfo = 0;" in php.ini</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#	# With php5-cgi alone:</span></span><br><span class="line">	<span class="attribute">fastcgi_pass</span> <span class="number">127.0.0.1:9000</span>;</span><br><span class="line"><span class="comment">#	# With php5-fpm:</span></span><br><span class="line"><span class="comment">#	fastcgi_pass unix:/var/run/php5-fpm.sock;</span></span><br><span class="line">	<span class="attribute">fastcgi_index</span> index.php;</span><br><span class="line">	<span class="attribute">fastcgi_param</span> SCRIPT_FILENAME /var/www<span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">	<span class="attribute">include</span> fastcgi_params;</span><br><span class="line">&#125;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <h3 id="3-开启-fastcgi-进程"><a href="#3-开启-fastcgi-进程" class="headerlink" title="3.开启 fastcgi 进程"></a>3.开启 fastcgi 进程</h3>
      <figure class="highlight angelscript">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">sudo /usr/bin/spawn-fcgi -a <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> -p <span class="number">9000</span> -C <span class="number">5</span> -u www-data -g www-data -f /usr/bin/php5-cgi -P /var/run/fastcgi-php.pid</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>参数含义如下</p>
      <blockquote>
        <p><em> -f 指定调用 FastCGI 的进程的执行程序位置，根据系统上所装的 PHP 的情况具体设置 </em> -a 绑定到地址 addr <em> -p 绑定到端口 port </em> -s 绑定到 unix socket 的路径 path <em> -C 指定产生的 FastCGI 的进程数，默认为 5（仅用于 PHP） </em> -P 指定产生的进程的 PID 文件路径 * -u 和-g FastCGI 使用什么身份（-u 用户 -g 用户组）运行，Ubuntu 下可以使用 www-data,其他的根据情况配置，如 nobody、apache 等现在可以在 web 根目录下放个探针或 php 文件测试一下了</p>
      </blockquote>
      <p>运行结果类似如下</p>
      <figure class="highlight groovy">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">spawn-<span class="string">fcgi:</span> child spawned <span class="string">successfully:</span> <span class="string">PID:</span> <span class="number">11775</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <h3 id="4-设置开机启动-fastcgi"><a href="#4-设置开机启动-fastcgi" class="headerlink" title="4.设置开机启动 fastcgi"></a>4.设置开机启动 fastcgi</h3>
      <p>修改/etc/rc.local 文件，添加下面一行</p>
      <figure class="highlight angelscript">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">/usr/bin/spawn-fcgi -a <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> -p <span class="number">9000</span> -C <span class="number">5</span> -u www-data -g www-data -f /usr/bin/php5-cgi -P /var/run/fastcgi-php.pid</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>修改完之后，重启 nginx</p>
      <figure class="highlight routeros">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">sudo<span class="built_in"> service </span>nginx restart</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>我们可以在/var/www 目录下新建 index.php 文件测试运行，发现已经可以运行 PHP 文件了。</p>
      <h2 id="测试运行"><a href="#测试运行" class="headerlink" title="测试运行"></a>测试运行</h2>
      <p>所有配置已经完毕，现在我们输入 localhost 和 localhost/phpmyadmin 便可以轻松加愉快地访问了。 如有问题，欢迎交流。</p>
      </p>
    </div>
  </div>
  <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-user"></i>
      </span>
      <span class="post-meta-item-text">作者</span>
      <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      <time title="创建时间：2015-09-11 15:23:36" itemprop="dateCreated datePublished" datetime="2015-09-11T15:23:36+08:00">2015-09-11</time>
    </span>
    <span id="/2036.html" class="post-meta-item leancloud_visitors" data-flag-title="Ubuntu Linux配置Nginx+MySQL+PHP+phpMyAdmin详细步骤" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.9k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
  </div>
</article>

    <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1972.html">
  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.png">
    <meta itemprop="name" content="崔庆才">
    <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  </span>
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="静觅">
  </span>
  <header class="post-header">
    <h2 class="post-title" itemprop="name headline">
      <a class="label"> Python <i class="label-arrow"></i>
      </a>
      <a href="/1972.html" class="post-title-link" itemprop="url">Python爬虫实战六之抓取爱问知识人问题并保存至数据库</a>
    </h2>
  </header>
  <div class="post-body" itemprop="articleBody">
    <div class="thumb">
      <img itemprop="contentUrl" class="random">
    </div>
    <div class="excerpt">
      <p>
      <h2 id="2022-年最新-Python3-网络爬虫教程"><a href="#2022-年最新-Python3-网络爬虫教程" class="headerlink" title="2022 年最新 Python3 网络爬虫教程"></a>2022 年最新 Python3 网络爬虫教程</h2>
      <p>大家好，我是崔庆才，由于爬虫技术不断迭代升级，一些旧的教程已经过时、案例已经过期，最前沿的爬虫技术比如异步、JavaScript 逆向、安卓逆向、智能解析、WebAssembly、大规模分布式、Kubernetes 等技术层出不穷，我最近新出了一套最新最全面的 Python3 网络爬虫系列教程。</p>
      <blockquote>
        <p>博主自荐：截止 2022 年，可以将最前沿最全面的爬虫技术都涵盖的教程，如异步、JavaScript 逆向、安卓逆向、智能解析、WebAssembly、大规模分布式、Kubernetes 等，市面上目前就这一套了。</p>
      </blockquote>
      <p>最新教程对旧的爬虫技术内容进行了全面更新，搭建了全新的案例平台进行全面讲解，保证案例稳定有效不过期。</p>
      <p>教程请移步：</p>
      <p><a href="https://cuiqingcai.com/17777.html">【2022 版】Python3 网络爬虫学习教程</a></p>
      <p>如下为原文。</p>
      <p>大家好，本次为大家带来的是抓取爱问知识人的问题并将问题和答案保存到数据库的方法，涉及的内容包括：</p>
      <ul>
        <li>Urllib 的用法及异常处理</li>
        <li>Beautiful Soup 的简单应用</li>
        <li>MySQLdb 的基础用法</li>
        <li>正则表达式的简单应用</li>
      </ul>
      <h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2>
      <p>在这之前，我们需要先配置一下环境，我的 Python 的版本为 2.7，需要额外安装的库有两个，一个是 Beautiful Soup，一个是 MySQLdb，在这里附上两个库的下载地址， <a href="https://pypi.python.org/pypi/beautifulsoup4/4.3.2" target="_blank" rel="noopener">Beautiful Soup</a> <a href="http://sourceforge.net/projects/mysql-python/" target="_blank" rel="noopener">MySQLdb</a> 大家可以下载之后通过如下命令安装</p>
      <figure class="highlight vim">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="keyword">python</span> setup.<span class="keyword">py</span> install</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>环境配置好之后，我们便可以开心地撸爬虫了</p>
      <h2 id="框架思路"><a href="#框架思路" class="headerlink" title="框架思路"></a>框架思路</h2>
      <p>首先我们随便找一个分类地址，<a href="http://iask.sina.com.cn/c/978-all-1.html" target="_blank" rel="noopener">外语学习 - 爱问知识人</a>，打开之后可以看到一系列的问题列表。 我们在这个页面需要获取的东西有： 总的页码数，每一页的所有问题链接。 接下来我们需要遍历所有的问题，来抓取每一个详情页面，提取问题，问题内容，回答者，回答时间，回答内容。 最后，我们需要把这些内容存储到数据库中。</p>
      <h2 id="要点简析"><a href="#要点简析" class="headerlink" title="要点简析"></a>要点简析</h2>
      <p>其实大部分内容相信大家会了前面的内容，这里的爬虫思路已经融汇贯通了，这里就说一下一些扩展的功能</p>
      <h3 id="1-日志输出"><a href="#1-日志输出" class="headerlink" title="1.日志输出"></a>1.日志输出</h3>
      <p>日志输出，我们要输出时间和爬取的状态，比如像下面这样：</p>
      <blockquote>
        <p>[2015-08-10 03:05:20] 113011 号问题存在其他答案 我个人认为应该是樱桃沟很美的 [2015-08-10 03:05:20] 保存到数据库,此问题的 ID 为 113011 [2015-08-10 03:05:20] 当前爬取第 2 的内容,发现一个问题 百度有一个地方，花儿带着芳香，水儿流淌奔腾是什么意思 多多帮忙哦 回答数量 1 [2015-08-10 03:05:19] 保存到数据库,此问题的 ID 为 113010</p>
      </blockquote>
      <p>所以，我们需要引入时间函数，然后写一个获取当前时间的函数</p>
      <figure class="highlight pgsql">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="keyword">import</span> <span class="type">time</span></span><br><span class="line"></span><br><span class="line">#获取当前时间</span><br><span class="line">def getCurrentTime(self):</span><br><span class="line">    <span class="keyword">return</span> <span class="type">time</span>.strftime(<span class="string">'[%Y-%m-%d %H:%M:%S]'</span>,<span class="type">time</span>.<span class="built_in">localtime</span>(<span class="type">time</span>.time()))</span><br><span class="line"></span><br><span class="line">#获取当前时间</span><br><span class="line">def getCurrentDate(self):</span><br><span class="line">    <span class="keyword">return</span> <span class="type">time</span>.strftime(<span class="string">'%Y-%m-%d'</span>,<span class="type">time</span>.<span class="built_in">localtime</span>(<span class="type">time</span>.time()))</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>以上分别是获取带具体时间和获取日期的函数，在输出时，我们可以在输出语句的前面调用这函数即可。 然后我们需要将缓冲区设置输出到 log 中，在程序的最前面加上这两句即可</p>
      <figure class="highlight ini">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="attr">f_handler</span>=open(<span class="string">'out.log'</span>, <span class="string">'w'</span>)</span><br><span class="line"><span class="attr">sys.stdout</span>=f_handler</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>这样，所有的 print 语句输出的内容就会保存到 out.log 文件中了。</p>
      <h3 id="2-页码保存"><a href="#2-页码保存" class="headerlink" title="2.页码保存"></a>2.页码保存</h3>
      <p>爬虫爬取过程中可能出现各种各样的错误，这样会导致爬虫的中断，如果我们重新运行爬虫，那么就会导致爬虫从头开始运行了，这样显然是不合理的。所以，我们需要把当前爬取的页面保存下来，比如可以保存到文本中，假如爬虫中断了，重新运行爬虫，读取文本文件的内容，接着爬取即可。 大家可以稍微参考一下函数的实现：</p>
      <figure class="highlight routeros">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="comment">#主函数</span></span><br><span class="line">def main(self):</span><br><span class="line">    <span class="attribute">f_handler</span>=open('out.log', <span class="string">'w'</span>)</span><br><span class="line">    sys.<span class="attribute">stdout</span>=f_handler</span><br><span class="line">   <span class="built_in"> page </span>= open(<span class="string">'page.txt'</span>, <span class="string">'r'</span>)</span><br><span class="line">    content = page.readline()</span><br><span class="line">    start_page = int(content.strip()) - 1</span><br><span class="line">    page.close()</span><br><span class="line">    <span class="builtin-name">print</span> self.getCurrentTime(),<span class="string">"开始页码"</span>,start_page</span><br><span class="line">    <span class="builtin-name">print</span> self.getCurrentTime(),<span class="string">"爬虫正在启动,开始爬取爱问知识人问题"</span></span><br><span class="line">    self.total_num = self.getTotalPageNum()</span><br><span class="line">    <span class="builtin-name">print</span> self.getCurrentTime(),<span class="string">"获取到目录页面个数"</span>,self.total_num,<span class="string">"个"</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> start_page:</span><br><span class="line">        start_page = self.total_num</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> range(1,start_page):</span><br><span class="line">        <span class="builtin-name">print</span> self.getCurrentTime(),<span class="string">"正在抓取第"</span>,start_page-x+1,<span class="string">"个页面"</span></span><br><span class="line">        try:</span><br><span class="line">            self.getQuestions(start_page-x+1)</span><br><span class="line">        except urllib2.URLError, e:</span><br><span class="line">            <span class="keyword">if</span> hasattr(e, <span class="string">"reason"</span>):</span><br><span class="line">                <span class="builtin-name">print</span> self.getCurrentTime(),<span class="string">"某总页面内抓取或提取失败,错误原因"</span>, e.reason</span><br><span class="line">        except Exception,e:</span><br><span class="line">            <span class="builtin-name">print</span> self.getCurrentTime(),<span class="string">"某总页面内抓取或提取失败,错误原因:"</span>,e</span><br><span class="line">        <span class="keyword">if</span> start_page-x+1 &lt; start_page:</span><br><span class="line">            <span class="attribute">f</span>=open('page.txt','w')</span><br><span class="line">            f.write(str(start_page-x+1))</span><br><span class="line">            <span class="builtin-name">print</span> self.getCurrentTime(),<span class="string">"写入新页码"</span>,start_page-x+1</span><br><span class="line">            f.close()</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>这样，不管我们爬虫中途遇到什么错误，妈妈也不会担心了</p>
      <h3 id="3-页面处理"><a href="#3-页面处理" class="headerlink" title="3.页面处理"></a>3.页面处理</h3>
      <p>页面处理过程中，我们可能遇到各种各样奇葩的 HTML 代码，和上一节一样，我们沿用一个页面处理类即可。</p>
      <figure class="highlight vbnet">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">import re</span><br><span class="line"></span><br><span class="line"><span class="meta">#处理页面标签类</span></span><br><span class="line"><span class="keyword">class</span> Tool:</span><br><span class="line"></span><br><span class="line">    <span class="meta">#将超链接广告剔除</span></span><br><span class="line">    removeADLink = re.compile(<span class="comment">'<span class="doctag">&lt;div class="link_layer.*?&lt;/div&gt;</span>')</span></span><br><span class="line">    <span class="meta">#去除img标签,1-7位空格,&amp;nbsp;</span></span><br><span class="line">    removeImg = re.compile(<span class="comment">'<span class="doctag">&lt;img.*?&gt;</span>| &#123;1,7&#125;|&amp;nbsp;')</span></span><br><span class="line">    <span class="meta">#删除超链接标签</span></span><br><span class="line">    removeAddr = re.compile(<span class="comment">'<span class="doctag">&lt;a.*?&gt;</span>|<span class="doctag">&lt;/a&gt;</span>')</span></span><br><span class="line">    <span class="meta">#把换行的标签换为\n</span></span><br><span class="line">    replaceLine = re.compile(<span class="comment">'<span class="doctag">&lt;tr&gt;</span>|<span class="doctag">&lt;div&gt;</span>|<span class="doctag">&lt;/div&gt;</span>|<span class="doctag">&lt;/p&gt;</span>')</span></span><br><span class="line">    <span class="meta">#将表格制表&lt;td&gt;替换为\t</span></span><br><span class="line">    replaceTD= re.compile(<span class="comment">'<span class="doctag">&lt;td&gt;</span>')</span></span><br><span class="line">    <span class="meta">#将换行符或双换行符替换为\n</span></span><br><span class="line">    replaceBR = re.compile(<span class="comment">'<span class="doctag">&lt;br&gt;</span><span class="doctag">&lt;br&gt;</span>|<span class="doctag">&lt;br&gt;</span>')</span></span><br><span class="line">    <span class="meta">#将其余标签剔除</span></span><br><span class="line">    removeExtraTag = re.compile(<span class="comment">'<span class="doctag">&lt;.*?&gt;</span>')</span></span><br><span class="line">    <span class="meta">#将多行空行删除</span></span><br><span class="line">    removeNoneLine = re.compile(<span class="comment">'\n+')</span></span><br><span class="line"></span><br><span class="line">    def replace(self,x):</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeADLink,<span class="string">""</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeImg,<span class="string">""</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeAddr,<span class="string">""</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.replaceLine,<span class="string">"\n"</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.replaceTD,<span class="string">"\t"</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.replaceBR,<span class="string">"\n"</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeExtraTag,<span class="string">""</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeNoneLine,<span class="string">"\n"</span>,x)</span><br><span class="line">        <span class="meta">#strip()将前后多余内容删除</span></span><br><span class="line">        <span class="keyword">return</span> x.strip()</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>我们可以用一段含有 HTML 代码的文字，经过调用 replace 方法之后，各种冗余的 HTML 代码就会处理好了。 比如我们这么一段代码：</p>
      <figure class="highlight javascript">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">&lt;article <span class="class"><span class="keyword">class</span></span>=<span class="string">"article-content"</span>&gt;</span><br><span class="line">&lt;h2&gt;前言&lt;<span class="regexp">/h2&gt;</span></span><br><span class="line"><span class="regexp">&lt;p&gt;最近发现MySQL服务隔三差五就会挂掉，导致我的网站和爬虫都无法正常运作。自己的网站是基于MySQL，在做爬虫存取一些资料的时候也是基于MySQL，数据量一大了，MySQL它就有点受不了了，时不时会崩掉，虽然我自己有网站监控和邮件通知，但是好多时候还是需要我来手动连接我的服务器重新启动一下我的MySQL，这样简直太不友好了，所以，我就觉定自己写个脚本，定时监控它，如果发现它挂掉了就重启它。&lt;/</span>p&gt;</span><br><span class="line">&lt;p&gt;好了，闲言碎语不多讲，开始我们的配置之旅。&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">&lt;p&gt;运行环境：&lt;strong&gt;Ubuntu Linux 14.04&lt;/</span>strong&gt;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">&lt;h2&gt;编写Shell脚本&lt;/</span>h2&gt;</span><br><span class="line">&lt;p&gt;首先，我们要编写一个shell脚本，脚本主要执行的逻辑如下：&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">&lt;p&gt;显示mysqld进程状态，如果判断进程未在运行，那么输出日志到文件，然后启动mysql服务，如果进程在运行，那么不执行任何操作，可以选择性输出监测结果。&lt;/</span>p&gt;</span><br><span class="line">&lt;p&gt;可能大家对于shell脚本比较陌生，在这里推荐官方的shell脚本文档来参考一下&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">&lt;p&gt;&lt;a href="http:/</span><span class="regexp">/wiki.ubuntu.org.cn/</span>Shell%E7%BC%<span class="number">96</span>%E7%A8%<span class="number">8</span>B%E5%<span class="number">9</span>F%BA%E7%A1%<span class="number">80</span><span class="string">" data-original-title="</span><span class="string">" title="</span><span class="string">"&gt;Ubuntu Shell 编程基础&lt;/a&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;p&gt;shell脚本的后缀为sh，在任何位置新建一个脚本文件，我选择在 /etc/mysql 目录下新建一个 listen.sh 文件。&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;p&gt;执行如下命令：&lt;/p&gt;</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>经过处理后便会变成如下的样子：</p>
      <figure class="highlight dockerfile">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">前言</span><br><span class="line">最近发现MySQL服务隔三差五就会挂掉，导致我的网站和爬虫都无法正常运作。自己的网站是基于MySQL，在做爬虫存取一些资料的时候也是基于MySQL，数据量一大了，MySQL它就有点受不了了，时不时会崩掉，虽然我自己有网站监控和邮件通知，但是好多时候还是需要我来手动连接我的服务器重新启动一下我的MySQL，这样简直太不友好了，所以，我就觉定自己写个脚本，定时监控它，如果发现它挂掉了就重启它。</span><br><span class="line">好了，闲言碎语不多讲，开始我们的配置之旅。</span><br><span class="line">运行环境：UbuntuLinux14.<span class="number">04</span></span><br><span class="line">编写<span class="keyword">Shell</span><span class="bash">脚本</span></span><br><span class="line">首先，我们要编写一个<span class="keyword">shell</span><span class="bash">脚本，脚本主要执行的逻辑如下：</span></span><br><span class="line">显示mysqld进程状态，如果判断进程未在运行，那么输出日志到文件，然后启动mysql服务，如果进程在运行，那么不执行任何操作，可以选择性输出监测结果。</span><br><span class="line">可能大家对于<span class="keyword">shell</span><span class="bash">脚本比较陌生，在这里推荐官方的shell脚本文档来参考一下</span></span><br><span class="line">UbuntuShell编程基础</span><br><span class="line"><span class="keyword">shell</span><span class="bash">脚本的后缀为sh，在任何位置新建一个脚本文件，我选择在/etc/mysql目录下新建一个listen.sh文件。</span></span><br><span class="line">执行如下命令：</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>经过上面的处理，所有乱乱的代码都会被处理好了。</p>
      <h3 id="4-保存到数据库"><a href="#4-保存到数据库" class="headerlink" title="4.保存到数据库"></a>4.保存到数据库</h3>
      <p>在这里，我们想实现一个通用的方法，就是把存储的一个个内容变成字典的形式，然后执行插入语句的时候，自动构建对应的 sql 语句，插入数据。 比如我们构造如下的字典：</p>
      <figure class="highlight prolog">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">#构造最佳答案的字典</span><br><span class="line">good_ans_dict = &#123;</span><br><span class="line">        <span class="string">"text"</span>: good_ans[<span class="number">0</span>],</span><br><span class="line">        <span class="string">"answerer"</span>: good_ans[<span class="number">1</span>],</span><br><span class="line">        <span class="string">"date"</span>: good_ans[<span class="number">2</span>],</span><br><span class="line">        <span class="string">"is_good"</span>: str(good_ans[<span class="number">3</span>]),</span><br><span class="line">        <span class="string">"question_id"</span>: str(insert_id)</span><br><span class="line">        &#125;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>构造 sql 语句并插入到数据库的方法如下：</p>
      <figure class="highlight php">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="comment">#插入数据</span></span><br><span class="line">    def insertData(<span class="keyword">self</span>, table, my_dict):</span><br><span class="line">         <span class="keyword">try</span>:</span><br><span class="line">             <span class="keyword">self</span>.db.set_character_set(<span class="string">'utf8'</span>)</span><br><span class="line">             cols = <span class="string">', '</span>.join(my_dict.keys())</span><br><span class="line">             values = <span class="string">'"," '</span>.join(my_dict.values())</span><br><span class="line">             sql = <span class="string">"INSERT INTO %s (%s) VALUES (%s)"</span> % (table, cols, <span class="string">'"'</span>+values+<span class="string">'"'</span>)</span><br><span class="line">             <span class="keyword">try</span>:</span><br><span class="line">                 result = <span class="keyword">self</span>.cur.execute(sql)</span><br><span class="line">                 insert_id = <span class="keyword">self</span>.db.insert_id()</span><br><span class="line">                 <span class="keyword">self</span>.db.commit()</span><br><span class="line">                 <span class="comment">#判断是否执行成功</span></span><br><span class="line">                 <span class="keyword">if</span> result:</span><br><span class="line">                     <span class="keyword">return</span> insert_id</span><br><span class="line">                 <span class="keyword">else</span>:</span><br><span class="line">                     <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">             except MySQLdb.Error,e:</span><br><span class="line">                 <span class="comment">#发生错误时回滚</span></span><br><span class="line">                 <span class="keyword">self</span>.db.rollback()</span><br><span class="line">                 <span class="comment">#主键唯一，无法插入</span></span><br><span class="line">                 <span class="keyword">if</span> <span class="string">"key 'PRIMARY'"</span> in e.args[<span class="number">1</span>]:</span><br><span class="line">                     <span class="keyword">print</span> <span class="keyword">self</span>.getCurrentTime(),<span class="string">"数据已存在，未插入数据"</span></span><br><span class="line">                 <span class="keyword">else</span>:</span><br><span class="line">                     <span class="keyword">print</span> <span class="keyword">self</span>.getCurrentTime(),<span class="string">"插入数据失败，原因 %d: %s"</span> % (e.args[<span class="number">0</span>], e.args[<span class="number">1</span>])</span><br><span class="line">         except MySQLdb.Error,e:</span><br><span class="line">             <span class="keyword">print</span> <span class="keyword">self</span>.getCurrentTime(),<span class="string">"数据库错误，原因%d: %s"</span> % (e.args[<span class="number">0</span>], e.args[<span class="number">1</span>])</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>这里我们只需要传入那个字典，便会构建出对应字典键值和键名的 sql 语句，完成插入。</p>
      <h3 id="5-PHP-读取日志"><a href="#5-PHP-读取日志" class="headerlink" title="5.PHP 读取日志"></a>5.PHP 读取日志</h3>
      <p>我们将运行结果输出到了日志里，那么怎么查看日志呢？很简单，在这里提供两种方法 方法一： PHP 倒序输出所有日志内容</p>
      <figure class="highlight xml">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"refresh"</span> <span class="attr">content</span> = <span class="string">"5"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">            $fp = file(<span class="string">"out.log"</span>);</span></span><br><span class="line"><span class="php">            <span class="keyword">if</span> ($fp) &#123;</span></span><br><span class="line"><span class="php">                <span class="keyword">for</span>($i = count($fp) - <span class="number">1</span>;$i &gt;= <span class="number">0</span>; $i --)</span></span><br><span class="line"><span class="php">                <span class="keyword">echo</span> $fp[$i].<span class="string">"&lt;br&gt;"</span>;</span></span><br><span class="line"><span class="php">            &#125;</span></span><br><span class="line"><span class="php">        <span class="meta">?&gt;</span></span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>此方法可以看到所有的输入日志，但是如果日志太大了，那么就会报耗费内存太大，无法输出。为此我们就有了第二种方法，利用 linux 命令，输出后十行内容。 方法二：</p>
      <figure class="highlight xml">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"refresh"</span> <span class="attr">content</span> = <span class="string">"5"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		<span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">			$ph = popen(<span class="string">'tail -n 100 out.log'</span>,<span class="string">'r'</span>);</span></span><br><span class="line"><span class="php">			<span class="keyword">while</span>($r = fgets($ph))&#123;</span></span><br><span class="line"><span class="php">				<span class="keyword">echo</span> $r.<span class="string">"&lt;br&gt;"</span>;</span></span><br><span class="line"><span class="php">			&#125;</span></span><br><span class="line"><span class="php">			pclose($ph);</span></span><br><span class="line"><span class="php">		<span class="meta">?&gt;</span></span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>上面两种方法都是 5 秒刷新一次网页来查看最新的日志。</p>
      <h2 id="源代码放送"><a href="#源代码放送" class="headerlink" title="源代码放送"></a>源代码放送</h2>
      <p>好了，闲言碎语不多讲，直接上源码了</p>
      <figure class="highlight css">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="selector-tag">spider</span><span class="selector-class">.py</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <figure class="highlight python">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> types</span><br><span class="line"><span class="keyword">import</span> page</span><br><span class="line"><span class="keyword">import</span> mysql</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Spider</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#初始化</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.page_num = <span class="number">1</span></span><br><span class="line">        self.total_num = <span class="literal">None</span></span><br><span class="line">        self.page_spider = page.Page()</span><br><span class="line">        self.mysql = mysql.Mysql()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取当前时间</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getCurrentTime</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> time.strftime(<span class="string">'[%Y-%m-%d %H:%M:%S]'</span>,time.localtime(time.time()))</span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取当前时间</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getCurrentDate</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> time.strftime(<span class="string">'%Y-%m-%d'</span>,time.localtime(time.time()))</span><br><span class="line"></span><br><span class="line">    <span class="comment">#通过网页的页码数来构建网页的URL</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getPageURLByNum</span><span class="params">(self, page_num)</span>:</span></span><br><span class="line">        page_url = <span class="string">"http://iask.sina.com.cn/c/978-all-"</span> + str(page_num) + <span class="string">".html"</span></span><br><span class="line">        <span class="keyword">return</span> page_url</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">#通过传入网页页码来获取网页的HTML</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getPageByNum</span><span class="params">(self, page_num)</span>:</span></span><br><span class="line">        request = urllib2.Request(self.getPageURLByNum(page_num))</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response = urllib2.urlopen(request)</span><br><span class="line">        <span class="keyword">except</span> urllib2.URLError, e:</span><br><span class="line">            <span class="keyword">if</span> hasattr(e, <span class="string">"code"</span>):</span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"获取页面失败,错误代号"</span>, e.code</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">            <span class="keyword">if</span> hasattr(e, <span class="string">"reason"</span>):</span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"获取页面失败,原因"</span>, e.reason</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            page =  response.read().decode(<span class="string">"utf-8"</span>)</span><br><span class="line">            <span class="keyword">return</span> page</span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取所有的页码数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getTotalPageNum</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"正在获取目录页面个数,请稍候"</span></span><br><span class="line">        page = self.getPageByNum(<span class="number">1</span>)</span><br><span class="line">        <span class="comment">#匹配所有的页码数,\u4e0b\u4e00\u9875是下一页的UTF8编码</span></span><br><span class="line">        pattern = re.compile(<span class="string">u'&lt;span class="more".*?&gt;.*?&lt;span.*?&lt;a href.*?class=""&gt;(.*?)&lt;/a&gt;\s*&lt;a.*?\u4e0b\u4e00\u9875&lt;/a&gt;'</span>, re.S)</span><br><span class="line">        match = re.search(pattern, page)</span><br><span class="line">        <span class="keyword">if</span> match:</span><br><span class="line">            <span class="keyword">return</span> match.group(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"获取总页码失败"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#分析问题的代码,得到问题的提问者,问题内容,回答个数,提问时间</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getQuestionInfo</span><span class="params">(self, question)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> type(question) <span class="keyword">is</span> types.StringType:</span><br><span class="line">            question = str(question)</span><br><span class="line">        <span class="comment">#print question</span></span><br><span class="line">        pattern = re.compile(<span class="string">u'&lt;span.*?question-face.*?&gt;.*?&lt;img.*?alt="(.*?)".*?&lt;/span&gt;.*?&lt;a href="(.*?)".*?&gt;(.*?)&lt;/a&gt;.*?answer_num.*?&gt;(\d*).*?&lt;/span&gt;.*?answer_time.*?&gt;(.*?)&lt;/span&gt;'</span>, re.S)</span><br><span class="line">        match = re.search(pattern, question)</span><br><span class="line">        <span class="keyword">if</span> match:</span><br><span class="line">            <span class="comment">#获得提问者</span></span><br><span class="line">            author = match.group(<span class="number">1</span>)</span><br><span class="line">            <span class="comment">#问题链接</span></span><br><span class="line">            href = match.group(<span class="number">2</span>)</span><br><span class="line">            <span class="comment">#问题详情</span></span><br><span class="line">            text = match.group(<span class="number">3</span>)</span><br><span class="line">            <span class="comment">#回答个数</span></span><br><span class="line">            ans_num = match.group(<span class="number">4</span>)</span><br><span class="line">            <span class="comment">#回答时间</span></span><br><span class="line">            time = match.group(<span class="number">5</span>)</span><br><span class="line">            time_pattern = re.compile(<span class="string">'\d&#123;4&#125;\-\d&#123;2&#125;\-\d&#123;2&#125;'</span>, re.S)</span><br><span class="line">            time_match = re.search(time_pattern, time)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> time_match:</span><br><span class="line">                time = self.getCurrentDate()</span><br><span class="line">            <span class="keyword">return</span> [author, href, text, ans_num, time]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取全部问题</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getQuestions</span><span class="params">(self, page_num)</span>:</span></span><br><span class="line">        <span class="comment">#获得目录页面的HTML</span></span><br><span class="line">        page = self.getPageByNum(page_num)</span><br><span class="line">        soup = BeautifulSoup(page)</span><br><span class="line">        <span class="comment">#分析获得所有问题</span></span><br><span class="line">        questions = soup.select(<span class="string">"div.question_list ul li"</span>)</span><br><span class="line">        <span class="comment">#遍历每一个问题</span></span><br><span class="line">        <span class="keyword">for</span> question <span class="keyword">in</span> questions:</span><br><span class="line">            <span class="comment">#获得问题的详情</span></span><br><span class="line">            info = self.getQuestionInfo(question)</span><br><span class="line">            <span class="keyword">if</span> info:</span><br><span class="line">                <span class="comment">#得到问题的URL</span></span><br><span class="line">                url = <span class="string">"http://iask.sina.com.cn/"</span> + info[<span class="number">1</span>]</span><br><span class="line">                <span class="comment">#通过URL来获取问题的最佳答案和其他答案</span></span><br><span class="line">                ans = self.page_spider.getAnswer(url)</span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"当前爬取第"</span>,page_num,<span class="string">"的内容,发现一个问题"</span>,info[<span class="number">2</span>],<span class="string">"回答数量"</span>,info[<span class="number">3</span>]</span><br><span class="line">                <span class="comment">#构造问题的字典,插入问题</span></span><br><span class="line">                ques_dict = &#123;</span><br><span class="line">                            <span class="string">"text"</span>: info[<span class="number">2</span>],</span><br><span class="line">                            <span class="string">"questioner"</span>: info[<span class="number">0</span>],</span><br><span class="line">                            <span class="string">"date"</span>: info[<span class="number">4</span>],</span><br><span class="line">                            <span class="string">"ans_num"</span>: info[<span class="number">3</span>],</span><br><span class="line">                            <span class="string">"url"</span>: url</span><br><span class="line">                            &#125;</span><br><span class="line">                <span class="comment">#获得插入的问题的自增ID</span></span><br><span class="line">                insert_id = self.mysql.insertData(<span class="string">"iask_questions"</span>,ques_dict)</span><br><span class="line">                <span class="comment">#得到最佳答案</span></span><br><span class="line">                good_ans = ans[<span class="number">0</span>]</span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"保存到数据库,此问题的ID为"</span>,insert_id</span><br><span class="line">                <span class="comment">#如果存在最佳答案,那么就插入</span></span><br><span class="line">                <span class="keyword">if</span> good_ans:</span><br><span class="line">                    <span class="keyword">print</span> self.getCurrentTime(),insert_id,<span class="string">"号问题存在最佳答案"</span>,good_ans[<span class="number">0</span>]</span><br><span class="line">                    <span class="comment">#构造最佳答案的字典</span></span><br><span class="line">                    good_ans_dict = &#123;</span><br><span class="line">                            <span class="string">"text"</span>: good_ans[<span class="number">0</span>],</span><br><span class="line">                            <span class="string">"answerer"</span>: good_ans[<span class="number">1</span>],</span><br><span class="line">                            <span class="string">"date"</span>: good_ans[<span class="number">2</span>],</span><br><span class="line">                            <span class="string">"is_good"</span>: str(good_ans[<span class="number">3</span>]),</span><br><span class="line">                            <span class="string">"question_id"</span>: str(insert_id)</span><br><span class="line">                            &#125;</span><br><span class="line">                    <span class="comment">#插入最佳答案</span></span><br><span class="line">                    <span class="keyword">if</span> self.mysql.insertData(<span class="string">"iask_answers"</span>,good_ans_dict):</span><br><span class="line">                        <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"保存最佳答案成功"</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"保存最佳答案失败"</span></span><br><span class="line">                <span class="comment">#获得其他答案</span></span><br><span class="line">                other_anses = ans[<span class="number">1</span>]</span><br><span class="line">                <span class="comment">#遍历每一个其他答案</span></span><br><span class="line">                <span class="keyword">for</span> other_ans <span class="keyword">in</span> other_anses:</span><br><span class="line">                    <span class="comment">#如果答案存在</span></span><br><span class="line">                    <span class="keyword">if</span> other_ans:</span><br><span class="line">                        <span class="keyword">print</span> self.getCurrentTime(),insert_id,<span class="string">"号问题存在其他答案"</span>,other_ans[<span class="number">0</span>]</span><br><span class="line">                        <span class="comment">#构造其他答案的字典</span></span><br><span class="line">                        other_ans_dict = &#123;</span><br><span class="line">                                <span class="string">"text"</span>: other_ans[<span class="number">0</span>],</span><br><span class="line">                                <span class="string">"answerer"</span>: other_ans[<span class="number">1</span>],</span><br><span class="line">                                <span class="string">"date"</span>: other_ans[<span class="number">2</span>],</span><br><span class="line">                                <span class="string">"is_good"</span>: str(other_ans[<span class="number">3</span>]),</span><br><span class="line">                                <span class="string">"question_id"</span>: str(insert_id)</span><br><span class="line">                                &#125;</span><br><span class="line">                        <span class="comment">#插入这个答案</span></span><br><span class="line">                        <span class="keyword">if</span> self.mysql.insertData(<span class="string">"iask_answers"</span>,other_ans_dict):</span><br><span class="line">                            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"保存其他答案成功"</span></span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"保存其他答案失败"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#主函数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(self)</span>:</span></span><br><span class="line">        f_handler=open(<span class="string">'out.log'</span>, <span class="string">'w'</span>)</span><br><span class="line">        sys.stdout=f_handler</span><br><span class="line">        page = open(<span class="string">'page.txt'</span>, <span class="string">'r'</span>)</span><br><span class="line">        content = page.readline()</span><br><span class="line">        start_page = int(content.strip()) - <span class="number">1</span></span><br><span class="line">        page.close()</span><br><span class="line">        <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"开始页码"</span>,start_page</span><br><span class="line">        <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"爬虫正在启动,开始爬取爱问知识人问题"</span></span><br><span class="line">        self.total_num = self.getTotalPageNum()</span><br><span class="line">        <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"获取到目录页面个数"</span>,self.total_num,<span class="string">"个"</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> start_page:</span><br><span class="line">            start_page = self.total_num</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">1</span>,start_page):</span><br><span class="line">            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"正在抓取第"</span>,start_page-x+<span class="number">1</span>,<span class="string">"个页面"</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                self.getQuestions(start_page-x+<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">except</span> urllib2.URLError, e:</span><br><span class="line">                <span class="keyword">if</span> hasattr(e, <span class="string">"reason"</span>):</span><br><span class="line">                    <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"某总页面内抓取或提取失败,错误原因"</span>, e.reason</span><br><span class="line">            <span class="keyword">except</span> Exception,e:</span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"某总页面内抓取或提取失败,错误原因:"</span>,e</span><br><span class="line">            <span class="keyword">if</span> start_page-x+<span class="number">1</span> &lt; start_page:</span><br><span class="line">                f=open(<span class="string">'page.txt'</span>,<span class="string">'w'</span>)</span><br><span class="line">                f.write(str(start_page-x+<span class="number">1</span>))</span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"写入新页码"</span>,start_page-x+<span class="number">1</span></span><br><span class="line">                f.close()</span><br><span class="line"></span><br><span class="line">spider = Spider()</span><br><span class="line">spider.main()</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <figure class="highlight css">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="selector-tag">page</span><span class="selector-class">.py</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <figure class="highlight properties">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="attr">import</span> <span class="string">urllib</span></span><br><span class="line"><span class="attr">import</span> <span class="string">urllib2</span></span><br><span class="line"><span class="attr">import</span> <span class="string">re</span></span><br><span class="line"><span class="attr">import</span> <span class="string">time</span></span><br><span class="line"><span class="attr">import</span> <span class="string">types</span></span><br><span class="line"><span class="attr">import</span> <span class="string">tool</span></span><br><span class="line"><span class="attr">from</span> <span class="string">bs4 import BeautifulSoup</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#抓取分析某一问题和答案</span></span><br><span class="line"><span class="attr">class</span> <span class="string">Page:</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">def</span> <span class="string">__init__(self):</span></span><br><span class="line">        <span class="meta">self.tool</span> = <span class="string">tool.Tool()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">    #获取当前时间</span></span><br><span class="line">    <span class="attr">def</span> <span class="string">getCurrentDate(self):</span></span><br><span class="line">        <span class="attr">return</span> <span class="string">time.strftime('%Y-%m-%d',time.localtime(time.time()))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">    #获取当前时间</span></span><br><span class="line">    <span class="attr">def</span> <span class="string">getCurrentTime(self):</span></span><br><span class="line">        <span class="attr">return</span> <span class="string">time.strftime('[%Y-%m-%d %H:%M:%S]',time.localtime(time.time()))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">    #通过页面的URL来获取页面的代码</span></span><br><span class="line">    <span class="attr">def</span> <span class="string">getPageByURL(self, url):</span></span><br><span class="line">        <span class="attr">try</span>:<span class="string"></span></span><br><span class="line">            <span class="attr">request</span> = <span class="string">urllib2.Request(url)</span></span><br><span class="line">            <span class="attr">response</span> = <span class="string">urllib2.urlopen(request)</span></span><br><span class="line">            <span class="attr">return</span> <span class="string">response.read().decode("utf-8")</span></span><br><span class="line">        <span class="attr">except</span> <span class="string">urllib2.URLError, e:</span></span><br><span class="line">            <span class="attr">if</span> <span class="string">hasattr(e, "code"):</span></span><br><span class="line">                <span class="attr">print</span> <span class="string">self.getCurrentTime(),"获取问题页面失败,错误代号", e.code</span></span><br><span class="line">                <span class="attr">return</span> <span class="string">None</span></span><br><span class="line">            <span class="attr">if</span> <span class="string">hasattr(e, "reason"):</span></span><br><span class="line">                <span class="attr">print</span> <span class="string">self.getCurrentTime(),"获取问题页面失败,原因", e.reason</span></span><br><span class="line">                <span class="attr">return</span> <span class="string">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">    #传入一个List,返回它的标签里的内容,如果为空返回None</span></span><br><span class="line">    <span class="attr">def</span> <span class="string">getText(self, html):</span></span><br><span class="line">        <span class="attr">if</span> <span class="string">not type(html) is types.StringType:</span></span><br><span class="line">            <span class="attr">html</span> = <span class="string">str(html)</span></span><br><span class="line"><span class="comment">        #提取出&lt;pre&gt;标签里的内容</span></span><br><span class="line">        <span class="attr">pattern</span> = <span class="string">re.compile('&lt;pre.*?&gt;(.*?)&lt;/pre&gt;', re.S)</span></span><br><span class="line">        <span class="attr">match</span> = <span class="string">re.search(pattern, html)</span></span><br><span class="line"><span class="comment">        #如果匹配成功</span></span><br><span class="line">        <span class="attr">if</span> <span class="string">match:</span></span><br><span class="line">            <span class="attr">return</span> <span class="string">match.group(1)</span></span><br><span class="line">        <span class="attr">else</span>:<span class="string"></span></span><br><span class="line">            <span class="attr">return</span> <span class="string">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment">    #传入最佳答案的HTML,分析出回答者和回答时间</span></span><br><span class="line">    <span class="attr">def</span> <span class="string">getGoodAnswerInfo(self, html):</span></span><br><span class="line">        <span class="attr">pattern</span> = <span class="string">re.compile('"answer_tip.*?&lt;a.*?&gt;(.*?)&lt;/a&gt;.*?&lt;span class="time.*?&gt;.*?\|(.*?)&lt;/span&gt;', re.S)</span></span><br><span class="line">        <span class="attr">match</span> = <span class="string">re.search(pattern, html)</span></span><br><span class="line"><span class="comment">        #如果匹配,返回回答者和回答时间</span></span><br><span class="line">        <span class="attr">if</span> <span class="string">match:</span></span><br><span class="line">            <span class="attr">time</span> = <span class="string">match.group(2)</span></span><br><span class="line">            <span class="attr">time_pattern</span> = <span class="string">re.compile('\d&#123;2&#125;\-\d&#123;2&#125;\-\d&#123;2&#125;', re.S)</span></span><br><span class="line">            <span class="attr">time_match</span> = <span class="string">re.search(time_pattern, time)</span></span><br><span class="line">            <span class="attr">if</span> <span class="string">not time_match:</span></span><br><span class="line">                <span class="attr">time</span> = <span class="string">self.getCurrentDate()</span></span><br><span class="line">            <span class="attr">else</span>:<span class="string"></span></span><br><span class="line">                <span class="attr">time</span> = <span class="string">"20"+time</span></span><br><span class="line">            <span class="attr">return</span> <span class="string">[match.group(1),time]</span></span><br><span class="line">        <span class="attr">else</span>:<span class="string"></span></span><br><span class="line">            <span class="attr">return</span> <span class="string">[None,None]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">    #获得最佳答案</span></span><br><span class="line">    <span class="attr">def</span> <span class="string">getGoodAnswer(self, page):</span></span><br><span class="line">        <span class="attr">soup</span> = <span class="string">BeautifulSoup(page)</span></span><br><span class="line">        <span class="attr">text</span> = <span class="string">soup.select("div.good_point div.answer_text pre")</span></span><br><span class="line">        <span class="attr">if</span> <span class="string">len(text) &gt; 0:</span></span><br><span class="line"><span class="comment">            #获得最佳答案的内容</span></span><br><span class="line">            <span class="attr">ansText</span> = <span class="string">self.getText(str(text[0]))</span></span><br><span class="line">            <span class="attr">ansText</span> = <span class="string">self.tool.replace(ansText)</span></span><br><span class="line"><span class="comment">            #获得最佳答案的回答者信息</span></span><br><span class="line">            <span class="attr">info</span> = <span class="string">soup.select("div.good_point div.answer_tip")</span></span><br><span class="line">            <span class="attr">ansInfo</span> = <span class="string">self.getGoodAnswerInfo(str(info[0]))</span></span><br><span class="line"><span class="comment">            #将三者组合成一个List</span></span><br><span class="line">            <span class="attr">answer</span> = <span class="string">[ansText, ansInfo[0], ansInfo[1],1]</span></span><br><span class="line">            <span class="attr">return</span> <span class="string">answer</span></span><br><span class="line">        <span class="attr">else</span>:<span class="string"></span></span><br><span class="line"><span class="comment">            #如果不存在最佳答案,那么就返回空</span></span><br><span class="line">            <span class="attr">return</span> <span class="string">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment">    #传入回答者HTML,分析出回答者,回答时间</span></span><br><span class="line">    <span class="attr">def</span> <span class="string">getOtherAnswerInfo(self, html):</span></span><br><span class="line">        <span class="attr">if</span> <span class="string">not type(html) is types.StringType:</span></span><br><span class="line">            <span class="attr">html</span> = <span class="string">str(html)</span></span><br><span class="line">        <span class="attr">pattern</span> = <span class="string">re.compile('"author_name.*?&gt;(.*?)&lt;/a&gt;.*?answer_t"&gt;(.*?)&lt;/span&gt;', re.S)</span></span><br><span class="line">        <span class="attr">match</span> = <span class="string">re.search(pattern, html)</span></span><br><span class="line"><span class="comment">        #获得每一个回答的回答者信息和回答时间</span></span><br><span class="line">        <span class="attr">if</span> <span class="string">match:</span></span><br><span class="line">            <span class="attr">time</span> = <span class="string">match.group(2)</span></span><br><span class="line">            <span class="attr">time_pattern</span> = <span class="string">re.compile('\d&#123;2&#125;\-\d&#123;2&#125;\-\d&#123;2&#125;', re.S)</span></span><br><span class="line">            <span class="attr">time_match</span> = <span class="string">re.search(time_pattern, time)</span></span><br><span class="line">            <span class="attr">if</span> <span class="string">not time_match:</span></span><br><span class="line">                <span class="attr">time</span> = <span class="string">self.getCurrentDate()</span></span><br><span class="line">            <span class="attr">else</span>:<span class="string"></span></span><br><span class="line">                <span class="attr">time</span> = <span class="string">"20"+time</span></span><br><span class="line">            <span class="attr">return</span> <span class="string">[match.group(1),time]</span></span><br><span class="line">        <span class="attr">else</span>:<span class="string"></span></span><br><span class="line">            <span class="attr">return</span> <span class="string">[None,None]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">    #获得其他答案</span></span><br><span class="line">    <span class="attr">def</span> <span class="string">getOtherAnswers(self, page):</span></span><br><span class="line">        <span class="attr">soup</span> = <span class="string">BeautifulSoup(page)</span></span><br><span class="line">        <span class="attr">results</span> =  <span class="string">soup.select("div.question_box li.clearfix .answer_info")</span></span><br><span class="line"><span class="comment">        #所有答案,包含好多个List,每个List包含了回答内容,回答者,回答时间</span></span><br><span class="line">        <span class="attr">answers</span> = <span class="string">[]</span></span><br><span class="line">        <span class="attr">for</span> <span class="string">result in results:</span></span><br><span class="line"><span class="comment">            #获得回答内容</span></span><br><span class="line">            <span class="attr">ansSoup</span> = <span class="string">BeautifulSoup(str(result))</span></span><br><span class="line">            <span class="attr">text</span> = <span class="string">ansSoup.select(".answer_txt span pre")</span></span><br><span class="line">            <span class="attr">ansText</span> = <span class="string">self.getText(str(text[0]))</span></span><br><span class="line">            <span class="attr">ansText</span> = <span class="string">self.tool.replace(ansText)</span></span><br><span class="line"><span class="comment">            #获得回答者和回答时间</span></span><br><span class="line">            <span class="attr">info</span> = <span class="string">ansSoup.select(".answer_tj")</span></span><br><span class="line">            <span class="attr">ansInfo</span> = <span class="string">self.getOtherAnswerInfo(info[0])</span></span><br><span class="line"><span class="comment">            #将三者组合成一个List</span></span><br><span class="line">            <span class="attr">answer</span> = <span class="string">[ansText, ansInfo[0], ansInfo[1],0]</span></span><br><span class="line"><span class="comment">            #加入到answers</span></span><br><span class="line">            <span class="attr">answers.append(answer)</span></span><br><span class="line">        <span class="attr">return</span> <span class="string">answers</span></span><br><span class="line"></span><br><span class="line"><span class="comment">     #主函数</span></span><br><span class="line">    <span class="attr">def</span> <span class="string">getAnswer(self, url):</span></span><br><span class="line">        <span class="attr">if</span> <span class="string">not url:</span></span><br><span class="line">            <span class="attr">url</span> = <span class="string">"http://iask.sina.com.cn/b/gQiuSNCMV.html"</span></span><br><span class="line">        <span class="attr">page</span> = <span class="string">self.getPageByURL(url)</span></span><br><span class="line">        <span class="attr">good_ans</span> = <span class="string">self.getGoodAnswer(page)</span></span><br><span class="line">        <span class="attr">other_ans</span> = <span class="string">self.getOtherAnswers(page)</span></span><br><span class="line">        <span class="attr">return</span> <span class="string">[good_ans,other_ans]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">page</span> = <span class="string">Page()</span></span><br><span class="line"><span class="attr">page.getAnswer(None)</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <figure class="highlight css">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="selector-tag">tool</span><span class="selector-class">.py</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <figure class="highlight vbnet">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="meta">#-*- coding:utf-8 -*-</span></span><br><span class="line">import re</span><br><span class="line"></span><br><span class="line"><span class="meta">#处理页面标签类</span></span><br><span class="line"><span class="keyword">class</span> Tool:</span><br><span class="line"></span><br><span class="line">    <span class="meta">#将超链接广告剔除</span></span><br><span class="line">    removeADLink = re.compile(<span class="comment">'<span class="doctag">&lt;div class="link_layer.*?&lt;/div&gt;</span>')</span></span><br><span class="line">    <span class="meta">#去除img标签,1-7位空格,&amp;nbsp;</span></span><br><span class="line">    removeImg = re.compile(<span class="comment">'<span class="doctag">&lt;img.*?&gt;</span>| &#123;1,7&#125;|&amp;nbsp;')</span></span><br><span class="line">    <span class="meta">#删除超链接标签</span></span><br><span class="line">    removeAddr = re.compile(<span class="comment">'<span class="doctag">&lt;a.*?&gt;</span>|<span class="doctag">&lt;/a&gt;</span>')</span></span><br><span class="line">    <span class="meta">#把换行的标签换为\n</span></span><br><span class="line">    replaceLine = re.compile(<span class="comment">'<span class="doctag">&lt;tr&gt;</span>|<span class="doctag">&lt;div&gt;</span>|<span class="doctag">&lt;/div&gt;</span>|<span class="doctag">&lt;/p&gt;</span>')</span></span><br><span class="line">    <span class="meta">#将表格制表&lt;td&gt;替换为\t</span></span><br><span class="line">    replaceTD= re.compile(<span class="comment">'<span class="doctag">&lt;td&gt;</span>')</span></span><br><span class="line">    <span class="meta">#将换行符或双换行符替换为\n</span></span><br><span class="line">    replaceBR = re.compile(<span class="comment">'<span class="doctag">&lt;br&gt;</span><span class="doctag">&lt;br&gt;</span>|<span class="doctag">&lt;br&gt;</span>')</span></span><br><span class="line">    <span class="meta">#将其余标签剔除</span></span><br><span class="line">    removeExtraTag = re.compile(<span class="comment">'<span class="doctag">&lt;.*?&gt;</span>')</span></span><br><span class="line">    <span class="meta">#将多行空行删除</span></span><br><span class="line">    removeNoneLine = re.compile(<span class="comment">'\n+')</span></span><br><span class="line"></span><br><span class="line">    def replace(self,x):</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeADLink,<span class="string">""</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeImg,<span class="string">""</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeAddr,<span class="string">""</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.replaceLine,<span class="string">"\n"</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.replaceTD,<span class="string">"\t"</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.replaceBR,<span class="string">"\n"</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeExtraTag,<span class="string">""</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeNoneLine,<span class="string">"\n"</span>,x)</span><br><span class="line">        <span class="meta">#strip()将前后多余内容删除</span></span><br><span class="line">        <span class="keyword">return</span> x.strip()</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <figure class="highlight css">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="selector-tag">mysql</span><span class="selector-class">.py</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <figure class="highlight ruby">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import MySQLdb</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mysql</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取当前时间</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getCurrentTime</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> time.strftime(<span class="string">'[%Y-%m-%d %H:%M:%S]'</span>,time.localtime(time.time()))</span><br><span class="line"></span><br><span class="line">    <span class="comment">#数据库初始化</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="symbol">try:</span></span><br><span class="line">            <span class="keyword">self</span>.db = MySQLdb.connect(<span class="string">'ip'</span>,<span class="string">'username'</span>,<span class="string">'password'</span>,<span class="string">'db_name'</span>)</span><br><span class="line">            <span class="keyword">self</span>.cur = <span class="keyword">self</span>.db.cursor()</span><br><span class="line">        except MySQLdb.Error,<span class="symbol">e:</span></span><br><span class="line">             print <span class="keyword">self</span>.getCurrentTime(),<span class="string">"连接数据库错误，原因%d: %s"</span> % (e.args[<span class="number">0</span>], e.args[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment">#插入数据</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insertData</span><span class="params">(<span class="keyword">self</span>, table, my_dict)</span></span><span class="symbol">:</span></span><br><span class="line">         <span class="symbol">try:</span></span><br><span class="line">             <span class="keyword">self</span>.db.set_character_set(<span class="string">'utf8'</span>)</span><br><span class="line">             cols = <span class="string">', '</span>.join(my_dict.keys())</span><br><span class="line">             values = <span class="string">'"," '</span>.join(my_dict.values())</span><br><span class="line">             sql = <span class="string">"INSERT INTO %s (%s) VALUES (%s)"</span> % (table, cols, <span class="string">'"'</span>+values+<span class="string">'"'</span>)</span><br><span class="line">             <span class="symbol">try:</span></span><br><span class="line">                 result = <span class="keyword">self</span>.cur.execute(sql)</span><br><span class="line">                 insert_id = <span class="keyword">self</span>.db.insert_id()</span><br><span class="line">                 <span class="keyword">self</span>.db.commit()</span><br><span class="line">                 <span class="comment">#判断是否执行成功</span></span><br><span class="line">                 <span class="keyword">if</span> <span class="symbol">result:</span></span><br><span class="line">                     <span class="keyword">return</span> insert_id</span><br><span class="line">                 <span class="symbol">else:</span></span><br><span class="line">                     <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">             except MySQLdb.Error,<span class="symbol">e:</span></span><br><span class="line">                 <span class="comment">#发生错误时回滚</span></span><br><span class="line">                 <span class="keyword">self</span>.db.rollback()</span><br><span class="line">                 <span class="comment">#主键唯一，无法插入</span></span><br><span class="line">                 <span class="keyword">if</span> <span class="string">"key 'PRIMARY'"</span> <span class="keyword">in</span> e.args[<span class="number">1</span>]<span class="symbol">:</span></span><br><span class="line">                     print <span class="keyword">self</span>.getCurrentTime(),<span class="string">"数据已存在，未插入数据"</span></span><br><span class="line">                 <span class="symbol">else:</span></span><br><span class="line">                     print <span class="keyword">self</span>.getCurrentTime(),<span class="string">"插入数据失败，原因 %d: %s"</span> % (e.args[<span class="number">0</span>], e.args[<span class="number">1</span>])</span><br><span class="line">         except MySQLdb.Error,<span class="symbol">e:</span></span><br><span class="line">             print <span class="keyword">self</span>.getCurrentTime(),<span class="string">"数据库错误，原因%d: %s"</span> % (e.args[<span class="number">0</span>], e.args[<span class="number">1</span>])</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>数据库建表 SQL 如下：</p>
      <figure class="highlight sql">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> <span class="string">`iask_answers`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">'自增ID'</span>,</span><br><span class="line">  <span class="string">`text`</span> <span class="built_in">text</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'回答内容'</span>,</span><br><span class="line">  <span class="string">`question_id`</span> <span class="built_in">int</span>(<span class="number">18</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'问题ID'</span>,</span><br><span class="line">  <span class="string">`answerer`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'回答者'</span>,</span><br><span class="line">  <span class="string">`date`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'回答时间'</span>,</span><br><span class="line">  <span class="string">`is_good`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'是否是最佳答案'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span>  <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> <span class="string">`iask_questions`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">'问题ID'</span>,</span><br><span class="line">  <span class="string">`text`</span> <span class="built_in">text</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'问题内容'</span>,</span><br><span class="line">  <span class="string">`questioner`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'提问者'</span>,</span><br><span class="line">  <span class="string">`date`</span> <span class="built_in">date</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'提问时间'</span>,</span><br><span class="line">  <span class="string">`ans_num`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'回答数量'</span>,</span><br><span class="line">  <span class="string">`url`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'问题链接'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span>  <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>运行的时候执行如下命令即可</p>
      <figure class="highlight vim">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">nohup <span class="keyword">python</span> spider.<span class="keyword">py</span> &amp;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>代码写的不好，仅供大家学习参考使用，如有问题，欢迎留言交流。</p>
      <h2 id="运行结果查看"><a href="#运行结果查看" class="headerlink" title="运行结果查看"></a>运行结果查看</h2>
      <p>我们把 PHP 文件和 log 文件放在同一目录下，运行 PHP 文件，便可以看到如下的内容： <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150908222744.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150908222744.png" alt="20150908222744"></a> 小伙伴们赶快试一下吧。</p>
      </p>
    </div>
  </div>
  <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-user"></i>
      </span>
      <span class="post-meta-item-text">作者</span>
      <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      <time title="创建时间：2015-09-08 22:24:33" itemprop="dateCreated datePublished" datetime="2015-09-08T22:24:33+08:00">2015-09-08</time>
    </span>
    <span id="/1972.html" class="post-meta-item leancloud_visitors" data-flag-title="Python爬虫实战六之抓取爱问知识人问题并保存至数据库" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>18k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>16 分钟</span>
    </span>
  </div>
</article>

    <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1981.html">
  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.png">
    <meta itemprop="name" content="崔庆才">
    <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  </span>
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="静觅">
  </span>
  <header class="post-header">
    <h2 class="post-title" itemprop="name headline">
      <a class="label"> Other <i class="label-arrow"></i>
      </a>
      <a href="/1981.html" class="post-title-link" itemprop="url">Ubuntu Linux下定时监测MySQL进程终止时自动重启的方法</a>
    </h2>
  </header>
  <div class="post-body" itemprop="articleBody">
    <div class="thumb">
      <img itemprop="contentUrl" class="random">
    </div>
    <div class="excerpt">
      <p>
      <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2>
      <p>最近发现 MySQL 服务隔三差五就会挂掉，导致我的网站和爬虫都无法正常运作。自己的网站是基于 MySQL，在做爬虫存取一些资料的时候也是基于 MySQL，数据量一大了，MySQL 它就有点受不了了，时不时会崩掉，虽然我自己有网站监控和邮件通知，但是好多时候还是需要我来手动连接我的服务器重新启动一下我的 MySQL，这样简直太不友好了，所以，我就觉定自己写个脚本，定时监控它，如果发现它挂掉了就重启它。 好了，闲言碎语不多讲，开始我们的配置之旅。 运行环境：<strong>Ubuntu Linux 14.04</strong></p>
      <h2 id="编写-Shell-脚本"><a href="#编写-Shell-脚本" class="headerlink" title="编写 Shell 脚本"></a>编写 Shell 脚本</h2>
      <p>首先，我们要编写一个 shell 脚本，脚本主要执行的逻辑如下： 显示 mysqld 进程状态，如果判断进程未在运行，那么输出日志到文件，然后启动 mysql 服务，如果进程在运行，那么不执行任何操作，可以选择性输出监测结果。 可能大家对于 shell 脚本比较陌生，在这里推荐官方的 shell 脚本文档来参考一下 <a href="http://wiki.ubuntu.org.cn/Shell%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80" target="_blank" rel="noopener">Ubuntu Shell 编程基础</a> shell 脚本的后缀为 sh，在任何位置新建一个脚本文件，我选择在 /etc/mysql 目录下新建一个 listen.sh 文件。 执行如下命令：</p>
      <figure class="highlight vim">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="keyword">cd</span> /etc/mysql</span><br><span class="line">touch listen.<span class="keyword">sh</span></span><br><span class="line"><span class="keyword">vi</span> listen.<span class="keyword">sh</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>进入到 vi 中，我们添加如下脚本内容：</p>
      <figure class="highlight bash">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">pgrep mysqld &amp;&gt; /dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? -gt 0 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"`date` mysql is stop"</span></span><br><span class="line">service mysql start</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"`date` mysql running"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>其中 pgrep mysqld 是监测 mysqld 服务的运行状态，&amp;&gt; /dev/null 是将其结果输出到空文件，也就是不保存输出信息 $? 是拿到上一条命令的运行结果，-gt 0 是判断是否大于 0，后面则是输出时间到日志文件，然后启动 mysql，否则不启动 mysql 保存好了，那么我们执行如下的命令，来测试一下。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/08/20150816164552.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/08/20150816164552.jpg" alt="20150816164552"></a> 贴心的命令文字版本：</p>
      <figure class="highlight elixir">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">root<span class="variable">@iZ28uogb3laZ</span><span class="symbol">:/etc/mysql</span><span class="comment"># vi listen.sh</span></span><br><span class="line">root<span class="variable">@iZ28uogb3laZ</span><span class="symbol">:/etc/mysql</span><span class="comment"># pgrep mysqld</span></span><br><span class="line"><span class="number">3359</span></span><br><span class="line">root<span class="variable">@iZ28uogb3laZ</span><span class="symbol">:/etc/mysql</span><span class="comment"># chmod 777 listen.sh</span></span><br><span class="line">root<span class="variable">@iZ28uogb3laZ</span><span class="symbol">:/etc/mysql</span><span class="comment"># ./listen.sh</span></span><br><span class="line">Sun Aug <span class="number">16 16</span><span class="symbol">:</span><span class="number">44:58</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">root<span class="variable">@iZ28uogb3laZ</span><span class="symbol">:/etc/mysql</span><span class="comment"># sudo service mysql stop</span></span><br><span class="line">mysql stop/waiting</span><br><span class="line">root<span class="variable">@iZ28uogb3laZ</span><span class="symbol">:/etc/mysql</span><span class="comment"># ./listen.sh</span></span><br><span class="line">Sun Aug <span class="number">16 16</span><span class="symbol">:</span><span class="number">45:17</span> CST <span class="number">2015</span> mysql is stop</span><br><span class="line">mysql start/running, process <span class="number">4084</span></span><br><span class="line">root<span class="variable">@iZ28uogb3laZ</span><span class="symbol">:/etc/mysql</span><span class="comment"># ./listen.sh</span></span><br><span class="line">Sun Aug <span class="number">16 16</span><span class="symbol">:</span><span class="number">45:24</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">root<span class="variable">@iZ28uogb3laZ</span><span class="symbol">:/etc/mysql</span><span class="comment">#</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>嗯，编辑完了.sh 文件之后，我们首先要对其进行授权，增加可执行的权限。</p>
      <figure class="highlight lsl">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">sudo chmod <span class="number">777</span> <span class="section">listen</span>.sh</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>然后运行脚本测试一下，显示 mysql 正在运行。把 mysql 关掉，运行脚本，便会检测到 mysql 已关闭，然后重新启动了 mysql，再次运行，便会发现 mysql 正常运行了。 <strong>注：这里我比较纳闷 shell 脚本中 pgrep mysqld 的返回结果是什么。为什么它大于 0 便代表 mysql 服务挂掉了呢？感觉逻辑有点是相反的，不过实测可用有效。如果大家明白为什么，非常希望您可以给我一个解释。</strong></p>
      <h2 id="修改日志输出"><a href="#修改日志输出" class="headerlink" title="修改日志输出"></a>修改日志输出</h2>
      <p>好，接下来我们把输出的内容保存到日志里。修改脚本文件如下</p>
      <figure class="highlight bash">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">pgrep mysqld &amp;&gt; /dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? -gt 0 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"`date` mysql is stop"</span> &gt;&gt; /var/<span class="built_in">log</span>/mysql_listen.log</span><br><span class="line">service mysql start</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"`date` mysql running"</span> &gt;&gt; /var/<span class="built_in">log</span>/mysql_listen.log</span><br><span class="line"><span class="keyword">fi</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>这样，每执行一次脚本，输出结果都会被保存到 /var/log/mysql_listen.log 中了。</p>
      <h2 id="添加定时任务"><a href="#添加定时任务" class="headerlink" title="添加定时任务"></a>添加定时任务</h2>
      <p>好了，脚本可以顺利执行了，那么我们就需要定时调用一下这个脚本来运行了，我们需要用到 cron。 首先我们需要编辑一下 corn 调度表格，命令如下：</p>
      <figure class="highlight ebnf">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="attribute">crontab -e</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>如果你是第一次编辑这个，他会让你选择文件打开方式，随便选一个数字就好了。 比如我们用 GNU 打开的，我们就在它的最后一行添加下面的一句话即可。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/08/20150816165506.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/08/20150816165506.jpg" alt="20150816165506"></a>、 文字版本：</p>
      <figure class="highlight awk">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">*<span class="regexp">/5 * * * * /</span>etc<span class="regexp">/mysql/my</span>sql_listen.sh</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>/5 代表五分钟执行一次，后面的四个点依次代表了，小时，日，月，星期。如果想要时间长一些，比如一小时调度一次，那就设置一下后面第一个*就好了。 好，保存一下，重启 cron 服务。</p>
      <figure class="highlight ebnf">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="attribute">service cron restart</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>嗯，调度任务已经添加进去了，这样，每五分钟系统就会调用一下刚才写的那个脚本。 过一段时间，我们来看一下运行效果，嗯，监控跑的很顺利呐。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/08/20150816165858.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/08/20150816165858.jpg" alt="20150816165858"></a> 文字版本：</p>
      <figure class="highlight angelscript">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">Sun Aug <span class="number">16</span> <span class="number">15</span>:<span class="number">39</span>:<span class="number">12</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">15</span>:<span class="number">45</span>:<span class="number">02</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">15</span>:<span class="number">50</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">15</span>:<span class="number">55</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">16</span>:<span class="number">00</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">16</span>:<span class="number">05</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">16</span>:<span class="number">15</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">16</span>:<span class="number">20</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">16</span>:<span class="number">25</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">16</span>:<span class="number">30</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">16</span>:<span class="number">35</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">16</span>:<span class="number">40</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">16</span>:<span class="number">51</span>:<span class="number">04</span> CST <span class="number">2015</span> mysql running</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>哈哈，是不是五分钟监测了一次呢？大功告成。</p>
      <h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2>
      <p>这样，我们就实现了五分钟定时检测 MySQL 进程服务，妈妈再也不用担心我的网站会宕掉啦。 如有问题，欢迎留言交流，谢谢啦。</p>
      </p>
    </div>
  </div>
  <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-user"></i>
      </span>
      <span class="post-meta-item-text">作者</span>
      <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      <time title="创建时间：2015-08-16 17:06:30" itemprop="dateCreated datePublished" datetime="2015-08-16T17:06:30+08:00">2015-08-16</time>
    </span>
    <span id="/1981.html" class="post-meta-item leancloud_visitors" data-flag-title="Ubuntu Linux下定时监测MySQL进程终止时自动重启的方法" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.9k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
  </div>
</article>

    <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1934.html">
  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.png">
    <meta itemprop="name" content="崔庆才">
    <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  </span>
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="静觅">
  </span>
  <header class="post-header">
    <h2 class="post-title" itemprop="name headline">
      <a class="label"> C/C++ <i class="label-arrow"></i>
      </a>
      <a href="/1934.html" class="post-title-link" itemprop="url">C语言小知识点练习总结</a>
    </h2>
  </header>
  <div class="post-body" itemprop="articleBody">
    <div class="thumb">
      <img itemprop="contentUrl" class="random">
    </div>
    <div class="excerpt">
      <p>
      <p>最近在准备C语言的上级考试，之前对C接触不多，在练习过程中把一些小知识点记录下来。</p>
      <h2 id="1-字符串的截取"><a href="#1-字符串的截取" class="headerlink" title="1.字符串的截取"></a>1.字符串的截取</h2>
      <p>利用strncpy函数，传入三个参数，分别为目标字符串，起始位置，长度。 例如将日期字符串转化为数字，如20120112</p>
      <figure class="highlight cpp">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> date1[<span class="number">20</span>],date2[<span class="number">20</span>];</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%s"</span>,&amp;date1);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%s"</span>,&amp;date2);</span><br><span class="line">    <span class="keyword">char</span> temp[<span class="number">4</span>];</span><br><span class="line">    <span class="keyword">int</span> year1 = atoi(<span class="built_in">strncpy</span>(temp,date1,<span class="number">4</span>));</span><br><span class="line">    <span class="keyword">int</span> year2 = atoi(<span class="built_in">strncpy</span>(temp,date2,<span class="number">4</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"year1:%d\n"</span>,year1);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"year2:%d\n"</span>,year2);</span><br><span class="line">    <span class="keyword">char</span> temp2[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">int</span> month1 = atoi(<span class="built_in">strncpy</span>(temp2,date1+<span class="number">4</span>,<span class="number">2</span>));</span><br><span class="line">    <span class="keyword">int</span> month2 = atoi(<span class="built_in">strncpy</span>(temp2,date2+<span class="number">4</span>,<span class="number">2</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"month1:%d\n"</span>,month1);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"month2:%d\n"</span>,month2);</span><br><span class="line">    <span class="keyword">int</span> day1 = atoi(<span class="built_in">strncpy</span>(temp2,date1+<span class="number">6</span>,<span class="number">2</span>));</span><br><span class="line">    <span class="keyword">int</span> day2 = atoi(<span class="built_in">strncpy</span>(temp2,date2+<span class="number">6</span>,<span class="number">2</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"day1:%d\n"</span>,day1);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"day2:%d\n"</span>,day2);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>以上便实现了输入一个日期然后对其进行分割的操作。</p>
      <h2 id="2-二维数组的动态声明"><a href="#2-二维数组的动态声明" class="headerlink" title="2.二维数组的动态声明"></a>2.二维数组的动态声明</h2>
      <p>利用malloc可以实现数组的动态声明</p>
      <figure class="highlight angelscript">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="built_in">int</span> **a;</span><br><span class="line">    a = (<span class="built_in">int</span> **)malloc(<span class="number">2</span>*sizeof(<span class="built_in">int</span> *));</span><br><span class="line">    <span class="built_in">int</span> i,j;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i ++) &#123;</span><br><span class="line">        a[i] = (<span class="built_in">int</span> *)malloc(<span class="number">3</span>*sizeof(<span class="built_in">int</span>));</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++) &#123;</span><br><span class="line">            scanf(<span class="string">"%d"</span>,&amp;a[i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>以上便实现了动态数组的分配，利用scanf为数组赋值</p>
      <h2 id="3-二维数组的声明和初始化"><a href="#3-二维数组的声明和初始化" class="headerlink" title="3.二维数组的声明和初始化"></a>3.二维数组的声明和初始化</h2>
      <p>头文件</p>
      <figure class="highlight autoit">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>初始化和测试</p>
      <figure class="highlight matlab">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">int result[<span class="number">2</span>][<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">i</span> = <span class="number">0</span>; <span class="built_in">i</span> &lt; <span class="number">2</span>; <span class="built_in">i</span> ++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">j</span> = <span class="number">0</span>; <span class="built_in">j</span> &lt; <span class="number">2</span>; <span class="built_in">j</span>++) &#123;</span><br><span class="line">            printf(<span class="string">"%d "</span>,result[<span class="built_in">i</span>][<span class="built_in">j</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        printf(<span class="string">"\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    memset(result,<span class="number">0</span>,sizeof(int)*<span class="number">4</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">i</span> = <span class="number">0</span>; <span class="built_in">i</span> &lt; <span class="number">2</span>; <span class="built_in">i</span> ++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">j</span> = <span class="number">0</span>; <span class="built_in">j</span> &lt; <span class="number">2</span>; <span class="built_in">j</span>++) &#123;</span><br><span class="line">            printf(<span class="string">"%d "</span>,result[<span class="built_in">i</span>][<span class="built_in">j</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        printf(<span class="string">"\n"</span>);</span><br><span class="line">    &#125;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>结果</p>
      <figure class="highlight basic">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="symbol">4196944 </span><span class="number">0</span> </span><br><span class="line"><span class="symbol">4195696 </span><span class="number">0</span> </span><br><span class="line"><span class="symbol">0 </span><span class="number">0</span> </span><br><span class="line"><span class="symbol">0 </span><span class="number">0</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>上述是数组的非动态声明</p>
      <h2 id="4-快速排序"><a href="#4-快速排序" class="headerlink" title="4.快速排序"></a>4.快速排序</h2>
      <p>假设要排序的数组是A[1]……A[N]，首先任意选取一个数据（通常选用第一个数据）作为关键数据，然后将所有比它的数都放到它前面，所有比它大的数都放到它后面，这个过程称为一趟快速排序。一趟快速排序的算法是： 1）设置两个变量I、J，排序开始的时候 I=0，J=N-1； 2）以第一个数组元素作为关键数据，赋值给X，即X=A[0]； 3）从J开始向前搜索，即由后开始向前搜索，找到第一个小于X的值，两者交换； 4）从I开始向后搜索，即由前开始向后搜索，找到第一个大于X的值，两者交换； 5）重复第3、4步，直到I=J； 例如：待排序的数组A的值分别是：（初始关键数据X：=49） A[0] A[1] A[2] A[3] A[4] A[5] A[6] 49 38 65 97 76 13 27 进行第一次交换后： 27 38 65 97 76 13 49 ( 按照算法的第三步从后面开始找 ） 进行第二次交换后： 27 38 49 97 76 13 65 ( 按照算法的第四步从前面开始找&gt;X的值，65&gt;49,两者交换，此时I=3 ) 进行第三次交换后： 27 38 13 97 76 49 65 ( 按照算法的第五步将又一次执行算法的第三步从后开始找） 进行第四次交换后： 27 38 13 49 76 97 65 ( 按照算法的第四步从前面开始找大于X的值，97&gt;49,两者交换，此时J=4 ) 此时再执行第三不的时候就发现I=J，从而结束一躺快速排序，那么经过一躺快速排序之后： 27 38 13 49 76 97 65 即所有大于49的数全部在49的后面，所有小于49的数全部在49的前面。</p>
      <figure class="highlight angelscript">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line"><span class="built_in">void</span> quiksort(<span class="built_in">int</span> a[],<span class="built_in">int</span> low,<span class="built_in">int</span> high)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">int</span> i = low;</span><br><span class="line">    <span class="built_in">int</span> j = high;  </span><br><span class="line">    <span class="built_in">int</span> temp = a[i]; </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">if</span>( low &lt; high)</span><br><span class="line">    &#123;          </span><br><span class="line">        <span class="keyword">while</span>(i &lt; j) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">while</span>((a[j] &gt;= temp) &amp;&amp; (i &lt; j))</span><br><span class="line">            &#123; </span><br><span class="line">                j--; </span><br><span class="line">            &#125;</span><br><span class="line">            a[i] = a[j];</span><br><span class="line">            <span class="keyword">while</span>((a[i] &lt;= temp) &amp;&amp; (i &lt; j))</span><br><span class="line">            &#123;</span><br><span class="line">                i++; </span><br><span class="line">            &#125;  </span><br><span class="line">            a[j]= a[i];</span><br><span class="line">        &#125;</span><br><span class="line">        a[i] = temp;</span><br><span class="line">        quiksort(a,low,i<span class="number">-1</span>);</span><br><span class="line">        quiksort(a,j+<span class="number">1</span>,high);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="built_in">int</span> main()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">int</span> arr[<span class="number">5</span>] = &#123;<span class="number">23</span>,<span class="number">1</span>,<span class="number">21</span>,<span class="number">4</span>,<span class="number">19</span>&#125;;</span><br><span class="line">    quiksort(arr,<span class="number">0</span>,<span class="number">4</span>);</span><br><span class="line">    <span class="built_in">int</span> i;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        printf(<span class="string">"%d "</span>,arr[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    printf(<span class="string">"\n"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>快速排序代码如上</p>
      <h2 id="5-字符串拷贝"><a href="#5-字符串拷贝" class="headerlink" title="5.字符串拷贝"></a>5.字符串拷贝</h2>
      <p>小例子如下</p>
      <figure class="highlight cpp">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> str[<span class="number">20</span>] = <span class="string">"hello"</span>;</span><br><span class="line">	<span class="keyword">char</span> *a = <span class="string">"world"</span>;</span><br><span class="line">	<span class="built_in">strcpy</span>(str,a);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%s"</span>,str);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">	system(<span class="string">"pause"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>运行结果：world，即把后者完全覆盖前者。</p>
      <figure class="highlight cpp">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> *str = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">6</span>];</span><br><span class="line">	<span class="keyword">char</span> *a = <span class="string">"world"</span>;</span><br><span class="line">	<span class="built_in">strcpy</span>(str,a);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%s"</span>, str);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">	system(<span class="string">"pause"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>运行结果一致 某一长度的字符串截取</p>
      <figure class="highlight cpp">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> *str = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">6</span>];</span><br><span class="line">	<span class="keyword">char</span> *a = <span class="string">"world"</span>;</span><br><span class="line">	<span class="built_in">strncpy</span>(str,a+<span class="number">1</span>,<span class="number">5</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%s"</span>, str);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">	system(<span class="string">"pause"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>运行结果：orld</p>
      <h2 id="6-字符串的拼接"><a href="#6-字符串的拼接" class="headerlink" title="6.字符串的拼接"></a>6.字符串的拼接</h2>
      <p>小例子如下</p>
      <figure class="highlight cpp">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> str[<span class="number">20</span>] = <span class="string">"hello "</span>;</span><br><span class="line">	<span class="keyword">char</span> *a = <span class="string">"world"</span>;</span><br><span class="line">	<span class="keyword">char</span> *x = <span class="built_in">strcat</span>(str,a);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%s\n"</span>, x);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%s\n"</span>, x);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">	system(<span class="string">"pause"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>运行结果： hello world hello world 此函数既返回结果，又将目标字符串赋值</p>
      <h2 id="7-字符串查找匹配"><a href="#7-字符串查找匹配" class="headerlink" title="7.字符串查找匹配"></a>7.字符串查找匹配</h2>
      <p>例子如下</p>
      <figure class="highlight cpp">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> str[<span class="number">20</span>] = <span class="string">"hello "</span>;</span><br><span class="line">	<span class="keyword">char</span> *x = <span class="built_in">strchr</span>(str,<span class="string">'e'</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, x - str);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%s\n"</span>,x);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">	system(<span class="string">"pause"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>运行结果： 1 ello</p>
      <h2 id="8-字符串比较"><a href="#8-字符串比较" class="headerlink" title="8.字符串比较"></a>8.字符串比较</h2>
      <p>例子如下</p>
      <figure class="highlight cpp">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> str[<span class="number">20</span>] = <span class="string">"hello "</span>;</span><br><span class="line">	<span class="keyword">char</span> str2[<span class="number">20</span>] = <span class="string">"hello2"</span>;</span><br><span class="line">	<span class="keyword">int</span> x = <span class="built_in">strcmp</span>(str, str2);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,x);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">	system(<span class="string">"pause"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>运行结果-1 忽略大小写</p>
      <figure class="highlight cpp">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> str[<span class="number">20</span>] = <span class="string">"hello"</span>;</span><br><span class="line">	<span class="keyword">char</span> str2[<span class="number">20</span>] = <span class="string">"Hello"</span>;</span><br><span class="line">	<span class="keyword">int</span> x = stricmp(str, str2);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,x);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">	system(<span class="string">"pause"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>运行结果0</p>
      <h2 id="9-字符串分割"><a href="#9-字符串分割" class="headerlink" title="9.字符串分割"></a>9.字符串分割</h2>
      <p>示例如下</p>
      <figure class="highlight cpp">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">      <span class="keyword">char</span> test1[] = <span class="string">"feng,ke,wei"</span>;  </span><br><span class="line">	  <span class="keyword">char</span> x[<span class="number">3</span>][<span class="number">30</span>];</span><br><span class="line">      <span class="keyword">char</span> *p;  </span><br><span class="line">      p = strtok(test1, <span class="string">","</span>);</span><br><span class="line">	  <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">while</span> (p) &#123;   </span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%s\n"</span>, p);   </span><br><span class="line">		<span class="built_in">strcpy</span>(x[count],p);</span><br><span class="line">		count++;</span><br><span class="line">		p = strtok(<span class="literal">NULL</span>, <span class="string">","</span>);     </span><br><span class="line">      &#125;    </span><br><span class="line">	  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;count; i ++) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%s "</span>, x[i]);</span><br><span class="line">	  &#125;</span><br><span class="line">	  system(<span class="string">"pause"</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"> &#125;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>运行结果 feng ke wei feng ke wei</p>
      <h2 id="10-格式化输出几位小数"><a href="#10-格式化输出几位小数" class="headerlink" title="10.格式化输出几位小数"></a>10.格式化输出几位小数</h2>
      <p>例如</p>
      <figure class="highlight cpp">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="built_in">printf</span>(<span class="string">"%.5f"</span>,<span class="number">18.223</span>);</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>则是输出5位小数 又如</p>
      <figure class="highlight perl">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="keyword">printf</span>(<span class="string">"%5.1f"</span>,<span class="number">1.2345</span>);</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>则是控制总位数为5，小数点后为1位，不够的在前面补空格</p>
      </p>
    </div>
  </div>
  <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-user"></i>
      </span>
      <span class="post-meta-item-text">作者</span>
      <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      <time title="创建时间：2015-07-18 21:52:01" itemprop="dateCreated datePublished" datetime="2015-07-18T21:52:01+08:00">2015-07-18</time>
    </span>
    <span id="/1934.html" class="post-meta-item leancloud_visitors" data-flag-title="C语言小知识点练习总结" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>4.8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4 分钟</span>
    </span>
  </div>
</article>

    <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1922.html">
  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.png">
    <meta itemprop="name" content="崔庆才">
    <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  </span>
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="静觅">
  </span>
  <header class="post-header">
    <h2 class="post-title" itemprop="name headline">
      <a class="label"> C/C++ <i class="label-arrow"></i>
      </a>
      <a href="/1922.html" class="post-title-link" itemprop="url">Winpcap网络编程六之两台主机通过中间主机通信</a>
    </h2>
  </header>
  <div class="post-body" itemprop="articleBody">
    <div class="thumb">
      <img itemprop="contentUrl" class="random">
    </div>
    <div class="excerpt">
      <p>
      <h2 id="本节任务"><a href="#本节任务" class="headerlink" title="本节任务"></a>本节任务</h2>
      <p>本次我们需要完成的任务是 完成两台主机通过中间主机的数据通信（网络层）</p>
      <ul>
        <li>增加基于IP地址的转发功能</li>
        <li>增加网络层封装</li>
      </ul>
      <p>其实最主要的就是基于IP地址的转发功能，网络层的封装其实我们在初级功能中就已经做好了。</p>
      <h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2>
      <p>首先，实验的思路是A通过中间主机B向C发送数据。那么B则作为一个路由器，B要监听两个网卡，一个网卡发来的数据通过另一个网卡发出去。 示意图如下： A————-&gt;B1===B2——————&gt;C 从图上可以看出，B主机的两个网卡数据互通，A和B1则处于一个局域网内，B2和C处于另一个局域网内。 就比如这样，现在室友A在用有线上网，我的电脑B也在用有线上网，我们的有线处在同一局域网，我的电脑B同时散着一个无线网，我的手机C又连接到了这个无线上。 那么要实现A到C的数据传送，即模拟室友A要发送数据到我的手机C，那么流程则是这样的： 室友A在有线局域网发送数据到我的网卡B1，B1将数据通过网卡B2转发到无线局域网，通过无线局域网到达我的手机C。 A的发送要构建一个帧，目的MAC地址为B1,目的IP为C。B则要开启两个网卡，B1监听接收数据，B2网卡则要用ARP协议扫描所在无线局域网内的IP和MAC,B获取到了A发来的帧之后，解析它的IP地址和MAC地址，匹配刚才扫描得到的IP和MAC对应表，将源MAC换成B2网卡MAC，目的MAC换成C的MAC，IP不变，数据data不变。构建新帧之后发送出去。 好啦，思路大体就是这样。</p>
      <h2 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h2>
      <p>需要三个程序，一个是发送，一个路由，一个接收。所以一共三个程序要同时运行起来执行。 以上是我的大体思路，如有错误，还请指正。现已用代码实现完毕。 代码暂不公开，只提供部分重点代码解析：</p>
      <h3 id="一、发送端"><a href="#一、发送端" class="headerlink" title="一、发送端"></a>一、发送端</h3>
      <p>其实发送端和初级功能的发送差不多 个人编写的交互流程如下：</p>
      <figure class="highlight angelscript">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">IP地址:<span class="number">121.250</span><span class="number">.216</span><span class="number">.221</span>   MAC地址:<span class="number">3</span>c970e4b56d6con:<span class="number">127</span></span><br><span class="line"></span><br><span class="line">-------------------------------------------</span><br><span class="line">IP地址:<span class="number">121.250</span><span class="number">.216</span><span class="number">.227</span>   MAC地址:<span class="number">089e01</span>b948f4con:<span class="number">128</span></span><br><span class="line"></span><br><span class="line">-------------------------------------------</span><br><span class="line">IP地址:<span class="number">121.250</span><span class="number">.216</span><span class="number">.228</span>   MAC地址:<span class="number">10</span>bf48705aeecon:<span class="number">129</span></span><br><span class="line"></span><br><span class="line">获取MAC地址完毕,请输入你要发送对方的IP地址:</span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.3</span></span><br><span class="line">请输入你要发送的内容:</span><br><span class="line">im cqc</span><br><span class="line">要发送的内容:im cqc</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>具体代码不再解析，同上一篇初级功能。</p>
      <h3 id="二、路由端"><a href="#二、路由端" class="headerlink" title="二、路由端"></a>二、路由端</h3>
      <p>首先要开启两个网卡，声明两个网卡对象和处理器</p>
      <figure class="highlight cpp">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="keyword">pcap_if_t</span>  *d,*d2;					<span class="comment">//选中的网络适配器</span></span><br><span class="line"><span class="keyword">pcap_t</span> *adhandle,*adhandle2;           <span class="comment">//捕捉实例,是pcap_open返回的对象,adhandle是用来发送数据，adhandle2是用来接收数据</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>一个用来接收一个用来发送，这里定义了adhandle是用来发送，adhandle2是用来接收数据。 那么打开适配器就在main方法中，提前打开两个网卡</p>
      <figure class="highlight xl">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">int num;</span><br><span class="line">	printf(<span class="string">"请输入你要转发数据的网卡代号:\n"</span>);</span><br><span class="line">	<span class="comment">//让用户选择选择哪个适配器进行转发</span></span><br><span class="line">	scanf_s(<span class="string">"%d"</span>,&amp;num);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//跳转到选中的适配器</span></span><br><span class="line">	<span class="function"><span class="title">for</span>(d=alldevs, i=0; i&lt; num-1 ; d=d-&gt;</span>next, i++);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//运行到此处说明用户的输入是合法的，找到发送数据网卡</span></span><br><span class="line">	<span class="function"><span class="title">if</span>((adhandle = pcap_open(d-&gt;</span><span class="keyword">name</span>,		<span class="comment">//设备名称</span></span><br><span class="line">													<span class="number">65535</span>,       <span class="comment">//存放数据包的内容长度</span></span><br><span class="line">													PCAP_OPENFLAG_PROMISCUOUS,  <span class="comment">//混杂模式</span></span><br><span class="line">													<span class="number">1000</span>,           <span class="comment">//超时时间</span></span><br><span class="line">													NULL,          <span class="comment">//远程验证</span></span><br><span class="line">													errbuf         <span class="comment">//错误缓冲</span></span><br><span class="line">													)) == NULL)&#123;</span><br><span class="line">    <span class="comment">//打开适配器失败,打印错误并释放适配器列表</span></span><br><span class="line">	<span class="function"><span class="title">fprintf</span>(stderr,"\nUnable to open the adapter. %s <span class="keyword">is</span> <span class="built_in">not</span> supported <span class="keyword">by</span> WinPcap\n", d-&gt;</span><span class="keyword">name</span>);</span><br><span class="line">    <span class="comment">// 释放设备列表 </span></span><br><span class="line">    pcap_freealldevs(alldevs);</span><br><span class="line">    return -<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	int num2;</span><br><span class="line">	printf(<span class="string">"请输入你要接收数据的网卡代号:"</span>);</span><br><span class="line">	<span class="comment">//让用户选择用哪个网卡来收数据</span></span><br><span class="line">	scanf_s(<span class="string">"%d"</span>,&amp;num2);</span><br><span class="line">	<span class="comment">//用户输入的数字超出合理范围</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//跳转到选中的适配器</span></span><br><span class="line">	<span class="function"><span class="title">for</span>(d2=alldevs, i=0; i&lt; num2-1 ; d2=d2-&gt;</span>next, i++);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//运行到此处说明用户的输入是合法的</span></span><br><span class="line">	<span class="function"><span class="title">if</span>((adhandle2 = pcap_open(d2-&gt;</span><span class="keyword">name</span>,		<span class="comment">//设备名称</span></span><br><span class="line">													<span class="number">65535</span>,       <span class="comment">//存放数据包的内容长度</span></span><br><span class="line">													PCAP_OPENFLAG_PROMISCUOUS,  <span class="comment">//混杂模式</span></span><br><span class="line">													<span class="number">1000</span>,           <span class="comment">//超时时间</span></span><br><span class="line">													NULL,          <span class="comment">//远程验证</span></span><br><span class="line">													errbuf         <span class="comment">//错误缓冲</span></span><br><span class="line">													)) == NULL)&#123;</span><br><span class="line">    <span class="comment">//打开适配器失败,打印错误并释放适配器列表</span></span><br><span class="line">	<span class="function"><span class="title">fprintf</span>(stderr,"\nUnable to open the adapter. %s <span class="keyword">is</span> <span class="built_in">not</span> supported <span class="keyword">by</span> WinPcap\n", d2-&gt;</span><span class="keyword">name</span>);</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>接下来用用于发送的handle处理器来扫描它的局域网IP，获得局域网内的MAC地址，记录在一个表中,存放IP和MAC的对应关系。 这个表可以用结构体数组来保存，比如可以这样:</p>
      <figure class="highlight routeros">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">struct ip_mac_list&#123;</span><br><span class="line">	IpAddress ip;</span><br><span class="line">	unsigned char mac[6];</span><br><span class="line">&#125;;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <figure class="highlight angelscript">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">ip_mac_list  list[<span class="number">256</span>];                       <span class="comment">//存储IP和MAC地址的对应表</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>那么以上便是准备工作，我们完成了两个网卡的打开，发送网卡扫描获取局域网MAC，接下来便是最重要的监听加转发。 那么这个怎办？那就开一个新线程。 让我们声明一个新的路由线程。</p>
      <figure class="highlight lisp">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">DWORD WINAPI RouteThread(<span class="name">LPVOID</span> lpParameter)<span class="comment">;</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>那么线程要接收进来什么参数呢？ 首先必须要的是两个网卡处理器，在main方法中已经做好初始化的adhandle和adhandle2，另外还有alldevs，可以持有这个指针来释放设备列表，出现错误时释放资源并退出。 初级功能中声明过了 struct sparam sp; struct gparam gp; 这两个就是发送ARP线程和接收ARP线程中的两个参数，那么仿照这个功能，我们定义一个新的结构体</p>
      <figure class="highlight cpp">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rparam</span>&#123;</span></span><br><span class="line">	<span class="keyword">pcap_t</span> *adhandle_rec;</span><br><span class="line">	<span class="keyword">pcap_t</span> *adhandle_send;</span><br><span class="line">	<span class="keyword">pcap_if_t</span>  * alldevs;       <span class="comment">//所有网络适配器</span></span><br><span class="line">&#125;;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>在main方法中把它来初始化赋值</p>
      <figure class="highlight abnf">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">rp.adhandle_send = adhandle<span class="comment">;</span></span><br><span class="line">	rp.adhandle_rec = adhandle2<span class="comment">;</span></span><br><span class="line">	rp.alldevs = alldevs<span class="comment">;</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>当做参数传入这个线程</p>
      <figure class="highlight lisp">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">routethread = CreateThread(<span class="name">NULL</span>, <span class="number">0</span>, (<span class="name">LPTHREAD_START_ROUTINE</span>) RouteThread, <span class="symbol">&amp;rp</span>,</span><br><span class="line">			<span class="number">0</span>, NULL)<span class="comment">;</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>其中第四个参数就是传递了这个结构体进去。注意这个语句最好不要直接放在main方法中直接调用，可以在全部获取完MAC地址之后再开启这个线程。 那么接下来就说一下这个线程都干了些什么，只简略说一下核心部分。 首先开启了这个线程之后会一直都在执行，那么就可以加入</p>
      <figure class="highlight lisp">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">while((<span class="name">res</span> = pcap_next_ex(<span class="name">adhandle2</span>,<span class="symbol">&amp;header</span>,<span class="symbol">&amp;pkt_data</span>))&gt;=0)</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>这样的while判断语句来一直监听数据包的接收，然后解析数据。</p>
      <figure class="highlight perl">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">ethernet =  (EthernetHeader *)(pkt_data);</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)&#123;</span><br><span class="line">				sou_mac[i] = ethernet-&gt;SourMAC[i];</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)&#123;</span><br><span class="line">				des_mac[i] = ethernet-&gt;DestMAC[i];</span><br><span class="line">			&#125;</span><br><span class="line">			// 获得IP数据包头部的位置</span><br><span class="line">			ip = (IpHeader *) (pkt_data +<span class="number">14</span>);    <span class="regexp">//</span><span class="number">14</span>为以太网帧头部长度</span><br><span class="line">			//获得TCP头部的位置</span><br><span class="line">			ip_len = (ip-&gt;Version_HLen &amp; <span class="number">0xf</span>) *<span class="number">4</span>;</span><br><span class="line">			tcp = (TcpHeader *)((u_char *)ip+ip_len);</span><br><span class="line">			data = (char *)((u_char *)tcp+<span class="number">20</span>);</span><br><span class="line">			<span class="keyword">printf</span>(<span class="string">"data:%s\n"</span>,data);</span><br><span class="line">			<span class="keyword">printf</span>(<span class="string">"ip:"</span>);</span><br><span class="line">			<span class="keyword">printf</span>(<span class="string">"%d.%d.%d.%d -&gt; %d.%d.%d.%d\n"</span>,</span><br><span class="line">					ip-&gt;SourceAddr.byte1,</span><br><span class="line">					ip-&gt;SourceAddr.byte2,</span><br><span class="line">					ip-&gt;SourceAddr.byte3,</span><br><span class="line">					ip-&gt;SourceAddr.byte4,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte1,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte2,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte3,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte4);</span><br><span class="line">			 <span class="keyword">printf</span>(<span class="string">"sou_mac:%02x-%02x-%02x-%02x-%02x-%02x\n"</span>, sou_mac[<span class="number">0</span>], sou_mac[<span class="number">1</span>], sou_mac[<span class="number">2</span>],</span><br><span class="line">			    sou_mac[<span class="number">3</span>], sou_mac[<span class="number">4</span>], sou_mac[<span class="number">5</span>]);</span><br><span class="line">			<span class="keyword">printf</span>(<span class="string">"des_mac:%02x-%02x-%02x-%02x-%02x-%02x\n"</span>, des_mac[<span class="number">0</span>], des_mac[<span class="number">1</span>], des_mac[<span class="number">2</span>],</span><br><span class="line">			    des_mac[<span class="number">3</span>], des_mac[<span class="number">4</span>], des_mac[<span class="number">5</span>]);</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>然后接下来每接收到一个数据，就进行构建新的帧转发出去，目的MAC先匹配list表，如果list没有找到，那么我让他指定了一个mac，比如广播MAC。源MAC地址则赋值网卡的MAC地址。 注意，传统以太网中数据长度为45-1500，那么我在构建前把解析出的data作了下判断长度再构建，因为我已经把sendbuffer声明为一个固定长度了，为了防止越界，我先进行一个长度判断。</p>
      <figure class="highlight lsl">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="comment">//以下开始构建帧发送</span></span><br><span class="line">		<span class="comment">//首先判断data最大值小于1500</span></span><br><span class="line">		if(strlen(data)&lt;<span class="number">1500</span>)&#123;</span><br><span class="line">			<span class="comment">//目的MAC</span></span><br><span class="line">			BYTE send_destmac[<span class="number">6</span>];</span><br><span class="line">			bool findMac = false;</span><br><span class="line">			for(int c = <span class="number">0</span>;c&lt;con;c++)&#123;</span><br><span class="line">				if(ip-&gt;DestinationAddr.byte1 ==  <span class="type">list</span>[c].ip.byte1&amp;&amp;</span><br><span class="line">					ip-&gt;DestinationAddr.byte2 == <span class="type">list</span>[c].ip.byte2&amp;&amp;</span><br><span class="line">					ip-&gt;DestinationAddr.byte3 == <span class="type">list</span>[c].ip.byte3&amp;&amp;</span><br><span class="line">					ip-&gt;DestinationAddr.byte4 == <span class="type">list</span>[c].ip.byte4)</span><br><span class="line">				&#123;</span><br><span class="line">					printf(<span class="string">"Find its MAC!<span class="subst">\n</span>"</span>);</span><br><span class="line">					findMac = true;</span><br><span class="line">					send_destmac[<span class="number">0</span>] = <span class="type">list</span>[c].mac[<span class="number">0</span>];   </span><br><span class="line">					send_destmac[<span class="number">1</span>] = <span class="type">list</span>[c].mac[<span class="number">1</span>];</span><br><span class="line">					send_destmac[<span class="number">2</span>] = <span class="type">list</span>[c].mac[<span class="number">2</span>];</span><br><span class="line">					send_destmac[<span class="number">3</span>] = <span class="type">list</span>[c].mac[<span class="number">3</span>];</span><br><span class="line">					send_destmac[<span class="number">4</span>] = <span class="type">list</span>[c].mac[<span class="number">4</span>];</span><br><span class="line">					send_destmac[<span class="number">5</span>] = <span class="type">list</span>[c].mac[<span class="number">5</span>];</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			if(!findMac)&#123;</span><br><span class="line">				send_destmac[<span class="number">0</span>] = <span class="number">0xff</span>;   </span><br><span class="line">				send_destmac[<span class="number">1</span>] = <span class="number">0xff</span>;   </span><br><span class="line">				send_destmac[<span class="number">2</span>] = <span class="number">0xff</span>;   </span><br><span class="line">				send_destmac[<span class="number">3</span>] = <span class="number">0xff</span>;   </span><br><span class="line">				send_destmac[<span class="number">4</span>] = <span class="number">0xff</span>;   </span><br><span class="line">				send_destmac[<span class="number">5</span>] = <span class="number">0xff</span>;   </span><br><span class="line">			&#125;</span><br><span class="line">			printf(<span class="string">"destmac:%02x-%02x-%02x-%02x-%02x-%02x<span class="subst">\n</span>"</span>,</span><br><span class="line">				send_destmac[<span class="number">0</span>],send_destmac[<span class="number">1</span>],send_destmac[<span class="number">2</span>],</span><br><span class="line">				send_destmac[<span class="number">3</span>],send_destmac[<span class="number">4</span>],send_destmac[<span class="number">5</span>]</span><br><span class="line">				);</span><br><span class="line">			memcpy(send_ethernet.DestMAC, send_destmac, <span class="number">6</span>);</span><br><span class="line">			<span class="comment">//源MAC地址</span></span><br><span class="line">			BYTE send_hostmac[<span class="number">6</span>];</span><br><span class="line">			<span class="comment">//源MAC地址</span></span><br><span class="line">			send_hostmac[<span class="number">0</span>] = local_mac[<span class="number">0</span>];     <span class="comment">//赋值本地MAC地址</span></span><br><span class="line">			send_hostmac[<span class="number">1</span>] = local_mac[<span class="number">1</span>];</span><br><span class="line">			send_hostmac[<span class="number">2</span>] = local_mac[<span class="number">2</span>];</span><br><span class="line">			send_hostmac[<span class="number">3</span>] = local_mac[<span class="number">3</span>];</span><br><span class="line">			send_hostmac[<span class="number">4</span>] = local_mac[<span class="number">4</span>];</span><br><span class="line">			send_hostmac[<span class="number">5</span>] = local_mac[<span class="number">5</span>];</span><br><span class="line">			<span class="comment">//赋值源MAC地址</span></span><br><span class="line">			memcpy(send_ethernet.SourMAC, send_hostmac, <span class="number">6</span>);</span><br><span class="line">			send_ethernet.EthType = htons(<span class="number">0x0800</span>);</span><br><span class="line">			<span class="comment">//赋值SendBuffer</span></span><br><span class="line">			memcpy(&amp;SendBuffer, &amp;send_ethernet, sizeof(struct EthernetHeader));</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>以上只是赋值了帧头，至于IP头，TCP头，数据的赋值就参照初级功能的来赋值吧，不要忘了校验和的检验。好，大体上就是这样，接受来数据包并转发出去的原理就是这样。</p>
      <h3 id="三、接收"><a href="#三、接收" class="headerlink" title="三、接收"></a>三、接收</h3>
      <p>不用多改，就是初级功能中的接收，在此写一写小小的优化措施，防止接收到过多的数据帧而造成不断乱蹦，导致你看不到接收的东西。 在打印的时候加一个过滤就好了。部分代码如下： 在main方法中提示用户输入要接收的IP地址</p>
      <figure class="highlight angelscript">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">printf(<span class="string">"请输入要接收的IP地址,输入0.0.0.0代表全部接收,请输入\n"</span>);</span><br><span class="line">	<span class="built_in">bool</span> receiveAll = <span class="literal">false</span>;</span><br><span class="line">	u_int ip1,ip2,ip3,ip4;</span><br><span class="line">	<span class="built_in">bool</span> legal = <span class="literal">false</span>;</span><br><span class="line">	<span class="keyword">while</span>(!legal)&#123;</span><br><span class="line">		scanf_s(<span class="string">"%d.%d.%d.%d"</span>,&amp;ip1,&amp;ip2,&amp;ip3,&amp;ip4);</span><br><span class="line">		<span class="keyword">if</span>(ip1==<span class="number">0</span>&amp;&amp;ip2==<span class="number">0</span>&amp;&amp;ip3==<span class="number">0</span>&amp;&amp;ip4==<span class="number">0</span>)&#123;</span><br><span class="line">			receiveAll = <span class="literal">true</span>;</span><br><span class="line">			legal = <span class="literal">true</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(ip1&lt;<span class="number">0</span>||ip1&gt;<span class="number">255</span>||ip2&lt;<span class="number">0</span>||ip2&gt;<span class="number">255</span>||ip3&lt;<span class="number">0</span>||ip3&gt;<span class="number">255</span>||ip4&lt;<span class="number">1</span>||ip4&gt;<span class="number">254</span>)&#123;</span><br><span class="line">			legal = <span class="literal">false</span>;</span><br><span class="line">			printf(<span class="string">"对不起,IP输入不合法,请重新输入:\n"</span>);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			legal = <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>打印时的判断</p>
      <figure class="highlight perl">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="keyword">if</span>(receiveAll||(ip-&gt;SourceAddr.byte1==ip1&amp;&amp;</span><br><span class="line">					ip-&gt;SourceAddr.byte2==ip2&amp;&amp;</span><br><span class="line">					ip-&gt;SourceAddr.byte3==ip3&amp;&amp;</span><br><span class="line">					ip-&gt;SourceAddr.byte4==ip4))&#123;</span><br><span class="line">					<span class="keyword">printf</span>(<span class="string">"%d.%d.%d.%d.%d -&gt; %d.%d.%d.%d.%d\n"</span>,</span><br><span class="line">					ip-&gt;SourceAddr.byte1,</span><br><span class="line">					ip-&gt;SourceAddr.byte2,</span><br><span class="line">					ip-&gt;SourceAddr.byte3,</span><br><span class="line">					ip-&gt;SourceAddr.byte4,</span><br><span class="line">				    sport,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte1,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte2,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte3,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte4,</span><br><span class="line">				    dport);</span><br><span class="line">			    <span class="keyword">printf</span>(<span class="string">"sou_mac:%02x-%02x-%02x-%02x-%02x-%02x\n"</span>, sou_mac[<span class="number">0</span>], sou_mac[<span class="number">1</span>], sou_mac[<span class="number">2</span>],</span><br><span class="line">			    sou_mac[<span class="number">3</span>], sou_mac[<span class="number">4</span>], sou_mac[<span class="number">5</span>]);</span><br><span class="line">				<span class="keyword">printf</span>(<span class="string">"des_mac:%02x-%02x-%02x-%02x-%02x-%02x\n"</span>, des_mac[<span class="number">0</span>], des_mac[<span class="number">1</span>], des_mac[<span class="number">2</span>],</span><br><span class="line">			    des_mac[<span class="number">3</span>], des_mac[<span class="number">4</span>], des_mac[<span class="number">5</span>]);</span><br><span class="line">				<span class="keyword">printf</span>(<span class="string">"%s\n"</span>,data);</span><br><span class="line">				<span class="keyword">printf</span>(<span class="string">"-----------------------------------------------------\n"</span>);</span><br><span class="line">			&#125;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>好，代码就先放送这么多，具体的实现只要有了思路我相信肯定不难，如有问题，欢迎与我交流。</p>
      </p>
    </div>
  </div>
  <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-user"></i>
      </span>
      <span class="post-meta-item-text">作者</span>
      <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      <time title="创建时间：2015-07-13 01:19:22" itemprop="dateCreated datePublished" datetime="2015-07-13T01:19:22+08:00">2015-07-13</time>
    </span>
    <span id="/1922.html" class="post-meta-item leancloud_visitors" data-flag-title="Winpcap网络编程六之两台主机通过中间主机通信" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>7.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>7 分钟</span>
    </span>
  </div>
</article>

    <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1918.html">
  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.png">
    <meta itemprop="name" content="崔庆才">
    <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  </span>
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="静觅">
  </span>
  <header class="post-header">
    <h2 class="post-title" itemprop="name headline">
      <a class="label"> C/C++ <i class="label-arrow"></i>
      </a>
      <a href="/1918.html" class="post-title-link" itemprop="url">Winpcap网络编程五之ARP协议获得MAC表及主机通信</a>
    </h2>
  </header>
  <div class="post-body" itemprop="articleBody">
    <div class="thumb">
      <img itemprop="contentUrl" class="random">
    </div>
    <div class="excerpt">
      <p>
      <h2 id="学习文档"><a href="#学习文档" class="headerlink" title="学习文档"></a>学习文档</h2>
      <p>这里我们直接进入正题吧，关于Winpcap的基础知识讲解这里就不再赘述了。在这里给大家提供一些学习网址 <a href="http://blog.csdn.net/column/details/winpcap.html" target="_blank" rel="noopener">Winpcap网络编程及通信教程</a><a href="http://www.ferrisxu.com/WinPcap/html/" target="_blank" rel="noopener">Winpcap中文技术文档</a></p>
      <h2 id="学习内容"><a href="#学习内容" class="headerlink" title="学习内容"></a>学习内容</h2>
      <ul>
        <li>获取设备列表</li>
        <li>获取已安装设备的高级信息</li>
        <li>打开适配器并捕获数据包</li>
        <li>不用回调方法捕获数据包</li>
        <li>过滤数据包</li>
        <li>分析数据包</li>
        <li>处理脱机堆文件</li>
        <li>发送数据包</li>
        <li>收集并统计网络流量</li>
      </ul>
      <p>这些内容，在上述两个链接中均已经有了比较详细的讲解，希望对大家有帮助。</p>
      <h2 id="两台主机通信实战"><a href="#两台主机通信实战" class="headerlink" title="两台主机通信实战"></a>两台主机通信实战</h2>
      <p>完成两台主机之间的数据通信（数据链路层）</p>
      <ul>
        <li>仿真ARP协议获得网段内主机的MAC表</li>
        <li>使用帧完成两台主机的通信（Hello! I’m …)</li>
      </ul>
      <p>首先我们要理解ARP是干嘛的，ARP主要作用就是通过IP地址来获取MAC地址。那么怎样获取呢？本机向局域网内主机发送ARP包，ARP包内包含了目的IP，源IP，目的MAC，源MAC，其中目的MAC地址为广播地址,FF-FF-FF-FF-FF-FF,即向局域网内所有主机发送一个ARP请求，那么其他主机收到这个请求之后则会向请求来源返回一个数据包。在这个返回的数据包中包含了自身的MAC地址。那么本机收到这些返回的数据包进行解析之后便会得到局域网内所有主机的MAC地址了.. 编程开始： 新建一个C++项目，配好环境，引入Winpcap相关的库，这些不再赘述。 头文件引入</p>
      <figure class="highlight dts">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HAVE_REMOTE</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> WPCAP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pcap.h&gt;</span></span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>在main函数中首先声明一系列变量如下</p>
      <figure class="highlight cpp">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="keyword">char</span> *ip_addr;                                    <span class="comment">//IP地址</span></span><br><span class="line"><span class="keyword">char</span> *ip_netmask;                             <span class="comment">//子网掩码</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> *ip_mac;          <span class="comment">//本机MAC地址</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>为这三个变量分配地址空间</p>
      <figure class="highlight cpp">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">ip_addr = (<span class="keyword">char</span> *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">char</span>) * <span class="number">16</span>); <span class="comment">//申请内存存放IP地址</span></span><br><span class="line">	<span class="keyword">if</span> (ip_addr == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"申请内存存放IP地址失败!\n"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	ip_netmask = (<span class="keyword">char</span> *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">char</span>) * <span class="number">16</span>); <span class="comment">//申请内存存放NETMASK地址</span></span><br><span class="line">	<span class="keyword">if</span> (ip_netmask == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"申请内存存放NETMASK地址失败!\n"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	ip_mac = (<span class="keyword">unsigned</span> <span class="keyword">char</span> *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">unsigned</span> <span class="keyword">char</span>) * <span class="number">6</span>); <span class="comment">//申请内存存放MAC地址</span></span><br><span class="line">	<span class="keyword">if</span> (ip_mac == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"申请内存存放MAC地址失败!\n"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>接下来就是烂大街的程序,获取适配器列表并选中相应的适配器,注释已经在代码中了,如果还有不明白的请参照前几次的讲解。</p>
      <figure class="highlight xl">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="comment">//获取本地适配器列表</span></span><br><span class="line">	<span class="keyword">if</span>(pcap_findalldevs_ex(PCAP_SRC_IF_STRING,NULL,&amp;alldevs,errbuf) == -<span class="number">1</span>)&#123;</span><br><span class="line">		<span class="comment">//结果为-1代表出现获取适配器列表失败</span></span><br><span class="line">		fprintf(stderr,<span class="string">"Error in pcap_findalldevs_ex:\n"</span>,errbuf);</span><br><span class="line">		<span class="comment">//exit(0)代表正常退出,exit(other)为非正常退出,这个值会传给操作系统</span></span><br><span class="line">		exit(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="title">for</span>(d = alldevs;d !=NULL;d = d-&gt;</span>next)&#123;</span><br><span class="line">		<span class="function"><span class="title">printf</span>("-----------------------------------------------------------------\nnumber:%d\nname:%s\n",++i,d-&gt;</span><span class="keyword">name</span>);</span><br><span class="line">		<span class="function"><span class="title">if</span>(d-&gt;</span>description)&#123;</span><br><span class="line">			<span class="comment">//打印适配器的描述信息</span></span><br><span class="line">			<span class="function"><span class="title">printf</span>("description:%s\n",d-&gt;</span>description);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">//适配器不存在描述信息</span></span><br><span class="line">			printf(<span class="string">"description:%s"</span>,<span class="string">"no description\n"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//打印本地环回地址</span></span><br><span class="line">		 <span class="function"><span class="title">printf</span>("\tLoopback: %s\n",(d-&gt;</span>flags &amp; PCAP_IF_LOOPBACK)?<span class="string">"yes"</span>:<span class="string">"no"</span>);</span><br><span class="line">		 <span class="comment">/**</span></span><br><span class="line"><span class="comment">		 pcap_addr *  next     指向下一个地址的指针</span></span><br><span class="line"><span class="comment">		 sockaddr *  addr       IP地址</span></span><br><span class="line"><span class="comment">		 sockaddr *  netmask  子网掩码</span></span><br><span class="line"><span class="comment">		 sockaddr *  broadaddr   广播地址</span></span><br><span class="line"><span class="comment">		 sockaddr *  dstaddr        目的地址</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		 pcap_addr_t *a;       <span class="comment">//网络适配器的地址用来存储变量</span></span><br><span class="line">		 <span class="function"><span class="title">for</span>(a = d-&gt;</span><span class="function"><span class="title">addresses</span>;a;a = a-&gt;</span>next)&#123;</span><br><span class="line">			 <span class="comment">//sa_family代表了地址的类型,是IPV4地址类型还是IPV6地址类型</span></span><br><span class="line">			 <span class="function"><span class="title">switch</span> (a-&gt;</span><span class="function"><span class="title">addr</span>-&gt;</span>sa_family)</span><br><span class="line">			 &#123;</span><br><span class="line">				 case AF_INET:  <span class="comment">//代表IPV4类型地址</span></span><br><span class="line">					 printf(<span class="string">"Address Family Name:AF_INET\n"</span>);</span><br><span class="line">					 <span class="function"><span class="title">if</span>(a-&gt;</span>addr)&#123;</span><br><span class="line">						 <span class="comment">//-&gt;的优先级等同于括号,高于强制类型转换,因为addr为sockaddr类型，对其进行操作须转换为sockaddr_in类型</span></span><br><span class="line">						 <span class="function"><span class="title">printf</span>("Address:%s\n",iptos(((struct sockaddr_in *)a-&gt;</span><span class="function"><span class="title">addr</span>)-&gt;</span>sin_addr.s_addr));</span><br><span class="line">					 &#125;</span><br><span class="line">					<span class="function"><span class="title">if</span> (a-&gt;</span>netmask)&#123;</span><br><span class="line">						 <span class="function"><span class="title">printf</span>("\tNetmask: %s\n",iptos(((struct sockaddr_in *)a-&gt;</span><span class="function"><span class="title">netmask</span>)-&gt;</span>sin_addr.s_addr));</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="function"><span class="title">if</span> (a-&gt;</span>broadaddr)&#123;</span><br><span class="line">						   <span class="function"><span class="title">printf</span>("\tBroadcast Address: %s\n",iptos(((struct sockaddr_in *)a-&gt;</span><span class="function"><span class="title">broadaddr</span>)-&gt;</span>sin_addr.s_addr));</span><br><span class="line">					 &#125;</span><br><span class="line">					 <span class="function"><span class="title">if</span> (a-&gt;</span>dstaddr)&#123;</span><br><span class="line">						   <span class="function"><span class="title">printf</span>("\tDestination Address: %s\n",iptos(((struct sockaddr_in *)a-&gt;</span><span class="function"><span class="title">dstaddr</span>)-&gt;</span>sin_addr.s_addr));</span><br><span class="line">					 &#125;</span><br><span class="line">        			 break;</span><br><span class="line">				 case AF_INET6: <span class="comment">//代表IPV6类型地址</span></span><br><span class="line">					 printf(<span class="string">"Address Family Name:AF_INET6\n"</span>);</span><br><span class="line">					 printf(<span class="string">"this is an IPV6 address\n"</span>);</span><br><span class="line">					 break;</span><br><span class="line">				 default:</span><br><span class="line">					 break;</span><br><span class="line">			 &#125;</span><br><span class="line">		 &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//i为0代表上述循环未进入,即没有找到适配器,可能的原因为Winpcap没有安装导致未扫描到</span></span><br><span class="line">	<span class="keyword">if</span>(i == <span class="number">0</span>)&#123;</span><br><span class="line">		printf(<span class="string">"interface not found,please check winpcap installation"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	int num;</span><br><span class="line">	printf(<span class="string">"Enter the interface number(1-%d):"</span>,i);</span><br><span class="line">	<span class="comment">//让用户选择选择哪个适配器进行抓包</span></span><br><span class="line">	scanf_s(<span class="string">"%d"</span>,&amp;num);</span><br><span class="line">	printf(<span class="string">"\n"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//用户输入的数字超出合理范围</span></span><br><span class="line">	<span class="keyword">if</span>(num&lt;<span class="number">1</span>||num&gt;i)&#123;</span><br><span class="line">		printf(<span class="string">"number out of range\n"</span>);</span><br><span class="line">		pcap_freealldevs(alldevs);</span><br><span class="line">		return -<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//跳转到选中的适配器</span></span><br><span class="line">	<span class="function"><span class="title">for</span>(d=alldevs, i=0; i&lt; num-1 ; d=d-&gt;</span>next, i++);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//运行到此处说明用户的输入是合法的</span></span><br><span class="line">	<span class="function"><span class="title">if</span>((adhandle = pcap_open(d-&gt;</span><span class="keyword">name</span>,		<span class="comment">//设备名称</span></span><br><span class="line">														<span class="number">65535</span>,       <span class="comment">//存放数据包的内容长度</span></span><br><span class="line">														PCAP_OPENFLAG_PROMISCUOUS,  <span class="comment">//混杂模式</span></span><br><span class="line">														<span class="number">1000</span>,           <span class="comment">//超时时间</span></span><br><span class="line">														NULL,          <span class="comment">//远程验证</span></span><br><span class="line">														errbuf         <span class="comment">//错误缓冲</span></span><br><span class="line">														)) == NULL)&#123;</span><br><span class="line">        <span class="comment">//打开适配器失败,打印错误并释放适配器列表</span></span><br><span class="line">		<span class="function"><span class="title">fprintf</span>(stderr,"\nUnable to open the adapter. %s <span class="keyword">is</span> <span class="built_in">not</span> supported <span class="keyword">by</span> WinPcap\n", d-&gt;</span><span class="keyword">name</span>);</span><br><span class="line">        <span class="comment">// 释放设备列表 </span></span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        return -<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>上述代码中需要另外声明的有：</p>
      <figure class="highlight cpp">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="keyword">pcap_if_t</span>  * alldevs;       <span class="comment">//所有网络适配器</span></span><br><span class="line"><span class="keyword">pcap_if_t</span>  *d;					<span class="comment">//选中的网络适配器</span></span><br><span class="line"><span class="keyword">char</span> errbuf[PCAP_ERRBUF_SIZE];   <span class="comment">//错误缓冲区,大小为256</span></span><br><span class="line"><span class="keyword">pcap_t</span> *adhandle;           <span class="comment">//捕捉实例,是pcap_open返回的对象</span></span><br><span class="line"><span class="keyword">int</span> i = <span class="number">0</span>;                            <span class="comment">//适配器计数变量</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <figure class="highlight cpp">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">iptos</span><span class="params">(u_long in)</span></span>;       <span class="comment">//u_long即为 unsigned long</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <figure class="highlight angelscript">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="comment">/* 将数字类型的IP地址转换成字符串类型的 */</span></span><br><span class="line">#define IPTOSBUFFERS    <span class="number">12</span></span><br><span class="line">char *iptos(u_long <span class="keyword">in</span>)</span><br><span class="line">&#123;</span><br><span class="line">    static char output[IPTOSBUFFERS][<span class="number">3</span>*<span class="number">4</span>+<span class="number">3</span>+<span class="number">1</span>];</span><br><span class="line">    static short which;</span><br><span class="line">    u_char *p;</span><br><span class="line"></span><br><span class="line">    p = (u_char *)&amp;<span class="keyword">in</span>;</span><br><span class="line">    which = (which + <span class="number">1</span> == IPTOSBUFFERS ? <span class="number">0</span> : which + <span class="number">1</span>);</span><br><span class="line">    sprintf_s(output[which], <span class="string">"%d.%d.%d.%d"</span>, p[<span class="number">0</span>], p[<span class="number">1</span>], p[<span class="number">2</span>], p[<span class="number">3</span>]);</span><br><span class="line">    <span class="keyword">return</span> output[which];</span><br><span class="line">&#125;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>到此程序应该会编译通过，可以试着编译一下运行。 GO ON… 接下来我们首先要用ifget方法获取自身的IP和子网掩码 函数声明：</p>
      <figure class="highlight cpp">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ifget</span><span class="params">(<span class="keyword">pcap_if_t</span> *d, <span class="keyword">char</span> *ip_addr, <span class="keyword">char</span> *ip_netmask)</span></span>;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <figure class="highlight livescript">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="regexp">//获取IP和子网掩码赋值为ip_addr和ip_netmask</span></span><br><span class="line"><span class="regexp">void ifget(pcap_if_t *d, char *ip_addr, char *ip_netmask) &#123;</span></span><br><span class="line"><span class="regexp">	pcap_addr_t *a;</span></span><br><span class="line"><span class="regexp">	//</span>遍历所有的地址,a代表一个pcap_addr</span><br><span class="line">	<span class="keyword">for</span> (a = d-&gt;addresses; a; a = a-&gt;next) &#123;</span><br><span class="line">		<span class="keyword">switch</span> (a-&gt;addr-&gt;sa_family) &#123;</span><br><span class="line">		<span class="keyword">case</span> AF_INET:  <span class="regexp">//sa_family ：是2字节的地址家族，一般都是“AF_xxx”的形式。通常用的都是AF_INET。代表IPV4</span></span><br><span class="line"><span class="regexp">			if (a-&gt;addr) &#123;</span></span><br><span class="line"><span class="regexp">				char *ipstr;</span></span><br><span class="line"><span class="regexp">				//</span>将地址转化为字符串</span><br><span class="line">				ipstr = iptos<span class="function"><span class="params">(((struct sockaddr_in *) a-&gt;addr)-&gt;sin_addr.s_addr)</span>; //*<span class="title">ip_addr</span></span></span><br><span class="line"><span class="function">				<span class="title">printf</span><span class="params">(<span class="string">"ipstr:%s\n"</span>,ipstr)</span>;</span></span><br><span class="line"><span class="function">				<span class="title">memcpy</span><span class="params">(ip_addr, ipstr, <span class="number">16</span>)</span>;</span></span><br><span class="line"><span class="function">			&#125;</span></span><br><span class="line"><span class="function">			<span class="title">if</span> <span class="params">(a-&gt;netmask)</span> &#123;</span></span><br><span class="line"><span class="function">				<span class="title">char</span> *<span class="title">netmaskstr</span>;</span></span><br><span class="line"><span class="function">				<span class="title">netmaskstr</span> = <span class="title">iptos</span><span class="params">(((struct sockaddr_in *) a-&gt;netmask)-&gt;sin_addr.s_addr)</span>;</span></span><br><span class="line"><span class="function">				<span class="title">printf</span><span class="params">(<span class="string">"netmask:%s\n"</span>,netmaskstr)</span>;</span></span><br><span class="line"><span class="function">				<span class="title">memcpy</span><span class="params">(ip_netmask, netmaskstr, <span class="number">16</span>)</span>;</span></span><br><span class="line"><span class="function">			&#125;</span></span><br><span class="line"><span class="function">		<span class="title">case</span> <span class="title">AF_INET6</span>:</span></span><br><span class="line"><span class="function">			<span class="title">break</span>;</span></span><br><span class="line"><span class="function">		&#125;</span></span><br><span class="line"><span class="function">	&#125;</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>main函数继续写，如下调用，之前声明的ip_addr和ip_netmask就已经被赋值了</p>
      <figure class="highlight brainfuck">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="comment">ifget(d</span><span class="string">,</span> <span class="comment">ip_addr</span><span class="string">,</span> <span class="comment">ip_netmask);</span> <span class="comment">//获取所选网卡的基本信息</span>--<span class="comment">掩码</span>--<span class="comment">IP地址</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>到现在我们已经获取到了本机的IP和子网掩码，下一步发送一个ARP请求来获取自身的MAC地址 这个ARP请求的源IP地址就随便指定了，就相当于你构造了一个外来的ARP请求，本机捕获到了请求，然后发送回应给对方的数据包也被本机捕获到了并解析出来了。解析了自己发出去的数据包而已。 那么我们就声明一个函数并实现：</p>
      <figure class="highlight reasonml">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="built_in">int</span> <span class="constructor">GetSelfMac(<span class="params">pcap_t</span> <span class="operator">*</span><span class="params">adhandle</span>, <span class="params">const</span> <span class="params">char</span> <span class="operator">*</span><span class="params">ip_addr</span>, <span class="params">unsigned</span> <span class="params">char</span> <span class="operator">*</span><span class="params">ip_mac</span>)</span>;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <figure class="highlight cpp">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="comment">// 获取自己主机的MAC地址</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">GetSelfMac</span><span class="params">(<span class="keyword">pcap_t</span> *adhandle, <span class="keyword">const</span> <span class="keyword">char</span> *ip_addr, <span class="keyword">unsigned</span> <span class="keyword">char</span> *ip_mac)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> sendbuf[<span class="number">42</span>]; <span class="comment">//arp包结构大小</span></span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">int</span> res;</span><br><span class="line">	EthernetHeader eh; <span class="comment">//以太网帧头</span></span><br><span class="line">	Arpheader ah;  <span class="comment">//ARP帧头</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">pcap_pkthdr</span> * <span class="title">pkt_header</span>;</span></span><br><span class="line">	<span class="keyword">const</span> u_char * pkt_data;</span><br><span class="line">	<span class="comment">//将已开辟内存空间 eh.dest_mac_add 的首 6个字节的值设为值 0xff。</span></span><br><span class="line">	<span class="built_in">memset</span>(eh.DestMAC, <span class="number">0xff</span>, <span class="number">6</span>); <span class="comment">//目的地址为全为广播地址</span></span><br><span class="line">	<span class="built_in">memset</span>(eh.SourMAC, <span class="number">0x0f</span>, <span class="number">6</span>);</span><br><span class="line">	<span class="built_in">memset</span>(ah.DestMacAdd, <span class="number">0x0f</span>, <span class="number">6</span>);</span><br><span class="line">	<span class="built_in">memset</span>(ah.SourceMacAdd, <span class="number">0x00</span>, <span class="number">6</span>);</span><br><span class="line">	<span class="comment">//htons将一个无符号短整型的主机数值转换为网络字节顺序</span></span><br><span class="line">	eh.EthType = htons(ETH_ARP);</span><br><span class="line">	ah.HardwareType= htons(ARP_HARDWARE);</span><br><span class="line">	ah.ProtocolType = htons(ETH_IP);</span><br><span class="line">	ah.HardwareAddLen = <span class="number">6</span>;</span><br><span class="line">	ah.ProtocolAddLen = <span class="number">4</span>;</span><br><span class="line">	ah.SourceIpAdd = inet_addr(<span class="string">"100.100.100.100"</span>); <span class="comment">//随便设的请求方ip</span></span><br><span class="line">	ah.OperationField = htons(ARP_REQUEST);</span><br><span class="line">	ah.DestIpAdd = inet_addr(ip_addr);</span><br><span class="line">	<span class="built_in">memset</span>(sendbuf, <span class="number">0</span>, <span class="keyword">sizeof</span>(sendbuf));</span><br><span class="line">	<span class="built_in">memcpy</span>(sendbuf, &amp;eh, <span class="keyword">sizeof</span>(eh));</span><br><span class="line">	<span class="built_in">memcpy</span>(sendbuf + <span class="keyword">sizeof</span>(eh), &amp;ah, <span class="keyword">sizeof</span>(ah));</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%s"</span>,sendbuf);</span><br><span class="line">	<span class="keyword">if</span> (pcap_sendpacket(adhandle, sendbuf, <span class="number">42</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"\nPacketSend succeed\n"</span>);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"PacketSendPacket in getmine Error: %d\n"</span>, GetLastError());</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//从interface或离线记录文件获取一个报文</span></span><br><span class="line">	<span class="comment">//pcap_next_ex(pcap_t* p,struct pcap_pkthdr** pkt_header,const u_char** pkt_data)</span></span><br><span class="line">	<span class="keyword">while</span> ((res = pcap_next_ex(adhandle, &amp;pkt_header, &amp;pkt_data)) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (*(<span class="keyword">unsigned</span> short *) (pkt_data + <span class="number">12</span>) == htons(ETH_ARP)</span><br><span class="line">				&amp;&amp; *(<span class="keyword">unsigned</span> short*) (pkt_data + <span class="number">20</span>) == htons(ARP_REPLY)</span><br><span class="line">				&amp;&amp; *(<span class="keyword">unsigned</span> <span class="keyword">long</span>*) (pkt_data + <span class="number">38</span>)</span><br><span class="line">						== inet_addr(<span class="string">"100.100.100.100"</span>)) &#123;</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">				ip_mac[i] = *(<span class="keyword">unsigned</span> <span class="keyword">char</span> *) (pkt_data + <span class="number">22</span> + i);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"获取自己主机的MAC地址成功!\n"</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (i == <span class="number">6</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>其中我们需要定义一下常量如下</p>
      <figure class="highlight cpp">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ETH_ARP         0x0806  <span class="comment">//以太网帧类型表示后面数据的类型，对于ARP请求或应答来说，该字段的值为x0806</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ARP_HARDWARE    1  <span class="comment">//硬件类型字段值为表示以太网地址</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ETH_IP          0x0800  <span class="comment">//协议类型字段表示要映射的协议地址类型值为x0800表示IP地址</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ARP_REQUEST     1   <span class="comment">//ARP请求</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ARP_REPLY       2      <span class="comment">//ARP应答</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HOSTNUM         255   <span class="comment">//主机数量</span></span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>另外发送ARP请求少不了帧头和ARP头的结构，我们需要声明出来，另外我们构建发送包需要再声明两个结构体sparam和gparam</p>
      <figure class="highlight cpp">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="comment">//帧头部结构体，共14字节</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">EthernetHeader</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    u_char DestMAC[<span class="number">6</span>];    <span class="comment">//目的MAC地址 6字节</span></span><br><span class="line">    u_char SourMAC[<span class="number">6</span>];   <span class="comment">//源MAC地址 6字节</span></span><br><span class="line">    u_short EthType;         <span class="comment">//上一层协议类型，如0x0800代表上一层是IP协议，0x0806为arp  2字节</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//28字节ARP帧结构</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Arpheader</span> &#123;</span></span><br><span class="line">	<span class="keyword">unsigned</span> short HardwareType; <span class="comment">//硬件类型</span></span><br><span class="line">	<span class="keyword">unsigned</span> short ProtocolType; <span class="comment">//协议类型</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> HardwareAddLen; <span class="comment">//硬件地址长度</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> ProtocolAddLen; <span class="comment">//协议地址长度</span></span><br><span class="line">	<span class="keyword">unsigned</span> short OperationField; <span class="comment">//操作字段</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> SourceMacAdd[<span class="number">6</span>]; <span class="comment">//源mac地址</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> SourceIpAdd; <span class="comment">//源ip地址</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> DestMacAdd[<span class="number">6</span>]; <span class="comment">//目的mac地址</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> DestIpAdd; <span class="comment">//目的ip地址</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//arp包结构</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ArpPacket</span> &#123;</span></span><br><span class="line">	EthernetHeader ed;</span><br><span class="line">	Arpheader ah;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sparam</span> &#123;</span></span><br><span class="line">	<span class="keyword">pcap_t</span> *adhandle;</span><br><span class="line">	<span class="keyword">char</span> *ip;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> *mac;</span><br><span class="line">	<span class="keyword">char</span> *netmask;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">gparam</span> &#123;</span></span><br><span class="line">	<span class="keyword">pcap_t</span> *adhandle;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sparam</span> <span class="title">sp</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">gparam</span> <span class="title">gp</span>;</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>到现在代码也是完整可以运行的，如果有问题请检查上述代码完整性和位置。 可能出现的BUG： 只显示ARP发送成功，没有接受到并解析打印。可能的原因是帧构造有问题，字节没有对齐，有偏差，像#define一样 写入如下代码：</p>
      <figure class="highlight cpp">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> pack(1)  <span class="comment">//按一个字节内存对齐</span></span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>GO ON.. 获取到了自身的MAC地址之后，就可以在本机上构建ARP广播请求，向局域网内的所有主机发送ARP请求，得到回应之后解析回应的数据包并进行解析，得到对方的MAC地址。在这里我们需要开启两个线程，一个用来发送一个用来接收。好，我们继续.. 先声明两个线程</p>
      <figure class="highlight lasso">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="keyword">HANDLE</span> sendthread;      <span class="comment">//发送ARP包线程</span></span><br><span class="line"><span class="keyword">HANDLE</span> recvthread;       <span class="comment">//接受ARP包线程</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>在main方法中继续写，对sp和gp两个ARP请求所需要的结构体进行赋值。赋值什么？就是你之前用ifget获取来的IP地址和子网掩码以及用getSelfMac获取来的MAC地址。</p>
      <figure class="highlight abnf">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">sp.adhandle = adhandle<span class="comment">;</span></span><br><span class="line">	sp.ip = ip_addr<span class="comment">;</span></span><br><span class="line">	sp.mac = ip_mac<span class="comment">;</span></span><br><span class="line">	sp.netmask = ip_netmask<span class="comment">;</span></span><br><span class="line">	gp.adhandle = adhandle<span class="comment">;</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>接下来直接创建两个线程，一个是发送一个接受，分别调用两个方法。</p>
      <figure class="highlight lisp">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">sendthread = CreateThread(<span class="name">NULL</span>, <span class="number">0</span>, (<span class="name">LPTHREAD_START_ROUTINE</span>) SendArpPacket,</span><br><span class="line">			<span class="symbol">&amp;sp</span>, <span class="number">0</span>, NULL)<span class="comment">;</span></span><br><span class="line">	recvthread = CreateThread(<span class="name">NULL</span>, <span class="number">0</span>, (<span class="name">LPTHREAD_START_ROUTINE</span>) GetLivePC, <span class="symbol">&amp;gp</span>,</span><br><span class="line">			<span class="number">0</span>, NULL)<span class="comment">;</span></span><br><span class="line">	printf(<span class="string">"\nlistening on 网卡%d ...\n"</span>, i)<span class="comment">;</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>那么发送数据包的方法和接收解析数据包的方法怎样实现呢？ 发送数据包，发送数据包先对结构体数据进行赋值，就像getSelfMac方法一样，然后声明了一个buffer用来存储每一个字节内容。 利用memset方法对buffer进行赋值。再利用一个for循环对255个主机进行发送，指定他们的IP地址。另外定义了一个flag,当发送成功之后将flag设置为1</p>
      <figure class="highlight cpp">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="comment">/* 向局域网内所有可能的IP地址发送ARP请求包线程 */</span></span><br><span class="line"><span class="function">DWORD WINAPI <span class="title">SendArpPacket</span><span class="params">(LPVOID lpParameter)</span> <span class="comment">//(pcap_t *adhandle,char *ip,unsigned char *mac,char *netmask)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	sparam *spara = (sparam *) lpParameter;</span><br><span class="line">	<span class="keyword">pcap_t</span> *adhandle = spara-&gt;adhandle;</span><br><span class="line">	<span class="keyword">char</span> *ip = spara-&gt;ip;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> *mac = spara-&gt;mac;</span><br><span class="line">	<span class="keyword">char</span> *netmask = spara-&gt;netmask;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"ip_mac:%02x-%02x-%02x-%02x-%02x-%02x\n"</span>, mac[<span class="number">0</span>], mac[<span class="number">1</span>], mac[<span class="number">2</span>],</span><br><span class="line">			mac[<span class="number">3</span>], mac[<span class="number">4</span>], mac[<span class="number">5</span>]);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"自身的IP地址为:%s\n"</span>, ip);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"地址掩码NETMASK为:%s\n"</span>, netmask);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> sendbuf[<span class="number">42</span>]; <span class="comment">//arp包结构大小</span></span><br><span class="line">	EthernetHeader eh;</span><br><span class="line">	Arpheader ah;</span><br><span class="line">	<span class="comment">//赋值MAC地址</span></span><br><span class="line">	<span class="built_in">memset</span>(eh.DestMAC, <span class="number">0xff</span>, <span class="number">6</span>);       <span class="comment">//目的地址为全为广播地址</span></span><br><span class="line">	<span class="built_in">memcpy</span>(eh.SourMAC, mac, <span class="number">6</span>);</span><br><span class="line">	<span class="built_in">memcpy</span>(ah.SourceMacAdd, mac, <span class="number">6</span>);</span><br><span class="line">	<span class="built_in">memset</span>(ah.DestMacAdd, <span class="number">0x00</span>, <span class="number">6</span>);</span><br><span class="line">	eh.EthType = htons(ETH_ARP);</span><br><span class="line">	ah.HardwareType = htons(ARP_HARDWARE);</span><br><span class="line">	ah.ProtocolType = htons(ETH_IP);</span><br><span class="line">	ah.HardwareAddLen = <span class="number">6</span>;</span><br><span class="line">	ah.ProtocolAddLen = <span class="number">4</span>;</span><br><span class="line">	ah.SourceIpAdd = inet_addr(ip); <span class="comment">//请求方的IP地址为自身的IP地址</span></span><br><span class="line">	ah.OperationField = htons(ARP_REQUEST);</span><br><span class="line">	<span class="comment">//向局域网内广播发送arp包</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> myip = inet_addr(ip);</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> mynetmask = inet_addr(netmask);</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> hisip = htonl((myip &amp; mynetmask));</span><br><span class="line">	<span class="comment">//向255个主机发送</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; HOSTNUM; i++) &#123;</span><br><span class="line">		ah.DestIpAdd = htonl(hisip + i);</span><br><span class="line">		<span class="comment">//构造一个ARP请求</span></span><br><span class="line">		<span class="built_in">memset</span>(sendbuf, <span class="number">0</span>, <span class="keyword">sizeof</span>(sendbuf));</span><br><span class="line">		<span class="built_in">memcpy</span>(sendbuf, &amp;eh, <span class="keyword">sizeof</span>(eh));</span><br><span class="line">		<span class="built_in">memcpy</span>(sendbuf + <span class="keyword">sizeof</span>(eh), &amp;ah, <span class="keyword">sizeof</span>(ah));</span><br><span class="line">		<span class="comment">//如果发送成功</span></span><br><span class="line">		<span class="keyword">if</span> (pcap_sendpacket(adhandle, sendbuf, <span class="number">42</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="comment">//printf("\nPacketSend succeed\n");</span></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"PacketSendPacket in getmine Error: %d\n"</span>, GetLastError());</span><br><span class="line">		&#125;</span><br><span class="line">		Sleep(<span class="number">50</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	Sleep(<span class="number">1000</span>);</span><br><span class="line">	flag = TRUE;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>注: 此函数和flag变量在前面别忘了声明一下… 然后是接收数据包并打印MAC地址:</p>
      <figure class="highlight cpp">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="comment">/* 分析截留的数据包获取活动的主机IP地址 */</span></span><br><span class="line"><span class="function">DWORD WINAPI <span class="title">GetLivePC</span><span class="params">(LPVOID lpParameter)</span> <span class="comment">//(pcap_t *adhandle)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	gparam *gpara = (gparam *) lpParameter;</span><br><span class="line">	<span class="keyword">pcap_t</span> *adhandle = gpara-&gt;adhandle;</span><br><span class="line">	<span class="keyword">int</span> res;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> Mac[<span class="number">6</span>];</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">pcap_pkthdr</span> * <span class="title">pkt_header</span>;</span></span><br><span class="line">	<span class="keyword">const</span> u_char * pkt_data;</span><br><span class="line">	<span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (flag) &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"获取MAC地址完毕,请输入你要发送对方的IP地址:\n"</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> ((res = pcap_next_ex(adhandle, &amp;pkt_header, &amp;pkt_data)) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (*(<span class="keyword">unsigned</span> short *) (pkt_data + <span class="number">12</span>) == htons(ETH_ARP)) &#123;</span><br><span class="line">				ArpPacket *recv = (ArpPacket *) pkt_data;</span><br><span class="line">				<span class="keyword">if</span> (*(<span class="keyword">unsigned</span> short *) (pkt_data + <span class="number">20</span>) == htons(ARP_REPLY)) &#123;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">"-------------------------------------------\n"</span>);</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">"IP地址:%d.%d.%d.%d   MAC地址:"</span>,</span><br><span class="line">						     recv-&gt;ah.SourceIpAdd &amp; <span class="number">255</span>,</span><br><span class="line">							 recv-&gt;ah.SourceIpAdd &gt;&gt; <span class="number">8</span> &amp; <span class="number">255</span>,</span><br><span class="line">							 recv-&gt;ah.SourceIpAdd &gt;&gt; <span class="number">16</span> &amp; <span class="number">255</span>,</span><br><span class="line">							 recv-&gt;ah.SourceIpAdd &gt;&gt; <span class="number">24</span> &amp; <span class="number">255</span>);</span><br><span class="line">					<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">						Mac[i] = *(<span class="keyword">unsigned</span> <span class="keyword">char</span> *) (pkt_data + <span class="number">22</span> + i);</span><br><span class="line">						<span class="built_in">printf</span>(<span class="string">"%02x"</span>, Mac[i]);</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		Sleep(<span class="number">10</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>以上暂告一段落，通过整合以上代码，我们可以得到如下运行结果：</p>
      <figure class="highlight asciidoc">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">--------------------------------------------------</span><br><span class="line">number:1</span><br><span class="line">name:rpcap://\Device\NPF<span class="emphasis">_&#123;5AC72F8D-019C-4003-B51B-</span></span><br><span class="line"><span class="emphasis">description:Network adapter 'Microsoft' on local h</span></span><br><span class="line"><span class="emphasis">        Loopback: no</span></span><br><span class="line"><span class="emphasis">Address Family Name:AF_</span>INET6</span><br><span class="line">this is an IPV6 address</span><br><span class="line">Address Family Name:AF<span class="emphasis">_INET6</span></span><br><span class="line"><span class="emphasis">this is an IPV6 address</span></span><br><span class="line"><span class="emphasis">--------------------------------------------------</span></span><br><span class="line"><span class="emphasis">number:2</span></span><br><span class="line"><span class="emphasis">name:rpcap://\Device\NPF_</span>&#123;C17EB3F6-1E86-40E5-8790-</span><br><span class="line">description:Network adapter <span class="emphasis">'Microsoft'</span> on local h</span><br><span class="line"><span class="code">        Loopback: no</span></span><br><span class="line">Address Family Name:AF<span class="emphasis">_INET6</span></span><br><span class="line"><span class="emphasis">this is an IPV6 address</span></span><br><span class="line"><span class="emphasis">Address Family Name:AF_</span>INET</span><br><span class="line">Address:192.168.95.1</span><br><span class="line"><span class="code">        Netmask: 255.255.255.0</span></span><br><span class="line"><span class="code">        Broadcast Address: 255.255.255.255</span></span><br><span class="line">--------------------------------------------------</span><br><span class="line">number:3</span><br><span class="line">name:rpcap://\Device\NPF<span class="emphasis">_&#123;33E23A2F-F791-409B-8452-</span></span><br><span class="line"><span class="emphasis">description:Network adapter 'Qualcomm Atheros Ar81</span></span><br><span class="line"><span class="emphasis">oller' on local host</span></span><br><span class="line"><span class="emphasis">        Loopback: no</span></span><br><span class="line"><span class="emphasis">Address Family Name:AF_</span>INET6</span><br><span class="line">this is an IPV6 address</span><br><span class="line">Address Family Name:AF<span class="emphasis">_INET6</span></span><br><span class="line"><span class="emphasis">this is an IPV6 address</span></span><br><span class="line"><span class="emphasis">Address Family Name:AF_</span>INET6</span><br><span class="line">this is an IPV6 address</span><br><span class="line">Address Family Name:AF<span class="emphasis">_INET</span></span><br><span class="line"><span class="emphasis">Address:121.250.216.237</span></span><br><span class="line"><span class="emphasis">        Netmask: 255.255.255.0</span></span><br><span class="line"><span class="emphasis">        Broadcast Address: 255.255.255.255</span></span><br><span class="line"><span class="emphasis">--------------------------------------------------</span></span><br><span class="line"><span class="emphasis">number:4</span></span><br><span class="line"><span class="emphasis">name:rpcap://\Device\NPF_</span>&#123;DCCF036F-A9A8-4225-B980-</span><br><span class="line">description:Network adapter <span class="emphasis">'Microsoft'</span> on local h</span><br><span class="line"><span class="code">        Loopback: no</span></span><br><span class="line">Address Family Name:AF<span class="emphasis">_INET6</span></span><br><span class="line"><span class="emphasis">this is an IPV6 address</span></span><br><span class="line"><span class="emphasis">Address Family Name:AF_</span>INET6</span><br><span class="line">this is an IPV6 address</span><br><span class="line">--------------------------------------------------</span><br><span class="line">number:5</span><br><span class="line">name:rpcap://\Device\NPF<span class="emphasis">_&#123;D62A0060-F424-46FC-83A5-</span></span><br><span class="line"><span class="emphasis">description:Network adapter 'Microsoft' on local h</span></span><br><span class="line"><span class="emphasis">        Loopback: no</span></span><br><span class="line"><span class="emphasis">Address Family Name:AF_</span>INET6</span><br><span class="line">this is an IPV6 address</span><br><span class="line">Address Family Name:AF<span class="emphasis">_INET</span></span><br><span class="line"><span class="emphasis">Address:192.168.191.1</span></span><br><span class="line"><span class="emphasis">        Netmask: 255.255.255.0</span></span><br><span class="line"><span class="emphasis">        Broadcast Address: 255.255.255.255</span></span><br><span class="line"><span class="emphasis">--------------------------------------------------</span></span><br><span class="line"><span class="emphasis">number:6</span></span><br><span class="line"><span class="emphasis">name:rpcap://\Device\NPF_</span>&#123;B5224A53-8450-4537-AB3B-</span><br><span class="line">description:Network adapter <span class="emphasis">'Microsoft'</span> on local h</span><br><span class="line"><span class="code">        Loopback: no</span></span><br><span class="line">Address Family Name:AF<span class="emphasis">_INET6</span></span><br><span class="line"><span class="emphasis">this is an IPV6 address</span></span><br><span class="line"><span class="emphasis">Address Family Name:AF_</span>INET</span><br><span class="line">Address:192.168.191.2</span><br><span class="line"><span class="code">        Netmask: 255.255.255.0</span></span><br><span class="line"><span class="code">        Broadcast Address: 255.255.255.255</span></span><br><span class="line">Enter the interface number(1-6):3</span><br><span class="line"></span><br><span class="line">ipstr:121.250.216.237</span><br><span class="line">netmask:255.255.255.0</span><br><span class="line"></span><br><span class="line">PacketSend succeed</span><br><span class="line">获取自己主机的MAC地址成功!</span><br><span class="line"></span><br><span class="line">listening on 网卡2 ...</span><br><span class="line">ip<span class="emphasis">_mac:dc-0e-a1-ec-53-c3</span></span><br><span class="line"><span class="emphasis">自身的IP地址为:121.250.216.237</span></span><br><span class="line"><span class="emphasis">地址掩码NETMASK为:255.255.255.0</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">请按任意键继续. . . ------------------------------</span></span><br><span class="line"><span class="emphasis">IP地址:121.250.216.1   MAC地址:000fe28e6100</span></span><br><span class="line"><span class="emphasis">-------------------------------------------</span></span><br><span class="line"><span class="emphasis">IP地址:121.250.216.3   MAC地址:089e012d20d5</span></span><br><span class="line"><span class="emphasis">-------------------------------------------</span></span><br><span class="line"><span class="emphasis">IP地址:121.250.216.5   MAC地址:5404a6af5f2d</span></span><br><span class="line"><span class="emphasis">-------------------------------------------</span></span><br><span class="line"><span class="emphasis">IP地址:121.250.216.6   MAC地址:28d244248d81</span></span><br><span class="line"><span class="emphasis">-------------------------------------------</span></span><br><span class="line"><span class="emphasis">IP地址:121.250.216.7   MAC地址:80fa5b0283f3</span></span><br><span class="line"><span class="emphasis">-------------------------------------------</span></span><br><span class="line"><span class="emphasis">IP地址:121.250.216.8   MAC地址:14dae9005b9e</span></span><br><span class="line"><span class="emphasis">-------------------------------------------</span></span><br><span class="line"><span class="emphasis">IP地址:121.250.216.9   MAC地址:b82a72bf8bce</span></span><br><span class="line"><span class="emphasis">-------------------------------------------</span></span><br><span class="line"><span class="emphasis">IP地址:121.250.216.12   MAC地址:84c9b2fefeed</span></span><br><span class="line"><span class="emphasis">-------------------------------------------</span></span><br><span class="line"><span class="emphasis">IP地址:121.250.216.15   MAC地址:28d2440b4b1b</span></span><br><span class="line"><span class="emphasis">-------------------------------------------</span></span><br><span class="line"><span class="emphasis">IP地址:121.250.216.16   MAC地址:bcee7b969beb</span></span><br><span class="line"><span class="emphasis">-------------------------------------------</span></span><br><span class="line"><span class="emphasis">........此处省略一万字....</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>接下来我们让用户输入要发送的IP地址和要发送的数据</p>
      <figure class="highlight perl">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">u_int ip1,ip2,ip3,ip4;</span><br><span class="line">		scanf_s(<span class="string">"%d.%d.%d.%d"</span>,&amp;ip1,&amp;ip2,&amp;ip3,&amp;ip4);</span><br><span class="line">		<span class="keyword">printf</span>(<span class="string">"请输入你要发送的内容:\n"</span>);</span><br><span class="line">		getchar();</span><br><span class="line">		gets_s(TcpData);</span><br><span class="line">		<span class="keyword">printf</span>(<span class="string">"要发送的内容:%s\n"</span>,TcpData);</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>声明一下TcpData</p>
      <figure class="highlight scss">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">char TcpData<span class="selector-attr">[20]</span>;   <span class="comment">//发送内容</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>接下来就是重头戏了，需要声明各种结构体，我们发送的是TCP数据，这样，TCP的TcpData 就作为真正的内容，然后在前面加上TCP头，IP头，帧头，还有校验和要正确。 最后构成一个完整的帧，那么另外声明的结构体如下，前面代码声明过的帧头部结构体就去掉了。</p>
      <figure class="highlight objectivec">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="comment">//IP地址格式</span></span><br><span class="line"><span class="keyword">struct</span> IpAddress</span><br><span class="line">&#123;</span><br><span class="line">    u_char byte1;</span><br><span class="line">    u_char byte2;</span><br><span class="line">    u_char byte3;</span><br><span class="line">    u_char byte4;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//帧头部结构体，共14字节</span></span><br><span class="line"><span class="keyword">struct</span> EthernetHeader</span><br><span class="line">&#123;</span><br><span class="line">    u_char DestMAC[<span class="number">6</span>];    <span class="comment">//目的MAC地址 6字节</span></span><br><span class="line">    u_char SourMAC[<span class="number">6</span>];   <span class="comment">//源MAC地址 6字节</span></span><br><span class="line">    u_short EthType;         <span class="comment">//上一层协议类型，如0x0800代表上一层是IP协议，0x0806为arp  2字节</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//IP头部结构体，共20字节</span></span><br><span class="line"><span class="keyword">struct</span> IpHeader</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> Version_HLen;   <span class="comment">//版本信息4位 ，头长度4位 1字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> TOS;                    <span class="comment">//服务类型    1字节</span></span><br><span class="line">    <span class="keyword">short</span> Length;                              <span class="comment">//数据包长度 2字节</span></span><br><span class="line">    <span class="keyword">short</span> Ident;                                 <span class="comment">//数据包标识  2字节</span></span><br><span class="line">    <span class="keyword">short</span> Flags_Offset;                    <span class="comment">//标志3位，片偏移13位  2字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> TTL;                   <span class="comment">//存活时间  1字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> Protocol;          <span class="comment">//协议类型  1字节</span></span><br><span class="line">    <span class="keyword">short</span> Checksum;                       <span class="comment">//首部校验和 2字节</span></span><br><span class="line">	IpAddress SourceAddr;       <span class="comment">//源IP地址   4字节</span></span><br><span class="line">	IpAddress DestinationAddr; <span class="comment">//目的IP地址  4字节</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//TCP头部结构体，共20字节</span></span><br><span class="line"><span class="keyword">struct</span> TcpHeader</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">short</span> SrcPort;                        <span class="comment">//源端口号  2字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">short</span> DstPort;                        <span class="comment">//目的端口号 2字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> SequenceNum;               <span class="comment">//序号  4字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> Acknowledgment;         <span class="comment">//确认号  4字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> HdrLen;                         <span class="comment">//首部长度4位，保留位6位 共10位</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> Flags;                              <span class="comment">//标志位6位</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">short</span> AdvertisedWindow;  <span class="comment">//窗口大小16位 2字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">short</span> Checksum;                  <span class="comment">//校验和16位   2字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">short</span> UrgPtr;						  <span class="comment">//紧急指针16位   2字节</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//TCP伪首部结构体 12字节</span></span><br><span class="line"><span class="keyword">struct</span> PsdTcpHeader</span><br><span class="line">&#123;</span><br><span class="line">	IpAddress SourceAddr;                     <span class="comment">//源IP地址  4字节</span></span><br><span class="line">	IpAddress DestinationAddr;             <span class="comment">//目的IP地址 4字节</span></span><br><span class="line">    <span class="keyword">char</span> Zero;                                                    <span class="comment">//填充位  1字节</span></span><br><span class="line">    <span class="keyword">char</span> Protcol;                                               <span class="comment">//协议号  1字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">short</span> TcpLen;                           <span class="comment">//TCP包长度 2字节</span></span><br><span class="line">&#125;;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>继续main函数中对各种结构体的数据进行初始化赋值，并计算校验和。</p>
      <figure class="highlight arduino">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="comment">//结构体初始化为0序列</span></span><br><span class="line">		<span class="built_in">memset</span>(&amp;ethernet, <span class="number">0</span>, <span class="keyword">sizeof</span>(ethernet));</span><br><span class="line">		BYTE destmac[<span class="number">8</span>];</span><br><span class="line">		<span class="comment">//目的MAC地址,此处没有对帧的MAC地址进行赋值，因为网卡设置的混杂模式，可以接受经过该网卡的所有帧。当然最好的方法是赋值为ARP刚才获取到的MAC地址，当然不赋值也可以捕捉到并解析，在此处仅做下说明。</span></span><br><span class="line">		destmac[<span class="number">0</span>] = <span class="number">0x00</span>;</span><br><span class="line">		destmac[<span class="number">1</span>] = <span class="number">0x11</span>;</span><br><span class="line">		destmac[<span class="number">2</span>] = <span class="number">0x22</span>;</span><br><span class="line">		destmac[<span class="number">3</span>] = <span class="number">0x33</span>;</span><br><span class="line">		destmac[<span class="number">4</span>] = <span class="number">0x44</span>;</span><br><span class="line">		destmac[<span class="number">5</span>] = <span class="number">0x55</span>;</span><br><span class="line">		<span class="comment">//赋值目的MAC地址</span></span><br><span class="line">		<span class="built_in">memcpy</span>(ethernet.DestMAC, destmac, <span class="number">6</span>);</span><br><span class="line">		BYTE hostmac[<span class="number">8</span>];</span><br><span class="line">		<span class="comment">//源MAC地址</span></span><br><span class="line">		hostmac[<span class="number">0</span>] = <span class="number">0x00</span>;</span><br><span class="line">		hostmac[<span class="number">1</span>] = <span class="number">0x1a</span>;</span><br><span class="line">		hostmac[<span class="number">2</span>] = <span class="number">0x4d</span>;</span><br><span class="line">		hostmac[<span class="number">3</span>] = <span class="number">0x70</span>;</span><br><span class="line">		hostmac[<span class="number">4</span>] = <span class="number">0xa3</span>;</span><br><span class="line">		hostmac[<span class="number">5</span>] = <span class="number">0x89</span>;</span><br><span class="line">		<span class="comment">//赋值源MAC地址</span></span><br><span class="line">		<span class="built_in">memcpy</span>(ethernet.SourMAC, hostmac, <span class="number">6</span>);</span><br><span class="line">		<span class="comment">//上层协议类型,0x0800代表IP协议</span></span><br><span class="line">		ethernet.EthType = htons(<span class="number">0x0800</span>);</span><br><span class="line">		<span class="comment">//赋值SendBuffer</span></span><br><span class="line">		<span class="built_in">memcpy</span>(&amp;SendBuffer, ðernet, <span class="keyword">sizeof</span>(struct EthernetHeader));</span><br><span class="line">		<span class="comment">//赋值IP头部信息</span></span><br><span class="line">		ip.Version_HLen = <span class="number">0x45</span>;</span><br><span class="line">		ip.TOS = <span class="number">0</span>;</span><br><span class="line">		ip.Length = htons(<span class="keyword">sizeof</span>(struct IpHeader) + <span class="keyword">sizeof</span>(struct TcpHeader) + <span class="built_in">strlen</span>(TcpData));</span><br><span class="line">		ip.Ident = htons(<span class="number">1</span>);</span><br><span class="line">		ip.Flags_Offset = <span class="number">0</span>;</span><br><span class="line">		ip.TTL = <span class="number">128</span>;</span><br><span class="line">		ip.Protocol = <span class="number">6</span>;</span><br><span class="line">		ip.Checksum = <span class="number">0</span>;</span><br><span class="line">		<span class="comment">//源IP地址</span></span><br><span class="line">		ip.SourceAddr.byte1 = <span class="number">127</span>;</span><br><span class="line">		ip.SourceAddr.byte2 = <span class="number">0</span>;</span><br><span class="line">		ip.SourceAddr.byte3 = <span class="number">0</span>;</span><br><span class="line">		ip.SourceAddr.byte4 = <span class="number">1</span>;</span><br><span class="line">		<span class="comment">//目的IP地址</span></span><br><span class="line">		ip.DestinationAddr.byte1 = ip1;</span><br><span class="line">		ip.DestinationAddr.byte2 = ip2;</span><br><span class="line">		ip.DestinationAddr.byte3 = ip3;</span><br><span class="line">		ip.DestinationAddr.byte4 = ip4;</span><br><span class="line">		<span class="comment">//赋值SendBuffer</span></span><br><span class="line">		<span class="built_in">memcpy</span>(&amp;SendBuffer[<span class="keyword">sizeof</span>(struct EthernetHeader)], &amp;ip, <span class="number">20</span>);</span><br><span class="line">		<span class="comment">//赋值TCP头部内容</span></span><br><span class="line">		tcp.DstPort = htons(<span class="number">102</span>);</span><br><span class="line">		tcp.SrcPort = htons(<span class="number">1000</span>);</span><br><span class="line">		tcp.SequenceNum = htonl(<span class="number">11</span>);</span><br><span class="line">		tcp.Acknowledgment = <span class="number">0</span>;</span><br><span class="line">		tcp.HdrLen = <span class="number">0x50</span>;</span><br><span class="line">		tcp.Flags = <span class="number">0x18</span>;</span><br><span class="line">		tcp.AdvertisedWindow = htons(<span class="number">512</span>);</span><br><span class="line">		tcp.UrgPtr = <span class="number">0</span>;</span><br><span class="line">		tcp.Checksum = <span class="number">0</span>;</span><br><span class="line">		<span class="comment">//赋值SendBuffer</span></span><br><span class="line">		<span class="built_in">memcpy</span>(&amp;SendBuffer[<span class="keyword">sizeof</span>(struct EthernetHeader) + <span class="number">20</span>], &amp;tcp, <span class="number">20</span>);</span><br><span class="line">		<span class="comment">//赋值伪首部</span></span><br><span class="line">		ptcp.SourceAddr = ip.SourceAddr;</span><br><span class="line">		ptcp.DestinationAddr = ip.DestinationAddr;</span><br><span class="line">		ptcp.Zero = <span class="number">0</span>;</span><br><span class="line">		ptcp.Protcol = <span class="number">6</span>;</span><br><span class="line">		ptcp.TcpLen = htons(<span class="keyword">sizeof</span>(struct TcpHeader) + <span class="built_in">strlen</span>(TcpData));</span><br><span class="line">		<span class="comment">//声明临时存储变量，用来计算校验和</span></span><br><span class="line">		<span class="keyword">char</span> TempBuffer[<span class="number">65535</span>];</span><br><span class="line">		<span class="built_in">memcpy</span>(TempBuffer, &amp;ptcp, <span class="keyword">sizeof</span>(struct PsdTcpHeader));</span><br><span class="line">		<span class="built_in">memcpy</span>(TempBuffer + <span class="keyword">sizeof</span>(struct PsdTcpHeader), &amp;tcp, <span class="keyword">sizeof</span>(struct TcpHeader));</span><br><span class="line">		<span class="built_in">memcpy</span>(TempBuffer + <span class="keyword">sizeof</span>(struct PsdTcpHeader) + <span class="keyword">sizeof</span>(struct TcpHeader), TcpData, <span class="built_in">strlen</span>(TcpData));</span><br><span class="line">		<span class="comment">//计算TCP的校验和</span></span><br><span class="line">		tcp.Checksum = checksum((USHORT*)(TempBuffer), <span class="keyword">sizeof</span>(struct PsdTcpHeader) + <span class="keyword">sizeof</span>(struct TcpHeader) + <span class="built_in">strlen</span>(TcpData));</span><br><span class="line">		<span class="comment">//重新把SendBuffer赋值，因为此时校验和已经改变，赋值新的</span></span><br><span class="line">		<span class="built_in">memcpy</span>(SendBuffer + <span class="keyword">sizeof</span>(struct EthernetHeader) + <span class="keyword">sizeof</span>(struct IpHeader), &amp;tcp, <span class="keyword">sizeof</span>(struct TcpHeader));</span><br><span class="line">		<span class="built_in">memcpy</span>(SendBuffer + <span class="keyword">sizeof</span>(struct EthernetHeader) + <span class="keyword">sizeof</span>(struct IpHeader) + <span class="keyword">sizeof</span>(struct TcpHeader), TcpData, <span class="built_in">strlen</span>(TcpData));</span><br><span class="line">		<span class="comment">//初始化TempBuffer为0序列，存储变量来计算IP校验和</span></span><br><span class="line">		<span class="built_in">memset</span>(TempBuffer, <span class="number">0</span>, <span class="keyword">sizeof</span>(TempBuffer));</span><br><span class="line">		<span class="built_in">memcpy</span>(TempBuffer, &amp;ip, <span class="keyword">sizeof</span>(struct IpHeader));</span><br><span class="line">		<span class="comment">//计算IP校验和</span></span><br><span class="line">		ip.Checksum = checksum((USHORT*)(TempBuffer), <span class="keyword">sizeof</span>(struct IpHeader));</span><br><span class="line">		<span class="comment">//重新把SendBuffer赋值，IP校验和已经改变</span></span><br><span class="line">		<span class="built_in">memcpy</span>(SendBuffer + <span class="keyword">sizeof</span>(struct EthernetHeader), &amp;ip, <span class="keyword">sizeof</span>(struct IpHeader));</span><br><span class="line">		<span class="comment">//发送序列的长度</span></span><br><span class="line">		<span class="keyword">int</span> <span class="built_in">size</span> = <span class="keyword">sizeof</span>(struct EthernetHeader) + <span class="keyword">sizeof</span>(struct IpHeader) + <span class="keyword">sizeof</span>(struct TcpHeader) + <span class="built_in">strlen</span>(TcpData);</span><br><span class="line">		<span class="keyword">int</span> result = pcap_sendpacket(adhandle, SendBuffer,<span class="built_in">size</span>);</span><br><span class="line">		<span class="keyword">if</span> (result != <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Send Error!\n"</span>);</span><br><span class="line">		&#125; </span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Send TCP Packet.\n"</span>);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Dstination Port:%d\n"</span>, ntohs(tcp.DstPort));</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Source Port:%d\n"</span>, ntohs(tcp.SrcPort));</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Sequence:%d\n"</span>, ntohl(tcp.SequenceNum));</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Acknowledgment:%d\n"</span>, ntohl(tcp.Acknowledgment));</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Header Length:%d*4\n"</span>, tcp.HdrLen &gt;&gt; <span class="number">4</span>);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Flags:0x%0x\n"</span>, tcp.Flags);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"AdvertiseWindow:%d\n"</span>, ntohs(tcp.AdvertisedWindow));</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"UrgPtr:%d\n"</span>, ntohs(tcp.UrgPtr));</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Checksum:%u\n"</span>, ntohs(tcp.Checksum));</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Send Successfully!\n"</span>);</span><br><span class="line">		&#125;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>校验和方法如下：</p>
      <figure class="highlight objectivec">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="comment">//获得校验和的方法</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">short</span> checksum(<span class="keyword">unsigned</span> <span class="keyword">short</span> *data, <span class="keyword">int</span> length)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> temp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (length &gt; <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        temp +=  *data++;</span><br><span class="line">        length -= <span class="keyword">sizeof</span>(<span class="keyword">unsigned</span> <span class="keyword">short</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (length)</span><br><span class="line">    &#123;</span><br><span class="line">        temp += *(<span class="keyword">unsigned</span> <span class="keyword">short</span>*)data;</span><br><span class="line">    &#125;</span><br><span class="line">    temp = (temp &gt;&gt; <span class="number">16</span>) + (temp &amp;<span class="number">0xffff</span>);</span><br><span class="line">    temp += (temp &gt;&gt; <span class="number">16</span>);</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">unsigned</span> <span class="keyword">short</span>)(~temp);</span><br><span class="line">&#125;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>记得在声明一下这个方法。如果放在main函数前当然就不用声明啦。 另外需要声明的变量有</p>
      <figure class="highlight cpp">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">EthernetHeader</span> <span class="title">ethernet</span>;</span>    <span class="comment">//以太网帧头</span></span><br><span class="line"> <span class="class"><span class="keyword">struct</span> <span class="title">IpHeader</span> <span class="title">ip</span>;</span>                            <span class="comment">//IP头</span></span><br><span class="line"> <span class="class"><span class="keyword">struct</span> <span class="title">TcpHeader</span> <span class="title">tcp</span>;</span>                      <span class="comment">//TCP头</span></span><br><span class="line"> <span class="class"><span class="keyword">struct</span> <span class="title">PsdTcpHeader</span> <span class="title">ptcp</span>;</span>             <span class="comment">//TCP伪首部</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <figure class="highlight cpp">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> SendBuffer[<span class="number">200</span>];       <span class="comment">//发送队列</span></span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>接下来的运行结果：</p>
      <figure class="highlight angelscript">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line">获取MAC地址完毕,请输</span><br><span class="line"><span class="number">121.250</span><span class="number">.216</span><span class="number">.112</span></span><br><span class="line">请输入你要发送的内容</span><br><span class="line">what <span class="keyword">is</span> tcp</span><br><span class="line">要发送的内容:what i</span><br><span class="line">Send TCP Packet.</span><br><span class="line">Dstination Port:<span class="number">102</span></span><br><span class="line">Source Port:<span class="number">1000</span></span><br><span class="line">Sequence:<span class="number">11</span></span><br><span class="line">Acknowledgment:<span class="number">0</span></span><br><span class="line">Header Length:<span class="number">5</span>*<span class="number">4</span></span><br><span class="line">Flags:<span class="number">0x18</span></span><br><span class="line">AdvertiseWindow:<span class="number">512</span></span><br><span class="line">UrgPtr:<span class="number">0</span></span><br><span class="line">Checksum:<span class="number">17149</span></span><br><span class="line">Send Successfully!</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>截图如下： <img src="http://img.blog.csdn.net/20141018211905731?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 好啦，发送帧到此就告一段落啦！如果有疑问请留言。 帧的接收很简单，直接贴源码如下：</p>
      <figure class="highlight cpp">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pcap.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">iptos</span><span class="params">(u_long in)</span></span>;       <span class="comment">//u_long即为 unsigned long</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">packet_handler</span><span class="params">(u_char *param, <span class="keyword">const</span> struct pcap_pkthdr *header, <span class="keyword">const</span> u_char *pkt_data)</span></span>;</span><br><span class="line"><span class="comment">//struct tm *ltime;					//和时间处理有关的变量</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">IpAddress</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    u_char byte1;</span><br><span class="line">    u_char byte2;</span><br><span class="line">    u_char byte3;</span><br><span class="line">    u_char byte4;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//帧头部结构体，共14字节</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">EthernetHeader</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    u_char DestMAC[<span class="number">6</span>];    <span class="comment">//目的MAC地址 6字节</span></span><br><span class="line">    u_char SourMAC[<span class="number">6</span>];   <span class="comment">//源MAC地址 6字节</span></span><br><span class="line">    u_short EthType;         <span class="comment">//上一层协议类型，如0x0800代表上一层是IP协议，0x0806为arp  2字节</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//IP头部结构体，共20字节</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">IpHeader</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> Version_HLen;   <span class="comment">//版本信息4位 ，头长度4位 1字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> TOS;                    <span class="comment">//服务类型    1字节</span></span><br><span class="line">    short Length;                              <span class="comment">//数据包长度 2字节</span></span><br><span class="line">    short Ident;                                 <span class="comment">//数据包标识  2字节</span></span><br><span class="line">    short Flags_Offset;                    <span class="comment">//标志3位，片偏移13位  2字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> TTL;                    <span class="comment">//存活时间  1字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> Protocol;           <span class="comment">//协议类型  1字节</span></span><br><span class="line">    short Checksum;                        <span class="comment">//首部校验和 2字节</span></span><br><span class="line">    IpAddress SourceAddr;           <span class="comment">//源IP地址   4字节</span></span><br><span class="line">    IpAddress DestinationAddr;   <span class="comment">//目的IP地址  4字节</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//TCP头部结构体，共20字节</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TcpHeader</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">unsigned</span> short SrcPort;                        <span class="comment">//源端口号  2字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> short DstPort;                        <span class="comment">//目的端口号 2字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> SequenceNum;               <span class="comment">//序号  4字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> Acknowledgment;         <span class="comment">//确认号  4字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> HdrLen;                         <span class="comment">//首部长度4位，保留位6位 共10位</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> Flags;                              <span class="comment">//标志位6位</span></span><br><span class="line">    <span class="keyword">unsigned</span> short AdvertisedWindow;  <span class="comment">//窗口大小16位 2字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> short Checksum;                  <span class="comment">//校验和16位   2字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> short UrgPtr;						  <span class="comment">//紧急指针16位   2字节</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//TCP伪首部结构体 12字节</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PsdTcpHeader</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> SourceAddr;                     <span class="comment">//源IP地址  4字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> DestinationAddr;             <span class="comment">//目的IP地址 4字节</span></span><br><span class="line">    <span class="keyword">char</span> Zero;                                                    <span class="comment">//填充位  1字节</span></span><br><span class="line">    <span class="keyword">char</span> Protcol;                                               <span class="comment">//协议号  1字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> short TcpLen;                           <span class="comment">//TCP包长度 2字节</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	EthernetHeader *ethernet;    <span class="comment">//以太网帧头</span></span><br><span class="line">    IpHeader *ip;                            <span class="comment">//IP头</span></span><br><span class="line">    TcpHeader *tcp;                      <span class="comment">//TCP头</span></span><br><span class="line">    PsdTcpHeader *ptcp;             <span class="comment">//TCP伪首部</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">pcap_if_t</span>  * alldevs;       <span class="comment">//所有网络适配器</span></span><br><span class="line">	<span class="keyword">pcap_if_t</span>  *d;					<span class="comment">//选中的网络适配器</span></span><br><span class="line">	<span class="keyword">char</span> errbuf[PCAP_ERRBUF_SIZE];   <span class="comment">//错误缓冲区,大小为256</span></span><br><span class="line">	<span class="keyword">char</span> source[PCAP_ERRBUF_SIZE];</span><br><span class="line">	<span class="keyword">pcap_t</span> *adhandle;           <span class="comment">//捕捉实例,是pcap_open返回的对象</span></span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">0</span>;                            <span class="comment">//适配器计数变量</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">pcap_pkthdr</span> *<span class="title">header</span>;</span>    <span class="comment">//接收到的数据包的头部</span></span><br><span class="line">    <span class="keyword">const</span> u_char *pkt_data;			  <span class="comment">//接收到的数据包的内容</span></span><br><span class="line">	<span class="keyword">int</span> res;                                    <span class="comment">//表示是否接收到了数据包</span></span><br><span class="line">	u_int netmask;                       <span class="comment">//过滤时用的子网掩码</span></span><br><span class="line">	<span class="keyword">char</span> packet_filter[] = <span class="string">"tcp"</span>;        <span class="comment">//过滤字符</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">bpf_program</span> <span class="title">fcode</span>;</span>                     <span class="comment">//pcap_compile所调用的结构体</span></span><br><span class="line"></span><br><span class="line">	u_int ip_len;                                       <span class="comment">//ip地址有效长度</span></span><br><span class="line">	u_short sport,dport;                        <span class="comment">//主机字节序列</span></span><br><span class="line">	u_char packet[<span class="number">100</span>];                       <span class="comment">//发送数据包目的地址</span></span><br><span class="line">	<span class="keyword">pcap_dumper_t</span> *dumpfile;         <span class="comment">//堆文件</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//time_t local_tv_sec;				//和时间处理有关的变量</span></span><br><span class="line">    <span class="comment">//char timestr[16];					//和时间处理有关的变量</span></span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//获取本地适配器列表</span></span><br><span class="line">	<span class="keyword">if</span>(pcap_findalldevs_ex(PCAP_SRC_IF_STRING,<span class="literal">NULL</span>,&amp;alldevs,errbuf) == <span class="number">-1</span>)&#123;</span><br><span class="line">		<span class="comment">//结果为-1代表出现获取适配器列表失败</span></span><br><span class="line">		<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,<span class="string">"Error in pcap_findalldevs_ex:\n"</span>,errbuf);</span><br><span class="line">		<span class="comment">//exit(0)代表正常退出,exit(other)为非正常退出,这个值会传给操作系统</span></span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//打印设备列表信息</span></span><br><span class="line">	<span class="keyword">for</span>(d = alldevs;d !=<span class="literal">NULL</span>;d = d-&gt;next)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"-----------------------------------------------------------------\nnumber:%d\nname:%s\n"</span>,++i,d-&gt;name);</span><br><span class="line">		<span class="keyword">if</span>(d-&gt;description)&#123;</span><br><span class="line">			<span class="comment">//打印适配器的描述信息</span></span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"description:%s\n"</span>,d-&gt;description);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">//适配器不存在描述信息</span></span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"description:%s"</span>,<span class="string">"no description\n"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//打印本地环回地址</span></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"\tLoopback: %s\n"</span>,(d-&gt;flags &amp; PCAP_IF_LOOPBACK)?<span class="string">"yes"</span>:<span class="string">"no"</span>);</span><br><span class="line">		</span><br><span class="line">		 <span class="keyword">pcap_addr_t</span> *a;       <span class="comment">//网络适配器的地址用来存储变量</span></span><br><span class="line">		 <span class="keyword">for</span>(a = d-&gt;addresses;a;a = a-&gt;next)&#123;</span><br><span class="line">			 <span class="comment">//sa_family代表了地址的类型,是IPV4地址类型还是IPV6地址类型</span></span><br><span class="line">			 <span class="keyword">switch</span> (a-&gt;addr-&gt;sa_family)</span><br><span class="line">			 &#123;</span><br><span class="line">				 <span class="keyword">case</span> AF_INET:  <span class="comment">//代表IPV4类型地址</span></span><br><span class="line">					 <span class="built_in">printf</span>(<span class="string">"Address Family Name:AF_INET\n"</span>);</span><br><span class="line">					 <span class="keyword">if</span>(a-&gt;addr)&#123;</span><br><span class="line">						 <span class="comment">//-&gt;的优先级等同于括号,高于强制类型转换,因为addr为sockaddr类型，对其进行操作须转换为sockaddr_in类型</span></span><br><span class="line">						 <span class="built_in">printf</span>(<span class="string">"Address:%s\n"</span>,iptos(((struct sockaddr_in *)a-&gt;addr)-&gt;sin_addr.s_addr));</span><br><span class="line">					 &#125;</span><br><span class="line">					<span class="keyword">if</span> (a-&gt;netmask)&#123;</span><br><span class="line">						 <span class="built_in">printf</span>(<span class="string">"\tNetmask: %s\n"</span>,iptos(((struct sockaddr_in *)a-&gt;netmask)-&gt;sin_addr.s_addr));</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">if</span> (a-&gt;broadaddr)&#123;</span><br><span class="line">						   <span class="built_in">printf</span>(<span class="string">"\tBroadcast Address: %s\n"</span>,iptos(((struct sockaddr_in *)a-&gt;broadaddr)-&gt;sin_addr.s_addr));</span><br><span class="line">					 &#125;</span><br><span class="line">					 <span class="keyword">if</span> (a-&gt;dstaddr)&#123;</span><br><span class="line">						   <span class="built_in">printf</span>(<span class="string">"\tDestination Address: %s\n"</span>,iptos(((struct sockaddr_in *)a-&gt;dstaddr)-&gt;sin_addr.s_addr));</span><br><span class="line">					 &#125;</span><br><span class="line">        			 <span class="keyword">break</span>;</span><br><span class="line">				 <span class="keyword">case</span> AF_INET6: <span class="comment">//代表IPV6类型地址</span></span><br><span class="line">					 <span class="built_in">printf</span>(<span class="string">"Address Family Name:AF_INET6\n"</span>);</span><br><span class="line">					 <span class="built_in">printf</span>(<span class="string">"this is an IPV6 address\n"</span>);</span><br><span class="line">					 <span class="keyword">break</span>;</span><br><span class="line">				 <span class="keyword">default</span>:</span><br><span class="line">					 <span class="keyword">break</span>;</span><br><span class="line">			 &#125;</span><br><span class="line">		 &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//i为0代表上述循环未进入,即没有找到适配器,可能的原因为Winpcap没有安装导致未扫描到</span></span><br><span class="line">	<span class="keyword">if</span>(i == <span class="number">0</span>)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"interface not found,please check winpcap installation"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> num;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"Enter the interface number(1-%d):"</span>,i);</span><br><span class="line">	<span class="comment">//让用户选择选择哪个适配器进行抓包</span></span><br><span class="line">	scanf_s(<span class="string">"%d"</span>,&amp;num);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//用户输入的数字超出合理范围</span></span><br><span class="line">	<span class="keyword">if</span>(num&lt;<span class="number">1</span>||num&gt;i)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"number out of range\n"</span>);</span><br><span class="line">		pcap_freealldevs(alldevs);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//跳转到选中的适配器</span></span><br><span class="line">	<span class="keyword">for</span>(d=alldevs, i=<span class="number">0</span>; i&lt; num<span class="number">-1</span> ; d=d-&gt;next, i++);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//运行到此处说明用户的输入是合法的</span></span><br><span class="line">	<span class="keyword">if</span>((adhandle = pcap_open(d-&gt;name,		<span class="comment">//设备名称</span></span><br><span class="line">														<span class="number">65535</span>,       <span class="comment">//存放数据包的内容长度</span></span><br><span class="line">														PCAP_OPENFLAG_PROMISCUOUS,  <span class="comment">//混杂模式</span></span><br><span class="line">														<span class="number">1000</span>,           <span class="comment">//超时时间</span></span><br><span class="line">														<span class="literal">NULL</span>,          <span class="comment">//远程验证</span></span><br><span class="line">														errbuf         <span class="comment">//错误缓冲</span></span><br><span class="line">														)) == <span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="comment">//打开适配器失败,打印错误并释放适配器列表</span></span><br><span class="line">		<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,<span class="string">"\nUnable to open the adapter. %s is not supported by WinPcap\n"</span>, d-&gt;name);</span><br><span class="line">        <span class="comment">// 释放设备列表 </span></span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="comment">//打印输出,正在监听中</span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\nlistening on %s...\n"</span>, d-&gt;description);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//所在网络不是以太网,此处只取这种情况</span></span><br><span class="line">	<span class="keyword">if</span>(pcap_datalink(adhandle) != DLT_EN10MB)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,<span class="string">"\nThis program works only on Ethernet networks.\n"</span>);</span><br><span class="line">        <span class="comment">//释放列表</span></span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//先获得地址的子网掩码</span></span><br><span class="line">	<span class="keyword">if</span>(d-&gt;addresses != <span class="literal">NULL</span>)</span><br><span class="line">        <span class="comment">//获得接口第一个地址的掩码 </span></span><br><span class="line">        netmask=((struct sockaddr_in *)(d-&gt;addresses-&gt;netmask))-&gt;sin_addr.S_un.S_addr;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="comment">// 如果接口没有地址，那么我们假设一个C类的掩码</span></span><br><span class="line">        netmask=<span class="number">0xffffff</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//pcap_compile()的原理是将高层的布尔过滤表</span></span><br><span class="line">	<span class="comment">//达式编译成能够被过滤引擎所解释的低层的字节码</span></span><br><span class="line">	<span class="keyword">if</span>(pcap_compile(adhandle,	<span class="comment">//适配器处理对象</span></span><br><span class="line">										&amp;fcode,</span><br><span class="line">										packet_filter,   <span class="comment">//过滤ip和UDP</span></span><br><span class="line">										<span class="number">1</span>,                       <span class="comment">//优化标志</span></span><br><span class="line">										netmask           <span class="comment">//子网掩码</span></span><br><span class="line">										)&lt;<span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//过滤出现问题</span></span><br><span class="line">		<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,<span class="string">"\nUnable to compile the packet filter. Check the syntax.\n"</span>);</span><br><span class="line">        <span class="comment">// 释放设备列表</span></span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//设置过滤器</span></span><br><span class="line">    <span class="keyword">if</span> (pcap_setfilter(adhandle, &amp;fcode)&lt;<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,<span class="string">"\nError setting the filter.\n"</span>);</span><br><span class="line">        <span class="comment">//释放设备列表</span></span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//利用pcap_next_ex来接受数据包</span></span><br><span class="line">	<span class="keyword">while</span>((res = pcap_next_ex(adhandle,&amp;header,&amp;pkt_data))&gt;=<span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(res ==<span class="number">0</span>)&#123;</span><br><span class="line">			<span class="comment">//返回值为0代表接受数据包超时，重新循环继续接收</span></span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">//运行到此处代表接受到正常从数据包</span></span><br><span class="line">			<span class="comment">//header为帧的头部</span></span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"%.6ld len:%d "</span>, header-&gt;ts.tv_usec, header-&gt;len);</span><br><span class="line">			<span class="comment">// 获得IP数据包头部的位置</span></span><br><span class="line">			ip = (IpHeader *) (pkt_data +<span class="number">14</span>);    <span class="comment">//14为以太网帧头部长度</span></span><br><span class="line">			<span class="comment">//获得TCP头部的位置</span></span><br><span class="line">			ip_len = (ip-&gt;Version_HLen &amp; <span class="number">0xf</span>) *<span class="number">4</span>;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"ip_length:%d "</span>,ip_len);</span><br><span class="line">			tcp = (TcpHeader *)((u_char *)ip+ip_len);</span><br><span class="line">			<span class="keyword">char</span> * data;</span><br><span class="line">			 data = (<span class="keyword">char</span> *)((u_char *)tcp+<span class="number">20</span>);</span><br><span class="line">			 <span class="comment">//将网络字节序列转换成主机字节序列</span></span><br><span class="line">			sport = ntohs( tcp-&gt;SrcPort );</span><br><span class="line">			dport = ntohs( tcp-&gt;DstPort );</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"srcport:%d desport:%d\n"</span>,sport,dport);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"%d.%d.%d.%d.%d -&gt; %d.%d.%d.%d.%d\n"</span>,</span><br><span class="line">					ip-&gt;SourceAddr.byte1,</span><br><span class="line">					ip-&gt;SourceAddr.byte2,</span><br><span class="line">					ip-&gt;SourceAddr.byte3,</span><br><span class="line">					ip-&gt;SourceAddr.byte4,</span><br><span class="line">				    sport,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte1,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte2,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte3,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte4,</span><br><span class="line">				    dport);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"%s\n"</span>,data);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//释放网络适配器列表</span></span><br><span class="line">	pcap_freealldevs(alldevs);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	int pcap_loop  ( pcap_t *  p,  </span></span><br><span class="line"><span class="comment">								  int  cnt,  </span></span><br><span class="line"><span class="comment">								  pcap_handler  callback,  </span></span><br><span class="line"><span class="comment">								  u_char *  user   </span></span><br><span class="line"><span class="comment">								 );</span></span><br><span class="line"><span class="comment">     typedef void (*pcap_handler)(u_char *, const struct pcap_pkthdr *,</span></span><br><span class="line"><span class="comment">                 const u_char *);</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="comment">//开始捕获信息,当捕获到数据包时,会自动调用这个函数</span></span><br><span class="line">	<span class="comment">//pcap_loop(adhandle,0,packet_handler,NULL);</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> inum;</span><br><span class="line">	scanf_s(<span class="string">"%d"</span>, &amp;inum);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 每次捕获到数据包时，libpcap都会自动调用这个回调函数 */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">pcap_loop()函数是基于回调的原理来进行数据捕获的，如技术文档所说，这是一种精妙的方法，并且在某些场合下，</span></span><br><span class="line"><span class="comment">它是一种很好的选择。但是在处理回调有时候会并不实用，它会增加程序的复杂度，特别是在多线程的C++程序中</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">void packet_handler(u_char *param, const struct pcap_pkthdr *header, const u_char *pkt_data)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    struct tm *ltime = NULL;</span></span><br><span class="line"><span class="comment">    char timestr[16];</span></span><br><span class="line"><span class="comment">    time_t local_tv_sec;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    // 将时间戳转换成可识别的格式</span></span><br><span class="line"><span class="comment">    local_tv_sec = header-&gt;ts.tv_sec;</span></span><br><span class="line"><span class="comment">    localtime_s(ltime,&amp;local_tv_sec);</span></span><br><span class="line"><span class="comment">    strftime( timestr, sizeof timestr, "%H:%M:%S", ltime);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    printf("%s,%.6ld len:%d\n", timestr, header-&gt;ts.tv_usec, header-&gt;len);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">/* 将数字类型的IP地址转换成字符串类型的 */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IPTOSBUFFERS    12</span></span><br><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">iptos</span><span class="params">(u_long in)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">char</span> output[IPTOSBUFFERS][<span class="number">3</span>*<span class="number">4</span>+<span class="number">3</span>+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">static</span> short which;</span><br><span class="line">    u_char *p;</span><br><span class="line"></span><br><span class="line">    p = (u_char *)&amp;in;</span><br><span class="line">    which = (which + <span class="number">1</span> == IPTOSBUFFERS ? <span class="number">0</span> : which + <span class="number">1</span>);</span><br><span class="line">    sprintf_s(output[which], <span class="string">"%d.%d.%d.%d"</span>, p[<span class="number">0</span>], p[<span class="number">1</span>], p[<span class="number">2</span>], p[<span class="number">3</span>]);</span><br><span class="line">    <span class="keyword">return</span> output[which];</span><br><span class="line">&#125;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p> 运行截图如下 <img src="http://img.blog.csdn.net/20141018212813479?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> <img src="http://img.blog.csdn.net/20141018212943896?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> Thank You 如有问题，欢迎留言~</p>
      </p>
    </div>
  </div>
  <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-user"></i>
      </span>
      <span class="post-meta-item-text">作者</span>
      <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      <time title="创建时间：2015-07-13 01:14:21" itemprop="dateCreated datePublished" datetime="2015-07-13T01:14:21+08:00">2015-07-13</time>
    </span>
    <span id="/1918.html" class="post-meta-item leancloud_visitors" data-flag-title="Winpcap网络编程五之ARP协议获得MAC表及主机通信" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>28k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>26 分钟</span>
    </span>
  </div>
</article>

    <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1913.html">
  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.png">
    <meta itemprop="name" content="崔庆才">
    <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  </span>
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="静觅">
  </span>
  <header class="post-header">
    <h2 class="post-title" itemprop="name headline">
      <a class="label"> C/C++ <i class="label-arrow"></i>
      </a>
      <a href="/1913.html" class="post-title-link" itemprop="url">Winpcap网络编程四之环境配置，VS配置Winpcap环境</a>
    </h2>
  </header>
  <div class="post-body" itemprop="articleBody">
    <div class="thumb">
      <img itemprop="contentUrl" class="random">
    </div>
    <div class="excerpt">
      <p>
      <p>上一篇我们介绍了Eclipse配置Winpcap环境。但是美中不足的是Eclipse编写Winpcap会出现各种各样神奇的错误… 本文原文地址： <a href="http://blog.csdn.net/cqcre/article/details/40429517" target="_blank" rel="noopener">我的CSDN博客</a> 其实也不是不能用，就是总是报一些函数不能识别的错误，每次不能识别的函数就是因为缺少了各种各样的头文件或者宏定义…让我比较纠结，心中不由得萌生了一个想法，换个环境试试吧，于是VS环境配置就这么神奇的产生了…. 好，接下来我以VS2012为例为大家讲解Winpcap环境配置，其实VS2010，VS2013等等的版本都是通用哒.. 首先你要有一个VS…这不是废话么… 首先，按照 <a href="http://cuiqingcai.com/1906.html">Eclipse配置Winpcap环境</a> 配置好Winpcap和下载好相关的SDK，这里就不再赘述了 好，文件-新建-项目-Win32控制台应用程序，可以修改下面的路径和项目名称，然后确定 <img src="http://img.blog.csdn.net/20141024163401921?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 接下来就会蹦出一个窗口..点击下一步 <img src="http://img.blog.csdn.net/20141024163542249?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 下一步，勾选空项目，然后点击确定，空项目一定要勾选，不然会生成一些不必要的文件。 <img src="http://img.blog.csdn.net/20141024163702870?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 点击完成，现在看到的界面如下： <img src="http://img.blog.csdn.net/20141024163856875?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 在项目名上右键单击，选择属性 链接器选项卡—输入—附加依赖项中在前面输入ws2_32.lib;wpcap.lib; 两个类库，截图如下 <img src="http://img.blog.csdn.net/20141024164256328?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> C/C++选项卡—-预处理器—-预处理器定义键入HAVE_REMOTE;WPCAP; 如图所示 <img src="http://img.blog.csdn.net/20141024164409203?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> VC++目录，加入你的Winpcap类库路径，文件夹应该叫WpdPack，一个是Include,一个是lib,这是绝对路径，你的可能与我的不一样，截图如下 <img src="http://img.blog.csdn.net/20141024164629073?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 好了。点击确定，环境就配好啦。 接下来新建一个cpp文件，运行程序就OK了… <img src="http://img.blog.csdn.net/20141024164828671?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 如有问题，欢迎留言交流</p>
      </p>
    </div>
  </div>
  <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-user"></i>
      </span>
      <span class="post-meta-item-text">作者</span>
      <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      <time title="创建时间：2015-07-13 01:02:24" itemprop="dateCreated datePublished" datetime="2015-07-13T01:02:24+08:00">2015-07-13</time>
    </span>
    <span id="/1913.html" class="post-meta-item leancloud_visitors" data-flag-title="Winpcap网络编程四之环境配置，VS配置Winpcap环境" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>662</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
  </div>
</article>

    <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1906.html">
  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.png">
    <meta itemprop="name" content="崔庆才">
    <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  </span>
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="静觅">
  </span>
  <header class="post-header">
    <h2 class="post-title" itemprop="name headline">
      <a class="label"> C/C++ <i class="label-arrow"></i>
      </a>
      <a href="/1906.html" class="post-title-link" itemprop="url">Winpcap网络编程三之环境配置，Eclipse配置Winpcap环境</a>
    </h2>
  </header>
  <div class="post-body" itemprop="articleBody">
    <div class="thumb">
      <img itemprop="contentUrl" class="random">
    </div>
    <div class="excerpt">
      <p>
      <p>大家好，本节为大家带来在Eclipse下配置Winpcap环境，欢迎大家收看。 本文原文地址来自： <a href="http://blog.csdn.net/cqcre/article/details/39754917" target="_blank" rel="noopener">我的CSDN博客</a> 首先，配置Winpcap环境的前提是你必须配置好了Eclipse下的C/C++环境。如果你还没有配置，欢迎大家收看上节内容进行配置。 链接地址： <a href="http://blog.csdn.net/cqcre/article/details/39754251" target="_blank" rel="noopener">Eclipse配置C/C++环境</a> 若链接失效，请自行查看上一篇文章或者百度其他文章。 废话不多说啦，开始我们的Winpcap的配置。</p>
      <h2 id="Winpcap下载"><a href="#Winpcap下载" class="headerlink" title="Winpcap下载"></a>Winpcap下载</h2>
      <p>Winpcap官网： <a href="http://www.winpcap.org/" target="_blank" rel="noopener">Winpcap官网</a> Winpcap目前最新版为4.1.3,首先你要下载exe文件并安装，直接双击运行安装即可。 下载地址： <a href="http://www.winpcap.org/install/default.htm" target="_blank" rel="noopener">Winpcap4.1.3.exe</a> 然后你需要下载开发包，首先必须注意的是，目前最新版本是没有开发包的，最新的开发包为4.1.2，先见下图 <img src="http://img.blog.csdn.net/20141003120936027?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 下面的红色框说明了目前没有提供Winpcap4.1.3的开发包，最新版本的开发包是4.1.2，他可以与4.1.3的Winpcap配套使用。 所以下载4.1.2的开发包。 下载地址： <a href="http://www.winpcap.org/devel.htm" target="_blank" rel="noopener">Winpcap Developer’s Pack 4.1.2</a></p>
      <h2 id="Eclipse相关配置"><a href="#Eclipse相关配置" class="headerlink" title="Eclipse相关配置"></a>Eclipse相关配置</h2>
      <p>首先新建一个C 的项目，具体的建立过程可以参见上一节的内容。 我们加入一个测试代码如下：</p>
      <figure class="highlight cpp">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> WIN32</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HAVE_REMOTE</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"pcap.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Win32-Extensions.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gen_packet</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> *buf,<span class="keyword">int</span> len)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*生成数据包*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gen_packet</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> *buf,<span class="keyword">int</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">		<span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//设置目标MAC地址为01:01:01:01:01:01</span></span><br><span class="line">		<span class="keyword">for</span> (i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)</span><br><span class="line">		&#123;</span><br><span class="line">			buf[i]=<span class="number">0x01</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//设置源MAC地址为02:02:02:02:02:02</span></span><br><span class="line">		<span class="keyword">for</span> (i=<span class="number">6</span>;i&lt;<span class="number">12</span>;i++)</span><br><span class="line">		&#123;</span><br><span class="line">			buf[i]=<span class="number">0x02</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//设置协议标识为0xc0xd，无任何实际意义</span></span><br><span class="line">		buf[<span class="number">12</span>]=<span class="number">0xc</span>;</span><br><span class="line">		buf[<span class="number">13</span>]=<span class="number">0xd</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//填充数据包的内容</span></span><br><span class="line">		<span class="keyword">for</span>(i=<span class="number">14</span>;i&lt;len;i++)</span><br><span class="line">		&#123;</span><br><span class="line">			buf[i]=i<span class="number">-14</span>;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">pcap_if_t</span> *alldevs;</span><br><span class="line">	<span class="keyword">pcap_if_t</span> *d;</span><br><span class="line">	<span class="keyword">int</span> inum;</span><br><span class="line">	<span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">pcap_t</span> *adhandle;</span><br><span class="line">	<span class="keyword">char</span> errbuf[PCAP_ERRBUF_SIZE];</span><br><span class="line">	<span class="keyword">int</span> ret=<span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 获取本机网络设备列表 */</span></span><br><span class="line">    <span class="keyword">if</span> (pcap_findalldevs_ex(PCAP_SRC_IF_STRING, <span class="literal">NULL</span>, &amp;alldevs, errbuf) == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,<span class="string">"Error in pcap_findalldevs: %s\n"</span>, errbuf);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 打印网络设备列表 */</span></span><br><span class="line">    <span class="keyword">for</span>(d=alldevs; d; d=d-&gt;next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d. %s"</span>, ++i, d-&gt;name);</span><br><span class="line">        <span class="keyword">if</span> (d-&gt;description)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">" (%s)\n"</span>, d-&gt;description);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">" (No description available)\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(i==<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\nNo interfaces found! Make sure WinPcap is installed.\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*选择网络设备接口*/</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Enter the interface number (1-%d):"</span>,i);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;inum);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(inum &lt; <span class="number">1</span> || inum &gt; i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\nInterface number out of range.\n"</span>);</span><br><span class="line">        <span class="comment">/* 释放设备列表 */</span></span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 跳转到选中的适配器 */</span></span><br><span class="line">    <span class="keyword">for</span>(d=alldevs, i=<span class="number">0</span>; i&lt; inum<span class="number">-1</span> ;d=d-&gt;next, i++);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 打开设备 */</span></span><br><span class="line">    <span class="keyword">if</span> ( (adhandle= pcap_open(d-&gt;name,          <span class="comment">// 设备名</span></span><br><span class="line">							  <span class="number">65536</span>,            <span class="comment">// 65535保证能捕获到数据链路层上每个数据包的全部内容</span></span><br><span class="line">							  PCAP_OPENFLAG_PROMISCUOUS,    <span class="comment">// 混杂模式</span></span><br><span class="line">                              <span class="number">1000</span>,             <span class="comment">// 读取超时时间</span></span><br><span class="line">                              <span class="literal">NULL</span>,             <span class="comment">// 远程机器验证</span></span><br><span class="line">                              errbuf            <span class="comment">// 错误缓冲池</span></span><br><span class="line">                              ) ) == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,<span class="string">"\nUnable to open the adapter. %s is not supported by WinPcap\n"</span>, d-&gt;name);</span><br><span class="line">        <span class="comment">/* 释放设备列表 */</span></span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*在选中的设备接口上发送数据*/</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\nsending on %s...\n"</span>, d-&gt;description);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 发送数据包*/</span></span><br><span class="line">	<span class="comment">//生成数据报</span></span><br><span class="line">	<span class="keyword">int</span> packetlen=<span class="number">100</span>;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> *buf= (<span class="keyword">unsigned</span> <span class="keyword">char</span> *)<span class="built_in">malloc</span>(packetlen);</span><br><span class="line">	<span class="built_in">memset</span>(buf,<span class="number">0x0</span>,packetlen);</span><br><span class="line">	gen_packet(buf,packetlen); <span class="comment">//获得生成的数据包，长度为packetlen</span></span><br><span class="line">	<span class="comment">//开始数据包发送</span></span><br><span class="line">	<span class="keyword">if</span> ( (ret=pcap_sendpacket(adhandle,buf,packetlen))==<span class="number">-1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"发送失败\n"</span>);</span><br><span class="line">		<span class="built_in">free</span>(buf);</span><br><span class="line">		pcap_close(adhandle);</span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	 <span class="comment">/*释放资源*/</span></span><br><span class="line">	 <span class="built_in">free</span>(buf);</span><br><span class="line">	 pcap_close(adhandle);</span><br><span class="line">	 pcap_freealldevs(alldevs);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>把代码拷贝到你的项目程序里面，可以发现现在是编译错误，有些对象根本无法识别，截图如下： <img src="http://img.blog.csdn.net/20141003121756538?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 接下来就需要我们对类库进行配置啦。 首先解压你下载的开发包，随便放硬盘的某个位置，我放在了D盘的eclipse_plugins文件夹中，当然你可以随便放哪里都行。 <img src="http://img.blog.csdn.net/20141003122134034?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 接下来配置Eclipse，右键项目-&gt;属性-&gt;C/C++常规-&gt;项目和符号。 <img src="http://img.blog.csdn.net/20141003122332235?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 首先添加你的include库，在包含这个选项卡中添加你的库，点击添加-&gt;选择文件系统-&gt;选择你刚才的开发库的include文件夹，按照图中的顺序来 <img src="http://img.blog.csdn.net/20141003122614796?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> <img src="http://img.blog.csdn.net/20141003122856279?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 点击确定添加，同理在库路径选项卡中进行库路径的配置，这次添加的是lib文件夹。按照图片中的顺序来做 <img src="http://img.blog.csdn.net/20141003123234570?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> <img src="http://img.blog.csdn.net/20141003123311433?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 点击确定添加。 然后在库的选项卡中添加wpcap和Packet两个库，注意这次不能选择文件系统了，因为你指定了库路径之后它会自动搜索路径中库的名字，这次你只需要指定库的名字就好了。我之前添加的是文件系统，然后它总是提示找不到这个库，所以一定要直接填写这两个库的名字。如图所示： <img src="http://img.blog.csdn.net/20141003123715375?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 添加完毕之后，出现这个样子： <img src="http://img.blog.csdn.net/20141003123823109?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 好啦，点击确定，全部配置已经完毕啦。 重新构建项目，运行即可。 注意，构建过程可能出现如下问题：</p>
      <ul>
        <li>error C2065: “PCAP_SRC_IF_STRING”: 未声明的标识符</li>
        <li>error C3861: “pcap_findalldevs_ex”: 找不到标识符</li>
        <li>error C2065: “PCAP_OPENFLAG_PROMISCUOUS”: 未声明的标识符</li>
        <li>error C3861: “pcap_open”: 找不到标识符</li>
      </ul>
      <p>因为新的版本里WinPcap支持远程数据包获取，所以还应当添加一个头文件remote-ext.h ，即#include “remote-ext.h”（记住这条语句要放在#include “pcap.h”之后，否则会出错！） <img src="http://img.blog.csdn.net/20141003124531280?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 好了，一切问题都解决了，运行成功啦！ 运行结果如下： <img src="http://img.blog.csdn.net/20141003124547093?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 再附测试代码一例：</p>
      <figure class="highlight cpp">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> WIN32</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HAVE_REMOTE</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"pcap.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Win32-Extensions.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gen_packet</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> *buf,<span class="keyword">int</span> len)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*生成数据包*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gen_packet</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> *buf,<span class="keyword">int</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">		<span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//设置目标MAC地址为01:01:01:01:01:01</span></span><br><span class="line">		<span class="keyword">for</span> (i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)</span><br><span class="line">		&#123;</span><br><span class="line">			buf[i]=<span class="number">0x01</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//设置源MAC地址为02:02:02:02:02:02</span></span><br><span class="line">		<span class="keyword">for</span> (i=<span class="number">6</span>;i&lt;<span class="number">12</span>;i++)</span><br><span class="line">		&#123;</span><br><span class="line">			buf[i]=<span class="number">0x02</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//设置协议标识为0xc0xd，无任何实际意义</span></span><br><span class="line">		buf[<span class="number">12</span>]=<span class="number">0xc</span>;</span><br><span class="line">		buf[<span class="number">13</span>]=<span class="number">0xd</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//填充数据包的内容</span></span><br><span class="line">		<span class="keyword">for</span>(i=<span class="number">14</span>;i&lt;len;i++)</span><br><span class="line">		&#123;</span><br><span class="line">			buf[i]=i<span class="number">-14</span>;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">pcap_if_t</span> *alldevs;</span><br><span class="line">	<span class="keyword">pcap_if_t</span> *d;</span><br><span class="line">	<span class="keyword">int</span> inum;</span><br><span class="line">	<span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">pcap_t</span> *adhandle;</span><br><span class="line">	<span class="keyword">char</span> errbuf[PCAP_ERRBUF_SIZE];</span><br><span class="line">	<span class="keyword">int</span> ret=<span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 获取本机网络设备列表 */</span></span><br><span class="line">    <span class="keyword">if</span> (pcap_findalldevs_ex(PCAP_SRC_IF_STRING, <span class="literal">NULL</span>, &amp;alldevs, errbuf) == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,<span class="string">"Error in pcap_findalldevs: %s\n"</span>, errbuf);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 打印网络设备列表 */</span></span><br><span class="line">    <span class="keyword">for</span>(d=alldevs; d; d=d-&gt;next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d. %s"</span>, ++i, d-&gt;name);</span><br><span class="line">        <span class="keyword">if</span> (d-&gt;description)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">" (%s)\n"</span>, d-&gt;description);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">" (No description available)\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(i==<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\nNo interfaces found! Make sure WinPcap is installed.\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*选择网络设备接口*/</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Enter the interface number (1-%d):"</span>,i);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;inum);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(inum &lt; <span class="number">1</span> || inum &gt; i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\nInterface number out of range.\n"</span>);</span><br><span class="line">        <span class="comment">/* 释放设备列表 */</span></span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 跳转到选中的适配器 */</span></span><br><span class="line">    <span class="keyword">for</span>(d=alldevs, i=<span class="number">0</span>; i&lt; inum<span class="number">-1</span> ;d=d-&gt;next, i++);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 打开设备 */</span></span><br><span class="line">    <span class="keyword">if</span> ( (adhandle= pcap_open(d-&gt;name,          <span class="comment">// 设备名</span></span><br><span class="line">							  <span class="number">65536</span>,            <span class="comment">// 65535保证能捕获到数据链路层上每个数据包的全部内容</span></span><br><span class="line">							  PCAP_OPENFLAG_PROMISCUOUS,    <span class="comment">// 混杂模式</span></span><br><span class="line">                              <span class="number">1000</span>,             <span class="comment">// 读取超时时间</span></span><br><span class="line">                              <span class="literal">NULL</span>,             <span class="comment">// 远程机器验证</span></span><br><span class="line">                              errbuf            <span class="comment">// 错误缓冲池</span></span><br><span class="line">                              ) ) == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,<span class="string">"\nUnable to open the adapter. %s is not supported by WinPcap\n"</span>, d-&gt;name);</span><br><span class="line">        <span class="comment">/* 释放设备列表 */</span></span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*在选中的设备接口上发送数据*/</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\nsending on %s...\n"</span>, d-&gt;description);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 发送数据包*/</span></span><br><span class="line">	<span class="comment">//生成数据报</span></span><br><span class="line">	<span class="keyword">int</span> packetlen=<span class="number">100</span>;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> *buf= (<span class="keyword">unsigned</span> <span class="keyword">char</span> *)<span class="built_in">malloc</span>(packetlen);</span><br><span class="line">	<span class="built_in">memset</span>(buf,<span class="number">0x0</span>,packetlen);</span><br><span class="line">	gen_packet(buf,packetlen); <span class="comment">//获得生成的数据包，长度为packetlen</span></span><br><span class="line">	<span class="comment">//开始数据包发送</span></span><br><span class="line">	<span class="keyword">if</span> ( (ret=pcap_sendpacket(adhandle,buf,packetlen))==<span class="number">-1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"发送失败\n"</span>);</span><br><span class="line">		<span class="built_in">free</span>(buf);</span><br><span class="line">		pcap_close(adhandle);</span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	 <span class="comment">/*释放资源*/</span></span><br><span class="line">	 <span class="built_in">free</span>(buf);</span><br><span class="line">	 pcap_close(adhandle);</span><br><span class="line">	 pcap_freealldevs(alldevs);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>运行结果：</p>
      <figure class="highlight maxima">
        <table>
          <tr>
            <td class="gutter">
              <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
            </td>
            <td class="code">
              <pre><span class="line"><span class="number">1</span>. rpcap://\Device\NPF_&#123;5AC72F8D-<span class="number">019C</span>-<span class="number">4003</span>-B51B-7ABB67AF392A&#125; (Network adapter 'Microsoft' on <span class="built_in">local</span> host)</span><br><span class="line"><span class="number">2</span>. rpcap://\Device\NPF_&#123;33E23A2F-F791-<span class="number">409B-8452</span>-A3FB5A78B73E&#125; (Network adapter 'Qualcomm Atheros Ar81xx series PCI-E Ethernet Controller' on <span class="built_in">local</span> host)</span><br><span class="line"><span class="number">3</span>. rpcap://\Device\NPF_&#123;DCCF036F-A9A8-<span class="number">4225</span>-B980-D3A3F0575F5B&#125; (Network adapter 'Microsoft' on <span class="built_in">local</span> host)</span><br><span class="line"><span class="number">4</span>. rpcap://\Device\NPF_&#123;D62A0060-F424-46FC-83A5-3394081685FD&#125; (Network adapter 'Microsoft' on <span class="built_in">local</span> host)</span><br><span class="line"><span class="number">5</span>. rpcap://\Device\NPF_&#123;B5224A53-<span class="number">8450</span>-<span class="number">4537</span>-AB3B-9869158121CD&#125; (Network adapter 'Microsoft' on <span class="built_in">local</span> host)</span><br></pre>
            </td>
          </tr>
        </table>
      </figure>
      <p>那么环境配好了，我们接下来就要进行计算机网络编程学习阶段了，后期的文章将会记录我计算机网络编程学习的一些内容，欢迎大家收看。</p>
      </p>
    </div>
  </div>
  <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-user"></i>
      </span>
      <span class="post-meta-item-text">作者</span>
      <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      <time title="创建时间：2015-07-13 00:54:24" itemprop="dateCreated datePublished" datetime="2015-07-13T00:54:24+08:00">2015-07-13</time>
    </span>
    <span id="/1906.html" class="post-meta-item leancloud_visitors" data-flag-title="Winpcap网络编程三之环境配置，Eclipse配置Winpcap环境" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>6.5k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>6 分钟</span>
    </span>
  </div>
</article>

    <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1898.html">
  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.png">
    <meta itemprop="name" content="崔庆才">
    <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  </span>
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="静觅">
  </span>
  <header class="post-header">
    <h2 class="post-title" itemprop="name headline">
      <a class="label"> C/C++ <i class="label-arrow"></i>
      </a>
      <a href="/1898.html" class="post-title-link" itemprop="url">Winpcap网络编程二之环境配置，Eclipse配置C/C++环境</a>
    </h2>
  </header>
  <div class="post-body" itemprop="articleBody">
    <div class="thumb">
      <img itemprop="contentUrl" class="random">
    </div>
    <div class="excerpt">
      <p>
      <p>本次为大家带来的是用Eclipse配置C/C++环境的具体步骤，希望对大家有帮助哦。 <strong>声明：如果你希望用Eclipse开发，可以参考本文章配置环境，如若想用VS开发，请看后面的文章。</strong> 本文原文地址来自 <a href="http://blog.csdn.net/cqcre/article/details/39754251" target="_blank" rel="noopener">我的CSDN博客</a> Eclipse 配置C/C++开发环境讲解</p>
      <h2 id="JDK"><a href="#JDK" class="headerlink" title="JDK"></a>JDK</h2>
      <p>如果没有安装JDK环境的小伙伴请自行去官网下载安装啦，安装之后的就可以跳过此步. 下载地址： <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank" rel="noopener">JDK下载</a><a href="http://jingyan.baidu.com/article/6dad5075d1dc40a123e36ea3.html" target="_blank" rel="noopener">JDK环境配置</a></p>
      <h2 id="Eclipse"><a href="#Eclipse" class="headerlink" title="Eclipse"></a>Eclipse</h2>
      <p>当然，下载JDK的目的是在Eclipse下先运行起Java程序，这样才能方便我们下一步的操作，没有Eclipse的也去下载。 下载地址： <a href="http://www.eclipse.org/downloads/download.php?file=/eclipse/downloads/drops/R-3.7-201106131736/eclipse-SDK-3.7-win32.zip" target="_blank" rel="noopener">Eclipse下载</a> 上面两步我想难度都很小，而且大部分同学已经配置了，我就不一一讲解了。</p>
      <h2 id="CDT"><a href="#CDT" class="headerlink" title="CDT"></a>CDT</h2>
      <p>CDT是什么？它就是Eclipse的一个插件，我们需要安装了之后才可以新建C/C++项目。 注意：下载的CDT必须和Eclipse的版本对应。 下载地址： <a href="http://www.eclipse.org/cdt/" target="_blank" rel="noopener">CDT下载</a> 上面下载的Eclipse是3.7版本，在此给出适配CDT 8.0的下载链接。 下载地址： <a href="http://www.eclipse.org/downloads/download.php?file=/tools/cdt/releases/indigo/dist/cdt-master-8.0.0.zip&amp;url=http://mirrors.ustc.edu.cn/eclipse/tools/cdt/releases/indigo/dist/cdt-master-8.0.0.zip&amp;mirror_id=1093" target="_blank" rel="noopener">CDT 8.0下载</a> 如果上述链接已失效，请自行百度适配你Eclipse版本的CDT进行下载。 下载之后它是一个压缩包zip格式。 不要解压直接安装即可，安装讲解如下： 打开Eclipse，进入菜单Help，选择Install New Software…，点击右边Add按钮，在Add Repository对话框中点击右下角的Archive…，浏览到你之前下载保存路径，选中cdt-master-8.0.0.zip并双击，勾选所有CDT部件，然后点击Next&gt;，继续Next&gt;，选中“I accept the terms of the license agreement – Finish”，点击Finish开始安装CDT。 <img src="http://img.blog.csdn.net/20141003110738384?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 安装完CDT后重启Eclipse。 <img src="http://img.blog.csdn.net/20141003110647109?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 这样我们的Eclipse的CDT插件就安装好啦，这时你会发现可以新建C/C++项目了，但是还是不能编译运行，为什么？因为没有安装编译器。接下来我们需要下载mingw编译器。</p>
      <h2 id="MinGW"><a href="#MinGW" class="headerlink" title="MinGW"></a>MinGW</h2>
      <p>这是一个配套Eclipse的C/C++编译器，首先我们下载下来。 官网下载地址： <a href="http://sourceforge.net/projects/mingw/files/MinGW/" target="_blank" rel="noopener">mingw官网下载</a> 现在发现最新版本下载是： <a href="http://sourceforge.net/projects/mingw/files/latest/download?source=files" target="_blank" rel="noopener">mingw-get-setup.exe</a> 双击运行，选择安装路径，我的路径为：D:\mingw，安装完成之后你会发现出现一个下载库的窗口，叫Mingw Installation Manager 注意： 1. 我的类库已经安装完毕，所以每个类库前面都显示为绿色的方框，没安装之前是白色的，你需要都勾选上，然后下载安装。在每个类库上邮件单击选择make for installation即可勾选。再点击菜单中的Installation中的Update Catalogue即可安装你所勾选的类库了。 2. 安装下载可能花费不少时间，请耐心等待。 <img src="http://img.blog.csdn.net/20141003111834646?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 大家可以发现最左边有Basic Steup和All Packages两个分类。 第一个Basic Steup即为必须要安装的编译类库，All Packages即为所有的类库。为了保险起见，我把所有的类库都安装了。全部安装完之后即会显示绿色。 安装完之后的目录结构如下： <img src="http://img.blog.csdn.net/20141003112632413?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
      <h2 id="环境变量配置"><a href="#环境变量配置" class="headerlink" title="环境变量配置"></a>环境变量配置</h2>
      <p>环境变量配置： 计算机– 属性 – 高级系统设置 – 环境变量 在上方的用户变量中进行如下操作： 注意：mingw的位置不同，环境变量的配置不同，可以看最底层目录比对着来配置。我的环境变量配置如下：</p>
      <blockquote>
        <p>（1）编辑PATH变量，在最后面加入 D:\mingw\bin D:\mingw\msys\1.0\bin D:\mingw\mingw32\bin （2）添加LIBRARY_PATH变量，内容为： D:\mingw\lib （3）添加C_INCLUDE_PATH变量，内容为： D:\mingw\include （4）添加CPLUS_INCLUDE_PATH变量，内容为： D:\mingw\lib\gcc\mingw32\4.8.1\include\c++</p>
      </blockquote>
      <p>修改：</p>
      <blockquote>
        <p>进入D:\mingw\bin下将mingw32-make.exe复制成make.exe。因为Eclipse使用时预设是用系统里的”make”这个文件名，而不是”mingw32-make”。</p>
      </blockquote>
      <p>Eclipse中的配置： 窗口 -&gt; 首选项 -&gt; C/C++ -&gt; New CDT Project Wizard 在右边的首选工具链的右边，工具链栏目内选择MinGW GCC，确定，如图所示： <img src="http://img.blog.csdn.net/20141003113658894?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 还是在原来的 New CDT Project Wizard选项卡中，展开，Makefile项目，二进制解析器，勾选PE windows解析器，确定，如图所示。 <img src="http://img.blog.csdn.net/20141003113807484?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 好啦，配置工作完成，我们来测试一下新C语言项目。</p>
      <h2 id="测试项目"><a href="#测试项目" class="headerlink" title="测试项目"></a>测试项目</h2>
      <p>右键新建-&gt;项目-&gt;C项目 <img src="http://img.blog.csdn.net/20141003114106872?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 下一步，选择可执行文件，Hello World ANCI C Project 编译器选择 MinGw GCC 完成，如图所示： <img src="http://img.blog.csdn.net/20141003114126625?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 完成之后的界面应该是如下所示，点击构建项目，图中的红色圆圈，构建完成之后，右键运行程序 <img src="http://img.blog.csdn.net/20141003114748589?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> <img src="http://img.blog.csdn.net/20141003114637750?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 运行结果： <img src="http://img.blog.csdn.net/20141003115048145?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 欢呼吧小伙伴们 ! Eclipse 配置C/C++环境到此完全结束，如果有问题欢迎交流。</p>
      </p>
    </div>
  </div>
  <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-user"></i>
      </span>
      <span class="post-meta-item-text">作者</span>
      <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      <time title="创建时间：2015-07-13 00:45:39" itemprop="dateCreated datePublished" datetime="2015-07-13T00:45:39+08:00">2015-07-13</time>
    </span>
    <span id="/1898.html" class="post-meta-item leancloud_visitors" data-flag-title="Winpcap网络编程二之环境配置，Eclipse配置C/C++环境" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
  </div>
</article>

    <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1890.html">
  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.png">
    <meta itemprop="name" content="崔庆才">
    <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  </span>
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="静觅">
  </span>
  <header class="post-header">
    <h2 class="post-title" itemprop="name headline">
      <a class="label"> C/C++ <i class="label-arrow"></i>
      </a>
      <a href="/1890.html" class="post-title-link" itemprop="url">Winpcap网络编程一之前言，实验要求，实验目标</a>
    </h2>
  </header>
  <div class="post-body" itemprop="articleBody">
    <div class="thumb">
      <img itemprop="contentUrl" class="random">
    </div>
    <div class="excerpt">
      <p>
      <p>Hi，大家好，现在计算机网络课程设计开始啦，本次为大家带来计算机网络实验的系列讲解，希望对于小伙伴们的计网课设有一定帮助哦。</p>
      <h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2>
      <p>首先，博主来自山东大学，这次计网课程设计的实验学校为山东大学，年级为2012级，请对号入座。 另外，对于上学期学的计算机网络课程知识，可以说我就是为了应付考试最后狂背下来的，感觉对于计算机网络里的一些原理真的没有理解。纯粹看一些概念性的东西真的是太抽象啦，这次计网课设的目的就是让我们用编程实现网络分析技术和网络功能仿真，来深入了解计算机网络知识。可以说这些才是学习计算机网络最重要的一环，大家加油。</p>
      <h2 id="实验要求"><a href="#实验要求" class="headerlink" title="实验要求"></a>实验要求</h2>
      <p>1、基本任务（达标任务） 完成两台主机之间的数据通信（数据链路层）</p>
      <ul>
        <li>仿真ARP协议获得网段内主机的MAC表</li>
        <li>使用帧完成两台主机的通信（Hello! I’m …)</li>
      </ul>
      <p>2、高端任务（优秀任务） 完成两台主机通过中间主机的数据通信（网络层）</p>
      <ul>
        <li>增加基于IP地址的转发功能</li>
        <li>增加网络层封装</li>
      </ul>
      <p>本次任务呢分为基本任务和高端任务，当然我们的目标当然不仅限于基本任务咯。</p>
      <h2 id="实验概述"><a href="#实验概述" class="headerlink" title="实验概述"></a>实验概述</h2>
      <p>一句话，我们需要利用winpcap这个库用C语言编程来实现以上的任务。</p>
      <h2 id="winpcap讲解"><a href="#winpcap讲解" class="headerlink" title="winpcap讲解"></a>winpcap讲解</h2>
      <p>那么winpcap是什么？ 大多数网络应用程序通过被广泛使用的操作系统原件来访问网络，如socket。由于操作系统已经处理了底层的细节问题（如协议的处理、数据包的封装等），并提供了与读写文件类似的函数接口，因此使用该方法可以很容易的访问网络中的数据 然而有些时候，这种简单的方式并不能满足任务要求，有些应用程序需要直接访问网络中的数据包，也就是说，需要访问哪些没有被操作系统处理过的数据包 WinPcap就是为Windows平台的应用程序提供这种访问方式，提供下列功能：</p>
      <ul>
        <li>捕获原始数据包。无论是发送到运行WinPcap的机器上的数据包，还是在其它主机（存在网络共享介质上的主机）上进行交换的数据包，都可以被捕获</li>
        <li>在数据包传递给应用程序之前，根据用户指定的规则过滤数据包</li>
        <li>将原始数据包发送到网络上</li>
        <li>收集网络流量与网络状态的统计信息</li>
      </ul>
      <p>它提供给我们什么呢？</p>
      <p>它包含一个内核空间数据包过滤器（Netgroup Packet Filter, NPF)，一个底层动态链接库（Packet.dll)和一个高层独立于操作系统的动态链接库(wpcap.dll)。各部分关系见下图</p>
      <p><img src="http://img.blog.csdn.net/20141003103218640?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> NPF：为了能够访问网络上传输的原始数据，数据包捕获系统需要绕过操作系统的协议栈。这就需要有一部分程序运行在操作系统的内核中，只有这样才能与网络接口驱动直接交互。在WinPcap中，与操作系统密切相关的是一个名为NPF的设备驱动程序，同时对不同版本的操作系统提供了不同版本的驱动程序。这些驱动程序提供了数据包捕获与发送的基本功能，同时提供了一个可编程的数据包过滤系统、一个网络监视引擎等高级功能。 动态链接库：为了让应用程序能够使用内核驱动提供的功能，数据包捕获系统必须导出相关的接口。对此，WinPcap提供两个不同层次的动态链接库：Packet.dll和wpcap.dll。 Packet.dll提供底层的API，用来直接访问驱动程序的函数，用来提供独立于微软公司不同操作系统的编程接口。 wpcap.dll库导出了更强大、更高层的捕获函数接口，具有与UNIX捕获库libpcap的兼容性。这两个库可使数据包的捕获独立于底层的网络硬件与操作系统。</p>
      <h2 id="实验流程"><a href="#实验流程" class="headerlink" title="实验流程"></a>实验流程</h2>
      <p>了解了winpcap之后，我们要做的就是利用它提供的类库来实现网络传输，网络解析等一系列的功能。</p>
      <p>需要我们做好的准备有：</p>
      <ul>
        <li>C语言的相关基础</li>
        <li>计算机网络的基础知识</li>
        <li>对开发环境的相关了解</li>
      </ul>
      <p>如果对于上述中任何一个不熟悉，请先去补习一下基础知识吧。</p>
      <h2 id="参考书目"><a href="#参考书目" class="headerlink" title="参考书目"></a>参考书目</h2>
      <ul>
        <li>吴功宜等，《计算机网络高级软件编程技术》（第2版），清华大学出版社</li>
        <li>徐恪等， 《高级计算机网络》，清华大学出版社</li>
        <li>A.S. Tannenbaum，《计算机网络》（第5版），清华大学出版社</li>
        <li>吕雪峰等， 《网络分析技术揭秘（原理、实践与WinPcap深入解析》，机械工业出版社</li>
      </ul>
      <h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2>
      <p>下一节，我们将讲解在Eclipse环境下搭建winpcap环境的具体步骤。本次讲解到此结束，谢谢大家。</p>
      </p>
    </div>
  </div>
  <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-user"></i>
      </span>
      <span class="post-meta-item-text">作者</span>
      <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      <time title="创建时间：2015-07-13 00:35:59" itemprop="dateCreated datePublished" datetime="2015-07-13T00:35:59+08:00">2015-07-13</time>
    </span>
    <span id="/1890.html" class="post-meta-item leancloud_visitors" data-flag-title="Winpcap网络编程一之前言，实验要求，实验目标" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.7k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
  </div>
</article>

    <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1883.html">
  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.png">
    <meta itemprop="name" content="崔庆才">
    <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  </span>
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="静觅">
  </span>
  <header class="post-header">
    <h2 class="post-title" itemprop="name headline">
      <a class="label"> 个人日记 <i class="label-arrow"></i>
      </a>
      <a href="/1883.html" class="post-title-link" itemprop="url">假期到啦，重新回归代码之路</a>
    </h2>
  </header>
  <div class="post-body" itemprop="articleBody">
    <div class="thumb">
      <img itemprop="contentUrl" class="random">
    </div>
    <div class="excerpt">
      <p>
      <p>二零一五年七月九日，伴随着最后一门图形学交卷铃声的想起，我的大三正式结束了。首先很抱歉，最近一段时间一直在忙考试复习，时间也比较紧张，另外就是整理各种材料，还有准备一些面试，也算是忙得不亦乐乎，所以，这段时间也没有去编代码，大约也有一个月的时间没有更新博客了，有好多热心的朋友在我博客留言评论，也没有及时回复，在这里向大家说一声抱歉。放假回家之后，我会好好研究一下大家提出的意见和建议，给予大家回复的。 恩，接下来的日子应该会稍微轻松那么一点，自己的研究生路大体有了轮廓，有了规划。将来想从事的方向为信息安全方向，自己也做过一些项目和网站，对一些安全性问题要求也是比较高的，自己也对安全问题比较感兴趣，嗯。 现在时间是二零一五年七月十二日，昨天回家，收拾整顿一番，今天假期正式开始啦！ 上学期是我大学的第六个学期了，对于保研来说，也着实是最后的一个重要的学期了，学习上也要更加重视。仔细回想起来，这个学期实际的项目开发没有做过多少，和同学开发了一个演唱会支付系统，又完善了一下自己之前的项目。学期后期，基本上就是准备一些面试和靠前复习，另外还有一些研究生招生的面试咨询等等，结果就不透露啦，自我感觉还是不错。 本来有好多话想说，然而这个时间，却不想多言了。 心里的石头还没落地，最近的日子，好好准备即将到来的面试。暑假到了，想要学习的东西还有很多，重新开启我的代码之路！Come On！</p>
      <p>崔庆才</p>
      <p>2015/7/12</p>
      </p>
    </div>
  </div>
  <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-user"></i>
      </span>
      <span class="post-meta-item-text">作者</span>
      <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      <time title="创建时间：2015-07-12 11:08:25" itemprop="dateCreated datePublished" datetime="2015-07-12T11:08:25+08:00">2015-07-12</time>
    </span>
    <span id="/1883.html" class="post-meta-item leancloud_visitors" data-flag-title="假期到啦，重新回归代码之路" title="阅读次数">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span class="leancloud-visitors-count"></span>
    </span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>599</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
  </div>
</article>



  <script>
  document.querySelectorAll('.random').forEach(item => item.src="https://picsum.photos/id/" + Math.floor(Math.random() * Math.floor(300)) + "/200/133")
  </script>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/14/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><span class="page-number current">15</span><a class="page-number" href="/page/16/">16</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/16/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
<div class="toggle sidebar-toggle">
  <span class="toggle-line toggle-line-first"></span>
  <span class="toggle-line toggle-line-middle"></span>
  <span class="toggle-line toggle-line-last"></span>
</div>

<aside class="sidebar">
  <div class="sidebar-inner">

    <ul class="sidebar-nav motion-element">
      <li class="sidebar-nav-toc">
        文章目录
      </li>
      <li class="sidebar-nav-overview">
        站点概览
      </li>
    </ul>

    <!--noindex-->
    <div class="post-toc-wrap sidebar-panel">
    </div>
    <!--/noindex-->

    <div class="site-overview-wrap sidebar-panel">
      <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="site-author-image" itemprop="image" alt="崔庆才" src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">崔庆才</p>
  <div class="site-description" itemprop="description">静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
    <div class="site-state-item site-state-posts">
      <a href="/archives/">
        <span class="site-state-item-count">710</span>
        <span class="site-state-item-name">日志</span>
      </a>
    </div>
    <div class="site-state-item site-state-categories">
      <a href="/categories/">
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">分类</span></a>
    </div>
    <div class="site-state-item site-state-tags">
      <a href="/tags/">
        <span class="site-state-item-count">260</span>
        <span class="site-state-item-name">标签</span></a>
    </div>
  </nav>
</div>
<div class="links-of-author motion-element">
  <span class="links-of-author-item">
    <a href="https://github.com/Germey" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Germey" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
  </span>
  <span class="links-of-author-item">
    <a href="mailto:cqc@cuiqingcai.com.com" title="邮件 → mailto:cqc@cuiqingcai.com.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>邮件</a>
  </span>
  <span class="links-of-author-item">
    <a href="https://weibo.com/cuiqingcai" title="微博 → https:&#x2F;&#x2F;weibo.com&#x2F;cuiqingcai" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>微博</a>
  </span>
  <span class="links-of-author-item">
    <a href="https://www.zhihu.com/people/Germey" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;Germey" rel="noopener" target="_blank"><i class="fa fa-magic fa-fw"></i>知乎</a>
  </span>
</div>

    </div>
    <div
      style=" width: 100%;"
      class="sidebar-panel sidebar-panel-image sidebar-panel-active">
      <a href="https://item.jd.com/13527222.html" target="_blank" rel="noopener">
        <img src="https://cdn.cuiqingcai.com/ei5og.jpg"
             style=" width: 100%;">
      </a>
    </div>
    <div class="sidebar-panel sidebar-panel-categories sidebar-panel-active">
      <h4 class="name">
        分类
      </h4>
      <div class="content">
        <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/API/">API</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/C-C/">C/C++</a><span class="category-list-count">23</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Claude/">Claude</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Gemini/">Gemini</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Google-SERP/">Google SERP</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/HTML/">HTML</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/">JavaScript</a><span class="category-list-count">26</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Luma/">Luma</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Markdown/">Markdown</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Midjourney/">Midjourney</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nano-Banana/">Nano Banana</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Net/">Net</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Nexior/">Nexior</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Other/">Other</a><span class="category-list-count">40</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a><span class="category-list-count">27</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Paper/">Paper</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Producer/">Producer</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">303</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SeeDance/">SeeDance</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SeeDream/">SeeDream</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Sora/">Sora</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/TypeScript/">TypeScript</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Veo/">Veo</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/nano-banana/">nano-banana</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E5%B1%95%E7%A4%BA/">个人展示</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E6%97%A5%E8%AE%B0/">个人日记</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E8%AE%B0%E5%BD%95/">个人记录</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E9%9A%8F%E7%AC%94/">个人随笔</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/">人工智能</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/">安装配置</a><span class="category-list-count">59</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%9D%82%E8%B0%88/">技术杂谈</a><span class="category-list-count">96</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9C%AA%E5%88%86%E7%B1%BB/">未分类</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">深度学习</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%88%AC%E8%99%AB/">爬虫</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%94%9F%E6%B4%BB%E7%AC%94%E8%AE%B0/">生活笔记</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%A6%8F%E5%88%A9%E4%B8%93%E5%8C%BA/">福利专区</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%81%8C%E4%BD%8D%E6%8E%A8%E8%8D%90/">职位推荐</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%89%BA%E6%9C%AF%E4%BA%8C%E7%BB%B4%E7%A0%81/">艺术二维码</a><span class="category-list-count">1</span></li></ul>
      </div>
    </div>
    <div class="sidebar-panel sidebar-panel-friends sidebar-panel-active">
      <h4 class="name">
        友情链接
      </h4>
      <ul class="friends">
        <li class="friend">
          <span class="logo">
            <img src="https://cdn.cuiqingcai.com/j2dub.jpg">
          </span>
          <span class="link">
            <a href="https://www.findhao.net/" target="_blank" rel="noopener">FindHao</a>
          </span>
        </li>
        <li class="friend">
          <span class="logo">
            <img src="https://cdn.cuiqingcai.com/6apxu.jpg">
          </span>
          <span class="link">
            <a href="https://www.51dev.com/" target="_blank" rel="noopener">IT技术社区</a>
          </span>
        </li>
        <li class="friend">
          <span class="logo">
            <img src="https://cdn.cuiqingcai.com/bqlbs.png">
          </span>
          <span class="link">
            <a href="http://www.urselect.com/" target="_blank" rel="noopener">优社电商</a>
          </span>
        </li>
        <li class="friend">
          <span class="logo">
            <img src="https://cdn.cuiqingcai.com/8s88c.jpg">
          </span>
          <span class="link">
            <a href="https://www.yuanrenxue.com/" target="_blank" rel="noopener">猿人学</a>
          </span>
        </li>
        <li class="friend">
          <span class="logo">
            <img src="https://cdn.cuiqingcai.com/2wgg5.jpg">
          </span>
          <span class="link">
            <a href="https://www.yunlifang.cn/" target="_blank" rel="noopener">云立方</a>
          </span>
        </li>
        <li class="friend">
          <span class="logo">
            <img src="http://qianxunclub.com/favicon.png">
          </span>
          <span class="link">
            <a href="http://qianxunclub.com/" target="_blank" rel="noopener">千寻啊千寻</a>
          </span>
        </li>
        <li class="friend">
          <span class="logo">
            <img src="https://cdn.cuiqingcai.com/0044u.jpg">
          </span>
          <span class="link">
            <a href="http://kodcloud.com/" target="_blank" rel="noopener">可道云</a>
          </span>
        </li>
        <li class="friend">
          <span class="logo">
            <img src="https://cdn.cuiqingcai.com/ygnpn.jpg">
          </span>
          <span class="link">
            <a href="http://www.kunkundashen.cn/" target="_blank" rel="noopener">坤坤大神</a>
          </span>
        </li>
        <li class="friend">
          <span class="logo">
            <img src="https://cdn.cuiqingcai.com/x714o.jpg">
          </span>
          <span class="link">
            <a href="http://www.hubwiz.com/" target="_blank" rel="noopener">汇智网</a>
          </span>
        </li>
        <li class="friend">
          <span class="logo">
            <img src="https://cdn.cuiqingcai.com/44hxf.png">
          </span>
          <span class="link">
            <a href="http://redstonewill.com/" target="_blank" rel="noopener">红色石头</a>
          </span>
        </li>
        <li class="friend">
          <span class="logo">
            <img src="https://cdn.cuiqingcai.com/wkaus.jpg">
          </span>
          <span class="link">
            <a href="https://zhaoshuai.me/" target="_blank" rel="noopener">碎念</a>
          </span>
        </li>
        <li class="friend">
          <span class="logo">
            <img src="https://cdn.cuiqingcai.com/pgo0r.jpg">
          </span>
          <span class="link">
            <a href="https://www.chenwenguan.com/" target="_blank" rel="noopener">陈文管的博客</a>
          </span>
        </li>
        <li class="friend">
          <span class="logo">
            <img src="https://cdn.cuiqingcai.com/kk82a.jpg">
          </span>
          <span class="link">
            <a href="https://www.lxlinux.net/" target="_blank" rel="noopener">良许Linux教程网</a>
          </span>
        </li>
        <li class="friend">
          <span class="logo">
            <img src="https://cdn.cuiqingcai.com/lj0t2.jpg">
          </span>
          <span class="link">
            <a href="https://tanqingbo.cn/" target="_blank" rel="noopener">IT码农</a>
          </span>
        </li>
        <li class="friend">
          <span class="logo">
            <img src="https://cdn.cuiqingcai.com/i8cdr.png">
          </span>
          <span class="link">
            <a href="https://junyiseo.com/" target="_blank" rel="noopener">均益个人博客</a>
          </span>
        </li>
        <li class="friend">
          <span class="logo">
            <img src="https://cdn.cuiqingcai.com/chwv2.png">
          </span>
          <span class="link">
            <a href="https://brucedone.com/" target="_blank" rel="noopener">大鱼的鱼塘</a>
          </span>
        </li>
        <li class="friend">
          <span class="logo">
            <img src="https://www.91vps.com/favicon.ico">
          </span>
          <span class="link">
            <a href="http://www.91vps.com/" target="_blank" rel="noopener">91VPS</a>
          </span>
        </li>
        <li class="friend">
          <span class="logo">
            <img src="https://webpage.qidian.qq.com/qidian/chatv3-gray/favicon.ico">
          </span>
          <span class="link">
            <a href="https://www.qg.net/" target="_blank" rel="noopener">青果网络</a>
          </span>
        </li>
      </ul>
    </div>
    <div class="sidebar-panel sidebar-panel-tags sidebar-panel-active">
      <h4 class="name">
        标签云
      </h4>
      <div class="content">
        <a href="/tags/2022/" style="font-size: 20px;">2022</a> <a href="/tags/2048/" style="font-size: 10px;">2048</a> <a href="/tags/ACE-Data/" style="font-size: 13px;">ACE Data</a> <a href="/tags/ADSL/" style="font-size: 10px;">ADSL</a> <a href="/tags/AI%E7%BC%96%E7%A8%8B/" style="font-size: 10px;">AI编程</a> <a href="/tags/API/" style="font-size: 19px;">API</a> <a href="/tags/Ajax/" style="font-size: 12px;">Ajax</a> <a href="/tags/Audios/" style="font-size: 11px;">Audios</a> <a href="/tags/Bootstrap/" style="font-size: 11px;">Bootstrap</a> <a href="/tags/Bug/" style="font-size: 10px;">Bug</a> <a href="/tags/CDN/" style="font-size: 10px;">CDN</a> <a href="/tags/CQC/" style="font-size: 10px;">CQC</a> <a href="/tags/CSS/" style="font-size: 10px;">CSS</a> <a href="/tags/CSS-%E5%8F%8D%E7%88%AC%E8%99%AB/" style="font-size: 10px;">CSS 反爬虫</a> <a href="/tags/CV/" style="font-size: 10px;">CV</a> <a href="/tags/ChatGPT/" style="font-size: 10px;">ChatGPT</a> <a href="/tags/Cookie/" style="font-size: 10px;">Cookie</a> <a href="/tags/Django/" style="font-size: 10px;">Django</a> <a href="/tags/Eclipse/" style="font-size: 11px;">Eclipse</a> <a href="/tags/Elasticsearch/" style="font-size: 10px;">Elasticsearch</a> <a href="/tags/FTP/" style="font-size: 10px;">FTP</a> <a href="/tags/Flux/" style="font-size: 10px;">Flux</a> <a href="/tags/Gemini/" style="font-size: 10px;">Gemini</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/GitHub/" style="font-size: 13px;">GitHub</a> <a href="/tags/Google-SERP/" style="font-size: 11px;">Google SERP</a> <a href="/tags/HTML5/" style="font-size: 10px;">HTML5</a> <a href="/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="/tags/Hailuo/" style="font-size: 10px;">Hailuo</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/Hook/" style="font-size: 10px;">Hook</a> <a href="/tags/IP/" style="font-size: 10px;">IP</a> <a href="/tags/IT/" style="font-size: 10px;">IT</a> <a href="/tags/Images/" style="font-size: 11px;">Images</a> <a href="/tags/JSON/" style="font-size: 10px;">JSON</a> <a href="/tags/JSP/" style="font-size: 10px;">JSP</a> <a href="/tags/JavaScript/" style="font-size: 14px;">JavaScript</a> <a href="/tags/K8s/" style="font-size: 10px;">K8s</a> <a href="/tags/LOGO/" style="font-size: 10px;">LOGO</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/Luma/" style="font-size: 10px;">Luma</a> <a href="/tags/MIUI/" style="font-size: 10px;">MIUI</a> <a href="/tags/Markdown/" style="font-size: 10px;">Markdown</a> <a href="/tags/Midjourney/" style="font-size: 12px;">Midjourney</a> <a href="/tags/MongoDB/" style="font-size: 11px;">MongoDB</a> <a href="/tags/MySQL/" style="font-size: 10px;">MySQL</a> <a href="/tags/Mysql/" style="font-size: 10px;">Mysql</a> <a href="/tags/NBA/" style="font-size: 10px;">NBA</a> <a href="/tags/Nano-Banana/" style="font-size: 11px;">Nano Banana</a> <a href="/tags/Nexior/" style="font-size: 10px;">Nexior</a> <a href="/tags/OCR/" style="font-size: 10px;">OCR</a> <a href="/tags/OpenCV/" style="font-size: 10px;">OpenCV</a> <a href="/tags/PHP/" style="font-size: 11px;">PHP</a> <a href="/tags/PPT/" style="font-size: 10px;">PPT</a> <a href="/tags/PS/" style="font-size: 10px;">PS</a> <a href="/tags/Pathlib/" style="font-size: 10px;">Pathlib</a> <a href="/tags/PhantomJS/" style="font-size: 10px;">PhantomJS</a> <a href="/tags/Playwright/" style="font-size: 10px;">Playwright</a> <a href="/tags/Producer/" style="font-size: 11px;">Producer</a> <a href="/tags/Python/" style="font-size: 16px;">Python</a> <a href="/tags/Python-%E7%88%AC%E8%99%AB/" style="font-size: 17px;">Python 爬虫</a> <a href="/tags/Python3/" style="font-size: 11px;">Python3</a> <a href="/tags/Python3%E7%88%AC%E8%99%AB%E6%95%99%E7%A8%8B/" style="font-size: 12px;">Python3爬虫教程</a> <a href="/tags/Pythonic/" style="font-size: 10px;">Pythonic</a> <a href="/tags/Python%E7%88%AC%E8%99%AB/" style="font-size: 18px;">Python爬虫</a> <a href="/tags/Python%E7%88%AC%E8%99%AB%E4%B9%A6/" style="font-size: 12px;">Python爬虫书</a> <a href="/tags/Python%E7%88%AC%E8%99%AB%E6%95%99%E7%A8%8B/" style="font-size: 15px;">Python爬虫教程</a> <a href="/tags/QQ/" style="font-size: 10px;">QQ</a> <a href="/tags/RabbitMQ/" style="font-size: 10px;">RabbitMQ</a> <a href="/tags/ReCAPTCHA/" style="font-size: 10px;">ReCAPTCHA</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/Riffusion/" style="font-size: 11px;">Riffusion</a> <a href="/tags/SAE/" style="font-size: 10px;">SAE</a> <a href="/tags/SSH/" style="font-size: 10px;">SSH</a> <a href="/tags/SVG/" style="font-size: 10px;">SVG</a> <a href="/tags/Scrapy-redis/" style="font-size: 10px;">Scrapy-redis</a> <a href="/tags/Scrapy%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 10px;">Scrapy分布式</a> <a href="/tags/SeeDance/" style="font-size: 14px;">SeeDance</a> <a href="/tags/SeeDream/" style="font-size: 12px;">SeeDream</a> <a href="/tags/Selenium/" style="font-size: 11px;">Selenium</a> <a href="/tags/Session/" style="font-size: 10px;">Session</a> <a href="/tags/Shell/" style="font-size: 10px;">Shell</a> <a href="/tags/Sora/" style="font-size: 10px;">Sora</a> <a href="/tags/Sora2/" style="font-size: 11px;">Sora2</a> <a href="/tags/Suno/" style="font-size: 11px;">Suno</a> <a href="/tags/TKE/" style="font-size: 10px;">TKE</a> <a href="/tags/TXT/" style="font-size: 10px;">TXT</a> <a href="/tags/Terminal/" style="font-size: 10px;">Terminal</a> <a href="/tags/Ubuntu/" style="font-size: 11px;">Ubuntu</a> <a href="/tags/VS-Code/" style="font-size: 10px;">VS Code</a> <a href="/tags/Veo/" style="font-size: 13px;">Veo</a> <a href="/tags/Vercel/" style="font-size: 10px;">Vercel</a> <a href="/tags/Videos/" style="font-size: 12px;">Videos</a> <a href="/tags/Vs-Code/" style="font-size: 10px;">Vs Code</a> <a href="/tags/Vue/" style="font-size: 11px;">Vue</a> <a href="/tags/Web/" style="font-size: 10px;">Web</a> <a href="/tags/Webpack/" style="font-size: 10px;">Webpack</a> <a href="/tags/Web%E7%BD%91%E9%A1%B5/" style="font-size: 10px;">Web网页</a> <a href="/tags/Windows/" style="font-size: 10px;">Windows</a> <a href="/tags/Winpcap/" style="font-size: 10px;">Winpcap</a>
      </div>
      <script>
        const tagsColors = ['#00a67c', '#5cb85c', '#d9534f', '#567e95', '#b37333', '#f4843d', '#15a287']
        const tagsElements = document.querySelectorAll('.sidebar-panel-tags .content a')
        tagsElements.forEach((item) => {
          item.style.backgroundColor = tagsColors[Math.floor(Math.random() * tagsColors.length)]
        })
      </script>
    </div>

  </div>
</aside>
<div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        <div class="copyright">
  <span class="author" itemprop="copyrightHolder">崔庆才丨静觅</span> &copy; <span itemprop="copyrightYear">2026</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <a href="https://cuiqingcai.com/sitemap.xml" style="display:none" title="爬虫教程" target="_blank"><strong>爬虫教程</strong></a>
  <a href="https://cuiqingcai.com/sitemap.html" style="display:none" title="爬虫教程" target="_blank"><strong>爬虫教程</strong></a>
  <span class="post-meta-divider">|</span>
  <span class="post-meta-item-icon">
    <i class="fa fa-chart-area"></i>
  </span>
  <span title="站点总字数">3.5m</span>
  <span class="post-meta-divider">|</span>
  <span class="post-meta-item-icon">
    <i class="fa fa-coffee"></i>
  </span>
  <span title="站点阅读时长">52:30</span>
</div>
<div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动 </div>
<div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">京ICP备18015597号-1 </a>
</div>

        <script>
  (function ()
  {
    function leancloudSelector(url)
    {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter)
    {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;
      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify(
      {
        url
      }))).then(response => response.json()).then((
      {
        results
      }) =>
      {
        if (results.length > 0)
        {
          var counter = results[0];
          leancloudSelector(url).innerText = counter.time + 1;
          Counter('put', '/classes/Counter/' + counter.objectId,
          {
            time:
            {
              '__op': 'Increment',
              'amount': 1
            }
          }).catch(error =>
          {
            console.error('Failed to save visitor count', error);
          });
        }
        else
        {
          Counter('post', '/classes/Counter',
          {
            title,
            url,
            time: 1
          }).then(response => response.json()).then(() =>
          {
            leancloudSelector(url).innerText = 1;
          }).catch(error =>
          {
            console.error('Failed to create', error);
          });
        }
      }).catch(error =>
      {
        console.error('LeanCloud Counter Error', error);
      });
    }

    function showTime(Counter)
    {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element =>
      {
        return decodeURI(element.id);
      });
      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify(
      {
        url:
        {
          '$in': entries
        }
      }))).then(response => response.json()).then((
      {
        results
      }) =>
      {
        for (let url of entries)
        {
          let target = results.find(item => item.url === url);
          leancloudSelector(url).innerText = target ? target.time : 0;
        }
      }).catch(error =>
      {
        console.error('LeanCloud Counter Error', error);
      });
    }
    let
    {
      app_id,
      app_key,
      server_url
    } = {
      "enable": true,
      "app_id": "6X5dRQ0pnPWJgYy8SXOg0uID-gzGzoHsz",
      "app_key": "ziLDVEy73ne5HtFTiGstzHMS",
      "server_url": "https://6x5drq0p.lc-cn-n1-shared.com",
      "security": false
    };

    function fetchData(api_server)
    {
      var Counter = (method, url, data) =>
      {
        return fetch(`${api_server}/1.1${url}`,
        {
          method,
          headers:
          {
            'X-LC-Id': app_id,
            'X-LC-Key': app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost)
      {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      }
      else if (document.querySelectorAll('.post-title-link').length >= 1)
      {
        showTime(Counter);
      }
    }
    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;
    if (api_server)
    {
      fetchData(api_server);
    }
    else
    {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id).then(response => response.json()).then((
      {
        api_server
      }) =>
      {
        fetchData('https://' + api_server);
      });
    }
  })();

</script>

      </div>
      <div class="footer-stat">
        <span id="cnzz_stat_icon_1279355174"></span>
        <script type="text/javascript">document.write(unescape("%3Cspan id='cnzz_stat_icon_1279355174'%3E%3C/span%3E%3Cscript src='https://v1.cnzz.com/z_stat.php%3Fid%3D1279355174%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"));</script>
      </div>
    </footer>
  </div>

  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
<script src="/js/utils.js"></script>
<script src="/.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/.js"></script>
<script src="/js/next-boot.js"></script>
<script src="/.js"></script>

  <script>
  (function ()
  {
    var canonicalURL, curProtocol;
    //Get the <link> tag
    var x = document.getElementsByTagName("link");
    //Find the last canonical URL
    if (x.length > 0)
    {
      for (i = 0; i < x.length; i++)
      {
        if (x[i].rel.toLowerCase() == 'canonical' && x[i].href)
        {
          canonicalURL = x[i].href;
        }
      }
    }
    //Get protocol
    if (!canonicalURL)
    {
      curProtocol = window.location.protocol.split(':')[0];
    }
    else
    {
      curProtocol = canonicalURL.split(':')[0];
    }
    //Get current URL if the canonical URL does not exist
    if (!canonicalURL) canonicalURL = window.location.href;
    //Assign script content. Replace current URL with the canonical URL
    ! function ()
    {
      var e = /([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,
        r = canonicalURL,
        t = document.referrer;
      if (!e.test(r))
      {
        var n = (String(curProtocol).toLowerCase() === 'https') ? "https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif" : "//api.share.baidu.com/s.gif";
        t ? (n += "?r=" + encodeURIComponent(document.referrer), r && (n += "&l=" + r)) : r && (n += "?l=" + r);
        var i = new Image;
        i.src = n
      }
    }(window);
  })();

</script>
<script src="/js/local-search.js"></script>
<script src="/.js"></script>

  

  

  



</body>
</html>
