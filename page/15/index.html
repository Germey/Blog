<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
  <meta name="theme-color" content="#222">
  <meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#222">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>
  <script id="hexo-configurations">
    var NexT = window.NexT ||
    {};
    var CONFIG = {
      "hostname": "cuiqingcai.com",
      "root": "/",
      "scheme": "Pisces",
      "version": "7.8.0",
      "exturl": false,
      "sidebar":
      {
        "position": "right",
        "width": 360,
        "display": "post",
        "padding": 18,
        "offset": 12,
        "onmobile": false,
        "widgets": [
          {
            "type": "image",
            "name": "阿布云",
            "enable": false,
            "url": "https://www.abuyun.com/http-proxy/introduce.html",
            "src": "https://cdn.cuiqingcai.com/88au8.jpg",
            "width": "100%"
      },
          {
            "type": "image",
            "name": "爬虫书",
            "url": "https://item.jd.com/13527222.html",
            "src": "https://cdn.cuiqingcai.com/ei5og.jpg",
            "width": "100%",
            "enable": true
      },
          {
            "type": "categories",
            "name": "分类",
            "enable": true
      },
          {
            "type": "image",
            "name": "IPIDEA",
            "url": "http://www.ipidea.net/?utm-source=cqc&utm-keyword=?cqc",
            "src": "https://cdn.cuiqingcai.com/0ywun.png",
            "width": "100%",
            "enable": false
      },
          {
            "type": "image",
            "name": "Storm Proxies",
            "src": "https://cdn.cuiqingcai.com/a2zad8.png",
            "url": "https://www.stormproxies.cn/?keyword=jingmi",
            "width": "100%",
            "enable": false
      },
          {
            "type": "friends",
            "name": "友情链接",
            "enable": true
      },
          {
            "type": "hot",
            "name": "猜你喜欢",
            "enable": true
      },
          {
            "type": "tags",
            "name": "标签云",
            "enable": true
      }]
      },
      "copycode":
      {
        "enable": true,
        "show_result": true,
        "style": "mac"
      },
      "back2top":
      {
        "enable": true,
        "sidebar": false,
        "scrollpercent": true
      },
      "bookmark":
      {
        "enable": false,
        "color": "#222",
        "save": "auto"
      },
      "fancybox": false,
      "mediumzoom": false,
      "lazyload": false,
      "pangu": true,
      "comments":
      {
        "style": "tabs",
        "active": "gitalk",
        "storage": true,
        "lazyload": false,
        "nav": null,
        "activeClass": "gitalk"
      },
      "algolia":
      {
        "hits":
        {
          "per_page": 10
        },
        "labels":
        {
          "input_placeholder": "Search for Posts",
          "hits_empty": "We didn't find any results for the search: ${query}",
          "hits_stats": "${hits} results found in ${time} ms"
        }
      },
      "localsearch":
      {
        "enable": true,
        "trigger": "auto",
        "top_n_per_article": 10,
        "unescape": false,
        "preload": false
      },
      "motion":
      {
        "enable": false,
        "async": false,
        "transition":
        {
          "post_block": "bounceDownIn",
          "post_header": "slideDownIn",
          "post_body": "slideDownIn",
          "coll_header": "slideLeftIn",
          "sidebar": "slideUpIn"
        }
      },
      "path": "search.xml"
    };

  </script>
  <meta name="keywords" content="爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书,静觅,崔庆才">
  <meta name="robots" content="index,follow">
  <meta name="GOOGLEBOT" content="index,follow">
  <meta name="author" content="静觅丨崔庆才的个人站点">
  <meta name="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  <meta property="og:type" content="website">
  <meta property="og:title" content="静觅">
  <meta property="og:url" content="https://cuiqingcai.com/page/15/index.html">
  <meta property="og:site_name" content="静觅">
  <meta property="og:description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
  <meta property="og:locale" content="zh_CN">
  <meta property="article:author" content="崔庆才">
  <meta property="article:tag" content="爬虫教程">
  <meta property="article:tag" content="爬虫">
  <meta property="article:tag" content="Python">
  <meta property="article:tag" content="Python爬虫">
  <meta property="article:tag" content="Python爬虫教程">
  <meta property="article:tag" content="爬虫书">
  <meta property="article:tag" content="静觅">
  <meta property="article:tag" content="崔庆才">
  <meta name="twitter:card" content="summary">
  <link rel="canonical" href="https://cuiqingcai.com/page/15/">
  <script id="page-configurations">
    // https://hexo.io/docs/variables.html
    CONFIG.page = {
      sidebar: "",
      isHome: true,
      isPost: false,
      lang: 'zh-CN'
    };

  </script>
  <title>静觅丨崔庆才的个人站点 - Python爬虫教程</title>
  <meta name="google-site-verification" content="p_bIcnvirkFzG2dYKuNDivKD8-STet5W7D-01woA2fc" />
  <meta name="sogou_site_verification" content="kBOV53NQqT" />
  <noscript>
    <style>
      .use-motion .brand,
      .use-motion .menu-item,
      .sidebar-inner,
      .use-motion .post-block,
      .use-motion .pagination,
      .use-motion .comments,
      .use-motion .post-header,
      .use-motion .post-body,
      .use-motion .collection-header
      {
        opacity: initial;
      }

      .use-motion .site-title,
      .use-motion .site-subtitle
      {
        opacity: initial;
        top: initial;
      }

      .use-motion .logo-line-before i
      {
        left: initial;
      }

      .use-motion .logo-line-after i
      {
        right: initial;
      }

    </style>
  </noscript>
  <link rel="alternate" href="/atom.xml" title="静觅" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner">
        <div class="site-brand-container">
          <div class="site-nav-toggle">
            <div class="toggle" aria-label="切换导航栏">
              <span class="toggle-line toggle-line-first"></span>
              <span class="toggle-line toggle-line-middle"></span>
              <span class="toggle-line toggle-line-last"></span>
            </div>
          </div>
          <div class="site-meta">
            <a href="/" class="brand" rel="start">
              <span class="logo-line-before"><i></i></span>
              <h1 class="site-title">静觅 <span class="site-subtitle"> 崔庆才的个人站点 - Python爬虫教程 </span>
              </h1>
              <span class="logo-line-after"><i></i></span>
            </a>
          </div>
          <div class="site-nav-right">
            <div class="toggle popup-trigger">
              <i class="fa fa-search fa-fw fa-lg"></i>
            </div>
          </div>
        </div>
        <nav class="site-nav">
          <ul id="menu" class="main-menu menu">
            <li class="menu-item menu-item-home">
              <a href="/" rel="section">首页</a>
            </li>
            <li class="menu-item menu-item-archives">
              <a href="/archives/" rel="section">文章列表</a>
            </li>
            <li class="menu-item menu-item-tags">
              <a href="/tags/" rel="section">文章标签</a>
            </li>
            <li class="menu-item menu-item-categories">
              <a href="/categories/" rel="section">文章分类</a>
            </li>
            <li class="menu-item menu-item-about">
              <a href="/about/" rel="section">关于博主</a>
            </li>
            <li class="menu-item menu-item-message">
              <a href="/message/" rel="section">给我留言</a>
            </li>
            <li class="menu-item menu-item-search">
              <a role="button" class="popup-trigger">搜索 </a>
            </li>
          </ul>
        </nav>
        <div class="search-pop-overlay">
          <div class="popup search-popup">
            <div class="search-header">
              <span class="search-icon">
                <i class="fa fa-search"></i>
              </span>
              <div class="search-input-container">
                <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input">
              </div>
              <span class="popup-btn-close">
                <i class="fa fa-times-circle"></i>
              </span>
            </div>
            <div id="search-result">
              <div id="no-result">
                <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>
    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
      <span>0%</span>
    </div>
    <div class="reading-progress-bar"></div>
    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div class="content index posts-expand">
            <div class="carousel">
              <div id="wowslider-container">
                <div class="ws_images">
                  <ul>
                    <li><a target="_blank" href="https://item.jd.com/13527222.html"><img title="Python3网络爬虫开发实战（第二版）上市了！" src="https://cdn.cuiqingcai.com/prwgs.png" /></a></li>
                    <li><a target="_blank" href="https://t.lagou.com/fRCBRsRCSN6FA"><img title="52讲轻松搞定网络爬虫" src="https://cdn.cuiqingcai.com/fqq5e.png" /></a></li>
                    <li><a target="_blank" href="https://cuiqingcai.com/4320.html"><img title="Python3网络爬虫开发视频教程" src="https://cdn.cuiqingcai.com/bjrny.jpg" /></a></li>
                    <li><a target="_blank" href="https://cuiqingcai.com/5094.html"><img title="爬虫代理哪家强？十大付费代理详细对比评测出炉！" src="https://cdn.cuiqingcai.com/nifs6.jpg" /></a></li>
                  </ul>
                </div>
                <div class="ws_thumbs">
                  <div>
                    <a target="_blank" href="#"><img src="https://cdn.cuiqingcai.com/prwgs.png" /></a>
                    <a target="_blank" href="#"><img src="https://cdn.cuiqingcai.com/fqq5e.png" /></a>
                    <a target="_blank" href="#"><img src="https://cdn.cuiqingcai.com/bjrny.jpg" /></a>
                    <a target="_blank" href="#"><img src="https://cdn.cuiqingcai.com/nifs6.jpg" /></a>
                  </div>
                </div>
                <div class="ws_shadow"></div>
              </div>
            </div>
            <link rel="stylesheet" href="/lib/wowslide/slide.css">
            <script src="/lib/wowslide/jquery.min.js"></script>
            <script src="/lib/wowslide/slider.js"></script>
            <script>
              jQuery("#wowslider-container").wowSlider(
              {
                effect: "cube",
                prev: "",
                next: "",
                duration: 20 * 100,
                delay: 100 * 100,
                width: 716,
                height: 297,
                autoPlay: true,
                playPause: true,
                stopOnHover: false,
                loop: false,
                bullets: 0,
                caption: true,
                captionEffect: "slide",
                controls: true,
                onBeforeStep: 0,
                images: 0
              });

            </script>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2126.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Net <i class="label-arrow"></i>
                  </a>
                  <a href="/2126.html" class="post-title-link" itemprop="url">计算机网络探究一之利用双网卡主机共享上网</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>大家好，这次我们需要实现的是实现双网卡主机共享上网，就是一台主机通过连接另一台可以访问外网的双网卡主机来正常上网。所以我们需要两台机器来进行测试，在这里我们用的是两台 Ubuntu 14.04，其中一台是单网卡，一台是双网卡。废话不多说，行动起来吧。</p>
                  <h2 id="配置系统"><a href="#配置系统" class="headerlink" title="配置系统"></a>配置系统</h2>
                  <p>博主使用了 Vmware 来安装了两台 Ubuntu 主机，一台当路由机，名称是 Ubuntu Route，另一台是客户机，名称是 Ubuntu Desktop，具体的网络配置如下： Ubuntu Route： 一个网卡 eth0 通过 NAT 方式来与外部主机共享上网，这个网卡也就是 VMnet8 网卡，网段是 192.168.231.0 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151007164043.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151007164043.png" alt="20151007164043"></a> 另一个网卡 eth1 连接了一个自定义的仅主机模式的网卡 VMnet2，网段是 192.168.122.0 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151007164114.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151007164114.png" alt="20151007164114"></a> 网络适配器设置如下，eth0 开启了 DHCP，ech1 没有开启 DHCP <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151007164343.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151007164343.png" alt="20151007164343"></a> Ubuntu Desktop： 一个网卡 eth0 连接刚才那个自定义的仅主机模式的网卡 VMnet2，网段是 192.168.122.0 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151007164821.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151007164821.png" alt="20151007164821"></a> 好了，以上就是基本硬件的配置</p>
                  <h2 id="设置-IP"><a href="#设置-IP" class="headerlink" title="设置 IP"></a>设置 IP</h2>
                  <p>接下来我们设置一下 Ubuntu Route 的 IP 地址，修改 /etc/network/interfaces</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">auto lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line">auto eth0</span><br><span class="line">iface eth0 inet dhcp</span><br><span class="line">auto eth1</span><br><span class="line">iface eth1 inet static</span><br><span class="line">address 192.168.122.4</span><br><span class="line">netmask 255.255.255.0</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里，eth0 因为我们在 VMware 里面设置了 DHCP，所以这里我们设置 dhcp 即可，eth1 需要手动配置一下，我们分配了 192.168.122.4 这个 IP 地址，当然你可以随意指定，子网掩码如上，不需要写网关，因为它本身作为一个路由。 可以通过执行如下命令来使之生效</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo <span class="regexp">/etc/i</span>nit.d<span class="regexp">/networking restart</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果上述方法不行，则可以尝试使用关闭网卡和开启网卡的命令。</p>
                  <figure class="highlight properties">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">sudo</span> <span class="string">ifup eth0</span></span><br><span class="line"><span class="attr">sudo</span> <span class="string">ifdown eth0</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>eth1 的开启和关闭同上</p>
                  <h2 id="开启路由转发"><a href="#开启路由转发" class="headerlink" title="开启路由转发"></a>开启路由转发</h2>
                  <p>修改 /etc/sysctl.conf 文件，将</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">net.ipv4.ip_forward</span>=<span class="number">1</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这一行取消注释，代表开启了路由转发功能。 也可以通过执行</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">echo <span class="number">1</span> &gt; <span class="regexp">/proc/</span>sys<span class="regexp">/net/i</span>pv4<span class="regexp">/ip_forward</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>命令来实现</p>
                  <h2 id="设置-iptables-规则"><a href="#设置-iptables-规则" class="headerlink" title="设置 iptables 规则"></a>设置 iptables 规则</h2>
                  <p>iptables 是非常重要的一个环节，如果大家不熟悉，可以去搜相关资料了解一下。 执行如下命令，来设置一下 iptables 规则，可以直接在命令行逐条执行，也可以写成一个脚本来执行。</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">iptables -F</span><br><span class="line">iptables -t<span class="built_in"> nat </span>-F</span><br><span class="line">iptables -t<span class="built_in"> mangle </span>-F</span><br><span class="line">iptables -P INPUT ACCEPT</span><br><span class="line">iptables -P FORWARD ACCEPT</span><br><span class="line">iptables -t<span class="built_in"> nat </span>-A POSTROUTING -o eth0 -j MASQUERADE</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中最后一条是最重要的，代表将数据包通过 eth0 网卡来转发，也是 IP 伪装的一个常用方法，有了这条指令，从 eth1 网卡流经的一些数据包可以通过 eth0 来转发，这样就相当于连通了两个网卡，这样与 eth1 网卡连接的主机便可以上网了。</p>
                  <h2 id="客户主机设置"><a href="#客户主机设置" class="headerlink" title="客户主机设置"></a>客户主机设置</h2>
                  <p>因为客户机的 eth0 连接了 VMnet2 网卡，而 VMnet2 网卡又与路由主机的 eth1 连接，我们只需要简单设置一下 IP 地址就好了。 修改 /etc/network/interfaces</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">auto</span> eth0</span><br><span class="line">iface eth0 inet static</span><br><span class="line">address <span class="number">192.168</span><span class="number">.122</span><span class="number">.5</span></span><br><span class="line">netmask <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br><span class="line">gateway <span class="number">192.168</span><span class="number">.122</span><span class="number">.4</span></span><br><span class="line">dns-nameservers <span class="number">119.29</span><span class="number">.29</span><span class="number">.29</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里很重要的一个设置就是网关，设置成路由主机的 IP 地址。 设置完了同样重启一下网卡使其生效。 还可以选择性设置下 DNS 服务器。 至此，所有配置都完成了，测试一下吧。</p>
                  <h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2>
                  <p>我们在客户机里打开浏览器，输入随意一个网页测试一下。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151007172000.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/10/20151007172000.png" alt="20151007172000"></a> 嗯，客户机可以正常上网啦，一切都是那么轻松加愉快！ 如有问题，欢迎留言交流~</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-10-07 17:23:37" itemprop="dateCreated datePublished" datetime="2015-10-07T17:23:37+08:00">2015-10-07</time>
                </span>
                <span id="/2126.html" class="post-meta-item leancloud_visitors" data-flag-title="计算机网络探究一之利用双网卡主机共享上网" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.7k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2083.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/2083.html" class="post-title-link" itemprop="url">Python爬虫实战三之实现山东大学无线网络掉线自动重连</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="2022-年最新-Python3-网络爬虫教程"><a href="#2022-年最新-Python3-网络爬虫教程" class="headerlink" title="2022 年最新 Python3 网络爬虫教程"></a>2022 年最新 Python3 网络爬虫教程</h2>
                  <p>大家好，我是崔庆才，由于爬虫技术不断迭代升级，一些旧的教程已经过时、案例已经过期，最前沿的爬虫技术比如异步、JavaScript 逆向、安卓逆向、智能解析、WebAssembly、大规模分布式、Kubernetes 等技术层出不穷，我最近新出了一套最新最全面的 Python3 网络爬虫系列教程。</p>
                  <blockquote>
                    <p>博主自荐：截止 2022 年，可以将最前沿最全面的爬虫技术都涵盖的教程，如异步、JavaScript 逆向、安卓逆向、智能解析、WebAssembly、大规模分布式、Kubernetes 等，市面上目前就这一套了。</p>
                  </blockquote>
                  <p>最新教程对旧的爬虫技术内容进行了全面更新，搭建了全新的案例平台进行全面讲解，保证案例稳定有效不过期。</p>
                  <p>教程请移步：</p>
                  <p><a href="https://cuiqingcai.com/17777.html">【2022 版】Python3 网络爬虫学习教程</a></p>
                  <p>如下为原文。</p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>最近山大软件园校区 QLSC_STU 无线网掉线掉的厉害，连上之后平均十分钟左右掉线一次，很是让人心烦，还能不能愉快地上自习了？能忍吗？反正我是不能忍了，嗯，自己动手，丰衣足食！写个程序解决掉它！ 假若你不能连这个无线，那就照照思路啦～</p>
                  <h2 id="决战前夕"><a href="#决战前夕" class="headerlink" title="决战前夕"></a>决战前夕</h2>
                  <p>首先我们看一下那个验证页面是咋样滴，上个图先 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150920192557.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150920192557.png" alt="20150920192557"></a> 嘿，这界面还算可以把，需要我们输入的东西就是俩，一个就是学号，另一个是身份证号后六位，然后就可以登录，享受免费的无线网啦。 不过不知道谁设置了个登录时长，一段时间后就会掉线了，于是，自动模拟登陆系统就要应运而生啦。 来，我们先点击一下连接，看一下浏览器怎么工作的。 按下 F12，监听网络，我们点击第一个响应，也就是 login.jsp，看一下。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150920192957.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150920192957-1024x661.png" alt="20150920192957"></a> 我们具体看一下 headers，里面 form 提交了什么东西，真的是茫茫多的数据啊。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150920193146.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150920193146.png" alt="20150920193146"></a> 嗯，一目了然 POST 的数据和提交的地址。 让我们来分析几个数据吧：</p>
                  <blockquote>
                    <p>ClientIP：当前客户端的 IP 地址，在山大软件园校区这个地址是 211.87 开头的</p>
                    <p>timeoutvalue：连接等待时间，也就是俗话说的 timeout</p>
                    <p>StartTime：登录时间，也就是在你登录的那一刻的时间戳，这个时间戳是 13 位的，精确到了毫秒，不过一般是 10 位的，我们加 3 个 0 就好了</p>
                    <p>shkOvertime：登录持续时间，这个数据默认是 720，也就是 12 分钟之后，登录就失效了，自动掉线，我们可以手动更改</p>
                    <p>username：学号</p>
                    <p>password：密码，也就是我们身份证号后六位</p>
                  </blockquote>
                  <p>我们需要在登录的时候把 form 表单中的所有信息都 POST 一下，然后就可以完成登录啦。 万事俱备，只欠东风，来来来，程序写起来！</p>
                  <h2 id="一触即发"><a href="#一触即发" class="headerlink" title="一触即发"></a>一触即发</h2>
                  <p>说走咱就走啊，天上的星星参北斗啊！ 登陆地址：Request URL:<a href="http://192.168.8.10/portal/login.jsp?Flag=0" target="_blank" rel="noopener">http://192.168.8.10/portal/login.jsp?Flag=0</a> 首先，我们需要验证一下 IP 地址，先写一个获取 IP 地址的函数，首先判断当前 IP 是不是 211.87 开头的，如果是的话，证明连接的 IP 是有效的。 首先我们写一个获取本机 IP 的方法：</p>
                  <figure class="highlight properties">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">self.ip_pre</span> = <span class="string">"211.87"</span></span><br><span class="line"><span class="comment">#获取本机无线IP</span></span><br><span class="line">    <span class="attr">def</span> <span class="string">getIP(self):</span></span><br><span class="line">        <span class="attr">local_iP</span> = <span class="string">socket.gethostbyname(socket.gethostname())</span></span><br><span class="line">        <span class="attr">if</span> <span class="string">self.ip_pre in str(local_iP):</span></span><br><span class="line">            <span class="attr">return</span> <span class="string">str(local_iP)</span></span><br><span class="line">        <span class="attr">ip_lists</span> = <span class="string">socket.gethostbyname_ex(socket.gethostname())</span></span><br><span class="line"></span><br><span class="line">        <span class="attr">for</span> <span class="string">ip_list in ip_lists:</span></span><br><span class="line">            <span class="attr">if</span> <span class="string">isinstance(ip_list, list):</span></span><br><span class="line">                <span class="attr">for</span> <span class="string">i in ip_list:</span></span><br><span class="line">                    <span class="attr">if</span> <span class="string">self.ip_pre in str(i):</span></span><br><span class="line">                        <span class="attr">return</span> <span class="string">str(i)</span></span><br><span class="line">            <span class="attr">elif</span> <span class="string">type(ip_list) is types.StringType:</span></span><br><span class="line">                <span class="attr">if</span> <span class="string">self.ip_pre in ip_list:</span></span><br><span class="line">                    <span class="attr">return</span> <span class="string">ip_list</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这个方法利用了 gethostbyname 和 gethostbyname_ex 方法，获取了各个网卡的 IP 地址，遍历一下，找到那个 211.87 开头的 IP，返回 接下来，获取到 IP 之后，我们便可以构建 form，然后进行模拟登陆了。</p>
                  <figure class="highlight ruby">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">#模拟登录</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        print <span class="keyword">self</span>.getCurrentTime(), u<span class="string">"正在尝试认证QLSC_STU无线网络"</span></span><br><span class="line">        ip = <span class="keyword">self</span>.getIP()</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">"username"</span>: <span class="keyword">self</span>.username,</span><br><span class="line">            <span class="string">"password"</span>: <span class="keyword">self</span>.password,</span><br><span class="line">            <span class="string">"serverType"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"isSavePass"</span>: <span class="string">"on"</span>,</span><br><span class="line">            <span class="string">"Submit1"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"Language"</span>: <span class="string">"Chinese"</span>,</span><br><span class="line">            <span class="string">"ClientIP"</span>: <span class="keyword">self</span>.getIP(),</span><br><span class="line">            <span class="string">"timeoutvalue"</span>: <span class="number">45</span>,</span><br><span class="line">            <span class="string">"heartbeat"</span>: <span class="number">240</span>,</span><br><span class="line">            <span class="string">"fastwebornot"</span>: False,</span><br><span class="line">            <span class="string">"StartTime"</span>: <span class="keyword">self</span>.getNowTime(),</span><br><span class="line">            <span class="comment">#持续时间，超过这个时间自动掉线，可进行设置</span></span><br><span class="line">            <span class="string">"shkOvertime"</span>: <span class="keyword">self</span>.overtime,</span><br><span class="line">            <span class="string">"strOSName"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"iAdptIndex"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strAdptName"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strAdptStdName"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strFileEncoding"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"PhysAddr"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"bDHCPEnabled"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strIPAddrArray"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strMaskArray"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strMask"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"iDHCPDelayTime"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"iDHCPTryTimes"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strOldPrivateIP"</span>: <span class="keyword">self</span>.getIP(),</span><br><span class="line">            <span class="string">"strOldPublicIP"</span>: <span class="keyword">self</span>.getIP(),</span><br><span class="line">            <span class="string">"strPrivateIP"</span>: <span class="keyword">self</span>.getIP(),</span><br><span class="line">            <span class="string">"PublicIP"</span>: <span class="keyword">self</span>.getIP(),</span><br><span class="line">            <span class="string">"iIPCONFIG"</span><span class="symbol">:</span><span class="number">0</span>,</span><br><span class="line">            <span class="string">"sHttpPrefix"</span>: <span class="string">"http://192.168.8.10"</span>,</span><br><span class="line">            <span class="string">"title"</span>: <span class="string">"CAMS Portal"</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">#消息头</span></span><br><span class="line">        headers = &#123;</span><br><span class="line">            <span class="string">'User-Agent'</span> : <span class="string">'Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/38.0.2125.111 Safari/537.36'</span>,</span><br><span class="line">            <span class="string">'Host'</span>: <span class="string">'192.168.8.10'</span>,</span><br><span class="line">            <span class="string">'Origin'</span>: <span class="string">'http://192.168.8.10'</span>,</span><br><span class="line">            <span class="string">'Referer'</span>: <span class="string">'http://192.168.8.10/portal/index_default.jsp?Language=Chinese'</span></span><br><span class="line">        &#125;</span><br><span class="line">        post_data = urllib.urlencode(data)</span><br><span class="line">        login_url = <span class="string">"http://192.168.8.10/portal/login.jsp?Flag=0"</span></span><br><span class="line">        request = urllib2.Request(login_url, post_data, headers)</span><br><span class="line">        response = urllib2.urlopen(request)</span><br><span class="line">        result = response.read().decode(<span class="string">'gbk'</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>比较多的内容就在于 form 表单的数据内容以及请求头，后来利用 urllib2 的 urlopen 方法实现模拟登陆。 如果大家对此不熟悉，可以参见 <a href="http://cuiqingcai.com/947.html">Urllib 的基本使用</a> 这样，登录后的结果就会保存在 result 变量中，我们只需要从 result 中提取出我们需要的数据就可以了。</p>
                  <h2 id="乘胜追击"><a href="#乘胜追击" class="headerlink" title="乘胜追击"></a>乘胜追击</h2>
                  <p>接下来，我们就分析一下数据啦，结果有这么几种：</p>
                  <blockquote>
                    <p>1.登录成功 2.已经登录 3.用户不存在 4.密码错误 5.未知错误</p>
                  </blockquote>
                  <p>好，利用 result 分析一下结果</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">#打印登录结果</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getLoginResult</span><span class="params">(self, result)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">u"用户上线成功"</span> <span class="keyword">in</span> result:</span><br><span class="line">            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">u"用户上线成功,在线时长为"</span>,self.overtime/<span class="number">60</span>,<span class="string">"分钟"</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">u"您已经建立了连接"</span> <span class="keyword">in</span> result:</span><br><span class="line">            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">u"您已经建立了连接,无需重复登陆"</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">u"用户不存在"</span> <span class="keyword">in</span> result:</span><br><span class="line">            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">u"用户不存在，请检查学号是否正确"</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">u"用户密码错误"</span> <span class="keyword">in</span> result:</span><br><span class="line">            pattern = re.compile(<span class="string">'&lt;td class="tWhite"&gt;.*?2553:(.*?)&lt;/b&gt;.*?&lt;/td&gt;'</span>, re.S)</span><br><span class="line">            res = re.search(pattern, result)</span><br><span class="line">            <span class="keyword">if</span> res:</span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(),res.group(<span class="number">1</span>),<span class="string">u"请重新修改密码"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">u"未知错误，请检查学号密码是否正确"</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过字符串匹配和正则表达式，我们分辨并提取出了上述五种情况。 增加循环检测 既然是检测网络是否断开，那么我们只需要每隔一段时间检测一下就好了，那就 10 秒吧。 因为这个 10 秒是可配置的，为了方便配置，统一配置到<strong>init</strong>方法里面。</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">#检测间隔时间，单位为秒</span></span><br><span class="line"><span class="attr">self.every</span> = <span class="number">10</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后，我们写一个循环来检测一下</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            nowIP = self.getIP()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> nowIP:</span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(), <span class="string">u"请检查是否正常连接QLSC_STU无线网络"</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(),<span class="string">u"成功连接了QLSC_STU网络,本机IP为"</span>,nowIP</span><br><span class="line">                self.login()</span><br><span class="line">                <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                    can_connect = self.canConnect()</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> can_connect:</span><br><span class="line">                        nowIP = self.getIP()</span><br><span class="line">                        <span class="keyword">if</span> <span class="keyword">not</span> nowIP:</span><br><span class="line">                            <span class="keyword">print</span> self.getCurrentTime(), <span class="string">u"当前已经断线，请确保连接上了QLSC_STU网络"</span></span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            <span class="keyword">print</span> self.getCurrentTime(), <span class="string">u"当前已经断线，正在尝试重新连接"</span></span><br><span class="line">                            self.login()</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">print</span> self.getCurrentTime(), <span class="string">u"当前网络连接正常"</span></span><br><span class="line">                    time.sleep(self.every)</span><br><span class="line">            time.sleep(self.every)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中我们用到了 canConnect 方法，这个就是检测网络是否已经断开的方法，我们可以利用 ping 百度的方法来检测一下。 方法实现如下</p>
                  <figure class="highlight livecodeserver">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">#判断当前是否可以联网</span></span><br><span class="line">    def canConnect(self):</span><br><span class="line">        fnull = <span class="built_in">open</span>(os.devnull, <span class="string">'w'</span>)</span><br><span class="line">        <span class="built_in">result</span> = subprocess.call(<span class="string">'ping www.baidu.com'</span>, <span class="built_in">shell</span> = True, <span class="keyword">stdout</span> = fnull, <span class="keyword">stderr</span> = fnull)</span><br><span class="line">        fnull.<span class="built_in">close</span>()</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">result</span>:</span><br><span class="line">            <span class="literal">return</span> False</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="literal">return</span> True</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好啦，所有的要点我们已经逐一击破，等着凯旋吧</p>
                  <h2 id="收拾战场"><a href="#收拾战场" class="headerlink" title="收拾战场"></a>收拾战场</h2>
                  <p>好了，所有的代码要点已经被我们攻破了，接下来就整理一下，让他们组合起来，变成一个应用程序吧。</p>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">__author__ = <span class="string">'CQC'</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> types</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Login</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#初始化</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment">#学号密码</span></span><br><span class="line">        self.username = <span class="string">'201200131012'</span></span><br><span class="line">        self.password = <span class="string">'XXXXXX'</span></span><br><span class="line">        <span class="comment">#山大无线STU的IP网段</span></span><br><span class="line">        self.ip_pre = <span class="string">'211.87'</span></span><br><span class="line">        <span class="comment">#登录时长</span></span><br><span class="line">        self.overtime = <span class="number">720</span></span><br><span class="line">        <span class="comment">#检测间隔时间，单位为秒</span></span><br><span class="line">        self.every = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#模拟登录</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> self.getCurrentTime(), <span class="string">u"正在尝试认证QLSC_STU无线网络"</span></span><br><span class="line">        ip = self.getIP()</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">"username"</span>: self.username,</span><br><span class="line">            <span class="string">"password"</span>: self.password,</span><br><span class="line">            <span class="string">"serverType"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"isSavePass"</span>: <span class="string">"on"</span>,</span><br><span class="line">            <span class="string">"Submit1"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"Language"</span>: <span class="string">"Chinese"</span>,</span><br><span class="line">            <span class="string">"ClientIP"</span>: self.getIP(),</span><br><span class="line">            <span class="string">"timeoutvalue"</span>: <span class="number">45</span>,</span><br><span class="line">            <span class="string">"heartbeat"</span>: <span class="number">240</span>,</span><br><span class="line">            <span class="string">"fastwebornot"</span>: <span class="literal">False</span>,</span><br><span class="line">            <span class="string">"StartTime"</span>: self.getNowTime(),</span><br><span class="line">            <span class="comment">#持续时间，超过这个时间自动掉线，可进行设置</span></span><br><span class="line">            <span class="string">"shkOvertime"</span>: self.overtime,</span><br><span class="line">            <span class="string">"strOSName"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"iAdptIndex"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strAdptName"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strAdptStdName"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strFileEncoding"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"PhysAddr"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"bDHCPEnabled"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strIPAddrArray"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strMaskArray"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strMask"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"iDHCPDelayTime"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"iDHCPTryTimes"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"strOldPrivateIP"</span>: self.getIP(),</span><br><span class="line">            <span class="string">"strOldPublicIP"</span>: self.getIP(),</span><br><span class="line">            <span class="string">"strPrivateIP"</span>: self.getIP(),</span><br><span class="line">            <span class="string">"PublicIP"</span>: self.getIP(),</span><br><span class="line">            <span class="string">"iIPCONFIG"</span>:<span class="number">0</span>,</span><br><span class="line">            <span class="string">"sHttpPrefix"</span>: <span class="string">"http://192.168.8.10"</span>,</span><br><span class="line">            <span class="string">"title"</span>: <span class="string">"CAMS Portal"</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">#消息头</span></span><br><span class="line">        headers = &#123;</span><br><span class="line">            <span class="string">'User-Agent'</span> : <span class="string">'Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/38.0.2125.111 Safari/537.36'</span>,</span><br><span class="line">            <span class="string">'Host'</span>: <span class="string">'192.168.8.10'</span>,</span><br><span class="line">            <span class="string">'Origin'</span>: <span class="string">'http://192.168.8.10'</span>,</span><br><span class="line">            <span class="string">'Referer'</span>: <span class="string">'http://192.168.8.10/portal/index_default.jsp?Language=Chinese'</span></span><br><span class="line">        &#125;</span><br><span class="line">        post_data = urllib.urlencode(data)</span><br><span class="line">        login_url = <span class="string">"http://192.168.8.10/portal/login.jsp?Flag=0"</span></span><br><span class="line">        request = urllib2.Request(login_url, post_data, headers)</span><br><span class="line">        response = urllib2.urlopen(request)</span><br><span class="line">        result = response.read().decode(<span class="string">'gbk'</span>)</span><br><span class="line">        self.getLoginResult(result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">#打印登录结果</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getLoginResult</span><span class="params">(self, result)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">u"用户上线成功"</span> <span class="keyword">in</span> result:</span><br><span class="line">            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">u"用户上线成功,在线时长为"</span>,self.overtime/<span class="number">60</span>,<span class="string">"分钟"</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">u"您已经建立了连接"</span> <span class="keyword">in</span> result:</span><br><span class="line">            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">u"您已经建立了连接,无需重复登陆"</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">u"用户不存在"</span> <span class="keyword">in</span> result:</span><br><span class="line">            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">u"用户不存在，请检查学号是否正确"</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">u"用户密码错误"</span> <span class="keyword">in</span> result:</span><br><span class="line">            pattern = re.compile(<span class="string">'&lt;td class="tWhite"&gt;.*?2553:(.*?)&lt;/b&gt;.*?&lt;/td&gt;'</span>, re.S)</span><br><span class="line">            res = re.search(pattern, result)</span><br><span class="line">            <span class="keyword">if</span> res:</span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(),res.group(<span class="number">1</span>),<span class="string">u"请重新修改密码"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">u"未知错误，请检查学号密码是否正确"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取当前时间戳，13位</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getNowTime</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> str(int(time.time()))+<span class="string">"000"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取本机无线IP</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getIP</span><span class="params">(self)</span>:</span></span><br><span class="line">        local_iP = socket.gethostbyname(socket.gethostname())</span><br><span class="line">        <span class="keyword">if</span> self.ip_pre <span class="keyword">in</span> str(local_iP):</span><br><span class="line">            <span class="keyword">return</span> str(local_iP)</span><br><span class="line">        ip_lists = socket.gethostbyname_ex(socket.gethostname())</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> ip_list <span class="keyword">in</span> ip_lists:</span><br><span class="line">            <span class="keyword">if</span> isinstance(ip_list, list):</span><br><span class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> ip_list:</span><br><span class="line">                    <span class="keyword">if</span> self.ip_pre <span class="keyword">in</span> str(i):</span><br><span class="line">                        <span class="keyword">return</span> str(i)</span><br><span class="line">            <span class="keyword">elif</span> type(ip_list) <span class="keyword">is</span> types.StringType:</span><br><span class="line">                <span class="keyword">if</span> self.ip_pre <span class="keyword">in</span> ip_list:</span><br><span class="line">                    <span class="keyword">return</span> ip_list</span><br><span class="line"></span><br><span class="line">    <span class="comment">#判断当前是否可以联网</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">canConnect</span><span class="params">(self)</span>:</span></span><br><span class="line">        fnull = open(os.devnull, <span class="string">'w'</span>)</span><br><span class="line">        result = subprocess.call(<span class="string">'ping www.baidu.com'</span>, shell = <span class="literal">True</span>, stdout = fnull, stderr = fnull)</span><br><span class="line">        fnull.close()</span><br><span class="line">        <span class="keyword">if</span> result:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取当前时间</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getCurrentTime</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> time.strftime(<span class="string">'[%Y-%m-%d %H:%M:%S]'</span>,time.localtime(time.time()))</span><br><span class="line"></span><br><span class="line">    <span class="comment">#主函数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> self.getCurrentTime(), <span class="string">u"您好，欢迎使用模拟登陆系统"</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            nowIP = self.getIP()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> nowIP:</span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(), <span class="string">u"请检查是否正常连接QLSC_STU无线网络"</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(),<span class="string">u"成功连接了QLSC_STU网络,本机IP为"</span>,nowIP</span><br><span class="line">                self.login()</span><br><span class="line">                <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                    can_connect = self.canConnect()</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> can_connect:</span><br><span class="line">                        nowIP = self.getIP()</span><br><span class="line">                        <span class="keyword">if</span> <span class="keyword">not</span> nowIP:</span><br><span class="line">                            <span class="keyword">print</span> self.getCurrentTime(), <span class="string">u"当前已经掉线，请确保连接上了QLSC_STU网络"</span></span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            <span class="keyword">print</span> self.getCurrentTime(), <span class="string">u"当前已经掉线，正在尝试重新连接"</span></span><br><span class="line">                            self.login()</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">print</span> self.getCurrentTime(), <span class="string">u"当前网络连接正常"</span></span><br><span class="line">                    time.sleep(self.every)</span><br><span class="line">            time.sleep(self.every)</span><br><span class="line"></span><br><span class="line">login = Login()</span><br><span class="line">login.main()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>来，我们来运行一下，看下效果吧！ 执行</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">python</span> login.<span class="keyword">py</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>当前是可以联网的，我分别在网页上操作执行了断开，操作，程序自动检测到掉线，自动重新连接。 接下来我直接断开了 QLSC_STU 网络的链接，程序同样检测到 QLSC_STU 这个热点没有连接上，提示用户链接。 接下来我重新连接上了这个热点，由于刚才已经登录上线，且持续时间较短，网络自动恢复正常。 下面是运行结果： <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150920205618.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150920205618.png" alt="20150920205618"></a> 嗯，这样我们就是实现了自动掉线的检测和模拟登录。</p>
                  <h2 id="凯旋而归"><a href="#凯旋而归" class="headerlink" title="凯旋而归"></a>凯旋而归</h2>
                  <p>咿呀伊尔哟，想约妹子上自习吗？那就赶紧来试试吧！一网在手，天下我有！追男神女神都不再是梦想！ 如果有问题，欢迎留言讨论，代码肯定有不完善的地方，仅供参考。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-09-20 21:01:06" itemprop="dateCreated datePublished" datetime="2015-09-20T21:01:06+08:00">2015-09-20</time>
                </span>
                <span id="/2083.html" class="post-meta-item leancloud_visitors" data-flag-title="Python爬虫实战三之实现山东大学无线网络掉线自动重连" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>8.7k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>8 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2076.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Other <i class="label-arrow"></i>
                  </a>
                  <a href="/2076.html" class="post-title-link" itemprop="url">浅谈CSRF攻击方式</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="CSRF是什么？"><a href="#CSRF是什么？" class="headerlink" title="CSRF是什么？"></a><strong>CSRF是什么？</strong></h2>
                  <p>CSRF（Cross-site request forgery），中文名称：跨站请求伪造，也被称为：one click attack/session riding，缩写为：CSRF/XSRF。</p>
                  <h2 id="CSRF可以做什么？"><a href="#CSRF可以做什么？" class="headerlink" title="CSRF可以做什么？"></a><strong>CSRF可以做什么？</strong></h2>
                  <p>你这可以这么理解CSRF攻击：攻击者盗用了你的身份，以你的名义发送恶意请求。CSRF能够做的事情包括：以你名义发送邮件，发消息，盗取你的账号，甚至于购买商品，虚拟货币转账……造成的问题包括：个人隐私泄露以及财产安全。</p>
                  <h2 id="CSRF漏洞现状"><a href="#CSRF漏洞现状" class="headerlink" title="CSRF漏洞现状"></a><strong>CSRF漏洞现状</strong></h2>
                  <p>CSRF这种攻击方式在2000年已经被国外的安全人员提出，但在国内，直到06年才开始被关注，08年，国内外的多个大型社区和交互网站分别爆出CSRF漏洞，如：NYTimes.com（纽约时报）、Metafilter（一个大型的BLOG网站），YouTube和百度HI……而现在，互联网上的许多站点仍对此毫无防备，以至于安全业界称CSRF为“沉睡的巨人”。</p>
                  <h2 id="CSRF的原理"><a href="#CSRF的原理" class="headerlink" title="CSRF的原理"></a><strong>CSRF的原理</strong></h2>
                  <p>下图简单阐述了CSRF攻击的思想： <img src="http://pic002.cnblogs.com/img/hyddd/200904/2009040916453171.jpg" alt=""> 从上图可以看出，要完成一次CSRF攻击，受害者必须依次完成两个步骤：</p>
                  <blockquote>
                    <p>　　1.登录受信任网站A，并在本地生成Cookie。 2.在不登出A的情况下，访问危险网站B。</p>
                  </blockquote>
                  <p>看到这里，你也许会说：“如果我不满足以上两个条件中的一个，我就不会受到CSRF的攻击”。是的，确实如此，但你不能保证以下情况不会发生：</p>
                  <blockquote>
                    <p>　　1.你不能保证你登录了一个网站后，不再打开一个tab页面并访问另外的网站。 2.你不能保证你关闭浏览器了后，你本地的Cookie立刻过期，你上次的会话已经结束。（事实上，关闭浏览器不能结束一个会话，但大多数人都会错误的认为关闭浏览器就等于退出登录/结束会话了……） 3.上图中所谓的攻击网站，可能是一个存在其他漏洞的可信任的经常被人访问的网站。</p>
                  </blockquote>
                  <p>上面大概地讲了一下CSRF攻击的思想，下面我将用几个例子详细说说具体的CSRF攻击，这里我以一个银行转账的操作作为例子（仅仅是例子，真实的银行网站没这么傻:&gt;）</p>
                  <h3 id="示例1："><a href="#示例1：" class="headerlink" title="示例1："></a><strong>示例1：</strong></h3>
                  <p>银行网站A，它以GET请求来完成银行转账的操作，如：<a href="http://www.mybank.com/Transfer.php?toBankId=11&amp;money=1000" target="_blank" rel="noopener">http://www.mybank.com/Transfer.php?toBankId=11&amp;money=1000</a> 危险网站B，它里面有一段HTML的代码如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">http://www.mybank.com/Transfer.php?toBankId</span>=<span class="string">11&amp;money</span>=<span class="string">1000</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>首先，你登录了银行网站A，然后访问危险网站B，噢，这时你会发现你的银行账户少了1000块…… 为什么会这样呢？原因是银行网站A违反了HTTP规范，使用GET请求更新资源。在访问危险网站B的之前，你已经登录了银行网站A，而B中的<img>以GET的方式请求第三方资源（这里的第三方就是指银行网站了，原本这是一个合法的请求，但这里被不法分子利用了），所以你的浏览器会带上你的银行网站A的Cookie发出Get请求，去获取资源“<a href="http://www.mybank.com/Transfer.php?toBankId=11&amp;money=1000”，结果银行网站服务器收到请求后，认为这是一个更新资源操作（转账操作），所以就立刻进行转账操作" target="_blank" rel="noopener">http://www.mybank.com/Transfer.php?toBankId=11&amp;money=1000”，结果银行网站服务器收到请求后，认为这是一个更新资源操作（转账操作），所以就立刻进行转账操作</a>……</p>
                  <h3 id="示例2："><a href="#示例2：" class="headerlink" title="　　示例2："></a>　　<strong>示例2：</strong></h3>
                  <p>为了杜绝上面的问题，银行决定改用POST请求完成转账操作。 银行网站A的WEB表单如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">　　<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"Transfer.php"</span> <span class="attr">method</span>=<span class="string">"POST"</span>&gt;</span></span><br><span class="line">　　　　<span class="tag">&lt;<span class="name">p</span>&gt;</span>ToBankId: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"toBankId"</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">　　　　<span class="tag">&lt;<span class="name">p</span>&gt;</span>Money: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"money"</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">　　　　<span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Transfer"</span> /&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">　　<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>后台处理页面Transfer.php如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">　　<span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">　　　　session_start();</span></span><br><span class="line"><span class="php">　　　　<span class="keyword">if</span> (<span class="keyword">isset</span>($_REQUEST[<span class="string">'toBankId'</span>] &amp;&amp;　<span class="keyword">isset</span>($_REQUEST[<span class="string">'money'</span>]))</span></span><br><span class="line"><span class="php">　　　　&#123;</span></span><br><span class="line"><span class="php">　　　　    buy_stocks($_REQUEST[<span class="string">'toBankId'</span>],　$_REQUEST[<span class="string">'money'</span>]);</span></span><br><span class="line"><span class="php">　　　　&#125;</span></span><br><span class="line"><span class="php">　　<span class="meta">?&gt;</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>危险网站B，仍然只是包含那句HTML代码：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">http://www.mybank.com/Transfer.php?toBankId</span>=<span class="string">11&amp;money</span>=<span class="string">1000</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>和示例1中的操作一样，你首先登录了银行网站A，然后访问危险网站B，结果…..和示例1一样，你再次没了1000块～T_T，这次事故的原因是：银行后台使用了$_REQUEST去获取请求的数据，而$_REQUEST既可以获取GET请求的数据，也可以获取POST请求的数据，这就造成了在后台处理程序无法区分这到底是GET请求的数据还是POST请求的数据。在PHP中，可以使用$_GET和$_POST分别获取GET请求和POST请求的数据。在JAVA中，用于获取请求数据request一样存在不能区分GET请求数据和POST数据的问题。</p>
                  <h3 id="示例3："><a href="#示例3：" class="headerlink" title="　　示例3："></a>　　<strong>示例3：</strong></h3>
                  <p>经过前面2个惨痛的教训，银行决定把获取请求数据的方法也改了，改用$_POST，只获取POST请求的数据，后台处理页面Transfer.php代码如下：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">　　<span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">　　　　session_start();</span></span><br><span class="line"><span class="php">　　　　<span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'toBankId'</span>] &amp;&amp;　<span class="keyword">isset</span>($_POST[<span class="string">'money'</span>]))</span></span><br><span class="line"><span class="php">　　　　&#123;</span></span><br><span class="line"><span class="php">　　　　    buy_stocks($_POST[<span class="string">'toBankId'</span>],　$_POST[<span class="string">'money'</span>]);</span></span><br><span class="line"><span class="php">　　　　&#125;</span></span><br><span class="line"><span class="php">　　<span class="meta">?&gt;</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然而，危险网站B与时俱进，它改了一下代码：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">　　<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">　　　　<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="actionscript">　　　　　　<span class="function"><span class="keyword">function</span> <span class="title">steal</span><span class="params">()</span></span></span></span><br><span class="line">　　　　　　&#123;</span><br><span class="line"><span class="javascript">          　　　　 iframe = <span class="built_in">document</span>.frames[<span class="string">"steal"</span>];</span></span><br><span class="line"><span class="actionscript">　　     　　      iframe.document.Submit(<span class="string">"transfer"</span>);</span></span><br><span class="line">　　　　　　&#125;</span><br><span class="line">　　　　<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">　　<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">　　<span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">"steal()"</span>&gt;</span></span><br><span class="line">　　　　<span class="tag">&lt;<span class="name">iframe</span> <span class="attr">name</span>=<span class="string">"steal"</span> <span class="attr">display</span>=<span class="string">"none"</span>&gt;</span></span><br><span class="line">　　　　　　<span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">name</span>=<span class="string">"transfer"</span>　<span class="attr">action</span>=<span class="string">"http://www.myBank.com/Transfer.php"</span>&gt;</span></span><br><span class="line">　　　　　　　　<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"toBankId"</span> <span class="attr">value</span>=<span class="string">"11"</span>&gt;</span></span><br><span class="line">　　　　　　　　<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"money"</span> <span class="attr">value</span>=<span class="string">"1000"</span>&gt;</span></span><br><span class="line">　　　　　　<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">　　　　<span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line">　　<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果用户仍是继续上面的操作，很不幸，结果将会是再次不见1000块……因为这里危险网站B暗地里发送了POST请求到银行! 总结一下上面3个例子，CSRF主要的攻击模式基本上是以上的3种，其中以第1,2种最为严重，因为触发条件很简单，一个<img>就可以了，而第3种比较麻烦，需要使用JavaScript，所以使用的机会会比前面的少很多，但无论是哪种情况，只要触发了CSRF攻击，后果都有可能很严重。 理解上面的3种攻击模式，其实可以看出，CSRF攻击是源于WEB的隐式身份验证机制！WEB的身份验证机制虽然可以保证一个请求是来自于某个用户的浏览器，但却无法保证该请求是用户批准发送的！</p>
                  <h2 id="CSRF的防御"><a href="#CSRF的防御" class="headerlink" title="CSRF的防御"></a><strong>CSRF的防御</strong></h2>
                  <p>我总结了一下看到的资料，CSRF的防御可以从服务端和客户端两方面着手，防御效果是从服务端着手效果比较好，现在一般的CSRF防御也都在服务端进行。</p>
                  <h3 id="1-服务端进行CSRF防御"><a href="#1-服务端进行CSRF防御" class="headerlink" title="　　1.服务端进行CSRF防御"></a>　　<strong>1.服务端进行CSRF防御</strong></h3>
                  <p>服务端的CSRF方式方法很多样，但总的思想都是一致的，就是在客户端页面增加伪随机数。 (1).Cookie Hashing(所有表单都包含同一个伪随机值)： 这可能是最简单的解决方案了，因为攻击者不能获得第三方的Cookie(理论上)，所以表单中的数据也就构造失败了:&gt;</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">　　<span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">　　　　<span class="comment">//构造加密的Cookie信息</span></span></span><br><span class="line"><span class="php">　　　　$value = “DefenseSCRF”;</span></span><br><span class="line"><span class="php">　　　　setcookie(”cookie”, $value, time()+<span class="number">3600</span>);</span></span><br><span class="line"><span class="php">　　<span class="meta">?&gt;</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在表单里增加Hash值，以认证这确实是用户发送的请求。</p>
                  <figure class="highlight django">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="xml">　　<span class="php"><span class="meta">&lt;?php</span></span></span></span><br><span class="line"><span class="xml">　　　　$hash = md5($_COOKIE['cookie']);</span></span><br><span class="line"><span class="xml">　　?&gt;</span></span><br><span class="line"><span class="xml">　　<span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">”POST”</span> <span class="attr">action</span>=<span class="string">”transfer.php”</span>&gt;</span></span></span><br><span class="line"><span class="xml">　　　　<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">”text”</span> <span class="attr">name</span>=<span class="string">”toBankId”</span>&gt;</span></span></span><br><span class="line"><span class="xml">　　　　<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">”text”</span> <span class="attr">name</span>=<span class="string">”money”</span>&gt;</span></span></span><br><span class="line"><span class="xml">　　　　<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">”hidden”</span> <span class="attr">name</span>=<span class="string">”hash”</span> <span class="attr">value</span>=<span class="string">”</span>&lt;?=<span class="string">$hash;?</span>&gt;</span>”&gt;</span></span><br><span class="line"><span class="xml">　　　　<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">”submit”</span> <span class="attr">name</span>=<span class="string">”submit”</span> <span class="attr">value</span>=<span class="string">”Submit”</span>&gt;</span></span></span><br><span class="line"><span class="xml">　　<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后在服务器端进行Hash值验证</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">      <span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">　　      <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'check'</span>])) &#123;</span></span><br><span class="line"><span class="php">     　　      $hash = md5($_COOKIE[<span class="string">'cookie'</span>]);</span></span><br><span class="line"><span class="php">          　　 <span class="keyword">if</span>($_POST[<span class="string">'check'</span>] == $hash) &#123;</span></span><br><span class="line"><span class="php">               　　 doJob();</span></span><br><span class="line"><span class="php">　　           &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">　　　　　　　　<span class="comment">//...</span></span></span><br><span class="line"><span class="php">          　　 &#125;</span></span><br><span class="line"><span class="php">　　      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">　　　　　　<span class="comment">//...</span></span></span><br><span class="line"><span class="php">　　      &#125;</span></span><br><span class="line"><span class="php">      <span class="meta">?&gt;</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这个方法个人觉得已经可以杜绝99%的CSRF攻击了，那还有1%呢….由于用户的Cookie很容易由于网站的XSS漏洞而被盗取，这就另外的1%。一般的攻击者看到有需要算Hash值，基本都会放弃了，某些除外，所以如果需要100%的杜绝，这个不是最好的方法。</p>
                  <h3 id="2-验证码"><a href="#2-验证码" class="headerlink" title="2.验证码"></a>2.验证码</h3>
                  <p>这个方案的思路是：每次的用户提交都需要用户在表单中填写一个图片上的随机字符串，厄….这个方案可以完全解决CSRF，但个人觉得在易用性方面似乎不是太好，还有听闻是验证码图片的使用涉及了一个被称为MHTML的Bug，可能在某些版本的微软IE中受影响。</p>
                  <h2 id="原文链接"><a href="#原文链接" class="headerlink" title="原文链接"></a>原文链接</h2>
                  <p>在网上发现这篇文章说得很明了，转载啦，非常感谢原作者的辛苦付出。 <a href="http://www.cnblogs.com/hyddd/archive/2009/04/09/1432744.html" target="_blank" rel="noopener">原文出处</a></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-09-17 23:08:41" itemprop="dateCreated datePublished" datetime="2015-09-17T23:08:41+08:00">2015-09-17</time>
                </span>
                <span id="/2076.html" class="post-meta-item leancloud_visitors" data-flag-title="浅谈CSRF攻击方式" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>4.4k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>4 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2057.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Other <i class="label-arrow"></i>
                  </a>
                  <a href="/2057.html" class="post-title-link" itemprop="url">怎样把你的SAE利用起来</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>博主没事就喜欢瞎倒腾，今天登录自己的 SAE 一看，很久之前挂的几个应用早已杳无人烟，才消耗几个云豆，真是觉得太浪费了。所以博主就瞎倒腾一下，准备好好利用起自己的云豆，尽可能地为我提供服务。 好了，废话不多说，让我们开始动起来！</p>
                  <h2 id="新建应用"><a href="#新建应用" class="headerlink" title="新建应用"></a>新建应用</h2>
                  <p>既然想利用好里面的服务，那么我们就需要新建一个专属应用，取个专属名称，那么我名字叫崔庆才，那就叫 cuiqingcai 好了，幸运的是，并没有同名应用，可以使用，不错不错。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150912153748.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150912153748.png" alt="20150912153748"></a></p>
                  <h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h2>
                  <p>SAE 上最近出了一种独享数据库，不像之前的数据库一样每建一个应用自动生成一个数据库，这个数据库就像平常我们用到的 phpMyAdmin 一样一样的。可以新建好多个数据库，可以远程连接，可以登录网页设置。 有了这个，如果你没有 VPS，也不需要去买个 RDS 来用啦！ <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150912152842.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150912152842.png" alt="20150912152842"></a> 首先建立好应用之后，到应用管理界面去，点击你的 MySQL，然后就会让你选择是哪一种数据库，右边的独享型 MySQL 是 SAE 新出的，功能也非常强，可以建立数据库，可以建用户，授权数据库，监控数据等等。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150912153909.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150912153909-1024x538.png" alt="20150912153909"></a> 点击独享型 MySQL，创建属于自己的数据库吧。创建好了，建立自己的账户，登进来，一切都是那么轻松加愉快，以后有什么需要数据库，扔到这里就好了。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150912154219.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150912154219-1024x432.png" alt="20150912154219"></a> 好，相信这个一定非常简单，小伙伴们快试一下吧！</p>
                  <h2 id="Storage"><a href="#Storage" class="headerlink" title="Storage"></a>Storage</h2>
                  <p>新浪云中提供了 SCS，也是一个云存储服务，但是费用太坑了，而且不是消耗云豆的，然而应用中的 Storage 是使用云豆的，如果不是什么私密存储的话，还是可以利用一下的。 在这里我想让它发挥 SCS 的作用并绑定到我的域名上，这样通过 scs.cuiqingcai.com 便可以访问了。 我们新建一个 Storage Domain <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150912155842.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150912155842-1024x368.png" alt="20150912155842"></a> 上传一张图片进去，比如 1.jpg，上传后访问一下 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150912160138.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150912160138.png" alt="20150912160138"></a> 恩，轻松加愉快！接下来，我发现这个域名简直太难记了，我要换成自己的域名，比如 scs.cuiqingcai.com 这样，图片就可以通过 scs.cuiqingcai.com/1.jpg 来访问了。那么怎么配置呢？</p>
                  <h3 id="1-绑定域名"><a href="#1-绑定域名" class="headerlink" title="1.绑定域名"></a>1.绑定域名</h3>
                  <p>到应用首页里面，点击域名绑定，SAE 会告诉你两条要解析的内容，自己设置一下 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150912160935.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150912160935.png" alt="20150912160935"></a> 接下来我们需要配置一下代码</p>
                  <h3 id="2-修改-config-yaml"><a href="#2-修改-config-yaml" class="headerlink" title="2.修改 config.yaml"></a>2.修改 config.yaml</h3>
                  <p>需要在代码管理中，更改一下 config.yaml 文件，让它做一个跳转。 比如我的代码中 config.yaml 文件就更改为</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="string">name:</span> cuiqingcai</span><br><span class="line"><span class="string">version:</span> <span class="number">1</span></span><br><span class="line"><span class="string">handle:</span></span><br><span class="line">	- <span class="string">rewrite:</span> <span class="keyword">if</span> (path ~ <span class="string">"/(.*)"</span>) goto <span class="string">"http://cuiqingcai-scs.stor.sinaapp.com/$1"</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其实就是加了一条 reweite 语句，把所有的路径定位到新地址的新路径中。 接下来，我访问一下 scs.cuiqingcai.com/1.jpg，嗯，图片出来了！这样，又一个免费的 CDN 建好了！ <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150912161437.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150912161437.png" alt="20150912161437"></a> 嗯，如果有什么图片需要存放，它会是你的一个非常好的选择！ 上传的话，SAE 提供了上传的客户端，大家可以自行下载尝试。 之后博主将研究一下怎样配置上传的接口，这样我们就可以通过程序来上传了，我也很期待呢！</p>
                  <h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2>
                  <p>以上是博主瞎倒腾的，可以为自己提供一些方便，大家尝试下吧，如有问题，欢迎留言交流！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-09-12 16:17:41" itemprop="dateCreated datePublished" datetime="2015-09-12T16:17:41+08:00">2015-09-12</time>
                </span>
                <span id="/2057.html" class="post-meta-item leancloud_visitors" data-flag-title="怎样把你的SAE利用起来" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.3k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/2036.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Linux <i class="label-arrow"></i>
                  </a>
                  <a href="/2036.html" class="post-title-link" itemprop="url">Ubuntu Linux配置Nginx+MySQL+PHP+phpMyAdmin详细步骤</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>博主之前一直用的是 apache，随着网站负荷量增高，感觉 apache 稍微有点力不从心了。随着 nginx 越来越流行，而且其功能强大，博主准备采用 nginx 作为自己的服务器啦。 每当到了环境配置的时候，博主便会去网上各种搜集资料，然而感觉他们讲的都条理不一，有的地方并不符合自己的配置习惯，所以博主习惯自己配置的同时把配置过程总结一下，方便自己，也方便大家。 好，接下来我们就开始我们的环境配置之旅吧。</p>
                  <h2 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h2>
                  <h3 id="1-更新源"><a href="#1-更新源" class="headerlink" title="1.更新源"></a>1.更新源</h3>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-<span class="keyword">get</span> <span class="keyword">update</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="2-安装-nginx"><a href="#2-安装-nginx" class="headerlink" title="2.安装 nginx"></a>2.安装 nginx</h3>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-<span class="builtin-name">get</span> install nginx</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="3-检查是否安装成功"><a href="#3-检查是否安装成功" class="headerlink" title="3.检查是否安装成功"></a>3.检查是否安装成功</h3>
                  <p>输入 localhost 或者远程地址，若出现 Welcome To Nginx 则证明安装成功。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150911144903.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150911144903.png" alt="20150911144903"></a> 如果没有看到，可以运行</p>
                  <figure class="highlight nginx">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">sudo</span> killall apache2</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>杀掉 apache 进程，因为可能 80 端口被占用了。</p>
                  <h3 id="4-更改运行目录"><a href="#4-更改运行目录" class="headerlink" title="4.更改运行目录"></a>4.更改运行目录</h3>
                  <p>默认的 nginx 目录是/usr/share/nginx/html，我们将其修改为/var/www，当然可以根据个人习惯灵活更改。 修改/etc/nginx/sites-available/default 文件</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">root <span class="regexp">/usr/</span>share<span class="regexp">/nginx/</span>html;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>更改为</p>
                  <figure class="highlight actionscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">root /<span class="keyword">var</span>/www</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>再将</p>
                  <figure class="highlight n1ql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">index</span> <span class="keyword">index</span>.html <span class="keyword">index</span>.htm;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>更改为</p>
                  <figure class="highlight n1ql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">index</span> <span class="keyword">index</span>.html <span class="keyword">index</span>.php <span class="keyword">index</span>.htm;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>重启 nginx</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo<span class="built_in"> service </span>nginx restart</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们在/var/www 目录下新建 index.html 文件，写入一些测试文字。 重新访问 localhost 或者远程地址，可以看到刚才设置的 index.html 文件中的内容，说明目录已经更改成功了。</p>
                  <h2 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h2>
                  <p>安装 PHP 以及相关扩展。</p>
                  <figure class="highlight smali">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-get install php5 php5-cgi php5-mysql php5-curl php5-gd php5-idn php-pear php5-imagick php5-imap php5-mcrypt php5-memcache php5-mhash php5-ming php5-pspell php5-recode php5-snmp php5-tidy php5-xmlrpc php5-sqlite php5-xsl</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>执行上述指令即可。 此时有的小伙伴想要测试运行 PHP 文件了，然而很悲剧地告诉你是不可以的，因为你还没有配置 fastcgi，继续往下看。</p>
                  <h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2>
                  <p>执行如下命令，安装 MySQL 服务端和客户端。</p>
                  <figure class="highlight sql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-get <span class="keyword">install</span> mysql-<span class="keyword">server</span> mysql-<span class="keyword">client</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在安装时可能提示你输入 root 用户的密码，设置即可。</p>
                  <h2 id="phpMyAdmin"><a href="#phpMyAdmin" class="headerlink" title="phpMyAdmin"></a>phpMyAdmin</h2>
                  <p>执行如下命令，安装 phpMyAdmin。</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-<span class="builtin-name">get</span> install phpmyadmin</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>创建软连接</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo ln -s <span class="regexp">/usr/</span>share<span class="regexp">/phpmyadmin/</span> <span class="regexp">/var/</span>www<span class="regexp">/phpmyadmin</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们将创建一个根目录为/var/www，链接名为 phpmyadmin 的文件，指向/usr/share/phpmyadmin</p>
                  <h2 id="spawn-fcgi"><a href="#spawn-fcgi" class="headerlink" title="spawn-fcgi"></a>spawn-fcgi</h2>
                  <h3 id="1-安装-fastcgi"><a href="#1-安装-fastcgi" class="headerlink" title="1.安装 fastcgi"></a>1.安装 fastcgi</h3>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo apt-<span class="builtin-name">get</span> install spawn-fcgi</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="2-配置-fastcgi"><a href="#2-配置-fastcgi" class="headerlink" title="2.配置 fastcgi"></a>2.配置 fastcgi</h3>
                  <p>修改 /etc/nginx/fastcgi_params 文件，增加下面一行</p>
                  <figure class="highlight nginx">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">fastcgi_param</span> SCRIPT_FILENAME <span class="variable">$document_root</span><span class="variable">$fastcgi_script_name</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>修改/etc/php5/cgi/php.ini 文件，将下面一行取消注释</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">cgi.fix_pathinfo</span>=<span class="number">1</span><span class="comment">;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样 php-cgi 方能正常使用 SCRIPT_FILENAME 这个变量 修改/etc/nginx/sites-available/default 文件，我们之前修改的目录地址是/var/www，将</p>
                  <figure class="highlight vala">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#location ~ \.php$ &#123;</span></span><br><span class="line"><span class="meta">#	fastcgi_split_path_info ^(.+\.php)(/.+)$;</span></span><br><span class="line"><span class="meta">#	# NOTE: You should have "cgi.fix_pathinfo = 0;" in php.ini</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#	# With php5-cgi alone:</span></span><br><span class="line"><span class="meta">#	fastcgi_pass 127.0.0.1:9000;</span></span><br><span class="line"><span class="meta">#	# With php5-fpm:</span></span><br><span class="line"><span class="meta">#	fastcgi_pass unix:/var/run/php5-fpm.sock;</span></span><br><span class="line"><span class="meta">#	fastcgi_index index.php;</span></span><br><span class="line"><span class="meta">#	include fastcgi_params;</span></span><br><span class="line"><span class="meta">#&#125;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>修改为</p>
                  <figure class="highlight nginx">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">location</span> <span class="regexp">~ \.php$</span> &#123;</span><br><span class="line"><span class="comment">#	fastcgi_split_path_info ^(.+\.php)(/.+)$;</span></span><br><span class="line"><span class="comment">#	# <span class="doctag">NOTE:</span> You should have "cgi.fix_pathinfo = 0;" in php.ini</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#	# With php5-cgi alone:</span></span><br><span class="line">	<span class="attribute">fastcgi_pass</span> <span class="number">127.0.0.1:9000</span>;</span><br><span class="line"><span class="comment">#	# With php5-fpm:</span></span><br><span class="line"><span class="comment">#	fastcgi_pass unix:/var/run/php5-fpm.sock;</span></span><br><span class="line">	<span class="attribute">fastcgi_index</span> index.php;</span><br><span class="line">	<span class="attribute">fastcgi_param</span> SCRIPT_FILENAME /var/www<span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">	<span class="attribute">include</span> fastcgi_params;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="3-开启-fastcgi-进程"><a href="#3-开启-fastcgi-进程" class="headerlink" title="3.开启 fastcgi 进程"></a>3.开启 fastcgi 进程</h3>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo /usr/bin/spawn-fcgi -a <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> -p <span class="number">9000</span> -C <span class="number">5</span> -u www-data -g www-data -f /usr/bin/php5-cgi -P /var/run/fastcgi-php.pid</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>参数含义如下</p>
                  <blockquote>
                    <p><em> -f 指定调用 FastCGI 的进程的执行程序位置，根据系统上所装的 PHP 的情况具体设置 </em> -a 绑定到地址 addr <em> -p 绑定到端口 port </em> -s 绑定到 unix socket 的路径 path <em> -C 指定产生的 FastCGI 的进程数，默认为 5（仅用于 PHP） </em> -P 指定产生的进程的 PID 文件路径 * -u 和-g FastCGI 使用什么身份（-u 用户 -g 用户组）运行，Ubuntu 下可以使用 www-data,其他的根据情况配置，如 nobody、apache 等现在可以在 web 根目录下放个探针或 php 文件测试一下了</p>
                  </blockquote>
                  <p>运行结果类似如下</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">spawn-<span class="string">fcgi:</span> child spawned <span class="string">successfully:</span> <span class="string">PID:</span> <span class="number">11775</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="4-设置开机启动-fastcgi"><a href="#4-设置开机启动-fastcgi" class="headerlink" title="4.设置开机启动 fastcgi"></a>4.设置开机启动 fastcgi</h3>
                  <p>修改/etc/rc.local 文件，添加下面一行</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">/usr/bin/spawn-fcgi -a <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> -p <span class="number">9000</span> -C <span class="number">5</span> -u www-data -g www-data -f /usr/bin/php5-cgi -P /var/run/fastcgi-php.pid</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>修改完之后，重启 nginx</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo<span class="built_in"> service </span>nginx restart</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们可以在/var/www 目录下新建 index.php 文件测试运行，发现已经可以运行 PHP 文件了。</p>
                  <h2 id="测试运行"><a href="#测试运行" class="headerlink" title="测试运行"></a>测试运行</h2>
                  <p>所有配置已经完毕，现在我们输入 localhost 和 localhost/phpmyadmin 便可以轻松加愉快地访问了。 如有问题，欢迎交流。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-09-11 15:23:36" itemprop="dateCreated datePublished" datetime="2015-09-11T15:23:36+08:00">2015-09-11</time>
                </span>
                <span id="/2036.html" class="post-meta-item leancloud_visitors" data-flag-title="Ubuntu Linux配置Nginx+MySQL+PHP+phpMyAdmin详细步骤" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.9k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1972.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Python <i class="label-arrow"></i>
                  </a>
                  <a href="/1972.html" class="post-title-link" itemprop="url">Python爬虫实战六之抓取爱问知识人问题并保存至数据库</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="2022-年最新-Python3-网络爬虫教程"><a href="#2022-年最新-Python3-网络爬虫教程" class="headerlink" title="2022 年最新 Python3 网络爬虫教程"></a>2022 年最新 Python3 网络爬虫教程</h2>
                  <p>大家好，我是崔庆才，由于爬虫技术不断迭代升级，一些旧的教程已经过时、案例已经过期，最前沿的爬虫技术比如异步、JavaScript 逆向、安卓逆向、智能解析、WebAssembly、大规模分布式、Kubernetes 等技术层出不穷，我最近新出了一套最新最全面的 Python3 网络爬虫系列教程。</p>
                  <blockquote>
                    <p>博主自荐：截止 2022 年，可以将最前沿最全面的爬虫技术都涵盖的教程，如异步、JavaScript 逆向、安卓逆向、智能解析、WebAssembly、大规模分布式、Kubernetes 等，市面上目前就这一套了。</p>
                  </blockquote>
                  <p>最新教程对旧的爬虫技术内容进行了全面更新，搭建了全新的案例平台进行全面讲解，保证案例稳定有效不过期。</p>
                  <p>教程请移步：</p>
                  <p><a href="https://cuiqingcai.com/17777.html">【2022 版】Python3 网络爬虫学习教程</a></p>
                  <p>如下为原文。</p>
                  <p>大家好，本次为大家带来的是抓取爱问知识人的问题并将问题和答案保存到数据库的方法，涉及的内容包括：</p>
                  <ul>
                    <li>Urllib 的用法及异常处理</li>
                    <li>Beautiful Soup 的简单应用</li>
                    <li>MySQLdb 的基础用法</li>
                    <li>正则表达式的简单应用</li>
                  </ul>
                  <h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2>
                  <p>在这之前，我们需要先配置一下环境，我的 Python 的版本为 2.7，需要额外安装的库有两个，一个是 Beautiful Soup，一个是 MySQLdb，在这里附上两个库的下载地址， <a href="https://pypi.python.org/pypi/beautifulsoup4/4.3.2" target="_blank" rel="noopener">Beautiful Soup</a> <a href="http://sourceforge.net/projects/mysql-python/" target="_blank" rel="noopener">MySQLdb</a> 大家可以下载之后通过如下命令安装</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">python</span> setup.<span class="keyword">py</span> install</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>环境配置好之后，我们便可以开心地撸爬虫了</p>
                  <h2 id="框架思路"><a href="#框架思路" class="headerlink" title="框架思路"></a>框架思路</h2>
                  <p>首先我们随便找一个分类地址，<a href="http://iask.sina.com.cn/c/978-all-1.html" target="_blank" rel="noopener">外语学习 - 爱问知识人</a>，打开之后可以看到一系列的问题列表。 我们在这个页面需要获取的东西有： 总的页码数，每一页的所有问题链接。 接下来我们需要遍历所有的问题，来抓取每一个详情页面，提取问题，问题内容，回答者，回答时间，回答内容。 最后，我们需要把这些内容存储到数据库中。</p>
                  <h2 id="要点简析"><a href="#要点简析" class="headerlink" title="要点简析"></a>要点简析</h2>
                  <p>其实大部分内容相信大家会了前面的内容，这里的爬虫思路已经融汇贯通了，这里就说一下一些扩展的功能</p>
                  <h3 id="1-日志输出"><a href="#1-日志输出" class="headerlink" title="1.日志输出"></a>1.日志输出</h3>
                  <p>日志输出，我们要输出时间和爬取的状态，比如像下面这样：</p>
                  <blockquote>
                    <p>[2015-08-10 03:05:20] 113011 号问题存在其他答案 我个人认为应该是樱桃沟很美的 [2015-08-10 03:05:20] 保存到数据库,此问题的 ID 为 113011 [2015-08-10 03:05:20] 当前爬取第 2 的内容,发现一个问题 百度有一个地方，花儿带着芳香，水儿流淌奔腾是什么意思 多多帮忙哦 回答数量 1 [2015-08-10 03:05:19] 保存到数据库,此问题的 ID 为 113010</p>
                  </blockquote>
                  <p>所以，我们需要引入时间函数，然后写一个获取当前时间的函数</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">import</span> <span class="type">time</span></span><br><span class="line"></span><br><span class="line">#获取当前时间</span><br><span class="line">def getCurrentTime(self):</span><br><span class="line">    <span class="keyword">return</span> <span class="type">time</span>.strftime(<span class="string">'[%Y-%m-%d %H:%M:%S]'</span>,<span class="type">time</span>.<span class="built_in">localtime</span>(<span class="type">time</span>.time()))</span><br><span class="line"></span><br><span class="line">#获取当前时间</span><br><span class="line">def getCurrentDate(self):</span><br><span class="line">    <span class="keyword">return</span> <span class="type">time</span>.strftime(<span class="string">'%Y-%m-%d'</span>,<span class="type">time</span>.<span class="built_in">localtime</span>(<span class="type">time</span>.time()))</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上分别是获取带具体时间和获取日期的函数，在输出时，我们可以在输出语句的前面调用这函数即可。 然后我们需要将缓冲区设置输出到 log 中，在程序的最前面加上这两句即可</p>
                  <figure class="highlight ini">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">f_handler</span>=open(<span class="string">'out.log'</span>, <span class="string">'w'</span>)</span><br><span class="line"><span class="attr">sys.stdout</span>=f_handler</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样，所有的 print 语句输出的内容就会保存到 out.log 文件中了。</p>
                  <h3 id="2-页码保存"><a href="#2-页码保存" class="headerlink" title="2.页码保存"></a>2.页码保存</h3>
                  <p>爬虫爬取过程中可能出现各种各样的错误，这样会导致爬虫的中断，如果我们重新运行爬虫，那么就会导致爬虫从头开始运行了，这样显然是不合理的。所以，我们需要把当前爬取的页面保存下来，比如可以保存到文本中，假如爬虫中断了，重新运行爬虫，读取文本文件的内容，接着爬取即可。 大家可以稍微参考一下函数的实现：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">#主函数</span></span><br><span class="line">def main(self):</span><br><span class="line">    <span class="attribute">f_handler</span>=open('out.log', <span class="string">'w'</span>)</span><br><span class="line">    sys.<span class="attribute">stdout</span>=f_handler</span><br><span class="line">   <span class="built_in"> page </span>= open(<span class="string">'page.txt'</span>, <span class="string">'r'</span>)</span><br><span class="line">    content = page.readline()</span><br><span class="line">    start_page = int(content.strip()) - 1</span><br><span class="line">    page.close()</span><br><span class="line">    <span class="builtin-name">print</span> self.getCurrentTime(),<span class="string">"开始页码"</span>,start_page</span><br><span class="line">    <span class="builtin-name">print</span> self.getCurrentTime(),<span class="string">"爬虫正在启动,开始爬取爱问知识人问题"</span></span><br><span class="line">    self.total_num = self.getTotalPageNum()</span><br><span class="line">    <span class="builtin-name">print</span> self.getCurrentTime(),<span class="string">"获取到目录页面个数"</span>,self.total_num,<span class="string">"个"</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> start_page:</span><br><span class="line">        start_page = self.total_num</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> range(1,start_page):</span><br><span class="line">        <span class="builtin-name">print</span> self.getCurrentTime(),<span class="string">"正在抓取第"</span>,start_page-x+1,<span class="string">"个页面"</span></span><br><span class="line">        try:</span><br><span class="line">            self.getQuestions(start_page-x+1)</span><br><span class="line">        except urllib2.URLError, e:</span><br><span class="line">            <span class="keyword">if</span> hasattr(e, <span class="string">"reason"</span>):</span><br><span class="line">                <span class="builtin-name">print</span> self.getCurrentTime(),<span class="string">"某总页面内抓取或提取失败,错误原因"</span>, e.reason</span><br><span class="line">        except Exception,e:</span><br><span class="line">            <span class="builtin-name">print</span> self.getCurrentTime(),<span class="string">"某总页面内抓取或提取失败,错误原因:"</span>,e</span><br><span class="line">        <span class="keyword">if</span> start_page-x+1 &lt; start_page:</span><br><span class="line">            <span class="attribute">f</span>=open('page.txt','w')</span><br><span class="line">            f.write(str(start_page-x+1))</span><br><span class="line">            <span class="builtin-name">print</span> self.getCurrentTime(),<span class="string">"写入新页码"</span>,start_page-x+1</span><br><span class="line">            f.close()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样，不管我们爬虫中途遇到什么错误，妈妈也不会担心了</p>
                  <h3 id="3-页面处理"><a href="#3-页面处理" class="headerlink" title="3.页面处理"></a>3.页面处理</h3>
                  <p>页面处理过程中，我们可能遇到各种各样奇葩的 HTML 代码，和上一节一样，我们沿用一个页面处理类即可。</p>
                  <figure class="highlight vbnet">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">import re</span><br><span class="line"></span><br><span class="line"><span class="meta">#处理页面标签类</span></span><br><span class="line"><span class="keyword">class</span> Tool:</span><br><span class="line"></span><br><span class="line">    <span class="meta">#将超链接广告剔除</span></span><br><span class="line">    removeADLink = re.compile(<span class="comment">'<span class="doctag">&lt;div class="link_layer.*?&lt;/div&gt;</span>')</span></span><br><span class="line">    <span class="meta">#去除img标签,1-7位空格,&amp;nbsp;</span></span><br><span class="line">    removeImg = re.compile(<span class="comment">'<span class="doctag">&lt;img.*?&gt;</span>| &#123;1,7&#125;|&amp;nbsp;')</span></span><br><span class="line">    <span class="meta">#删除超链接标签</span></span><br><span class="line">    removeAddr = re.compile(<span class="comment">'<span class="doctag">&lt;a.*?&gt;</span>|<span class="doctag">&lt;/a&gt;</span>')</span></span><br><span class="line">    <span class="meta">#把换行的标签换为\n</span></span><br><span class="line">    replaceLine = re.compile(<span class="comment">'<span class="doctag">&lt;tr&gt;</span>|<span class="doctag">&lt;div&gt;</span>|<span class="doctag">&lt;/div&gt;</span>|<span class="doctag">&lt;/p&gt;</span>')</span></span><br><span class="line">    <span class="meta">#将表格制表&lt;td&gt;替换为\t</span></span><br><span class="line">    replaceTD= re.compile(<span class="comment">'<span class="doctag">&lt;td&gt;</span>')</span></span><br><span class="line">    <span class="meta">#将换行符或双换行符替换为\n</span></span><br><span class="line">    replaceBR = re.compile(<span class="comment">'<span class="doctag">&lt;br&gt;</span><span class="doctag">&lt;br&gt;</span>|<span class="doctag">&lt;br&gt;</span>')</span></span><br><span class="line">    <span class="meta">#将其余标签剔除</span></span><br><span class="line">    removeExtraTag = re.compile(<span class="comment">'<span class="doctag">&lt;.*?&gt;</span>')</span></span><br><span class="line">    <span class="meta">#将多行空行删除</span></span><br><span class="line">    removeNoneLine = re.compile(<span class="comment">'\n+')</span></span><br><span class="line"></span><br><span class="line">    def replace(self,x):</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeADLink,<span class="string">""</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeImg,<span class="string">""</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeAddr,<span class="string">""</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.replaceLine,<span class="string">"\n"</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.replaceTD,<span class="string">"\t"</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.replaceBR,<span class="string">"\n"</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeExtraTag,<span class="string">""</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeNoneLine,<span class="string">"\n"</span>,x)</span><br><span class="line">        <span class="meta">#strip()将前后多余内容删除</span></span><br><span class="line">        <span class="keyword">return</span> x.strip()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们可以用一段含有 HTML 代码的文字，经过调用 replace 方法之后，各种冗余的 HTML 代码就会处理好了。 比如我们这么一段代码：</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;article <span class="class"><span class="keyword">class</span></span>=<span class="string">"article-content"</span>&gt;</span><br><span class="line">&lt;h2&gt;前言&lt;<span class="regexp">/h2&gt;</span></span><br><span class="line"><span class="regexp">&lt;p&gt;最近发现MySQL服务隔三差五就会挂掉，导致我的网站和爬虫都无法正常运作。自己的网站是基于MySQL，在做爬虫存取一些资料的时候也是基于MySQL，数据量一大了，MySQL它就有点受不了了，时不时会崩掉，虽然我自己有网站监控和邮件通知，但是好多时候还是需要我来手动连接我的服务器重新启动一下我的MySQL，这样简直太不友好了，所以，我就觉定自己写个脚本，定时监控它，如果发现它挂掉了就重启它。&lt;/</span>p&gt;</span><br><span class="line">&lt;p&gt;好了，闲言碎语不多讲，开始我们的配置之旅。&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">&lt;p&gt;运行环境：&lt;strong&gt;Ubuntu Linux 14.04&lt;/</span>strong&gt;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">&lt;h2&gt;编写Shell脚本&lt;/</span>h2&gt;</span><br><span class="line">&lt;p&gt;首先，我们要编写一个shell脚本，脚本主要执行的逻辑如下：&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">&lt;p&gt;显示mysqld进程状态，如果判断进程未在运行，那么输出日志到文件，然后启动mysql服务，如果进程在运行，那么不执行任何操作，可以选择性输出监测结果。&lt;/</span>p&gt;</span><br><span class="line">&lt;p&gt;可能大家对于shell脚本比较陌生，在这里推荐官方的shell脚本文档来参考一下&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">&lt;p&gt;&lt;a href="http:/</span><span class="regexp">/wiki.ubuntu.org.cn/</span>Shell%E7%BC%<span class="number">96</span>%E7%A8%<span class="number">8</span>B%E5%<span class="number">9</span>F%BA%E7%A1%<span class="number">80</span><span class="string">" data-original-title="</span><span class="string">" title="</span><span class="string">"&gt;Ubuntu Shell 编程基础&lt;/a&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;p&gt;shell脚本的后缀为sh，在任何位置新建一个脚本文件，我选择在 /etc/mysql 目录下新建一个 listen.sh 文件。&lt;/p&gt;</span></span><br><span class="line"><span class="string">&lt;p&gt;执行如下命令：&lt;/p&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>经过处理后便会变成如下的样子：</p>
                  <figure class="highlight dockerfile">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">前言</span><br><span class="line">最近发现MySQL服务隔三差五就会挂掉，导致我的网站和爬虫都无法正常运作。自己的网站是基于MySQL，在做爬虫存取一些资料的时候也是基于MySQL，数据量一大了，MySQL它就有点受不了了，时不时会崩掉，虽然我自己有网站监控和邮件通知，但是好多时候还是需要我来手动连接我的服务器重新启动一下我的MySQL，这样简直太不友好了，所以，我就觉定自己写个脚本，定时监控它，如果发现它挂掉了就重启它。</span><br><span class="line">好了，闲言碎语不多讲，开始我们的配置之旅。</span><br><span class="line">运行环境：UbuntuLinux14.<span class="number">04</span></span><br><span class="line">编写<span class="keyword">Shell</span><span class="bash">脚本</span></span><br><span class="line">首先，我们要编写一个<span class="keyword">shell</span><span class="bash">脚本，脚本主要执行的逻辑如下：</span></span><br><span class="line">显示mysqld进程状态，如果判断进程未在运行，那么输出日志到文件，然后启动mysql服务，如果进程在运行，那么不执行任何操作，可以选择性输出监测结果。</span><br><span class="line">可能大家对于<span class="keyword">shell</span><span class="bash">脚本比较陌生，在这里推荐官方的shell脚本文档来参考一下</span></span><br><span class="line">UbuntuShell编程基础</span><br><span class="line"><span class="keyword">shell</span><span class="bash">脚本的后缀为sh，在任何位置新建一个脚本文件，我选择在/etc/mysql目录下新建一个listen.sh文件。</span></span><br><span class="line">执行如下命令：</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>经过上面的处理，所有乱乱的代码都会被处理好了。</p>
                  <h3 id="4-保存到数据库"><a href="#4-保存到数据库" class="headerlink" title="4.保存到数据库"></a>4.保存到数据库</h3>
                  <p>在这里，我们想实现一个通用的方法，就是把存储的一个个内容变成字典的形式，然后执行插入语句的时候，自动构建对应的 sql 语句，插入数据。 比如我们构造如下的字典：</p>
                  <figure class="highlight prolog">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">#构造最佳答案的字典</span><br><span class="line">good_ans_dict = &#123;</span><br><span class="line">        <span class="string">"text"</span>: good_ans[<span class="number">0</span>],</span><br><span class="line">        <span class="string">"answerer"</span>: good_ans[<span class="number">1</span>],</span><br><span class="line">        <span class="string">"date"</span>: good_ans[<span class="number">2</span>],</span><br><span class="line">        <span class="string">"is_good"</span>: str(good_ans[<span class="number">3</span>]),</span><br><span class="line">        <span class="string">"question_id"</span>: str(insert_id)</span><br><span class="line">        &#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>构造 sql 语句并插入到数据库的方法如下：</p>
                  <figure class="highlight php">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">#插入数据</span></span><br><span class="line">    def insertData(<span class="keyword">self</span>, table, my_dict):</span><br><span class="line">         <span class="keyword">try</span>:</span><br><span class="line">             <span class="keyword">self</span>.db.set_character_set(<span class="string">'utf8'</span>)</span><br><span class="line">             cols = <span class="string">', '</span>.join(my_dict.keys())</span><br><span class="line">             values = <span class="string">'"," '</span>.join(my_dict.values())</span><br><span class="line">             sql = <span class="string">"INSERT INTO %s (%s) VALUES (%s)"</span> % (table, cols, <span class="string">'"'</span>+values+<span class="string">'"'</span>)</span><br><span class="line">             <span class="keyword">try</span>:</span><br><span class="line">                 result = <span class="keyword">self</span>.cur.execute(sql)</span><br><span class="line">                 insert_id = <span class="keyword">self</span>.db.insert_id()</span><br><span class="line">                 <span class="keyword">self</span>.db.commit()</span><br><span class="line">                 <span class="comment">#判断是否执行成功</span></span><br><span class="line">                 <span class="keyword">if</span> result:</span><br><span class="line">                     <span class="keyword">return</span> insert_id</span><br><span class="line">                 <span class="keyword">else</span>:</span><br><span class="line">                     <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">             except MySQLdb.Error,e:</span><br><span class="line">                 <span class="comment">#发生错误时回滚</span></span><br><span class="line">                 <span class="keyword">self</span>.db.rollback()</span><br><span class="line">                 <span class="comment">#主键唯一，无法插入</span></span><br><span class="line">                 <span class="keyword">if</span> <span class="string">"key 'PRIMARY'"</span> in e.args[<span class="number">1</span>]:</span><br><span class="line">                     <span class="keyword">print</span> <span class="keyword">self</span>.getCurrentTime(),<span class="string">"数据已存在，未插入数据"</span></span><br><span class="line">                 <span class="keyword">else</span>:</span><br><span class="line">                     <span class="keyword">print</span> <span class="keyword">self</span>.getCurrentTime(),<span class="string">"插入数据失败，原因 %d: %s"</span> % (e.args[<span class="number">0</span>], e.args[<span class="number">1</span>])</span><br><span class="line">         except MySQLdb.Error,e:</span><br><span class="line">             <span class="keyword">print</span> <span class="keyword">self</span>.getCurrentTime(),<span class="string">"数据库错误，原因%d: %s"</span> % (e.args[<span class="number">0</span>], e.args[<span class="number">1</span>])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们只需要传入那个字典，便会构建出对应字典键值和键名的 sql 语句，完成插入。</p>
                  <h3 id="5-PHP-读取日志"><a href="#5-PHP-读取日志" class="headerlink" title="5.PHP 读取日志"></a>5.PHP 读取日志</h3>
                  <p>我们将运行结果输出到了日志里，那么怎么查看日志呢？很简单，在这里提供两种方法 方法一： PHP 倒序输出所有日志内容</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"refresh"</span> <span class="attr">content</span> = <span class="string">"5"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">            $fp = file(<span class="string">"out.log"</span>);</span></span><br><span class="line"><span class="php">            <span class="keyword">if</span> ($fp) &#123;</span></span><br><span class="line"><span class="php">                <span class="keyword">for</span>($i = count($fp) - <span class="number">1</span>;$i &gt;= <span class="number">0</span>; $i --)</span></span><br><span class="line"><span class="php">                <span class="keyword">echo</span> $fp[$i].<span class="string">"&lt;br&gt;"</span>;</span></span><br><span class="line"><span class="php">            &#125;</span></span><br><span class="line"><span class="php">        <span class="meta">?&gt;</span></span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>此方法可以看到所有的输入日志，但是如果日志太大了，那么就会报耗费内存太大，无法输出。为此我们就有了第二种方法，利用 linux 命令，输出后十行内容。 方法二：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"refresh"</span> <span class="attr">content</span> = <span class="string">"5"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		<span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">			$ph = popen(<span class="string">'tail -n 100 out.log'</span>,<span class="string">'r'</span>);</span></span><br><span class="line"><span class="php">			<span class="keyword">while</span>($r = fgets($ph))&#123;</span></span><br><span class="line"><span class="php">				<span class="keyword">echo</span> $r.<span class="string">"&lt;br&gt;"</span>;</span></span><br><span class="line"><span class="php">			&#125;</span></span><br><span class="line"><span class="php">			pclose($ph);</span></span><br><span class="line"><span class="php">		<span class="meta">?&gt;</span></span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>上面两种方法都是 5 秒刷新一次网页来查看最新的日志。</p>
                  <h2 id="源代码放送"><a href="#源代码放送" class="headerlink" title="源代码放送"></a>源代码放送</h2>
                  <p>好了，闲言碎语不多讲，直接上源码了</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">spider</span><span class="selector-class">.py</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight python">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> types</span><br><span class="line"><span class="keyword">import</span> page</span><br><span class="line"><span class="keyword">import</span> mysql</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Spider</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#初始化</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.page_num = <span class="number">1</span></span><br><span class="line">        self.total_num = <span class="literal">None</span></span><br><span class="line">        self.page_spider = page.Page()</span><br><span class="line">        self.mysql = mysql.Mysql()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取当前时间</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getCurrentTime</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> time.strftime(<span class="string">'[%Y-%m-%d %H:%M:%S]'</span>,time.localtime(time.time()))</span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取当前时间</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getCurrentDate</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> time.strftime(<span class="string">'%Y-%m-%d'</span>,time.localtime(time.time()))</span><br><span class="line"></span><br><span class="line">    <span class="comment">#通过网页的页码数来构建网页的URL</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getPageURLByNum</span><span class="params">(self, page_num)</span>:</span></span><br><span class="line">        page_url = <span class="string">"http://iask.sina.com.cn/c/978-all-"</span> + str(page_num) + <span class="string">".html"</span></span><br><span class="line">        <span class="keyword">return</span> page_url</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">#通过传入网页页码来获取网页的HTML</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getPageByNum</span><span class="params">(self, page_num)</span>:</span></span><br><span class="line">        request = urllib2.Request(self.getPageURLByNum(page_num))</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            response = urllib2.urlopen(request)</span><br><span class="line">        <span class="keyword">except</span> urllib2.URLError, e:</span><br><span class="line">            <span class="keyword">if</span> hasattr(e, <span class="string">"code"</span>):</span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"获取页面失败,错误代号"</span>, e.code</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">            <span class="keyword">if</span> hasattr(e, <span class="string">"reason"</span>):</span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"获取页面失败,原因"</span>, e.reason</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            page =  response.read().decode(<span class="string">"utf-8"</span>)</span><br><span class="line">            <span class="keyword">return</span> page</span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取所有的页码数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getTotalPageNum</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"正在获取目录页面个数,请稍候"</span></span><br><span class="line">        page = self.getPageByNum(<span class="number">1</span>)</span><br><span class="line">        <span class="comment">#匹配所有的页码数,\u4e0b\u4e00\u9875是下一页的UTF8编码</span></span><br><span class="line">        pattern = re.compile(<span class="string">u'&lt;span class="more".*?&gt;.*?&lt;span.*?&lt;a href.*?class=""&gt;(.*?)&lt;/a&gt;\s*&lt;a.*?\u4e0b\u4e00\u9875&lt;/a&gt;'</span>, re.S)</span><br><span class="line">        match = re.search(pattern, page)</span><br><span class="line">        <span class="keyword">if</span> match:</span><br><span class="line">            <span class="keyword">return</span> match.group(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"获取总页码失败"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#分析问题的代码,得到问题的提问者,问题内容,回答个数,提问时间</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getQuestionInfo</span><span class="params">(self, question)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> type(question) <span class="keyword">is</span> types.StringType:</span><br><span class="line">            question = str(question)</span><br><span class="line">        <span class="comment">#print question</span></span><br><span class="line">        pattern = re.compile(<span class="string">u'&lt;span.*?question-face.*?&gt;.*?&lt;img.*?alt="(.*?)".*?&lt;/span&gt;.*?&lt;a href="(.*?)".*?&gt;(.*?)&lt;/a&gt;.*?answer_num.*?&gt;(\d*).*?&lt;/span&gt;.*?answer_time.*?&gt;(.*?)&lt;/span&gt;'</span>, re.S)</span><br><span class="line">        match = re.search(pattern, question)</span><br><span class="line">        <span class="keyword">if</span> match:</span><br><span class="line">            <span class="comment">#获得提问者</span></span><br><span class="line">            author = match.group(<span class="number">1</span>)</span><br><span class="line">            <span class="comment">#问题链接</span></span><br><span class="line">            href = match.group(<span class="number">2</span>)</span><br><span class="line">            <span class="comment">#问题详情</span></span><br><span class="line">            text = match.group(<span class="number">3</span>)</span><br><span class="line">            <span class="comment">#回答个数</span></span><br><span class="line">            ans_num = match.group(<span class="number">4</span>)</span><br><span class="line">            <span class="comment">#回答时间</span></span><br><span class="line">            time = match.group(<span class="number">5</span>)</span><br><span class="line">            time_pattern = re.compile(<span class="string">'\d&#123;4&#125;\-\d&#123;2&#125;\-\d&#123;2&#125;'</span>, re.S)</span><br><span class="line">            time_match = re.search(time_pattern, time)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> time_match:</span><br><span class="line">                time = self.getCurrentDate()</span><br><span class="line">            <span class="keyword">return</span> [author, href, text, ans_num, time]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取全部问题</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getQuestions</span><span class="params">(self, page_num)</span>:</span></span><br><span class="line">        <span class="comment">#获得目录页面的HTML</span></span><br><span class="line">        page = self.getPageByNum(page_num)</span><br><span class="line">        soup = BeautifulSoup(page)</span><br><span class="line">        <span class="comment">#分析获得所有问题</span></span><br><span class="line">        questions = soup.select(<span class="string">"div.question_list ul li"</span>)</span><br><span class="line">        <span class="comment">#遍历每一个问题</span></span><br><span class="line">        <span class="keyword">for</span> question <span class="keyword">in</span> questions:</span><br><span class="line">            <span class="comment">#获得问题的详情</span></span><br><span class="line">            info = self.getQuestionInfo(question)</span><br><span class="line">            <span class="keyword">if</span> info:</span><br><span class="line">                <span class="comment">#得到问题的URL</span></span><br><span class="line">                url = <span class="string">"http://iask.sina.com.cn/"</span> + info[<span class="number">1</span>]</span><br><span class="line">                <span class="comment">#通过URL来获取问题的最佳答案和其他答案</span></span><br><span class="line">                ans = self.page_spider.getAnswer(url)</span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"当前爬取第"</span>,page_num,<span class="string">"的内容,发现一个问题"</span>,info[<span class="number">2</span>],<span class="string">"回答数量"</span>,info[<span class="number">3</span>]</span><br><span class="line">                <span class="comment">#构造问题的字典,插入问题</span></span><br><span class="line">                ques_dict = &#123;</span><br><span class="line">                            <span class="string">"text"</span>: info[<span class="number">2</span>],</span><br><span class="line">                            <span class="string">"questioner"</span>: info[<span class="number">0</span>],</span><br><span class="line">                            <span class="string">"date"</span>: info[<span class="number">4</span>],</span><br><span class="line">                            <span class="string">"ans_num"</span>: info[<span class="number">3</span>],</span><br><span class="line">                            <span class="string">"url"</span>: url</span><br><span class="line">                            &#125;</span><br><span class="line">                <span class="comment">#获得插入的问题的自增ID</span></span><br><span class="line">                insert_id = self.mysql.insertData(<span class="string">"iask_questions"</span>,ques_dict)</span><br><span class="line">                <span class="comment">#得到最佳答案</span></span><br><span class="line">                good_ans = ans[<span class="number">0</span>]</span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"保存到数据库,此问题的ID为"</span>,insert_id</span><br><span class="line">                <span class="comment">#如果存在最佳答案,那么就插入</span></span><br><span class="line">                <span class="keyword">if</span> good_ans:</span><br><span class="line">                    <span class="keyword">print</span> self.getCurrentTime(),insert_id,<span class="string">"号问题存在最佳答案"</span>,good_ans[<span class="number">0</span>]</span><br><span class="line">                    <span class="comment">#构造最佳答案的字典</span></span><br><span class="line">                    good_ans_dict = &#123;</span><br><span class="line">                            <span class="string">"text"</span>: good_ans[<span class="number">0</span>],</span><br><span class="line">                            <span class="string">"answerer"</span>: good_ans[<span class="number">1</span>],</span><br><span class="line">                            <span class="string">"date"</span>: good_ans[<span class="number">2</span>],</span><br><span class="line">                            <span class="string">"is_good"</span>: str(good_ans[<span class="number">3</span>]),</span><br><span class="line">                            <span class="string">"question_id"</span>: str(insert_id)</span><br><span class="line">                            &#125;</span><br><span class="line">                    <span class="comment">#插入最佳答案</span></span><br><span class="line">                    <span class="keyword">if</span> self.mysql.insertData(<span class="string">"iask_answers"</span>,good_ans_dict):</span><br><span class="line">                        <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"保存最佳答案成功"</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"保存最佳答案失败"</span></span><br><span class="line">                <span class="comment">#获得其他答案</span></span><br><span class="line">                other_anses = ans[<span class="number">1</span>]</span><br><span class="line">                <span class="comment">#遍历每一个其他答案</span></span><br><span class="line">                <span class="keyword">for</span> other_ans <span class="keyword">in</span> other_anses:</span><br><span class="line">                    <span class="comment">#如果答案存在</span></span><br><span class="line">                    <span class="keyword">if</span> other_ans:</span><br><span class="line">                        <span class="keyword">print</span> self.getCurrentTime(),insert_id,<span class="string">"号问题存在其他答案"</span>,other_ans[<span class="number">0</span>]</span><br><span class="line">                        <span class="comment">#构造其他答案的字典</span></span><br><span class="line">                        other_ans_dict = &#123;</span><br><span class="line">                                <span class="string">"text"</span>: other_ans[<span class="number">0</span>],</span><br><span class="line">                                <span class="string">"answerer"</span>: other_ans[<span class="number">1</span>],</span><br><span class="line">                                <span class="string">"date"</span>: other_ans[<span class="number">2</span>],</span><br><span class="line">                                <span class="string">"is_good"</span>: str(other_ans[<span class="number">3</span>]),</span><br><span class="line">                                <span class="string">"question_id"</span>: str(insert_id)</span><br><span class="line">                                &#125;</span><br><span class="line">                        <span class="comment">#插入这个答案</span></span><br><span class="line">                        <span class="keyword">if</span> self.mysql.insertData(<span class="string">"iask_answers"</span>,other_ans_dict):</span><br><span class="line">                            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"保存其他答案成功"</span></span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"保存其他答案失败"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#主函数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(self)</span>:</span></span><br><span class="line">        f_handler=open(<span class="string">'out.log'</span>, <span class="string">'w'</span>)</span><br><span class="line">        sys.stdout=f_handler</span><br><span class="line">        page = open(<span class="string">'page.txt'</span>, <span class="string">'r'</span>)</span><br><span class="line">        content = page.readline()</span><br><span class="line">        start_page = int(content.strip()) - <span class="number">1</span></span><br><span class="line">        page.close()</span><br><span class="line">        <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"开始页码"</span>,start_page</span><br><span class="line">        <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"爬虫正在启动,开始爬取爱问知识人问题"</span></span><br><span class="line">        self.total_num = self.getTotalPageNum()</span><br><span class="line">        <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"获取到目录页面个数"</span>,self.total_num,<span class="string">"个"</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> start_page:</span><br><span class="line">            start_page = self.total_num</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">1</span>,start_page):</span><br><span class="line">            <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"正在抓取第"</span>,start_page-x+<span class="number">1</span>,<span class="string">"个页面"</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                self.getQuestions(start_page-x+<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">except</span> urllib2.URLError, e:</span><br><span class="line">                <span class="keyword">if</span> hasattr(e, <span class="string">"reason"</span>):</span><br><span class="line">                    <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"某总页面内抓取或提取失败,错误原因"</span>, e.reason</span><br><span class="line">            <span class="keyword">except</span> Exception,e:</span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"某总页面内抓取或提取失败,错误原因:"</span>,e</span><br><span class="line">            <span class="keyword">if</span> start_page-x+<span class="number">1</span> &lt; start_page:</span><br><span class="line">                f=open(<span class="string">'page.txt'</span>,<span class="string">'w'</span>)</span><br><span class="line">                f.write(str(start_page-x+<span class="number">1</span>))</span><br><span class="line">                <span class="keyword">print</span> self.getCurrentTime(),<span class="string">"写入新页码"</span>,start_page-x+<span class="number">1</span></span><br><span class="line">                f.close()</span><br><span class="line"></span><br><span class="line">spider = Spider()</span><br><span class="line">spider.main()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">page</span><span class="selector-class">.py</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight properties">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="attr">import</span> <span class="string">urllib</span></span><br><span class="line"><span class="attr">import</span> <span class="string">urllib2</span></span><br><span class="line"><span class="attr">import</span> <span class="string">re</span></span><br><span class="line"><span class="attr">import</span> <span class="string">time</span></span><br><span class="line"><span class="attr">import</span> <span class="string">types</span></span><br><span class="line"><span class="attr">import</span> <span class="string">tool</span></span><br><span class="line"><span class="attr">from</span> <span class="string">bs4 import BeautifulSoup</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#抓取分析某一问题和答案</span></span><br><span class="line"><span class="attr">class</span> <span class="string">Page:</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">def</span> <span class="string">__init__(self):</span></span><br><span class="line">        <span class="meta">self.tool</span> = <span class="string">tool.Tool()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">    #获取当前时间</span></span><br><span class="line">    <span class="attr">def</span> <span class="string">getCurrentDate(self):</span></span><br><span class="line">        <span class="attr">return</span> <span class="string">time.strftime('%Y-%m-%d',time.localtime(time.time()))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">    #获取当前时间</span></span><br><span class="line">    <span class="attr">def</span> <span class="string">getCurrentTime(self):</span></span><br><span class="line">        <span class="attr">return</span> <span class="string">time.strftime('[%Y-%m-%d %H:%M:%S]',time.localtime(time.time()))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">    #通过页面的URL来获取页面的代码</span></span><br><span class="line">    <span class="attr">def</span> <span class="string">getPageByURL(self, url):</span></span><br><span class="line">        <span class="attr">try</span>:<span class="string"></span></span><br><span class="line">            <span class="attr">request</span> = <span class="string">urllib2.Request(url)</span></span><br><span class="line">            <span class="attr">response</span> = <span class="string">urllib2.urlopen(request)</span></span><br><span class="line">            <span class="attr">return</span> <span class="string">response.read().decode("utf-8")</span></span><br><span class="line">        <span class="attr">except</span> <span class="string">urllib2.URLError, e:</span></span><br><span class="line">            <span class="attr">if</span> <span class="string">hasattr(e, "code"):</span></span><br><span class="line">                <span class="attr">print</span> <span class="string">self.getCurrentTime(),"获取问题页面失败,错误代号", e.code</span></span><br><span class="line">                <span class="attr">return</span> <span class="string">None</span></span><br><span class="line">            <span class="attr">if</span> <span class="string">hasattr(e, "reason"):</span></span><br><span class="line">                <span class="attr">print</span> <span class="string">self.getCurrentTime(),"获取问题页面失败,原因", e.reason</span></span><br><span class="line">                <span class="attr">return</span> <span class="string">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">    #传入一个List,返回它的标签里的内容,如果为空返回None</span></span><br><span class="line">    <span class="attr">def</span> <span class="string">getText(self, html):</span></span><br><span class="line">        <span class="attr">if</span> <span class="string">not type(html) is types.StringType:</span></span><br><span class="line">            <span class="attr">html</span> = <span class="string">str(html)</span></span><br><span class="line"><span class="comment">        #提取出&lt;pre&gt;标签里的内容</span></span><br><span class="line">        <span class="attr">pattern</span> = <span class="string">re.compile('&lt;pre.*?&gt;(.*?)&lt;/pre&gt;', re.S)</span></span><br><span class="line">        <span class="attr">match</span> = <span class="string">re.search(pattern, html)</span></span><br><span class="line"><span class="comment">        #如果匹配成功</span></span><br><span class="line">        <span class="attr">if</span> <span class="string">match:</span></span><br><span class="line">            <span class="attr">return</span> <span class="string">match.group(1)</span></span><br><span class="line">        <span class="attr">else</span>:<span class="string"></span></span><br><span class="line">            <span class="attr">return</span> <span class="string">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment">    #传入最佳答案的HTML,分析出回答者和回答时间</span></span><br><span class="line">    <span class="attr">def</span> <span class="string">getGoodAnswerInfo(self, html):</span></span><br><span class="line">        <span class="attr">pattern</span> = <span class="string">re.compile('"answer_tip.*?&lt;a.*?&gt;(.*?)&lt;/a&gt;.*?&lt;span class="time.*?&gt;.*?\|(.*?)&lt;/span&gt;', re.S)</span></span><br><span class="line">        <span class="attr">match</span> = <span class="string">re.search(pattern, html)</span></span><br><span class="line"><span class="comment">        #如果匹配,返回回答者和回答时间</span></span><br><span class="line">        <span class="attr">if</span> <span class="string">match:</span></span><br><span class="line">            <span class="attr">time</span> = <span class="string">match.group(2)</span></span><br><span class="line">            <span class="attr">time_pattern</span> = <span class="string">re.compile('\d&#123;2&#125;\-\d&#123;2&#125;\-\d&#123;2&#125;', re.S)</span></span><br><span class="line">            <span class="attr">time_match</span> = <span class="string">re.search(time_pattern, time)</span></span><br><span class="line">            <span class="attr">if</span> <span class="string">not time_match:</span></span><br><span class="line">                <span class="attr">time</span> = <span class="string">self.getCurrentDate()</span></span><br><span class="line">            <span class="attr">else</span>:<span class="string"></span></span><br><span class="line">                <span class="attr">time</span> = <span class="string">"20"+time</span></span><br><span class="line">            <span class="attr">return</span> <span class="string">[match.group(1),time]</span></span><br><span class="line">        <span class="attr">else</span>:<span class="string"></span></span><br><span class="line">            <span class="attr">return</span> <span class="string">[None,None]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">    #获得最佳答案</span></span><br><span class="line">    <span class="attr">def</span> <span class="string">getGoodAnswer(self, page):</span></span><br><span class="line">        <span class="attr">soup</span> = <span class="string">BeautifulSoup(page)</span></span><br><span class="line">        <span class="attr">text</span> = <span class="string">soup.select("div.good_point div.answer_text pre")</span></span><br><span class="line">        <span class="attr">if</span> <span class="string">len(text) &gt; 0:</span></span><br><span class="line"><span class="comment">            #获得最佳答案的内容</span></span><br><span class="line">            <span class="attr">ansText</span> = <span class="string">self.getText(str(text[0]))</span></span><br><span class="line">            <span class="attr">ansText</span> = <span class="string">self.tool.replace(ansText)</span></span><br><span class="line"><span class="comment">            #获得最佳答案的回答者信息</span></span><br><span class="line">            <span class="attr">info</span> = <span class="string">soup.select("div.good_point div.answer_tip")</span></span><br><span class="line">            <span class="attr">ansInfo</span> = <span class="string">self.getGoodAnswerInfo(str(info[0]))</span></span><br><span class="line"><span class="comment">            #将三者组合成一个List</span></span><br><span class="line">            <span class="attr">answer</span> = <span class="string">[ansText, ansInfo[0], ansInfo[1],1]</span></span><br><span class="line">            <span class="attr">return</span> <span class="string">answer</span></span><br><span class="line">        <span class="attr">else</span>:<span class="string"></span></span><br><span class="line"><span class="comment">            #如果不存在最佳答案,那么就返回空</span></span><br><span class="line">            <span class="attr">return</span> <span class="string">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment">    #传入回答者HTML,分析出回答者,回答时间</span></span><br><span class="line">    <span class="attr">def</span> <span class="string">getOtherAnswerInfo(self, html):</span></span><br><span class="line">        <span class="attr">if</span> <span class="string">not type(html) is types.StringType:</span></span><br><span class="line">            <span class="attr">html</span> = <span class="string">str(html)</span></span><br><span class="line">        <span class="attr">pattern</span> = <span class="string">re.compile('"author_name.*?&gt;(.*?)&lt;/a&gt;.*?answer_t"&gt;(.*?)&lt;/span&gt;', re.S)</span></span><br><span class="line">        <span class="attr">match</span> = <span class="string">re.search(pattern, html)</span></span><br><span class="line"><span class="comment">        #获得每一个回答的回答者信息和回答时间</span></span><br><span class="line">        <span class="attr">if</span> <span class="string">match:</span></span><br><span class="line">            <span class="attr">time</span> = <span class="string">match.group(2)</span></span><br><span class="line">            <span class="attr">time_pattern</span> = <span class="string">re.compile('\d&#123;2&#125;\-\d&#123;2&#125;\-\d&#123;2&#125;', re.S)</span></span><br><span class="line">            <span class="attr">time_match</span> = <span class="string">re.search(time_pattern, time)</span></span><br><span class="line">            <span class="attr">if</span> <span class="string">not time_match:</span></span><br><span class="line">                <span class="attr">time</span> = <span class="string">self.getCurrentDate()</span></span><br><span class="line">            <span class="attr">else</span>:<span class="string"></span></span><br><span class="line">                <span class="attr">time</span> = <span class="string">"20"+time</span></span><br><span class="line">            <span class="attr">return</span> <span class="string">[match.group(1),time]</span></span><br><span class="line">        <span class="attr">else</span>:<span class="string"></span></span><br><span class="line">            <span class="attr">return</span> <span class="string">[None,None]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">    #获得其他答案</span></span><br><span class="line">    <span class="attr">def</span> <span class="string">getOtherAnswers(self, page):</span></span><br><span class="line">        <span class="attr">soup</span> = <span class="string">BeautifulSoup(page)</span></span><br><span class="line">        <span class="attr">results</span> =  <span class="string">soup.select("div.question_box li.clearfix .answer_info")</span></span><br><span class="line"><span class="comment">        #所有答案,包含好多个List,每个List包含了回答内容,回答者,回答时间</span></span><br><span class="line">        <span class="attr">answers</span> = <span class="string">[]</span></span><br><span class="line">        <span class="attr">for</span> <span class="string">result in results:</span></span><br><span class="line"><span class="comment">            #获得回答内容</span></span><br><span class="line">            <span class="attr">ansSoup</span> = <span class="string">BeautifulSoup(str(result))</span></span><br><span class="line">            <span class="attr">text</span> = <span class="string">ansSoup.select(".answer_txt span pre")</span></span><br><span class="line">            <span class="attr">ansText</span> = <span class="string">self.getText(str(text[0]))</span></span><br><span class="line">            <span class="attr">ansText</span> = <span class="string">self.tool.replace(ansText)</span></span><br><span class="line"><span class="comment">            #获得回答者和回答时间</span></span><br><span class="line">            <span class="attr">info</span> = <span class="string">ansSoup.select(".answer_tj")</span></span><br><span class="line">            <span class="attr">ansInfo</span> = <span class="string">self.getOtherAnswerInfo(info[0])</span></span><br><span class="line"><span class="comment">            #将三者组合成一个List</span></span><br><span class="line">            <span class="attr">answer</span> = <span class="string">[ansText, ansInfo[0], ansInfo[1],0]</span></span><br><span class="line"><span class="comment">            #加入到answers</span></span><br><span class="line">            <span class="attr">answers.append(answer)</span></span><br><span class="line">        <span class="attr">return</span> <span class="string">answers</span></span><br><span class="line"></span><br><span class="line"><span class="comment">     #主函数</span></span><br><span class="line">    <span class="attr">def</span> <span class="string">getAnswer(self, url):</span></span><br><span class="line">        <span class="attr">if</span> <span class="string">not url:</span></span><br><span class="line">            <span class="attr">url</span> = <span class="string">"http://iask.sina.com.cn/b/gQiuSNCMV.html"</span></span><br><span class="line">        <span class="attr">page</span> = <span class="string">self.getPageByURL(url)</span></span><br><span class="line">        <span class="attr">good_ans</span> = <span class="string">self.getGoodAnswer(page)</span></span><br><span class="line">        <span class="attr">other_ans</span> = <span class="string">self.getOtherAnswers(page)</span></span><br><span class="line">        <span class="attr">return</span> <span class="string">[good_ans,other_ans]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">page</span> = <span class="string">Page()</span></span><br><span class="line"><span class="attr">page.getAnswer(None)</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">tool</span><span class="selector-class">.py</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight vbnet">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#-*- coding:utf-8 -*-</span></span><br><span class="line">import re</span><br><span class="line"></span><br><span class="line"><span class="meta">#处理页面标签类</span></span><br><span class="line"><span class="keyword">class</span> Tool:</span><br><span class="line"></span><br><span class="line">    <span class="meta">#将超链接广告剔除</span></span><br><span class="line">    removeADLink = re.compile(<span class="comment">'<span class="doctag">&lt;div class="link_layer.*?&lt;/div&gt;</span>')</span></span><br><span class="line">    <span class="meta">#去除img标签,1-7位空格,&amp;nbsp;</span></span><br><span class="line">    removeImg = re.compile(<span class="comment">'<span class="doctag">&lt;img.*?&gt;</span>| &#123;1,7&#125;|&amp;nbsp;')</span></span><br><span class="line">    <span class="meta">#删除超链接标签</span></span><br><span class="line">    removeAddr = re.compile(<span class="comment">'<span class="doctag">&lt;a.*?&gt;</span>|<span class="doctag">&lt;/a&gt;</span>')</span></span><br><span class="line">    <span class="meta">#把换行的标签换为\n</span></span><br><span class="line">    replaceLine = re.compile(<span class="comment">'<span class="doctag">&lt;tr&gt;</span>|<span class="doctag">&lt;div&gt;</span>|<span class="doctag">&lt;/div&gt;</span>|<span class="doctag">&lt;/p&gt;</span>')</span></span><br><span class="line">    <span class="meta">#将表格制表&lt;td&gt;替换为\t</span></span><br><span class="line">    replaceTD= re.compile(<span class="comment">'<span class="doctag">&lt;td&gt;</span>')</span></span><br><span class="line">    <span class="meta">#将换行符或双换行符替换为\n</span></span><br><span class="line">    replaceBR = re.compile(<span class="comment">'<span class="doctag">&lt;br&gt;</span><span class="doctag">&lt;br&gt;</span>|<span class="doctag">&lt;br&gt;</span>')</span></span><br><span class="line">    <span class="meta">#将其余标签剔除</span></span><br><span class="line">    removeExtraTag = re.compile(<span class="comment">'<span class="doctag">&lt;.*?&gt;</span>')</span></span><br><span class="line">    <span class="meta">#将多行空行删除</span></span><br><span class="line">    removeNoneLine = re.compile(<span class="comment">'\n+')</span></span><br><span class="line"></span><br><span class="line">    def replace(self,x):</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeADLink,<span class="string">""</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeImg,<span class="string">""</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeAddr,<span class="string">""</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.replaceLine,<span class="string">"\n"</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.replaceTD,<span class="string">"\t"</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.replaceBR,<span class="string">"\n"</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeExtraTag,<span class="string">""</span>,x)</span><br><span class="line">        x = re.<span class="keyword">sub</span>(self.removeNoneLine,<span class="string">"\n"</span>,x)</span><br><span class="line">        <span class="meta">#strip()将前后多余内容删除</span></span><br><span class="line">        <span class="keyword">return</span> x.strip()</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">mysql</span><span class="selector-class">.py</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight ruby">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import MySQLdb</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mysql</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#获取当前时间</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getCurrentTime</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">return</span> time.strftime(<span class="string">'[%Y-%m-%d %H:%M:%S]'</span>,time.localtime(time.time()))</span><br><span class="line"></span><br><span class="line">    <span class="comment">#数据库初始化</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="symbol">try:</span></span><br><span class="line">            <span class="keyword">self</span>.db = MySQLdb.connect(<span class="string">'ip'</span>,<span class="string">'username'</span>,<span class="string">'password'</span>,<span class="string">'db_name'</span>)</span><br><span class="line">            <span class="keyword">self</span>.cur = <span class="keyword">self</span>.db.cursor()</span><br><span class="line">        except MySQLdb.Error,<span class="symbol">e:</span></span><br><span class="line">             print <span class="keyword">self</span>.getCurrentTime(),<span class="string">"连接数据库错误，原因%d: %s"</span> % (e.args[<span class="number">0</span>], e.args[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment">#插入数据</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insertData</span><span class="params">(<span class="keyword">self</span>, table, my_dict)</span></span><span class="symbol">:</span></span><br><span class="line">         <span class="symbol">try:</span></span><br><span class="line">             <span class="keyword">self</span>.db.set_character_set(<span class="string">'utf8'</span>)</span><br><span class="line">             cols = <span class="string">', '</span>.join(my_dict.keys())</span><br><span class="line">             values = <span class="string">'"," '</span>.join(my_dict.values())</span><br><span class="line">             sql = <span class="string">"INSERT INTO %s (%s) VALUES (%s)"</span> % (table, cols, <span class="string">'"'</span>+values+<span class="string">'"'</span>)</span><br><span class="line">             <span class="symbol">try:</span></span><br><span class="line">                 result = <span class="keyword">self</span>.cur.execute(sql)</span><br><span class="line">                 insert_id = <span class="keyword">self</span>.db.insert_id()</span><br><span class="line">                 <span class="keyword">self</span>.db.commit()</span><br><span class="line">                 <span class="comment">#判断是否执行成功</span></span><br><span class="line">                 <span class="keyword">if</span> <span class="symbol">result:</span></span><br><span class="line">                     <span class="keyword">return</span> insert_id</span><br><span class="line">                 <span class="symbol">else:</span></span><br><span class="line">                     <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">             except MySQLdb.Error,<span class="symbol">e:</span></span><br><span class="line">                 <span class="comment">#发生错误时回滚</span></span><br><span class="line">                 <span class="keyword">self</span>.db.rollback()</span><br><span class="line">                 <span class="comment">#主键唯一，无法插入</span></span><br><span class="line">                 <span class="keyword">if</span> <span class="string">"key 'PRIMARY'"</span> <span class="keyword">in</span> e.args[<span class="number">1</span>]<span class="symbol">:</span></span><br><span class="line">                     print <span class="keyword">self</span>.getCurrentTime(),<span class="string">"数据已存在，未插入数据"</span></span><br><span class="line">                 <span class="symbol">else:</span></span><br><span class="line">                     print <span class="keyword">self</span>.getCurrentTime(),<span class="string">"插入数据失败，原因 %d: %s"</span> % (e.args[<span class="number">0</span>], e.args[<span class="number">1</span>])</span><br><span class="line">         except MySQLdb.Error,<span class="symbol">e:</span></span><br><span class="line">             print <span class="keyword">self</span>.getCurrentTime(),<span class="string">"数据库错误，原因%d: %s"</span> % (e.args[<span class="number">0</span>], e.args[<span class="number">1</span>])</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>数据库建表 SQL 如下：</p>
                  <figure class="highlight sql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> <span class="string">`iask_answers`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">'自增ID'</span>,</span><br><span class="line">  <span class="string">`text`</span> <span class="built_in">text</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'回答内容'</span>,</span><br><span class="line">  <span class="string">`question_id`</span> <span class="built_in">int</span>(<span class="number">18</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'问题ID'</span>,</span><br><span class="line">  <span class="string">`answerer`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'回答者'</span>,</span><br><span class="line">  <span class="string">`date`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'回答时间'</span>,</span><br><span class="line">  <span class="string">`is_good`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'是否是最佳答案'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span>  <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> <span class="string">`iask_questions`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">'问题ID'</span>,</span><br><span class="line">  <span class="string">`text`</span> <span class="built_in">text</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'问题内容'</span>,</span><br><span class="line">  <span class="string">`questioner`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'提问者'</span>,</span><br><span class="line">  <span class="string">`date`</span> <span class="built_in">date</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'提问时间'</span>,</span><br><span class="line">  <span class="string">`ans_num`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'回答数量'</span>,</span><br><span class="line">  <span class="string">`url`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'问题链接'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span>  <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行的时候执行如下命令即可</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">nohup <span class="keyword">python</span> spider.<span class="keyword">py</span> &amp;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>代码写的不好，仅供大家学习参考使用，如有问题，欢迎留言交流。</p>
                  <h2 id="运行结果查看"><a href="#运行结果查看" class="headerlink" title="运行结果查看"></a>运行结果查看</h2>
                  <p>我们把 PHP 文件和 log 文件放在同一目录下，运行 PHP 文件，便可以看到如下的内容： <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150908222744.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/09/20150908222744.png" alt="20150908222744"></a> 小伙伴们赶快试一下吧。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-09-08 22:24:33" itemprop="dateCreated datePublished" datetime="2015-09-08T22:24:33+08:00">2015-09-08</time>
                </span>
                <span id="/1972.html" class="post-meta-item leancloud_visitors" data-flag-title="Python爬虫实战六之抓取爱问知识人问题并保存至数据库" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>18k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>16 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1981.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Other <i class="label-arrow"></i>
                  </a>
                  <a href="/1981.html" class="post-title-link" itemprop="url">Ubuntu Linux下定时监测MySQL进程终止时自动重启的方法</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2>
                  <p>最近发现 MySQL 服务隔三差五就会挂掉，导致我的网站和爬虫都无法正常运作。自己的网站是基于 MySQL，在做爬虫存取一些资料的时候也是基于 MySQL，数据量一大了，MySQL 它就有点受不了了，时不时会崩掉，虽然我自己有网站监控和邮件通知，但是好多时候还是需要我来手动连接我的服务器重新启动一下我的 MySQL，这样简直太不友好了，所以，我就觉定自己写个脚本，定时监控它，如果发现它挂掉了就重启它。 好了，闲言碎语不多讲，开始我们的配置之旅。 运行环境：<strong>Ubuntu Linux 14.04</strong></p>
                  <h2 id="编写-Shell-脚本"><a href="#编写-Shell-脚本" class="headerlink" title="编写 Shell 脚本"></a>编写 Shell 脚本</h2>
                  <p>首先，我们要编写一个 shell 脚本，脚本主要执行的逻辑如下： 显示 mysqld 进程状态，如果判断进程未在运行，那么输出日志到文件，然后启动 mysql 服务，如果进程在运行，那么不执行任何操作，可以选择性输出监测结果。 可能大家对于 shell 脚本比较陌生，在这里推荐官方的 shell 脚本文档来参考一下 <a href="http://wiki.ubuntu.org.cn/Shell%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80" target="_blank" rel="noopener">Ubuntu Shell 编程基础</a> shell 脚本的后缀为 sh，在任何位置新建一个脚本文件，我选择在 /etc/mysql 目录下新建一个 listen.sh 文件。 执行如下命令：</p>
                  <figure class="highlight vim">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">cd</span> /etc/mysql</span><br><span class="line">touch listen.<span class="keyword">sh</span></span><br><span class="line"><span class="keyword">vi</span> listen.<span class="keyword">sh</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>进入到 vi 中，我们添加如下脚本内容：</p>
                  <figure class="highlight bash">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">pgrep mysqld &amp;&gt; /dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? -gt 0 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"`date` mysql is stop"</span></span><br><span class="line">service mysql start</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"`date` mysql running"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中 pgrep mysqld 是监测 mysqld 服务的运行状态，&amp;&gt; /dev/null 是将其结果输出到空文件，也就是不保存输出信息 $? 是拿到上一条命令的运行结果，-gt 0 是判断是否大于 0，后面则是输出时间到日志文件，然后启动 mysql，否则不启动 mysql 保存好了，那么我们执行如下的命令，来测试一下。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/08/20150816164552.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/08/20150816164552.jpg" alt="20150816164552"></a> 贴心的命令文字版本：</p>
                  <figure class="highlight elixir">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">root<span class="variable">@iZ28uogb3laZ</span><span class="symbol">:/etc/mysql</span><span class="comment"># vi listen.sh</span></span><br><span class="line">root<span class="variable">@iZ28uogb3laZ</span><span class="symbol">:/etc/mysql</span><span class="comment"># pgrep mysqld</span></span><br><span class="line"><span class="number">3359</span></span><br><span class="line">root<span class="variable">@iZ28uogb3laZ</span><span class="symbol">:/etc/mysql</span><span class="comment"># chmod 777 listen.sh</span></span><br><span class="line">root<span class="variable">@iZ28uogb3laZ</span><span class="symbol">:/etc/mysql</span><span class="comment"># ./listen.sh</span></span><br><span class="line">Sun Aug <span class="number">16 16</span><span class="symbol">:</span><span class="number">44:58</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">root<span class="variable">@iZ28uogb3laZ</span><span class="symbol">:/etc/mysql</span><span class="comment"># sudo service mysql stop</span></span><br><span class="line">mysql stop/waiting</span><br><span class="line">root<span class="variable">@iZ28uogb3laZ</span><span class="symbol">:/etc/mysql</span><span class="comment"># ./listen.sh</span></span><br><span class="line">Sun Aug <span class="number">16 16</span><span class="symbol">:</span><span class="number">45:17</span> CST <span class="number">2015</span> mysql is stop</span><br><span class="line">mysql start/running, process <span class="number">4084</span></span><br><span class="line">root<span class="variable">@iZ28uogb3laZ</span><span class="symbol">:/etc/mysql</span><span class="comment"># ./listen.sh</span></span><br><span class="line">Sun Aug <span class="number">16 16</span><span class="symbol">:</span><span class="number">45:24</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">root<span class="variable">@iZ28uogb3laZ</span><span class="symbol">:/etc/mysql</span><span class="comment">#</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>嗯，编辑完了.sh 文件之后，我们首先要对其进行授权，增加可执行的权限。</p>
                  <figure class="highlight lsl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sudo chmod <span class="number">777</span> <span class="section">listen</span>.sh</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后运行脚本测试一下，显示 mysql 正在运行。把 mysql 关掉，运行脚本，便会检测到 mysql 已关闭，然后重新启动了 mysql，再次运行，便会发现 mysql 正常运行了。 <strong>注：这里我比较纳闷 shell 脚本中 pgrep mysqld 的返回结果是什么。为什么它大于 0 便代表 mysql 服务挂掉了呢？感觉逻辑有点是相反的，不过实测可用有效。如果大家明白为什么，非常希望您可以给我一个解释。</strong></p>
                  <h2 id="修改日志输出"><a href="#修改日志输出" class="headerlink" title="修改日志输出"></a>修改日志输出</h2>
                  <p>好，接下来我们把输出的内容保存到日志里。修改脚本文件如下</p>
                  <figure class="highlight bash">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">pgrep mysqld &amp;&gt; /dev/null</span><br><span class="line"><span class="keyword">if</span> [ $? -gt 0 ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"`date` mysql is stop"</span> &gt;&gt; /var/<span class="built_in">log</span>/mysql_listen.log</span><br><span class="line">service mysql start</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"`date` mysql running"</span> &gt;&gt; /var/<span class="built_in">log</span>/mysql_listen.log</span><br><span class="line"><span class="keyword">fi</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样，每执行一次脚本，输出结果都会被保存到 /var/log/mysql_listen.log 中了。</p>
                  <h2 id="添加定时任务"><a href="#添加定时任务" class="headerlink" title="添加定时任务"></a>添加定时任务</h2>
                  <p>好了，脚本可以顺利执行了，那么我们就需要定时调用一下这个脚本来运行了，我们需要用到 cron。 首先我们需要编辑一下 corn 调度表格，命令如下：</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">crontab -e</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果你是第一次编辑这个，他会让你选择文件打开方式，随便选一个数字就好了。 比如我们用 GNU 打开的，我们就在它的最后一行添加下面的一句话即可。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/08/20150816165506.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/08/20150816165506.jpg" alt="20150816165506"></a>、 文字版本：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">*<span class="regexp">/5 * * * * /</span>etc<span class="regexp">/mysql/my</span>sql_listen.sh</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>/5 代表五分钟执行一次，后面的四个点依次代表了，小时，日，月，星期。如果想要时间长一些，比如一小时调度一次，那就设置一下后面第一个*就好了。 好，保存一下，重启 cron 服务。</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">service cron restart</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>嗯，调度任务已经添加进去了，这样，每五分钟系统就会调用一下刚才写的那个脚本。 过一段时间，我们来看一下运行效果，嗯，监控跑的很顺利呐。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/08/20150816165858.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/08/20150816165858.jpg" alt="20150816165858"></a> 文字版本：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">Sun Aug <span class="number">16</span> <span class="number">15</span>:<span class="number">39</span>:<span class="number">12</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">15</span>:<span class="number">40</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">15</span>:<span class="number">45</span>:<span class="number">02</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">15</span>:<span class="number">50</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">15</span>:<span class="number">55</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">16</span>:<span class="number">00</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">16</span>:<span class="number">05</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">16</span>:<span class="number">10</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">16</span>:<span class="number">15</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">16</span>:<span class="number">20</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">16</span>:<span class="number">25</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">16</span>:<span class="number">30</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">16</span>:<span class="number">35</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">16</span>:<span class="number">40</span>:<span class="number">01</span> CST <span class="number">2015</span> mysql running</span><br><span class="line">Sun Aug <span class="number">16</span> <span class="number">16</span>:<span class="number">51</span>:<span class="number">04</span> CST <span class="number">2015</span> mysql running</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>哈哈，是不是五分钟监测了一次呢？大功告成。</p>
                  <h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2>
                  <p>这样，我们就实现了五分钟定时检测 MySQL 进程服务，妈妈再也不用担心我的网站会宕掉啦。 如有问题，欢迎留言交流，谢谢啦。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-08-16 17:06:30" itemprop="dateCreated datePublished" datetime="2015-08-16T17:06:30+08:00">2015-08-16</time>
                </span>
                <span id="/1981.html" class="post-meta-item leancloud_visitors" data-flag-title="Ubuntu Linux下定时监测MySQL进程终止时自动重启的方法" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.9k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1934.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> C/C++ <i class="label-arrow"></i>
                  </a>
                  <a href="/1934.html" class="post-title-link" itemprop="url">C语言小知识点练习总结</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>最近在准备C语言的上级考试，之前对C接触不多，在练习过程中把一些小知识点记录下来。</p>
                  <h2 id="1-字符串的截取"><a href="#1-字符串的截取" class="headerlink" title="1.字符串的截取"></a>1.字符串的截取</h2>
                  <p>利用strncpy函数，传入三个参数，分别为目标字符串，起始位置，长度。 例如将日期字符串转化为数字，如20120112</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> date1[<span class="number">20</span>],date2[<span class="number">20</span>];</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%s"</span>,&amp;date1);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%s"</span>,&amp;date2);</span><br><span class="line">    <span class="keyword">char</span> temp[<span class="number">4</span>];</span><br><span class="line">    <span class="keyword">int</span> year1 = atoi(<span class="built_in">strncpy</span>(temp,date1,<span class="number">4</span>));</span><br><span class="line">    <span class="keyword">int</span> year2 = atoi(<span class="built_in">strncpy</span>(temp,date2,<span class="number">4</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"year1:%d\n"</span>,year1);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"year2:%d\n"</span>,year2);</span><br><span class="line">    <span class="keyword">char</span> temp2[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">int</span> month1 = atoi(<span class="built_in">strncpy</span>(temp2,date1+<span class="number">4</span>,<span class="number">2</span>));</span><br><span class="line">    <span class="keyword">int</span> month2 = atoi(<span class="built_in">strncpy</span>(temp2,date2+<span class="number">4</span>,<span class="number">2</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"month1:%d\n"</span>,month1);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"month2:%d\n"</span>,month2);</span><br><span class="line">    <span class="keyword">int</span> day1 = atoi(<span class="built_in">strncpy</span>(temp2,date1+<span class="number">6</span>,<span class="number">2</span>));</span><br><span class="line">    <span class="keyword">int</span> day2 = atoi(<span class="built_in">strncpy</span>(temp2,date2+<span class="number">6</span>,<span class="number">2</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"day1:%d\n"</span>,day1);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"day2:%d\n"</span>,day2);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上便实现了输入一个日期然后对其进行分割的操作。</p>
                  <h2 id="2-二维数组的动态声明"><a href="#2-二维数组的动态声明" class="headerlink" title="2.二维数组的动态声明"></a>2.二维数组的动态声明</h2>
                  <p>利用malloc可以实现数组的动态声明</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">int</span> **a;</span><br><span class="line">    a = (<span class="built_in">int</span> **)malloc(<span class="number">2</span>*sizeof(<span class="built_in">int</span> *));</span><br><span class="line">    <span class="built_in">int</span> i,j;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i ++) &#123;</span><br><span class="line">        a[i] = (<span class="built_in">int</span> *)malloc(<span class="number">3</span>*sizeof(<span class="built_in">int</span>));</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++) &#123;</span><br><span class="line">            scanf(<span class="string">"%d"</span>,&amp;a[i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上便实现了动态数组的分配，利用scanf为数组赋值</p>
                  <h2 id="3-二维数组的声明和初始化"><a href="#3-二维数组的声明和初始化" class="headerlink" title="3.二维数组的声明和初始化"></a>3.二维数组的声明和初始化</h2>
                  <p>头文件</p>
                  <figure class="highlight autoit">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>初始化和测试</p>
                  <figure class="highlight matlab">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">int result[<span class="number">2</span>][<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">i</span> = <span class="number">0</span>; <span class="built_in">i</span> &lt; <span class="number">2</span>; <span class="built_in">i</span> ++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">j</span> = <span class="number">0</span>; <span class="built_in">j</span> &lt; <span class="number">2</span>; <span class="built_in">j</span>++) &#123;</span><br><span class="line">            printf(<span class="string">"%d "</span>,result[<span class="built_in">i</span>][<span class="built_in">j</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        printf(<span class="string">"\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    memset(result,<span class="number">0</span>,sizeof(int)*<span class="number">4</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">i</span> = <span class="number">0</span>; <span class="built_in">i</span> &lt; <span class="number">2</span>; <span class="built_in">i</span> ++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">j</span> = <span class="number">0</span>; <span class="built_in">j</span> &lt; <span class="number">2</span>; <span class="built_in">j</span>++) &#123;</span><br><span class="line">            printf(<span class="string">"%d "</span>,result[<span class="built_in">i</span>][<span class="built_in">j</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        printf(<span class="string">"\n"</span>);</span><br><span class="line">    &#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>结果</p>
                  <figure class="highlight basic">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">4196944 </span><span class="number">0</span> </span><br><span class="line"><span class="symbol">4195696 </span><span class="number">0</span> </span><br><span class="line"><span class="symbol">0 </span><span class="number">0</span> </span><br><span class="line"><span class="symbol">0 </span><span class="number">0</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>上述是数组的非动态声明</p>
                  <h2 id="4-快速排序"><a href="#4-快速排序" class="headerlink" title="4.快速排序"></a>4.快速排序</h2>
                  <p>假设要排序的数组是A[1]……A[N]，首先任意选取一个数据（通常选用第一个数据）作为关键数据，然后将所有比它的数都放到它前面，所有比它大的数都放到它后面，这个过程称为一趟快速排序。一趟快速排序的算法是： 1）设置两个变量I、J，排序开始的时候 I=0，J=N-1； 2）以第一个数组元素作为关键数据，赋值给X，即X=A[0]； 3）从J开始向前搜索，即由后开始向前搜索，找到第一个小于X的值，两者交换； 4）从I开始向后搜索，即由前开始向后搜索，找到第一个大于X的值，两者交换； 5）重复第3、4步，直到I=J； 例如：待排序的数组A的值分别是：（初始关键数据X：=49） A[0] A[1] A[2] A[3] A[4] A[5] A[6] 49 38 65 97 76 13 27 进行第一次交换后： 27 38 65 97 76 13 49 ( 按照算法的第三步从后面开始找 ） 进行第二次交换后： 27 38 49 97 76 13 65 ( 按照算法的第四步从前面开始找&gt;X的值，65&gt;49,两者交换，此时I=3 ) 进行第三次交换后： 27 38 13 97 76 49 65 ( 按照算法的第五步将又一次执行算法的第三步从后开始找） 进行第四次交换后： 27 38 13 49 76 97 65 ( 按照算法的第四步从前面开始找大于X的值，97&gt;49,两者交换，此时J=4 ) 此时再执行第三不的时候就发现I=J，从而结束一躺快速排序，那么经过一躺快速排序之后： 27 38 13 49 76 97 65 即所有大于49的数全部在49的后面，所有小于49的数全部在49的前面。</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line"><span class="built_in">void</span> quiksort(<span class="built_in">int</span> a[],<span class="built_in">int</span> low,<span class="built_in">int</span> high)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">int</span> i = low;</span><br><span class="line">    <span class="built_in">int</span> j = high;  </span><br><span class="line">    <span class="built_in">int</span> temp = a[i]; </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">if</span>( low &lt; high)</span><br><span class="line">    &#123;          </span><br><span class="line">        <span class="keyword">while</span>(i &lt; j) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">while</span>((a[j] &gt;= temp) &amp;&amp; (i &lt; j))</span><br><span class="line">            &#123; </span><br><span class="line">                j--; </span><br><span class="line">            &#125;</span><br><span class="line">            a[i] = a[j];</span><br><span class="line">            <span class="keyword">while</span>((a[i] &lt;= temp) &amp;&amp; (i &lt; j))</span><br><span class="line">            &#123;</span><br><span class="line">                i++; </span><br><span class="line">            &#125;  </span><br><span class="line">            a[j]= a[i];</span><br><span class="line">        &#125;</span><br><span class="line">        a[i] = temp;</span><br><span class="line">        quiksort(a,low,i<span class="number">-1</span>);</span><br><span class="line">        quiksort(a,j+<span class="number">1</span>,high);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="built_in">int</span> main()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">int</span> arr[<span class="number">5</span>] = &#123;<span class="number">23</span>,<span class="number">1</span>,<span class="number">21</span>,<span class="number">4</span>,<span class="number">19</span>&#125;;</span><br><span class="line">    quiksort(arr,<span class="number">0</span>,<span class="number">4</span>);</span><br><span class="line">    <span class="built_in">int</span> i;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        printf(<span class="string">"%d "</span>,arr[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    printf(<span class="string">"\n"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>快速排序代码如上</p>
                  <h2 id="5-字符串拷贝"><a href="#5-字符串拷贝" class="headerlink" title="5.字符串拷贝"></a>5.字符串拷贝</h2>
                  <p>小例子如下</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> str[<span class="number">20</span>] = <span class="string">"hello"</span>;</span><br><span class="line">	<span class="keyword">char</span> *a = <span class="string">"world"</span>;</span><br><span class="line">	<span class="built_in">strcpy</span>(str,a);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%s"</span>,str);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">	system(<span class="string">"pause"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：world，即把后者完全覆盖前者。</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> *str = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">6</span>];</span><br><span class="line">	<span class="keyword">char</span> *a = <span class="string">"world"</span>;</span><br><span class="line">	<span class="built_in">strcpy</span>(str,a);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%s"</span>, str);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">	system(<span class="string">"pause"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果一致 某一长度的字符串截取</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> *str = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">6</span>];</span><br><span class="line">	<span class="keyword">char</span> *a = <span class="string">"world"</span>;</span><br><span class="line">	<span class="built_in">strncpy</span>(str,a+<span class="number">1</span>,<span class="number">5</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%s"</span>, str);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">	system(<span class="string">"pause"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：orld</p>
                  <h2 id="6-字符串的拼接"><a href="#6-字符串的拼接" class="headerlink" title="6.字符串的拼接"></a>6.字符串的拼接</h2>
                  <p>小例子如下</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> str[<span class="number">20</span>] = <span class="string">"hello "</span>;</span><br><span class="line">	<span class="keyword">char</span> *a = <span class="string">"world"</span>;</span><br><span class="line">	<span class="keyword">char</span> *x = <span class="built_in">strcat</span>(str,a);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%s\n"</span>, x);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%s\n"</span>, x);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">	system(<span class="string">"pause"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果： hello world hello world 此函数既返回结果，又将目标字符串赋值</p>
                  <h2 id="7-字符串查找匹配"><a href="#7-字符串查找匹配" class="headerlink" title="7.字符串查找匹配"></a>7.字符串查找匹配</h2>
                  <p>例子如下</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> str[<span class="number">20</span>] = <span class="string">"hello "</span>;</span><br><span class="line">	<span class="keyword">char</span> *x = <span class="built_in">strchr</span>(str,<span class="string">'e'</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, x - str);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%s\n"</span>,x);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">	system(<span class="string">"pause"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果： 1 ello</p>
                  <h2 id="8-字符串比较"><a href="#8-字符串比较" class="headerlink" title="8.字符串比较"></a>8.字符串比较</h2>
                  <p>例子如下</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> str[<span class="number">20</span>] = <span class="string">"hello "</span>;</span><br><span class="line">	<span class="keyword">char</span> str2[<span class="number">20</span>] = <span class="string">"hello2"</span>;</span><br><span class="line">	<span class="keyword">int</span> x = <span class="built_in">strcmp</span>(str, str2);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,x);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">	system(<span class="string">"pause"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果-1 忽略大小写</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">char</span> str[<span class="number">20</span>] = <span class="string">"hello"</span>;</span><br><span class="line">	<span class="keyword">char</span> str2[<span class="number">20</span>] = <span class="string">"Hello"</span>;</span><br><span class="line">	<span class="keyword">int</span> x = stricmp(str, str2);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,x);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">	system(<span class="string">"pause"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果0</p>
                  <h2 id="9-字符串分割"><a href="#9-字符串分割" class="headerlink" title="9.字符串分割"></a>9.字符串分割</h2>
                  <p>示例如下</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">      <span class="keyword">char</span> test1[] = <span class="string">"feng,ke,wei"</span>;  </span><br><span class="line">	  <span class="keyword">char</span> x[<span class="number">3</span>][<span class="number">30</span>];</span><br><span class="line">      <span class="keyword">char</span> *p;  </span><br><span class="line">      p = strtok(test1, <span class="string">","</span>);</span><br><span class="line">	  <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">while</span> (p) &#123;   </span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%s\n"</span>, p);   </span><br><span class="line">		<span class="built_in">strcpy</span>(x[count],p);</span><br><span class="line">		count++;</span><br><span class="line">		p = strtok(<span class="literal">NULL</span>, <span class="string">","</span>);     </span><br><span class="line">      &#125;    </span><br><span class="line">	  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;count; i ++) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%s "</span>, x[i]);</span><br><span class="line">	  &#125;</span><br><span class="line">	  system(<span class="string">"pause"</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"> &#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果 feng ke wei feng ke wei</p>
                  <h2 id="10-格式化输出几位小数"><a href="#10-格式化输出几位小数" class="headerlink" title="10.格式化输出几位小数"></a>10.格式化输出几位小数</h2>
                  <p>例如</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">printf</span>(<span class="string">"%.5f"</span>,<span class="number">18.223</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>则是输出5位小数 又如</p>
                  <figure class="highlight perl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">printf</span>(<span class="string">"%5.1f"</span>,<span class="number">1.2345</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>则是控制总位数为5，小数点后为1位，不够的在前面补空格</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-07-18 21:52:01" itemprop="dateCreated datePublished" datetime="2015-07-18T21:52:01+08:00">2015-07-18</time>
                </span>
                <span id="/1934.html" class="post-meta-item leancloud_visitors" data-flag-title="C语言小知识点练习总结" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>4.8k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>4 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1922.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> C/C++ <i class="label-arrow"></i>
                  </a>
                  <a href="/1922.html" class="post-title-link" itemprop="url">Winpcap网络编程六之两台主机通过中间主机通信</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="本节任务"><a href="#本节任务" class="headerlink" title="本节任务"></a>本节任务</h2>
                  <p>本次我们需要完成的任务是 完成两台主机通过中间主机的数据通信（网络层）</p>
                  <ul>
                    <li>增加基于IP地址的转发功能</li>
                    <li>增加网络层封装</li>
                  </ul>
                  <p>其实最主要的就是基于IP地址的转发功能，网络层的封装其实我们在初级功能中就已经做好了。</p>
                  <h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2>
                  <p>首先，实验的思路是A通过中间主机B向C发送数据。那么B则作为一个路由器，B要监听两个网卡，一个网卡发来的数据通过另一个网卡发出去。 示意图如下： A————-&gt;B1===B2——————&gt;C 从图上可以看出，B主机的两个网卡数据互通，A和B1则处于一个局域网内，B2和C处于另一个局域网内。 就比如这样，现在室友A在用有线上网，我的电脑B也在用有线上网，我们的有线处在同一局域网，我的电脑B同时散着一个无线网，我的手机C又连接到了这个无线上。 那么要实现A到C的数据传送，即模拟室友A要发送数据到我的手机C，那么流程则是这样的： 室友A在有线局域网发送数据到我的网卡B1，B1将数据通过网卡B2转发到无线局域网，通过无线局域网到达我的手机C。 A的发送要构建一个帧，目的MAC地址为B1,目的IP为C。B则要开启两个网卡，B1监听接收数据，B2网卡则要用ARP协议扫描所在无线局域网内的IP和MAC,B获取到了A发来的帧之后，解析它的IP地址和MAC地址，匹配刚才扫描得到的IP和MAC对应表，将源MAC换成B2网卡MAC，目的MAC换成C的MAC，IP不变，数据data不变。构建新帧之后发送出去。 好啦，思路大体就是这样。</p>
                  <h2 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h2>
                  <p>需要三个程序，一个是发送，一个路由，一个接收。所以一共三个程序要同时运行起来执行。 以上是我的大体思路，如有错误，还请指正。现已用代码实现完毕。 代码暂不公开，只提供部分重点代码解析：</p>
                  <h3 id="一、发送端"><a href="#一、发送端" class="headerlink" title="一、发送端"></a>一、发送端</h3>
                  <p>其实发送端和初级功能的发送差不多 个人编写的交互流程如下：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">IP地址:<span class="number">121.250</span><span class="number">.216</span><span class="number">.221</span>   MAC地址:<span class="number">3</span>c970e4b56d6con:<span class="number">127</span></span><br><span class="line"></span><br><span class="line">-------------------------------------------</span><br><span class="line">IP地址:<span class="number">121.250</span><span class="number">.216</span><span class="number">.227</span>   MAC地址:<span class="number">089e01</span>b948f4con:<span class="number">128</span></span><br><span class="line"></span><br><span class="line">-------------------------------------------</span><br><span class="line">IP地址:<span class="number">121.250</span><span class="number">.216</span><span class="number">.228</span>   MAC地址:<span class="number">10</span>bf48705aeecon:<span class="number">129</span></span><br><span class="line"></span><br><span class="line">获取MAC地址完毕,请输入你要发送对方的IP地址:</span><br><span class="line"><span class="number">192.168</span><span class="number">.1</span><span class="number">.3</span></span><br><span class="line">请输入你要发送的内容:</span><br><span class="line">im cqc</span><br><span class="line">要发送的内容:im cqc</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>具体代码不再解析，同上一篇初级功能。</p>
                  <h3 id="二、路由端"><a href="#二、路由端" class="headerlink" title="二、路由端"></a>二、路由端</h3>
                  <p>首先要开启两个网卡，声明两个网卡对象和处理器</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">pcap_if_t</span>  *d,*d2;					<span class="comment">//选中的网络适配器</span></span><br><span class="line"><span class="keyword">pcap_t</span> *adhandle,*adhandle2;           <span class="comment">//捕捉实例,是pcap_open返回的对象,adhandle是用来发送数据，adhandle2是用来接收数据</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>一个用来接收一个用来发送，这里定义了adhandle是用来发送，adhandle2是用来接收数据。 那么打开适配器就在main方法中，提前打开两个网卡</p>
                  <figure class="highlight xl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">int num;</span><br><span class="line">	printf(<span class="string">"请输入你要转发数据的网卡代号:\n"</span>);</span><br><span class="line">	<span class="comment">//让用户选择选择哪个适配器进行转发</span></span><br><span class="line">	scanf_s(<span class="string">"%d"</span>,&amp;num);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//跳转到选中的适配器</span></span><br><span class="line">	<span class="function"><span class="title">for</span>(d=alldevs, i=0; i&lt; num-1 ; d=d-&gt;</span>next, i++);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//运行到此处说明用户的输入是合法的，找到发送数据网卡</span></span><br><span class="line">	<span class="function"><span class="title">if</span>((adhandle = pcap_open(d-&gt;</span><span class="keyword">name</span>,		<span class="comment">//设备名称</span></span><br><span class="line">													<span class="number">65535</span>,       <span class="comment">//存放数据包的内容长度</span></span><br><span class="line">													PCAP_OPENFLAG_PROMISCUOUS,  <span class="comment">//混杂模式</span></span><br><span class="line">													<span class="number">1000</span>,           <span class="comment">//超时时间</span></span><br><span class="line">													NULL,          <span class="comment">//远程验证</span></span><br><span class="line">													errbuf         <span class="comment">//错误缓冲</span></span><br><span class="line">													)) == NULL)&#123;</span><br><span class="line">    <span class="comment">//打开适配器失败,打印错误并释放适配器列表</span></span><br><span class="line">	<span class="function"><span class="title">fprintf</span>(stderr,"\nUnable to open the adapter. %s <span class="keyword">is</span> <span class="built_in">not</span> supported <span class="keyword">by</span> WinPcap\n", d-&gt;</span><span class="keyword">name</span>);</span><br><span class="line">    <span class="comment">// 释放设备列表 </span></span><br><span class="line">    pcap_freealldevs(alldevs);</span><br><span class="line">    return -<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	int num2;</span><br><span class="line">	printf(<span class="string">"请输入你要接收数据的网卡代号:"</span>);</span><br><span class="line">	<span class="comment">//让用户选择用哪个网卡来收数据</span></span><br><span class="line">	scanf_s(<span class="string">"%d"</span>,&amp;num2);</span><br><span class="line">	<span class="comment">//用户输入的数字超出合理范围</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//跳转到选中的适配器</span></span><br><span class="line">	<span class="function"><span class="title">for</span>(d2=alldevs, i=0; i&lt; num2-1 ; d2=d2-&gt;</span>next, i++);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//运行到此处说明用户的输入是合法的</span></span><br><span class="line">	<span class="function"><span class="title">if</span>((adhandle2 = pcap_open(d2-&gt;</span><span class="keyword">name</span>,		<span class="comment">//设备名称</span></span><br><span class="line">													<span class="number">65535</span>,       <span class="comment">//存放数据包的内容长度</span></span><br><span class="line">													PCAP_OPENFLAG_PROMISCUOUS,  <span class="comment">//混杂模式</span></span><br><span class="line">													<span class="number">1000</span>,           <span class="comment">//超时时间</span></span><br><span class="line">													NULL,          <span class="comment">//远程验证</span></span><br><span class="line">													errbuf         <span class="comment">//错误缓冲</span></span><br><span class="line">													)) == NULL)&#123;</span><br><span class="line">    <span class="comment">//打开适配器失败,打印错误并释放适配器列表</span></span><br><span class="line">	<span class="function"><span class="title">fprintf</span>(stderr,"\nUnable to open the adapter. %s <span class="keyword">is</span> <span class="built_in">not</span> supported <span class="keyword">by</span> WinPcap\n", d2-&gt;</span><span class="keyword">name</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来用用于发送的handle处理器来扫描它的局域网IP，获得局域网内的MAC地址，记录在一个表中,存放IP和MAC的对应关系。 这个表可以用结构体数组来保存，比如可以这样:</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">struct ip_mac_list&#123;</span><br><span class="line">	IpAddress ip;</span><br><span class="line">	unsigned char mac[6];</span><br><span class="line">&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">ip_mac_list  list[<span class="number">256</span>];                       <span class="comment">//存储IP和MAC地址的对应表</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>那么以上便是准备工作，我们完成了两个网卡的打开，发送网卡扫描获取局域网MAC，接下来便是最重要的监听加转发。 那么这个怎办？那就开一个新线程。 让我们声明一个新的路由线程。</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">DWORD WINAPI RouteThread(<span class="name">LPVOID</span> lpParameter)<span class="comment">;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>那么线程要接收进来什么参数呢？ 首先必须要的是两个网卡处理器，在main方法中已经做好初始化的adhandle和adhandle2，另外还有alldevs，可以持有这个指针来释放设备列表，出现错误时释放资源并退出。 初级功能中声明过了 struct sparam sp; struct gparam gp; 这两个就是发送ARP线程和接收ARP线程中的两个参数，那么仿照这个功能，我们定义一个新的结构体</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rparam</span>&#123;</span></span><br><span class="line">	<span class="keyword">pcap_t</span> *adhandle_rec;</span><br><span class="line">	<span class="keyword">pcap_t</span> *adhandle_send;</span><br><span class="line">	<span class="keyword">pcap_if_t</span>  * alldevs;       <span class="comment">//所有网络适配器</span></span><br><span class="line">&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在main方法中把它来初始化赋值</p>
                  <figure class="highlight abnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">rp.adhandle_send = adhandle<span class="comment">;</span></span><br><span class="line">	rp.adhandle_rec = adhandle2<span class="comment">;</span></span><br><span class="line">	rp.alldevs = alldevs<span class="comment">;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>当做参数传入这个线程</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">routethread = CreateThread(<span class="name">NULL</span>, <span class="number">0</span>, (<span class="name">LPTHREAD_START_ROUTINE</span>) RouteThread, <span class="symbol">&amp;rp</span>,</span><br><span class="line">			<span class="number">0</span>, NULL)<span class="comment">;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中第四个参数就是传递了这个结构体进去。注意这个语句最好不要直接放在main方法中直接调用，可以在全部获取完MAC地址之后再开启这个线程。 那么接下来就说一下这个线程都干了些什么，只简略说一下核心部分。 首先开启了这个线程之后会一直都在执行，那么就可以加入</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">while((<span class="name">res</span> = pcap_next_ex(<span class="name">adhandle2</span>,<span class="symbol">&amp;header</span>,<span class="symbol">&amp;pkt_data</span>))&gt;=0)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样的while判断语句来一直监听数据包的接收，然后解析数据。</p>
                  <figure class="highlight perl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">ethernet =  (EthernetHeader *)(pkt_data);</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)&#123;</span><br><span class="line">				sou_mac[i] = ethernet-&gt;SourMAC[i];</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)&#123;</span><br><span class="line">				des_mac[i] = ethernet-&gt;DestMAC[i];</span><br><span class="line">			&#125;</span><br><span class="line">			// 获得IP数据包头部的位置</span><br><span class="line">			ip = (IpHeader *) (pkt_data +<span class="number">14</span>);    <span class="regexp">//</span><span class="number">14</span>为以太网帧头部长度</span><br><span class="line">			//获得TCP头部的位置</span><br><span class="line">			ip_len = (ip-&gt;Version_HLen &amp; <span class="number">0xf</span>) *<span class="number">4</span>;</span><br><span class="line">			tcp = (TcpHeader *)((u_char *)ip+ip_len);</span><br><span class="line">			data = (char *)((u_char *)tcp+<span class="number">20</span>);</span><br><span class="line">			<span class="keyword">printf</span>(<span class="string">"data:%s\n"</span>,data);</span><br><span class="line">			<span class="keyword">printf</span>(<span class="string">"ip:"</span>);</span><br><span class="line">			<span class="keyword">printf</span>(<span class="string">"%d.%d.%d.%d -&gt; %d.%d.%d.%d\n"</span>,</span><br><span class="line">					ip-&gt;SourceAddr.byte1,</span><br><span class="line">					ip-&gt;SourceAddr.byte2,</span><br><span class="line">					ip-&gt;SourceAddr.byte3,</span><br><span class="line">					ip-&gt;SourceAddr.byte4,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte1,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte2,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte3,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte4);</span><br><span class="line">			 <span class="keyword">printf</span>(<span class="string">"sou_mac:%02x-%02x-%02x-%02x-%02x-%02x\n"</span>, sou_mac[<span class="number">0</span>], sou_mac[<span class="number">1</span>], sou_mac[<span class="number">2</span>],</span><br><span class="line">			    sou_mac[<span class="number">3</span>], sou_mac[<span class="number">4</span>], sou_mac[<span class="number">5</span>]);</span><br><span class="line">			<span class="keyword">printf</span>(<span class="string">"des_mac:%02x-%02x-%02x-%02x-%02x-%02x\n"</span>, des_mac[<span class="number">0</span>], des_mac[<span class="number">1</span>], des_mac[<span class="number">2</span>],</span><br><span class="line">			    des_mac[<span class="number">3</span>], des_mac[<span class="number">4</span>], des_mac[<span class="number">5</span>]);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后接下来每接收到一个数据，就进行构建新的帧转发出去，目的MAC先匹配list表，如果list没有找到，那么我让他指定了一个mac，比如广播MAC。源MAC地址则赋值网卡的MAC地址。 注意，传统以太网中数据长度为45-1500，那么我在构建前把解析出的data作了下判断长度再构建，因为我已经把sendbuffer声明为一个固定长度了，为了防止越界，我先进行一个长度判断。</p>
                  <figure class="highlight lsl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//以下开始构建帧发送</span></span><br><span class="line">		<span class="comment">//首先判断data最大值小于1500</span></span><br><span class="line">		if(strlen(data)&lt;<span class="number">1500</span>)&#123;</span><br><span class="line">			<span class="comment">//目的MAC</span></span><br><span class="line">			BYTE send_destmac[<span class="number">6</span>];</span><br><span class="line">			bool findMac = false;</span><br><span class="line">			for(int c = <span class="number">0</span>;c&lt;con;c++)&#123;</span><br><span class="line">				if(ip-&gt;DestinationAddr.byte1 ==  <span class="type">list</span>[c].ip.byte1&amp;&amp;</span><br><span class="line">					ip-&gt;DestinationAddr.byte2 == <span class="type">list</span>[c].ip.byte2&amp;&amp;</span><br><span class="line">					ip-&gt;DestinationAddr.byte3 == <span class="type">list</span>[c].ip.byte3&amp;&amp;</span><br><span class="line">					ip-&gt;DestinationAddr.byte4 == <span class="type">list</span>[c].ip.byte4)</span><br><span class="line">				&#123;</span><br><span class="line">					printf(<span class="string">"Find its MAC!<span class="subst">\n</span>"</span>);</span><br><span class="line">					findMac = true;</span><br><span class="line">					send_destmac[<span class="number">0</span>] = <span class="type">list</span>[c].mac[<span class="number">0</span>];   </span><br><span class="line">					send_destmac[<span class="number">1</span>] = <span class="type">list</span>[c].mac[<span class="number">1</span>];</span><br><span class="line">					send_destmac[<span class="number">2</span>] = <span class="type">list</span>[c].mac[<span class="number">2</span>];</span><br><span class="line">					send_destmac[<span class="number">3</span>] = <span class="type">list</span>[c].mac[<span class="number">3</span>];</span><br><span class="line">					send_destmac[<span class="number">4</span>] = <span class="type">list</span>[c].mac[<span class="number">4</span>];</span><br><span class="line">					send_destmac[<span class="number">5</span>] = <span class="type">list</span>[c].mac[<span class="number">5</span>];</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			if(!findMac)&#123;</span><br><span class="line">				send_destmac[<span class="number">0</span>] = <span class="number">0xff</span>;   </span><br><span class="line">				send_destmac[<span class="number">1</span>] = <span class="number">0xff</span>;   </span><br><span class="line">				send_destmac[<span class="number">2</span>] = <span class="number">0xff</span>;   </span><br><span class="line">				send_destmac[<span class="number">3</span>] = <span class="number">0xff</span>;   </span><br><span class="line">				send_destmac[<span class="number">4</span>] = <span class="number">0xff</span>;   </span><br><span class="line">				send_destmac[<span class="number">5</span>] = <span class="number">0xff</span>;   </span><br><span class="line">			&#125;</span><br><span class="line">			printf(<span class="string">"destmac:%02x-%02x-%02x-%02x-%02x-%02x<span class="subst">\n</span>"</span>,</span><br><span class="line">				send_destmac[<span class="number">0</span>],send_destmac[<span class="number">1</span>],send_destmac[<span class="number">2</span>],</span><br><span class="line">				send_destmac[<span class="number">3</span>],send_destmac[<span class="number">4</span>],send_destmac[<span class="number">5</span>]</span><br><span class="line">				);</span><br><span class="line">			memcpy(send_ethernet.DestMAC, send_destmac, <span class="number">6</span>);</span><br><span class="line">			<span class="comment">//源MAC地址</span></span><br><span class="line">			BYTE send_hostmac[<span class="number">6</span>];</span><br><span class="line">			<span class="comment">//源MAC地址</span></span><br><span class="line">			send_hostmac[<span class="number">0</span>] = local_mac[<span class="number">0</span>];     <span class="comment">//赋值本地MAC地址</span></span><br><span class="line">			send_hostmac[<span class="number">1</span>] = local_mac[<span class="number">1</span>];</span><br><span class="line">			send_hostmac[<span class="number">2</span>] = local_mac[<span class="number">2</span>];</span><br><span class="line">			send_hostmac[<span class="number">3</span>] = local_mac[<span class="number">3</span>];</span><br><span class="line">			send_hostmac[<span class="number">4</span>] = local_mac[<span class="number">4</span>];</span><br><span class="line">			send_hostmac[<span class="number">5</span>] = local_mac[<span class="number">5</span>];</span><br><span class="line">			<span class="comment">//赋值源MAC地址</span></span><br><span class="line">			memcpy(send_ethernet.SourMAC, send_hostmac, <span class="number">6</span>);</span><br><span class="line">			send_ethernet.EthType = htons(<span class="number">0x0800</span>);</span><br><span class="line">			<span class="comment">//赋值SendBuffer</span></span><br><span class="line">			memcpy(&amp;SendBuffer, &amp;send_ethernet, sizeof(struct EthernetHeader));</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上只是赋值了帧头，至于IP头，TCP头，数据的赋值就参照初级功能的来赋值吧，不要忘了校验和的检验。好，大体上就是这样，接受来数据包并转发出去的原理就是这样。</p>
                  <h3 id="三、接收"><a href="#三、接收" class="headerlink" title="三、接收"></a>三、接收</h3>
                  <p>不用多改，就是初级功能中的接收，在此写一写小小的优化措施，防止接收到过多的数据帧而造成不断乱蹦，导致你看不到接收的东西。 在打印的时候加一个过滤就好了。部分代码如下： 在main方法中提示用户输入要接收的IP地址</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">printf(<span class="string">"请输入要接收的IP地址,输入0.0.0.0代表全部接收,请输入\n"</span>);</span><br><span class="line">	<span class="built_in">bool</span> receiveAll = <span class="literal">false</span>;</span><br><span class="line">	u_int ip1,ip2,ip3,ip4;</span><br><span class="line">	<span class="built_in">bool</span> legal = <span class="literal">false</span>;</span><br><span class="line">	<span class="keyword">while</span>(!legal)&#123;</span><br><span class="line">		scanf_s(<span class="string">"%d.%d.%d.%d"</span>,&amp;ip1,&amp;ip2,&amp;ip3,&amp;ip4);</span><br><span class="line">		<span class="keyword">if</span>(ip1==<span class="number">0</span>&amp;&amp;ip2==<span class="number">0</span>&amp;&amp;ip3==<span class="number">0</span>&amp;&amp;ip4==<span class="number">0</span>)&#123;</span><br><span class="line">			receiveAll = <span class="literal">true</span>;</span><br><span class="line">			legal = <span class="literal">true</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(ip1&lt;<span class="number">0</span>||ip1&gt;<span class="number">255</span>||ip2&lt;<span class="number">0</span>||ip2&gt;<span class="number">255</span>||ip3&lt;<span class="number">0</span>||ip3&gt;<span class="number">255</span>||ip4&lt;<span class="number">1</span>||ip4&gt;<span class="number">254</span>)&#123;</span><br><span class="line">			legal = <span class="literal">false</span>;</span><br><span class="line">			printf(<span class="string">"对不起,IP输入不合法,请重新输入:\n"</span>);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			legal = <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>打印时的判断</p>
                  <figure class="highlight perl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">if</span>(receiveAll||(ip-&gt;SourceAddr.byte1==ip1&amp;&amp;</span><br><span class="line">					ip-&gt;SourceAddr.byte2==ip2&amp;&amp;</span><br><span class="line">					ip-&gt;SourceAddr.byte3==ip3&amp;&amp;</span><br><span class="line">					ip-&gt;SourceAddr.byte4==ip4))&#123;</span><br><span class="line">					<span class="keyword">printf</span>(<span class="string">"%d.%d.%d.%d.%d -&gt; %d.%d.%d.%d.%d\n"</span>,</span><br><span class="line">					ip-&gt;SourceAddr.byte1,</span><br><span class="line">					ip-&gt;SourceAddr.byte2,</span><br><span class="line">					ip-&gt;SourceAddr.byte3,</span><br><span class="line">					ip-&gt;SourceAddr.byte4,</span><br><span class="line">				    sport,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte1,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte2,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte3,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte4,</span><br><span class="line">				    dport);</span><br><span class="line">			    <span class="keyword">printf</span>(<span class="string">"sou_mac:%02x-%02x-%02x-%02x-%02x-%02x\n"</span>, sou_mac[<span class="number">0</span>], sou_mac[<span class="number">1</span>], sou_mac[<span class="number">2</span>],</span><br><span class="line">			    sou_mac[<span class="number">3</span>], sou_mac[<span class="number">4</span>], sou_mac[<span class="number">5</span>]);</span><br><span class="line">				<span class="keyword">printf</span>(<span class="string">"des_mac:%02x-%02x-%02x-%02x-%02x-%02x\n"</span>, des_mac[<span class="number">0</span>], des_mac[<span class="number">1</span>], des_mac[<span class="number">2</span>],</span><br><span class="line">			    des_mac[<span class="number">3</span>], des_mac[<span class="number">4</span>], des_mac[<span class="number">5</span>]);</span><br><span class="line">				<span class="keyword">printf</span>(<span class="string">"%s\n"</span>,data);</span><br><span class="line">				<span class="keyword">printf</span>(<span class="string">"-----------------------------------------------------\n"</span>);</span><br><span class="line">			&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好，代码就先放送这么多，具体的实现只要有了思路我相信肯定不难，如有问题，欢迎与我交流。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-07-13 01:19:22" itemprop="dateCreated datePublished" datetime="2015-07-13T01:19:22+08:00">2015-07-13</time>
                </span>
                <span id="/1922.html" class="post-meta-item leancloud_visitors" data-flag-title="Winpcap网络编程六之两台主机通过中间主机通信" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>7.3k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>7 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1918.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> C/C++ <i class="label-arrow"></i>
                  </a>
                  <a href="/1918.html" class="post-title-link" itemprop="url">Winpcap网络编程五之ARP协议获得MAC表及主机通信</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="学习文档"><a href="#学习文档" class="headerlink" title="学习文档"></a>学习文档</h2>
                  <p>这里我们直接进入正题吧，关于Winpcap的基础知识讲解这里就不再赘述了。在这里给大家提供一些学习网址 <a href="http://blog.csdn.net/column/details/winpcap.html" target="_blank" rel="noopener">Winpcap网络编程及通信教程</a><a href="http://www.ferrisxu.com/WinPcap/html/" target="_blank" rel="noopener">Winpcap中文技术文档</a></p>
                  <h2 id="学习内容"><a href="#学习内容" class="headerlink" title="学习内容"></a>学习内容</h2>
                  <ul>
                    <li>获取设备列表</li>
                    <li>获取已安装设备的高级信息</li>
                    <li>打开适配器并捕获数据包</li>
                    <li>不用回调方法捕获数据包</li>
                    <li>过滤数据包</li>
                    <li>分析数据包</li>
                    <li>处理脱机堆文件</li>
                    <li>发送数据包</li>
                    <li>收集并统计网络流量</li>
                  </ul>
                  <p>这些内容，在上述两个链接中均已经有了比较详细的讲解，希望对大家有帮助。</p>
                  <h2 id="两台主机通信实战"><a href="#两台主机通信实战" class="headerlink" title="两台主机通信实战"></a>两台主机通信实战</h2>
                  <p>完成两台主机之间的数据通信（数据链路层）</p>
                  <ul>
                    <li>仿真ARP协议获得网段内主机的MAC表</li>
                    <li>使用帧完成两台主机的通信（Hello! I’m …)</li>
                  </ul>
                  <p>首先我们要理解ARP是干嘛的，ARP主要作用就是通过IP地址来获取MAC地址。那么怎样获取呢？本机向局域网内主机发送ARP包，ARP包内包含了目的IP，源IP，目的MAC，源MAC，其中目的MAC地址为广播地址,FF-FF-FF-FF-FF-FF,即向局域网内所有主机发送一个ARP请求，那么其他主机收到这个请求之后则会向请求来源返回一个数据包。在这个返回的数据包中包含了自身的MAC地址。那么本机收到这些返回的数据包进行解析之后便会得到局域网内所有主机的MAC地址了.. 编程开始： 新建一个C++项目，配好环境，引入Winpcap相关的库，这些不再赘述。 头文件引入</p>
                  <figure class="highlight dts">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HAVE_REMOTE</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> WPCAP</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pcap.h&gt;</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在main函数中首先声明一系列变量如下</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">char</span> *ip_addr;                                    <span class="comment">//IP地址</span></span><br><span class="line"><span class="keyword">char</span> *ip_netmask;                             <span class="comment">//子网掩码</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> *ip_mac;          <span class="comment">//本机MAC地址</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>为这三个变量分配地址空间</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">ip_addr = (<span class="keyword">char</span> *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">char</span>) * <span class="number">16</span>); <span class="comment">//申请内存存放IP地址</span></span><br><span class="line">	<span class="keyword">if</span> (ip_addr == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"申请内存存放IP地址失败!\n"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	ip_netmask = (<span class="keyword">char</span> *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">char</span>) * <span class="number">16</span>); <span class="comment">//申请内存存放NETMASK地址</span></span><br><span class="line">	<span class="keyword">if</span> (ip_netmask == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"申请内存存放NETMASK地址失败!\n"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	ip_mac = (<span class="keyword">unsigned</span> <span class="keyword">char</span> *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">unsigned</span> <span class="keyword">char</span>) * <span class="number">6</span>); <span class="comment">//申请内存存放MAC地址</span></span><br><span class="line">	<span class="keyword">if</span> (ip_mac == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"申请内存存放MAC地址失败!\n"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来就是烂大街的程序,获取适配器列表并选中相应的适配器,注释已经在代码中了,如果还有不明白的请参照前几次的讲解。</p>
                  <figure class="highlight xl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//获取本地适配器列表</span></span><br><span class="line">	<span class="keyword">if</span>(pcap_findalldevs_ex(PCAP_SRC_IF_STRING,NULL,&amp;alldevs,errbuf) == -<span class="number">1</span>)&#123;</span><br><span class="line">		<span class="comment">//结果为-1代表出现获取适配器列表失败</span></span><br><span class="line">		fprintf(stderr,<span class="string">"Error in pcap_findalldevs_ex:\n"</span>,errbuf);</span><br><span class="line">		<span class="comment">//exit(0)代表正常退出,exit(other)为非正常退出,这个值会传给操作系统</span></span><br><span class="line">		exit(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="title">for</span>(d = alldevs;d !=NULL;d = d-&gt;</span>next)&#123;</span><br><span class="line">		<span class="function"><span class="title">printf</span>("-----------------------------------------------------------------\nnumber:%d\nname:%s\n",++i,d-&gt;</span><span class="keyword">name</span>);</span><br><span class="line">		<span class="function"><span class="title">if</span>(d-&gt;</span>description)&#123;</span><br><span class="line">			<span class="comment">//打印适配器的描述信息</span></span><br><span class="line">			<span class="function"><span class="title">printf</span>("description:%s\n",d-&gt;</span>description);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">//适配器不存在描述信息</span></span><br><span class="line">			printf(<span class="string">"description:%s"</span>,<span class="string">"no description\n"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//打印本地环回地址</span></span><br><span class="line">		 <span class="function"><span class="title">printf</span>("\tLoopback: %s\n",(d-&gt;</span>flags &amp; PCAP_IF_LOOPBACK)?<span class="string">"yes"</span>:<span class="string">"no"</span>);</span><br><span class="line">		 <span class="comment">/**</span></span><br><span class="line"><span class="comment">		 pcap_addr *  next     指向下一个地址的指针</span></span><br><span class="line"><span class="comment">		 sockaddr *  addr       IP地址</span></span><br><span class="line"><span class="comment">		 sockaddr *  netmask  子网掩码</span></span><br><span class="line"><span class="comment">		 sockaddr *  broadaddr   广播地址</span></span><br><span class="line"><span class="comment">		 sockaddr *  dstaddr        目的地址</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		 pcap_addr_t *a;       <span class="comment">//网络适配器的地址用来存储变量</span></span><br><span class="line">		 <span class="function"><span class="title">for</span>(a = d-&gt;</span><span class="function"><span class="title">addresses</span>;a;a = a-&gt;</span>next)&#123;</span><br><span class="line">			 <span class="comment">//sa_family代表了地址的类型,是IPV4地址类型还是IPV6地址类型</span></span><br><span class="line">			 <span class="function"><span class="title">switch</span> (a-&gt;</span><span class="function"><span class="title">addr</span>-&gt;</span>sa_family)</span><br><span class="line">			 &#123;</span><br><span class="line">				 case AF_INET:  <span class="comment">//代表IPV4类型地址</span></span><br><span class="line">					 printf(<span class="string">"Address Family Name:AF_INET\n"</span>);</span><br><span class="line">					 <span class="function"><span class="title">if</span>(a-&gt;</span>addr)&#123;</span><br><span class="line">						 <span class="comment">//-&gt;的优先级等同于括号,高于强制类型转换,因为addr为sockaddr类型，对其进行操作须转换为sockaddr_in类型</span></span><br><span class="line">						 <span class="function"><span class="title">printf</span>("Address:%s\n",iptos(((struct sockaddr_in *)a-&gt;</span><span class="function"><span class="title">addr</span>)-&gt;</span>sin_addr.s_addr));</span><br><span class="line">					 &#125;</span><br><span class="line">					<span class="function"><span class="title">if</span> (a-&gt;</span>netmask)&#123;</span><br><span class="line">						 <span class="function"><span class="title">printf</span>("\tNetmask: %s\n",iptos(((struct sockaddr_in *)a-&gt;</span><span class="function"><span class="title">netmask</span>)-&gt;</span>sin_addr.s_addr));</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="function"><span class="title">if</span> (a-&gt;</span>broadaddr)&#123;</span><br><span class="line">						   <span class="function"><span class="title">printf</span>("\tBroadcast Address: %s\n",iptos(((struct sockaddr_in *)a-&gt;</span><span class="function"><span class="title">broadaddr</span>)-&gt;</span>sin_addr.s_addr));</span><br><span class="line">					 &#125;</span><br><span class="line">					 <span class="function"><span class="title">if</span> (a-&gt;</span>dstaddr)&#123;</span><br><span class="line">						   <span class="function"><span class="title">printf</span>("\tDestination Address: %s\n",iptos(((struct sockaddr_in *)a-&gt;</span><span class="function"><span class="title">dstaddr</span>)-&gt;</span>sin_addr.s_addr));</span><br><span class="line">					 &#125;</span><br><span class="line">        			 break;</span><br><span class="line">				 case AF_INET6: <span class="comment">//代表IPV6类型地址</span></span><br><span class="line">					 printf(<span class="string">"Address Family Name:AF_INET6\n"</span>);</span><br><span class="line">					 printf(<span class="string">"this is an IPV6 address\n"</span>);</span><br><span class="line">					 break;</span><br><span class="line">				 default:</span><br><span class="line">					 break;</span><br><span class="line">			 &#125;</span><br><span class="line">		 &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//i为0代表上述循环未进入,即没有找到适配器,可能的原因为Winpcap没有安装导致未扫描到</span></span><br><span class="line">	<span class="keyword">if</span>(i == <span class="number">0</span>)&#123;</span><br><span class="line">		printf(<span class="string">"interface not found,please check winpcap installation"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	int num;</span><br><span class="line">	printf(<span class="string">"Enter the interface number(1-%d):"</span>,i);</span><br><span class="line">	<span class="comment">//让用户选择选择哪个适配器进行抓包</span></span><br><span class="line">	scanf_s(<span class="string">"%d"</span>,&amp;num);</span><br><span class="line">	printf(<span class="string">"\n"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//用户输入的数字超出合理范围</span></span><br><span class="line">	<span class="keyword">if</span>(num&lt;<span class="number">1</span>||num&gt;i)&#123;</span><br><span class="line">		printf(<span class="string">"number out of range\n"</span>);</span><br><span class="line">		pcap_freealldevs(alldevs);</span><br><span class="line">		return -<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//跳转到选中的适配器</span></span><br><span class="line">	<span class="function"><span class="title">for</span>(d=alldevs, i=0; i&lt; num-1 ; d=d-&gt;</span>next, i++);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//运行到此处说明用户的输入是合法的</span></span><br><span class="line">	<span class="function"><span class="title">if</span>((adhandle = pcap_open(d-&gt;</span><span class="keyword">name</span>,		<span class="comment">//设备名称</span></span><br><span class="line">														<span class="number">65535</span>,       <span class="comment">//存放数据包的内容长度</span></span><br><span class="line">														PCAP_OPENFLAG_PROMISCUOUS,  <span class="comment">//混杂模式</span></span><br><span class="line">														<span class="number">1000</span>,           <span class="comment">//超时时间</span></span><br><span class="line">														NULL,          <span class="comment">//远程验证</span></span><br><span class="line">														errbuf         <span class="comment">//错误缓冲</span></span><br><span class="line">														)) == NULL)&#123;</span><br><span class="line">        <span class="comment">//打开适配器失败,打印错误并释放适配器列表</span></span><br><span class="line">		<span class="function"><span class="title">fprintf</span>(stderr,"\nUnable to open the adapter. %s <span class="keyword">is</span> <span class="built_in">not</span> supported <span class="keyword">by</span> WinPcap\n", d-&gt;</span><span class="keyword">name</span>);</span><br><span class="line">        <span class="comment">// 释放设备列表 </span></span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        return -<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>上述代码中需要另外声明的有：</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">pcap_if_t</span>  * alldevs;       <span class="comment">//所有网络适配器</span></span><br><span class="line"><span class="keyword">pcap_if_t</span>  *d;					<span class="comment">//选中的网络适配器</span></span><br><span class="line"><span class="keyword">char</span> errbuf[PCAP_ERRBUF_SIZE];   <span class="comment">//错误缓冲区,大小为256</span></span><br><span class="line"><span class="keyword">pcap_t</span> *adhandle;           <span class="comment">//捕捉实例,是pcap_open返回的对象</span></span><br><span class="line"><span class="keyword">int</span> i = <span class="number">0</span>;                            <span class="comment">//适配器计数变量</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">iptos</span><span class="params">(u_long in)</span></span>;       <span class="comment">//u_long即为 unsigned long</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 将数字类型的IP地址转换成字符串类型的 */</span></span><br><span class="line">#define IPTOSBUFFERS    <span class="number">12</span></span><br><span class="line">char *iptos(u_long <span class="keyword">in</span>)</span><br><span class="line">&#123;</span><br><span class="line">    static char output[IPTOSBUFFERS][<span class="number">3</span>*<span class="number">4</span>+<span class="number">3</span>+<span class="number">1</span>];</span><br><span class="line">    static short which;</span><br><span class="line">    u_char *p;</span><br><span class="line"></span><br><span class="line">    p = (u_char *)&amp;<span class="keyword">in</span>;</span><br><span class="line">    which = (which + <span class="number">1</span> == IPTOSBUFFERS ? <span class="number">0</span> : which + <span class="number">1</span>);</span><br><span class="line">    sprintf_s(output[which], <span class="string">"%d.%d.%d.%d"</span>, p[<span class="number">0</span>], p[<span class="number">1</span>], p[<span class="number">2</span>], p[<span class="number">3</span>]);</span><br><span class="line">    <span class="keyword">return</span> output[which];</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>到此程序应该会编译通过，可以试着编译一下运行。 GO ON… 接下来我们首先要用ifget方法获取自身的IP和子网掩码 函数声明：</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ifget</span><span class="params">(<span class="keyword">pcap_if_t</span> *d, <span class="keyword">char</span> *ip_addr, <span class="keyword">char</span> *ip_netmask)</span></span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight livescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="regexp">//获取IP和子网掩码赋值为ip_addr和ip_netmask</span></span><br><span class="line"><span class="regexp">void ifget(pcap_if_t *d, char *ip_addr, char *ip_netmask) &#123;</span></span><br><span class="line"><span class="regexp">	pcap_addr_t *a;</span></span><br><span class="line"><span class="regexp">	//</span>遍历所有的地址,a代表一个pcap_addr</span><br><span class="line">	<span class="keyword">for</span> (a = d-&gt;addresses; a; a = a-&gt;next) &#123;</span><br><span class="line">		<span class="keyword">switch</span> (a-&gt;addr-&gt;sa_family) &#123;</span><br><span class="line">		<span class="keyword">case</span> AF_INET:  <span class="regexp">//sa_family ：是2字节的地址家族，一般都是“AF_xxx”的形式。通常用的都是AF_INET。代表IPV4</span></span><br><span class="line"><span class="regexp">			if (a-&gt;addr) &#123;</span></span><br><span class="line"><span class="regexp">				char *ipstr;</span></span><br><span class="line"><span class="regexp">				//</span>将地址转化为字符串</span><br><span class="line">				ipstr = iptos<span class="function"><span class="params">(((struct sockaddr_in *) a-&gt;addr)-&gt;sin_addr.s_addr)</span>; //*<span class="title">ip_addr</span></span></span><br><span class="line"><span class="function">				<span class="title">printf</span><span class="params">(<span class="string">"ipstr:%s\n"</span>,ipstr)</span>;</span></span><br><span class="line"><span class="function">				<span class="title">memcpy</span><span class="params">(ip_addr, ipstr, <span class="number">16</span>)</span>;</span></span><br><span class="line"><span class="function">			&#125;</span></span><br><span class="line"><span class="function">			<span class="title">if</span> <span class="params">(a-&gt;netmask)</span> &#123;</span></span><br><span class="line"><span class="function">				<span class="title">char</span> *<span class="title">netmaskstr</span>;</span></span><br><span class="line"><span class="function">				<span class="title">netmaskstr</span> = <span class="title">iptos</span><span class="params">(((struct sockaddr_in *) a-&gt;netmask)-&gt;sin_addr.s_addr)</span>;</span></span><br><span class="line"><span class="function">				<span class="title">printf</span><span class="params">(<span class="string">"netmask:%s\n"</span>,netmaskstr)</span>;</span></span><br><span class="line"><span class="function">				<span class="title">memcpy</span><span class="params">(ip_netmask, netmaskstr, <span class="number">16</span>)</span>;</span></span><br><span class="line"><span class="function">			&#125;</span></span><br><span class="line"><span class="function">		<span class="title">case</span> <span class="title">AF_INET6</span>:</span></span><br><span class="line"><span class="function">			<span class="title">break</span>;</span></span><br><span class="line"><span class="function">		&#125;</span></span><br><span class="line"><span class="function">	&#125;</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>main函数继续写，如下调用，之前声明的ip_addr和ip_netmask就已经被赋值了</p>
                  <figure class="highlight brainfuck">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">ifget(d</span><span class="string">,</span> <span class="comment">ip_addr</span><span class="string">,</span> <span class="comment">ip_netmask);</span> <span class="comment">//获取所选网卡的基本信息</span>--<span class="comment">掩码</span>--<span class="comment">IP地址</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>到现在我们已经获取到了本机的IP和子网掩码，下一步发送一个ARP请求来获取自身的MAC地址 这个ARP请求的源IP地址就随便指定了，就相当于你构造了一个外来的ARP请求，本机捕获到了请求，然后发送回应给对方的数据包也被本机捕获到了并解析出来了。解析了自己发出去的数据包而已。 那么我们就声明一个函数并实现：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">int</span> <span class="constructor">GetSelfMac(<span class="params">pcap_t</span> <span class="operator">*</span><span class="params">adhandle</span>, <span class="params">const</span> <span class="params">char</span> <span class="operator">*</span><span class="params">ip_addr</span>, <span class="params">unsigned</span> <span class="params">char</span> <span class="operator">*</span><span class="params">ip_mac</span>)</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">// 获取自己主机的MAC地址</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">GetSelfMac</span><span class="params">(<span class="keyword">pcap_t</span> *adhandle, <span class="keyword">const</span> <span class="keyword">char</span> *ip_addr, <span class="keyword">unsigned</span> <span class="keyword">char</span> *ip_mac)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> sendbuf[<span class="number">42</span>]; <span class="comment">//arp包结构大小</span></span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">int</span> res;</span><br><span class="line">	EthernetHeader eh; <span class="comment">//以太网帧头</span></span><br><span class="line">	Arpheader ah;  <span class="comment">//ARP帧头</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">pcap_pkthdr</span> * <span class="title">pkt_header</span>;</span></span><br><span class="line">	<span class="keyword">const</span> u_char * pkt_data;</span><br><span class="line">	<span class="comment">//将已开辟内存空间 eh.dest_mac_add 的首 6个字节的值设为值 0xff。</span></span><br><span class="line">	<span class="built_in">memset</span>(eh.DestMAC, <span class="number">0xff</span>, <span class="number">6</span>); <span class="comment">//目的地址为全为广播地址</span></span><br><span class="line">	<span class="built_in">memset</span>(eh.SourMAC, <span class="number">0x0f</span>, <span class="number">6</span>);</span><br><span class="line">	<span class="built_in">memset</span>(ah.DestMacAdd, <span class="number">0x0f</span>, <span class="number">6</span>);</span><br><span class="line">	<span class="built_in">memset</span>(ah.SourceMacAdd, <span class="number">0x00</span>, <span class="number">6</span>);</span><br><span class="line">	<span class="comment">//htons将一个无符号短整型的主机数值转换为网络字节顺序</span></span><br><span class="line">	eh.EthType = htons(ETH_ARP);</span><br><span class="line">	ah.HardwareType= htons(ARP_HARDWARE);</span><br><span class="line">	ah.ProtocolType = htons(ETH_IP);</span><br><span class="line">	ah.HardwareAddLen = <span class="number">6</span>;</span><br><span class="line">	ah.ProtocolAddLen = <span class="number">4</span>;</span><br><span class="line">	ah.SourceIpAdd = inet_addr(<span class="string">"100.100.100.100"</span>); <span class="comment">//随便设的请求方ip</span></span><br><span class="line">	ah.OperationField = htons(ARP_REQUEST);</span><br><span class="line">	ah.DestIpAdd = inet_addr(ip_addr);</span><br><span class="line">	<span class="built_in">memset</span>(sendbuf, <span class="number">0</span>, <span class="keyword">sizeof</span>(sendbuf));</span><br><span class="line">	<span class="built_in">memcpy</span>(sendbuf, &amp;eh, <span class="keyword">sizeof</span>(eh));</span><br><span class="line">	<span class="built_in">memcpy</span>(sendbuf + <span class="keyword">sizeof</span>(eh), &amp;ah, <span class="keyword">sizeof</span>(ah));</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%s"</span>,sendbuf);</span><br><span class="line">	<span class="keyword">if</span> (pcap_sendpacket(adhandle, sendbuf, <span class="number">42</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"\nPacketSend succeed\n"</span>);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"PacketSendPacket in getmine Error: %d\n"</span>, GetLastError());</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//从interface或离线记录文件获取一个报文</span></span><br><span class="line">	<span class="comment">//pcap_next_ex(pcap_t* p,struct pcap_pkthdr** pkt_header,const u_char** pkt_data)</span></span><br><span class="line">	<span class="keyword">while</span> ((res = pcap_next_ex(adhandle, &amp;pkt_header, &amp;pkt_data)) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (*(<span class="keyword">unsigned</span> short *) (pkt_data + <span class="number">12</span>) == htons(ETH_ARP)</span><br><span class="line">				&amp;&amp; *(<span class="keyword">unsigned</span> short*) (pkt_data + <span class="number">20</span>) == htons(ARP_REPLY)</span><br><span class="line">				&amp;&amp; *(<span class="keyword">unsigned</span> <span class="keyword">long</span>*) (pkt_data + <span class="number">38</span>)</span><br><span class="line">						== inet_addr(<span class="string">"100.100.100.100"</span>)) &#123;</span><br><span class="line">			<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">				ip_mac[i] = *(<span class="keyword">unsigned</span> <span class="keyword">char</span> *) (pkt_data + <span class="number">22</span> + i);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"获取自己主机的MAC地址成功!\n"</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (i == <span class="number">6</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中我们需要定义一下常量如下</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ETH_ARP         0x0806  <span class="comment">//以太网帧类型表示后面数据的类型，对于ARP请求或应答来说，该字段的值为x0806</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ARP_HARDWARE    1  <span class="comment">//硬件类型字段值为表示以太网地址</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ETH_IP          0x0800  <span class="comment">//协议类型字段表示要映射的协议地址类型值为x0800表示IP地址</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ARP_REQUEST     1   <span class="comment">//ARP请求</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ARP_REPLY       2      <span class="comment">//ARP应答</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HOSTNUM         255   <span class="comment">//主机数量</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外发送ARP请求少不了帧头和ARP头的结构，我们需要声明出来，另外我们构建发送包需要再声明两个结构体sparam和gparam</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//帧头部结构体，共14字节</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">EthernetHeader</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    u_char DestMAC[<span class="number">6</span>];    <span class="comment">//目的MAC地址 6字节</span></span><br><span class="line">    u_char SourMAC[<span class="number">6</span>];   <span class="comment">//源MAC地址 6字节</span></span><br><span class="line">    u_short EthType;         <span class="comment">//上一层协议类型，如0x0800代表上一层是IP协议，0x0806为arp  2字节</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//28字节ARP帧结构</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Arpheader</span> &#123;</span></span><br><span class="line">	<span class="keyword">unsigned</span> short HardwareType; <span class="comment">//硬件类型</span></span><br><span class="line">	<span class="keyword">unsigned</span> short ProtocolType; <span class="comment">//协议类型</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> HardwareAddLen; <span class="comment">//硬件地址长度</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> ProtocolAddLen; <span class="comment">//协议地址长度</span></span><br><span class="line">	<span class="keyword">unsigned</span> short OperationField; <span class="comment">//操作字段</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> SourceMacAdd[<span class="number">6</span>]; <span class="comment">//源mac地址</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> SourceIpAdd; <span class="comment">//源ip地址</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> DestMacAdd[<span class="number">6</span>]; <span class="comment">//目的mac地址</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> DestIpAdd; <span class="comment">//目的ip地址</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//arp包结构</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ArpPacket</span> &#123;</span></span><br><span class="line">	EthernetHeader ed;</span><br><span class="line">	Arpheader ah;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sparam</span> &#123;</span></span><br><span class="line">	<span class="keyword">pcap_t</span> *adhandle;</span><br><span class="line">	<span class="keyword">char</span> *ip;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> *mac;</span><br><span class="line">	<span class="keyword">char</span> *netmask;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">gparam</span> &#123;</span></span><br><span class="line">	<span class="keyword">pcap_t</span> *adhandle;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sparam</span> <span class="title">sp</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">gparam</span> <span class="title">gp</span>;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>到现在代码也是完整可以运行的，如果有问题请检查上述代码完整性和位置。 可能出现的BUG： 只显示ARP发送成功，没有接受到并解析打印。可能的原因是帧构造有问题，字节没有对齐，有偏差，像#define一样 写入如下代码：</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> pack(1)  <span class="comment">//按一个字节内存对齐</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>GO ON.. 获取到了自身的MAC地址之后，就可以在本机上构建ARP广播请求，向局域网内的所有主机发送ARP请求，得到回应之后解析回应的数据包并进行解析，得到对方的MAC地址。在这里我们需要开启两个线程，一个用来发送一个用来接收。好，我们继续.. 先声明两个线程</p>
                  <figure class="highlight lasso">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">HANDLE</span> sendthread;      <span class="comment">//发送ARP包线程</span></span><br><span class="line"><span class="keyword">HANDLE</span> recvthread;       <span class="comment">//接受ARP包线程</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在main方法中继续写，对sp和gp两个ARP请求所需要的结构体进行赋值。赋值什么？就是你之前用ifget获取来的IP地址和子网掩码以及用getSelfMac获取来的MAC地址。</p>
                  <figure class="highlight abnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sp.adhandle = adhandle<span class="comment">;</span></span><br><span class="line">	sp.ip = ip_addr<span class="comment">;</span></span><br><span class="line">	sp.mac = ip_mac<span class="comment">;</span></span><br><span class="line">	sp.netmask = ip_netmask<span class="comment">;</span></span><br><span class="line">	gp.adhandle = adhandle<span class="comment">;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来直接创建两个线程，一个是发送一个接受，分别调用两个方法。</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">sendthread = CreateThread(<span class="name">NULL</span>, <span class="number">0</span>, (<span class="name">LPTHREAD_START_ROUTINE</span>) SendArpPacket,</span><br><span class="line">			<span class="symbol">&amp;sp</span>, <span class="number">0</span>, NULL)<span class="comment">;</span></span><br><span class="line">	recvthread = CreateThread(<span class="name">NULL</span>, <span class="number">0</span>, (<span class="name">LPTHREAD_START_ROUTINE</span>) GetLivePC, <span class="symbol">&amp;gp</span>,</span><br><span class="line">			<span class="number">0</span>, NULL)<span class="comment">;</span></span><br><span class="line">	printf(<span class="string">"\nlistening on 网卡%d ...\n"</span>, i)<span class="comment">;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>那么发送数据包的方法和接收解析数据包的方法怎样实现呢？ 发送数据包，发送数据包先对结构体数据进行赋值，就像getSelfMac方法一样，然后声明了一个buffer用来存储每一个字节内容。 利用memset方法对buffer进行赋值。再利用一个for循环对255个主机进行发送，指定他们的IP地址。另外定义了一个flag,当发送成功之后将flag设置为1</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 向局域网内所有可能的IP地址发送ARP请求包线程 */</span></span><br><span class="line"><span class="function">DWORD WINAPI <span class="title">SendArpPacket</span><span class="params">(LPVOID lpParameter)</span> <span class="comment">//(pcap_t *adhandle,char *ip,unsigned char *mac,char *netmask)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	sparam *spara = (sparam *) lpParameter;</span><br><span class="line">	<span class="keyword">pcap_t</span> *adhandle = spara-&gt;adhandle;</span><br><span class="line">	<span class="keyword">char</span> *ip = spara-&gt;ip;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> *mac = spara-&gt;mac;</span><br><span class="line">	<span class="keyword">char</span> *netmask = spara-&gt;netmask;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"ip_mac:%02x-%02x-%02x-%02x-%02x-%02x\n"</span>, mac[<span class="number">0</span>], mac[<span class="number">1</span>], mac[<span class="number">2</span>],</span><br><span class="line">			mac[<span class="number">3</span>], mac[<span class="number">4</span>], mac[<span class="number">5</span>]);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"自身的IP地址为:%s\n"</span>, ip);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"地址掩码NETMASK为:%s\n"</span>, netmask);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> sendbuf[<span class="number">42</span>]; <span class="comment">//arp包结构大小</span></span><br><span class="line">	EthernetHeader eh;</span><br><span class="line">	Arpheader ah;</span><br><span class="line">	<span class="comment">//赋值MAC地址</span></span><br><span class="line">	<span class="built_in">memset</span>(eh.DestMAC, <span class="number">0xff</span>, <span class="number">6</span>);       <span class="comment">//目的地址为全为广播地址</span></span><br><span class="line">	<span class="built_in">memcpy</span>(eh.SourMAC, mac, <span class="number">6</span>);</span><br><span class="line">	<span class="built_in">memcpy</span>(ah.SourceMacAdd, mac, <span class="number">6</span>);</span><br><span class="line">	<span class="built_in">memset</span>(ah.DestMacAdd, <span class="number">0x00</span>, <span class="number">6</span>);</span><br><span class="line">	eh.EthType = htons(ETH_ARP);</span><br><span class="line">	ah.HardwareType = htons(ARP_HARDWARE);</span><br><span class="line">	ah.ProtocolType = htons(ETH_IP);</span><br><span class="line">	ah.HardwareAddLen = <span class="number">6</span>;</span><br><span class="line">	ah.ProtocolAddLen = <span class="number">4</span>;</span><br><span class="line">	ah.SourceIpAdd = inet_addr(ip); <span class="comment">//请求方的IP地址为自身的IP地址</span></span><br><span class="line">	ah.OperationField = htons(ARP_REQUEST);</span><br><span class="line">	<span class="comment">//向局域网内广播发送arp包</span></span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> myip = inet_addr(ip);</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> mynetmask = inet_addr(netmask);</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span> hisip = htonl((myip &amp; mynetmask));</span><br><span class="line">	<span class="comment">//向255个主机发送</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; HOSTNUM; i++) &#123;</span><br><span class="line">		ah.DestIpAdd = htonl(hisip + i);</span><br><span class="line">		<span class="comment">//构造一个ARP请求</span></span><br><span class="line">		<span class="built_in">memset</span>(sendbuf, <span class="number">0</span>, <span class="keyword">sizeof</span>(sendbuf));</span><br><span class="line">		<span class="built_in">memcpy</span>(sendbuf, &amp;eh, <span class="keyword">sizeof</span>(eh));</span><br><span class="line">		<span class="built_in">memcpy</span>(sendbuf + <span class="keyword">sizeof</span>(eh), &amp;ah, <span class="keyword">sizeof</span>(ah));</span><br><span class="line">		<span class="comment">//如果发送成功</span></span><br><span class="line">		<span class="keyword">if</span> (pcap_sendpacket(adhandle, sendbuf, <span class="number">42</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="comment">//printf("\nPacketSend succeed\n");</span></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"PacketSendPacket in getmine Error: %d\n"</span>, GetLastError());</span><br><span class="line">		&#125;</span><br><span class="line">		Sleep(<span class="number">50</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	Sleep(<span class="number">1000</span>);</span><br><span class="line">	flag = TRUE;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>注: 此函数和flag变量在前面别忘了声明一下… 然后是接收数据包并打印MAC地址:</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 分析截留的数据包获取活动的主机IP地址 */</span></span><br><span class="line"><span class="function">DWORD WINAPI <span class="title">GetLivePC</span><span class="params">(LPVOID lpParameter)</span> <span class="comment">//(pcap_t *adhandle)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	gparam *gpara = (gparam *) lpParameter;</span><br><span class="line">	<span class="keyword">pcap_t</span> *adhandle = gpara-&gt;adhandle;</span><br><span class="line">	<span class="keyword">int</span> res;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> Mac[<span class="number">6</span>];</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">pcap_pkthdr</span> * <span class="title">pkt_header</span>;</span></span><br><span class="line">	<span class="keyword">const</span> u_char * pkt_data;</span><br><span class="line">	<span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (flag) &#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"获取MAC地址完毕,请输入你要发送对方的IP地址:\n"</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> ((res = pcap_next_ex(adhandle, &amp;pkt_header, &amp;pkt_data)) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (*(<span class="keyword">unsigned</span> short *) (pkt_data + <span class="number">12</span>) == htons(ETH_ARP)) &#123;</span><br><span class="line">				ArpPacket *recv = (ArpPacket *) pkt_data;</span><br><span class="line">				<span class="keyword">if</span> (*(<span class="keyword">unsigned</span> short *) (pkt_data + <span class="number">20</span>) == htons(ARP_REPLY)) &#123;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">"-------------------------------------------\n"</span>);</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">"IP地址:%d.%d.%d.%d   MAC地址:"</span>,</span><br><span class="line">						     recv-&gt;ah.SourceIpAdd &amp; <span class="number">255</span>,</span><br><span class="line">							 recv-&gt;ah.SourceIpAdd &gt;&gt; <span class="number">8</span> &amp; <span class="number">255</span>,</span><br><span class="line">							 recv-&gt;ah.SourceIpAdd &gt;&gt; <span class="number">16</span> &amp; <span class="number">255</span>,</span><br><span class="line">							 recv-&gt;ah.SourceIpAdd &gt;&gt; <span class="number">24</span> &amp; <span class="number">255</span>);</span><br><span class="line">					<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">						Mac[i] = *(<span class="keyword">unsigned</span> <span class="keyword">char</span> *) (pkt_data + <span class="number">22</span> + i);</span><br><span class="line">						<span class="built_in">printf</span>(<span class="string">"%02x"</span>, Mac[i]);</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		Sleep(<span class="number">10</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上暂告一段落，通过整合以上代码，我们可以得到如下运行结果：</p>
                  <figure class="highlight asciidoc">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">--------------------------------------------------</span><br><span class="line">number:1</span><br><span class="line">name:rpcap://\Device\NPF<span class="emphasis">_&#123;5AC72F8D-019C-4003-B51B-</span></span><br><span class="line"><span class="emphasis">description:Network adapter 'Microsoft' on local h</span></span><br><span class="line"><span class="emphasis">        Loopback: no</span></span><br><span class="line"><span class="emphasis">Address Family Name:AF_</span>INET6</span><br><span class="line">this is an IPV6 address</span><br><span class="line">Address Family Name:AF<span class="emphasis">_INET6</span></span><br><span class="line"><span class="emphasis">this is an IPV6 address</span></span><br><span class="line"><span class="emphasis">--------------------------------------------------</span></span><br><span class="line"><span class="emphasis">number:2</span></span><br><span class="line"><span class="emphasis">name:rpcap://\Device\NPF_</span>&#123;C17EB3F6-1E86-40E5-8790-</span><br><span class="line">description:Network adapter <span class="emphasis">'Microsoft'</span> on local h</span><br><span class="line"><span class="code">        Loopback: no</span></span><br><span class="line">Address Family Name:AF<span class="emphasis">_INET6</span></span><br><span class="line"><span class="emphasis">this is an IPV6 address</span></span><br><span class="line"><span class="emphasis">Address Family Name:AF_</span>INET</span><br><span class="line">Address:192.168.95.1</span><br><span class="line"><span class="code">        Netmask: 255.255.255.0</span></span><br><span class="line"><span class="code">        Broadcast Address: 255.255.255.255</span></span><br><span class="line">--------------------------------------------------</span><br><span class="line">number:3</span><br><span class="line">name:rpcap://\Device\NPF<span class="emphasis">_&#123;33E23A2F-F791-409B-8452-</span></span><br><span class="line"><span class="emphasis">description:Network adapter 'Qualcomm Atheros Ar81</span></span><br><span class="line"><span class="emphasis">oller' on local host</span></span><br><span class="line"><span class="emphasis">        Loopback: no</span></span><br><span class="line"><span class="emphasis">Address Family Name:AF_</span>INET6</span><br><span class="line">this is an IPV6 address</span><br><span class="line">Address Family Name:AF<span class="emphasis">_INET6</span></span><br><span class="line"><span class="emphasis">this is an IPV6 address</span></span><br><span class="line"><span class="emphasis">Address Family Name:AF_</span>INET6</span><br><span class="line">this is an IPV6 address</span><br><span class="line">Address Family Name:AF<span class="emphasis">_INET</span></span><br><span class="line"><span class="emphasis">Address:121.250.216.237</span></span><br><span class="line"><span class="emphasis">        Netmask: 255.255.255.0</span></span><br><span class="line"><span class="emphasis">        Broadcast Address: 255.255.255.255</span></span><br><span class="line"><span class="emphasis">--------------------------------------------------</span></span><br><span class="line"><span class="emphasis">number:4</span></span><br><span class="line"><span class="emphasis">name:rpcap://\Device\NPF_</span>&#123;DCCF036F-A9A8-4225-B980-</span><br><span class="line">description:Network adapter <span class="emphasis">'Microsoft'</span> on local h</span><br><span class="line"><span class="code">        Loopback: no</span></span><br><span class="line">Address Family Name:AF<span class="emphasis">_INET6</span></span><br><span class="line"><span class="emphasis">this is an IPV6 address</span></span><br><span class="line"><span class="emphasis">Address Family Name:AF_</span>INET6</span><br><span class="line">this is an IPV6 address</span><br><span class="line">--------------------------------------------------</span><br><span class="line">number:5</span><br><span class="line">name:rpcap://\Device\NPF<span class="emphasis">_&#123;D62A0060-F424-46FC-83A5-</span></span><br><span class="line"><span class="emphasis">description:Network adapter 'Microsoft' on local h</span></span><br><span class="line"><span class="emphasis">        Loopback: no</span></span><br><span class="line"><span class="emphasis">Address Family Name:AF_</span>INET6</span><br><span class="line">this is an IPV6 address</span><br><span class="line">Address Family Name:AF<span class="emphasis">_INET</span></span><br><span class="line"><span class="emphasis">Address:192.168.191.1</span></span><br><span class="line"><span class="emphasis">        Netmask: 255.255.255.0</span></span><br><span class="line"><span class="emphasis">        Broadcast Address: 255.255.255.255</span></span><br><span class="line"><span class="emphasis">--------------------------------------------------</span></span><br><span class="line"><span class="emphasis">number:6</span></span><br><span class="line"><span class="emphasis">name:rpcap://\Device\NPF_</span>&#123;B5224A53-8450-4537-AB3B-</span><br><span class="line">description:Network adapter <span class="emphasis">'Microsoft'</span> on local h</span><br><span class="line"><span class="code">        Loopback: no</span></span><br><span class="line">Address Family Name:AF<span class="emphasis">_INET6</span></span><br><span class="line"><span class="emphasis">this is an IPV6 address</span></span><br><span class="line"><span class="emphasis">Address Family Name:AF_</span>INET</span><br><span class="line">Address:192.168.191.2</span><br><span class="line"><span class="code">        Netmask: 255.255.255.0</span></span><br><span class="line"><span class="code">        Broadcast Address: 255.255.255.255</span></span><br><span class="line">Enter the interface number(1-6):3</span><br><span class="line"></span><br><span class="line">ipstr:121.250.216.237</span><br><span class="line">netmask:255.255.255.0</span><br><span class="line"></span><br><span class="line">PacketSend succeed</span><br><span class="line">获取自己主机的MAC地址成功!</span><br><span class="line"></span><br><span class="line">listening on 网卡2 ...</span><br><span class="line">ip<span class="emphasis">_mac:dc-0e-a1-ec-53-c3</span></span><br><span class="line"><span class="emphasis">自身的IP地址为:121.250.216.237</span></span><br><span class="line"><span class="emphasis">地址掩码NETMASK为:255.255.255.0</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">请按任意键继续. . . ------------------------------</span></span><br><span class="line"><span class="emphasis">IP地址:121.250.216.1   MAC地址:000fe28e6100</span></span><br><span class="line"><span class="emphasis">-------------------------------------------</span></span><br><span class="line"><span class="emphasis">IP地址:121.250.216.3   MAC地址:089e012d20d5</span></span><br><span class="line"><span class="emphasis">-------------------------------------------</span></span><br><span class="line"><span class="emphasis">IP地址:121.250.216.5   MAC地址:5404a6af5f2d</span></span><br><span class="line"><span class="emphasis">-------------------------------------------</span></span><br><span class="line"><span class="emphasis">IP地址:121.250.216.6   MAC地址:28d244248d81</span></span><br><span class="line"><span class="emphasis">-------------------------------------------</span></span><br><span class="line"><span class="emphasis">IP地址:121.250.216.7   MAC地址:80fa5b0283f3</span></span><br><span class="line"><span class="emphasis">-------------------------------------------</span></span><br><span class="line"><span class="emphasis">IP地址:121.250.216.8   MAC地址:14dae9005b9e</span></span><br><span class="line"><span class="emphasis">-------------------------------------------</span></span><br><span class="line"><span class="emphasis">IP地址:121.250.216.9   MAC地址:b82a72bf8bce</span></span><br><span class="line"><span class="emphasis">-------------------------------------------</span></span><br><span class="line"><span class="emphasis">IP地址:121.250.216.12   MAC地址:84c9b2fefeed</span></span><br><span class="line"><span class="emphasis">-------------------------------------------</span></span><br><span class="line"><span class="emphasis">IP地址:121.250.216.15   MAC地址:28d2440b4b1b</span></span><br><span class="line"><span class="emphasis">-------------------------------------------</span></span><br><span class="line"><span class="emphasis">IP地址:121.250.216.16   MAC地址:bcee7b969beb</span></span><br><span class="line"><span class="emphasis">-------------------------------------------</span></span><br><span class="line"><span class="emphasis">........此处省略一万字....</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来我们让用户输入要发送的IP地址和要发送的数据</p>
                  <figure class="highlight perl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">u_int ip1,ip2,ip3,ip4;</span><br><span class="line">		scanf_s(<span class="string">"%d.%d.%d.%d"</span>,&amp;ip1,&amp;ip2,&amp;ip3,&amp;ip4);</span><br><span class="line">		<span class="keyword">printf</span>(<span class="string">"请输入你要发送的内容:\n"</span>);</span><br><span class="line">		getchar();</span><br><span class="line">		gets_s(TcpData);</span><br><span class="line">		<span class="keyword">printf</span>(<span class="string">"要发送的内容:%s\n"</span>,TcpData);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>声明一下TcpData</p>
                  <figure class="highlight scss">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">char TcpData<span class="selector-attr">[20]</span>;   <span class="comment">//发送内容</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来就是重头戏了，需要声明各种结构体，我们发送的是TCP数据，这样，TCP的TcpData 就作为真正的内容，然后在前面加上TCP头，IP头，帧头，还有校验和要正确。 最后构成一个完整的帧，那么另外声明的结构体如下，前面代码声明过的帧头部结构体就去掉了。</p>
                  <figure class="highlight objectivec">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//IP地址格式</span></span><br><span class="line"><span class="keyword">struct</span> IpAddress</span><br><span class="line">&#123;</span><br><span class="line">    u_char byte1;</span><br><span class="line">    u_char byte2;</span><br><span class="line">    u_char byte3;</span><br><span class="line">    u_char byte4;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//帧头部结构体，共14字节</span></span><br><span class="line"><span class="keyword">struct</span> EthernetHeader</span><br><span class="line">&#123;</span><br><span class="line">    u_char DestMAC[<span class="number">6</span>];    <span class="comment">//目的MAC地址 6字节</span></span><br><span class="line">    u_char SourMAC[<span class="number">6</span>];   <span class="comment">//源MAC地址 6字节</span></span><br><span class="line">    u_short EthType;         <span class="comment">//上一层协议类型，如0x0800代表上一层是IP协议，0x0806为arp  2字节</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//IP头部结构体，共20字节</span></span><br><span class="line"><span class="keyword">struct</span> IpHeader</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> Version_HLen;   <span class="comment">//版本信息4位 ，头长度4位 1字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> TOS;                    <span class="comment">//服务类型    1字节</span></span><br><span class="line">    <span class="keyword">short</span> Length;                              <span class="comment">//数据包长度 2字节</span></span><br><span class="line">    <span class="keyword">short</span> Ident;                                 <span class="comment">//数据包标识  2字节</span></span><br><span class="line">    <span class="keyword">short</span> Flags_Offset;                    <span class="comment">//标志3位，片偏移13位  2字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> TTL;                   <span class="comment">//存活时间  1字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> Protocol;          <span class="comment">//协议类型  1字节</span></span><br><span class="line">    <span class="keyword">short</span> Checksum;                       <span class="comment">//首部校验和 2字节</span></span><br><span class="line">	IpAddress SourceAddr;       <span class="comment">//源IP地址   4字节</span></span><br><span class="line">	IpAddress DestinationAddr; <span class="comment">//目的IP地址  4字节</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//TCP头部结构体，共20字节</span></span><br><span class="line"><span class="keyword">struct</span> TcpHeader</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">short</span> SrcPort;                        <span class="comment">//源端口号  2字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">short</span> DstPort;                        <span class="comment">//目的端口号 2字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> SequenceNum;               <span class="comment">//序号  4字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> Acknowledgment;         <span class="comment">//确认号  4字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> HdrLen;                         <span class="comment">//首部长度4位，保留位6位 共10位</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> Flags;                              <span class="comment">//标志位6位</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">short</span> AdvertisedWindow;  <span class="comment">//窗口大小16位 2字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">short</span> Checksum;                  <span class="comment">//校验和16位   2字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">short</span> UrgPtr;						  <span class="comment">//紧急指针16位   2字节</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//TCP伪首部结构体 12字节</span></span><br><span class="line"><span class="keyword">struct</span> PsdTcpHeader</span><br><span class="line">&#123;</span><br><span class="line">	IpAddress SourceAddr;                     <span class="comment">//源IP地址  4字节</span></span><br><span class="line">	IpAddress DestinationAddr;             <span class="comment">//目的IP地址 4字节</span></span><br><span class="line">    <span class="keyword">char</span> Zero;                                                    <span class="comment">//填充位  1字节</span></span><br><span class="line">    <span class="keyword">char</span> Protcol;                                               <span class="comment">//协议号  1字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">short</span> TcpLen;                           <span class="comment">//TCP包长度 2字节</span></span><br><span class="line">&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>继续main函数中对各种结构体的数据进行初始化赋值，并计算校验和。</p>
                  <figure class="highlight arduino">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//结构体初始化为0序列</span></span><br><span class="line">		<span class="built_in">memset</span>(&amp;ethernet, <span class="number">0</span>, <span class="keyword">sizeof</span>(ethernet));</span><br><span class="line">		BYTE destmac[<span class="number">8</span>];</span><br><span class="line">		<span class="comment">//目的MAC地址,此处没有对帧的MAC地址进行赋值，因为网卡设置的混杂模式，可以接受经过该网卡的所有帧。当然最好的方法是赋值为ARP刚才获取到的MAC地址，当然不赋值也可以捕捉到并解析，在此处仅做下说明。</span></span><br><span class="line">		destmac[<span class="number">0</span>] = <span class="number">0x00</span>;</span><br><span class="line">		destmac[<span class="number">1</span>] = <span class="number">0x11</span>;</span><br><span class="line">		destmac[<span class="number">2</span>] = <span class="number">0x22</span>;</span><br><span class="line">		destmac[<span class="number">3</span>] = <span class="number">0x33</span>;</span><br><span class="line">		destmac[<span class="number">4</span>] = <span class="number">0x44</span>;</span><br><span class="line">		destmac[<span class="number">5</span>] = <span class="number">0x55</span>;</span><br><span class="line">		<span class="comment">//赋值目的MAC地址</span></span><br><span class="line">		<span class="built_in">memcpy</span>(ethernet.DestMAC, destmac, <span class="number">6</span>);</span><br><span class="line">		BYTE hostmac[<span class="number">8</span>];</span><br><span class="line">		<span class="comment">//源MAC地址</span></span><br><span class="line">		hostmac[<span class="number">0</span>] = <span class="number">0x00</span>;</span><br><span class="line">		hostmac[<span class="number">1</span>] = <span class="number">0x1a</span>;</span><br><span class="line">		hostmac[<span class="number">2</span>] = <span class="number">0x4d</span>;</span><br><span class="line">		hostmac[<span class="number">3</span>] = <span class="number">0x70</span>;</span><br><span class="line">		hostmac[<span class="number">4</span>] = <span class="number">0xa3</span>;</span><br><span class="line">		hostmac[<span class="number">5</span>] = <span class="number">0x89</span>;</span><br><span class="line">		<span class="comment">//赋值源MAC地址</span></span><br><span class="line">		<span class="built_in">memcpy</span>(ethernet.SourMAC, hostmac, <span class="number">6</span>);</span><br><span class="line">		<span class="comment">//上层协议类型,0x0800代表IP协议</span></span><br><span class="line">		ethernet.EthType = htons(<span class="number">0x0800</span>);</span><br><span class="line">		<span class="comment">//赋值SendBuffer</span></span><br><span class="line">		<span class="built_in">memcpy</span>(&amp;SendBuffer, ðernet, <span class="keyword">sizeof</span>(struct EthernetHeader));</span><br><span class="line">		<span class="comment">//赋值IP头部信息</span></span><br><span class="line">		ip.Version_HLen = <span class="number">0x45</span>;</span><br><span class="line">		ip.TOS = <span class="number">0</span>;</span><br><span class="line">		ip.Length = htons(<span class="keyword">sizeof</span>(struct IpHeader) + <span class="keyword">sizeof</span>(struct TcpHeader) + <span class="built_in">strlen</span>(TcpData));</span><br><span class="line">		ip.Ident = htons(<span class="number">1</span>);</span><br><span class="line">		ip.Flags_Offset = <span class="number">0</span>;</span><br><span class="line">		ip.TTL = <span class="number">128</span>;</span><br><span class="line">		ip.Protocol = <span class="number">6</span>;</span><br><span class="line">		ip.Checksum = <span class="number">0</span>;</span><br><span class="line">		<span class="comment">//源IP地址</span></span><br><span class="line">		ip.SourceAddr.byte1 = <span class="number">127</span>;</span><br><span class="line">		ip.SourceAddr.byte2 = <span class="number">0</span>;</span><br><span class="line">		ip.SourceAddr.byte3 = <span class="number">0</span>;</span><br><span class="line">		ip.SourceAddr.byte4 = <span class="number">1</span>;</span><br><span class="line">		<span class="comment">//目的IP地址</span></span><br><span class="line">		ip.DestinationAddr.byte1 = ip1;</span><br><span class="line">		ip.DestinationAddr.byte2 = ip2;</span><br><span class="line">		ip.DestinationAddr.byte3 = ip3;</span><br><span class="line">		ip.DestinationAddr.byte4 = ip4;</span><br><span class="line">		<span class="comment">//赋值SendBuffer</span></span><br><span class="line">		<span class="built_in">memcpy</span>(&amp;SendBuffer[<span class="keyword">sizeof</span>(struct EthernetHeader)], &amp;ip, <span class="number">20</span>);</span><br><span class="line">		<span class="comment">//赋值TCP头部内容</span></span><br><span class="line">		tcp.DstPort = htons(<span class="number">102</span>);</span><br><span class="line">		tcp.SrcPort = htons(<span class="number">1000</span>);</span><br><span class="line">		tcp.SequenceNum = htonl(<span class="number">11</span>);</span><br><span class="line">		tcp.Acknowledgment = <span class="number">0</span>;</span><br><span class="line">		tcp.HdrLen = <span class="number">0x50</span>;</span><br><span class="line">		tcp.Flags = <span class="number">0x18</span>;</span><br><span class="line">		tcp.AdvertisedWindow = htons(<span class="number">512</span>);</span><br><span class="line">		tcp.UrgPtr = <span class="number">0</span>;</span><br><span class="line">		tcp.Checksum = <span class="number">0</span>;</span><br><span class="line">		<span class="comment">//赋值SendBuffer</span></span><br><span class="line">		<span class="built_in">memcpy</span>(&amp;SendBuffer[<span class="keyword">sizeof</span>(struct EthernetHeader) + <span class="number">20</span>], &amp;tcp, <span class="number">20</span>);</span><br><span class="line">		<span class="comment">//赋值伪首部</span></span><br><span class="line">		ptcp.SourceAddr = ip.SourceAddr;</span><br><span class="line">		ptcp.DestinationAddr = ip.DestinationAddr;</span><br><span class="line">		ptcp.Zero = <span class="number">0</span>;</span><br><span class="line">		ptcp.Protcol = <span class="number">6</span>;</span><br><span class="line">		ptcp.TcpLen = htons(<span class="keyword">sizeof</span>(struct TcpHeader) + <span class="built_in">strlen</span>(TcpData));</span><br><span class="line">		<span class="comment">//声明临时存储变量，用来计算校验和</span></span><br><span class="line">		<span class="keyword">char</span> TempBuffer[<span class="number">65535</span>];</span><br><span class="line">		<span class="built_in">memcpy</span>(TempBuffer, &amp;ptcp, <span class="keyword">sizeof</span>(struct PsdTcpHeader));</span><br><span class="line">		<span class="built_in">memcpy</span>(TempBuffer + <span class="keyword">sizeof</span>(struct PsdTcpHeader), &amp;tcp, <span class="keyword">sizeof</span>(struct TcpHeader));</span><br><span class="line">		<span class="built_in">memcpy</span>(TempBuffer + <span class="keyword">sizeof</span>(struct PsdTcpHeader) + <span class="keyword">sizeof</span>(struct TcpHeader), TcpData, <span class="built_in">strlen</span>(TcpData));</span><br><span class="line">		<span class="comment">//计算TCP的校验和</span></span><br><span class="line">		tcp.Checksum = checksum((USHORT*)(TempBuffer), <span class="keyword">sizeof</span>(struct PsdTcpHeader) + <span class="keyword">sizeof</span>(struct TcpHeader) + <span class="built_in">strlen</span>(TcpData));</span><br><span class="line">		<span class="comment">//重新把SendBuffer赋值，因为此时校验和已经改变，赋值新的</span></span><br><span class="line">		<span class="built_in">memcpy</span>(SendBuffer + <span class="keyword">sizeof</span>(struct EthernetHeader) + <span class="keyword">sizeof</span>(struct IpHeader), &amp;tcp, <span class="keyword">sizeof</span>(struct TcpHeader));</span><br><span class="line">		<span class="built_in">memcpy</span>(SendBuffer + <span class="keyword">sizeof</span>(struct EthernetHeader) + <span class="keyword">sizeof</span>(struct IpHeader) + <span class="keyword">sizeof</span>(struct TcpHeader), TcpData, <span class="built_in">strlen</span>(TcpData));</span><br><span class="line">		<span class="comment">//初始化TempBuffer为0序列，存储变量来计算IP校验和</span></span><br><span class="line">		<span class="built_in">memset</span>(TempBuffer, <span class="number">0</span>, <span class="keyword">sizeof</span>(TempBuffer));</span><br><span class="line">		<span class="built_in">memcpy</span>(TempBuffer, &amp;ip, <span class="keyword">sizeof</span>(struct IpHeader));</span><br><span class="line">		<span class="comment">//计算IP校验和</span></span><br><span class="line">		ip.Checksum = checksum((USHORT*)(TempBuffer), <span class="keyword">sizeof</span>(struct IpHeader));</span><br><span class="line">		<span class="comment">//重新把SendBuffer赋值，IP校验和已经改变</span></span><br><span class="line">		<span class="built_in">memcpy</span>(SendBuffer + <span class="keyword">sizeof</span>(struct EthernetHeader), &amp;ip, <span class="keyword">sizeof</span>(struct IpHeader));</span><br><span class="line">		<span class="comment">//发送序列的长度</span></span><br><span class="line">		<span class="keyword">int</span> <span class="built_in">size</span> = <span class="keyword">sizeof</span>(struct EthernetHeader) + <span class="keyword">sizeof</span>(struct IpHeader) + <span class="keyword">sizeof</span>(struct TcpHeader) + <span class="built_in">strlen</span>(TcpData);</span><br><span class="line">		<span class="keyword">int</span> result = pcap_sendpacket(adhandle, SendBuffer,<span class="built_in">size</span>);</span><br><span class="line">		<span class="keyword">if</span> (result != <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Send Error!\n"</span>);</span><br><span class="line">		&#125; </span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Send TCP Packet.\n"</span>);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Dstination Port:%d\n"</span>, ntohs(tcp.DstPort));</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Source Port:%d\n"</span>, ntohs(tcp.SrcPort));</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Sequence:%d\n"</span>, ntohl(tcp.SequenceNum));</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Acknowledgment:%d\n"</span>, ntohl(tcp.Acknowledgment));</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Header Length:%d*4\n"</span>, tcp.HdrLen &gt;&gt; <span class="number">4</span>);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Flags:0x%0x\n"</span>, tcp.Flags);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"AdvertiseWindow:%d\n"</span>, ntohs(tcp.AdvertisedWindow));</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"UrgPtr:%d\n"</span>, ntohs(tcp.UrgPtr));</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Checksum:%u\n"</span>, ntohs(tcp.Checksum));</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"Send Successfully!\n"</span>);</span><br><span class="line">		&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>校验和方法如下：</p>
                  <figure class="highlight objectivec">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//获得校验和的方法</span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">short</span> checksum(<span class="keyword">unsigned</span> <span class="keyword">short</span> *data, <span class="keyword">int</span> length)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> temp = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (length &gt; <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        temp +=  *data++;</span><br><span class="line">        length -= <span class="keyword">sizeof</span>(<span class="keyword">unsigned</span> <span class="keyword">short</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (length)</span><br><span class="line">    &#123;</span><br><span class="line">        temp += *(<span class="keyword">unsigned</span> <span class="keyword">short</span>*)data;</span><br><span class="line">    &#125;</span><br><span class="line">    temp = (temp &gt;&gt; <span class="number">16</span>) + (temp &amp;<span class="number">0xffff</span>);</span><br><span class="line">    temp += (temp &gt;&gt; <span class="number">16</span>);</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">unsigned</span> <span class="keyword">short</span>)(~temp);</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>记得在声明一下这个方法。如果放在main函数前当然就不用声明啦。 另外需要声明的变量有</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">EthernetHeader</span> <span class="title">ethernet</span>;</span>    <span class="comment">//以太网帧头</span></span><br><span class="line"> <span class="class"><span class="keyword">struct</span> <span class="title">IpHeader</span> <span class="title">ip</span>;</span>                            <span class="comment">//IP头</span></span><br><span class="line"> <span class="class"><span class="keyword">struct</span> <span class="title">TcpHeader</span> <span class="title">tcp</span>;</span>                      <span class="comment">//TCP头</span></span><br><span class="line"> <span class="class"><span class="keyword">struct</span> <span class="title">PsdTcpHeader</span> <span class="title">ptcp</span>;</span>             <span class="comment">//TCP伪首部</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> SendBuffer[<span class="number">200</span>];       <span class="comment">//发送队列</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来的运行结果：</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">获取MAC地址完毕,请输</span><br><span class="line"><span class="number">121.250</span><span class="number">.216</span><span class="number">.112</span></span><br><span class="line">请输入你要发送的内容</span><br><span class="line">what <span class="keyword">is</span> tcp</span><br><span class="line">要发送的内容:what i</span><br><span class="line">Send TCP Packet.</span><br><span class="line">Dstination Port:<span class="number">102</span></span><br><span class="line">Source Port:<span class="number">1000</span></span><br><span class="line">Sequence:<span class="number">11</span></span><br><span class="line">Acknowledgment:<span class="number">0</span></span><br><span class="line">Header Length:<span class="number">5</span>*<span class="number">4</span></span><br><span class="line">Flags:<span class="number">0x18</span></span><br><span class="line">AdvertiseWindow:<span class="number">512</span></span><br><span class="line">UrgPtr:<span class="number">0</span></span><br><span class="line">Checksum:<span class="number">17149</span></span><br><span class="line">Send Successfully!</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>截图如下： <img src="http://img.blog.csdn.net/20141018211905731?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 好啦，发送帧到此就告一段落啦！如果有疑问请留言。 帧的接收很简单，直接贴源码如下：</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pcap.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">iptos</span><span class="params">(u_long in)</span></span>;       <span class="comment">//u_long即为 unsigned long</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">packet_handler</span><span class="params">(u_char *param, <span class="keyword">const</span> struct pcap_pkthdr *header, <span class="keyword">const</span> u_char *pkt_data)</span></span>;</span><br><span class="line"><span class="comment">//struct tm *ltime;					//和时间处理有关的变量</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">IpAddress</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    u_char byte1;</span><br><span class="line">    u_char byte2;</span><br><span class="line">    u_char byte3;</span><br><span class="line">    u_char byte4;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//帧头部结构体，共14字节</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">EthernetHeader</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    u_char DestMAC[<span class="number">6</span>];    <span class="comment">//目的MAC地址 6字节</span></span><br><span class="line">    u_char SourMAC[<span class="number">6</span>];   <span class="comment">//源MAC地址 6字节</span></span><br><span class="line">    u_short EthType;         <span class="comment">//上一层协议类型，如0x0800代表上一层是IP协议，0x0806为arp  2字节</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//IP头部结构体，共20字节</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">IpHeader</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> Version_HLen;   <span class="comment">//版本信息4位 ，头长度4位 1字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> TOS;                    <span class="comment">//服务类型    1字节</span></span><br><span class="line">    short Length;                              <span class="comment">//数据包长度 2字节</span></span><br><span class="line">    short Ident;                                 <span class="comment">//数据包标识  2字节</span></span><br><span class="line">    short Flags_Offset;                    <span class="comment">//标志3位，片偏移13位  2字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> TTL;                    <span class="comment">//存活时间  1字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> Protocol;           <span class="comment">//协议类型  1字节</span></span><br><span class="line">    short Checksum;                        <span class="comment">//首部校验和 2字节</span></span><br><span class="line">    IpAddress SourceAddr;           <span class="comment">//源IP地址   4字节</span></span><br><span class="line">    IpAddress DestinationAddr;   <span class="comment">//目的IP地址  4字节</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//TCP头部结构体，共20字节</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TcpHeader</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">unsigned</span> short SrcPort;                        <span class="comment">//源端口号  2字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> short DstPort;                        <span class="comment">//目的端口号 2字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> SequenceNum;               <span class="comment">//序号  4字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> Acknowledgment;         <span class="comment">//确认号  4字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> HdrLen;                         <span class="comment">//首部长度4位，保留位6位 共10位</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> Flags;                              <span class="comment">//标志位6位</span></span><br><span class="line">    <span class="keyword">unsigned</span> short AdvertisedWindow;  <span class="comment">//窗口大小16位 2字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> short Checksum;                  <span class="comment">//校验和16位   2字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> short UrgPtr;						  <span class="comment">//紧急指针16位   2字节</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//TCP伪首部结构体 12字节</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PsdTcpHeader</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> SourceAddr;                     <span class="comment">//源IP地址  4字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> DestinationAddr;             <span class="comment">//目的IP地址 4字节</span></span><br><span class="line">    <span class="keyword">char</span> Zero;                                                    <span class="comment">//填充位  1字节</span></span><br><span class="line">    <span class="keyword">char</span> Protcol;                                               <span class="comment">//协议号  1字节</span></span><br><span class="line">    <span class="keyword">unsigned</span> short TcpLen;                           <span class="comment">//TCP包长度 2字节</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	EthernetHeader *ethernet;    <span class="comment">//以太网帧头</span></span><br><span class="line">    IpHeader *ip;                            <span class="comment">//IP头</span></span><br><span class="line">    TcpHeader *tcp;                      <span class="comment">//TCP头</span></span><br><span class="line">    PsdTcpHeader *ptcp;             <span class="comment">//TCP伪首部</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">pcap_if_t</span>  * alldevs;       <span class="comment">//所有网络适配器</span></span><br><span class="line">	<span class="keyword">pcap_if_t</span>  *d;					<span class="comment">//选中的网络适配器</span></span><br><span class="line">	<span class="keyword">char</span> errbuf[PCAP_ERRBUF_SIZE];   <span class="comment">//错误缓冲区,大小为256</span></span><br><span class="line">	<span class="keyword">char</span> source[PCAP_ERRBUF_SIZE];</span><br><span class="line">	<span class="keyword">pcap_t</span> *adhandle;           <span class="comment">//捕捉实例,是pcap_open返回的对象</span></span><br><span class="line">	<span class="keyword">int</span> i = <span class="number">0</span>;                            <span class="comment">//适配器计数变量</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">pcap_pkthdr</span> *<span class="title">header</span>;</span>    <span class="comment">//接收到的数据包的头部</span></span><br><span class="line">    <span class="keyword">const</span> u_char *pkt_data;			  <span class="comment">//接收到的数据包的内容</span></span><br><span class="line">	<span class="keyword">int</span> res;                                    <span class="comment">//表示是否接收到了数据包</span></span><br><span class="line">	u_int netmask;                       <span class="comment">//过滤时用的子网掩码</span></span><br><span class="line">	<span class="keyword">char</span> packet_filter[] = <span class="string">"tcp"</span>;        <span class="comment">//过滤字符</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">bpf_program</span> <span class="title">fcode</span>;</span>                     <span class="comment">//pcap_compile所调用的结构体</span></span><br><span class="line"></span><br><span class="line">	u_int ip_len;                                       <span class="comment">//ip地址有效长度</span></span><br><span class="line">	u_short sport,dport;                        <span class="comment">//主机字节序列</span></span><br><span class="line">	u_char packet[<span class="number">100</span>];                       <span class="comment">//发送数据包目的地址</span></span><br><span class="line">	<span class="keyword">pcap_dumper_t</span> *dumpfile;         <span class="comment">//堆文件</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//time_t local_tv_sec;				//和时间处理有关的变量</span></span><br><span class="line">    <span class="comment">//char timestr[16];					//和时间处理有关的变量</span></span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//获取本地适配器列表</span></span><br><span class="line">	<span class="keyword">if</span>(pcap_findalldevs_ex(PCAP_SRC_IF_STRING,<span class="literal">NULL</span>,&amp;alldevs,errbuf) == <span class="number">-1</span>)&#123;</span><br><span class="line">		<span class="comment">//结果为-1代表出现获取适配器列表失败</span></span><br><span class="line">		<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,<span class="string">"Error in pcap_findalldevs_ex:\n"</span>,errbuf);</span><br><span class="line">		<span class="comment">//exit(0)代表正常退出,exit(other)为非正常退出,这个值会传给操作系统</span></span><br><span class="line">		<span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//打印设备列表信息</span></span><br><span class="line">	<span class="keyword">for</span>(d = alldevs;d !=<span class="literal">NULL</span>;d = d-&gt;next)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"-----------------------------------------------------------------\nnumber:%d\nname:%s\n"</span>,++i,d-&gt;name);</span><br><span class="line">		<span class="keyword">if</span>(d-&gt;description)&#123;</span><br><span class="line">			<span class="comment">//打印适配器的描述信息</span></span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"description:%s\n"</span>,d-&gt;description);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">//适配器不存在描述信息</span></span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"description:%s"</span>,<span class="string">"no description\n"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//打印本地环回地址</span></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"\tLoopback: %s\n"</span>,(d-&gt;flags &amp; PCAP_IF_LOOPBACK)?<span class="string">"yes"</span>:<span class="string">"no"</span>);</span><br><span class="line">		</span><br><span class="line">		 <span class="keyword">pcap_addr_t</span> *a;       <span class="comment">//网络适配器的地址用来存储变量</span></span><br><span class="line">		 <span class="keyword">for</span>(a = d-&gt;addresses;a;a = a-&gt;next)&#123;</span><br><span class="line">			 <span class="comment">//sa_family代表了地址的类型,是IPV4地址类型还是IPV6地址类型</span></span><br><span class="line">			 <span class="keyword">switch</span> (a-&gt;addr-&gt;sa_family)</span><br><span class="line">			 &#123;</span><br><span class="line">				 <span class="keyword">case</span> AF_INET:  <span class="comment">//代表IPV4类型地址</span></span><br><span class="line">					 <span class="built_in">printf</span>(<span class="string">"Address Family Name:AF_INET\n"</span>);</span><br><span class="line">					 <span class="keyword">if</span>(a-&gt;addr)&#123;</span><br><span class="line">						 <span class="comment">//-&gt;的优先级等同于括号,高于强制类型转换,因为addr为sockaddr类型，对其进行操作须转换为sockaddr_in类型</span></span><br><span class="line">						 <span class="built_in">printf</span>(<span class="string">"Address:%s\n"</span>,iptos(((struct sockaddr_in *)a-&gt;addr)-&gt;sin_addr.s_addr));</span><br><span class="line">					 &#125;</span><br><span class="line">					<span class="keyword">if</span> (a-&gt;netmask)&#123;</span><br><span class="line">						 <span class="built_in">printf</span>(<span class="string">"\tNetmask: %s\n"</span>,iptos(((struct sockaddr_in *)a-&gt;netmask)-&gt;sin_addr.s_addr));</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">if</span> (a-&gt;broadaddr)&#123;</span><br><span class="line">						   <span class="built_in">printf</span>(<span class="string">"\tBroadcast Address: %s\n"</span>,iptos(((struct sockaddr_in *)a-&gt;broadaddr)-&gt;sin_addr.s_addr));</span><br><span class="line">					 &#125;</span><br><span class="line">					 <span class="keyword">if</span> (a-&gt;dstaddr)&#123;</span><br><span class="line">						   <span class="built_in">printf</span>(<span class="string">"\tDestination Address: %s\n"</span>,iptos(((struct sockaddr_in *)a-&gt;dstaddr)-&gt;sin_addr.s_addr));</span><br><span class="line">					 &#125;</span><br><span class="line">        			 <span class="keyword">break</span>;</span><br><span class="line">				 <span class="keyword">case</span> AF_INET6: <span class="comment">//代表IPV6类型地址</span></span><br><span class="line">					 <span class="built_in">printf</span>(<span class="string">"Address Family Name:AF_INET6\n"</span>);</span><br><span class="line">					 <span class="built_in">printf</span>(<span class="string">"this is an IPV6 address\n"</span>);</span><br><span class="line">					 <span class="keyword">break</span>;</span><br><span class="line">				 <span class="keyword">default</span>:</span><br><span class="line">					 <span class="keyword">break</span>;</span><br><span class="line">			 &#125;</span><br><span class="line">		 &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//i为0代表上述循环未进入,即没有找到适配器,可能的原因为Winpcap没有安装导致未扫描到</span></span><br><span class="line">	<span class="keyword">if</span>(i == <span class="number">0</span>)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"interface not found,please check winpcap installation"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> num;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"Enter the interface number(1-%d):"</span>,i);</span><br><span class="line">	<span class="comment">//让用户选择选择哪个适配器进行抓包</span></span><br><span class="line">	scanf_s(<span class="string">"%d"</span>,&amp;num);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//用户输入的数字超出合理范围</span></span><br><span class="line">	<span class="keyword">if</span>(num&lt;<span class="number">1</span>||num&gt;i)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"number out of range\n"</span>);</span><br><span class="line">		pcap_freealldevs(alldevs);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//跳转到选中的适配器</span></span><br><span class="line">	<span class="keyword">for</span>(d=alldevs, i=<span class="number">0</span>; i&lt; num<span class="number">-1</span> ; d=d-&gt;next, i++);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//运行到此处说明用户的输入是合法的</span></span><br><span class="line">	<span class="keyword">if</span>((adhandle = pcap_open(d-&gt;name,		<span class="comment">//设备名称</span></span><br><span class="line">														<span class="number">65535</span>,       <span class="comment">//存放数据包的内容长度</span></span><br><span class="line">														PCAP_OPENFLAG_PROMISCUOUS,  <span class="comment">//混杂模式</span></span><br><span class="line">														<span class="number">1000</span>,           <span class="comment">//超时时间</span></span><br><span class="line">														<span class="literal">NULL</span>,          <span class="comment">//远程验证</span></span><br><span class="line">														errbuf         <span class="comment">//错误缓冲</span></span><br><span class="line">														)) == <span class="literal">NULL</span>)&#123;</span><br><span class="line">        <span class="comment">//打开适配器失败,打印错误并释放适配器列表</span></span><br><span class="line">		<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,<span class="string">"\nUnable to open the adapter. %s is not supported by WinPcap\n"</span>, d-&gt;name);</span><br><span class="line">        <span class="comment">// 释放设备列表 </span></span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="comment">//打印输出,正在监听中</span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"\nlistening on %s...\n"</span>, d-&gt;description);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//所在网络不是以太网,此处只取这种情况</span></span><br><span class="line">	<span class="keyword">if</span>(pcap_datalink(adhandle) != DLT_EN10MB)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,<span class="string">"\nThis program works only on Ethernet networks.\n"</span>);</span><br><span class="line">        <span class="comment">//释放列表</span></span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//先获得地址的子网掩码</span></span><br><span class="line">	<span class="keyword">if</span>(d-&gt;addresses != <span class="literal">NULL</span>)</span><br><span class="line">        <span class="comment">//获得接口第一个地址的掩码 </span></span><br><span class="line">        netmask=((struct sockaddr_in *)(d-&gt;addresses-&gt;netmask))-&gt;sin_addr.S_un.S_addr;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="comment">// 如果接口没有地址，那么我们假设一个C类的掩码</span></span><br><span class="line">        netmask=<span class="number">0xffffff</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//pcap_compile()的原理是将高层的布尔过滤表</span></span><br><span class="line">	<span class="comment">//达式编译成能够被过滤引擎所解释的低层的字节码</span></span><br><span class="line">	<span class="keyword">if</span>(pcap_compile(adhandle,	<span class="comment">//适配器处理对象</span></span><br><span class="line">										&amp;fcode,</span><br><span class="line">										packet_filter,   <span class="comment">//过滤ip和UDP</span></span><br><span class="line">										<span class="number">1</span>,                       <span class="comment">//优化标志</span></span><br><span class="line">										netmask           <span class="comment">//子网掩码</span></span><br><span class="line">										)&lt;<span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//过滤出现问题</span></span><br><span class="line">		<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,<span class="string">"\nUnable to compile the packet filter. Check the syntax.\n"</span>);</span><br><span class="line">        <span class="comment">// 释放设备列表</span></span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//设置过滤器</span></span><br><span class="line">    <span class="keyword">if</span> (pcap_setfilter(adhandle, &amp;fcode)&lt;<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,<span class="string">"\nError setting the filter.\n"</span>);</span><br><span class="line">        <span class="comment">//释放设备列表</span></span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//利用pcap_next_ex来接受数据包</span></span><br><span class="line">	<span class="keyword">while</span>((res = pcap_next_ex(adhandle,&amp;header,&amp;pkt_data))&gt;=<span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(res ==<span class="number">0</span>)&#123;</span><br><span class="line">			<span class="comment">//返回值为0代表接受数据包超时，重新循环继续接收</span></span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">//运行到此处代表接受到正常从数据包</span></span><br><span class="line">			<span class="comment">//header为帧的头部</span></span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"%.6ld len:%d "</span>, header-&gt;ts.tv_usec, header-&gt;len);</span><br><span class="line">			<span class="comment">// 获得IP数据包头部的位置</span></span><br><span class="line">			ip = (IpHeader *) (pkt_data +<span class="number">14</span>);    <span class="comment">//14为以太网帧头部长度</span></span><br><span class="line">			<span class="comment">//获得TCP头部的位置</span></span><br><span class="line">			ip_len = (ip-&gt;Version_HLen &amp; <span class="number">0xf</span>) *<span class="number">4</span>;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"ip_length:%d "</span>,ip_len);</span><br><span class="line">			tcp = (TcpHeader *)((u_char *)ip+ip_len);</span><br><span class="line">			<span class="keyword">char</span> * data;</span><br><span class="line">			 data = (<span class="keyword">char</span> *)((u_char *)tcp+<span class="number">20</span>);</span><br><span class="line">			 <span class="comment">//将网络字节序列转换成主机字节序列</span></span><br><span class="line">			sport = ntohs( tcp-&gt;SrcPort );</span><br><span class="line">			dport = ntohs( tcp-&gt;DstPort );</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"srcport:%d desport:%d\n"</span>,sport,dport);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"%d.%d.%d.%d.%d -&gt; %d.%d.%d.%d.%d\n"</span>,</span><br><span class="line">					ip-&gt;SourceAddr.byte1,</span><br><span class="line">					ip-&gt;SourceAddr.byte2,</span><br><span class="line">					ip-&gt;SourceAddr.byte3,</span><br><span class="line">					ip-&gt;SourceAddr.byte4,</span><br><span class="line">				    sport,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte1,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte2,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte3,</span><br><span class="line">				    ip-&gt;DestinationAddr.byte4,</span><br><span class="line">				    dport);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"%s\n"</span>,data);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//释放网络适配器列表</span></span><br><span class="line">	pcap_freealldevs(alldevs);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	int pcap_loop  ( pcap_t *  p,  </span></span><br><span class="line"><span class="comment">								  int  cnt,  </span></span><br><span class="line"><span class="comment">								  pcap_handler  callback,  </span></span><br><span class="line"><span class="comment">								  u_char *  user   </span></span><br><span class="line"><span class="comment">								 );</span></span><br><span class="line"><span class="comment">     typedef void (*pcap_handler)(u_char *, const struct pcap_pkthdr *,</span></span><br><span class="line"><span class="comment">                 const u_char *);</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="comment">//开始捕获信息,当捕获到数据包时,会自动调用这个函数</span></span><br><span class="line">	<span class="comment">//pcap_loop(adhandle,0,packet_handler,NULL);</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> inum;</span><br><span class="line">	scanf_s(<span class="string">"%d"</span>, &amp;inum);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 每次捕获到数据包时，libpcap都会自动调用这个回调函数 */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">pcap_loop()函数是基于回调的原理来进行数据捕获的，如技术文档所说，这是一种精妙的方法，并且在某些场合下，</span></span><br><span class="line"><span class="comment">它是一种很好的选择。但是在处理回调有时候会并不实用，它会增加程序的复杂度，特别是在多线程的C++程序中</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">void packet_handler(u_char *param, const struct pcap_pkthdr *header, const u_char *pkt_data)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    struct tm *ltime = NULL;</span></span><br><span class="line"><span class="comment">    char timestr[16];</span></span><br><span class="line"><span class="comment">    time_t local_tv_sec;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    // 将时间戳转换成可识别的格式</span></span><br><span class="line"><span class="comment">    local_tv_sec = header-&gt;ts.tv_sec;</span></span><br><span class="line"><span class="comment">    localtime_s(ltime,&amp;local_tv_sec);</span></span><br><span class="line"><span class="comment">    strftime( timestr, sizeof timestr, "%H:%M:%S", ltime);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    printf("%s,%.6ld len:%d\n", timestr, header-&gt;ts.tv_usec, header-&gt;len);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">/* 将数字类型的IP地址转换成字符串类型的 */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> IPTOSBUFFERS    12</span></span><br><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">iptos</span><span class="params">(u_long in)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">char</span> output[IPTOSBUFFERS][<span class="number">3</span>*<span class="number">4</span>+<span class="number">3</span>+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">static</span> short which;</span><br><span class="line">    u_char *p;</span><br><span class="line"></span><br><span class="line">    p = (u_char *)&amp;in;</span><br><span class="line">    which = (which + <span class="number">1</span> == IPTOSBUFFERS ? <span class="number">0</span> : which + <span class="number">1</span>);</span><br><span class="line">    sprintf_s(output[which], <span class="string">"%d.%d.%d.%d"</span>, p[<span class="number">0</span>], p[<span class="number">1</span>], p[<span class="number">2</span>], p[<span class="number">3</span>]);</span><br><span class="line">    <span class="keyword">return</span> output[which];</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p> 运行截图如下 <img src="http://img.blog.csdn.net/20141018212813479?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> <img src="http://img.blog.csdn.net/20141018212943896?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> Thank You 如有问题，欢迎留言~</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-07-13 01:14:21" itemprop="dateCreated datePublished" datetime="2015-07-13T01:14:21+08:00">2015-07-13</time>
                </span>
                <span id="/1918.html" class="post-meta-item leancloud_visitors" data-flag-title="Winpcap网络编程五之ARP协议获得MAC表及主机通信" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>28k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>26 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1913.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> C/C++ <i class="label-arrow"></i>
                  </a>
                  <a href="/1913.html" class="post-title-link" itemprop="url">Winpcap网络编程四之环境配置，VS配置Winpcap环境</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>上一篇我们介绍了Eclipse配置Winpcap环境。但是美中不足的是Eclipse编写Winpcap会出现各种各样神奇的错误… 本文原文地址： <a href="http://blog.csdn.net/cqcre/article/details/40429517" target="_blank" rel="noopener">我的CSDN博客</a> 其实也不是不能用，就是总是报一些函数不能识别的错误，每次不能识别的函数就是因为缺少了各种各样的头文件或者宏定义…让我比较纠结，心中不由得萌生了一个想法，换个环境试试吧，于是VS环境配置就这么神奇的产生了…. 好，接下来我以VS2012为例为大家讲解Winpcap环境配置，其实VS2010，VS2013等等的版本都是通用哒.. 首先你要有一个VS…这不是废话么… 首先，按照 <a href="http://cuiqingcai.com/1906.html">Eclipse配置Winpcap环境</a> 配置好Winpcap和下载好相关的SDK，这里就不再赘述了 好，文件-新建-项目-Win32控制台应用程序，可以修改下面的路径和项目名称，然后确定 <img src="http://img.blog.csdn.net/20141024163401921?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 接下来就会蹦出一个窗口..点击下一步 <img src="http://img.blog.csdn.net/20141024163542249?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 下一步，勾选空项目，然后点击确定，空项目一定要勾选，不然会生成一些不必要的文件。 <img src="http://img.blog.csdn.net/20141024163702870?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 点击完成，现在看到的界面如下： <img src="http://img.blog.csdn.net/20141024163856875?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 在项目名上右键单击，选择属性 链接器选项卡—输入—附加依赖项中在前面输入ws2_32.lib;wpcap.lib; 两个类库，截图如下 <img src="http://img.blog.csdn.net/20141024164256328?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> C/C++选项卡—-预处理器—-预处理器定义键入HAVE_REMOTE;WPCAP; 如图所示 <img src="http://img.blog.csdn.net/20141024164409203?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> VC++目录，加入你的Winpcap类库路径，文件夹应该叫WpdPack，一个是Include,一个是lib,这是绝对路径，你的可能与我的不一样，截图如下 <img src="http://img.blog.csdn.net/20141024164629073?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 好了。点击确定，环境就配好啦。 接下来新建一个cpp文件，运行程序就OK了… <img src="http://img.blog.csdn.net/20141024164828671?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 如有问题，欢迎留言交流</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-07-13 01:02:24" itemprop="dateCreated datePublished" datetime="2015-07-13T01:02:24+08:00">2015-07-13</time>
                </span>
                <span id="/1913.html" class="post-meta-item leancloud_visitors" data-flag-title="Winpcap网络编程四之环境配置，VS配置Winpcap环境" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>662</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1906.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> C/C++ <i class="label-arrow"></i>
                  </a>
                  <a href="/1906.html" class="post-title-link" itemprop="url">Winpcap网络编程三之环境配置，Eclipse配置Winpcap环境</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>大家好，本节为大家带来在Eclipse下配置Winpcap环境，欢迎大家收看。 本文原文地址来自： <a href="http://blog.csdn.net/cqcre/article/details/39754917" target="_blank" rel="noopener">我的CSDN博客</a> 首先，配置Winpcap环境的前提是你必须配置好了Eclipse下的C/C++环境。如果你还没有配置，欢迎大家收看上节内容进行配置。 链接地址： <a href="http://blog.csdn.net/cqcre/article/details/39754251" target="_blank" rel="noopener">Eclipse配置C/C++环境</a> 若链接失效，请自行查看上一篇文章或者百度其他文章。 废话不多说啦，开始我们的Winpcap的配置。</p>
                  <h2 id="Winpcap下载"><a href="#Winpcap下载" class="headerlink" title="Winpcap下载"></a>Winpcap下载</h2>
                  <p>Winpcap官网： <a href="http://www.winpcap.org/" target="_blank" rel="noopener">Winpcap官网</a> Winpcap目前最新版为4.1.3,首先你要下载exe文件并安装，直接双击运行安装即可。 下载地址： <a href="http://www.winpcap.org/install/default.htm" target="_blank" rel="noopener">Winpcap4.1.3.exe</a> 然后你需要下载开发包，首先必须注意的是，目前最新版本是没有开发包的，最新的开发包为4.1.2，先见下图 <img src="http://img.blog.csdn.net/20141003120936027?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 下面的红色框说明了目前没有提供Winpcap4.1.3的开发包，最新版本的开发包是4.1.2，他可以与4.1.3的Winpcap配套使用。 所以下载4.1.2的开发包。 下载地址： <a href="http://www.winpcap.org/devel.htm" target="_blank" rel="noopener">Winpcap Developer’s Pack 4.1.2</a></p>
                  <h2 id="Eclipse相关配置"><a href="#Eclipse相关配置" class="headerlink" title="Eclipse相关配置"></a>Eclipse相关配置</h2>
                  <p>首先新建一个C 的项目，具体的建立过程可以参见上一节的内容。 我们加入一个测试代码如下：</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> WIN32</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HAVE_REMOTE</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"pcap.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Win32-Extensions.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gen_packet</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> *buf,<span class="keyword">int</span> len)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*生成数据包*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gen_packet</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> *buf,<span class="keyword">int</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">		<span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//设置目标MAC地址为01:01:01:01:01:01</span></span><br><span class="line">		<span class="keyword">for</span> (i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)</span><br><span class="line">		&#123;</span><br><span class="line">			buf[i]=<span class="number">0x01</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//设置源MAC地址为02:02:02:02:02:02</span></span><br><span class="line">		<span class="keyword">for</span> (i=<span class="number">6</span>;i&lt;<span class="number">12</span>;i++)</span><br><span class="line">		&#123;</span><br><span class="line">			buf[i]=<span class="number">0x02</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//设置协议标识为0xc0xd，无任何实际意义</span></span><br><span class="line">		buf[<span class="number">12</span>]=<span class="number">0xc</span>;</span><br><span class="line">		buf[<span class="number">13</span>]=<span class="number">0xd</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//填充数据包的内容</span></span><br><span class="line">		<span class="keyword">for</span>(i=<span class="number">14</span>;i&lt;len;i++)</span><br><span class="line">		&#123;</span><br><span class="line">			buf[i]=i<span class="number">-14</span>;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">pcap_if_t</span> *alldevs;</span><br><span class="line">	<span class="keyword">pcap_if_t</span> *d;</span><br><span class="line">	<span class="keyword">int</span> inum;</span><br><span class="line">	<span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">pcap_t</span> *adhandle;</span><br><span class="line">	<span class="keyword">char</span> errbuf[PCAP_ERRBUF_SIZE];</span><br><span class="line">	<span class="keyword">int</span> ret=<span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 获取本机网络设备列表 */</span></span><br><span class="line">    <span class="keyword">if</span> (pcap_findalldevs_ex(PCAP_SRC_IF_STRING, <span class="literal">NULL</span>, &amp;alldevs, errbuf) == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,<span class="string">"Error in pcap_findalldevs: %s\n"</span>, errbuf);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 打印网络设备列表 */</span></span><br><span class="line">    <span class="keyword">for</span>(d=alldevs; d; d=d-&gt;next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d. %s"</span>, ++i, d-&gt;name);</span><br><span class="line">        <span class="keyword">if</span> (d-&gt;description)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">" (%s)\n"</span>, d-&gt;description);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">" (No description available)\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(i==<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\nNo interfaces found! Make sure WinPcap is installed.\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*选择网络设备接口*/</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Enter the interface number (1-%d):"</span>,i);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;inum);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(inum &lt; <span class="number">1</span> || inum &gt; i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\nInterface number out of range.\n"</span>);</span><br><span class="line">        <span class="comment">/* 释放设备列表 */</span></span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 跳转到选中的适配器 */</span></span><br><span class="line">    <span class="keyword">for</span>(d=alldevs, i=<span class="number">0</span>; i&lt; inum<span class="number">-1</span> ;d=d-&gt;next, i++);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 打开设备 */</span></span><br><span class="line">    <span class="keyword">if</span> ( (adhandle= pcap_open(d-&gt;name,          <span class="comment">// 设备名</span></span><br><span class="line">							  <span class="number">65536</span>,            <span class="comment">// 65535保证能捕获到数据链路层上每个数据包的全部内容</span></span><br><span class="line">							  PCAP_OPENFLAG_PROMISCUOUS,    <span class="comment">// 混杂模式</span></span><br><span class="line">                              <span class="number">1000</span>,             <span class="comment">// 读取超时时间</span></span><br><span class="line">                              <span class="literal">NULL</span>,             <span class="comment">// 远程机器验证</span></span><br><span class="line">                              errbuf            <span class="comment">// 错误缓冲池</span></span><br><span class="line">                              ) ) == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,<span class="string">"\nUnable to open the adapter. %s is not supported by WinPcap\n"</span>, d-&gt;name);</span><br><span class="line">        <span class="comment">/* 释放设备列表 */</span></span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*在选中的设备接口上发送数据*/</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\nsending on %s...\n"</span>, d-&gt;description);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 发送数据包*/</span></span><br><span class="line">	<span class="comment">//生成数据报</span></span><br><span class="line">	<span class="keyword">int</span> packetlen=<span class="number">100</span>;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> *buf= (<span class="keyword">unsigned</span> <span class="keyword">char</span> *)<span class="built_in">malloc</span>(packetlen);</span><br><span class="line">	<span class="built_in">memset</span>(buf,<span class="number">0x0</span>,packetlen);</span><br><span class="line">	gen_packet(buf,packetlen); <span class="comment">//获得生成的数据包，长度为packetlen</span></span><br><span class="line">	<span class="comment">//开始数据包发送</span></span><br><span class="line">	<span class="keyword">if</span> ( (ret=pcap_sendpacket(adhandle,buf,packetlen))==<span class="number">-1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"发送失败\n"</span>);</span><br><span class="line">		<span class="built_in">free</span>(buf);</span><br><span class="line">		pcap_close(adhandle);</span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	 <span class="comment">/*释放资源*/</span></span><br><span class="line">	 <span class="built_in">free</span>(buf);</span><br><span class="line">	 pcap_close(adhandle);</span><br><span class="line">	 pcap_freealldevs(alldevs);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>把代码拷贝到你的项目程序里面，可以发现现在是编译错误，有些对象根本无法识别，截图如下： <img src="http://img.blog.csdn.net/20141003121756538?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 接下来就需要我们对类库进行配置啦。 首先解压你下载的开发包，随便放硬盘的某个位置，我放在了D盘的eclipse_plugins文件夹中，当然你可以随便放哪里都行。 <img src="http://img.blog.csdn.net/20141003122134034?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 接下来配置Eclipse，右键项目-&gt;属性-&gt;C/C++常规-&gt;项目和符号。 <img src="http://img.blog.csdn.net/20141003122332235?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 首先添加你的include库，在包含这个选项卡中添加你的库，点击添加-&gt;选择文件系统-&gt;选择你刚才的开发库的include文件夹，按照图中的顺序来 <img src="http://img.blog.csdn.net/20141003122614796?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> <img src="http://img.blog.csdn.net/20141003122856279?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 点击确定添加，同理在库路径选项卡中进行库路径的配置，这次添加的是lib文件夹。按照图片中的顺序来做 <img src="http://img.blog.csdn.net/20141003123234570?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> <img src="http://img.blog.csdn.net/20141003123311433?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 点击确定添加。 然后在库的选项卡中添加wpcap和Packet两个库，注意这次不能选择文件系统了，因为你指定了库路径之后它会自动搜索路径中库的名字，这次你只需要指定库的名字就好了。我之前添加的是文件系统，然后它总是提示找不到这个库，所以一定要直接填写这两个库的名字。如图所示： <img src="http://img.blog.csdn.net/20141003123715375?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 添加完毕之后，出现这个样子： <img src="http://img.blog.csdn.net/20141003123823109?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 好啦，点击确定，全部配置已经完毕啦。 重新构建项目，运行即可。 注意，构建过程可能出现如下问题：</p>
                  <ul>
                    <li>error C2065: “PCAP_SRC_IF_STRING”: 未声明的标识符</li>
                    <li>error C3861: “pcap_findalldevs_ex”: 找不到标识符</li>
                    <li>error C2065: “PCAP_OPENFLAG_PROMISCUOUS”: 未声明的标识符</li>
                    <li>error C3861: “pcap_open”: 找不到标识符</li>
                  </ul>
                  <p>因为新的版本里WinPcap支持远程数据包获取，所以还应当添加一个头文件remote-ext.h ，即#include “remote-ext.h”（记住这条语句要放在#include “pcap.h”之后，否则会出错！） <img src="http://img.blog.csdn.net/20141003124531280?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 好了，一切问题都解决了，运行成功啦！ 运行结果如下： <img src="http://img.blog.csdn.net/20141003124547093?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 再附测试代码一例：</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> WIN32</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> HAVE_REMOTE</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"pcap.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Win32-Extensions.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gen_packet</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> *buf,<span class="keyword">int</span> len)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*生成数据包*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">gen_packet</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> *buf,<span class="keyword">int</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">		<span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//设置目标MAC地址为01:01:01:01:01:01</span></span><br><span class="line">		<span class="keyword">for</span> (i=<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)</span><br><span class="line">		&#123;</span><br><span class="line">			buf[i]=<span class="number">0x01</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//设置源MAC地址为02:02:02:02:02:02</span></span><br><span class="line">		<span class="keyword">for</span> (i=<span class="number">6</span>;i&lt;<span class="number">12</span>;i++)</span><br><span class="line">		&#123;</span><br><span class="line">			buf[i]=<span class="number">0x02</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//设置协议标识为0xc0xd，无任何实际意义</span></span><br><span class="line">		buf[<span class="number">12</span>]=<span class="number">0xc</span>;</span><br><span class="line">		buf[<span class="number">13</span>]=<span class="number">0xd</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//填充数据包的内容</span></span><br><span class="line">		<span class="keyword">for</span>(i=<span class="number">14</span>;i&lt;len;i++)</span><br><span class="line">		&#123;</span><br><span class="line">			buf[i]=i<span class="number">-14</span>;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">pcap_if_t</span> *alldevs;</span><br><span class="line">	<span class="keyword">pcap_if_t</span> *d;</span><br><span class="line">	<span class="keyword">int</span> inum;</span><br><span class="line">	<span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">pcap_t</span> *adhandle;</span><br><span class="line">	<span class="keyword">char</span> errbuf[PCAP_ERRBUF_SIZE];</span><br><span class="line">	<span class="keyword">int</span> ret=<span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 获取本机网络设备列表 */</span></span><br><span class="line">    <span class="keyword">if</span> (pcap_findalldevs_ex(PCAP_SRC_IF_STRING, <span class="literal">NULL</span>, &amp;alldevs, errbuf) == <span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,<span class="string">"Error in pcap_findalldevs: %s\n"</span>, errbuf);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 打印网络设备列表 */</span></span><br><span class="line">    <span class="keyword">for</span>(d=alldevs; d; d=d-&gt;next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%d. %s"</span>, ++i, d-&gt;name);</span><br><span class="line">        <span class="keyword">if</span> (d-&gt;description)</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">" (%s)\n"</span>, d-&gt;description);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">" (No description available)\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(i==<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\nNo interfaces found! Make sure WinPcap is installed.\n"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*选择网络设备接口*/</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Enter the interface number (1-%d):"</span>,i);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;inum);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(inum &lt; <span class="number">1</span> || inum &gt; i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\nInterface number out of range.\n"</span>);</span><br><span class="line">        <span class="comment">/* 释放设备列表 */</span></span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 跳转到选中的适配器 */</span></span><br><span class="line">    <span class="keyword">for</span>(d=alldevs, i=<span class="number">0</span>; i&lt; inum<span class="number">-1</span> ;d=d-&gt;next, i++);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 打开设备 */</span></span><br><span class="line">    <span class="keyword">if</span> ( (adhandle= pcap_open(d-&gt;name,          <span class="comment">// 设备名</span></span><br><span class="line">							  <span class="number">65536</span>,            <span class="comment">// 65535保证能捕获到数据链路层上每个数据包的全部内容</span></span><br><span class="line">							  PCAP_OPENFLAG_PROMISCUOUS,    <span class="comment">// 混杂模式</span></span><br><span class="line">                              <span class="number">1000</span>,             <span class="comment">// 读取超时时间</span></span><br><span class="line">                              <span class="literal">NULL</span>,             <span class="comment">// 远程机器验证</span></span><br><span class="line">                              errbuf            <span class="comment">// 错误缓冲池</span></span><br><span class="line">                              ) ) == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,<span class="string">"\nUnable to open the adapter. %s is not supported by WinPcap\n"</span>, d-&gt;name);</span><br><span class="line">        <span class="comment">/* 释放设备列表 */</span></span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*在选中的设备接口上发送数据*/</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"\nsending on %s...\n"</span>, d-&gt;description);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 发送数据包*/</span></span><br><span class="line">	<span class="comment">//生成数据报</span></span><br><span class="line">	<span class="keyword">int</span> packetlen=<span class="number">100</span>;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> *buf= (<span class="keyword">unsigned</span> <span class="keyword">char</span> *)<span class="built_in">malloc</span>(packetlen);</span><br><span class="line">	<span class="built_in">memset</span>(buf,<span class="number">0x0</span>,packetlen);</span><br><span class="line">	gen_packet(buf,packetlen); <span class="comment">//获得生成的数据包，长度为packetlen</span></span><br><span class="line">	<span class="comment">//开始数据包发送</span></span><br><span class="line">	<span class="keyword">if</span> ( (ret=pcap_sendpacket(adhandle,buf,packetlen))==<span class="number">-1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"发送失败\n"</span>);</span><br><span class="line">		<span class="built_in">free</span>(buf);</span><br><span class="line">		pcap_close(adhandle);</span><br><span class="line">        pcap_freealldevs(alldevs);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	 <span class="comment">/*释放资源*/</span></span><br><span class="line">	 <span class="built_in">free</span>(buf);</span><br><span class="line">	 pcap_close(adhandle);</span><br><span class="line">	 pcap_freealldevs(alldevs);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果：</p>
                  <figure class="highlight maxima">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="number">1</span>. rpcap://\Device\NPF_&#123;5AC72F8D-<span class="number">019C</span>-<span class="number">4003</span>-B51B-7ABB67AF392A&#125; (Network adapter 'Microsoft' on <span class="built_in">local</span> host)</span><br><span class="line"><span class="number">2</span>. rpcap://\Device\NPF_&#123;33E23A2F-F791-<span class="number">409B-8452</span>-A3FB5A78B73E&#125; (Network adapter 'Qualcomm Atheros Ar81xx series PCI-E Ethernet Controller' on <span class="built_in">local</span> host)</span><br><span class="line"><span class="number">3</span>. rpcap://\Device\NPF_&#123;DCCF036F-A9A8-<span class="number">4225</span>-B980-D3A3F0575F5B&#125; (Network adapter 'Microsoft' on <span class="built_in">local</span> host)</span><br><span class="line"><span class="number">4</span>. rpcap://\Device\NPF_&#123;D62A0060-F424-46FC-83A5-3394081685FD&#125; (Network adapter 'Microsoft' on <span class="built_in">local</span> host)</span><br><span class="line"><span class="number">5</span>. rpcap://\Device\NPF_&#123;B5224A53-<span class="number">8450</span>-<span class="number">4537</span>-AB3B-9869158121CD&#125; (Network adapter 'Microsoft' on <span class="built_in">local</span> host)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>那么环境配好了，我们接下来就要进行计算机网络编程学习阶段了，后期的文章将会记录我计算机网络编程学习的一些内容，欢迎大家收看。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-07-13 00:54:24" itemprop="dateCreated datePublished" datetime="2015-07-13T00:54:24+08:00">2015-07-13</time>
                </span>
                <span id="/1906.html" class="post-meta-item leancloud_visitors" data-flag-title="Winpcap网络编程三之环境配置，Eclipse配置Winpcap环境" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>6.5k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>6 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1898.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> C/C++ <i class="label-arrow"></i>
                  </a>
                  <a href="/1898.html" class="post-title-link" itemprop="url">Winpcap网络编程二之环境配置，Eclipse配置C/C++环境</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>本次为大家带来的是用Eclipse配置C/C++环境的具体步骤，希望对大家有帮助哦。 <strong>声明：如果你希望用Eclipse开发，可以参考本文章配置环境，如若想用VS开发，请看后面的文章。</strong> 本文原文地址来自 <a href="http://blog.csdn.net/cqcre/article/details/39754251" target="_blank" rel="noopener">我的CSDN博客</a> Eclipse 配置C/C++开发环境讲解</p>
                  <h2 id="JDK"><a href="#JDK" class="headerlink" title="JDK"></a>JDK</h2>
                  <p>如果没有安装JDK环境的小伙伴请自行去官网下载安装啦，安装之后的就可以跳过此步. 下载地址： <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank" rel="noopener">JDK下载</a><a href="http://jingyan.baidu.com/article/6dad5075d1dc40a123e36ea3.html" target="_blank" rel="noopener">JDK环境配置</a></p>
                  <h2 id="Eclipse"><a href="#Eclipse" class="headerlink" title="Eclipse"></a>Eclipse</h2>
                  <p>当然，下载JDK的目的是在Eclipse下先运行起Java程序，这样才能方便我们下一步的操作，没有Eclipse的也去下载。 下载地址： <a href="http://www.eclipse.org/downloads/download.php?file=/eclipse/downloads/drops/R-3.7-201106131736/eclipse-SDK-3.7-win32.zip" target="_blank" rel="noopener">Eclipse下载</a> 上面两步我想难度都很小，而且大部分同学已经配置了，我就不一一讲解了。</p>
                  <h2 id="CDT"><a href="#CDT" class="headerlink" title="CDT"></a>CDT</h2>
                  <p>CDT是什么？它就是Eclipse的一个插件，我们需要安装了之后才可以新建C/C++项目。 注意：下载的CDT必须和Eclipse的版本对应。 下载地址： <a href="http://www.eclipse.org/cdt/" target="_blank" rel="noopener">CDT下载</a> 上面下载的Eclipse是3.7版本，在此给出适配CDT 8.0的下载链接。 下载地址： <a href="http://www.eclipse.org/downloads/download.php?file=/tools/cdt/releases/indigo/dist/cdt-master-8.0.0.zip&amp;url=http://mirrors.ustc.edu.cn/eclipse/tools/cdt/releases/indigo/dist/cdt-master-8.0.0.zip&amp;mirror_id=1093" target="_blank" rel="noopener">CDT 8.0下载</a> 如果上述链接已失效，请自行百度适配你Eclipse版本的CDT进行下载。 下载之后它是一个压缩包zip格式。 不要解压直接安装即可，安装讲解如下： 打开Eclipse，进入菜单Help，选择Install New Software…，点击右边Add按钮，在Add Repository对话框中点击右下角的Archive…，浏览到你之前下载保存路径，选中cdt-master-8.0.0.zip并双击，勾选所有CDT部件，然后点击Next&gt;，继续Next&gt;，选中“I accept the terms of the license agreement – Finish”，点击Finish开始安装CDT。 <img src="http://img.blog.csdn.net/20141003110738384?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 安装完CDT后重启Eclipse。 <img src="http://img.blog.csdn.net/20141003110647109?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 这样我们的Eclipse的CDT插件就安装好啦，这时你会发现可以新建C/C++项目了，但是还是不能编译运行，为什么？因为没有安装编译器。接下来我们需要下载mingw编译器。</p>
                  <h2 id="MinGW"><a href="#MinGW" class="headerlink" title="MinGW"></a>MinGW</h2>
                  <p>这是一个配套Eclipse的C/C++编译器，首先我们下载下来。 官网下载地址： <a href="http://sourceforge.net/projects/mingw/files/MinGW/" target="_blank" rel="noopener">mingw官网下载</a> 现在发现最新版本下载是： <a href="http://sourceforge.net/projects/mingw/files/latest/download?source=files" target="_blank" rel="noopener">mingw-get-setup.exe</a> 双击运行，选择安装路径，我的路径为：D:\mingw，安装完成之后你会发现出现一个下载库的窗口，叫Mingw Installation Manager 注意： 1. 我的类库已经安装完毕，所以每个类库前面都显示为绿色的方框，没安装之前是白色的，你需要都勾选上，然后下载安装。在每个类库上邮件单击选择make for installation即可勾选。再点击菜单中的Installation中的Update Catalogue即可安装你所勾选的类库了。 2. 安装下载可能花费不少时间，请耐心等待。 <img src="http://img.blog.csdn.net/20141003111834646?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 大家可以发现最左边有Basic Steup和All Packages两个分类。 第一个Basic Steup即为必须要安装的编译类库，All Packages即为所有的类库。为了保险起见，我把所有的类库都安装了。全部安装完之后即会显示绿色。 安装完之后的目录结构如下： <img src="http://img.blog.csdn.net/20141003112632413?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
                  <h2 id="环境变量配置"><a href="#环境变量配置" class="headerlink" title="环境变量配置"></a>环境变量配置</h2>
                  <p>环境变量配置： 计算机– 属性 – 高级系统设置 – 环境变量 在上方的用户变量中进行如下操作： 注意：mingw的位置不同，环境变量的配置不同，可以看最底层目录比对着来配置。我的环境变量配置如下：</p>
                  <blockquote>
                    <p>（1）编辑PATH变量，在最后面加入 D:\mingw\bin D:\mingw\msys\1.0\bin D:\mingw\mingw32\bin （2）添加LIBRARY_PATH变量，内容为： D:\mingw\lib （3）添加C_INCLUDE_PATH变量，内容为： D:\mingw\include （4）添加CPLUS_INCLUDE_PATH变量，内容为： D:\mingw\lib\gcc\mingw32\4.8.1\include\c++</p>
                  </blockquote>
                  <p>修改：</p>
                  <blockquote>
                    <p>进入D:\mingw\bin下将mingw32-make.exe复制成make.exe。因为Eclipse使用时预设是用系统里的”make”这个文件名，而不是”mingw32-make”。</p>
                  </blockquote>
                  <p>Eclipse中的配置： 窗口 -&gt; 首选项 -&gt; C/C++ -&gt; New CDT Project Wizard 在右边的首选工具链的右边，工具链栏目内选择MinGW GCC，确定，如图所示： <img src="http://img.blog.csdn.net/20141003113658894?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 还是在原来的 New CDT Project Wizard选项卡中，展开，Makefile项目，二进制解析器，勾选PE windows解析器，确定，如图所示。 <img src="http://img.blog.csdn.net/20141003113807484?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 好啦，配置工作完成，我们来测试一下新C语言项目。</p>
                  <h2 id="测试项目"><a href="#测试项目" class="headerlink" title="测试项目"></a>测试项目</h2>
                  <p>右键新建-&gt;项目-&gt;C项目 <img src="http://img.blog.csdn.net/20141003114106872?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 下一步，选择可执行文件，Hello World ANCI C Project 编译器选择 MinGw GCC 完成，如图所示： <img src="http://img.blog.csdn.net/20141003114126625?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 完成之后的界面应该是如下所示，点击构建项目，图中的红色圆圈，构建完成之后，右键运行程序 <img src="http://img.blog.csdn.net/20141003114748589?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> <img src="http://img.blog.csdn.net/20141003114637750?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 运行结果： <img src="http://img.blog.csdn.net/20141003115048145?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> 欢呼吧小伙伴们 ! Eclipse 配置C/C++环境到此完全结束，如果有问题欢迎交流。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-07-13 00:45:39" itemprop="dateCreated datePublished" datetime="2015-07-13T00:45:39+08:00">2015-07-13</time>
                </span>
                <span id="/1898.html" class="post-meta-item leancloud_visitors" data-flag-title="Winpcap网络编程二之环境配置，Eclipse配置C/C++环境" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.1k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1890.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> C/C++ <i class="label-arrow"></i>
                  </a>
                  <a href="/1890.html" class="post-title-link" itemprop="url">Winpcap网络编程一之前言，实验要求，实验目标</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>Hi，大家好，现在计算机网络课程设计开始啦，本次为大家带来计算机网络实验的系列讲解，希望对于小伙伴们的计网课设有一定帮助哦。</p>
                  <h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2>
                  <p>首先，博主来自山东大学，这次计网课程设计的实验学校为山东大学，年级为2012级，请对号入座。 另外，对于上学期学的计算机网络课程知识，可以说我就是为了应付考试最后狂背下来的，感觉对于计算机网络里的一些原理真的没有理解。纯粹看一些概念性的东西真的是太抽象啦，这次计网课设的目的就是让我们用编程实现网络分析技术和网络功能仿真，来深入了解计算机网络知识。可以说这些才是学习计算机网络最重要的一环，大家加油。</p>
                  <h2 id="实验要求"><a href="#实验要求" class="headerlink" title="实验要求"></a>实验要求</h2>
                  <p>1、基本任务（达标任务） 完成两台主机之间的数据通信（数据链路层）</p>
                  <ul>
                    <li>仿真ARP协议获得网段内主机的MAC表</li>
                    <li>使用帧完成两台主机的通信（Hello! I’m …)</li>
                  </ul>
                  <p>2、高端任务（优秀任务） 完成两台主机通过中间主机的数据通信（网络层）</p>
                  <ul>
                    <li>增加基于IP地址的转发功能</li>
                    <li>增加网络层封装</li>
                  </ul>
                  <p>本次任务呢分为基本任务和高端任务，当然我们的目标当然不仅限于基本任务咯。</p>
                  <h2 id="实验概述"><a href="#实验概述" class="headerlink" title="实验概述"></a>实验概述</h2>
                  <p>一句话，我们需要利用winpcap这个库用C语言编程来实现以上的任务。</p>
                  <h2 id="winpcap讲解"><a href="#winpcap讲解" class="headerlink" title="winpcap讲解"></a>winpcap讲解</h2>
                  <p>那么winpcap是什么？ 大多数网络应用程序通过被广泛使用的操作系统原件来访问网络，如socket。由于操作系统已经处理了底层的细节问题（如协议的处理、数据包的封装等），并提供了与读写文件类似的函数接口，因此使用该方法可以很容易的访问网络中的数据 然而有些时候，这种简单的方式并不能满足任务要求，有些应用程序需要直接访问网络中的数据包，也就是说，需要访问哪些没有被操作系统处理过的数据包 WinPcap就是为Windows平台的应用程序提供这种访问方式，提供下列功能：</p>
                  <ul>
                    <li>捕获原始数据包。无论是发送到运行WinPcap的机器上的数据包，还是在其它主机（存在网络共享介质上的主机）上进行交换的数据包，都可以被捕获</li>
                    <li>在数据包传递给应用程序之前，根据用户指定的规则过滤数据包</li>
                    <li>将原始数据包发送到网络上</li>
                    <li>收集网络流量与网络状态的统计信息</li>
                  </ul>
                  <p>它提供给我们什么呢？</p>
                  <p>它包含一个内核空间数据包过滤器（Netgroup Packet Filter, NPF)，一个底层动态链接库（Packet.dll)和一个高层独立于操作系统的动态链接库(wpcap.dll)。各部分关系见下图</p>
                  <p><img src="http://img.blog.csdn.net/20141003103218640?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvY3FjcmU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""> NPF：为了能够访问网络上传输的原始数据，数据包捕获系统需要绕过操作系统的协议栈。这就需要有一部分程序运行在操作系统的内核中，只有这样才能与网络接口驱动直接交互。在WinPcap中，与操作系统密切相关的是一个名为NPF的设备驱动程序，同时对不同版本的操作系统提供了不同版本的驱动程序。这些驱动程序提供了数据包捕获与发送的基本功能，同时提供了一个可编程的数据包过滤系统、一个网络监视引擎等高级功能。 动态链接库：为了让应用程序能够使用内核驱动提供的功能，数据包捕获系统必须导出相关的接口。对此，WinPcap提供两个不同层次的动态链接库：Packet.dll和wpcap.dll。 Packet.dll提供底层的API，用来直接访问驱动程序的函数，用来提供独立于微软公司不同操作系统的编程接口。 wpcap.dll库导出了更强大、更高层的捕获函数接口，具有与UNIX捕获库libpcap的兼容性。这两个库可使数据包的捕获独立于底层的网络硬件与操作系统。</p>
                  <h2 id="实验流程"><a href="#实验流程" class="headerlink" title="实验流程"></a>实验流程</h2>
                  <p>了解了winpcap之后，我们要做的就是利用它提供的类库来实现网络传输，网络解析等一系列的功能。</p>
                  <p>需要我们做好的准备有：</p>
                  <ul>
                    <li>C语言的相关基础</li>
                    <li>计算机网络的基础知识</li>
                    <li>对开发环境的相关了解</li>
                  </ul>
                  <p>如果对于上述中任何一个不熟悉，请先去补习一下基础知识吧。</p>
                  <h2 id="参考书目"><a href="#参考书目" class="headerlink" title="参考书目"></a>参考书目</h2>
                  <ul>
                    <li>吴功宜等，《计算机网络高级软件编程技术》（第2版），清华大学出版社</li>
                    <li>徐恪等， 《高级计算机网络》，清华大学出版社</li>
                    <li>A.S. Tannenbaum，《计算机网络》（第5版），清华大学出版社</li>
                    <li>吕雪峰等， 《网络分析技术揭秘（原理、实践与WinPcap深入解析》，机械工业出版社</li>
                  </ul>
                  <h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2>
                  <p>下一节，我们将讲解在Eclipse环境下搭建winpcap环境的具体步骤。本次讲解到此结束，谢谢大家。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-07-13 00:35:59" itemprop="dateCreated datePublished" datetime="2015-07-13T00:35:59+08:00">2015-07-13</time>
                </span>
                <span id="/1890.html" class="post-meta-item leancloud_visitors" data-flag-title="Winpcap网络编程一之前言，实验要求，实验目标" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.7k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1883.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 个人日记 <i class="label-arrow"></i>
                  </a>
                  <a href="/1883.html" class="post-title-link" itemprop="url">假期到啦，重新回归代码之路</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>二零一五年七月九日，伴随着最后一门图形学交卷铃声的想起，我的大三正式结束了。首先很抱歉，最近一段时间一直在忙考试复习，时间也比较紧张，另外就是整理各种材料，还有准备一些面试，也算是忙得不亦乐乎，所以，这段时间也没有去编代码，大约也有一个月的时间没有更新博客了，有好多热心的朋友在我博客留言评论，也没有及时回复，在这里向大家说一声抱歉。放假回家之后，我会好好研究一下大家提出的意见和建议，给予大家回复的。 恩，接下来的日子应该会稍微轻松那么一点，自己的研究生路大体有了轮廓，有了规划。将来想从事的方向为信息安全方向，自己也做过一些项目和网站，对一些安全性问题要求也是比较高的，自己也对安全问题比较感兴趣，嗯。 现在时间是二零一五年七月十二日，昨天回家，收拾整顿一番，今天假期正式开始啦！ 上学期是我大学的第六个学期了，对于保研来说，也着实是最后的一个重要的学期了，学习上也要更加重视。仔细回想起来，这个学期实际的项目开发没有做过多少，和同学开发了一个演唱会支付系统，又完善了一下自己之前的项目。学期后期，基本上就是准备一些面试和靠前复习，另外还有一些研究生招生的面试咨询等等，结果就不透露啦，自我感觉还是不错。 本来有好多话想说，然而这个时间，却不想多言了。 心里的石头还没落地，最近的日子，好好准备即将到来的面试。暑假到了，想要学习的东西还有很多，重新开启我的代码之路！Come On！</p>
                  <p>崔庆才</p>
                  <p>2015/7/12</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-07-12 11:08:25" itemprop="dateCreated datePublished" datetime="2015-07-12T11:08:25+08:00">2015-07-12</time>
                </span>
                <span id="/1883.html" class="post-meta-item leancloud_visitors" data-flag-title="假期到啦，重新回归代码之路" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>599</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1867.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> C/C++ <i class="label-arrow"></i>
                  </a>
                  <a href="/1867.html" class="post-title-link" itemprop="url">OpenGL绘图实例十之绘制3D机器人</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>通过上一节说的绘制 3D 图形基础，我们应该对绘制 3D 图形有了基本的认识，接下来我们就进行一个实例，绘制一个 3D 机器人。 本节我们要完成的任务有：</p>
                  <blockquote>
                    <p>1.绘制一个仿真 3D 机器人(样式自选，参考例图)，至少包含头、躯干、四肢三个部分. 2.对机器人填充颜色。 3.增加点光源，使得机器人更加真实。 4.实现交互，使得能够控制机器人进行旋转、前进、后退等动作。 键盘”w”:前进 键盘”s”:后退 键盘”a”:顺时针旋转 键盘”d”:逆时针旋转</p>
                  </blockquote>
                  <p>接下来我们就一步步实现机器人的绘制吧。</p>
                  <h2 id="绘制球体"><a href="#绘制球体" class="headerlink" title="绘制球体"></a>绘制球体</h2>
                  <p>绘制球体我们有两种方法，一个叫 glutSolidSphere，另一个叫 glutWireSphere，这两个的区别在于，一个绘制的是实心的球体，另一个绘制的是现状描绘而成的球体，在绘制过程中，我们可以通过一个参数来对其进行控制。 glutSolidSphere 是 GLUT 工具包中的一个函数，该函数用于渲染一个球体。球体球心位于原点。在 OpenGL 中默认的原点就是窗口客户区的中心。 函数原型</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">void glutSolidSphere(GLdouble<span class="built_in"> radius </span>, GLint slices , GLint stacks);</span><br><span class="line">void glutWireSphere(GLdouble radius, GLint slices, GLint stacks );</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>radius，球体的半径 slices，以 Z 轴上线段为直径分布的圆周线的条数（将 Z 轴看成地球的地轴，类似于经线） stacks，围绕在 Z 轴周围的线的条数（类似于地球上纬线） 一般而言， 后两个参数赋予较大的值， 渲染花费的时间要长， 效果更逼真。 然而我们可以发现，这里并没有定义球中心的参数，所以，我们可以利用平移函数组合实现。即利用 glTranslated 函数来实现。最后，我们定义的画球体的方法如下</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//画球</span></span><br><span class="line">void draw<span class="constructor">Ball(<span class="params">double</span> R, <span class="params">double</span> <span class="params">x</span>, <span class="params">double</span> <span class="params">y</span>,<span class="params">double</span> <span class="params">z</span>, <span class="params">int</span> MODE)</span> &#123;</span><br><span class="line">	gl<span class="constructor">PushMatrix()</span>;</span><br><span class="line">	gl<span class="constructor">Translated(<span class="params">x</span>,<span class="params">y</span>,<span class="params">z</span>)</span>;</span><br><span class="line">	<span class="keyword">if</span> (MODE<span class="operator"> == </span>SOLID) &#123;</span><br><span class="line">		glut<span class="constructor">SolidSphere(R,20,20)</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (MODE ==WIRE) &#123;</span><br><span class="line">		glut<span class="constructor">WireSphere(R,20,20)</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	gl<span class="constructor">PopMatrix()</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中两个常量定义如下</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SOLID 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> WIRE 2</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里我们还用到了上一节所说的 PushMatrix 和 PopMatrix 方法。如果不熟悉，请查看上一节的内容。</p>
                  <h2 id="绘制长方体"><a href="#绘制长方体" class="headerlink" title="绘制长方体"></a>绘制长方体</h2>
                  <p>同样地，利用变换平移放缩的方法，再加上类库的绘制正方体的方法，我们也可以轻松地实现绘制长方体的方法。 正方体怎样变成长方体，很简单，拉伸一下就好了。所以，我们用到了 glScaled 方法。 绘制长方体的方法如下</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//画长方体</span></span><br><span class="line">void draw<span class="constructor">Skewed(<span class="params">double</span> <span class="params">l</span>, <span class="params">double</span> <span class="params">w</span>, <span class="params">double</span> <span class="params">h</span>, <span class="params">double</span> <span class="params">x</span>, <span class="params">double</span> <span class="params">y</span>, <span class="params">double</span> <span class="params">z</span>, <span class="params">int</span> MODE)</span> &#123;</span><br><span class="line">	gl<span class="constructor">PushMatrix()</span>;</span><br><span class="line">	gl<span class="constructor">Scaled(<span class="params">l</span>, <span class="params">w</span>, <span class="params">h</span>)</span>;</span><br><span class="line">	gl<span class="constructor">Translated(<span class="params">x</span>, <span class="params">y</span>, <span class="params">z</span>)</span>;</span><br><span class="line">	<span class="keyword">if</span> (MODE<span class="operator"> == </span>SOLID) &#123;</span><br><span class="line">		glut<span class="constructor">SolidCube(1)</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (MODE<span class="operator"> == </span>WIRE) &#123;</span><br><span class="line">		glut<span class="constructor">WireCube(1)</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	gl<span class="constructor">PopMatrix()</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里仍然还是定义了绘图模式，是线条还是实体。</p>
                  <h2 id="定义光照"><a href="#定义光照" class="headerlink" title="定义光照"></a>定义光照</h2>
                  <p>在这里提供一篇博文，讲光照讲得比较细致 <a href="http://www.cnblogs.com/opengl/archive/2012/11/14/2770745.html" target="_blank" rel="noopener">OPENGL 光照</a> 那么在这里我就直接贴上光照设置的实现</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">void</span> init() &#123;</span><br><span class="line">   <span class="comment">//定义光源的颜色和位置</span></span><br><span class="line">   GLfloat ambient[] = &#123; <span class="number">0.5</span>, <span class="number">0.8</span>, <span class="number">0.1</span>, <span class="number">0.1</span> &#125;;</span><br><span class="line">   GLfloat diffuse[] = &#123; <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span> &#125;;</span><br><span class="line">   GLfloat position[] = &#123; <span class="number">-80.0</span>, <span class="number">50.0</span>, <span class="number">25.0</span>, <span class="number">1.0</span> &#125;;</span><br><span class="line">   <span class="comment">//选择光照模型</span></span><br><span class="line">   GLfloat lmodel_ambient[] = &#123; <span class="number">0.4</span>, <span class="number">0.4</span>, <span class="number">0.4</span>, <span class="number">1.0</span> &#125;;</span><br><span class="line">   GLfloat local_view[] = &#123; <span class="number">0.0</span> &#125;;</span><br><span class="line">   glClearColor(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>);</span><br><span class="line">   glShadeModel(GL_SMOOTH);</span><br><span class="line">   <span class="comment">//设置环境光</span></span><br><span class="line">   glLightfv(GL_LIGHT0, GL_AMBIENT, ambient);</span><br><span class="line">   <span class="comment">//设置漫射光</span></span><br><span class="line">   glLightfv(GL_LIGHT0, GL_DIFFUSE, diffuse);</span><br><span class="line">   <span class="comment">//设置光源位置</span></span><br><span class="line">   glLightfv(GL_LIGHT0, GL_POSITION, position);</span><br><span class="line">   glLightModelfv(GL_LIGHT_MODEL_AMBIENT, lmodel_ambient);</span><br><span class="line">   glLightModelfv(GL_LIGHT_MODEL_LOCAL_VIEWER, local_view);</span><br><span class="line">   <span class="comment">//启动光照</span></span><br><span class="line">   glEnable(GL_LIGHTING);</span><br><span class="line">   <span class="comment">//启用光源</span></span><br><span class="line">   glEnable(GL_LIGHT0);</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中设置了光源颜色，位置等参数。</p>
                  <h2 id="图形的移动"><a href="#图形的移动" class="headerlink" title="图形的移动"></a>图形的移动</h2>
                  <p>在这里我们实现了鼠标的监听旋转和键盘的监听旋转，在这里分别描述如下</p>
                  <h3 id="1-鼠标监听"><a href="#1-鼠标监听" class="headerlink" title="1.鼠标监听"></a>1.鼠标监听</h3>
                  <p>对于鼠标监听事件，在前面的文章中已经做了说明，如果大家不熟悉可以看下面这篇文章 <a href="http://cuiqingcai.com/1776.html">鼠标监听</a> 我们要实现的就是在拖动鼠标的时候实现图形的旋转功能。 在点击鼠标时，我们记录下来点击的位置，然后在鼠标移动的时候记录下当前坐标与上一个位置的坐标之差。通过定义一个角度的变量，每次鼠标移动的时候让整个图形旋转角度加上这个差值，然后重新绘制图形，就可以实现整个图形的 旋转了。 鼠标监听的两个方法如下，分别是鼠标点击和鼠标移动。 定义两个变量，旋转角度</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">int</span> spinX = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">int</span> spinY = <span class="number">0</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后定义两个鼠标事件</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">// 鼠标移动事件</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mouseMove</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> dx = x - moveX;</span><br><span class="line">	<span class="keyword">int</span> dy = y - moveY;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"dx;%dx,dy:%dy\n"</span>,dx,dy);</span><br><span class="line">	spinX += dx;</span><br><span class="line">	spinY += dy;</span><br><span class="line">	glutPostRedisplay();</span><br><span class="line">	moveX = x;</span><br><span class="line">	moveY = y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//鼠标点击事件</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mouseClick</span><span class="params">(<span class="keyword">int</span> btn, <span class="keyword">int</span> state, <span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">    moveX = x;</span><br><span class="line">	moveY = y;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>恩，通过定义上面的方法，然后在 main 中加入监听。</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//鼠标点击事件，鼠标点击或者松开时调用</span></span><br><span class="line">    glut<span class="constructor">MouseFunc(<span class="params">mouseClick</span>)</span>;</span><br><span class="line">	<span class="comment">//鼠标移动事件，鼠标按下并移动时调用</span></span><br><span class="line">    glut<span class="constructor">MotionFunc(<span class="params">mouseMove</span>)</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>display 函数中，在绘图前调用该方法即可</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">glRotated(spinX, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">	glRotated(spinY, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>分别是绕 y 轴和 x 轴旋转一定的角度。这样就可以实现鼠标的监听了。</p>
                  <h3 id="2-键盘监听"><a href="#2-键盘监听" class="headerlink" title="2.键盘监听"></a>2.键盘监听</h3>
                  <p>键盘事件也很简单，同样是监听按键的按下。其中 w、s 键是用来控制机器人的远近的。 定义一个变量叫 dis，代表远近 键盘事件函数如下：</p>
                  <figure class="highlight processing">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//键盘事件</span></span><br><span class="line"><span class="keyword">void</span> <span class="built_in">keyPressed</span>(unsigned <span class="built_in">char</span> <span class="built_in">key</span>, <span class="built_in">int</span> x, <span class="built_in">int</span> y) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (<span class="built_in">key</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'a'</span>:</span><br><span class="line">        spinX -= <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'d'</span>:</span><br><span class="line">         spinX += <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'w'</span>:</span><br><span class="line">        des += <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'s'</span>:</span><br><span class="line">        des -= <span class="number">2</span>;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	glutPostRedisplay();</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在 main 函数中加入监听</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//键盘事件</span></span><br><span class="line">	glut<span class="constructor">KeyboardFunc(<span class="params">keyPressed</span>)</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>display 函数中加入如下的变换</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">glRotated(spinX, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">	glRotated(spinY, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	glTranslated(<span class="number">0</span>, <span class="number">0</span>, des);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样通过上述方法，我们便可以实现鼠标和键盘的监听了。</p>
                  <h2 id="裁切物体"><a href="#裁切物体" class="headerlink" title="裁切物体"></a>裁切物体</h2>
                  <p>在这里我们可能要画一个半圆，那么最方便的方法就是裁切了，利用下面的函数，我们可以方便地实现。</p>
                  <h3 id="void-glClipPlane-GLenum-plane-const-GLdouble-equation"><a href="#void-glClipPlane-GLenum-plane-const-GLdouble-equation" class="headerlink" title="void glClipPlane(GLenum plane, const GLdouble *equation);"></a>void glClipPlane(GLenum plane, const GLdouble *equation);</h3>
                  <p>定义一个裁剪平面。equation 参数指向平面方程 Ax + By + Cz + D = 0 的 4 个系数。 equation=（0，-1，0,0），前三个参数（0，-1,0）可以理解为法线向下，只有向下的，即 Y&lt;0 的才能显示，最后一个参数 0 表示从 z=0 平面开始。这样就是裁剪掉上半平面。 equation=（0,1,0,0）表示裁剪掉下半平面， equation=（1,0,0,0）表示裁剪掉左半平面， equation=（-1,0,0,0）表示裁剪掉右半平面， equation=（0,0,-1,0）表示裁剪掉前半平面， equation=（0,0,1,0）表示裁剪掉后半平面 代码示例如下</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">GLdouble eqn<span class="literal">[<span class="number">4</span>]</span>=&#123;<span class="number">0.0</span>,<span class="number">0.0</span>,-<span class="number">1.0</span>,<span class="number">0.0</span>&#125;;</span><br><span class="line">gl<span class="constructor">ClipPlane(GL_CLIP_PLANE0,<span class="params">eqn</span>)</span>;</span><br><span class="line">gl<span class="constructor">Enable(GL_CLIP_PLANE0)</span>;</span><br><span class="line">glut<span class="constructor">SolidSphere(<span class="params">headR</span>,<span class="params">slices</span>,<span class="params">slices</span>)</span>;</span><br><span class="line">gl<span class="constructor">Disable(GL_CLIP_PLANE0)</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>首先我们必须要定义一个 GLdouble 数组，然后利用 glClipPlane 方法来设置，然后开启裁切，最后关闭裁切。 利用类似的方法我们可以写出绘制半球的方法如下</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//画半球</span></span><br><span class="line">void draw<span class="constructor">HalfBall(<span class="params">double</span> R, <span class="params">double</span> <span class="params">x</span>, <span class="params">double</span> <span class="params">y</span>,<span class="params">double</span> <span class="params">z</span>, <span class="params">int</span> MODE)</span> &#123;</span><br><span class="line">	gl<span class="constructor">PushMatrix()</span>;</span><br><span class="line">	gl<span class="constructor">Translated(<span class="params">x</span>,<span class="params">y</span>,<span class="params">z</span>)</span>;</span><br><span class="line">	GLdouble eqn<span class="literal">[<span class="number">4</span>]</span>=&#123;<span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>&#125;;</span><br><span class="line">	gl<span class="constructor">ClipPlane(GL_CLIP_PLANE0,<span class="params">eqn</span>)</span>;</span><br><span class="line">	gl<span class="constructor">Enable(GL_CLIP_PLANE0)</span>;</span><br><span class="line">	<span class="keyword">if</span> (MODE<span class="operator"> == </span>SOLID) &#123;</span><br><span class="line">		glut<span class="constructor">SolidSphere(R,20,20)</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (MODE ==WIRE) &#123;</span><br><span class="line">		glut<span class="constructor">WireSphere(R,20,20)</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	gl<span class="constructor">Disable(GL_CLIP_PLANE0)</span>;</span><br><span class="line">	gl<span class="constructor">PopMatrix()</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>恩，通过上述方法，我们可以方便地绘制出一个半球体。</p>
                  <h2 id="绘制机器人"><a href="#绘制机器人" class="headerlink" title="绘制机器人"></a>绘制机器人</h2>
                  <p>有了上述的铺垫，我们绘制机器人简直易如反掌，同样还可以实现各式各样的监听。 主要就是位置的确定了。 display 函数如下</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">void</span> display(<span class="built_in">void</span>) &#123;</span><br><span class="line">	<span class="comment">//清除缓冲区颜色</span></span><br><span class="line">	glClear(GL_COLOR_BUFFER_BIT);</span><br><span class="line">	<span class="comment">//定义白色</span></span><br><span class="line">	glColor3f(<span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>);</span><br><span class="line">	<span class="comment">//圆点放坐标中心</span></span><br><span class="line">	glLoadIdentity();</span><br><span class="line">	<span class="comment">//从哪个地方看</span></span><br><span class="line">	gluLookAt(<span class="number">-2.0</span>, <span class="number">-1.0</span>, <span class="number">20.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>);</span><br><span class="line">	glPushMatrix();</span><br><span class="line">	glRotated(spinX, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">	glRotated(spinY, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	glTranslated(<span class="number">0</span>, <span class="number">0</span>, des);</span><br><span class="line">	<span class="comment">//头</span></span><br><span class="line">	drawBall(<span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	<span class="comment">//身体</span></span><br><span class="line">	drawSkewed(<span class="number">5</span>, <span class="number">4.4</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">-0.75</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	<span class="comment">//肩膀</span></span><br><span class="line">	drawHalfBall(<span class="number">1</span>, <span class="number">3.5</span>, <span class="number">-2.1</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	drawHalfBall(<span class="number">1</span>, <span class="number">-3.5</span>, <span class="number">-2.1</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	<span class="comment">//胳膊</span></span><br><span class="line">	drawSkewed(<span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">3.5</span>, <span class="number">-1.3</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	drawSkewed(<span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">-3.5</span>, <span class="number">-1.3</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	<span class="comment">//手</span></span><br><span class="line">	drawBall(<span class="number">1</span>, <span class="number">3.5</span>, <span class="number">-6.4</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	drawBall(<span class="number">1</span>, <span class="number">-3.5</span>, <span class="number">-6.4</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	<span class="comment">//腿</span></span><br><span class="line">	drawSkewed(<span class="number">1.2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">-2.4</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	drawSkewed(<span class="number">1.2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">-1</span>, <span class="number">-2.4</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	<span class="comment">//脚</span></span><br><span class="line">	drawSkewed(<span class="number">1.5</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">0.9</span>, <span class="number">-9.2</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	drawSkewed(<span class="number">1.5</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">-0.9</span>, <span class="number">-9.2</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	glPopMatrix();</span><br><span class="line">    glutSwapBuffers();</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>恩，通过调用这个函数我们便可以完成机器人的绘制了。</p>
                  <h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2>
                  <p>在这里提供完整代码示例，仅供参考</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">#include &lt;glut.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">#define SOLID <span class="number">1</span></span><br><span class="line">#define WIRE <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> moveX,moveY;</span><br><span class="line"><span class="built_in">int</span> spinX = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">int</span> spinY = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">int</span> des = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">void</span> init() &#123;</span><br><span class="line">   <span class="comment">//定义光源的颜色和位置</span></span><br><span class="line">   GLfloat ambient[] = &#123; <span class="number">0.5</span>, <span class="number">0.8</span>, <span class="number">0.1</span>, <span class="number">0.1</span> &#125;;</span><br><span class="line">   GLfloat diffuse[] = &#123; <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span> &#125;;</span><br><span class="line">   GLfloat position[] = &#123; <span class="number">-80.0</span>, <span class="number">50.0</span>, <span class="number">25.0</span>, <span class="number">1.0</span> &#125;;</span><br><span class="line">   <span class="comment">//选择光照模型</span></span><br><span class="line">   GLfloat lmodel_ambient[] = &#123; <span class="number">0.4</span>, <span class="number">0.4</span>, <span class="number">0.4</span>, <span class="number">1.0</span> &#125;;</span><br><span class="line">   GLfloat local_view[] = &#123; <span class="number">0.0</span> &#125;;</span><br><span class="line">   glClearColor(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>);</span><br><span class="line">   glShadeModel(GL_SMOOTH);</span><br><span class="line">   <span class="comment">//设置环境光</span></span><br><span class="line">   glLightfv(GL_LIGHT0, GL_AMBIENT, ambient);</span><br><span class="line">   <span class="comment">//设置漫射光</span></span><br><span class="line">   glLightfv(GL_LIGHT0, GL_DIFFUSE, diffuse);</span><br><span class="line">   <span class="comment">//设置光源位置</span></span><br><span class="line">   glLightfv(GL_LIGHT0, GL_POSITION, position);</span><br><span class="line">   glLightModelfv(GL_LIGHT_MODEL_AMBIENT, lmodel_ambient);</span><br><span class="line">   glLightModelfv(GL_LIGHT_MODEL_LOCAL_VIEWER, local_view);</span><br><span class="line">   <span class="comment">//启动光照</span></span><br><span class="line">   glEnable(GL_LIGHTING);</span><br><span class="line">   <span class="comment">//启用光源</span></span><br><span class="line">   glEnable(GL_LIGHT0);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//画球</span></span><br><span class="line"><span class="built_in">void</span> drawBall(<span class="built_in">double</span> R, <span class="built_in">double</span> x, <span class="built_in">double</span> y,<span class="built_in">double</span> z, <span class="built_in">int</span> MODE) &#123;</span><br><span class="line">	glPushMatrix();</span><br><span class="line">	glTranslated(x,y,z);</span><br><span class="line">	<span class="keyword">if</span> (MODE == SOLID) &#123;</span><br><span class="line">		glutSolidSphere(R,<span class="number">20</span>,<span class="number">20</span>);</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (MODE ==WIRE) &#123;</span><br><span class="line">		glutWireSphere(R,<span class="number">20</span>,<span class="number">20</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	glPopMatrix();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//画半球</span></span><br><span class="line"><span class="built_in">void</span> drawHalfBall(<span class="built_in">double</span> R, <span class="built_in">double</span> x, <span class="built_in">double</span> y,<span class="built_in">double</span> z, <span class="built_in">int</span> MODE) &#123;</span><br><span class="line">	glPushMatrix();</span><br><span class="line">	glTranslated(x,y,z);</span><br><span class="line">	GLdouble eqn[<span class="number">4</span>]=&#123;<span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>&#125;;</span><br><span class="line">	glClipPlane(GL_CLIP_PLANE0,eqn);</span><br><span class="line">	glEnable(GL_CLIP_PLANE0);</span><br><span class="line">	<span class="keyword">if</span> (MODE == SOLID) &#123;</span><br><span class="line">		glutSolidSphere(R,<span class="number">20</span>,<span class="number">20</span>);</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (MODE ==WIRE) &#123;</span><br><span class="line">		glutWireSphere(R,<span class="number">20</span>,<span class="number">20</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	glDisable(GL_CLIP_PLANE0);</span><br><span class="line">	glPopMatrix();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//画长方体</span></span><br><span class="line"><span class="built_in">void</span> drawSkewed(<span class="built_in">double</span> l, <span class="built_in">double</span> w, <span class="built_in">double</span> h, <span class="built_in">double</span> x, <span class="built_in">double</span> y, <span class="built_in">double</span> z, <span class="built_in">int</span> MODE) &#123;</span><br><span class="line">	glPushMatrix();</span><br><span class="line">	glScaled(l, w, h);</span><br><span class="line">	glTranslated(x, y, z);</span><br><span class="line">	<span class="keyword">if</span> (MODE == SOLID) &#123;</span><br><span class="line">		glutSolidCube(<span class="number">1</span>);</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (MODE ==WIRE) &#123;</span><br><span class="line">		glutWireCube(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	glPopMatrix();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">void</span> display(<span class="built_in">void</span>) &#123;</span><br><span class="line">	<span class="comment">//清除缓冲区颜色</span></span><br><span class="line">	glClear(GL_COLOR_BUFFER_BIT);</span><br><span class="line">	<span class="comment">//定义白色</span></span><br><span class="line">	glColor3f(<span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>);</span><br><span class="line">	<span class="comment">//圆点放坐标中心</span></span><br><span class="line">	glLoadIdentity();</span><br><span class="line">	<span class="comment">//从哪个地方看</span></span><br><span class="line">	gluLookAt(<span class="number">-2.0</span>, <span class="number">-1.0</span>, <span class="number">20.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>);</span><br><span class="line">	glPushMatrix();</span><br><span class="line">	glRotated(spinX, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">	glRotated(spinY, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	glTranslated(<span class="number">0</span>, <span class="number">0</span>, des);</span><br><span class="line">	<span class="comment">//头</span></span><br><span class="line">	drawBall(<span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	<span class="comment">//身体</span></span><br><span class="line">	drawSkewed(<span class="number">5</span>, <span class="number">4.4</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">-0.75</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	<span class="comment">//肩膀</span></span><br><span class="line">	drawHalfBall(<span class="number">1</span>, <span class="number">3.5</span>, <span class="number">-2.1</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	drawHalfBall(<span class="number">1</span>, <span class="number">-3.5</span>, <span class="number">-2.1</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	<span class="comment">//胳膊</span></span><br><span class="line">	drawSkewed(<span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">3.5</span>, <span class="number">-1.3</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	drawSkewed(<span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">-3.5</span>, <span class="number">-1.3</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	<span class="comment">//手</span></span><br><span class="line">	drawBall(<span class="number">1</span>, <span class="number">3.5</span>, <span class="number">-6.4</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	drawBall(<span class="number">1</span>, <span class="number">-3.5</span>, <span class="number">-6.4</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	<span class="comment">//腿</span></span><br><span class="line">	drawSkewed(<span class="number">1.2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">-2.4</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	drawSkewed(<span class="number">1.2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">-1</span>, <span class="number">-2.4</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	<span class="comment">//脚</span></span><br><span class="line">	drawSkewed(<span class="number">1.5</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">0.9</span>, <span class="number">-9.2</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	drawSkewed(<span class="number">1.5</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">-0.9</span>, <span class="number">-9.2</span>, <span class="number">0</span>, SOLID);</span><br><span class="line">	glPopMatrix();</span><br><span class="line">    glutSwapBuffers();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//鼠标点击事件</span></span><br><span class="line"><span class="built_in">void</span> mouseClick(<span class="built_in">int</span> btn, <span class="built_in">int</span> state, <span class="built_in">int</span> x, <span class="built_in">int</span> y) &#123;</span><br><span class="line">    moveX = x;</span><br><span class="line">	moveY = y;</span><br><span class="line">	GLfloat ambient[] = &#123; (<span class="built_in">float</span>)rand() / RAND_MAX, (<span class="built_in">float</span>)rand() / RAND_MAX, (<span class="built_in">float</span>)rand() / RAND_MAX, <span class="number">0.1</span> &#125;;</span><br><span class="line">	 <span class="comment">//设置环境光</span></span><br><span class="line">	glLightfv(GL_LIGHT0, GL_AMBIENT, ambient);</span><br><span class="line">	<span class="comment">//启用光源</span></span><br><span class="line">	glEnable(GL_LIGHT0);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//键盘事件</span></span><br><span class="line"><span class="built_in">void</span> keyPressed(unsigned char key, <span class="built_in">int</span> x, <span class="built_in">int</span> y) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (key) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'a'</span>:</span><br><span class="line">        spinX -= <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'d'</span>:</span><br><span class="line">         spinX += <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'w'</span>:</span><br><span class="line">        des += <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'s'</span>:</span><br><span class="line">        des -= <span class="number">2</span>;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	glutPostRedisplay();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 鼠标移动事件</span></span><br><span class="line"><span class="built_in">void</span> mouseMove(<span class="built_in">int</span> x, <span class="built_in">int</span> y) &#123;</span><br><span class="line">	<span class="built_in">int</span> dx = x - moveX;</span><br><span class="line">	<span class="built_in">int</span> dy = y - moveY;</span><br><span class="line">	printf(<span class="string">"dx;%dx,dy:%dy\n"</span>,dx,dy);</span><br><span class="line">	spinX += dx;</span><br><span class="line">	spinY += dy;</span><br><span class="line">	glutPostRedisplay();</span><br><span class="line">	moveX = x;</span><br><span class="line">	moveY = y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">void</span> reshape(<span class="built_in">int</span> w, <span class="built_in">int</span> h) &#123;</span><br><span class="line">	<span class="comment">//定义视口大小</span></span><br><span class="line">	glViewport(<span class="number">0</span>, <span class="number">0</span>, (GLsizei) w, (GLsizei) h);</span><br><span class="line">	<span class="comment">//投影显示</span></span><br><span class="line">	glMatrixMode(GL_PROJECTION);</span><br><span class="line">	<span class="comment">//坐标原点在屏幕中心</span></span><br><span class="line">	glLoadIdentity();</span><br><span class="line">	<span class="comment">//操作模型视景</span></span><br><span class="line">	gluPerspective(<span class="number">60.0</span>, (GLfloat) w/(GLfloat) h, <span class="number">1.0</span>, <span class="number">20.0</span>);</span><br><span class="line">	glMatrixMode(GL_MODELVIEW);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> main(<span class="built_in">int</span> argc, char** argv) &#123;</span><br><span class="line">	<span class="comment">//初始化</span></span><br><span class="line">	glutInit(&amp;argc, argv);</span><br><span class="line">	<span class="comment">//设置显示模式</span></span><br><span class="line">	glutInitDisplayMode(GLUT_DOUBLE | GLUT_RGB);</span><br><span class="line">	<span class="comment">//初始化窗口大小</span></span><br><span class="line">	glutInitWindowSize(<span class="number">500</span>, <span class="number">500</span>);</span><br><span class="line">	<span class="comment">//定义左上角窗口位置</span></span><br><span class="line">	glutInitWindowPosition(<span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">	<span class="comment">//创建窗口</span></span><br><span class="line">	glutCreateWindow(argv[<span class="number">0</span>]);</span><br><span class="line">	<span class="comment">//初始化</span></span><br><span class="line">	init();</span><br><span class="line">	<span class="comment">//显示函数</span></span><br><span class="line">	glutDisplayFunc(display);</span><br><span class="line">	<span class="comment">//窗口大小改变时的响应</span></span><br><span class="line">	glutReshapeFunc(reshape);</span><br><span class="line">	<span class="comment">//鼠标点击事件，鼠标点击或者松开时调用</span></span><br><span class="line">    glutMouseFunc(mouseClick);</span><br><span class="line">	<span class="comment">//鼠标移动事件，鼠标按下并移动时调用</span></span><br><span class="line">    glutMotionFunc(mouseMove);</span><br><span class="line">	<span class="comment">//键盘事件</span></span><br><span class="line">	glutKeyboardFunc(keyPressed);</span><br><span class="line">	<span class="comment">//循环</span></span><br><span class="line">	glutMainLoop();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>仅供参考，如有问题，敬请指正。 运行结果如下 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/06/QQ截图20150607013139.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/06/QQ截图20150607013139.jpg" alt="QQ截图20150607013139"></a> 恩，大体就是这样。</p>
                  <h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2>
                  <p>本次实验做的比较匆忙，只研究了一个晚上的时间，所以有些地方还是不太完善，希望发出来对小伙伴们有所启发，有所帮助。如果有问题，欢迎同我交流。谢大家！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-06-07 01:35:13" itemprop="dateCreated datePublished" datetime="2015-06-07T01:35:13+08:00">2015-06-07</time>
                </span>
                <span id="/1867.html" class="post-meta-item leancloud_visitors" data-flag-title="OpenGL绘图实例十之绘制3D机器人" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>9.5k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>9 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1860.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> C/C++ <i class="label-arrow"></i>
                  </a>
                  <a href="/1860.html" class="post-title-link" itemprop="url">OpenGL绘图实例九之3D绘图基础</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>在前面我们进行了 2D 图形的绘制，接下来，我们将步入 3D 图形的世界，绘制出一个 3D 机器人，好，废话不多说，让我们一起来迈入 3D 绘图之旅吧。</p>
                  <h2 id="基本函数"><a href="#基本函数" class="headerlink" title="基本函数"></a>基本函数</h2>
                  <p>那么在绘图之前呢，我们首先要介绍几个新的函数，弄懂了这几个函数我们才能方便地绘制出我们的 3D 机器人。 那么我们介绍一下<strong>gluPerspective</strong>、<strong>gluLookAt、glPushMatrix、glPopMatrix()函数</strong></p>
                  <h3 id="1-void-gluPerspective-GLdouble-fovy-GLdouble-aspect-GLdouble-zNear-GLdouble-zFar"><a href="#1-void-gluPerspective-GLdouble-fovy-GLdouble-aspect-GLdouble-zNear-GLdouble-zFar" class="headerlink" title="1.void gluPerspective(GLdouble fovy,GLdouble aspect,GLdouble zNear,GLdouble zFar)"></a>1.void gluPerspective(GLdouble fovy,GLdouble aspect,GLdouble zNear,GLdouble zFar)</h3>
                  <p>参数说明： fovy，视角的大小，如果设置为 0,相当闭上眼睛，什么也看不到，如果为 180，则可以看到几乎所有的内容。一般设置为 60 即可。 aspect，就是实际窗口的纵横比,即 x/y，一般都是要按照窗口比例来，否则看到的图形和实际图形就会不一样了。 zNear，表示近处的裁面。 zFar，表示远处的裁面。 gluPerspective 这个函数指定了观察的视景体在世界坐标系中的具体大小，一般而言，其中的参数 aspect 应该与窗口的宽高比大小相同。比如说，aspect=2.0 表示在观察者的角度中物体的宽度是高度的两倍，在视口中宽度也是高度的两倍，这样显示出的物体才不会被扭曲。 <a href="http://baike.baidu.com/link?url=jzTDJ5fxVoKMTgijgmszkzuPR6116C5DC4GETFIRZvBajy3dWAB539r3oMsoXpTKCxTksLImx1J2VSC5Q-zJja" target="_blank" rel="noopener">详细说明</a> <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/06/03087bf40ad162d9f337731d11dfa9ec8b13cdd1.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/06/03087bf40ad162d9f337731d11dfa9ec8b13cdd1.jpg" alt="03087bf40ad162d9f337731d11dfa9ec8b13cdd1"></a></p>
                  <h3 id="2-void-gluLookAt-GLdouble-eyex-GLdouble-eyey-GLdouble-eyez-GLdouble-centerx-GLdouble-centery-GLdouble-centerz-GLdouble-upx-GLdouble-upy-GLdouble-upz"><a href="#2-void-gluLookAt-GLdouble-eyex-GLdouble-eyey-GLdouble-eyez-GLdouble-centerx-GLdouble-centery-GLdouble-centerz-GLdouble-upx-GLdouble-upy-GLdouble-upz" class="headerlink" title="2.void gluLookAt(GLdouble eyex,GLdouble eyey,GLdouble eyez,GLdouble centerx,GLdouble centery,GLdouble centerz,GLdouble upx,GLdouble upy,GLdouble upz)"></a><strong>2.void gluLookAt(GLdouble eyex,GLdouble eyey,GLdouble eyez,GLdouble centerx,GLdouble centery,GLdouble centerz,GLdouble upx,GLdouble upy,GLdouble upz)</strong></h3>
                  <p>该函数定义一个视图矩阵，并与当前矩阵相乘。</p>
                  <p>第一组 eyex, eyey,eyez 相机在世界坐标的位置</p>
                  <p>第二组 centerx,centery,centerz 相机镜头对准的物体在世界坐标的位置</p>
                  <p>第三组 upx,upy,upz 相机向上的方向在世界坐标中的方向</p>
                  <p>你把相机想象成为你自己的脑袋：</p>
                  <p>第一组数据就是脑袋的位置</p>
                  <p>第二组数据就是眼睛看的物体的位置</p>
                  <p>第三组就是头顶朝向的方向（因为你可以歪着头看同一个物体）</p>
                  <p>在这里，我们就涉及到一个十分重要的概念，坐标系。 在 3D 绘图中，坐标系是右手系，如果 x 轴指向我们的右侧，那么 y 则指向上侧，z 轴指向屏幕外。如下图所示。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/06/20150606234046.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/06/20150606234046.jpg" alt="20150606234046"></a> 理解了上述两个函数，下面我们来用一个小例子感受一下 运行如下代码</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">#include &lt;glut.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">void</span> display(<span class="built_in">void</span>) &#123;</span><br><span class="line">	<span class="comment">//清除缓冲区颜色</span></span><br><span class="line">	glClear(GL_COLOR_BUFFER_BIT);</span><br><span class="line">	<span class="comment">//定义白色</span></span><br><span class="line">	glColor3f(<span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>);</span><br><span class="line">	<span class="comment">//圆点放坐标中心</span></span><br><span class="line">	glLoadIdentity();</span><br><span class="line">	<span class="comment">//从哪个地方看</span></span><br><span class="line">	gluLookAt(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">5.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>);</span><br><span class="line">	glutWireTeapot(<span class="number">2</span>);</span><br><span class="line">    <span class="comment">//清除缓冲区刷新</span></span><br><span class="line">    glutSwapBuffers();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">void</span> reshape(<span class="built_in">int</span> w, <span class="built_in">int</span> h) &#123;</span><br><span class="line">	<span class="comment">//定义视口大小</span></span><br><span class="line">	glViewport(<span class="number">0</span>, <span class="number">0</span>, (GLsizei) w, (GLsizei) h);</span><br><span class="line">	<span class="comment">//投影显示</span></span><br><span class="line">	glMatrixMode(GL_PROJECTION);</span><br><span class="line">	<span class="comment">//坐标原点在屏幕中心</span></span><br><span class="line">	glLoadIdentity();</span><br><span class="line">	<span class="comment">//操作模型视景</span></span><br><span class="line">	gluPerspective(<span class="number">60.0</span>, (GLfloat) w/(GLfloat) h, <span class="number">1.0</span>, <span class="number">20.0</span>);</span><br><span class="line">	glMatrixMode(GL_MODELVIEW);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> main(<span class="built_in">int</span> argc, char** argv) &#123;</span><br><span class="line">	<span class="comment">//初始化</span></span><br><span class="line">	glutInit(&amp;argc, argv);</span><br><span class="line">	<span class="comment">//设置显示模式</span></span><br><span class="line">	glutInitDisplayMode(GLUT_DOUBLE | GLUT_RGB);</span><br><span class="line">	<span class="comment">//初始化窗口大小</span></span><br><span class="line">	glutInitWindowSize(<span class="number">500</span>, <span class="number">500</span>);</span><br><span class="line">	<span class="comment">//定义左上角窗口位置</span></span><br><span class="line">	glutInitWindowPosition(<span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">	<span class="comment">//创建窗口</span></span><br><span class="line">	glutCreateWindow(argv[<span class="number">0</span>]);</span><br><span class="line">	<span class="comment">//清除颜色缓冲区</span></span><br><span class="line">	glClearColor(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>);</span><br><span class="line">	<span class="comment">//显示函数</span></span><br><span class="line">	glutDisplayFunc(display);</span><br><span class="line">	<span class="comment">//窗口大小改变时的响应</span></span><br><span class="line">	glutReshapeFunc(reshape);</span><br><span class="line">	<span class="comment">//循环</span></span><br><span class="line">	glutMainLoop();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/06/QQ截图20150606234448.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/06/QQ截图20150606234448.jpg" alt="QQ截图20150606234448"></a> 在这里，我们定义了</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">gluLookAt(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">5.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>意思就是把我们的眼睛放到了（0,0,5）的位置，茶壶放到了原点，脑袋顶朝上，即正视茶壶。 如果我们改变了几个参数的值，例如</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">gluLookAt(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">5.0</span>, <span class="number">4.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">1.0</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>眼睛位置不变，茶壶位置变为（4,1,0），脑袋顶的方向朝屏幕外侧，那么看到的效果如下。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/06/QQ截图20150606234708.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/06/QQ截图20150606234708.jpg" alt="QQ截图20150606234708"></a> 大家可以通过更改这些参数的值来对视图进行变换。</p>
                  <h3 id="3-glPushMatrix-、glPopMatrix"><a href="#3-glPushMatrix-、glPopMatrix" class="headerlink" title="3.glPushMatrix()、glPopMatrix()"></a>3.glPushMatrix()、glPopMatrix()</h3>
                  <p>这个方法在绘制 3D 图形时依然十分有用，因为我们需要绘制好多个图形，绘制多个不一样的图形必然要经过各种矩阵变换，所以，少不了的利用平移变换放缩的功能，所以为了保证每个图形不受影响，在绘制一个新图形前我们只要调用一下 glPushMatrix 函数，保存当前的变换矩阵，然后绘制完一个图形之后再调用 glPopMatrix 函数来恢复之前的变换矩阵就可以了。 比如，绘制球体</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">gl<span class="constructor">PushMatrix()</span>;</span><br><span class="line">gl<span class="constructor">Translated(<span class="params">x</span>,<span class="params">y</span>,<span class="params">z</span>)</span>;</span><br><span class="line">glut<span class="constructor">WireSphere(R,20,20)</span>;</span><br><span class="line">gl<span class="constructor">PopMatrix()</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在两个函数中间我们可以进行任意的变换放缩等操作，然后绘制想要的图形即可。</p>
                  <h2 id="绘图函数"><a href="#绘图函数" class="headerlink" title="绘图函数"></a>绘图函数</h2>
                  <p>接下来我们说一下一些常用的绘图函数，直接用类库函数来绘制即可。</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">void glut<span class="constructor">WireSphere(GLdouble <span class="params">radius</span>, GLint <span class="params">slices</span>, GLint <span class="params">stacks</span>)</span>; 线框球</span><br><span class="line">void glut<span class="constructor">SolidSphere(GLdouble <span class="params">radius</span>, GLint <span class="params">slices</span>, GLint <span class="params">stacks</span>)</span>; 实心球</span><br><span class="line">void glut<span class="constructor">WireCube(GLdouble <span class="params">size</span>)</span>; 线框立方体</span><br><span class="line">void glut<span class="constructor">SolidCube(GLdouble <span class="params">size</span>)</span>; 实心立方体</span><br><span class="line">void glut<span class="constructor">WireTorus(GLdouble <span class="params">innerRadius</span>, GLdouble <span class="params">outerRadius</span>, GLint <span class="params">nsides</span>, GLint <span class="params">rings</span>)</span>; 线框圆环</span><br><span class="line">void glut<span class="constructor">SolidTorus(GLdouble <span class="params">innerRadius</span>, GLdouble <span class="params">outerRadius</span>, GLint <span class="params">nsides</span>, GLint <span class="params">rings</span>)</span>; 实心圆环</span><br><span class="line">void glut<span class="constructor">WireIcosahedron(<span class="params">void</span>)</span>; 线框<span class="number">20</span>面体</span><br><span class="line">void glut<span class="constructor">SolidIcosahedron(<span class="params">void</span>)</span>; 实心<span class="number">20</span>面体</span><br><span class="line">void glut<span class="constructor">WireOctahedron(<span class="params">void</span>)</span>; 线框<span class="number">8</span>面体</span><br><span class="line">void glut<span class="constructor">SolidOctahedron(<span class="params">void</span>)</span>; 实心<span class="number">8</span>面体</span><br><span class="line">void glut<span class="constructor">WireTetrahedron(<span class="params">void</span>)</span>; 线框<span class="number">4</span>面体</span><br><span class="line">void glut<span class="constructor">SolidTetrahedron(<span class="params">void</span>)</span>; 实心<span class="number">4</span>面体</span><br><span class="line">void glut<span class="constructor">WireDodecahedron(GLdouble <span class="params">radius</span>)</span>; 线框<span class="number">12</span>面体</span><br><span class="line">void glut<span class="constructor">SolidDodecahedron(GLdouble <span class="params">radius</span>)</span>; 实心<span class="number">12</span>面体</span><br><span class="line">void glut<span class="constructor">WireCone(GLdouble <span class="params">radius</span>, GLdouble <span class="params">height</span>, GLint <span class="params">slices</span>, GLint <span class="params">stacks</span>)</span>; 线框圆锥体</span><br><span class="line">void glut<span class="constructor">SolidCone(GLdouble <span class="params">radius</span>, GLdouble <span class="params">height</span>, GLint <span class="params">slices</span>, GLint <span class="params">stacks</span>)</span>; 实心圆锥体</span><br><span class="line">void glut<span class="constructor">WireTeapot(GLdouble <span class="params">size</span>)</span>; 线框茶壶</span><br><span class="line">void glut<span class="constructor">SolidTeapot(GLdouble <span class="params">size</span>)</span>; 实心茶壶</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>利用上面的绘图函数我们便可以方便地实现各种图形的绘制。</p>
                  <h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2>
                  <p>那么本节就先告一段落，本节介绍了相关的绘图函数以及几个重要的函数，为接下来我们绘制机器人做下铺垫，希望小伙伴们可以好好理解。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-06-07 00:27:30" itemprop="dateCreated datePublished" datetime="2015-06-07T00:27:30+08:00">2015-06-07</time>
                </span>
                <span id="/1860.html" class="post-meta-item leancloud_visitors" data-flag-title="OpenGL绘图实例九之3D绘图基础" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>3.6k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1853.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> PHP <i class="label-arrow"></i>
                  </a>
                  <a href="/1853.html" class="post-title-link" itemprop="url">将普通文本替换为正常HTML文本的方法</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>有时我们在textarea中输入了正常的文本内容，然而如果直接将文本取出来呈现在网页中，原本的换行和回车功能便会失效，完全丢失了原来的样式，这是因为在HTML中的空格和换行分别为&nbsp;和<br>，所以我们需要将其替换才能变成我们想要的样式。 注：本篇内容非常基础，仅作参考，不喜勿喷。</p>
                  <h2 id="替换函数"><a href="#替换函数" class="headerlink" title="替换函数"></a>替换函数</h2>
                  <p>我们可以定义这样的一个函数，将原来的字符串替换为HTML文本。即把空格和换行替换掉即可</p>
                  <figure class="highlight php">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">htmtocode</span><span class="params">($content)</span> </span>&#123; </span><br><span class="line">		$content = htmlspecialchars($content, ENT_QUOTES);</span><br><span class="line">	    $content = str_replace(<span class="string">" "</span>, <span class="string">"&amp;nbsp;"</span>, $content); </span><br><span class="line">	    $content = str_replace(<span class="string">"\n"</span>, <span class="string">"&lt;br&gt;"</span>,$content);    </span><br><span class="line">	    <span class="keyword">return</span> $content; </span><br><span class="line">	&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过上述方法，我们首先将HTML的特殊标记转化，然后替换掉空格和换行即可。</p>
                  <h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2>
                  <p>写个最简单的小例子，在textarea中输入任意的文本，存储到数据库，然后再取出来，可以实现textarea输入的效果，完全一样。 数据库名称：demo 数据库表：</p>
                  <figure class="highlight n1ql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">CREATE</span> TABLE <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> <span class="symbol">`article`</span> (</span><br><span class="line">  <span class="symbol">`id`</span> int(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="symbol">`text`</span> text <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span> (<span class="symbol">`id`</span>)</span><br><span class="line">)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>插入数据：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">textarea</span> <span class="attr">name</span>=<span class="string">"text"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">name</span>=<span class="string">"sub"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="php"><span class="meta">&lt;?php</span> </span></span><br><span class="line"><span class="php">	$con = mysql_connect(<span class="string">"localhost"</span>, <span class="string">"root"</span>, <span class="string">""</span>);</span></span><br><span class="line"><span class="php">	<span class="keyword">if</span> (!$con) &#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">die</span>(<span class="string">"数据库连接失败"</span>);</span></span><br><span class="line"><span class="php">	&#125; </span></span><br><span class="line"><span class="php">	mysql_select_db(<span class="string">"demo"</span>,$con);</span></span><br><span class="line"><span class="php">	mysql_query(<span class="string">"set names utf8"</span>);</span></span><br><span class="line"><span class="php">	$text = @$_POST[<span class="string">'text'</span>];</span></span><br><span class="line"><span class="php">	$sql = <span class="string">"insert into article(text) values ('$text')"</span>;</span></span><br><span class="line"><span class="php">	<span class="keyword">echo</span> $sql;</span></span><br><span class="line"><span class="php">	$result = mysql_query($sql,$con);</span></span><br><span class="line"><span class="php">	<span class="keyword">if</span> ($result) &#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">echo</span> <span class="string">"录入成功"</span>;</span></span><br><span class="line"><span class="php">	&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">echo</span> <span class="string">"录入失败"</span>;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>查询数据：</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">""</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">textarea</span> <span class="attr">name</span>=<span class="string">"text"</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">name</span>=<span class="string">"sub"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="php"><span class="meta">&lt;?php</span> </span></span><br><span class="line"><span class="php">	$con = mysql_connect(<span class="string">"localhost"</span>, <span class="string">"root"</span>, <span class="string">""</span>);</span></span><br><span class="line"><span class="php">	<span class="keyword">if</span> (!$con) &#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">die</span>(<span class="string">"数据库连接失败"</span>);</span></span><br><span class="line"><span class="php">	&#125; </span></span><br><span class="line"><span class="php">	mysql_select_db(<span class="string">"demo"</span>,$con);</span></span><br><span class="line"><span class="php">	mysql_query(<span class="string">"set names utf8"</span>);</span></span><br><span class="line"><span class="php">	$text = @$_POST[<span class="string">'text'</span>];</span></span><br><span class="line"><span class="php">	$sql = <span class="string">"select * from article"</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="php">	$result = mysql_query($sql,$con);</span></span><br><span class="line"><span class="php">	<span class="keyword">if</span> ($result) &#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">while</span> ($row = mysql_fetch_array($result)) &#123;</span></span><br><span class="line"><span class="php">			<span class="keyword">echo</span> htmtocode($row[<span class="string">'text'</span>]);</span></span><br><span class="line"><span class="php">		&#125;</span></span><br><span class="line"><span class="php">	&#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">echo</span> <span class="string">"录入失败"</span>;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="php">	<span class="function"><span class="keyword">function</span> <span class="title">htmtocode</span><span class="params">($content)</span> </span>&#123; </span></span><br><span class="line"><span class="php">		$content = htmlspecialchars($content, ENT_QUOTES);</span></span><br><span class="line"><span class="php">	    $content = str_replace(<span class="string">" "</span>, <span class="string">"&amp;nbsp;"</span>, $content); </span></span><br><span class="line"><span class="php">	    $content = str_replace(<span class="string">"\n"</span>, <span class="string">"&lt;br&gt;"</span>,$content);    </span></span><br><span class="line"><span class="php">	    <span class="keyword">return</span> $content; </span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>嗯，通过上面的方法我们便可以正常地实现输入内容和输出内容的匹配呈现。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-06-05 22:12:03" itemprop="dateCreated datePublished" datetime="2015-06-05T22:12:03+08:00">2015-06-05</time>
                </span>
                <span id="/1853.html" class="post-meta-item leancloud_visitors" data-flag-title="将普通文本替换为正常HTML文本的方法" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1835.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> JavaScript <i class="label-arrow"></i>
                  </a>
                  <a href="/1835.html" class="post-title-link" itemprop="url">多说默认头像不显示，那就自己来整一个</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2>
                  <p>今天发现博客评论的默认头像不显示了，博客使用的是多说评论，不知道啥情况，之前设置过一个默认头像，然而今天图片都加载不出来了，可对于我这种强迫症来说，这能忍吗？你能忍我也不能忍啊，这必须不能忍啊，看到一个个的红叉号简直刺透了心。于是，我决定，必须要干掉它！</p>
                  <h2 id="初步尝试"><a href="#初步尝试" class="headerlink" title="初步尝试"></a>初步尝试</h2>
                  <p>默认头像不行了，我就重新上传个默认头像对吧，简单粗暴易行。来来来，说试就试！ <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/20150525114559.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/20150525114559.jpg" alt="20150525114559"></a> 然而上传完毕之后，它是这个样子滴，依然不给我面子！ <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/20150525114655.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/20150525114655.jpg" alt="20150525114655"></a> 你在逗我吗？是不是多说服务器哪里出毛病了？</p>
                  <h2 id="究其原因"><a href="#究其原因" class="headerlink" title="究其原因"></a>究其原因</h2>
                  <p>然而，美好的事情总是意想不到的发生，当我知道真相的一刻，整个人都惊呆了。 浏览器里审查一下元素，看它到底引用了神马鬼。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/20150525115038.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/20150525115038.jpg" alt="20150525115038"></a> 好，我就打开这个链接，惊呆了。简直棒到无极限！ 域名已过期！域名已过期！域名已过期！重要的话说三遍！简直溜到不行！ <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/20150525115447.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/20150525115447.jpg" alt="20150525115447"></a> 好吧，这真是太棒了！！我还能说些什么！！！</p>
                  <h2 id="峰回路转"><a href="#峰回路转" class="headerlink" title="峰回路转"></a>峰回路转</h2>
                  <p>行，既然这样，那我自己提供 CDN，用我自己的七牛云存储！ 那就用 jQuery 好了，方便简单，在&lt;/head&gt;标签前面加上这么个代码，来试试。</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	$(<span class="string">'.ds-avatar img[src*="cdncache"]'</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		$(<span class="keyword">this</span>).attr(<span class="string">"src"</span>,<span class="string">'http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/20150525112155.jpg'</span>);</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>意思是，在页面加载完成之后，把 src 里面包含 cdncache 的多说头像 img 替换掉。 这句话最好加在所有 JS 的最后面，要不然可能不会生效。JS 执行是有先后顺序的。 这样，我们就会发现，头像已经奇迹般地发生了变化。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/20150525123151.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/20150525123151.jpg" alt="20150525123151"></a> 本身有头像的仍然是那个头像，使用默认头像的已经替换了新头像。</p>
                  <h2 id="更上一层"><a href="#更上一层" class="headerlink" title="更上一层"></a>更上一层</h2>
                  <p>然而这并不能满足我的愿望啊，我想要多变的头像样式，就是这么任性！ 来来来，改代码，我再传上几个头像，让默认头像的孩纸们随机地使用我的头像，一定是炫爆了！</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> imgs = <span class="keyword">new</span> <span class="built_in">Array</span>();</span></span><br><span class="line"><span class="actionscript">	imgs[<span class="number">0</span>] = <span class="string">'http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/20150525111154.jpg'</span>;</span></span><br><span class="line"><span class="actionscript">	imgs[<span class="number">1</span>] = <span class="string">'http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/20150525111447.jpg'</span>;</span></span><br><span class="line"><span class="actionscript">	imgs[<span class="number">2</span>] = <span class="string">'http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/20150525112058.jpg'</span>;</span></span><br><span class="line"><span class="actionscript">	imgs[<span class="number">3</span>] = <span class="string">'http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/20150525112112.jpg'</span>;</span></span><br><span class="line"><span class="actionscript">	imgs[<span class="number">4</span>] = <span class="string">'http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/20150525112129.jpg'</span>;</span></span><br><span class="line"><span class="actionscript">	imgs[<span class="number">5</span>] = <span class="string">'http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/20150525112155.jpg'</span>;</span></span><br><span class="line"><span class="javascript">	$(<span class="string">'.ds-avatar img[src*="cdncache"]'</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">		<span class="keyword">var</span> rand = <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random()*imgs.length);</span></span><br><span class="line"><span class="javascript">		$(<span class="keyword">this</span>).attr(<span class="string">"src"</span>,imgs[rand]);</span></span><br><span class="line">	&#125;)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>嗯，把刚才代码优化成这样，我们就可以发现，整个网站的头像就被替换成我们想要的效果了！ <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/20150525123537.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/20150525123537.jpg" alt="20150525123537"></a> 简直酷炫！小伙伴们可以尝试一下！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-05-25 12:37:04" itemprop="dateCreated datePublished" datetime="2015-05-25T12:37:04+08:00">2015-05-25</time>
                </span>
                <span id="/1835.html" class="post-meta-item leancloud_visitors" data-flag-title="多说默认头像不显示，那就自己来整一个" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.7k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1802.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> C/C++ <i class="label-arrow"></i>
                  </a>
                  <a href="/1802.html" class="post-title-link" itemprop="url">OpenGL绘图实例八之图形的移动删除存盘</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>在上一篇文章中我们已经实现了图形的取点绘制，接下来我们还要实现的功能有图形的删除、移动以及存盘读盘功能。 概述如下</p>
                  <ul>
                    <li>鼠标点击某个绘制的图形，将其删除</li>
                    <li>鼠标拖动某个图形，可以对其随意拖拽改变位置</li>
                    <li>点击存盘，将图形的位置及颜色保存到文件</li>
                    <li>点击读盘，将图形的位置颜色从文件中读取出来并重新绘制</li>
                  </ul>
                  <p>好，接下来我们在上一篇的基础上进行一步步的说明。</p>
                  <h2 id="图形删除"><a href="#图形删除" class="headerlink" title="图形删除"></a>图形删除</h2>
                  <p>首先像之前一样，我们定义一个删除的按钮，指定好颜色。</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">GLubyte delBtn[<span class="number">3</span>] = &#123;<span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在 display 函数中绘制一个删除的按钮</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">glColorCircle(<span class="number">220</span>, <span class="number">280</span>, <span class="number">10</span>, delBtn);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>顶部变变成了这个样子，其中最左边的那个按钮便是删除按钮 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150511124225.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150511124225.jpg" alt="QQ截图20150511124225"></a> 接下来我们想一下删除的实现。 首先我们点击删除按钮之后要设置一下 drawStatus，比如设置为 2 代表删除。 然后鼠标点击下方任意位置时，如果当前 drawStatus 为 2，如果鼠标处在一个多边形内部，我们就把它删除掉。 那么就会出现两个问题了，怎样判断点击的点处在多边形的内部？怎样执行删除操作？ 下面我们分别来研究一下</p>
                  <h3 id="1-判断点在多边形内部"><a href="#1-判断点在多边形内部" class="headerlink" title="1. 判断点在多边形内部"></a>1. 判断点在多边形内部</h3>
                  <p>思路：求解通过该点的水平线与多边形各边的交点 ，如果交点为奇数，那么就判定为在多边形内部，否则在外部。 因此，我的算法实现如下，传入的参数一个是 ploygon 结构体，结构体中包含了顶点坐标，另外就是这个点的 x，y 坐标。 思路参考来源： <a href="http://blog.csdn.net/hgl868/article/details/7947272" target="_blank" rel="noopener">判断点在多边形内的多种写法</a> 经过我的改写，变成了如下内容</p>
                  <figure class="highlight smali">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">/* 判断一个点是否在多边形内部 */</span><br><span class="line">bool pointInPoly(polygon poly,<span class="built_in"> int </span>x,<span class="built_in"> int </span>y)&#123;</span><br><span class="line"><span class="built_in">	int </span>nCross = 0;</span><br><span class="line">	for (int i = 0; i &lt; poly.verNum; i++) &#123;</span><br><span class="line">	<span class="built_in">	int </span>p1x = poly.x[i];</span><br><span class="line">	<span class="built_in">	int </span>p1y = poly.y[i];</span><br><span class="line">	<span class="built_in">	int </span>p2x = poly.x[(i + 1) % poly.verNum];</span><br><span class="line">	<span class="built_in">	int </span>p2y = poly.y[(i + 1) % poly.verNum];</span><br><span class="line">		/* 平行或在延长线上，忽略 */</span><br><span class="line">	<span class="built_in">	if </span>(p1y == p2y || y &lt; min(p1y, p2y) || y &gt; max(p1y, p2y)) &#123;</span><br><span class="line">			continue;</span><br><span class="line">		&#125;</span><br><span class="line">		/* 计算交点横坐标 */</span><br><span class="line">	<span class="built_in">	double </span>m = (double)(y - p1y) * (double)(p2x - p1x) / (double)(p2y - p1y) + p1x;</span><br><span class="line">	<span class="built_in">	if </span>( m &gt; x ) nCross++;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="built_in">	return </span>(nCross % 2 == 1);</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上便是判断在多边形内部的算法。</p>
                  <h3 id="2-删除图形实现"><a href="#2-删除图形实现" class="headerlink" title="2.删除图形实现"></a>2.删除图形实现</h3>
                  <p>好了，有了上面的算法，我们就依次查找我们声明的 polygons 数组，找到第一个符合要求的多边形结构体 polygon 返回它的索引。 这个方法就是传入了点击点的位置 x，y 坐标，然后判断是在哪个多边形内，然后移除之。如果没有找到，则不执行删除操作。</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 删除多边形 */</span></span><br><span class="line">void delete<span class="constructor">Poly(<span class="params">int</span> <span class="params">x</span>, <span class="params">int</span> <span class="params">y</span>)</span> &#123;</span><br><span class="line">	<span class="built_in">int</span> delenum = -<span class="number">1</span>;</span><br><span class="line">	for (<span class="built_in">int</span> i = <span class="number">0</span>; i&lt; con; i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (point<span class="constructor">InPoly(<span class="params">polygons</span>[<span class="params">i</span>], <span class="params">x</span>, <span class="params">y</span>)</span>) &#123;</span><br><span class="line">			delenum = i;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (delenum != -<span class="number">1</span>) &#123;</span><br><span class="line">		remove<span class="constructor">Poly(<span class="params">delenum</span>)</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* 重新绘制 */</span></span><br><span class="line">	glut<span class="constructor">PostRedisplay()</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中 removePoly(delenum) 就是通过传入这个结构体的索引，然后将它从 polygons 里面删除即可，方法实现如下</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 删除多边形 */</span></span><br><span class="line"><span class="type">void</span> removePoly(<span class="type">int</span> <span class="keyword">index</span>)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">index</span>&gt;con) &#123;</span><br><span class="line">		printf("Out Of Index\n");</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="keyword">index</span>; i &lt; con; i++) &#123;</span><br><span class="line">		polygons[i] = polygons[i+<span class="number">1</span>];</span><br><span class="line">	&#125;</span><br><span class="line">	con<span class="comment">--;</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其实就是相当于从数组中移除一个元素，然后后面的元素依次前移。 恩好了，准备工作都做好了，我们只需要在点击了删除按钮之后，调用一下 deletePoly 函数即可。 把原来的 mouseClick 方法改写如下即可，代码较长，不完全展开，<strong>双击查看完整代码</strong></p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/*鼠标点击事件 */</span></span><br><span class="line">void mouse<span class="constructor">Click(<span class="params">int</span> <span class="params">btn</span>, <span class="params">int</span> <span class="params">state</span>, <span class="params">int</span> <span class="params">x</span>, <span class="params">int</span> <span class="params">y</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 选项卡的分界范围 */</span></span><br><span class="line">	<span class="built_in">int</span> optionHeight = <span class="number">40</span>;</span><br><span class="line">	<span class="built_in">int</span> optionWidth = <span class="number">250</span>;</span><br><span class="line">	<span class="keyword">if</span> (btn<span class="operator"> == </span>GLUT_LEFT_BUTTON<span class="operator"> &amp;&amp; </span>state<span class="operator"> == </span>GLUT_DOWN)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/* 如果在颜色选项卡中点击 */</span></span><br><span class="line">		<span class="keyword">if</span> (y &lt; optionHeight<span class="operator"> &amp;&amp; </span>x &lt; optionWidth)</span><br><span class="line">		&#123;</span><br><span class="line">			gl<span class="constructor">ReadPixels(<span class="params">x</span>, 2 <span class="operator">*</span> <span class="params">halfHeight</span> - <span class="params">y</span>, 1, 1, GL_RGB, GL_UNSIGNED_BYTE, &amp;<span class="params">nowColor</span>)</span>;</span><br><span class="line">			printf(<span class="string">"r:%d,g:%d,b:%d\n"</span>, nowColor<span class="literal">[<span class="number">0</span>]</span>, nowColor<span class="literal">[<span class="number">1</span>]</span>, nowColor<span class="literal">[<span class="number">2</span>]</span>);</span><br><span class="line">			<span class="comment">/* 设置绘图颜色并显示当前取色板颜色 */</span></span><br><span class="line">			gl<span class="constructor">ColorCircle(-180, 280, 10, <span class="params">nowColor</span>)</span>;</span><br><span class="line">		<span class="comment">/* 如果点击的是右侧选项按钮 */</span></span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span> (y &lt; optionHeight<span class="operator"> &amp;&amp; </span>x &gt; optionWidth) &#123;</span><br><span class="line">			<span class="comment">//取当前的点</span></span><br><span class="line">			GLubyte color<span class="literal">[<span class="number">3</span>]</span>;</span><br><span class="line">			gl<span class="constructor">ReadPixels(<span class="params">x</span>, 2 <span class="operator">*</span> <span class="params">halfHeight</span> - <span class="params">y</span>, 1, 1, GL_RGB, GL_UNSIGNED_BYTE, &amp;<span class="params">color</span>)</span>;</span><br><span class="line">			printf(<span class="string">"r:%d,g:%d,b:%d\n"</span>, color<span class="literal">[<span class="number">0</span>]</span>, color<span class="literal">[<span class="number">1</span>]</span>, color<span class="literal">[<span class="number">2</span>]</span>);</span><br><span class="line">			<span class="comment">/* 如果点击了开始绘制的按钮 */</span></span><br><span class="line">			<span class="keyword">if</span> (same<span class="constructor">Color(<span class="params">color</span>, <span class="params">startBtn</span>)</span>) &#123;</span><br><span class="line">				drawStatus = <span class="number">0</span>;</span><br><span class="line">				<span class="comment">/* 开始画一个图形，顶点个数置零 */</span></span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.verNum = <span class="number">0</span>;</span><br><span class="line">				printf(<span class="string">"drawStatus:%d\n"</span>, drawStatus);</span><br><span class="line">			<span class="comment">/* 如果点击了结束绘制的按钮 */</span></span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (same<span class="constructor">Color(<span class="params">color</span>, <span class="params">endBtn</span>)</span>) &#123;</span><br><span class="line">				glut<span class="constructor">PostRedisplay()</span>;</span><br><span class="line">				<span class="comment">/* 画的图形个数加一 */</span></span><br><span class="line">				con++;</span><br><span class="line">				printf(<span class="string">"drawStatus:%d\n"</span>, drawStatus);</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (same<span class="constructor">Color(<span class="params">color</span>, <span class="params">delBtn</span>)</span>) &#123;</span><br><span class="line">				<span class="comment">/* 删除时设置drawStatus为2 */</span></span><br><span class="line">				drawStatus = <span class="number">2</span>;</span><br><span class="line">				printf(<span class="string">"drawStatus:%d\n"</span>, drawStatus);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* 如果点击的是下方的绘图页面 */</span></span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">/* 如果当前是正在取点状态 */</span></span><br><span class="line">			<span class="keyword">if</span> (drawStatus<span class="operator"> == </span><span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">/* 保存每个点，然后该图形顶点个数加一 */</span></span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.x<span class="literal">[<span class="identifier">polygons</span>[<span class="identifier">con</span>]</span>.verNum]	= x;</span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.y<span class="literal">[<span class="identifier">polygons</span>[<span class="identifier">con</span>]</span>.verNum]	= y;</span><br><span class="line">				<span class="comment">/* 画点 */</span></span><br><span class="line">				gl<span class="constructor">Points(<span class="params">x</span>, <span class="params">y</span>)</span>;</span><br><span class="line">				<span class="comment">/* 设置当前颜色RGB，如果取色有变动，以最后的取色为准 */</span></span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">0</span>]</span> = nowColor<span class="literal">[<span class="number">0</span>]</span>;</span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">1</span>]</span> = nowColor<span class="literal">[<span class="number">1</span>]</span>;</span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">2</span>]</span> = nowColor<span class="literal">[<span class="number">2</span>]</span>;</span><br><span class="line">				printf(<span class="string">"polyColor%d%d%d\n"</span>, polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">0</span>]</span>,polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">1</span>]</span>,polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">2</span>]</span>);</span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.verNum++;</span><br><span class="line">				printf(<span class="string">"con:%d,verNum:%d\n"</span>, con, polygons<span class="literal">[<span class="identifier">con</span>]</span>.verNum);</span><br><span class="line">			&#125;<span class="keyword">else</span> <span class="keyword">if</span> (drawStatus<span class="operator"> == </span><span class="number">2</span>) &#123;</span><br><span class="line">				<span class="comment">/* 删除图形 */</span></span><br><span class="line">				delete<span class="constructor">Poly(<span class="params">x</span>, <span class="params">y</span>)</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>经过上面的步骤，我们便可以很方便地实现图形的删除了。运行结果如下</p>
                  <p>[embed]<a href="http://cdn.cuiqingcai.com/robot2.mp4[/embed" target="_blank" rel="noopener">http://cdn.cuiqingcai.com/robot2.mp4[/embed</a>]</p>
                  <p>嗯，就是这样，现在删除就大功告成了。</p>
                  <h2 id="移动图形"><a href="#移动图形" class="headerlink" title="移动图形"></a>移动图形</h2>
                  <p>像之前一样，定义一个移动图形的按钮。在此不再赘述</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">GLubyte moveBtn[<span class="number">3</span>] = &#123;<span class="number">40</span>, <span class="number">40</span>, <span class="number">40</span>&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">glColorCircle(<span class="number">190</span>, <span class="number">280</span>, <span class="number">10</span>, moveBtn);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>那么图形移动怎么实现？思路如下 首先利用判断点击的点是否在多边形内部的算法，找到需要移动的多边形。然后在监听鼠标移动的事件中设置这个多边形各个顶点的相对移动距离等于鼠标相对移动距离即可。 首先，移动的 drawSatus 我们设置为 3，在 mouseClick 方法中加入如下部分，在哪加你应该已经知道了。</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (same<span class="constructor">Color(<span class="params">color</span>, <span class="params">moveBtn</span>)</span>) &#123;</span><br><span class="line">				<span class="comment">/* 移动时设置drawStatus为3 */</span></span><br><span class="line">				drawStatus = <span class="number">3</span>;</span><br><span class="line">				printf(<span class="string">"drawStatus:%d\n"</span>, drawStatus);</span><br><span class="line">			&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在 mouseMove 方法中（另一个监听鼠标移动的事件）中首先判断当前的 drawStatus 如果为 3，那么就执行移动操作。 加入如下的方法即可。</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 鼠标移动事件 */</span></span><br><span class="line">void mouse<span class="constructor">Move(<span class="params">int</span> <span class="params">x</span>, <span class="params">int</span> <span class="params">y</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span>(drawStatus<span class="operator"> == </span><span class="number">3</span><span class="operator"> &amp;&amp; </span>moveNum != -<span class="number">1</span>)&#123;</span><br><span class="line">		printf(<span class="string">"move x:%d,y:%dmoveNum:%d\n"</span>, x, y,moveNum);</span><br><span class="line">		move<span class="constructor">Poly(<span class="params">x</span>, <span class="params">y</span>)</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里两点需要说明，moveNum 就是我们需要移动的图形的索引，定义为了全局变量。在鼠标点击时，首先判定点击点在哪个图形中，然而因为有两个鼠标事件（一个是点击，一个是移动），所以就把这个变量定义为全局变量，来标记该移动哪个图形。moveNum 的初始值为-1，如果为-1，那么就代表没有选中任何图形，不移动。如果不是-1，就进行移动。 其次，movePloy 方法实现如下</p>
                  <figure class="highlight gml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 移动多边形 */</span></span><br><span class="line">void movePoly(int <span class="symbol">x</span>, int <span class="symbol">y</span>) &#123;</span><br><span class="line">	<span class="comment">/* 取到要移动的图形 */</span></span><br><span class="line">	int verNum = polygons[moveNum].verNum;</span><br><span class="line">	printf(<span class="string">"verNum%d,x%d,y%d,clickX%d,clickY%d\n"</span>,verNum,<span class="symbol">x</span>,<span class="symbol">y</span>,clickX,clickY);</span><br><span class="line">	<span class="keyword">for</span> (int i = <span class="number">0</span>; i &lt; verNum; i++) &#123;</span><br><span class="line">		polygons[moveNum].<span class="symbol">x</span>[i] += (<span class="symbol">x</span> - clickX);</span><br><span class="line">		polygons[moveNum].<span class="symbol">y</span>[i] += (<span class="symbol">y</span> - clickY);</span><br><span class="line">		printf(<span class="string">"polyx%d\n"</span>,polygons[moveNum].<span class="symbol">x</span>[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* 移动完毕之后重新记录当前的点 */</span></span><br><span class="line">	clickX = <span class="symbol">x</span>;</span><br><span class="line">	clickY = <span class="symbol">y</span>;</span><br><span class="line">	<span class="comment">/* 重新绘制 */</span></span><br><span class="line">	glutPostRedisplay();</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这个方法的实现有一部分需要说明，首先是 clickX，clickY。 因为在移动时移动的是相对距离。所以，鼠标每移动一个像素，我们就要计算下一步鼠标移动的位置和上一个位置的差值，所以每次移动我们都需要标记一下点击的位置。所以上面的方法中才有了</p>
                  <figure class="highlight gml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 移动完毕之后重新记录当前的点 */</span></span><br><span class="line">	clickX = <span class="symbol">x</span>;</span><br><span class="line">	clickY = <span class="symbol">y</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后，在图形移动时，我们需要移动的是相对位置。所以我们将一个图形的所有顶点进行遍历，加上鼠标移动的相对位置即可。就是如下的实现</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">for (<span class="name">int</span> i = <span class="number">0</span><span class="comment">; i &lt; verNum; i++) &#123;</span></span><br><span class="line">		polygons[moveNum].x[i] += (<span class="name">x</span> - clickX)<span class="comment">;</span></span><br><span class="line">		polygons[moveNum].y[i] += (<span class="name">y</span> - clickY)<span class="comment">;</span></span><br><span class="line">	&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外，mouseClick 方法中我们需要调用一下即可。mouseClick 方法现在改写如下</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/*鼠标点击事件 */</span></span><br><span class="line">void mouse<span class="constructor">Click(<span class="params">int</span> <span class="params">btn</span>, <span class="params">int</span> <span class="params">state</span>, <span class="params">int</span> <span class="params">x</span>, <span class="params">int</span> <span class="params">y</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 赋值全局变量 */</span></span><br><span class="line">		clickX = x;</span><br><span class="line">		clickY = y;</span><br><span class="line">	<span class="comment">/* 选项卡的分界范围 */</span></span><br><span class="line">	<span class="built_in">int</span> optionHeight = <span class="number">40</span>;</span><br><span class="line">	<span class="built_in">int</span> optionWidth = <span class="number">250</span>;</span><br><span class="line">	<span class="keyword">if</span> (btn<span class="operator"> == </span>GLUT_LEFT_BUTTON<span class="operator"> &amp;&amp; </span>state<span class="operator"> == </span>GLUT_DOWN)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/* 如果在颜色选项卡中点击 */</span></span><br><span class="line">		<span class="keyword">if</span> (y &lt; optionHeight<span class="operator"> &amp;&amp; </span>x &lt; optionWidth)</span><br><span class="line">		&#123;</span><br><span class="line">			gl<span class="constructor">ReadPixels(<span class="params">x</span>, 2 <span class="operator">*</span> <span class="params">halfHeight</span> - <span class="params">y</span>, 1, 1, GL_RGB, GL_UNSIGNED_BYTE, &amp;<span class="params">nowColor</span>)</span>;</span><br><span class="line">			printf(<span class="string">"r:%d,g:%d,b:%d\n"</span>, nowColor<span class="literal">[<span class="number">0</span>]</span>, nowColor<span class="literal">[<span class="number">1</span>]</span>, nowColor<span class="literal">[<span class="number">2</span>]</span>);</span><br><span class="line">			<span class="comment">/* 设置绘图颜色并显示当前取色板颜色 */</span></span><br><span class="line">			gl<span class="constructor">ColorCircle(-180, 280, 10, <span class="params">nowColor</span>)</span>;</span><br><span class="line">		<span class="comment">/* 如果点击的是右侧选项按钮 */</span></span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span> (y &lt; optionHeight<span class="operator"> &amp;&amp; </span>x &gt; optionWidth) &#123;</span><br><span class="line">			<span class="comment">//取当前的点</span></span><br><span class="line">			GLubyte color<span class="literal">[<span class="number">3</span>]</span>;</span><br><span class="line">			gl<span class="constructor">ReadPixels(<span class="params">x</span>, 2 <span class="operator">*</span> <span class="params">halfHeight</span> - <span class="params">y</span>, 1, 1, GL_RGB, GL_UNSIGNED_BYTE, &amp;<span class="params">color</span>)</span>;</span><br><span class="line">			printf(<span class="string">"r:%d,g:%d,b:%d\n"</span>, color<span class="literal">[<span class="number">0</span>]</span>, color<span class="literal">[<span class="number">1</span>]</span>, color<span class="literal">[<span class="number">2</span>]</span>);</span><br><span class="line">			<span class="comment">/* 如果点击了开始绘制的按钮 */</span></span><br><span class="line">			<span class="keyword">if</span> (same<span class="constructor">Color(<span class="params">color</span>, <span class="params">startBtn</span>)</span>) &#123;</span><br><span class="line">				drawStatus = <span class="number">0</span>;</span><br><span class="line">				<span class="comment">/* 开始画一个图形，顶点个数置零 */</span></span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.verNum = <span class="number">0</span>;</span><br><span class="line">				printf(<span class="string">"drawStatus:%d\n"</span>, drawStatus);</span><br><span class="line">			<span class="comment">/* 如果点击了结束绘制的按钮 */</span></span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (same<span class="constructor">Color(<span class="params">color</span>, <span class="params">endBtn</span>)</span>) &#123;</span><br><span class="line">				glut<span class="constructor">PostRedisplay()</span>;</span><br><span class="line">				<span class="comment">/* 画的图形个数加一 */</span></span><br><span class="line">				con++;</span><br><span class="line">				printf(<span class="string">"drawStatus:%d\n"</span>, drawStatus);</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (same<span class="constructor">Color(<span class="params">color</span>, <span class="params">delBtn</span>)</span>) &#123;</span><br><span class="line">				<span class="comment">/* 删除时设置drawStatus为2 */</span></span><br><span class="line">				drawStatus = <span class="number">2</span>;</span><br><span class="line">				printf(<span class="string">"drawStatus:%d\n"</span>, drawStatus);</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (same<span class="constructor">Color(<span class="params">color</span>, <span class="params">moveBtn</span>)</span>) &#123;</span><br><span class="line">				<span class="comment">/* 移动时设置drawStatus为3 */</span></span><br><span class="line">				drawStatus = <span class="number">3</span>;</span><br><span class="line">				printf(<span class="string">"drawStatus:%d\n"</span>, drawStatus);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* 如果点击的是下方的绘图页面 */</span></span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">/* 如果当前是正在取点状态 */</span></span><br><span class="line">			<span class="keyword">if</span> (drawStatus<span class="operator"> == </span><span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">/* 保存每个点，然后该图形顶点个数加一 */</span></span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.x<span class="literal">[<span class="identifier">polygons</span>[<span class="identifier">con</span>]</span>.verNum]	= x;</span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.y<span class="literal">[<span class="identifier">polygons</span>[<span class="identifier">con</span>]</span>.verNum]	= y;</span><br><span class="line">				<span class="comment">/* 画点 */</span></span><br><span class="line">				gl<span class="constructor">Points(<span class="params">x</span>, <span class="params">y</span>)</span>;</span><br><span class="line">				<span class="comment">/* 设置当前颜色RGB，如果取色有变动，以最后的取色为准 */</span></span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">0</span>]</span> = nowColor<span class="literal">[<span class="number">0</span>]</span>;</span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">1</span>]</span> = nowColor<span class="literal">[<span class="number">1</span>]</span>;</span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">2</span>]</span> = nowColor<span class="literal">[<span class="number">2</span>]</span>;</span><br><span class="line">				printf(<span class="string">"polyColor%d%d%d\n"</span>, polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">0</span>]</span>,polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">1</span>]</span>,polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">2</span>]</span>);</span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.verNum++;</span><br><span class="line">				printf(<span class="string">"con:%d,verNum:%d\n"</span>, con, polygons<span class="literal">[<span class="identifier">con</span>]</span>.verNum);</span><br><span class="line">			&#125;<span class="keyword">else</span> <span class="keyword">if</span> (drawStatus<span class="operator"> == </span><span class="number">2</span>) &#123;</span><br><span class="line">				<span class="comment">/* 删除图形 */</span></span><br><span class="line">				delete<span class="constructor">Poly(<span class="params">x</span>, <span class="params">y</span>)</span>;</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span>(drawStatus<span class="operator"> == </span><span class="number">3</span>) &#123;</span><br><span class="line">				moveNum = -<span class="number">1</span>;</span><br><span class="line">				for (<span class="built_in">int</span> i = <span class="number">0</span>; i&lt; con; i++) &#123;</span><br><span class="line">					<span class="keyword">if</span> (point<span class="constructor">InPoly(<span class="params">polygons</span>[<span class="params">i</span>], <span class="params">x</span>, <span class="params">y</span>)</span>) &#123;</span><br><span class="line">						moveNum = i;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好，现在就大功告成了，看一下运行结果吧</p>
                  <p>[embed]<a href="http://cdn.cuiqingcai.com/robot3.mp4[/embed" target="_blank" rel="noopener">http://cdn.cuiqingcai.com/robot3.mp4[/embed</a>]</p>
                  <p>现在完整的代码如下，代码过长，不完全显示，<strong>双击查看完整代码</strong></p>
                  <figure class="highlight arduino">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;glut.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PI 3.1415926</span></span><br><span class="line"><span class="comment">/* 每个图形最多的顶点数 */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_VERTEX 10</span></span><br><span class="line"><span class="comment">/* 画的图形最多的个数 */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_PLOY 10</span></span><br><span class="line"><span class="comment">/* 窗口长宽的一半 */</span></span><br><span class="line"><span class="keyword">int</span> halfWidth, halfHeight;</span><br><span class="line"><span class="comment">/* 绘制多边形的起始标志，0是开始绘制，1是结束绘制，初始为-1 */</span></span><br><span class="line"><span class="keyword">int</span>	drawStatus	= <span class="number">-1</span>;</span><br><span class="line"><span class="keyword">int</span>	moveNum		= <span class="number">-1</span>;</span><br><span class="line"><span class="comment">/* 定义点击点的x,y*/</span></span><br><span class="line"><span class="keyword">int</span> clickX, clickY;</span><br><span class="line"><span class="comment">/* 多边形结构体 */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">polygon</span> &#123;</span></span><br><span class="line">	<span class="comment">/* 顶点坐标 */</span></span><br><span class="line">	<span class="keyword">int</span>	x[MAX_VERTEX];</span><br><span class="line">	<span class="keyword">int</span>	y[MAX_VERTEX];</span><br><span class="line">	<span class="comment">/* 定义第几个顶点 */</span></span><br><span class="line">	<span class="keyword">int</span>	verNum;</span><br><span class="line">	GLubyte color[<span class="number">3</span>];</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/* 各种颜色 */</span></span><br><span class="line">GLubyte border[<span class="number">3</span>] = &#123; <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span> &#125;;</span><br><span class="line">GLubyte grey[<span class="number">3</span>] = &#123; <span class="number">195</span>, <span class="number">195</span>, <span class="number">195</span> &#125;;</span><br><span class="line">GLubyte yellow[<span class="number">3</span>] = &#123; <span class="number">255</span>, <span class="number">243</span>, <span class="number">0</span> &#125;;</span><br><span class="line">GLubyte red[<span class="number">3</span>] = &#123; <span class="number">237</span>, <span class="number">28</span>, <span class="number">36</span> &#125;;</span><br><span class="line">GLubyte darkGrey[<span class="number">3</span>] = &#123; <span class="number">126</span>, <span class="number">126</span>, <span class="number">126</span> &#125;;</span><br><span class="line">GLubyte white[<span class="number">3</span>] = &#123; <span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span> &#125;;</span><br><span class="line">GLubyte startBtn[<span class="number">3</span>] = &#123; <span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span> &#125;;</span><br><span class="line">GLubyte endBtn[<span class="number">3</span>] = &#123; <span class="number">20</span>, <span class="number">20</span>, <span class="number">20</span> &#125;;</span><br><span class="line">GLubyte delBtn[<span class="number">3</span>] = &#123; <span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span> &#125;;</span><br><span class="line">GLubyte moveBtn[<span class="number">3</span>] = &#123; <span class="number">40</span>, <span class="number">40</span>, <span class="number">40</span> &#125;;</span><br><span class="line"><span class="comment">/* 当前颜色 */</span></span><br><span class="line">GLubyte nowColor[<span class="number">3</span>] = &#123; <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span> &#125;;</span><br><span class="line"><span class="comment">/* 声明多边形数组 */</span></span><br><span class="line">polygon polygons[MAX_PLOY];</span><br><span class="line"><span class="comment">/* 记录画了几个多边形 */</span></span><br><span class="line"><span class="keyword">int</span> con = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 绘制多边形 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">glPolygons</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> ( con &gt;= <span class="number">0</span> )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span> ( <span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= con; i++ )</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">/* 取到这个多边形 */</span></span><br><span class="line">			polygon poly = polygons[i];</span><br><span class="line">			<span class="comment">/* 画封闭线 */</span></span><br><span class="line">			glBegin( GL_LINE_LOOP );</span><br><span class="line">			<span class="keyword">int</span> num = poly.verNum;</span><br><span class="line">			<span class="built_in">printf</span>( <span class="string">"num:%d\n"</span>, num );</span><br><span class="line">			<span class="keyword">for</span> ( <span class="keyword">int</span> j = <span class="number">0</span>; j &lt; num; j++ )</span><br><span class="line">			&#123;</span><br><span class="line">				glColor3ub( poly.color[<span class="number">0</span>], poly.color[<span class="number">1</span>], poly.color[<span class="number">2</span>] );</span><br><span class="line">				glVertex2d( poly.x[j] - halfWidth, halfHeight - poly.y[j] );</span><br><span class="line">				<span class="built_in">printf</span>( <span class="string">"polyx:%d,polyy:%d"</span>, poly.x[j], poly.y[j] );</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">/* 结束画线 */</span></span><br><span class="line">			glEnd();</span><br><span class="line">			<span class="comment">/* 刷新 */</span></span><br><span class="line">			glFlush();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 绘制填充的圆形 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">glColorCircle</span><span class="params">( <span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> R, GLubyte color[<span class="number">3</span>] )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/* 开始绘制曲线 */</span></span><br><span class="line">	glBegin( GL_POLYGON );</span><br><span class="line">	<span class="comment">/* 设置颜色 */</span></span><br><span class="line">	glColor3ub( color[<span class="number">0</span>], color[<span class="number">1</span>], color[<span class="number">2</span>] );</span><br><span class="line">	<span class="comment">/* 每次画增加的弧度 */</span></span><br><span class="line">	<span class="keyword">double</span> delta_angle = PI / <span class="number">180</span>;</span><br><span class="line">	<span class="comment">/* 画圆弧 */</span></span><br><span class="line">	<span class="keyword">for</span> ( <span class="keyword">double</span> i = <span class="number">0</span>; i &lt;= <span class="number">2</span> * PI; i += delta_angle )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/* 绝对定位加三角函数值 */</span></span><br><span class="line">		<span class="keyword">double</span>	vx	= x + R * <span class="built_in">cos</span>( i );</span><br><span class="line">		<span class="keyword">double</span>	vy	= y + R*<span class="built_in">sin</span>( i );</span><br><span class="line">		glVertex2d( vx, vy );</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* 结束绘画 */</span></span><br><span class="line">	glEnd();</span><br><span class="line">	glFlush();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 画矩形，传入的是左下角XY坐标和右上角XY坐标 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">glRect</span><span class="params">( <span class="keyword">int</span> leftX, <span class="keyword">int</span> leftY, <span class="keyword">int</span> rightX, <span class="keyword">int</span> rightY )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/* 画封闭曲线 */</span></span><br><span class="line">	glBegin( GL_LINE_LOOP );</span><br><span class="line">	<span class="comment">/* 左下角 */</span></span><br><span class="line">	glVertex2d( leftX, leftY );</span><br><span class="line">	<span class="comment">/* 右下角 */</span></span><br><span class="line">	glVertex2d( rightX, leftY );</span><br><span class="line">	<span class="comment">/* 右上角 */</span></span><br><span class="line">	glVertex2d( rightX, rightY );</span><br><span class="line">	<span class="comment">/* 左上角 */</span></span><br><span class="line">	glVertex2d( leftX, rightY );</span><br><span class="line">	<span class="comment">/* 结束画线 */</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 画圆角矩形，传入矩形宽高，角半径，矩形中心点坐标 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">glRoundRec</span><span class="params">( <span class="keyword">int</span> centerX, <span class="keyword">int</span> centerY, <span class="keyword">int</span> <span class="built_in">width</span>, <span class="keyword">int</span> <span class="built_in">height</span>, <span class="keyword">float</span> cirR )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/* 二分之PI，一个象限的角度 */</span></span><br><span class="line">	<span class="keyword">float</span> PI_HALF = PI / <span class="number">2</span>;</span><br><span class="line">	<span class="comment">/* 划分程度,值越大画得越精细 */</span></span><br><span class="line">	<span class="keyword">float</span> divide = <span class="number">20.0</span>;</span><br><span class="line">	<span class="comment">/* 圆角矩形的坐标 */</span></span><br><span class="line">	<span class="keyword">float</span> tx, ty;</span><br><span class="line">	<span class="comment">/* 画封闭曲线 */</span></span><br><span class="line">	glBegin( GL_LINE_LOOP );</span><br><span class="line">	<span class="comment">/* 四个象限不同的操作符 */</span></span><br><span class="line">	<span class="keyword">int</span>	opX[<span class="number">4</span>]	= &#123; <span class="number">1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">1</span> &#125;;</span><br><span class="line">	<span class="keyword">int</span>	opY[<span class="number">4</span>]	= &#123; <span class="number">1</span>, <span class="number">1</span>, <span class="number">-1</span>, <span class="number">-1</span> &#125;;</span><br><span class="line">	<span class="comment">/* 用来计数，从第一象限到第四象限 */</span></span><br><span class="line">	<span class="keyword">float</span> x = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">/* x自增时加的值 */</span></span><br><span class="line">	<span class="keyword">float</span> part = <span class="number">1</span> / divide;</span><br><span class="line">	<span class="comment">/* 计算内矩形宽高一半的数值 */</span></span><br><span class="line">	<span class="keyword">int</span>	w	= <span class="built_in">width</span> / <span class="number">2</span> - cirR;</span><br><span class="line">	<span class="keyword">int</span>	h	= <span class="built_in">height</span> / <span class="number">2</span> - cirR;</span><br><span class="line">	<span class="comment">/* 循环画线 */</span></span><br><span class="line">	<span class="keyword">for</span> ( x = <span class="number">0</span>; x &lt; <span class="number">4</span>; x += part )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/* 求出弧度 */</span></span><br><span class="line">		<span class="keyword">float</span> rad = PI_HALF * x;</span><br><span class="line">		<span class="comment">/* 计算坐标值 */</span></span><br><span class="line">		tx	= cirR * <span class="built_in">cos</span>( rad ) + opX[(<span class="keyword">int</span>) x] * w + centerX;</span><br><span class="line">		ty	= cirR * <span class="built_in">sin</span>( rad ) + opY[(<span class="keyword">int</span>) x] * h + centerY;</span><br><span class="line">		<span class="comment">/*传入坐标画线 */</span></span><br><span class="line">		glVertex2f( tx, ty );</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* 结束画线 */</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 画弧线，相对偏移量XY，开始的弧度，结束的弧度，半径 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">glArc</span><span class="params">( <span class="keyword">double</span> x, <span class="keyword">double</span> y, <span class="keyword">double</span> start_angle, <span class="keyword">double</span> end_angle, <span class="keyword">double</span> radius )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/* 开始绘制曲线 */</span></span><br><span class="line">	glBegin( GL_LINE_STRIP );</span><br><span class="line">	<span class="comment">/* 每次画增加的弧度 */</span></span><br><span class="line">	<span class="keyword">double</span> delta_angle = PI / <span class="number">180</span>;</span><br><span class="line">	<span class="comment">/* 画圆弧 */</span></span><br><span class="line">	<span class="keyword">for</span> ( <span class="keyword">double</span> i = start_angle; i &lt;= end_angle; i += delta_angle )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/* 绝对定位加三角函数值 */</span></span><br><span class="line">		<span class="keyword">double</span>	vx	= x + radius * <span class="built_in">cos</span>( i );</span><br><span class="line">		<span class="keyword">double</span>	vy	= y + radius*<span class="built_in">sin</span>( i );</span><br><span class="line">		glVertex2d( vx, vy );</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* 结束绘画 */</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 画圆 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">glCircle</span><span class="params">( <span class="keyword">double</span> x, <span class="keyword">double</span> y, <span class="keyword">double</span> radius )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/* 画全圆 */</span></span><br><span class="line">	glArc( x, y, <span class="number">0</span>, <span class="number">2</span> * PI, radius );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 画三角形，传入三个点的坐标 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">glTri</span><span class="params">( <span class="keyword">int</span> x1, <span class="keyword">int</span> y1, <span class="keyword">int</span> x2, <span class="keyword">int</span> y2, <span class="keyword">int</span> x3, <span class="keyword">int</span> y3 )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/* 画封闭线 */</span></span><br><span class="line">	glBegin( GL_LINE_LOOP );</span><br><span class="line">	<span class="comment">/* 一点 */</span></span><br><span class="line">	glVertex2d( x1, y1 );</span><br><span class="line">	<span class="comment">/* 二点 */</span></span><br><span class="line">	glVertex2d( x2, y2 );</span><br><span class="line">	<span class="comment">/*三点 */</span></span><br><span class="line">	glVertex2d( x3, y3 );</span><br><span class="line">	<span class="comment">/* 结束画线 */</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 画线，传入两点坐标 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">glLine</span><span class="params">( <span class="keyword">int</span> x1, <span class="keyword">int</span> y1, <span class="keyword">int</span> x2, <span class="keyword">int</span> y2 )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/* 画封闭线 */</span></span><br><span class="line">	glBegin( GL_LINE_STRIP );</span><br><span class="line">	<span class="comment">/* 一点 */</span></span><br><span class="line">	glVertex2d( x1, y1 );</span><br><span class="line">	<span class="comment">/* 二点 */</span></span><br><span class="line">	glVertex2d( x2, y2 );</span><br><span class="line">	<span class="comment">/* 结束画线 */</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 函数用来画图 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">display</span><span class="params">( <span class="keyword">void</span> )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/* GL_COLOR_BUFFER_BIT表示清除颜色 */</span></span><br><span class="line">	glClear( GL_COLOR_BUFFER_BIT );</span><br><span class="line">	<span class="comment">/* 设置画线颜色 */</span></span><br><span class="line">	glColor3f( <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span> );</span><br><span class="line">	<span class="comment">/* 画点大小 */</span></span><br><span class="line">	glPointSize( <span class="number">2</span> );</span><br><span class="line">	<span class="comment">/* 画圆角矩形，大肚子 */</span></span><br><span class="line">	glRoundRec( <span class="number">0</span>, <span class="number">0</span>, <span class="number">146</span>, <span class="number">120</span>, <span class="number">15</span> );</span><br><span class="line">	<span class="comment">/* 画圆，中间小圈 */</span></span><br><span class="line">	glCircle( <span class="number">0</span>, <span class="number">0</span>, <span class="number">10</span> );</span><br><span class="line">	<span class="comment">/* 画矩形，脖子 */</span></span><br><span class="line">	glRect( <span class="number">-25</span>, <span class="number">60</span>, <span class="number">25</span>, <span class="number">76</span> );</span><br><span class="line">	<span class="comment">/* 画圆角矩形，大脸 */</span></span><br><span class="line">	glRoundRec( <span class="number">0</span>, <span class="number">113</span>, <span class="number">128</span>, <span class="number">74</span>, <span class="number">10</span> );</span><br><span class="line">	<span class="comment">/* 两个眼睛 */</span></span><br><span class="line">	glCircle( <span class="number">-30</span>, <span class="number">111</span>, <span class="number">10</span> );</span><br><span class="line">	glCircle( <span class="number">30</span>, <span class="number">111</span>, <span class="number">10</span> );</span><br><span class="line">	<span class="comment">/* 两条天线 */</span></span><br><span class="line">	glLine( <span class="number">-35</span>, <span class="number">150</span>, <span class="number">-35</span>, <span class="number">173</span> );</span><br><span class="line">	glLine( <span class="number">35</span>, <span class="number">150</span>, <span class="number">35</span>, <span class="number">173</span> );</span><br><span class="line">	<span class="comment">/* 圆角矩形，两个耳朵 */</span></span><br><span class="line">	glRoundRec( <span class="number">81</span>, <span class="number">115</span>, <span class="number">20</span>, <span class="number">34</span>, <span class="number">5</span> );</span><br><span class="line">	glRoundRec( <span class="number">-81</span>, <span class="number">115</span>, <span class="number">20</span>, <span class="number">34</span>, <span class="number">5</span> );</span><br><span class="line">	<span class="comment">/* 圆弧，画嘴 */</span></span><br><span class="line">	glArc( <span class="number">0</span>, <span class="number">133</span>, <span class="number">11</span> * PI / <span class="number">8</span>, <span class="number">13</span> * PI / <span class="number">8</span>, <span class="number">45</span> );</span><br><span class="line">	<span class="comment">/* 画三角，肚子里的三角 */</span></span><br><span class="line">	glTri( <span class="number">-30</span>, <span class="number">-15</span>, <span class="number">30</span>, <span class="number">-15</span>, <span class="number">0</span>, <span class="number">28</span> );</span><br><span class="line">	<span class="comment">/* 画矩形，胳膊连接处 */</span></span><br><span class="line">	glRect( <span class="number">-81</span>, <span class="number">43</span>, <span class="number">-73</span>, <span class="number">25</span> );</span><br><span class="line">	glRect( <span class="number">81</span>, <span class="number">43</span>, <span class="number">73</span>, <span class="number">25</span> );</span><br><span class="line">	<span class="comment">/* 画矩形，上臂 */</span></span><br><span class="line">	glRect( <span class="number">-108</span>, <span class="number">45</span>, <span class="number">-81</span>, <span class="number">0</span> );</span><br><span class="line">	glRect( <span class="number">108</span>, <span class="number">45</span>, <span class="number">81</span>, <span class="number">0</span> );</span><br><span class="line">	<span class="comment">/* 画矩形，中臂 */</span></span><br><span class="line">	glRect( <span class="number">-101</span>, <span class="number">0</span>, <span class="number">-88</span>, <span class="number">-4</span> );</span><br><span class="line">	glRect( <span class="number">101</span>, <span class="number">0</span>, <span class="number">88</span>, <span class="number">-4</span> );</span><br><span class="line">	<span class="comment">/* 画矩形，下臂 */</span></span><br><span class="line">	glRect( <span class="number">-108</span>, <span class="number">-4</span>, <span class="number">-81</span>, <span class="number">-37</span> );</span><br><span class="line">	glRect( <span class="number">108</span>, <span class="number">-4</span>, <span class="number">81</span>, <span class="number">-37</span> );</span><br><span class="line">	<span class="comment">/* 画圆形，手掌 */</span></span><br><span class="line">	glCircle( <span class="number">-95</span>, <span class="number">-47</span>, <span class="number">10</span> );</span><br><span class="line">	glCircle( <span class="number">95</span>, <span class="number">-47</span>, <span class="number">10</span> );</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* 绘制取色盘 */</span></span><br><span class="line">	glColorCircle( <span class="number">-280</span>, <span class="number">280</span>, <span class="number">10</span>, red );</span><br><span class="line">	glColorCircle( <span class="number">-250</span>, <span class="number">280</span>, <span class="number">10</span>, yellow );</span><br><span class="line">	glColorCircle( <span class="number">-220</span>, <span class="number">280</span>, <span class="number">10</span>, grey );</span><br><span class="line">	glColorCircle( <span class="number">-180</span>, <span class="number">280</span>, <span class="number">10</span>, nowColor );</span><br><span class="line">	glColorCircle( <span class="number">250</span>, <span class="number">280</span>, <span class="number">10</span>, startBtn );</span><br><span class="line">	glColorCircle( <span class="number">280</span>, <span class="number">280</span>, <span class="number">10</span>, endBtn );</span><br><span class="line">	glColorCircle( <span class="number">220</span>, <span class="number">280</span>, <span class="number">10</span>, delBtn );</span><br><span class="line">	glColorCircle( <span class="number">190</span>, <span class="number">280</span>, <span class="number">10</span>, moveBtn );</span><br><span class="line">	<span class="comment">/* 保证前面的OpenGL命令立即执行，而不是让它们在缓冲区中等待 */</span></span><br><span class="line">	<span class="comment">/* 绘制多边形 */</span></span><br><span class="line">	glPolygons();</span><br><span class="line">	glFlush();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 窗口大小变化时调用的函数 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ChangeSize</span><span class="params">( GLsizei w, GLsizei h )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/* 避免高度为0 */</span></span><br><span class="line">	<span class="keyword">if</span> ( h == <span class="number">0</span> )</span><br><span class="line">	&#123;</span><br><span class="line">		h = <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* 定义视口大小，宽高一致 */</span></span><br><span class="line">	glViewport( <span class="number">0</span>, <span class="number">0</span>, w, h );</span><br><span class="line">	<span class="keyword">int</span> half = <span class="number">300</span>;</span><br><span class="line">	<span class="comment">/* 定义宽高的一半 */</span></span><br><span class="line">	halfHeight	= <span class="number">300</span>;</span><br><span class="line">	halfWidth	= <span class="number">300</span>;</span><br><span class="line">	<span class="comment">/* 重置坐标系统，使投影变换复位 */</span></span><br><span class="line">	glMatrixMode( GL_PROJECTION );</span><br><span class="line">	<span class="comment">/* 将当前的用户坐标系的原点移到了屏幕中心 */</span></span><br><span class="line">	glLoadIdentity();</span><br><span class="line">	<span class="comment">/* 定义正交视域体 */</span></span><br><span class="line">	<span class="keyword">if</span> ( w &lt; h )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/* 如果高度大于宽度，则将高度视角扩大，图形显示居中 */</span></span><br><span class="line">		glOrtho( -half, half, -half * h / w, half * h / w, -half, half );</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">/* 如果宽度大于高度，则将宽度视角扩大，图形显示居中 */</span></span><br><span class="line">		glOrtho( -half * w / h, half * w / h, -half, half, -half, half );</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 判断两个颜色是否相等 */</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">sameColor</span><span class="params">( GLubyte color1[<span class="number">3</span>], GLubyte color2[<span class="number">3</span>] )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> ( color1[<span class="number">0</span>] - color2[<span class="number">0</span>] &lt; <span class="number">5</span> &amp;&amp; color1[<span class="number">1</span>] - color2[<span class="number">1</span>] &lt; <span class="number">5</span> &amp;&amp; color1[<span class="number">2</span>] - color2[<span class="number">1</span>] &lt; <span class="number">5</span> )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span>(<span class="literal">true</span>);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">return</span>(<span class="literal">false</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 画点 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">glPoints</span><span class="params">( <span class="keyword">int</span> x, <span class="keyword">int</span> y )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	glBegin( GL_POINTS );</span><br><span class="line">	<span class="comment">/* 点直接设置为黑色 */</span></span><br><span class="line">	glColor3ub( <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span> );</span><br><span class="line">	glVertex2d( x - halfWidth, halfHeight - y );</span><br><span class="line">	glEnd();</span><br><span class="line">	glFlush();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 判断一个点是否在多边形内部 */</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">pointInPoly</span><span class="params">( polygon poly, <span class="keyword">int</span> x, <span class="keyword">int</span> y )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> nCross = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> ( <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; poly.verNum; i++ )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">int</span>	p1x	= poly.x[i];</span><br><span class="line">		<span class="keyword">int</span>	p1y	= poly.y[i];</span><br><span class="line">		<span class="keyword">int</span>	p2x	= poly.x[(i + <span class="number">1</span>) % poly.verNum];</span><br><span class="line">		<span class="keyword">int</span>	p2y	= poly.y[(i + <span class="number">1</span>) % poly.verNum];</span><br><span class="line">		<span class="comment">/* 平行或在延长线上，忽略 */</span></span><br><span class="line">		<span class="keyword">if</span> ( p1y == p2y || y &lt; <span class="built_in">min</span>( p1y, p2y ) || y &gt; <span class="built_in">max</span>( p1y, p2y ) )</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">/* 计算交点横坐标 */</span></span><br><span class="line">		<span class="keyword">double</span> m = (<span class="keyword">double</span>) (y - p1y) * (<span class="keyword">double</span>) (p2x - p1x) / (<span class="keyword">double</span>) (p2y - p1y) + p1x;</span><br><span class="line">		<span class="keyword">if</span> ( m &gt; x )</span><br><span class="line">			nCross++;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span>(nCross % <span class="number">2</span> == <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 移动多边形 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">movePoly</span><span class="params">( <span class="keyword">int</span> x, <span class="keyword">int</span> y )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/* 取到要移动的图形 */</span></span><br><span class="line">	<span class="keyword">int</span> verNum = polygons[moveNum].verNum;</span><br><span class="line">	<span class="built_in">printf</span>( <span class="string">"verNum%d,x%d,y%d,clickX%d,clickY%d\n"</span>, verNum, x, y, clickX, clickY );</span><br><span class="line">	<span class="keyword">for</span> ( <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; verNum; i++ )</span><br><span class="line">	&#123;</span><br><span class="line">		polygons[moveNum].x[i]	+= (x - clickX);</span><br><span class="line">		polygons[moveNum].y[i]	+= (y - clickY);</span><br><span class="line">		<span class="built_in">printf</span>( <span class="string">"polyx%d\n"</span>, polygons[moveNum].x[i] );</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* 移动完毕之后重新记录当前的点 */</span></span><br><span class="line">	clickX	= x;</span><br><span class="line">	clickY	= y;</span><br><span class="line">	<span class="comment">/* 重新绘制 */</span></span><br><span class="line">	glutPostRedisplay();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 删除多边形 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">removePoly</span><span class="params">( <span class="keyword">int</span> index )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> ( index &gt; con )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>( <span class="string">"Out Of Index\n"</span> );</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> ( <span class="keyword">int</span> i = index; i &lt; con; i++ )</span><br><span class="line">	&#123;</span><br><span class="line">		polygons[i] = polygons[i + <span class="number">1</span>];</span><br><span class="line">	&#125;</span><br><span class="line">	con--;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 删除多边形 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">deletePoly</span><span class="params">( <span class="keyword">int</span> x, <span class="keyword">int</span> y )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> delenum = <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">for</span> ( <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; con; i++ )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> ( pointInPoly( polygons[i], x, y ) )</span><br><span class="line">		&#123;</span><br><span class="line">			delenum = i;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> ( delenum != <span class="number">-1</span> )</span><br><span class="line">	&#123;</span><br><span class="line">		removePoly( delenum );</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* 重新绘制 */</span></span><br><span class="line">	glutPostRedisplay();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*鼠标点击事件 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mouseClick</span><span class="params">( <span class="keyword">int</span> btn, <span class="keyword">int</span> state, <span class="keyword">int</span> x, <span class="keyword">int</span> y )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/* 赋值全局变量 */</span></span><br><span class="line">	clickX	= x;</span><br><span class="line">	clickY	= y;</span><br><span class="line">	<span class="comment">/* 选项卡的分界范围 */</span></span><br><span class="line">	<span class="keyword">int</span>	optionHeight	= <span class="number">40</span>;</span><br><span class="line">	<span class="keyword">int</span>	optionWidth	= <span class="number">250</span>;</span><br><span class="line">	<span class="keyword">if</span> ( btn == GLUT_LEFT_BUTTON &amp;&amp; state == GLUT_DOWN )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/* 如果在颜色选项卡中点击 */</span></span><br><span class="line">		<span class="keyword">if</span> ( y &lt; optionHeight &amp;&amp; x &lt; optionWidth )</span><br><span class="line">		&#123;</span><br><span class="line">			glReadPixels( x, <span class="number">2</span> * halfHeight - y, <span class="number">1</span>, <span class="number">1</span>, GL_RGB, GL_UNSIGNED_BYTE, &amp;nowColor );</span><br><span class="line">			<span class="built_in">printf</span>( <span class="string">"r:%d,g:%d,b:%d\n"</span>, nowColor[<span class="number">0</span>], nowColor[<span class="number">1</span>], nowColor[<span class="number">2</span>] );</span><br><span class="line">			<span class="comment">/* 设置绘图颜色并显示当前取色板颜色 */</span></span><br><span class="line">			glColorCircle( <span class="number">-180</span>, <span class="number">280</span>, <span class="number">10</span>, nowColor );</span><br><span class="line">			<span class="comment">/* 如果点击的是右侧选项按钮 */</span></span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span> ( y &lt; optionHeight &amp;&amp; x &gt; optionWidth )</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">/* 取当前的点 */</span></span><br><span class="line">			GLubyte color[<span class="number">3</span>];</span><br><span class="line">			glReadPixels( x, <span class="number">2</span> * halfHeight - y, <span class="number">1</span>, <span class="number">1</span>, GL_RGB, GL_UNSIGNED_BYTE, &amp;color );</span><br><span class="line">			<span class="built_in">printf</span>( <span class="string">"r:%d,g:%d,b:%d\n"</span>, color[<span class="number">0</span>], color[<span class="number">1</span>], color[<span class="number">2</span>] );</span><br><span class="line">			<span class="comment">/* 如果点击了开始绘制的按钮 */</span></span><br><span class="line">			<span class="keyword">if</span> ( sameColor( color, startBtn ) )</span><br><span class="line">			&#123;</span><br><span class="line">				drawStatus = <span class="number">0</span>;</span><br><span class="line">				<span class="comment">/* 开始画一个图形，顶点个数置零 */</span></span><br><span class="line">				polygons[con].verNum = <span class="number">0</span>;</span><br><span class="line">				<span class="built_in">printf</span>( <span class="string">"drawStatus:%d\n"</span>, drawStatus );</span><br><span class="line">				<span class="comment">/* 如果点击了结束绘制的按钮 */</span></span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> ( sameColor( color, endBtn ) )</span><br><span class="line">			&#123;</span><br><span class="line">				glutPostRedisplay();</span><br><span class="line">				<span class="comment">/* 画的图形个数加一 */</span></span><br><span class="line">				con++;</span><br><span class="line">				<span class="built_in">printf</span>( <span class="string">"drawStatus:%d\n"</span>, drawStatus );</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> ( sameColor( color, delBtn ) )</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">/* 删除时设置drawStatus为2 */</span></span><br><span class="line">				drawStatus = <span class="number">2</span>;</span><br><span class="line">				<span class="built_in">printf</span>( <span class="string">"drawStatus:%d\n"</span>, drawStatus );</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> ( sameColor( color, moveBtn ) )</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">/* 移动时设置drawStatus为3 */</span></span><br><span class="line">				drawStatus = <span class="number">3</span>;</span><br><span class="line">				<span class="built_in">printf</span>( <span class="string">"drawStatus:%d\n"</span>, drawStatus );</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">/* 如果点击的是下方的绘图页面 */</span></span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">/* 如果当前是正在取点状态 */</span></span><br><span class="line">			<span class="keyword">if</span> ( drawStatus == <span class="number">0</span> )</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">/* 保存每个点，然后该图形顶点个数加一 */</span></span><br><span class="line">				polygons[con].x[polygons[con].verNum]	= x;</span><br><span class="line">				polygons[con].y[polygons[con].verNum]	= y;</span><br><span class="line">				<span class="comment">/* 画点 */</span></span><br><span class="line">				glPoints( x, y );</span><br><span class="line">				<span class="comment">/* 设置当前颜色RGB，如果取色有变动，以最后的取色为准 */</span></span><br><span class="line">				polygons[con].color[<span class="number">0</span>]	= nowColor[<span class="number">0</span>];</span><br><span class="line">				polygons[con].color[<span class="number">1</span>]	= nowColor[<span class="number">1</span>];</span><br><span class="line">				polygons[con].color[<span class="number">2</span>]	= nowColor[<span class="number">2</span>];</span><br><span class="line">				<span class="built_in">printf</span>( <span class="string">"polyColor%d%d%d\n"</span>, polygons[con].color[<span class="number">0</span>], polygons[con].color[<span class="number">1</span>], polygons[con].color[<span class="number">2</span>] );</span><br><span class="line">				polygons[con].verNum++;</span><br><span class="line">				<span class="built_in">printf</span>( <span class="string">"con:%d,verNum:%d\n"</span>, con, polygons[con].verNum );</span><br><span class="line">			&#125;<span class="keyword">else</span> <span class="keyword">if</span> ( drawStatus == <span class="number">2</span> )</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">/* 删除图形 */</span></span><br><span class="line">				deletePoly( x, y );</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> ( drawStatus == <span class="number">3</span> )</span><br><span class="line">			&#123;</span><br><span class="line">				moveNum = <span class="number">-1</span>;</span><br><span class="line">				<span class="keyword">for</span> ( <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; con; i++ )</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">if</span> ( pointInPoly( polygons[i], x, y ) )</span><br><span class="line">					&#123;</span><br><span class="line">						moveNum = i;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 鼠标移动事件 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mouseMove</span><span class="params">( <span class="keyword">int</span> x, <span class="keyword">int</span> y )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> ( drawStatus == <span class="number">3</span> &amp;&amp; moveNum != <span class="number">-1</span> )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>( <span class="string">"move x:%d,y:%dmoveNum:%d\n"</span>, x, y, moveNum );</span><br><span class="line">		movePoly( x, y );</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*程序入口 */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">( <span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[] )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">/* 对GLUT进行初始化，并处理所有的命令行参数 */</span></span><br><span class="line">	glutInit( &amp;argc, argv );</span><br><span class="line">	<span class="comment">/* 指定RGB颜色模式和单缓冲窗口 */</span></span><br><span class="line">	glutInitDisplayMode( GLUT_RGB | GLUT_SINGLE );</span><br><span class="line">	<span class="comment">/* 定义窗口的位置 */</span></span><br><span class="line">	glutInitWindowPosition( <span class="number">100</span>, <span class="number">100</span> );</span><br><span class="line">	<span class="comment">/* 定义窗口的大小 */</span></span><br><span class="line">	glutInitWindowSize( <span class="number">600</span>, <span class="number">600</span> );</span><br><span class="line">	<span class="comment">/* 创建窗口，同时为之命名 */</span></span><br><span class="line">	glutCreateWindow( <span class="string">"OpenGL"</span> );</span><br><span class="line">	<span class="comment">/* 设置窗口清除颜色为白色 */</span></span><br><span class="line">	glClearColor( <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span> );</span><br><span class="line">	<span class="comment">/* 参数为一个函数，绘图时这个函数就会被调用 */</span></span><br><span class="line">	glutDisplayFunc( &amp;<span class="built_in">display</span> );</span><br><span class="line">	<span class="comment">/* 参数为一个函数，当窗口大小改变时会被调用 */</span></span><br><span class="line">	glutReshapeFunc( ChangeSize );</span><br><span class="line">	<span class="comment">/*鼠标点击事件，鼠标点击或者松开时调用 */</span></span><br><span class="line">	glutMouseFunc( mouseClick );</span><br><span class="line">	<span class="comment">/*鼠标移动事件，鼠标按下并移动时调用 */</span></span><br><span class="line">	glutMotionFunc( mouseMove );</span><br><span class="line">	<span class="comment">/* 该函数让GLUT框架开始运行，所有设置的回调函数开始工作，直到用户终止程序为止 */</span></span><br><span class="line">	glutMainLoop();</span><br><span class="line">	<span class="comment">/*程序返回 */</span></span><br><span class="line">	<span class="keyword">return</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上，就可以实现图形的移动和删除了。</p>
                  <h2 id="存盘和读盘"><a href="#存盘和读盘" class="headerlink" title="存盘和读盘"></a>存盘和读盘</h2>
                  <p>这个很简单，存盘我们只需要把所有图形的位置以及颜色输出到一个文本中，然后在读盘时，把文本中所有内容读入并存储到多边形结构体数组中，然后重新绘制即可。 代码的讲解直接写在注释中，比较好理解</p>
                  <figure class="highlight mipsasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 保存所有的图形 */</span></span><br><span class="line">void savePolygons()</span><br><span class="line">&#123;</span><br><span class="line">	FILE *<span class="built_in">fp</span>;</span><br><span class="line">	int i;</span><br><span class="line">	if ((<span class="built_in">fp</span> = fopen(<span class="string">"shapes.txt"</span>, <span class="string">"w"</span>)) == NULL)</span><br><span class="line">	&#123;</span><br><span class="line">		printf(<span class="string">"不能打开文件!"</span>);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* 保存一共多少个图形 */</span></span><br><span class="line">	fprintf(<span class="built_in">fp</span>, <span class="string">"%d"</span>, con);</span><br><span class="line">	fprintf(<span class="built_in">fp</span>, <span class="string">"\n"</span>);</span><br><span class="line">	for (i = <span class="number">0</span><span class="comment">; i &lt; con; i++)&#123;</span></span><br><span class="line">		<span class="comment">/* 保存颜色值 */</span></span><br><span class="line">		fprintf(<span class="built_in">fp</span>, <span class="string">"%d %d %d "</span>, polygons[i].color[<span class="number">0</span>], polygons[i].color[<span class="number">1</span>], polygons[i].color[<span class="number">2</span>]);</span><br><span class="line">		<span class="comment">/* 保存顶点数量 */</span></span><br><span class="line">		fprintf(<span class="built_in">fp</span>, <span class="string">"%d "</span>, polygons[i].verNum);</span><br><span class="line">		<span class="comment">/* 保存顶点坐标 */</span></span><br><span class="line">		for (int <span class="keyword">j </span>= <span class="number">0</span><span class="comment">; j &lt; polygons[i].verNum; j++)</span></span><br><span class="line">			fprintf(<span class="built_in">fp</span>, <span class="string">"%d "</span>, polygons[i].x[<span class="keyword">j]);</span></span><br><span class="line"><span class="keyword">	</span>	for (int <span class="keyword">j </span>= <span class="number">0</span><span class="comment">; j &lt; polygons[i].verNum; j++)</span></span><br><span class="line">			fprintf(<span class="built_in">fp</span>, <span class="string">"%d "</span>, polygons[i].y[<span class="keyword">j]);</span></span><br><span class="line"><span class="keyword">	</span>	fprintf(<span class="built_in">fp</span>, <span class="string">"\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	fclose(<span class="built_in">fp</span>);</span><br><span class="line">	printf(<span class="string">"保存成功。\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 读取存档 */</span></span><br><span class="line">void readPolygons()</span><br><span class="line">&#123;</span><br><span class="line">	FILE *<span class="built_in">fp</span>;</span><br><span class="line">	int i;</span><br><span class="line">	if ((<span class="built_in">fp</span> = fopen(<span class="string">"shapes.txt"</span>, <span class="string">"r"</span>)) == NULL)</span><br><span class="line">	&#123;</span><br><span class="line">		printf(<span class="string">"不能打开文件!"</span>);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	fscanf(<span class="built_in">fp</span>, <span class="string">"%d"</span>, &amp;con);</span><br><span class="line">	printf(<span class="string">"count%d"</span>,con);</span><br><span class="line">	fscanf(<span class="built_in">fp</span>, <span class="string">"\n"</span>);</span><br><span class="line">	for (i = <span class="number">0</span><span class="comment">; i &lt; con; i++)&#123;</span></span><br><span class="line">		<span class="comment">/* 读取颜色值 */</span></span><br><span class="line">		fscanf(<span class="built_in">fp</span>, <span class="string">"%d %d %d "</span>, &amp;polygons[i].color[<span class="number">0</span>], &amp;polygons[i].color[<span class="number">1</span>], &amp;polygons[i].color[<span class="number">2</span>]);</span><br><span class="line">		<span class="comment">/* 读取顶点数量 */</span></span><br><span class="line">		fscanf(<span class="built_in">fp</span>, <span class="string">"%d "</span>, &amp;polygons[i].verNum);</span><br><span class="line">		<span class="comment">/* 读取顶点坐标 */</span></span><br><span class="line">		for (int <span class="keyword">j </span>= <span class="number">0</span><span class="comment">; j &lt; polygons[i].verNum; j++)</span></span><br><span class="line">			fscanf(<span class="built_in">fp</span>, <span class="string">"%d "</span>, &amp;polygons[i].x[<span class="keyword">j]);</span></span><br><span class="line"><span class="keyword">	</span>	for (int <span class="keyword">j </span>= <span class="number">0</span><span class="comment">; j &lt; polygons[i].verNum; j++)</span></span><br><span class="line">			fscanf(<span class="built_in">fp</span>, <span class="string">"%d "</span>, &amp;polygons[i].y[<span class="keyword">j]);</span></span><br><span class="line"><span class="keyword">	</span>	fscanf(<span class="built_in">fp</span>, <span class="string">"\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	fclose(<span class="built_in">fp</span>);</span><br><span class="line">	printf(<span class="string">"读取成功。\n"</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们只需要再定义两个按钮，再 display 中画上这俩按钮</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">GLubyte storeBtn[<span class="number">3</span>] = &#123;<span class="number">50</span>, <span class="number">50</span>, <span class="number">50</span>&#125;;</span><br><span class="line">GLubyte loadBtn[<span class="number">3</span>] = &#123;<span class="number">55</span>, <span class="number">55</span>, <span class="number">55</span>&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后把 mouseClick 方法改写一下就好了。最终 mouseClick 方法如下</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 鼠标点击事件 */</span></span><br><span class="line">void mouse<span class="constructor">Click( <span class="params">int</span> <span class="params">btn</span>, <span class="params">int</span> <span class="params">state</span>, <span class="params">int</span> <span class="params">x</span>, <span class="params">int</span> <span class="params">y</span> )</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 赋值全局变量 */</span></span><br><span class="line">	clickX	= x;</span><br><span class="line">	clickY	= y;</span><br><span class="line">	<span class="comment">/* 选项卡的分界范围 */</span></span><br><span class="line">	<span class="built_in">int</span>	optionHeight	= <span class="number">40</span>;</span><br><span class="line">	<span class="built_in">int</span>	optionWidth	= <span class="number">250</span>;</span><br><span class="line">	<span class="keyword">if</span> ( btn<span class="operator"> == </span>GLUT_LEFT_BUTTON<span class="operator"> &amp;&amp; </span>state<span class="operator"> == </span>GLUT_DOWN )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/* 如果在颜色选项卡中点击 */</span></span><br><span class="line">		<span class="keyword">if</span> ( y &lt; optionHeight<span class="operator"> &amp;&amp; </span>x &lt; optionWidth )</span><br><span class="line">		&#123;</span><br><span class="line">			gl<span class="constructor">ReadPixels( <span class="params">x</span>, 2 <span class="operator">*</span> <span class="params">halfHeight</span> - <span class="params">y</span>, 1, 1, GL_RGB, GL_UNSIGNED_BYTE, &amp;<span class="params">nowColor</span> )</span>;</span><br><span class="line">			<span class="comment">/* 设置绘图颜色并显示当前取色板颜色 */</span></span><br><span class="line">			gl<span class="constructor">ColorCircle( -180, 280, 10, <span class="params">nowColor</span> )</span>;</span><br><span class="line">			<span class="comment">/* 如果点击的是右侧选项按钮 */</span></span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span> ( y &lt; optionHeight<span class="operator"> &amp;&amp; </span>x &gt; optionWidth )</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">/* 取当前的点 */</span></span><br><span class="line">			GLubyte color<span class="literal">[<span class="number">3</span>]</span>;</span><br><span class="line">			gl<span class="constructor">ReadPixels( <span class="params">x</span>, 2 <span class="operator">*</span> <span class="params">halfHeight</span> - <span class="params">y</span>, 1, 1, GL_RGB, GL_UNSIGNED_BYTE, &amp;<span class="params">color</span> )</span>;</span><br><span class="line">			<span class="comment">/* 如果点击了开始绘制的按钮 */</span></span><br><span class="line">			<span class="keyword">if</span> ( same<span class="constructor">Color( <span class="params">color</span>, <span class="params">startBtn</span> )</span> )</span><br><span class="line">			&#123;</span><br><span class="line">				drawStatus = <span class="number">0</span>;</span><br><span class="line">				<span class="comment">/* 开始画一个图形，顶点个数置零 */</span></span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.verNum = <span class="number">0</span>;</span><br><span class="line">				<span class="comment">/* 如果点击了结束绘制的按钮 */</span></span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> ( same<span class="constructor">Color( <span class="params">color</span>, <span class="params">endBtn</span> )</span> )</span><br><span class="line">			&#123;</span><br><span class="line">				glut<span class="constructor">PostRedisplay()</span>;</span><br><span class="line">				<span class="comment">/* 画的图形个数加一 */</span></span><br><span class="line">				con++;</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> ( same<span class="constructor">Color( <span class="params">color</span>, <span class="params">delBtn</span> )</span> )</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">/* 删除时设置drawStatus为2 */</span></span><br><span class="line">				drawStatus = <span class="number">2</span>;</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> ( same<span class="constructor">Color( <span class="params">color</span>, <span class="params">moveBtn</span> )</span> )</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">/* 移动时设置drawStatus为3 */</span></span><br><span class="line">				drawStatus = <span class="number">3</span>;</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> ( same<span class="constructor">Color( <span class="params">color</span>, <span class="params">storeBtn</span> )</span> )</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">/* 存盘时设置drawStatus为4 */</span></span><br><span class="line">				drawStatus = <span class="number">4</span>;</span><br><span class="line">				glut<span class="constructor">PostRedisplay()</span>;</span><br><span class="line">				save<span class="constructor">Polygons()</span>;</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> ( same<span class="constructor">Color( <span class="params">color</span>, <span class="params">loadBtn</span> )</span> )</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">/* 读盘时设置drawStatus为5 */</span></span><br><span class="line">				drawStatus = <span class="number">5</span>;</span><br><span class="line">				read<span class="constructor">Polygons()</span>;</span><br><span class="line">				glut<span class="constructor">PostRedisplay()</span>;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">/* 如果点击的是下方的绘图页面 */</span></span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">/* 如果当前是正在取点状态 */</span></span><br><span class="line">			<span class="keyword">if</span> ( drawStatus<span class="operator"> == </span><span class="number">0</span> )</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">/* 保存每个点，然后该图形顶点个数加一 */</span></span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.x<span class="literal">[<span class="identifier">polygons</span>[<span class="identifier">con</span>]</span>.verNum]	= x;</span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.y<span class="literal">[<span class="identifier">polygons</span>[<span class="identifier">con</span>]</span>.verNum]	= y;</span><br><span class="line">				<span class="comment">/* 画点 */</span></span><br><span class="line">				gl<span class="constructor">Points( <span class="params">x</span>, <span class="params">y</span> )</span>;</span><br><span class="line">				<span class="comment">/* 设置当前颜色RGB，如果取色有变动，以最后的取色为准 */</span></span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">0</span>]</span>	= nowColor<span class="literal">[<span class="number">0</span>]</span>;</span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">1</span>]</span>	= nowColor<span class="literal">[<span class="number">1</span>]</span>;</span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">2</span>]</span>	= nowColor<span class="literal">[<span class="number">2</span>]</span>;</span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.verNum++;</span><br><span class="line">			&#125;<span class="keyword">else</span> <span class="keyword">if</span> ( drawStatus<span class="operator"> == </span><span class="number">2</span> )</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">/* 删除图形 */</span></span><br><span class="line">				delete<span class="constructor">Poly( <span class="params">x</span>, <span class="params">y</span> )</span>;</span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> ( drawStatus<span class="operator"> == </span><span class="number">3</span> )</span><br><span class="line">			&#123;</span><br><span class="line">				moveNum = -<span class="number">1</span>;</span><br><span class="line">				for ( <span class="built_in">int</span> i = <span class="number">0</span>; i &lt; con; i++ )</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">if</span> ( point<span class="constructor">InPoly( <span class="params">polygons</span>[<span class="params">i</span>], <span class="params">x</span>, <span class="params">y</span> )</span> )</span><br><span class="line">					&#123;</span><br><span class="line">						moveNum = i;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>大功告成！现在只要你存盘成功，不管对图形进行怎样的移动，删除操作。只要再点击读盘，就可以恢复到存盘时的状态，是不是非常酷炫。 大家可以尝试一下！</p>
                  <h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2>
                  <p>本篇文章说明了图形的删除，移动以及存盘读盘的功能。代码实现仅仅是我个人的思路，当然实现方式不止这一种，欢迎大家创新。 部分思路如果大家有更好的解决方法，欢迎同我交流，非常感谢。 总之希望对大家有帮助！小伙伴们加油！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-05-11 13:48:05" itemprop="dateCreated datePublished" datetime="2015-05-11T13:48:05+08:00">2015-05-11</time>
                </span>
                <span id="/1802.html" class="post-meta-item leancloud_visitors" data-flag-title="OpenGL绘图实例八之图形的移动删除存盘" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>22k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>20 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1783.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> C/C++ <i class="label-arrow"></i>
                  </a>
                  <a href="/1783.html" class="post-title-link" itemprop="url">OpenGL绘图实例七之鼠标设色取点绘图</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>在上一节我们学习了鼠标监听事件，在这里我们就利用它来做一个实例，对鼠标监听事件进行一个综合的应用。</p>
                  <h2 id="要求"><a href="#要求" class="headerlink" title="要求"></a>要求</h2>
                  <p>1. 绘制如下的机器人，并在此基础上进行创作 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/图片1.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/图片1.png" alt="图片1"></a> 2. 对象创建：支持用户利用鼠标指定各个顶点位置，补充完整机器人的腿部。 3. 对象删除：支持用户选择一个腿部的多边形（与你的多边形保存的数据结构有关）并删除。 4. 对象存储：设计一种数据结构存储每个多边形的顶点与边，支持文件存盘，并支持读盘复原。 5. 支持用户选择多边形的颜色，支持用户移动多边形</p>
                  <h2 id="成果"><a href="#成果" class="headerlink" title="成果"></a>成果</h2>
                  <p>在这里为了动态演示，将我的成果以视频形式演示如下</p>
                  <p>[embed]<a href="http://cdn.cuiqingcai.com/robot.mp4[/embed" target="_blank" rel="noopener">http://cdn.cuiqingcai.com/robot.mp4[/embed</a>]</p>
                  <p>好，欣赏完视频之后是不是非常想知道是怎样实现的呢？下面我们来一步一步进行讲解。</p>
                  <h2 id="绘制半机器人"><a href="#绘制半机器人" class="headerlink" title="绘制半机器人"></a>绘制半机器人</h2>
                  <p>在前面的几篇中，已经详细描述了绘制机器人的方法，在这里我们简单贴一下代码来绘制一个半机器人。 直接上代码吧，不多说了</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">#include &lt;glut.h&gt;</span><br><span class="line">#include &lt;math.h&gt;</span><br><span class="line">#define PI <span class="number">3.1415926</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 画矩形，传入的是左下角XY坐标和右上角XY坐标 */</span></span><br><span class="line"><span class="built_in">void</span> glRect( <span class="built_in">int</span> leftX, <span class="built_in">int</span> leftY, <span class="built_in">int</span> rightX, <span class="built_in">int</span> rightY )</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 画封闭曲线 */</span></span><br><span class="line">	glBegin( GL_LINE_LOOP );</span><br><span class="line">	<span class="comment">/* 左下角 */</span></span><br><span class="line">	glVertex2d( leftX, leftY );</span><br><span class="line">	<span class="comment">/* 右下角 */</span></span><br><span class="line">	glVertex2d( rightX, leftY );</span><br><span class="line">	<span class="comment">/* 右上角 */</span></span><br><span class="line">	glVertex2d( rightX, rightY );</span><br><span class="line">	<span class="comment">/* 左上角 */</span></span><br><span class="line">	glVertex2d( leftX, rightY );</span><br><span class="line">	<span class="comment">/* 结束画线 */</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 画圆角矩形，传入矩形宽高，角半径，矩形中心点坐标 */</span></span><br><span class="line"><span class="built_in">void</span> glRoundRec( <span class="built_in">int</span> centerX, <span class="built_in">int</span> centerY, <span class="built_in">int</span> width, <span class="built_in">int</span> height, <span class="built_in">float</span> cirR )</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 二分之PI，一个象限的角度 */</span></span><br><span class="line">	<span class="built_in">float</span> PI_HALF = PI / <span class="number">2</span>;</span><br><span class="line">	<span class="comment">/* 划分程度,值越大画得越精细 */</span></span><br><span class="line">	<span class="built_in">float</span> divide = <span class="number">20.0</span>;</span><br><span class="line">	<span class="comment">/* 圆角矩形的坐标 */</span></span><br><span class="line">	<span class="built_in">float</span> tx, ty;</span><br><span class="line">	<span class="comment">/* 画封闭曲线 */</span></span><br><span class="line">	glBegin( GL_LINE_LOOP );</span><br><span class="line">	<span class="comment">/* 四个象限不同的操作符 */</span></span><br><span class="line">	<span class="built_in">int</span>	opX[<span class="number">4</span>]	= &#123; <span class="number">1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">1</span> &#125;;</span><br><span class="line">	<span class="built_in">int</span>	opY[<span class="number">4</span>]	= &#123; <span class="number">1</span>, <span class="number">1</span>, <span class="number">-1</span>, <span class="number">-1</span> &#125;;</span><br><span class="line">	<span class="comment">/* 用来计数，从第一象限到第四象限 */</span></span><br><span class="line">	<span class="built_in">float</span> x = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">/* x自增时加的值 */</span></span><br><span class="line">	<span class="built_in">float</span> part = <span class="number">1</span> / divide;</span><br><span class="line">	<span class="comment">/* 计算内矩形宽高一半的数值 */</span></span><br><span class="line">	<span class="built_in">int</span>	w	= width / <span class="number">2</span> - cirR;</span><br><span class="line">	<span class="built_in">int</span>	h	= height / <span class="number">2</span> - cirR;</span><br><span class="line">	<span class="comment">/* 循环画线 */</span></span><br><span class="line">	<span class="keyword">for</span> ( x = <span class="number">0</span>; x &lt; <span class="number">4</span>; x += part )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/* 求出弧度 */</span></span><br><span class="line">		<span class="built_in">float</span> rad = PI_HALF * x;</span><br><span class="line">		<span class="comment">/* 计算坐标值 */</span></span><br><span class="line">		tx	= cirR * cos( rad ) + opX[(<span class="built_in">int</span>) x] * w + centerX;</span><br><span class="line">		ty	= cirR * sin( rad ) + opY[(<span class="built_in">int</span>) x] * h + centerY;</span><br><span class="line">		<span class="comment">/*传入坐标画线 */</span></span><br><span class="line">		glVertex2f( tx, ty );</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* 结束画线 */</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 画弧线，相对偏移量XY，开始的弧度，结束的弧度，半径 */</span></span><br><span class="line"><span class="built_in">void</span> glArc( <span class="built_in">double</span> x, <span class="built_in">double</span> y, <span class="built_in">double</span> start_angle, <span class="built_in">double</span> end_angle, <span class="built_in">double</span> radius )</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 开始绘制曲线 */</span></span><br><span class="line">	glBegin( GL_LINE_STRIP );</span><br><span class="line">	<span class="comment">/* 每次画增加的弧度 */</span></span><br><span class="line">	<span class="built_in">double</span> delta_angle = PI / <span class="number">180</span>;</span><br><span class="line">	<span class="comment">/* 画圆弧 */</span></span><br><span class="line">	<span class="keyword">for</span> ( <span class="built_in">double</span> i = start_angle; i &lt;= end_angle; i += delta_angle )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/* 绝对定位加三角函数值 */</span></span><br><span class="line">		<span class="built_in">double</span>	vx	= x + radius * cos( i );</span><br><span class="line">		<span class="built_in">double</span>	vy	= y + radius*sin( i );</span><br><span class="line">		glVertex2d( vx, vy );</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* 结束绘画 */</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 画圆 */</span></span><br><span class="line"><span class="built_in">void</span> glCircle( <span class="built_in">double</span> x, <span class="built_in">double</span> y, <span class="built_in">double</span> radius )</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 画全圆 */</span></span><br><span class="line">	glArc( x, y, <span class="number">0</span>, <span class="number">2</span> * PI, radius );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 画三角形，传入三个点的坐标 */</span></span><br><span class="line"><span class="built_in">void</span> glTri( <span class="built_in">int</span> x1, <span class="built_in">int</span> y1, <span class="built_in">int</span> x2, <span class="built_in">int</span> y2, <span class="built_in">int</span> x3, <span class="built_in">int</span> y3 )</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 画封闭线 */</span></span><br><span class="line">	glBegin( GL_LINE_LOOP );</span><br><span class="line">	<span class="comment">/* 一点 */</span></span><br><span class="line">	glVertex2d( x1, y1 );</span><br><span class="line">	<span class="comment">/* 二点 */</span></span><br><span class="line">	glVertex2d( x2, y2 );</span><br><span class="line">	<span class="comment">/*三点 */</span></span><br><span class="line">	glVertex2d( x3, y3 );</span><br><span class="line">	<span class="comment">/* 结束画线 */</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 画线，传入两点坐标 */</span></span><br><span class="line"><span class="built_in">void</span> glLine( <span class="built_in">int</span> x1, <span class="built_in">int</span> y1, <span class="built_in">int</span> x2, <span class="built_in">int</span> y2 )</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 画封闭线 */</span></span><br><span class="line">	glBegin( GL_LINE_STRIP );</span><br><span class="line">	<span class="comment">/* 一点 */</span></span><br><span class="line">	glVertex2d( x1, y1 );</span><br><span class="line">	<span class="comment">/* 二点 */</span></span><br><span class="line">	glVertex2d( x2, y2 );</span><br><span class="line">	<span class="comment">/* 结束画线 */</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 函数用来画图 */</span></span><br><span class="line"><span class="built_in">void</span> display( <span class="built_in">void</span> )</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* GL_COLOR_BUFFER_BIT表示清除颜色 */</span></span><br><span class="line">	glClear( GL_COLOR_BUFFER_BIT );</span><br><span class="line">	<span class="comment">/* 设置画线颜色 */</span></span><br><span class="line">	glColor3f( <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0.5</span> );</span><br><span class="line">	<span class="comment">/* 画点大小 */</span></span><br><span class="line">	glPointSize( <span class="number">2</span> );</span><br><span class="line">	<span class="comment">/* 画圆角矩形，大肚子 */</span></span><br><span class="line">	glRoundRec( <span class="number">0</span>, <span class="number">0</span>, <span class="number">146</span>, <span class="number">120</span>, <span class="number">15</span> );</span><br><span class="line">	<span class="comment">/* 画圆，中间小圈 */</span></span><br><span class="line">	glCircle( <span class="number">0</span>, <span class="number">0</span>, <span class="number">10</span> );</span><br><span class="line">	<span class="comment">/* 画矩形，脖子 */</span></span><br><span class="line">	glRect( <span class="number">-25</span>, <span class="number">60</span>, <span class="number">25</span>, <span class="number">76</span> );</span><br><span class="line">	<span class="comment">/* 画圆角矩形，大脸 */</span></span><br><span class="line">	glRoundRec( <span class="number">0</span>, <span class="number">113</span>, <span class="number">128</span>, <span class="number">74</span>, <span class="number">10</span> );</span><br><span class="line">	<span class="comment">/* 两个眼睛 */</span></span><br><span class="line">	glCircle( <span class="number">-30</span>, <span class="number">111</span>, <span class="number">10</span> );</span><br><span class="line">	glCircle( <span class="number">30</span>, <span class="number">111</span>, <span class="number">10</span> );</span><br><span class="line">	<span class="comment">/* 两条天线 */</span></span><br><span class="line">	glLine( <span class="number">-35</span>, <span class="number">150</span>, <span class="number">-35</span>, <span class="number">173</span> );</span><br><span class="line">	glLine( <span class="number">35</span>, <span class="number">150</span>, <span class="number">35</span>, <span class="number">173</span> );</span><br><span class="line">	<span class="comment">/* 圆角矩形，两个耳朵 */</span></span><br><span class="line">	glRoundRec( <span class="number">81</span>, <span class="number">115</span>, <span class="number">20</span>, <span class="number">34</span>, <span class="number">5</span> );</span><br><span class="line">	glRoundRec( <span class="number">-81</span>, <span class="number">115</span>, <span class="number">20</span>, <span class="number">34</span>, <span class="number">5</span> );</span><br><span class="line">	<span class="comment">/* 圆弧，画嘴 */</span></span><br><span class="line">	glArc( <span class="number">0</span>, <span class="number">133</span>, <span class="number">11</span> * PI / <span class="number">8</span>, <span class="number">13</span> * PI / <span class="number">8</span>, <span class="number">45</span> );</span><br><span class="line">	<span class="comment">/* 画三角，肚子里的三角 */</span></span><br><span class="line">	glTri( <span class="number">-30</span>, <span class="number">-15</span>, <span class="number">30</span>, <span class="number">-15</span>, <span class="number">0</span>, <span class="number">28</span> );</span><br><span class="line">	<span class="comment">/* 画矩形，胳膊连接处 */</span></span><br><span class="line">	glRect( <span class="number">-81</span>, <span class="number">43</span>, <span class="number">-73</span>, <span class="number">25</span> );</span><br><span class="line">	glRect( <span class="number">81</span>, <span class="number">43</span>, <span class="number">73</span>, <span class="number">25</span> );</span><br><span class="line">	<span class="comment">/* 画矩形，上臂 */</span></span><br><span class="line">	glRect( <span class="number">-108</span>, <span class="number">45</span>, <span class="number">-81</span>, <span class="number">0</span> );</span><br><span class="line">	glRect( <span class="number">108</span>, <span class="number">45</span>, <span class="number">81</span>, <span class="number">0</span> );</span><br><span class="line">	<span class="comment">/* 画矩形，中臂 */</span></span><br><span class="line">	glRect( <span class="number">-101</span>, <span class="number">0</span>, <span class="number">-88</span>, <span class="number">-4</span> );</span><br><span class="line">	glRect( <span class="number">101</span>, <span class="number">0</span>, <span class="number">88</span>, <span class="number">-4</span> );</span><br><span class="line">	<span class="comment">/* 画矩形，下臂 */</span></span><br><span class="line">	glRect( <span class="number">-108</span>, <span class="number">-4</span>, <span class="number">-81</span>, <span class="number">-37</span> );</span><br><span class="line">	glRect( <span class="number">108</span>, <span class="number">-4</span>, <span class="number">81</span>, <span class="number">-37</span> );</span><br><span class="line">	<span class="comment">/* 画圆形，手掌 */</span></span><br><span class="line">	glCircle( <span class="number">-95</span>, <span class="number">-47</span>, <span class="number">10</span> );</span><br><span class="line">	glCircle( <span class="number">95</span>, <span class="number">-47</span>, <span class="number">10</span> );</span><br><span class="line">	<span class="comment">/* 保证前面的OpenGL命令立即执行，而不是让它们在缓冲区中等待 */</span></span><br><span class="line">	glFlush();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 窗口大小变化时调用的函数 */</span></span><br><span class="line"><span class="built_in">void</span> ChangeSize( GLsizei w, GLsizei h )</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 避免高度为0 */</span></span><br><span class="line">	<span class="keyword">if</span> ( h == <span class="number">0</span> )</span><br><span class="line">	&#123;</span><br><span class="line">		h = <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* 定义视口大小，宽高一致 */</span></span><br><span class="line">	glViewport( <span class="number">0</span>, <span class="number">0</span>, w, h );</span><br><span class="line">	<span class="built_in">int</span> half = <span class="number">300</span>;</span><br><span class="line">	<span class="comment">/* 重置坐标系统，使投影变换复位 */</span></span><br><span class="line">	glMatrixMode( GL_PROJECTION );</span><br><span class="line">	<span class="comment">/* 将当前的用户坐标系的原点移到了屏幕中心 */</span></span><br><span class="line">	glLoadIdentity();</span><br><span class="line">	<span class="comment">/* 定义正交视域体 */</span></span><br><span class="line">	<span class="keyword">if</span> ( w &lt; h )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/* 如果高度大于宽度，则将高度视角扩大，图形显示居中 */</span></span><br><span class="line">		glOrtho( -half, half, -half * h / w, half * h / w, -half, half );</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">/* 如果宽度大于高度，则将宽度视角扩大，图形显示居中 */</span></span><br><span class="line">		glOrtho( -half * w / h, half * w / h, -half, half, -half, half );</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*程序入口 */</span></span><br><span class="line"><span class="built_in">int</span> main( <span class="built_in">int</span> argc, char *argv[] )</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 对GLUT进行初始化，并处理所有的命令行参数 */</span></span><br><span class="line">	glutInit( &amp;argc, argv );</span><br><span class="line">	<span class="comment">/* 指定RGB颜色模式和单缓冲窗口 */</span></span><br><span class="line">	glutInitDisplayMode( GLUT_RGB | GLUT_SINGLE );</span><br><span class="line">	<span class="comment">/* 定义窗口的位置 */</span></span><br><span class="line">	glutInitWindowPosition( <span class="number">100</span>, <span class="number">100</span> );</span><br><span class="line">	<span class="comment">/* 定义窗口的大小 */</span></span><br><span class="line">	glutInitWindowSize( <span class="number">600</span>, <span class="number">600</span> );</span><br><span class="line">	<span class="comment">/* 创建窗口，同时为之命名 */</span></span><br><span class="line">	glutCreateWindow( <span class="string">"OpenGL"</span> );</span><br><span class="line">	<span class="comment">/* 设置窗口清除颜色为白色 */</span></span><br><span class="line">	glClearColor( <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span>, <span class="number">1.0f</span> );</span><br><span class="line">	<span class="comment">/* 参数为一个函数，绘图时这个函数就会被调用 */</span></span><br><span class="line">	glutDisplayFunc( &amp;display );</span><br><span class="line">	<span class="comment">/* 参数为一个函数，当窗口大小改变时会被调用 */</span></span><br><span class="line">	glutReshapeFunc( ChangeSize );</span><br><span class="line">	<span class="comment">/* 该函数让GLUT框架开始运行，所有设置的回调函数开始工作，直到用户终止程序为止 */</span></span><br><span class="line">	glutMainLoop();</span><br><span class="line">	<span class="comment">/*程序返回 */</span></span><br><span class="line">	<span class="keyword">return</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/20150511002257.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/20150511002257.jpg" alt="20150511002257"></a> 这一步非常非常简单，如果有不懂的小伙伴请参见 <a href="http://cuiqingcai.com/1597.html">此文章</a>。</p>
                  <h2 id="对象创建"><a href="#对象创建" class="headerlink" title="对象创建"></a>对象创建</h2>
                  <p>通过上面的一步，我们已经可以轻松地绘制出一个半身机器人，接下来我们就要通过监听鼠标事件来实现动态多边形的绘制了。 因为实验要求中要求了多边形的颜色绘制，所以颜色怎么选取呢？我是这么想的，在面板的左上角绘制几个色块，通过鼠标点击这几个色块，读取出 RGB 值，然后相应地设置当前绘图的颜色即可。 所以首先我在左上角定义了几个颜色色块，同时监听鼠标事件。 首先定义几个颜色的 RGB 值</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 各种颜色 */</span></span><br><span class="line">GLubyte border[<span class="number">3</span>] = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">GLubyte grey[<span class="number">3</span>] = &#123;<span class="number">195</span>, <span class="number">195</span>, <span class="number">195</span>&#125;;</span><br><span class="line">GLubyte yellow[<span class="number">3</span>] = &#123;<span class="number">255</span>, <span class="number">243</span>, <span class="number">0</span>&#125;;</span><br><span class="line">GLubyte red[<span class="number">3</span>] = &#123;<span class="number">237</span>, <span class="number">28</span>, <span class="number">36</span>&#125;;</span><br><span class="line">GLubyte darkGrey[<span class="number">3</span>] = &#123;<span class="number">126</span>, <span class="number">126</span>, <span class="number">126</span>&#125;;</span><br><span class="line">GLubyte white[<span class="number">3</span>] = &#123;<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>&#125;;</span><br><span class="line"><span class="comment">/* 当前颜色 */</span></span><br><span class="line">GLubyte nowColor[<span class="number">3</span>] = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后定义一个绘制填充色的圆形的方法</p>
                  <figure class="highlight processing">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 绘制填充的圆形 */</span></span><br><span class="line"><span class="keyword">void</span> glColorCircle(<span class="built_in">int</span> x, <span class="built_in">int</span> y, <span class="built_in">int</span> R, GLubyte <span class="built_in">color</span>[<span class="number">3</span>])</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 开始绘制曲线 */</span></span><br><span class="line">	glBegin(GL_POLYGON);</span><br><span class="line">	<span class="comment">/* 设置颜色 */</span></span><br><span class="line">	glColor3ub(<span class="built_in">color</span>[<span class="number">0</span>], <span class="built_in">color</span>[<span class="number">1</span>], <span class="built_in">color</span>[<span class="number">2</span>]);</span><br><span class="line">	<span class="comment">/* 每次画增加的弧度 */</span></span><br><span class="line">	<span class="keyword">double</span> delta_angle = <span class="literal">PI</span> / <span class="number">180</span>;</span><br><span class="line">	<span class="comment">/* 画圆弧 */</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">double</span> i = <span class="number">0</span>; i &lt;= <span class="number">2</span> * <span class="literal">PI</span>; i += delta_angle)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/* 绝对定位加三角函数值 */</span></span><br><span class="line">		<span class="keyword">double</span>	vx	= x + R * <span class="built_in">cos</span>(i);</span><br><span class="line">		<span class="keyword">double</span>	vy	= y + R*<span class="built_in">sin</span>(i);</span><br><span class="line">		glVertex2d(vx, vy);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* 结束绘画 */</span></span><br><span class="line">	glEnd();</span><br><span class="line">	glFlush();</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>那么在 display 函数中，我们就可以调用下面的方法来绘制三个取色盘拾取颜色，其中最后一个取色盘保存了当前的颜色。</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 绘制取色盘 */</span></span><br><span class="line">glColorCircle(<span class="number">-280</span>, <span class="number">280</span>, <span class="number">10</span>, red);</span><br><span class="line">glColorCircle(<span class="number">-250</span>, <span class="number">280</span>, <span class="number">10</span>, yellow);</span><br><span class="line">glColorCircle(<span class="number">-220</span>, <span class="number">280</span>, <span class="number">10</span>, grey);</span><br><span class="line">glColorCircle(<span class="number">-180</span>, <span class="number">280</span>, <span class="number">10</span>, nowColor);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样光有了取色盘可不行，需要有鼠标点击事动态地改变取色的色值。现在我们可以加入鼠标监听方法如下 通过上一节的说明，我们定义一个 mouseClick 事件</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/*鼠标点击事件 */</span></span><br><span class="line">void mouse<span class="constructor">Click(<span class="params">int</span> <span class="params">btn</span>, <span class="params">int</span> <span class="params">state</span>, <span class="params">int</span> <span class="params">x</span>, <span class="params">int</span> <span class="params">y</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 选项卡的分界范围 */</span></span><br><span class="line">	<span class="built_in">int</span> optionHeight = <span class="number">40</span>;</span><br><span class="line">	<span class="built_in">int</span> optionWidth = <span class="number">250</span>;</span><br><span class="line">	<span class="keyword">if</span> (btn<span class="operator"> == </span>GLUT_LEFT_BUTTON<span class="operator"> &amp;&amp; </span>state<span class="operator"> == </span>GLUT_DOWN)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/* 如果在颜色选项卡中点击 */</span></span><br><span class="line">		<span class="keyword">if</span> (y &lt; optionHeight<span class="operator"> &amp;&amp; </span>x &lt; optionWidth)</span><br><span class="line">		&#123;</span><br><span class="line">			gl<span class="constructor">ReadPixels(<span class="params">x</span>, 2 <span class="operator">*</span> <span class="params">halfHeight</span> - <span class="params">y</span>, 1, 1, GL_RGB, GL_UNSIGNED_BYTE, &amp;<span class="params">nowColor</span>)</span>;</span><br><span class="line">			printf(<span class="string">"r:%d,g:%d,b:%d\n"</span>, nowColor<span class="literal">[<span class="number">0</span>]</span>, nowColor<span class="literal">[<span class="number">1</span>]</span>, nowColor<span class="literal">[<span class="number">2</span>]</span>);</span><br><span class="line">			<span class="comment">/* 设置绘图颜色并显示当前取色板颜色 */</span></span><br><span class="line">			gl<span class="constructor">ColorCircle(-180, 280, 10, <span class="params">nowColor</span>)</span>;</span><br><span class="line">		<span class="comment">/* 如果点击的是右侧选项按钮 */</span></span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span> (y &lt; optionHeight<span class="operator"> &amp;&amp; </span>x &gt; optionWidth) &#123;</span><br><span class="line"></span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外加入监听方法</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/*鼠标点击事件，鼠标点击或者松开时调用 */</span></span><br><span class="line"> glut<span class="constructor">MouseFunc(<span class="params">mouseClick</span>)</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里有几个地方需要说明一下。</p>
                  <h3 id="1-选项卡的分界范围是什么？"><a href="#1-选项卡的分界范围是什么？" class="headerlink" title="1.选项卡的分界范围是什么？"></a>1.选项卡的分界范围是什么？</h3>
                  <p>其实我是把整个画面分割成了三部分，其中最上面 40 像素的一个长条就是选项卡，选项卡又分为了两部分。左边是取色板，右边是绘制的选项，比如取点，绘制，删除等等的操作。所以，optionHeight 就指的是上面的 40 像素的分割线，optionWidth 是中间的分割线，即上方调色板和绘制选项点的分割线。 通过鼠标点击判断是在哪个范围内从而响应不同的事件。 从而鼠标监听事件就是下面的结构了</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 如果在颜色选项卡中点击 */</span></span><br><span class="line">		<span class="keyword">if</span> (y &lt; optionHeight &amp;&amp; x &lt; optionWidth)</span><br><span class="line">		&#123;</span><br><span class="line">			glReadPixels(x, <span class="number">2</span> * halfHeight - y, <span class="number">1</span>, <span class="number">1</span>, GL_RGB, GL_UNSIGNED_BYTE, &amp;nowColor);</span><br><span class="line">			printf(<span class="string">"r:%d,g:%d,b:%d\n"</span>, nowColor[<span class="number">0</span>], nowColor[<span class="number">1</span>], nowColor[<span class="number">2</span>]);</span><br><span class="line">			<span class="comment">/* 设置绘图颜色并显示当前取色板颜色 */</span></span><br><span class="line">			glColorCircle(<span class="number">-180</span>, <span class="number">280</span>, <span class="number">10</span>, nowColor);</span><br><span class="line">		<span class="comment">/* 如果点击的是右侧选项按钮 */</span></span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span> (y &lt; optionHeight &amp;&amp; x &gt; optionWidth) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="comment">/* 如果点击的是下方的绘图页面 */</span></span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中第四个色板就是显示了当前的颜色，在-180,280 的位置绘制了当前的颜色色盘。并同时颜色值保存在了 nowColor 中。</p>
                  <h3 id="2-halfHeight-和-halfWidth"><a href="#2-halfHeight-和-halfWidth" class="headerlink" title="2. halfHeight 和 halfWidth"></a>2. halfHeight 和 halfWidth</h3>
                  <p>这里定义了 halfHeight 和 halfWdith，在后面的绘图中会用到，同时在取色时也会用到，实际就是整个窗口宽高的一半，定义为全局变量即可。如当前的窗口是 600x600，所以现在二者就都是 300,300. 到现在，如果你按照流程走下来，代码是可以正常运行的，现在可以通过点击左上角的色盘进行取色，同时第四个色盘显示了当前的颜色。运行结果截图如下 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/20150511005807.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/20150511005807.jpg" alt="20150511005807"></a> 好，接下来我们就进行多边形的定义了，多边形的定义我们利用结构体的形式，假设我们绘制的边数最大是 10，可以定义如下的多边形结构体，结构体中包含了顶点坐标（数组形式），顶点数量，颜色（RGB）。</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 每个图形最多的顶点数 */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_VERTEX 10</span></span><br><span class="line"><span class="comment">/* 画的图形最多的个数 */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_PLOY 10</span></span><br><span class="line"><span class="comment">/* 多边形结构体 */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">polygon</span> &#123;</span></span><br><span class="line">	<span class="comment">/* 顶点坐标 */</span></span><br><span class="line">	<span class="keyword">int</span> x[MAX_VERTEX];</span><br><span class="line">	<span class="keyword">int</span> y[MAX_VERTEX];</span><br><span class="line">	<span class="comment">/* 定义第几个顶点 */</span></span><br><span class="line">	<span class="keyword">int</span> verNum;</span><br><span class="line">	GLubyte color[<span class="number">3</span>];</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/* 声明多边形数组 */</span></span><br><span class="line">polygon polygons[MAX_PLOY];</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>为了便于记录，我们定义一个 con 变量来记录当前绘制到了哪个多边形</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 记录画了几个多边形 */</span></span><br><span class="line"><span class="built_in">int</span> con = <span class="number">0</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好，定义好结构体之后，我们就可以先选取点，然后绘制多边形了。所以在这里我们定义两个按钮，取点和绘制。 定义两个颜色</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">GLubyte startBtn[<span class="number">3</span>] = &#123;<span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>&#125;;</span><br><span class="line">GLubyte endBtn[<span class="number">3</span>] = &#123;<span class="number">20</span>, <span class="number">20</span>, <span class="number">20</span>&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们可以用颜色来区分不同的按钮，现在原来的 display 函数中画上这俩按钮。</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">glColorCircle(<span class="number">250</span>, <span class="number">280</span>, <span class="number">10</span>, startBtn);</span><br><span class="line">glColorCircle(<span class="number">280</span>, <span class="number">280</span>, <span class="number">10</span>, endBtn);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如图所示，当我们要取点的时候就可以点击一下左边的按钮，取完点后就可以点击右边的按钮完成绘制。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150511010802.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150511010802.jpg" alt="QQ截图20150511010802"></a> 在鼠标监听事件中，当点击了左边的按钮，便开始拾取几个顶点，然后点击右边的按钮之后，会将图形绘制出来。所以为了区分当前是在拾取点还是完成绘制，我们定义一个状态变量叫 drawStatus</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 绘制多边形的起始标志，0是开始绘制，1是结束绘制，初始为-1 */</span></span><br><span class="line"><span class="built_in">int</span> drawStatus = <span class="number">-1</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在原来的 mouseClick 函数中，对于判断点击右上方选项卡的响应就可以改写如下</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/*鼠标点击事件 */</span></span><br><span class="line">void mouse<span class="constructor">Click(<span class="params">int</span> <span class="params">btn</span>, <span class="params">int</span> <span class="params">state</span>, <span class="params">int</span> <span class="params">x</span>, <span class="params">int</span> <span class="params">y</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 选项卡的分界范围 */</span></span><br><span class="line">	<span class="built_in">int</span> optionHeight = <span class="number">40</span>;</span><br><span class="line">	<span class="built_in">int</span> optionWidth = <span class="number">250</span>;</span><br><span class="line">	<span class="keyword">if</span> (btn<span class="operator"> == </span>GLUT_LEFT_BUTTON<span class="operator"> &amp;&amp; </span>state<span class="operator"> == </span>GLUT_DOWN)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/* 如果在颜色选项卡中点击 */</span></span><br><span class="line">		<span class="keyword">if</span> (y &lt; optionHeight<span class="operator"> &amp;&amp; </span>x &lt; optionWidth)</span><br><span class="line">		&#123;</span><br><span class="line">			gl<span class="constructor">ReadPixels(<span class="params">x</span>, 2 <span class="operator">*</span> <span class="params">halfHeight</span> - <span class="params">y</span>, 1, 1, GL_RGB, GL_UNSIGNED_BYTE, &amp;<span class="params">nowColor</span>)</span>;</span><br><span class="line">			printf(<span class="string">"r:%d,g:%d,b:%d\n"</span>, nowColor<span class="literal">[<span class="number">0</span>]</span>, nowColor<span class="literal">[<span class="number">1</span>]</span>, nowColor<span class="literal">[<span class="number">2</span>]</span>);</span><br><span class="line">			<span class="comment">/* 设置绘图颜色并显示当前取色板颜色 */</span></span><br><span class="line">			gl<span class="constructor">ColorCircle(-180, 280, 10, <span class="params">nowColor</span>)</span>;</span><br><span class="line">		<span class="comment">/* 如果点击的是右侧选项按钮 */</span></span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span> (y &lt; optionHeight<span class="operator"> &amp;&amp; </span>x &gt; optionWidth) &#123;</span><br><span class="line">			<span class="comment">//取当前的点</span></span><br><span class="line">			GLubyte color<span class="literal">[<span class="number">3</span>]</span>;</span><br><span class="line">			gl<span class="constructor">ReadPixels(<span class="params">x</span>, 2 <span class="operator">*</span> <span class="params">halfHeight</span> - <span class="params">y</span>, 1, 1, GL_RGB, GL_UNSIGNED_BYTE, &amp;<span class="params">color</span>)</span>;</span><br><span class="line">			printf(<span class="string">"r:%d,g:%d,b:%d\n"</span>, color<span class="literal">[<span class="number">0</span>]</span>, color<span class="literal">[<span class="number">1</span>]</span>, color<span class="literal">[<span class="number">2</span>]</span>);</span><br><span class="line">			<span class="comment">/* 如果点击了开始绘制的按钮 */</span></span><br><span class="line">			<span class="keyword">if</span> (same<span class="constructor">Color(<span class="params">color</span>, <span class="params">startBtn</span>)</span>) &#123;</span><br><span class="line">				drawStatus = <span class="number">0</span>;</span><br><span class="line">				<span class="comment">/* 开始画一个图形，顶点个数置零 */</span></span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.verNum = <span class="number">0</span>;</span><br><span class="line">				printf(<span class="string">"drawStatus:%d\n"</span>, drawStatus);</span><br><span class="line">			<span class="comment">/* 如果点击了结束绘制的按钮 */</span></span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (same<span class="constructor">Color(<span class="params">color</span>, <span class="params">endBtn</span>)</span>) &#123;</span><br><span class="line">				glut<span class="constructor">PostRedisplay()</span>;</span><br><span class="line">				<span class="comment">/* 画的图形个数加一 */</span></span><br><span class="line">				con++;</span><br><span class="line">				printf(<span class="string">"drawStatus:%d\n"</span>, drawStatus);</span><br><span class="line">			&#125;</span><br><span class="line">		<span class="comment">/* 如果点击的是下方的绘图页面 */</span></span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中 sameColor 方法就是来判断当前点击的位置是否和按钮颜色相等，在这里为了避免误差，我们像往常一样设置一个容差。</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 判断两个颜色是否相等 */</span></span><br><span class="line"><span class="built_in">bool</span> sameColor(GLubyte color1[<span class="number">3</span>], GLubyte color2[<span class="number">3</span>])</span><br><span class="line">&#123;</span><br><span class="line"> <span class="keyword">if</span> (color1[<span class="number">0</span>] - color2[<span class="number">0</span>] &lt; <span class="number">5</span> &amp;&amp; color1[<span class="number">1</span>] - color2[<span class="number">1</span>] &lt; <span class="number">5</span> &amp;&amp; color1[<span class="number">2</span>] - color2[<span class="number">1</span>] &lt; <span class="number">5</span>)</span><br><span class="line"> &#123;</span><br><span class="line"> <span class="keyword">return</span>(<span class="literal">true</span>);</span><br><span class="line"> &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"> <span class="keyword">return</span>(<span class="literal">false</span>);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好，当点击了第一个黑色按钮（取点的按钮）时，我们便可以在下方拾取点来保存到数组中了。 在最后的 else 代码块中加入如下的方法，用来取点。 这里的取点是取到了点击的坐标值，当前的 RGB 值，每取一个点，响应的 verNum（顶点数目）就加一。 而且当前保存到的多边形是 polygons[con]，con 初始值为 0，也就是保存到第一个多边形结构体中。 当我们点击了开始绘制按钮时，con 会加 1，并且将保存的多边形绘制出来。</p>
                  <figure class="highlight prolog">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 如果当前是正在取点状态 */</span></span><br><span class="line">			if (drawStatus == <span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">/* 保存每个点，然后该图形顶点个数加一 */</span></span><br><span class="line">				polygons[con].x[polygons[con].verNum]	= x;</span><br><span class="line">				polygons[con].y[polygons[con].verNum]	= y;</span><br><span class="line">				<span class="comment">/* 画点 */</span></span><br><span class="line">				glPoints(x, y);</span><br><span class="line">				<span class="comment">/* 设置当前颜色RGB，如果取色有变动，以最后的取色为准 */</span></span><br><span class="line">				polygons[con].color[<span class="number">0</span>] = nowColor[<span class="number">0</span>];</span><br><span class="line">				polygons[con].color[<span class="number">1</span>] = nowColor[<span class="number">1</span>];</span><br><span class="line">				polygons[con].color[<span class="number">2</span>] = nowColor[<span class="number">2</span>];</span><br><span class="line">				printf(<span class="string">"polyColor%d%d%d\n"</span>, polygons[con].color[<span class="number">0</span>],polygons[con].color[<span class="number">1</span>],polygons[con].color[<span class="number">2</span>]);</span><br><span class="line">				polygons[con].verNum++;</span><br><span class="line">				printf(<span class="string">"con:%d,verNum:%d\n"</span>, con, polygons[con].verNum);</span><br><span class="line">			&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>到现在上面的 mouseClick 方法就变成了</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/*鼠标点击事件 */</span></span><br><span class="line">void mouse<span class="constructor">Click(<span class="params">int</span> <span class="params">btn</span>, <span class="params">int</span> <span class="params">state</span>, <span class="params">int</span> <span class="params">x</span>, <span class="params">int</span> <span class="params">y</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 选项卡的分界范围 */</span></span><br><span class="line">	<span class="built_in">int</span> optionHeight = <span class="number">40</span>;</span><br><span class="line">	<span class="built_in">int</span> optionWidth = <span class="number">250</span>;</span><br><span class="line">	<span class="keyword">if</span> (btn<span class="operator"> == </span>GLUT_LEFT_BUTTON<span class="operator"> &amp;&amp; </span>state<span class="operator"> == </span>GLUT_DOWN)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/* 如果在颜色选项卡中点击 */</span></span><br><span class="line">		<span class="keyword">if</span> (y &lt; optionHeight<span class="operator"> &amp;&amp; </span>x &lt; optionWidth)</span><br><span class="line">		&#123;</span><br><span class="line">			gl<span class="constructor">ReadPixels(<span class="params">x</span>, 2 <span class="operator">*</span> <span class="params">halfHeight</span> - <span class="params">y</span>, 1, 1, GL_RGB, GL_UNSIGNED_BYTE, &amp;<span class="params">nowColor</span>)</span>;</span><br><span class="line">			printf(<span class="string">"r:%d,g:%d,b:%d\n"</span>, nowColor<span class="literal">[<span class="number">0</span>]</span>, nowColor<span class="literal">[<span class="number">1</span>]</span>, nowColor<span class="literal">[<span class="number">2</span>]</span>);</span><br><span class="line">			<span class="comment">/* 设置绘图颜色并显示当前取色板颜色 */</span></span><br><span class="line">			gl<span class="constructor">ColorCircle(-180, 280, 10, <span class="params">nowColor</span>)</span>;</span><br><span class="line">		<span class="comment">/* 如果点击的是右侧选项按钮 */</span></span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span> (y &lt; optionHeight<span class="operator"> &amp;&amp; </span>x &gt; optionWidth) &#123;</span><br><span class="line">			<span class="comment">//取当前的点</span></span><br><span class="line">			GLubyte color<span class="literal">[<span class="number">3</span>]</span>;</span><br><span class="line">			gl<span class="constructor">ReadPixels(<span class="params">x</span>, 2 <span class="operator">*</span> <span class="params">halfHeight</span> - <span class="params">y</span>, 1, 1, GL_RGB, GL_UNSIGNED_BYTE, &amp;<span class="params">color</span>)</span>;</span><br><span class="line">			printf(<span class="string">"r:%d,g:%d,b:%d\n"</span>, color<span class="literal">[<span class="number">0</span>]</span>, color<span class="literal">[<span class="number">1</span>]</span>, color<span class="literal">[<span class="number">2</span>]</span>);</span><br><span class="line">			<span class="comment">/* 如果点击了开始绘制的按钮 */</span></span><br><span class="line">			<span class="keyword">if</span> (same<span class="constructor">Color(<span class="params">color</span>, <span class="params">startBtn</span>)</span>) &#123;</span><br><span class="line">				drawStatus = <span class="number">0</span>;</span><br><span class="line">				<span class="comment">/* 开始画一个图形，顶点个数置零 */</span></span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.verNum = <span class="number">0</span>;</span><br><span class="line">				printf(<span class="string">"drawStatus:%d\n"</span>, drawStatus);</span><br><span class="line">			<span class="comment">/* 如果点击了结束绘制的按钮 */</span></span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (same<span class="constructor">Color(<span class="params">color</span>, <span class="params">endBtn</span>)</span>) &#123;</span><br><span class="line">				glut<span class="constructor">PostRedisplay()</span>;</span><br><span class="line">				<span class="comment">/* 画的图形个数加一 */</span></span><br><span class="line">				con++;</span><br><span class="line">				printf(<span class="string">"drawStatus:%d\n"</span>, drawStatus);</span><br><span class="line">			&#125;</span><br><span class="line">		<span class="comment">/* 如果点击的是下方的绘图页面 */</span></span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">/* 如果当前是正在取点状态 */</span></span><br><span class="line">			<span class="keyword">if</span> (drawStatus<span class="operator"> == </span><span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">/* 保存每个点，然后该图形顶点个数加一 */</span></span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.x<span class="literal">[<span class="identifier">polygons</span>[<span class="identifier">con</span>]</span>.verNum]	= x;</span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.y<span class="literal">[<span class="identifier">polygons</span>[<span class="identifier">con</span>]</span>.verNum]	= y;</span><br><span class="line">				<span class="comment">/* 画点 */</span></span><br><span class="line">				gl<span class="constructor">Points(<span class="params">x</span>, <span class="params">y</span>)</span>;</span><br><span class="line">				<span class="comment">/* 设置当前颜色RGB，如果取色有变动，以最后的取色为准 */</span></span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">0</span>]</span> = nowColor<span class="literal">[<span class="number">0</span>]</span>;</span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">1</span>]</span> = nowColor<span class="literal">[<span class="number">1</span>]</span>;</span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">2</span>]</span> = nowColor<span class="literal">[<span class="number">2</span>]</span>;</span><br><span class="line">				printf(<span class="string">"polyColor%d%d%d\n"</span>, polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">0</span>]</span>,polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">1</span>]</span>,polygons<span class="literal">[<span class="identifier">con</span>]</span>.color<span class="literal">[<span class="number">2</span>]</span>);</span><br><span class="line">				polygons<span class="literal">[<span class="identifier">con</span>]</span>.verNum++;</span><br><span class="line">				printf(<span class="string">"con:%d,verNum:%d\n"</span>, con, polygons<span class="literal">[<span class="identifier">con</span>]</span>.verNum);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里有几点说明如下</p>
                  <h3 id="1-glPoints-方法"><a href="#1-glPoints-方法" class="headerlink" title="1.glPoints 方法"></a>1.glPoints 方法</h3>
                  <p>即画点方法，为了直观地显示用户选取了哪个点，我们设置了这个画点的方法，每点一个点，就在屏幕上显示出来。 方法定义如下</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 画点 */</span></span><br><span class="line">void gl<span class="constructor">Points(<span class="params">int</span> <span class="params">x</span>, <span class="params">int</span> <span class="params">y</span>)</span> &#123;</span><br><span class="line">	gl<span class="constructor">Begin(GL_POINTS)</span>;</span><br><span class="line">	<span class="comment">/* 点直接设置为黑色 */</span></span><br><span class="line">	gl<span class="constructor">Color3ub(0, 0, 0)</span>;</span><br><span class="line">	gl<span class="constructor">Vertex2d(<span class="params">x</span> - <span class="params">halfWidth</span>, <span class="params">halfHeight</span> - <span class="params">y</span>)</span>;</span><br><span class="line">	gl<span class="constructor">End()</span>;</span><br><span class="line">	gl<span class="constructor">Flush()</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里，glVertex2d 方法的参数为什么不是 x，y 呢？很简单，因为我们绘画时的坐标原点是窗口的中心点，而鼠标点击的坐标原点是左上角，为了做一个映射变换，x 需要减去 halfWidth，y 需要取反并加 halfWidth。总之定义这两个 half 变量还是用处多多的。</p>
                  <h3 id="2-glutPostRedisplay"><a href="#2-glutPostRedisplay" class="headerlink" title="2.glutPostRedisplay"></a><strong>2.glutPostRedisplay</strong></h3>
                  <p>这个方法就是重新绘制的方法，我们看到在结束绘制的地方调用了这个方法，其实就是重新调用了 display 方法，所以为了让我们绘制的图形正常显示，我们需要在 display 方法中来绘制我们已经存储好的多边形。我们可以把绘制多边形定义为一个方法，然后在 display 中调用即可。 绘制多边形的方法如下</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 绘制多边形 */</span></span><br><span class="line">void gl<span class="constructor">Polygons()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (con&gt;=<span class="number">0</span>) &#123;</span><br><span class="line">		for (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt;= con; i++) &#123;</span><br><span class="line">			<span class="comment">/* 取到这个多边形 */</span></span><br><span class="line">			polygon poly	= polygons<span class="literal">[<span class="identifier">i</span>]</span>;</span><br><span class="line">			<span class="comment">/* 画封闭线 */</span></span><br><span class="line">			gl<span class="constructor">Begin(GL_LINE_LOOP)</span>;</span><br><span class="line">			<span class="built_in">int</span> num = poly.verNum;</span><br><span class="line">			printf(<span class="string">"num:%d\n"</span>,num);</span><br><span class="line">			for (<span class="built_in">int</span> j = <span class="number">0</span>; j &lt; num; j++)</span><br><span class="line">			&#123;</span><br><span class="line">				gl<span class="constructor">Color3ub(<span class="params">poly</span>.<span class="params">color</span>[0], <span class="params">poly</span>.<span class="params">color</span>[1], <span class="params">poly</span>.<span class="params">color</span>[2])</span>;</span><br><span class="line">				gl<span class="constructor">Vertex2d(<span class="params">poly</span>.<span class="params">x</span>[<span class="params">j</span>] - <span class="params">halfWidth</span>, <span class="params">halfHeight</span> - <span class="params">poly</span>.<span class="params">y</span>[<span class="params">j</span>])</span>;</span><br><span class="line">				printf(<span class="string">"polyx:%d,polyy:%d"</span>,poly.x<span class="literal">[<span class="identifier">j</span>]</span>,poly.y<span class="literal">[<span class="identifier">j</span>]</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">/* 结束画线 */</span></span><br><span class="line">			gl<span class="constructor">End()</span>;</span><br><span class="line">			<span class="comment">/* 刷新 */</span></span><br><span class="line">			gl<span class="constructor">Flush()</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在 display 函数中调用一下即可，方法的最后面调用一下。</p>
                  <figure class="highlight less">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 绘制多边形 */</span></span><br><span class="line">	<span class="selector-tag">glPolygons</span>();</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>好，现在我们点击第一个黑色圆点，然后在屏幕上取点，取完点之后，然后点击右上角的黑色圆点，即可完成绘制 运行结果如下 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150511013259.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150511013259.jpg" alt="QQ截图20150511013259"></a> 在此先告一段落，下一篇我们接着这里来实现图形的删除，移动以及存盘，读盘等操作。</p>
                  <h2 id="本节代码"><a href="#本节代码" class="headerlink" title="本节代码"></a>本节代码</h2>
                  <p>到这里，提供如下代码，代码运行结果即为上图所示，由于代码太长，不完全展开显示，<strong>双击查看全部代码</strong>。</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">#include &lt;glut.h&gt;</span><br><span class="line">#include &lt;math.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">#define PI <span class="number">3.1415926</span></span><br><span class="line"><span class="comment">/* 每个图形最多的顶点数 */</span></span><br><span class="line">#define MAX_VERTEX <span class="number">10</span></span><br><span class="line"><span class="comment">/* 画的图形最多的个数 */</span></span><br><span class="line">#define MAX_PLOY <span class="number">10</span></span><br><span class="line"><span class="comment">/* 窗口长宽的一半 */</span></span><br><span class="line"><span class="built_in">int</span> halfWidth, halfHeight;</span><br><span class="line"><span class="comment">/* 绘制多边形的起始标志，0是开始绘制，1是结束绘制，初始为-1 */</span></span><br><span class="line"><span class="built_in">int</span> drawStatus = <span class="number">-1</span>;</span><br><span class="line"><span class="comment">/* 多边形结构体 */</span></span><br><span class="line">struct polygon &#123;</span><br><span class="line">	<span class="comment">/* 顶点坐标 */</span></span><br><span class="line">	<span class="built_in">int</span> x[MAX_VERTEX];</span><br><span class="line">	<span class="built_in">int</span> y[MAX_VERTEX];</span><br><span class="line">	<span class="comment">/* 定义第几个顶点 */</span></span><br><span class="line">	<span class="built_in">int</span> verNum;</span><br><span class="line">	GLubyte color[<span class="number">3</span>];</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/* 各种颜色 */</span></span><br><span class="line">GLubyte border[<span class="number">3</span>] = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">GLubyte grey[<span class="number">3</span>] = &#123;<span class="number">195</span>, <span class="number">195</span>, <span class="number">195</span>&#125;;</span><br><span class="line">GLubyte yellow[<span class="number">3</span>] = &#123;<span class="number">255</span>, <span class="number">243</span>, <span class="number">0</span>&#125;;</span><br><span class="line">GLubyte red[<span class="number">3</span>] = &#123;<span class="number">237</span>, <span class="number">28</span>, <span class="number">36</span>&#125;;</span><br><span class="line">GLubyte darkGrey[<span class="number">3</span>] = &#123;<span class="number">126</span>, <span class="number">126</span>, <span class="number">126</span>&#125;;</span><br><span class="line">GLubyte white[<span class="number">3</span>] = &#123;<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>&#125;;</span><br><span class="line">GLubyte startBtn[<span class="number">3</span>] = &#123;<span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>&#125;;</span><br><span class="line">GLubyte endBtn[<span class="number">3</span>] = &#123;<span class="number">20</span>, <span class="number">20</span>, <span class="number">20</span>&#125;;</span><br><span class="line"><span class="comment">/* 当前颜色 */</span></span><br><span class="line">GLubyte nowColor[<span class="number">3</span>] = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line"><span class="comment">/* 声明多边形数组 */</span></span><br><span class="line">polygon polygons[MAX_PLOY];</span><br><span class="line"><span class="comment">/* 记录画了几个多边形 */</span></span><br><span class="line"><span class="built_in">int</span> con = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 绘制多边形 */</span></span><br><span class="line"><span class="built_in">void</span> glPolygons()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (con&gt;=<span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt;= con; i++) &#123;</span><br><span class="line">			<span class="comment">/* 取到这个多边形 */</span></span><br><span class="line">			polygon poly	= polygons[i];</span><br><span class="line">			<span class="comment">/* 画封闭线 */</span></span><br><span class="line">			glBegin(GL_LINE_LOOP);</span><br><span class="line">			<span class="built_in">int</span> num = poly.verNum;</span><br><span class="line">			printf(<span class="string">"num:%d\n"</span>,num);</span><br><span class="line">			<span class="keyword">for</span> (<span class="built_in">int</span> j = <span class="number">0</span>; j &lt; num; j++)</span><br><span class="line">			&#123;</span><br><span class="line">				glColor3ub(poly.color[<span class="number">0</span>], poly.color[<span class="number">1</span>], poly.color[<span class="number">2</span>]);</span><br><span class="line">				glVertex2d(poly.x[j] - halfWidth, halfHeight - poly.y[j]);</span><br><span class="line">				printf(<span class="string">"polyx:%d,polyy:%d"</span>,poly.x[j],poly.y[j]);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">/* 结束画线 */</span></span><br><span class="line">			glEnd();</span><br><span class="line">			<span class="comment">/* 刷新 */</span></span><br><span class="line">			glFlush();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 绘制填充的圆形 */</span></span><br><span class="line"><span class="built_in">void</span> glColorCircle(<span class="built_in">int</span> x, <span class="built_in">int</span> y, <span class="built_in">int</span> R, GLubyte color[<span class="number">3</span>])</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 开始绘制曲线 */</span></span><br><span class="line">	glBegin(GL_POLYGON);</span><br><span class="line">	<span class="comment">/* 设置颜色 */</span></span><br><span class="line">	glColor3ub(color[<span class="number">0</span>], color[<span class="number">1</span>], color[<span class="number">2</span>]);</span><br><span class="line">	<span class="comment">/* 每次画增加的弧度 */</span></span><br><span class="line">	<span class="built_in">double</span> delta_angle = PI / <span class="number">180</span>;</span><br><span class="line">	<span class="comment">/* 画圆弧 */</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="built_in">double</span> i = <span class="number">0</span>; i &lt;= <span class="number">2</span> * PI; i += delta_angle)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/* 绝对定位加三角函数值 */</span></span><br><span class="line">		<span class="built_in">double</span>	vx	= x + R * cos(i);</span><br><span class="line">		<span class="built_in">double</span>	vy	= y + R*sin(i);</span><br><span class="line">		glVertex2d(vx, vy);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/* 结束绘画 */</span></span><br><span class="line">	glEnd();</span><br><span class="line">	glFlush();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//画矩形，传入的是左下角XY坐标和右上角XY坐标</span></span><br><span class="line"><span class="built_in">void</span> glRect(<span class="built_in">int</span> leftX,<span class="built_in">int</span> leftY,<span class="built_in">int</span> rightX,<span class="built_in">int</span> rightY)&#123;</span><br><span class="line">	<span class="comment">//画封闭曲线</span></span><br><span class="line">    glBegin(GL_LINE_LOOP);</span><br><span class="line">	<span class="comment">//左下角</span></span><br><span class="line">	glVertex2d(leftX,leftY);</span><br><span class="line">	<span class="comment">//右下角</span></span><br><span class="line">	glVertex2d(rightX,leftY);</span><br><span class="line">	<span class="comment">//右上角</span></span><br><span class="line">	glVertex2d(rightX,rightY);</span><br><span class="line">	<span class="comment">//左上角</span></span><br><span class="line">	glVertex2d(leftX,rightY);</span><br><span class="line">	<span class="comment">//结束画线</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//画圆角矩形，传入矩形宽高，角半径，矩形中心点坐标</span></span><br><span class="line"><span class="built_in">void</span> glRoundRec(<span class="built_in">int</span> centerX,<span class="built_in">int</span> centerY,<span class="built_in">int</span> width,<span class="built_in">int</span> height,<span class="built_in">float</span> cirR)&#123;</span><br><span class="line">	<span class="comment">//二分之PI，一个象限的角度</span></span><br><span class="line">	<span class="built_in">float</span> PI_HALF = PI/<span class="number">2</span>;</span><br><span class="line">	<span class="comment">//划分程度,值越大画得越精细</span></span><br><span class="line">	<span class="built_in">float</span> divide=<span class="number">20.0</span>;</span><br><span class="line">	<span class="comment">//圆角矩形的坐标</span></span><br><span class="line">    <span class="built_in">float</span> tx,ty;</span><br><span class="line">	<span class="comment">//画封闭曲线</span></span><br><span class="line">    glBegin(GL_LINE_LOOP);</span><br><span class="line">	<span class="comment">//四个象限不同的操作符</span></span><br><span class="line">    <span class="built_in">int</span> opX[<span class="number">4</span>]=&#123;<span class="number">1</span>,<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">1</span>&#125;;</span><br><span class="line">    <span class="built_in">int</span> opY[<span class="number">4</span>]=&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">-1</span>,<span class="number">-1</span>&#125;;</span><br><span class="line">	<span class="comment">//用来计数，从第一象限到第四象限</span></span><br><span class="line">    <span class="built_in">float</span> x=<span class="number">0</span>;</span><br><span class="line">	<span class="comment">//x自增时加的值</span></span><br><span class="line">	<span class="built_in">float</span> part=<span class="number">1</span>/divide;</span><br><span class="line">	<span class="comment">//计算内矩形宽高一半的数值</span></span><br><span class="line">	<span class="built_in">int</span> w=width/<span class="number">2</span>-cirR;</span><br><span class="line">	<span class="built_in">int</span> h=height/<span class="number">2</span>-cirR;</span><br><span class="line">	<span class="comment">//循环画线</span></span><br><span class="line">    <span class="keyword">for</span>(x=<span class="number">0</span>;x&lt;<span class="number">4</span>;x+=part)&#123;</span><br><span class="line">		<span class="comment">//求出弧度</span></span><br><span class="line">		<span class="built_in">float</span> rad = PI_HALF*x;</span><br><span class="line">		<span class="comment">//计算坐标值</span></span><br><span class="line">	    tx=cirR*cos(rad)+opX[(<span class="built_in">int</span>)x]*w+centerX;</span><br><span class="line">	    ty=cirR*sin(rad)+opY[(<span class="built_in">int</span>)x]*h+centerY;</span><br><span class="line">		<span class="comment">//传入坐标画线</span></span><br><span class="line">	    glVertex2f(tx,ty);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//结束画线</span></span><br><span class="line">   glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//画弧线，相对偏移量XY，开始的弧度，结束的弧度，半径</span></span><br><span class="line"><span class="built_in">void</span> glArc(<span class="built_in">double</span> x,<span class="built_in">double</span> y,<span class="built_in">double</span> start_angle,<span class="built_in">double</span> end_angle,<span class="built_in">double</span> radius)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//开始绘制曲线</span></span><br><span class="line">	glBegin(GL_LINE_STRIP);</span><br><span class="line">	<span class="comment">//每次画增加的弧度</span></span><br><span class="line">	<span class="built_in">double</span> delta_angle=PI/<span class="number">180</span>;</span><br><span class="line">	<span class="comment">//画圆弧</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="built_in">double</span> i=start_angle;i&lt;=end_angle;i+=delta_angle)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//绝对定位加三角函数值</span></span><br><span class="line">		<span class="built_in">double</span> vx=x+radius * cos(i);</span><br><span class="line">		<span class="built_in">double</span> vy=y+radius*sin(i);</span><br><span class="line">		glVertex2d(vx,vy);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//结束绘画</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//画圆</span></span><br><span class="line"><span class="built_in">void</span> glCircle(<span class="built_in">double</span> x, <span class="built_in">double</span> y, <span class="built_in">double</span> radius)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//画全圆</span></span><br><span class="line">    glArc(x,y,<span class="number">0</span>,<span class="number">2</span>*PI,radius);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//画三角形，传入三个点的坐标</span></span><br><span class="line"><span class="built_in">void</span> glTri(<span class="built_in">int</span> x1,<span class="built_in">int</span> y1,<span class="built_in">int</span> x2,<span class="built_in">int</span> y2,<span class="built_in">int</span> x3,<span class="built_in">int</span> y3)&#123;</span><br><span class="line">	<span class="comment">//画封闭线</span></span><br><span class="line">    glBegin(GL_LINE_LOOP);</span><br><span class="line">	<span class="comment">//一点</span></span><br><span class="line">	glVertex2d(x1,y1);</span><br><span class="line">	<span class="comment">//二点</span></span><br><span class="line">	glVertex2d(x2,y2);</span><br><span class="line">	<span class="comment">//三点</span></span><br><span class="line">	glVertex2d(x3,y3);</span><br><span class="line">	<span class="comment">//结束画线</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//画线，传入两点坐标</span></span><br><span class="line"><span class="built_in">void</span> glLine(<span class="built_in">int</span> x1,<span class="built_in">int</span> y1,<span class="built_in">int</span> x2,<span class="built_in">int</span> y2)&#123;</span><br><span class="line">	<span class="comment">//画封闭线</span></span><br><span class="line">    glBegin(GL_LINE_STRIP);</span><br><span class="line">	<span class="comment">//一点</span></span><br><span class="line">	glVertex2d(x1,y1);</span><br><span class="line">	<span class="comment">//二点</span></span><br><span class="line">	glVertex2d(x2,y2);</span><br><span class="line">	<span class="comment">//结束画线</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//函数用来画图</span></span><br><span class="line"><span class="built_in">void</span> display(<span class="built_in">void</span>)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//GL_COLOR_BUFFER_BIT表示清除颜色</span></span><br><span class="line">	glClear(GL_COLOR_BUFFER_BIT);</span><br><span class="line">	<span class="comment">//设置画线颜色</span></span><br><span class="line">    glColor3f(<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">0.5</span>);</span><br><span class="line">	<span class="comment">//画点大小</span></span><br><span class="line">	glPointSize(<span class="number">2</span>);</span><br><span class="line">	<span class="comment">//画圆角矩形，大肚子</span></span><br><span class="line">	glRoundRec(<span class="number">0</span>,<span class="number">0</span>,<span class="number">146</span>,<span class="number">120</span>,<span class="number">15</span>);</span><br><span class="line">	<span class="comment">//画圆，中间小圈</span></span><br><span class="line">	glCircle(<span class="number">0</span>,<span class="number">0</span>,<span class="number">10</span>);</span><br><span class="line">	<span class="comment">//画矩形，脖子</span></span><br><span class="line">	glRect(<span class="number">-25</span>,<span class="number">60</span>,<span class="number">25</span>,<span class="number">76</span>);</span><br><span class="line">	<span class="comment">//画圆角矩形，大脸</span></span><br><span class="line">	glRoundRec(<span class="number">0</span>,<span class="number">113</span>,<span class="number">128</span>,<span class="number">74</span>,<span class="number">10</span>);</span><br><span class="line">	<span class="comment">//两个眼睛</span></span><br><span class="line">	glCircle(<span class="number">-30</span>,<span class="number">111</span>,<span class="number">10</span>);</span><br><span class="line">	glCircle(<span class="number">30</span>,<span class="number">111</span>,<span class="number">10</span>);</span><br><span class="line">	<span class="comment">//两条天线</span></span><br><span class="line">	glLine(<span class="number">-35</span>,<span class="number">150</span>,<span class="number">-35</span>,<span class="number">173</span>);</span><br><span class="line">	glLine(<span class="number">35</span>,<span class="number">150</span>,<span class="number">35</span>,<span class="number">173</span>);</span><br><span class="line">	<span class="comment">//圆角矩形，两个耳朵</span></span><br><span class="line">	glRoundRec(<span class="number">81</span>,<span class="number">115</span>,<span class="number">20</span>,<span class="number">34</span>,<span class="number">5</span>);</span><br><span class="line">	glRoundRec(<span class="number">-81</span>,<span class="number">115</span>,<span class="number">20</span>,<span class="number">34</span>,<span class="number">5</span>);</span><br><span class="line">	<span class="comment">//圆弧，画嘴</span></span><br><span class="line">	glArc(<span class="number">0</span>,<span class="number">133</span>,<span class="number">11</span>*PI/<span class="number">8</span>,<span class="number">13</span>*PI/<span class="number">8</span>,<span class="number">45</span>);</span><br><span class="line">	<span class="comment">//画三角，肚子里的三角</span></span><br><span class="line">	glTri(<span class="number">-30</span>,<span class="number">-15</span>,<span class="number">30</span>,<span class="number">-15</span>,<span class="number">0</span>,<span class="number">28</span>);</span><br><span class="line">	<span class="comment">//画矩形，胳膊连接处</span></span><br><span class="line">	glRect(<span class="number">-81</span>,<span class="number">43</span>,<span class="number">-73</span>,<span class="number">25</span>);</span><br><span class="line">	glRect(<span class="number">81</span>,<span class="number">43</span>,<span class="number">73</span>,<span class="number">25</span>);</span><br><span class="line">	<span class="comment">//画矩形，上臂</span></span><br><span class="line">	glRect(<span class="number">-108</span>,<span class="number">45</span>,<span class="number">-81</span>,<span class="number">0</span>);</span><br><span class="line">	glRect(<span class="number">108</span>,<span class="number">45</span>,<span class="number">81</span>,<span class="number">0</span>);</span><br><span class="line">	<span class="comment">//画矩形，中臂</span></span><br><span class="line">	glRect(<span class="number">-101</span>,<span class="number">0</span>,<span class="number">-88</span>,<span class="number">-4</span>);</span><br><span class="line">	glRect(<span class="number">101</span>,<span class="number">0</span>,<span class="number">88</span>,<span class="number">-4</span>);</span><br><span class="line">	<span class="comment">//画矩形，下臂</span></span><br><span class="line">	glRect(<span class="number">-108</span>,<span class="number">-4</span>,<span class="number">-81</span>,<span class="number">-37</span>);</span><br><span class="line">	glRect(<span class="number">108</span>,<span class="number">-4</span>,<span class="number">81</span>,<span class="number">-37</span>);</span><br><span class="line">	<span class="comment">//画圆形，手掌</span></span><br><span class="line">	glCircle(<span class="number">-95</span>,<span class="number">-47</span>,<span class="number">10</span>);</span><br><span class="line">	glCircle(<span class="number">95</span>,<span class="number">-47</span>,<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* 绘制取色盘 */</span></span><br><span class="line">	glColorCircle(<span class="number">-280</span>, <span class="number">280</span>, <span class="number">10</span>, red);</span><br><span class="line">	glColorCircle(<span class="number">-250</span>, <span class="number">280</span>, <span class="number">10</span>, yellow);</span><br><span class="line">	glColorCircle(<span class="number">-220</span>, <span class="number">280</span>, <span class="number">10</span>, grey);</span><br><span class="line">	glColorCircle(<span class="number">-180</span>, <span class="number">280</span>, <span class="number">10</span>, nowColor);</span><br><span class="line">	glColorCircle(<span class="number">250</span>, <span class="number">280</span>, <span class="number">10</span>, startBtn);</span><br><span class="line">	glColorCircle(<span class="number">280</span>, <span class="number">280</span>, <span class="number">10</span>, endBtn);</span><br><span class="line">	<span class="comment">//保证前面的OpenGL命令立即执行，而不是让它们在缓冲区中等待</span></span><br><span class="line">	<span class="comment">/* 绘制多边形 */</span></span><br><span class="line">	glPolygons();</span><br><span class="line">	glFlush();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//窗口大小变化时调用的函数</span></span><br><span class="line"><span class="built_in">void</span> ChangeSize(GLsizei w,GLsizei h)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//避免高度为0</span></span><br><span class="line">    <span class="keyword">if</span>(h==<span class="number">0</span>) &#123;</span><br><span class="line">        h=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//定义视口大小，宽高一致</span></span><br><span class="line">    glViewport(<span class="number">0</span>,<span class="number">0</span>,w,h);</span><br><span class="line">	<span class="built_in">int</span> half = <span class="number">300</span>;</span><br><span class="line">	<span class="comment">/* 定义宽高的一半 */</span></span><br><span class="line">	halfHeight	= <span class="number">300</span>;</span><br><span class="line">	halfWidth	= <span class="number">300</span>;</span><br><span class="line">	<span class="comment">//重置坐标系统，使投影变换复位</span></span><br><span class="line">    glMatrixMode(GL_PROJECTION);</span><br><span class="line">	<span class="comment">//将当前的用户坐标系的原点移到了屏幕中心</span></span><br><span class="line">    glLoadIdentity();</span><br><span class="line">   <span class="comment">//定义正交视域体</span></span><br><span class="line">    <span class="keyword">if</span>(w&lt;h) &#123;</span><br><span class="line">		<span class="comment">//如果高度大于宽度，则将高度视角扩大，图形显示居中</span></span><br><span class="line">        glOrtho(-half,half,-half*h/w,half*h/w,-half,half);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">//如果宽度大于高度，则将宽度视角扩大，图形显示居中</span></span><br><span class="line">        glOrtho(-half*w/h,half*w/h,-half,half,-half,half);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 判断两个颜色是否相等 */</span></span><br><span class="line"><span class="built_in">bool</span> sameColor(GLubyte color1[<span class="number">3</span>], GLubyte color2[<span class="number">3</span>])</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (color1[<span class="number">0</span>] - color2[<span class="number">0</span>] &lt; <span class="number">5</span> &amp;&amp; color1[<span class="number">1</span>] - color2[<span class="number">1</span>] &lt; <span class="number">5</span> &amp;&amp; color1[<span class="number">2</span>] - color2[<span class="number">1</span>] &lt; <span class="number">5</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span>(<span class="literal">true</span>);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">return</span>(<span class="literal">false</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 画点 */</span></span><br><span class="line"><span class="built_in">void</span> glPoints(<span class="built_in">int</span> x, <span class="built_in">int</span> y) &#123;</span><br><span class="line">	glBegin(GL_POINTS);</span><br><span class="line">	<span class="comment">/* 点直接设置为黑色 */</span></span><br><span class="line">	glColor3ub(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">	glVertex2d(x - halfWidth, halfHeight - y);</span><br><span class="line">	glEnd();</span><br><span class="line">	glFlush();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*鼠标点击事件 */</span></span><br><span class="line"><span class="built_in">void</span> mouseClick(<span class="built_in">int</span> btn, <span class="built_in">int</span> state, <span class="built_in">int</span> x, <span class="built_in">int</span> y)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 选项卡的分界范围 */</span></span><br><span class="line">	<span class="built_in">int</span> optionHeight = <span class="number">40</span>;</span><br><span class="line">	<span class="built_in">int</span> optionWidth = <span class="number">250</span>;</span><br><span class="line">	<span class="keyword">if</span> (btn == GLUT_LEFT_BUTTON &amp;&amp; state == GLUT_DOWN)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">/* 如果在颜色选项卡中点击 */</span></span><br><span class="line">		<span class="keyword">if</span> (y &lt; optionHeight &amp;&amp; x &lt; optionWidth)</span><br><span class="line">		&#123;</span><br><span class="line">			glReadPixels(x, <span class="number">2</span> * halfHeight - y, <span class="number">1</span>, <span class="number">1</span>, GL_RGB, GL_UNSIGNED_BYTE, &amp;nowColor);</span><br><span class="line">			printf(<span class="string">"r:%d,g:%d,b:%d\n"</span>, nowColor[<span class="number">0</span>], nowColor[<span class="number">1</span>], nowColor[<span class="number">2</span>]);</span><br><span class="line">			<span class="comment">/* 设置绘图颜色并显示当前取色板颜色 */</span></span><br><span class="line">			glColorCircle(<span class="number">-180</span>, <span class="number">280</span>, <span class="number">10</span>, nowColor);</span><br><span class="line">		<span class="comment">/* 如果点击的是右侧选项按钮 */</span></span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span> (y &lt; optionHeight &amp;&amp; x &gt; optionWidth) &#123;</span><br><span class="line">			<span class="comment">//取当前的点</span></span><br><span class="line">			GLubyte color[<span class="number">3</span>];</span><br><span class="line">			glReadPixels(x, <span class="number">2</span> * halfHeight - y, <span class="number">1</span>, <span class="number">1</span>, GL_RGB, GL_UNSIGNED_BYTE, &amp;color);</span><br><span class="line">			printf(<span class="string">"r:%d,g:%d,b:%d\n"</span>, color[<span class="number">0</span>], color[<span class="number">1</span>], color[<span class="number">2</span>]);</span><br><span class="line">			<span class="comment">/* 如果点击了开始绘制的按钮 */</span></span><br><span class="line">			<span class="keyword">if</span> (sameColor(color, startBtn)) &#123;</span><br><span class="line">				drawStatus = <span class="number">0</span>;</span><br><span class="line">				<span class="comment">/* 开始画一个图形，顶点个数置零 */</span></span><br><span class="line">				polygons[con].verNum = <span class="number">0</span>;</span><br><span class="line">				printf(<span class="string">"drawStatus:%d\n"</span>, drawStatus);</span><br><span class="line">			<span class="comment">/* 如果点击了结束绘制的按钮 */</span></span><br><span class="line">			&#125; <span class="keyword">else</span> <span class="keyword">if</span> (sameColor(color, endBtn)) &#123;</span><br><span class="line">				glutPostRedisplay();</span><br><span class="line">				<span class="comment">/* 画的图形个数加一 */</span></span><br><span class="line">				con++;</span><br><span class="line">				printf(<span class="string">"drawStatus:%d\n"</span>, drawStatus);</span><br><span class="line">			&#125;</span><br><span class="line">		<span class="comment">/* 如果点击的是下方的绘图页面 */</span></span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">/* 如果当前是正在取点状态 */</span></span><br><span class="line">			<span class="keyword">if</span> (drawStatus == <span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="comment">/* 保存每个点，然后该图形顶点个数加一 */</span></span><br><span class="line">				polygons[con].x[polygons[con].verNum]	= x;</span><br><span class="line">				polygons[con].y[polygons[con].verNum]	= y;</span><br><span class="line">				<span class="comment">/* 画点 */</span></span><br><span class="line">				glPoints(x, y);</span><br><span class="line">				<span class="comment">/* 设置当前颜色RGB，如果取色有变动，以最后的取色为准 */</span></span><br><span class="line">				polygons[con].color[<span class="number">0</span>] = nowColor[<span class="number">0</span>];</span><br><span class="line">				polygons[con].color[<span class="number">1</span>] = nowColor[<span class="number">1</span>];</span><br><span class="line">				polygons[con].color[<span class="number">2</span>] = nowColor[<span class="number">2</span>];</span><br><span class="line">				printf(<span class="string">"polyColor%d%d%d\n"</span>, polygons[con].color[<span class="number">0</span>],polygons[con].color[<span class="number">1</span>],polygons[con].color[<span class="number">2</span>]);</span><br><span class="line">				polygons[con].verNum++;</span><br><span class="line">				printf(<span class="string">"con:%d,verNum:%d\n"</span>, con, polygons[con].verNum);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//程序入口</span></span><br><span class="line"><span class="built_in">int</span> main(<span class="built_in">int</span> argc, char *argv[])&#123;</span><br><span class="line">	<span class="comment">//对GLUT进行初始化，并处理所有的命令行参数</span></span><br><span class="line">	glutInit(&amp;argc, argv);</span><br><span class="line">	<span class="comment">//指定RGB颜色模式和单缓冲窗口</span></span><br><span class="line">	glutInitDisplayMode(GLUT_RGB | GLUT_SINGLE);</span><br><span class="line">	<span class="comment">//定义窗口的位置</span></span><br><span class="line">	glutInitWindowPosition(<span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">	<span class="comment">//定义窗口的大小</span></span><br><span class="line">	glutInitWindowSize(<span class="number">600</span>, <span class="number">600</span>);</span><br><span class="line">	<span class="comment">//创建窗口，同时为之命名</span></span><br><span class="line">	glutCreateWindow(<span class="string">"OpenGL"</span>);</span><br><span class="line">	<span class="comment">//设置窗口清除颜色为白色</span></span><br><span class="line">	glClearColor(<span class="number">1.0f</span>,<span class="number">1.0f</span>,<span class="number">1.0f</span>,<span class="number">1.0f</span>);</span><br><span class="line">	<span class="comment">//参数为一个函数，绘图时这个函数就会被调用</span></span><br><span class="line">	glutDisplayFunc(&amp;display);</span><br><span class="line">	<span class="comment">//参数为一个函数，当窗口大小改变时会被调用</span></span><br><span class="line">	glutReshapeFunc(ChangeSize);</span><br><span class="line">	<span class="comment">/*鼠标点击事件，鼠标点击或者松开时调用 */</span></span><br><span class="line">	glutMouseFunc(mouseClick);</span><br><span class="line">	<span class="comment">//该函数让GLUT框架开始运行，所有设置的回调函数开始工作，直到用户终止程序为止</span></span><br><span class="line">	glutMainLoop();</span><br><span class="line">	<span class="comment">//程序返回</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>小伙伴们可以运行试试看。</p>
                  <h2 id="综述-1"><a href="#综述-1" class="headerlink" title="综述"></a>综述</h2>
                  <p>本节我们主要利用了鼠标时间来实现了取色，设置颜色，并成功通过取点绘制出了各种形状的多边形。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-05-11 01:38:19" itemprop="dateCreated datePublished" datetime="2015-05-11T01:38:19+08:00">2015-05-11</time>
                </span>
                <span id="/1783.html" class="post-meta-item leancloud_visitors" data-flag-title="OpenGL绘图实例七之鼠标设色取点绘图" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>21k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>19 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1776.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> C/C++ <i class="label-arrow"></i>
                  </a>
                  <a href="/1776.html" class="post-title-link" itemprop="url">OpenGL绘图实例六之鼠标监听事件</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>在前面的例子中我们绘制了 2D 机器人以及颜色的填充，另外还有平移放缩变换等等。不过这些绘图方式都有一个特点，那就是无法动态地响应事件，如果我们在例子中加入鼠标点击的响应时间，让图形根据鼠标点击的变化而变化，那将会是非常友好的。 那么这一篇我们就来看一下鼠标响应的实现。</p>
                  <h2 id="鼠标点击"><a href="#鼠标点击" class="headerlink" title="鼠标点击"></a>鼠标点击</h2>
                  <p>对于鼠标点击，无非是左右键，滚轮的点击以及区分按下还是按上。 监听方法如下： <strong>void mouseClick(int btn, int state, int x, int y)</strong> 方法名是任意的，参数有四个，分别是左右键，点击状态（按下还是松开），点击的 x，y 坐标。 那么我们在 main 函数中怎么调用，代码如下</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* 鼠标点击事件，鼠标点击或者松开时调用 */</span></span><br><span class="line">glut<span class="constructor">MouseFunc(<span class="params">mouseClick</span>)</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们利用了类库中提供的方法 <strong>glutMouseFunc()</strong> 这个方法用来监听鼠标事件，我们传入刚才定义的 mouseClick 函数，即可完成调用，同时 mouseClick 函数的参数都会被赋值。 通过上面的代码，在鼠标点击窗口内部时，会自动调用 mouseClick 方法，而且四个参数都会有赋值。可以直接使用这些值来操作。</p>
                  <h2 id="鼠标移动"><a href="#鼠标移动" class="headerlink" title="鼠标移动"></a>鼠标移动</h2>
                  <p><strong>void mouseMove(int x, int y)</strong> 方法名我们也可以任意指定，参数有 2 个，分别是 x，y 在 main 函数中可以这样调用</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/*鼠标移动事件，鼠标按下并移动时调用 */</span></span><br><span class="line">glut<span class="constructor">MotionFunc(<span class="params">mouseMove</span>)</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们利用了类库中提供的方法 <strong>glutMotionFunc()</strong> 同上面的原理，传入了 mouseMove 方法，在鼠标移动时，就可以对 mouseMove 方法的参数进行赋值。</p>
                  <h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2>
                  <p>好了，上面我们说了两个鼠标事件的方法，下面我们用一个例子来感受一下</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">#<span class="keyword">include</span> &lt;glut.h&gt;</span><br><span class="line">#<span class="keyword">include</span> &lt;math.h&gt;</span><br><span class="line">#<span class="keyword">include</span> &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 函数用来画图 */</span></span><br><span class="line">void display(void)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*鼠标点击事件 */</span></span><br><span class="line">void mouse<span class="constructor">Click(<span class="params">int</span> <span class="params">btn</span>, <span class="params">int</span> <span class="params">state</span>, <span class="params">int</span> <span class="params">x</span>, <span class="params">int</span> <span class="params">y</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	printf(<span class="string">"点击了鼠标，btn:%d,state:%d,x:%d,y:%d\n"</span>, btn, state, x, y);</span><br><span class="line">	<span class="keyword">if</span>(btn<span class="operator"> == </span>GLUT_LEFT_BUTTON<span class="operator"> &amp;&amp; </span>state<span class="operator"> == </span>GLUT_DOWN)&#123;</span><br><span class="line">		printf(<span class="string">"按下了左边按钮\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(btn<span class="operator"> == </span>GLUT_LEFT_BUTTON<span class="operator"> &amp;&amp; </span>state<span class="operator"> == </span>GLUT_UP)&#123;</span><br><span class="line">		printf(<span class="string">"松开了左边按钮\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(btn<span class="operator"> == </span>GLUT_RIGHT_BUTTON<span class="operator"> &amp;&amp; </span>state<span class="operator"> == </span>GLUT_DOWN)&#123;</span><br><span class="line">		printf(<span class="string">"按下了右边按钮\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(btn<span class="operator"> == </span>GLUT_RIGHT_BUTTON<span class="operator"> &amp;&amp; </span>state<span class="operator"> == </span>GLUT_UP)&#123;</span><br><span class="line">		printf(<span class="string">"松开了右边按钮\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 鼠标移动事件 */</span></span><br><span class="line">void mouse<span class="constructor">Move(<span class="params">int</span> <span class="params">x</span>, <span class="params">int</span> <span class="params">y</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	printf(<span class="string">"移动鼠标中，x:%d,y%d\n"</span>, x, y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 程序入口 */</span></span><br><span class="line"><span class="built_in">int</span> main(<span class="built_in">int</span> argc, <span class="built_in">char</span> *argv<span class="literal">[]</span>)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/* 对GLUT进行初始化，并处理所有的命令行参数 */</span></span><br><span class="line">	glut<span class="constructor">Init(&amp;<span class="params">argc</span>, <span class="params">argv</span>)</span>;</span><br><span class="line">	<span class="comment">/* 指定RGB颜色模式和单缓冲窗口 */</span></span><br><span class="line">	glut<span class="constructor">InitDisplayMode(GLUT_RGB | GLUT_SINGLE)</span>;</span><br><span class="line">	<span class="comment">/* 定义窗口的位置 */</span></span><br><span class="line">	glut<span class="constructor">InitWindowPosition(100, 100)</span>;</span><br><span class="line">	<span class="comment">/* 定义窗口的大小 */</span></span><br><span class="line">	glut<span class="constructor">InitWindowSize(400, 400)</span>;</span><br><span class="line">	<span class="comment">/* 创建窗口，同时为之命名 */</span></span><br><span class="line">	glut<span class="constructor">CreateWindow(<span class="string">"OpenGL"</span>)</span>;</span><br><span class="line">	<span class="comment">/* 设置窗口清除颜色为白色 */</span></span><br><span class="line">	gl<span class="constructor">ClearColor(1.0f, 1.0f, 1.0f, 1.0f)</span>;</span><br><span class="line">	<span class="comment">/* 参数为一个函数，绘图时这个函数就会被调用 */</span></span><br><span class="line">	glut<span class="constructor">DisplayFunc(&amp;<span class="params">display</span>)</span>;</span><br><span class="line">	<span class="comment">/*鼠标点击事件，鼠标点击或者松开时调用 */</span></span><br><span class="line">	glut<span class="constructor">MouseFunc(<span class="params">mouseClick</span>)</span>;</span><br><span class="line">	<span class="comment">/*鼠标移动事件，鼠标按下并移动时调用 */</span></span><br><span class="line">	glut<span class="constructor">MotionFunc(<span class="params">mouseMove</span>)</span>;</span><br><span class="line">	<span class="comment">/* 该函数让GLUT框架开始运行，所有设置的回调函数开始工作，直到用户终止程序为止 */</span></span><br><span class="line">	glut<span class="constructor">MainLoop()</span>;</span><br><span class="line">	<span class="comment">/*程序返回 */</span></span><br><span class="line">	return(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在上面的代码中，我们监听了鼠标点击和鼠标移动事件，并打印输出了鼠标点击事件的响应。 比如我先点击了鼠标左键，然后点击了鼠标右键。然后移动了鼠标左键，然后移动了鼠标右键。运行结果如下 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/0150511000009.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/0150511000009.jpg" alt="0150511000009"></a> 可以发现它打印输出了鼠标的按钮代号，点击状态，点击的位置。 另外我们发现鼠标点击的坐标原点是左上角，这跟我们之前读取色值的坐标原点（左下角）不一样，也跟我们绘图的坐标原点（中心点）不一样。编程时一定要注意。 获取到了点击点的位置，我们就可以利用这些值来进行相应的作图处理了。 小伙伴们可以尝试一下。</p>
                  <h2 id="综述-1"><a href="#综述-1" class="headerlink" title="综述"></a>综述</h2>
                  <p>本节说的不多，主要是说明了鼠标监听事件的用法。glutMouseFunc 以及 glutMotionFunc，另外通过一个实例来演示了鼠标监听事件的用法，下一篇我们就利用这个知识来进行一个实例演示。大家加油！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-05-11 00:04:11" itemprop="dateCreated datePublished" datetime="2015-05-11T00:04:11+08:00">2015-05-11</time>
                </span>
                <span id="/1776.html" class="post-meta-item leancloud_visitors" data-flag-title="OpenGL绘图实例六之鼠标监听事件" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.4k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1760.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> HTML <i class="label-arrow"></i>
                  </a>
                  <a href="/1760.html" class="post-title-link" itemprop="url">LESS学习记录</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>LESS 包含一套自定义的语法及一个解析器，用户根据这些语法定义自己的样式规则，这些规则最终会通过解析器，编译生成对应的 CSS 文件。LESS 并没有裁剪 CSS 原有的特性，更不是用来取代 CSS 的，而是在现有 CSS 语法的基础上，为 CSS 加入程序式语言的特性。 本文部分内容参考 <a href="http://www.ibm.com/developerworks/cn/web/1207_zhaoch_lesscss/" target="_blank" rel="noopener">官方文档</a></p>
                  <h2 id="编译器"><a href="#编译器" class="headerlink" title="编译器"></a>编译器</h2>
                  <p>建议使用Koala编译器 <a href="http://koala-app.com/index-zh.html" target="_blank" rel="noopener">下载地址</a></p>
                  <h2 id="LESS-原理及使用方式"><a href="#LESS-原理及使用方式" class="headerlink" title="LESS 原理及使用方式"></a>LESS 原理及使用方式</h2>
                  <p>本质上，LESS 包含一套自定义的语法及一个解析器，用户根据这些语法定义自己的样式规则，这些规则最终会通过解析器，编译生成对应的 CSS 文件。LESS 并没有裁剪 CSS 原有的特性，更不是用来取代 CSS 的，而是在现有 CSS 语法的基础上，为 CSS 加入程序式语言的特性。下面是一个简单的例子：</p>
                  <h5 id="清单-1-LESS-文件"><a href="#清单-1-LESS-文件" class="headerlink" title="清单 1. LESS 文件"></a>清单 1. LESS 文件</h5>
                  <figure class="highlight less">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">@color:</span> <span class="number">#4D926F</span>; </span><br><span class="line"></span><br><span class="line"><span class="selector-id">#header</span> &#123; </span><br><span class="line"> <span class="attribute">color</span>: <span class="variable">@color</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="selector-tag">h2</span> &#123; </span><br><span class="line"> <span class="attribute">color</span>: <span class="variable">@color</span>; </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>经过编译生成的 CSS 文件如下：</p>
                  <h5 id="清单-2-CSS-文件"><a href="#清单-2-CSS-文件" class="headerlink" title="清单 2. CSS 文件"></a>清单 2. CSS 文件</h5>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-id">#header</span> &#123; </span><br><span class="line"> <span class="attribute">color</span>: <span class="number">#4D926F</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="selector-tag">h2</span> &#123; </span><br><span class="line"> <span class="attribute">color</span>: <span class="number">#4D926F</span>; </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>从上面的例子可以看出，学习 LESS 非常容易，只要你了解 CSS 基础就可以很容易上手。 LESS 可以直接在客户端使用，也可以在服务器端使用。在实际项目开发中，我们更推荐使用第三种方式，将 LESS 文件编译生成静态 CSS 文件，并在 HTML 文档中应用。</p>
                  <h3 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h3>
                  <p>我们可以直接在客户端使用 .less（LESS 源文件），只需要从 <a href="http://lesscss.org/" target="_blank" rel="noopener">LESSCSS</a> 下载 less.js 文件，然后在我们需要引入 LESS 源文件的 HTML 中加入如下代码：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;link <span class="attribute">rel</span>=<span class="string">"stylesheet/less"</span> <span class="attribute">type</span>=<span class="string">"text/css"</span> <span class="attribute">href</span>=<span class="string">"styles.less"</span>&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>LESS 源文件的引入方式与标准 CSS 文件引入方式一样：</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;link <span class="attribute">rel</span>=<span class="string">"stylesheet/less"</span> <span class="attribute">type</span>=<span class="string">"text/css"</span> <span class="attribute">href</span>=<span class="string">"styles.less"</span>&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>需要注意的是：在引入 .less 文件时，rel 属性要设置为“stylesheet/less”。还有更重要的一点需要注意的是：LESS 源文件一定要在 less.js 引入之前引入，这样才能保证 LESS 源文件正确编译解析。</p>
                  <h3 id="使用编译生成的静态-CSS-文件"><a href="#使用编译生成的静态-CSS-文件" class="headerlink" title="使用编译生成的静态 CSS 文件"></a>使用编译生成的静态 CSS 文件</h3>
                  <p>我们可以通过 LESS 的编译器，将 LESS 文件编译成为 CSS 文件，在 HTML 文章中引入使用。这里要强调的一点，LESS 是完全兼容 CSS 语法的，也就是说，我们可以将标准的 CSS 文件直接改成 .less 格式，LESS 编译器可以完全识别。</p>
                  <h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2>
                  <h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3>
                  <p>LESS 允许开发者自定义变量，变量可以在全局样式中使用，变量使得样式修改起来更加简单。 我们可以从下面的代码了解变量的使用及作用：</p>
                  <h5 id="清单-3-LESS-文件"><a href="#清单-3-LESS-文件" class="headerlink" title="清单 3. LESS 文件"></a>清单 3. LESS 文件</h5>
                  <figure class="highlight less">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">@border-color :</span> <span class="number">#b5bcc7</span>; </span><br><span class="line"></span><br><span class="line"><span class="selector-class">.mythemes</span> <span class="selector-tag">tableBorder</span>&#123; </span><br><span class="line">  <span class="attribute">border </span>: <span class="number">1px</span> solid <span class="variable">@border-color</span>; </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>经过编译生成的 CSS 文件如下：</p>
                  <h5 id="清单-4-CSS-文件"><a href="#清单-4-CSS-文件" class="headerlink" title="清单 4. CSS 文件"></a>清单 4. CSS 文件</h5>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-class">.mythemes</span> <span class="selector-tag">tableBorder</span> &#123; </span><br><span class="line"> <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#b5bcc7</span>; </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>从上面的代码中我们可以看出，变量是 VALUE（值）级别的复用，可以将相同的值定义成变量统一管理起来。 该特性适用于定义主题，我们可以将背景颜色、字体颜色、边框属性等常规样式进行统一定义，这样不同的主题只需要定义不同的变量文件就可以了。当然该特性也同样适用于 CSS RESET（重置样式表），在 Web 开发中，我们往往需要屏蔽浏览器默认的样式行为而需要重新定义样式表来覆盖浏览器的默认行为，这里可以使用 LESS 的变量特性，这样就可以在不同的项目间重用样式表，我们仅需要在不同的项目样式表中，根据需求重新给变量赋值即可。 LESS 中的变量和其他编程语言一样，可以实现值的复用，同样它也有生命周期，也就是 Scope（变量范围，开发人员惯称之为作用域），简单的讲就是局部变量还是全局变量的概念，查找变量的顺序是先在局部定义中找，如果找不到，则查找上级定义，直至全局。下面我们通过一个简单的例子来解释 Scope。</p>
                  <h5 id="清单-5-LESS-文件"><a href="#清单-5-LESS-文件" class="headerlink" title="清单 5. LESS 文件"></a>清单 5. LESS 文件</h5>
                  <figure class="highlight less">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">@width :</span> <span class="number">20px</span>; </span><br><span class="line"><span class="selector-id">#homeDiv</span> &#123; </span><br><span class="line">  <span class="variable">@width :</span> <span class="number">30px</span>; </span><br><span class="line">  <span class="selector-id">#centerDiv</span>&#123; </span><br><span class="line">      <span class="attribute">width </span>: <span class="variable">@width</span>;<span class="comment">// 此处应该取最近定义的变量 width 的值 30px </span></span><br><span class="line">             &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="selector-id">#leftDiv</span> &#123; </span><br><span class="line">    <span class="attribute">width </span>: <span class="variable">@width</span>; <span class="comment">// 此处应该取最上面定义的变量 width 的值 20px </span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>经过编译生成的 CSS 文件如下：</p>
                  <h5 id="清单-6-CSS-文件"><a href="#清单-6-CSS-文件" class="headerlink" title="清单 6. CSS 文件"></a>清单 6. CSS 文件</h5>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-id">#homeDiv</span> <span class="selector-id">#centerDiv</span> &#123; </span><br><span class="line"> <span class="attribute">width</span>: <span class="number">30px</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="selector-id">#leftDiv</span> &#123; </span><br><span class="line"> <span class="attribute">width</span>: <span class="number">20px</span>; </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="Mixins（混入）"><a href="#Mixins（混入）" class="headerlink" title="Mixins（混入）"></a>Mixins（混入）</h3>
                  <p>Mixins（混入）功能对用开发者来说并不陌生，很多动态语言都支持 Mixins（混入）特性，它是多重继承的一种实现，在 LESS 中，混入是指在一个 CLASS 中引入另外一个已经定义的 CLASS，就像在当前 CLASS 中增加一个属性一样。 我们先简单看一下 Mixins 在 LESS 中的使用：</p>
                  <h5 id="清单-7-LESS-文件"><a href="#清单-7-LESS-文件" class="headerlink" title="清单 7. LESS 文件"></a>清单 7. LESS 文件</h5>
                  <figure class="highlight less">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">// 定义一个样式选择器</span></span><br><span class="line"> <span class="selector-class">.roundedCorners</span>(<span class="variable">@radius</span>:<span class="number">5px</span>) &#123; </span><br><span class="line"> <span class="attribute">-moz-border-radius</span>: <span class="variable">@radius</span>; </span><br><span class="line"> <span class="attribute">-webkit-border-radius</span>: <span class="variable">@radius</span>; </span><br><span class="line"> <span class="attribute">border-radius</span>: <span class="variable">@radius</span>; </span><br><span class="line"> &#125; </span><br><span class="line"> <span class="comment">// 在另外的样式选择器中使用</span></span><br><span class="line"> <span class="selector-id">#header</span> &#123; </span><br><span class="line"> <span class="selector-class">.roundedCorners</span>; </span><br><span class="line"> &#125; </span><br><span class="line"> <span class="selector-id">#footer</span> &#123; </span><br><span class="line"> <span class="selector-class">.roundedCorners</span>(<span class="number">10px</span>); </span><br><span class="line"> &#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>经过编译生成的 CSS 文件如下：</p>
                  <h5 id="清单-8-CSS-文件"><a href="#清单-8-CSS-文件" class="headerlink" title="清单 8. CSS 文件"></a>清单 8. CSS 文件</h5>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-id">#header</span> &#123; </span><br><span class="line"><span class="attribute">-moz-border-radius</span>:<span class="number">5px</span>; </span><br><span class="line"><span class="attribute">-webkit-border-radius</span>:<span class="number">5px</span>; </span><br><span class="line"><span class="attribute">border-radius</span>:<span class="number">5px</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="selector-id">#footer</span> &#123; </span><br><span class="line"><span class="attribute">-moz-border-radius</span>:<span class="number">10px</span>; </span><br><span class="line"><span class="attribute">-webkit-border-radius</span>:<span class="number">10px</span>; </span><br><span class="line"><span class="attribute">border-radius</span>:<span class="number">10px</span>; </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>从上面的代码我们可以看出：Mixins 其实是一种嵌套，它允许将一个类嵌入到另外一个类中使用，被嵌入的类也可以称作变量，简单的讲，Mixins 其实是规则级别的复用。 Mixins 还有一种形式叫做 Parametric Mixins（混入参数），LESS 也支持这一特性：</p>
                  <h5 id="清单-9-LESS-文件"><a href="#清单-9-LESS-文件" class="headerlink" title="清单 9. LESS 文件"></a>清单 9. LESS 文件</h5>
                  <figure class="highlight less">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">// 定义一个样式选择器</span></span><br><span class="line"> <span class="selector-class">.borderRadius</span>(<span class="variable">@radius</span>)&#123; </span><br><span class="line"> <span class="attribute">-moz-border-radius</span>: <span class="variable">@radius</span>; </span><br><span class="line"> <span class="attribute">-webkit-border-radius</span>: <span class="variable">@radius</span>; </span><br><span class="line"> <span class="attribute">border-radius</span>: <span class="variable">@radius</span>; </span><br><span class="line"> &#125; </span><br><span class="line"> <span class="comment">// 使用已定义的样式选择器</span></span><br><span class="line"> <span class="selector-id">#header</span> &#123; </span><br><span class="line"> <span class="selector-class">.borderRadius</span>(<span class="number">10px</span>); <span class="comment">// 把 10px 作为参数传递给样式选择器</span></span><br><span class="line"> &#125; </span><br><span class="line"> <span class="selector-class">.btn</span> &#123; </span><br><span class="line"> <span class="selector-class">.borderRadius</span>(<span class="number">3px</span>);<span class="comment">// // 把 3px 作为参数传递给样式选择器</span></span><br><span class="line"></span><br><span class="line"> &#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>经过编译生成的 CSS 文件如下：</p>
                  <h5 id="清单-10-CSS-文件"><a href="#清单-10-CSS-文件" class="headerlink" title="清单 10. CSS 文件"></a>清单 10. CSS 文件</h5>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-id">#header</span> &#123; </span><br><span class="line"><span class="attribute">-moz-border-radius</span>: <span class="number">10px</span>; </span><br><span class="line"><span class="attribute">-webkit-border-radius</span>: <span class="number">10px</span>; </span><br><span class="line"><span class="attribute">border-radius</span>: <span class="number">10px</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="selector-class">.btn</span> &#123; </span><br><span class="line"><span class="attribute">-moz-border-radius</span>: <span class="number">3px</span>; </span><br><span class="line"><span class="attribute">-webkit-border-radius</span>: <span class="number">3px</span>; </span><br><span class="line"><span class="attribute">border-radius</span>: <span class="number">3px</span>; </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们还可以给 Mixins 的参数定义一人默认值，如</p>
                  <h5 id="清单-11-LESS-文件"><a href="#清单-11-LESS-文件" class="headerlink" title="清单 11. LESS 文件"></a>清单 11. LESS 文件</h5>
                  <figure class="highlight less">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-class">.borderRadius</span>(<span class="variable">@radius</span>:<span class="number">5px</span>)&#123; </span><br><span class="line"> <span class="attribute">-moz-border-radius</span>: <span class="variable">@radius</span>; </span><br><span class="line"> <span class="attribute">-webkit-border-radius</span>: <span class="variable">@radius</span>; </span><br><span class="line"> <span class="attribute">border-radius</span>: <span class="variable">@radius</span>; </span><br><span class="line"> &#125; </span><br><span class="line"> <span class="selector-class">.btn</span> &#123; </span><br><span class="line"> <span class="selector-class">.borderRadius</span>; </span><br><span class="line"> &#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>经过编译生成的 CSS 文件如下：</p>
                  <h5 id="清单-12-CSS-文件"><a href="#清单-12-CSS-文件" class="headerlink" title="清单 12. CSS 文件"></a>清单 12. CSS 文件</h5>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-class">.btn</span> &#123; </span><br><span class="line"><span class="attribute">-moz-border-radius</span>: <span class="number">5px</span>; </span><br><span class="line"><span class="attribute">-webkit-border-radius</span>: <span class="number">5px</span>; </span><br><span class="line"><span class="attribute">border-radius</span>: <span class="number">5px</span>; </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>像 JavaScript 中 <strong>arguments</strong>一样，Mixins 也有这样一个变量：<strong>@arguments</strong>。@arguments 在 Mixins 中具是一个很特别的参数，当 Mixins 引用这个参数时，该参数表示所有的变量，很多情况下，这个参数可以省去你很多代码。</p>
                  <h5 id="清单-13-LESS-文件"><a href="#清单-13-LESS-文件" class="headerlink" title="清单 13. LESS 文件"></a>清单 13. LESS 文件</h5>
                  <figure class="highlight less">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-class">.boxShadow</span>(<span class="variable">@x</span>:<span class="number">0</span>,<span class="variable">@y</span>:<span class="number">0</span>,<span class="variable">@blur</span>:<span class="number">1px</span>,<span class="variable">@color</span>:<span class="number">#000</span>)&#123; </span><br><span class="line"><span class="attribute">-moz-box-shadow</span>: <span class="variable">@arguments</span>; </span><br><span class="line"><span class="attribute">-webkit-box-shadow</span>: <span class="variable">@arguments</span>; </span><br><span class="line"><span class="attribute">box-shadow</span>: <span class="variable">@arguments</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="selector-id">#header</span> &#123; </span><br><span class="line"><span class="selector-class">.boxShadow</span>(<span class="number">2px</span>,<span class="number">2px</span>,<span class="number">3px</span>,<span class="number">#f36</span>); </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>经过编译生成的 CSS 文件如下：</p>
                  <h5 id="清单-14-CSS-文件"><a href="#清单-14-CSS-文件" class="headerlink" title="清单 14. CSS 文件"></a>清单 14. CSS 文件</h5>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-id">#header</span> &#123; </span><br><span class="line"><span class="attribute">-moz-box-shadow</span>: <span class="number">2px</span> <span class="number">2px</span> <span class="number">3px</span> <span class="number">#FF36</span>; </span><br><span class="line"><span class="attribute">-webkit-box-shadow</span>: <span class="number">2px</span> <span class="number">2px</span> <span class="number">3px</span> <span class="number">#FF36</span>; </span><br><span class="line"><span class="attribute">box-shadow</span>: <span class="number">2px</span> <span class="number">2px</span> <span class="number">3px</span> <span class="number">#FF36</span>; </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>Mixins 是 LESS 中很重要的特性之一，我们这里也写了很多例子，看到这些例子你是否会有这样的疑问：当我们拥有了大量选择器的时候，特别是团队协同开发时，如何保证选择器之间重名问题？如果你是 java 程序员或 C++ 程序员，我猜你肯定会想到命名空间 Namespaces，LESS 也采用了命名空间的方法来避免重名问题，于是乎 LESS 在 mixins 的基础上扩展了一下，看下面这样一段代码：</p>
                  <h5 id="清单-15-LESS-文件"><a href="#清单-15-LESS-文件" class="headerlink" title="清单 15. LESS 文件"></a>清单 15. LESS 文件</h5>
                  <figure class="highlight nimrod">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">#mynamespace &#123; </span></span><br><span class="line">.home <span class="meta">&#123;...&#125;</span> </span><br><span class="line">.user <span class="meta">&#123;...&#125;</span> </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样我们就定义了一个名为 mynamespace 的命名空间，如果我们要复用 user 这个选择器的时候，我们只需要在需要混入这个选择器的地方这样使用就可以了。#mynamespace &gt; .user。</p>
                  <h3 id="嵌套的规则"><a href="#嵌套的规则" class="headerlink" title="嵌套的规则"></a>嵌套的规则</h3>
                  <p>在我们书写标准 CSS 的时候，遇到多层的元素嵌套这种情况时，我们要么采用从外到内的选择器嵌套定义，要么采用给特定元素加 CLASS 或 ID 的方式。在 LESS 中我们可以这样写：</p>
                  <h5 id="清单-16-HTML-片段"><a href="#清单-16-HTML-片段" class="headerlink" title="清单 16. HTML 片段"></a>清单 16. HTML 片段</h5>
                  <figure class="highlight applescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;<span class="keyword">div</span> <span class="built_in">id</span>=<span class="string">"home"</span>&gt; </span><br><span class="line">&lt;<span class="keyword">div</span> <span class="built_in">id</span>=<span class="string">"top"</span>&gt;top&lt;/<span class="keyword">div</span>&gt; </span><br><span class="line">&lt;<span class="keyword">div</span> <span class="built_in">id</span>=<span class="string">"center"</span>&gt; </span><br><span class="line">&lt;<span class="keyword">div</span> <span class="built_in">id</span>=<span class="string">"left"</span>&gt;left&lt;/<span class="keyword">div</span>&gt; </span><br><span class="line">&lt;<span class="keyword">div</span> <span class="built_in">id</span>=<span class="string">"right"</span>&gt;right&lt;/<span class="keyword">div</span>&gt; </span><br><span class="line">&lt;/<span class="keyword">div</span>&gt; </span><br><span class="line">&lt;/<span class="keyword">div</span>&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h5 id="清单-17-LESS-文件"><a href="#清单-17-LESS-文件" class="headerlink" title="清单 17. LESS 文件"></a>清单 17. LESS 文件</h5>
                  <figure class="highlight scss">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-id">#home</span>&#123; </span><br><span class="line">  <span class="attribute">color</span> : blue; </span><br><span class="line">  <span class="attribute">width</span> : <span class="number">600px</span>; </span><br><span class="line">  <span class="attribute">height</span> : <span class="number">500px</span>; </span><br><span class="line">  <span class="attribute">border</span>:outset; </span><br><span class="line">  <span class="selector-id">#top</span>&#123; </span><br><span class="line">       <span class="attribute">border</span>:outset; </span><br><span class="line">       <span class="attribute">width</span> : <span class="number">90%</span>; </span><br><span class="line">  &#125; </span><br><span class="line">  <span class="selector-id">#center</span>&#123; </span><br><span class="line">       <span class="attribute">border</span>:outset; </span><br><span class="line">       <span class="attribute">height</span> : <span class="number">300px</span>; </span><br><span class="line">       <span class="attribute">width</span> : <span class="number">90%</span>; </span><br><span class="line">       <span class="selector-id">#left</span>&#123; </span><br><span class="line">         <span class="attribute">border</span>:outset; </span><br><span class="line">         <span class="attribute">float</span> : left; </span><br><span class="line"> <span class="attribute">width</span> : <span class="number">40%</span>; </span><br><span class="line">       &#125; </span><br><span class="line">       <span class="selector-id">#right</span>&#123; </span><br><span class="line">         <span class="attribute">border</span>:outset; </span><br><span class="line">         <span class="attribute">float</span> : left; </span><br><span class="line"> <span class="attribute">width</span> : <span class="number">40%</span>; </span><br><span class="line">       &#125; </span><br><span class="line">   &#125; </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>经过编译生成的 CSS 文件如下：</p>
                  <h5 id="清单-18-CSS-文件"><a href="#清单-18-CSS-文件" class="headerlink" title="清单 18. CSS 文件"></a>清单 18. CSS 文件</h5>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-id">#home</span> &#123; </span><br><span class="line"> <span class="attribute">color</span>: blue; </span><br><span class="line"> <span class="attribute">width</span>: <span class="number">600px</span>; </span><br><span class="line"> <span class="attribute">height</span>: <span class="number">500px</span>; </span><br><span class="line"> <span class="attribute">border</span>: outset; </span><br><span class="line">&#125; </span><br><span class="line"><span class="selector-id">#home</span> <span class="selector-id">#top</span> &#123; </span><br><span class="line"> <span class="attribute">border</span>: outset; </span><br><span class="line"> <span class="attribute">width</span>: <span class="number">90%</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="selector-id">#home</span> <span class="selector-id">#center</span> &#123; </span><br><span class="line"> <span class="attribute">border</span>: outset; </span><br><span class="line"> <span class="attribute">height</span>: <span class="number">300px</span>; </span><br><span class="line"> <span class="attribute">width</span>: <span class="number">90%</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="selector-id">#home</span> <span class="selector-id">#center</span> <span class="selector-id">#left</span> &#123; </span><br><span class="line"> <span class="attribute">border</span>: outset; </span><br><span class="line"> <span class="attribute">float</span>: left; </span><br><span class="line"> <span class="attribute">width</span>: <span class="number">40%</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="selector-id">#home</span> <span class="selector-id">#center</span> <span class="selector-id">#right</span> &#123; </span><br><span class="line"> <span class="attribute">border</span>: outset; </span><br><span class="line"> <span class="attribute">float</span>: left; </span><br><span class="line"> <span class="attribute">width</span>: <span class="number">40%</span>; </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>从上面的代码中我们可以看出，LESS 的嵌套规则的写法是 HTML 中的 DOM 结构相对应的，这样使我们的样式表书写更加简洁和更好的可读性。同时，嵌套规则使得对伪元素的操作更为方便。</p>
                  <h5 id="清单-19-LESS-文件"><a href="#清单-19-LESS-文件" class="headerlink" title="清单 19. LESS 文件"></a>清单 19. LESS 文件</h5>
                  <figure class="highlight scss">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">a</span> &#123; </span><br><span class="line"> <span class="attribute">color</span>: red; </span><br><span class="line"> <span class="attribute">text-decoration</span>: none; </span><br><span class="line"> &amp;<span class="selector-pseudo">:hover</span> &#123;<span class="comment">// 有 &amp; 时解析的是同一个元素或此元素的伪类，没有 &amp; 解析是后代元素</span></span><br><span class="line">  <span class="attribute">color</span>: black; </span><br><span class="line">  <span class="attribute">text-decoration</span>: underline; </span><br><span class="line"> &#125; </span><br><span class="line"> &#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>经过编译生成的 CSS 文件如下：</p>
                  <h5 id="清单-20-CSS-文件"><a href="#清单-20-CSS-文件" class="headerlink" title="清单 20. CSS 文件"></a>清单 20. CSS 文件</h5>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">a</span> &#123; </span><br><span class="line"><span class="attribute">color</span>: red; </span><br><span class="line"><span class="attribute">text-decoration</span>: none; </span><br><span class="line">&#125; </span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123; </span><br><span class="line"><span class="attribute">color</span>: black; </span><br><span class="line"><span class="attribute">text-decoration</span>: underline; </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="运算及函数"><a href="#运算及函数" class="headerlink" title="运算及函数"></a>运算及函数</h3>
                  <p>在我们的 CSS 中充斥着大量的数值型的 value，比如 color、padding、margin 等，这些数值之间在某些情况下是有着一定关系的，那么我们怎样利用 LESS 来组织我们这些数值之间的关系呢？我们来看这段代码：</p>
                  <h5 id="清单-21-LESS-文件"><a href="#清单-21-LESS-文件" class="headerlink" title="清单 21 . LESS 文件"></a>清单 21 . LESS 文件</h5>
                  <figure class="highlight less">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="variable">@init:</span> <span class="number">#111111</span>; </span><br><span class="line"><span class="variable">@transition:</span> <span class="variable">@init</span>*<span class="number">2</span>; </span><br><span class="line"><span class="selector-class">.switchColor</span> &#123; </span><br><span class="line"><span class="attribute">color</span>: <span class="variable">@transition</span>; </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>经过编译生成的 CSS 文件如下：</p>
                  <h5 id="清单-22-CSS-文件"><a href="#清单-22-CSS-文件" class="headerlink" title="清单 22. CSS 文件"></a>清单 22. CSS 文件</h5>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-class">.switchColor</span> &#123; </span><br><span class="line"> <span class="attribute">color</span>: <span class="number">#222222</span>; </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>上面的例子中使用 LESS 的 operation 是 特性，其实简单的讲，就是对数值型的 value（数字、颜色、变量等）进行加减乘除四则运算。同时 LESS 还有一个专门针对 color 的操作提供一组函数。下面是 LESS 提供的针对颜色操作的函数列表：</p>
                  <figure class="highlight less">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">lighten</span>(<span class="variable">@color</span>, <span class="number">10%</span>); <span class="comment">// return a color which is 10% *lighter* than @color </span></span><br><span class="line"><span class="selector-tag">darken</span>(<span class="variable">@color</span>, <span class="number">10%</span>); <span class="comment">// return a color which is 10% *darker* than @color </span></span><br><span class="line"><span class="selector-tag">saturate</span>(<span class="variable">@color</span>, <span class="number">10%</span>); <span class="comment">// return a color 10% *more* saturated than @color </span></span><br><span class="line"><span class="selector-tag">desaturate</span>(<span class="variable">@color</span>, <span class="number">10%</span>);<span class="comment">// return a color 10% *less* saturated than @color </span></span><br><span class="line"><span class="selector-tag">fadein</span>(<span class="variable">@color</span>, <span class="number">10%</span>); <span class="comment">// return a color 10% *less* transparent than @color </span></span><br><span class="line"><span class="selector-tag">fadeout</span>(<span class="variable">@color</span>, <span class="number">10%</span>); <span class="comment">// return a color 10% *more* transparent than @color </span></span><br><span class="line"><span class="selector-tag">spin</span>(<span class="variable">@color</span>, <span class="number">10</span>); <span class="comment">// return a color with a 10 degree larger in hue than @color </span></span><br><span class="line"><span class="selector-tag">spin</span>(<span class="variable">@color</span>, -<span class="number">10</span>); <span class="comment">// return a color with a 10 degree smaller hue than @color</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>PS: 上述代码引自 LESS CSS 官方网站，详情请见 <a href="http://lesscss.org/#-color-functions" target="_blank" rel="noopener">http://lesscss.org/#-color-functions</a> 使用这些函数和 JavaScript 中使用函数一样。</p>
                  <h5 id="清单-23-LESS-文件"><a href="#清单-23-LESS-文件" class="headerlink" title="清单 23. LESS 文件"></a>清单 23. LESS 文件</h5>
                  <figure class="highlight less">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">init</span>: <span class="number">#f04615</span>; </span><br><span class="line"> <span class="selector-id">#body</span> &#123; </span><br><span class="line">  <span class="attribute">background-color</span>: fadein(<span class="variable">@init</span>, <span class="number">10%</span>); </span><br><span class="line"> &#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>经过编译生成的 CSS 文件如下：</p>
                  <h5 id="清单-24-CSS-文件"><a href="#清单-24-CSS-文件" class="headerlink" title="清单 24. CSS 文件"></a>清单 24. CSS 文件</h5>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-id">#body</span> &#123; </span><br><span class="line"> <span class="attribute">background-color</span>: <span class="number">#f04615</span>; </span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>从上面的例子我们可以发现，这组函数像极了 JavaScript 中的函数，它可以被调用和传递参数。这些函数的主要作用是提供颜色变换的功能，先把颜色转换成 HSL 色，然后在此基础上进行操作，LESS 还提供了获取颜色值的方法，在这里就不举例说明了。 LESS 提供的运算及函数特性适用于实现页面组件特性，比如组件切换时的渐入渐出。</p>
                  <h3 id="模式匹配"><a href="#模式匹配" class="headerlink" title="模式匹配"></a>模式匹配</h3>
                  <h5 id="清单-25-LESS文件"><a href="#清单-25-LESS文件" class="headerlink" title="清单 25. LESS文件"></a>清单 25. LESS文件</h5>
                  <figure class="highlight less">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-class">.tri</span>&#123;</span><br><span class="line">	<span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">	<span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">	<span class="attribute">overflow</span>: hidden;</span><br><span class="line">	<span class="selector-class">.triangle</span>(bottom);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.triangle</span>(top,<span class="variable">@w</span>:<span class="number">5px</span>,<span class="variable">@c</span>:<span class="number">#CCC</span>)&#123;</span><br><span class="line">	<span class="attribute">border-width</span>: <span class="variable">@w</span>;</span><br><span class="line">	<span class="attribute">border-color</span>: transparent transparent red transparent;</span><br><span class="line">	<span class="attribute">border-style</span>: dashed dashed solid dashed;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.triangle</span>(bottom,<span class="variable">@w</span>:<span class="number">5px</span>,<span class="variable">@c</span>:<span class="number">#CCC</span>)&#123;</span><br><span class="line">	<span class="attribute">border-width</span>: <span class="variable">@w</span>;</span><br><span class="line">	<span class="attribute">border-color</span>: red transparent transparent  transparent;</span><br><span class="line">	<span class="attribute">border-style</span>: solid dashed dashed  dashed;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h5 id="清单-26-CSS文件"><a href="#清单-26-CSS文件" class="headerlink" title="清单 26. CSS文件"></a>清单 26. CSS文件</h5>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-class">.tri</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">border-width</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">border-color</span>: red transparent transparent  transparent;</span><br><span class="line">  <span class="attribute">border-style</span>: solid dashed dashed  dashed;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过以上可以看出，我们可以在LESS中定义相同名字的样式，第一个参数不同，在调用时可以通过传入第一个参数进行匹配，得到不同的样式即可。</p>
                  <h3 id="避免编译"><a href="#避免编译" class="headerlink" title="避免编译"></a>避免编译</h3>
                  <h5 id="清单27-LESS文件"><a href="#清单27-LESS文件" class="headerlink" title="清单27. LESS文件"></a>清单27. LESS文件</h5>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-class">.test</span>&#123;</span><br><span class="line">	<span class="attribute">width</span>:<span class="built_in">calc</span>(<span class="number">300px</span>-<span class="number">30px</span>);</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h5 id="清单28-CSS文件"><a href="#清单28-CSS文件" class="headerlink" title="清单28. CSS文件"></a>清单28. CSS文件</h5>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-class">.test</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="built_in">calc</span>(<span class="number">270px</span>);</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>有时候一些样式如果编译了之后就会产生不必要的麻烦，如果我们不想要编译，可以改写如下</p>
                  <h5 id="清单29-LESS文件"><a href="#清单29-LESS文件" class="headerlink" title="清单29. LESS文件"></a>清单29. LESS文件</h5>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-class">.test</span>&#123;</span><br><span class="line">	<span class="attribute">width</span>:~<span class="string">'calc(300px-30px)'</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h5 id="清单30-CSS文件"><a href="#清单30-CSS文件" class="headerlink" title="清单30. CSS文件"></a>清单30. CSS文件</h5>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-class">.test</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="built_in">calc</span>(<span class="number">300px</span>-<span class="number">30px</span>);</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过在前面加上一个 ~然后将内容用引号引起来，就可以避免编译了。</p>
                  <h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2>
                  <p>本文提到的只是 LESS 的基本功能，更高级的功能如：字符串插值，服务器端使用配置，JavaScript 表达式，避免编译等可以参看 LESS 的官方网站。 LESS 以 CSS 语法为基础，又借用了很多我们熟知编程式语言的特性，这对于我们开发人员来讲学习成本几乎可以忽略，它在保留 CSS 语法的基础上扩展了更多实用的功能，LESS 为我们提供了一种新的编写样式表的方法，我们可以根据我们的项目特性选择使用 LESS 的部分特性，我们只需用很少的成本就可以换了很大的回报，一句话，Less is more，借助 LESS 可以更便捷的进行 Web 开发。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-05-08 14:16:19" itemprop="dateCreated datePublished" datetime="2015-05-08T14:16:19+08:00">2015-05-08</time>
                </span>
                <span id="/1760.html" class="post-meta-item leancloud_visitors" data-flag-title="LESS学习记录" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>8.2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>7 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1722.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 个人日记 <i class="label-arrow"></i>
                  </a>
                  <a href="/1722.html" class="post-title-link" itemprop="url">记一次泰安方特之旅</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>等啊等，终于等到五一放假，这次必须要出去好好玩一番，解脱一下，释放一下。经过一系列思想斗争，最终决定去泰安方特了！昨天方特之旅结束之后，甚是爽快，在此记流水账一篇，不喜勿喷哈！ 话说回来还是要先说五月二号啊，简直了，本来打算是在五月二号去的，带上室友小周周和隔壁的花花学长。一号那天我定了第二天的火车，早上 7 点半的火车，室友小周周也提前约好了出租车，准备早上六点出发去火车站。万事俱备只欠东风了，当天晚上早早滚去睡觉，定好五点半的闹钟，准备静静等待闹钟的响起。可是，可是，一切都是来得那么突然，第二天一大早起来竟然下雨了！泰安那边下雨了！天哪，睡之前我还特意看了看二号是多云啊！这不是坑爹吗？下雨就下雨吧，可是你不知道下雨方特室外项目是不开放的好嘛！顿时心都凉了。╮(╯▽╰)╭ 哎，改签吧，小周周给那位出租司机打电话，我去重新改签票。嗯，又一个坑爹的事情发生了，7 点之前网上购票是不开放的好嘛？发车前两小时是不能在网上改签和退票的好嘛？哎，算了，还好票便宜，才十二块五，索性我不要了！不要了！默默去买了三号的车票，特么的还是无座啊，无座。哎，多么痛的领悟，╮(╯▽╰)╭。 然后，然后，就默默等到了三号，还是五点半的闹钟，这次终于不下雨了！苍天啊！带上手机，耳机，money，学僧证，充电宝，六点出门坐上 TAXI，朝火车站奔去，这次是真快啊这速度，路上都没车的，一路狂奔，竟然六点半多点就到了火车站了，可是我们七点半的火车啊，这不是坑爹吗？于是乎，我们决定改签一下提前一点，有个七点稍多的一趟车，于是乎我们兴冲冲地跑向了改签大厅，惊呆了！怎么它就那么长的队伍，哦你，那么长，么长，长。试着排了排，二十分钟往前走了不到十步，也是醉了。哎，默默走掉，去候车室等着吧，七点半就七点半！ 呼呼呼，检票咯，K771，我们走上站台，看到一条漫长的绿皮车，不是说好的无座吗？怎么这么多空座，我们三个找到一个就坐下来，不得不再次吐槽一下这种座位真难受。早上好困，睡觉睡觉，带上耳机听着歌，像打坐一样睡着了，就那么睡着了，我好佩服我自己。睡了一个小时，一睁眼，泰山站到了，不错不错，下车，出发。 出站了，果然不出我所料，好多人都拿着牌子，问去方特吗？免费接送，立即出发，同时卖门票，220 一位，其实方特门票就是 220 的，学生票可能就便宜 10 块钱。哎，这样就这样吧，他们是打着免费接送的名义，实质钱都包含在门票里面了。我们也担心方特人特别多，到时候买票排个时候，就直接跟着他走吧，反正也贵不了多少。 车是一个公交车，等人来齐了一起发车出发，我们几个竟然赶到了第一波，进去的时候车是空的，要等到其他人来才发车，这不是坑爹吗？坑爹吗？说好的立马出发的呢？算了，不计较这些了，其实等了也没多久就走了。在车上交了钱买了门票，那个收钱的人（姑且叫导游吧）跟我们讲了方特的各个注意事项，还是挺贴心的嘛！在这里透露给大家一点，记不住的我就记不住了。 包包最好要寄存起来，最好寄存在方特外面，比较便宜，当然也可以背着如果你不嫌沉的话。 贵重物品一定要看管好，方特里面丢的最多的就是数码相机，然后是手机，保管好了就行咯。 如果你不想一开始就玩惊险刺激的，建议从右边开始玩，如果你一开始就想玩刺激的，建议还是从右边开始玩哈哈哈。 项链啊首饰啊最好要收起来，要不然你想体验在空中翻滚的时候项链打到牙的感受吗？ 哦，其他的忘了，我也不知道他说了多少了，可能比较健忘，记不起来还有啥了。后面的我就根据我的亲身体验来说了，哈哈。 走了半个多小时，终于到了！我们去存上包，买好雨衣以防神秘河谷的时候淋湿。正式进门！进门！冲冲冲！方特之旅正式开始！差不多九点半！ 放个地图先 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/20150504150649.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/20150504150649.jpg" alt="20150504150649"></a> 恩，进去看过去就是一个方特城堡，好有艺术气息的，旁边还放着欢乐的音乐，走在小路上，还有阳光照射着，哈哈不错。而且关键是路上人好少啊，哈哈，是不是五月三号外地的都回家了呢？是吗？后面你就知道了。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/4d6577b5ga2451346b0fc690690.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/4d6577b5ga2451346b0fc690690.jpg" alt="4d6577b5ga2451346b0fc&amp;690&amp;690"></a> 恩，我们没有进城堡玩，直接奔向右边的飞跃极限。噢丫，谁说的人少的？谁说的人少的？人都跑进来了，排队啊，一层、两层、三层…不数了，心好累。也就十来层吧。排个毛线，我们直接冲向了下一站，神秘河谷。PO 个图先 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/255405771681257058.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/255405771681257058.jpg" alt="25540577,1681257058&amp;"></a> 简直是人品好，我们进去的时候竟然排到了前面，是不是刚开放就被我们赶上了呢？而且，我们赶上了第一波。这次在外面买的雨衣派上用场了，穿上我们的半透明红色雨衣，带上蓝色高筒鞋套，上船。船一排四个人，一共好像是五排吧，我们很果断地选择了第一排，雨衣全部裹起来。准备冲，看到图了吗？这是一个小船从河谷里面二十米高空俯冲下来的样子，看那浪花。这次我们真正地感受到了它的魅力。河谷里面其实是有两个小下坡的，第一次比较小，杀杀你的锐气，第二次就是图中这个超大的下坡，从楼顶的那个位置冲下来，自己想象！第一次下坡还好，等到第二次下坡的时候，啊啊啊啊，二三十米高空俯冲，那种朝下的重力加速度深深牵引着我们，俯冲的时候我们叫喊着，咆哮着，嘶吼着，身心全部都感受着重力加速，咣！超大的浪花被我们激起来了，溅起十多米，丫的坑爹的是浪花不只是超前喷的啊，特么的它在空中划了一道优美的弧线直接想瓢泼一样泼到了我们身上啊，尤其是第一排啊第一排，最惨烈啊，尼玛我当初怎么就选了第一排啊，这不是坑爹吗？我真的是穿了雨衣，但是我屁股底下的雨衣不够长啊，水落到了座位上，然后水就浸到我的裤子里面去了啊，一阵凉意袭来，嗖嗖嗖，我屁股湿了，湿了。坑爹啊，这雨衣抵了个毛用啊。随后船缓缓划回去，出来的时候我走出来，屁股底下湿了一片，像尿了裤子一样，怎么能这样啊？我才玩了一个就湿了，湿了啊，╭(╯^╰)╮ 怎么这样。 还好太阳好，我就叉开腿走着，自己想象！赶紧的太阳把我的裤子晒干吧。接下来我们去了维苏威火山，听说这个还不错。果然，走到旁边就听到了火山里面一群人的嘶吼，开始排队吧，人也不大多啊，应该还是人品好的缘故吧，嗖嗖就排上了。PO 个图先 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/3e4c18d1g778440eee0a9690.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/3e4c18d1g778440eee0a9690.jpg" alt="3e4c18d1g778440eee0a9&amp;690"></a> 对，就是这么酷炫，这就是传说中的过山车，一个个小匣子接起来，我和花花坐在了一个匣子里，抓紧扶手，小车就开动了，呼呼呼，伴随着轮子的摩擦，伴随着我们的尖叫，在急转弯的地方，车呼啸而过，整个人有种呼之欲出的感觉，巨大的离心力简直爽到爆。一个又一个急转，一次又一次的钻洞，一声又一声的呐喊，一下又一下的心跳。自行想象！ 出来之后旁边有个火流星，可是排队的人太多了，机智的我们就继续绕，看到有一个影视特技演出室刚开放，就跑进去了。尼玛一进去就是一个人在表演剁手，当然那刀是假的，duang，duang，duang，加了特效而已，后来欣赏了一点电影特效制作的过程，整体不算经验刺激，还说得过去吧。 后来继续绕，到了未来警察和生命之光那里，可惜的是都没有到开放的点，就去了星际航班，这下排队的人真多，到底什么鬼，干嘛的。我先 PO 个图 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/500_6935_7e6f4c36_7e6f4c36-e1430727030482.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/500_6935_7e6f4c36_7e6f4c36-e1430727030482.jpg" alt=""></a> 别看这个外面有个火箭什么的，这么酷炫，其实进去啊，我总算见识到了，排了半个小时队，最后二十个人坐在一个舱里，这个舱是可以动的，上下左右倾斜，可以模拟一下加速度什么的，然后整个前面就是一个超大的圆形幕布，像放电影一样，来给你模拟一个飞行的过程。随着画面的切换，舱左右摆动，也算是逼真。出来之后看到外面这个火箭，我本来还真以为要飞天呢，结果给我整这么一出，我也是醉醉的。 接下来就是恐龙危机了，一走过去吓我一跳啊，这是什么玩意翻了啊，上面的字怎么还是倒着的？好吧，经过缓过神来，不得不佩服这建筑真是溜啊，真是设计师逼死建筑师的典范啊，来来来，看图你就知道我为啥这么说了，尼玛这整个建筑都被恐龙掀翻了好嘛？ <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/XocG88iM553THvvg.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/XocG88iM553THvvg.jpg" alt="XocG88iM553THvvg"></a> 虽然外面看着是倒着的，不过进去之后是正着的。呸，我这不废话么，倒着谁能走啊？进去也是想刚才那样，几个人坐在一个小车里，有个跑道，小车会在跑道上走，有时候转来转去。而四周当然就是恐龙咯，带上 4D 眼镜，能够看到周围银幕上一只只恐龙扑过来，小车上还有各种音效。小车有时候没油了，有时候加速了，有时候甩尾了，有时候弹飞了，模拟得非常逼真。特么的走到一个地方上面突然出现一个霸王龙头啊，这次不是屏幕出来的啊，是实物啊，一动一动的，它的牙像魔鬼的爪牙，还迈着魔鬼的步伐，在我不经意间粗线了啊，不能忍，特么的还长着嘴朝着我吼啊，吓尿了有木有。晃来晃去，这破小车终于抵达了传说中的安全地带，我也解脱出来了，╭(╯^╰)╮。臭霸王龙。 哎呦终于出来了，这也不能光玩室内的啊，来点室外的体验一把。于是乎，我们走到了一个叫波浪翻滚的东西那里，我了个去，这不就是济南泉城公园里面的遨游太空加强版吗？ 遨游太空是这样子的 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/20150504202138.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/20150504202138.jpg" alt="20150504202138"></a> 这里的波浪翻滚是这样子的，这何止是一样啊，这简直就是一样啊！ <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/1278644413015_1_o.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/1278644413015_1_o.jpg" alt="1278644413015_1_o"></a> 坐在那上面，就尽情地摇摆摇摆吧，飞上来，飞上去，有时候这玩意还是倾斜的啊，哦飞天的感觉真爽哈哈哈！ 接下来就是传说中的大摆锤了，据说好多人都在这一关不行不行的了，上吐下泻的统统地都有。我记得还有人说买了一张票一开始就坐了个大摆锤，直接不行了，后面的项目都玩不了了，合着 220 块钱就坐了个这个，真值！我还是准备挑战一下，会会它，看看这玩意到底多么厉害。先 PO 图一张。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/20131119GAig3-e1430744520488.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/20131119GAig3-e1430744520488.jpg" alt="20131119GAig3"></a> 嗯，就是这个样子滴，它一边摆，一边转啊，最开始摆的角度是很小的，后来最高的时候都有 90 度了吧，我一边承受着离心力，一边又在半空中飘荡，简直有一种超凡脱俗的感觉。啊，当到达最高点的时候，我整个人横在了半空中同时围绕着中间的转轴在转啊，转啊。神马姿态，多么优美啊！我当时脑子里在想神马？我还活着吗？神呐。 最终，我还是活着下来了，然后又来了一个刺激的，体验蹦极的感觉。PO 图一张，先提前感受一下。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/624188preview4.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/624188preview4.jpg" alt="624188preview4"></a> 对，就是它！太空飞梭，哈哈哈哈，体验一下从 100 米高空坠落的感觉吧！上去坐在座位上绑好了，深呼吸一下，就在那一瞬间，就是那一瞬间，座位以一个超快的速度飞到架子的顶端啊！注意它不是缓缓上去的啊，是突然地一下，升到最上面，只需要短短几秒，那一瞬间啊，我的天，周围的人的呐喊，小周周的咆哮，花花的哭喊混成一团，就像火箭升空的感觉一样。然后，座位在空中停住了，尼玛这时候我们已经升到了最高的地方了啊。还不够形象，再来一张图！<img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150504211315.png" alt="QQ截图20150504211315"> 将近一百米的高空，我们坐在座位上，腿是悬空的，朝下一瞅你可能就会昏死过去。然后，然后！这座位突然不受力了，直接自由落体！我们也跟随着座位飞下来，呐喊声，咆哮声混作一团，而我也在撕吼，啊啊啊啊。真正的自由落体，感受到了吗？而且它接下来还没完啊，又升上去，然后又来一次降下来。呼呼呼呼呼，简直了！！嗯，最后我还是活着下来了。 其实，这个还真的不够刺激，然后我们又来了一个刺激的，空中飞舞，哈哈哈，堪称一绝了。先 PO 个图感受一下。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150504211949-e1430750658538.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150504211949-e1430750658538.png" alt=""></a> 简直了，这个巨大的翅上都坐着人，翅子这玩意不仅是自己在转，而且这个长臂在左右上下摇摆，尼玛可想而知我们的人在天上是波浪翻滚啊，朝上甩，朝下甩，朝左甩，朝右甩，有时倒这甩，有时正着甩。有没有玩过小时候的波浪鼓，我们这些人就想波浪鼓上面的两个圆球，各种甩，各种浪，在上面想不喊都不行，在上面我们的撕吼声简直是无与伦比，有时真的感觉自己就要被甩出去的样子，自己感受一下吧。这个简直是爽哭我了，花花直接吓得没敢坐，我和小周周真是感受到了这玩意的魅力，太浪了，也是浪到不行不行的。 接下来坐了坐勇敢者转盘，就是它！就是它！罪该万死的家伙！直接把我转晕了！ <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/68a8f2b5-02d5-4fda-87cb-ae5fca294f04.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/68a8f2b5-02d5-4fda-87cb-ae5fca294f04.jpg" alt="68a8f2b5-02d5-4fda-87cb-ae5fca294f04"></a> 别看他只是个转盘拉着一个个小车在那里转，其实它离心力特别大，我的腿在小车里简直都抬不起来。看到这个转盘下面的支撑臂了没？一开始它是平的啊，也就是说我们最开始是在水平面上转的，随着时间推移，这个臂慢慢往上升，升到将近 90 度的样子，尼玛我就简直被离心力牵引着在转啊，你可以想想我在最高处就是脚朝上头朝下在转啊转啊转啊转。而且离心力没那么大的话我还是斜着的好嘛？我的脖子也在不由自主地斜着，出来的时候真是转得我晕死了，脖子差点没正过来啊尼玛。 就是因为这个破玩意，我走路都开始晕了，趴桌子上一会，碎一觉，就没事了，起来接着浪！ 恩，然后接下来就是飞越极限了，这个效果简直赞啊。排队的人虽然多，但是一次性进去 50 多个人一起飞。坐在椅子上，脚是悬空的，在眼前会有一个超大超大的银幕，先 PO 图一张。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/W020140505433553648700.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/W020140505433553648700.jpg" alt="W020140505433553648700"></a> 应该就是这种感觉吧，一排排人坐着，座位可以模拟飞行时的感受，比如模拟加速，左右转等等的动作，相当逼真，而且还吹着风，模拟一下风中飞行的感觉。当然最享受的还是眼前的超大的幕布，一幅幅 3D 效果的画面，有艾菲尔铁塔，金字塔，故宫，长城，布达拉宫，大峡谷，珠穆朗玛峰，东方明珠等等，风景特别多。在飞行的过程中带你穿越世界各地，游遍千山万水。实在是太棒，不得不赞一个。像的看了一个超大的电影偶也！ 恩，最最最重头戏来了，火流星！号称是最惊险刺激的一个项目，如果你一开始坐了这个，其他的真的一点意思都没有，所以我们把这个放在了最后。来张图先感受一下。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/20131216191455574-e1430747766704.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/20131216191455574-e1430747766704.jpg" alt="20131216191455574"></a> 哈哈哈，害怕了吧，整个人都是坐在座位上脚是完全悬空的，图上的人在以一个超快的速度在做空中大反转，我估计他们差点就要被甩出去了。来张全图感受一下。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150504215457.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150504215457.png" alt="QQ截图20150504215457"></a> 恩，这跑道有正的有倒的，最高处差不多有三十四米。花花没有一起坐这个，我和小周周去尝试了。绑好之后，我们在那条长直道上慢慢地往上升，尼玛在升的过程中其实是比较慢的，十米，二十米，三十米，升的过程中我的脚下是悬空的，没有任何踩踏的地方，朝下一看，整个就是一大悬崖啊，啊啊啊。我想，一声我爱过这个世界足以表达我当时的感受。接着升到最高地方，就立即向下俯冲了，尼玛啊，简直就是自由落体一般的速度啊，而且这轨道它还不是一个平稳的正圆啊，跑道就像麻花一样向前延伸着，而我们就一边在自转一边向下俯冲，我的妈啊，全车的人都在喊叫，整个在穿梭的过程中肩膀被死死压着，一个巨大的扭转力扭动着我的身体，身体向前前进的同时在做大回环运动。这还不算完，降落到最低点之后接着又是一个上升，一个弧形的 360 度大回环跑道，那时我们的脚完全是在上方，头在下方，死死地卡在座位上，巨大的离心力给我的身体难以承受之重。图中那么长的跑道，跑完需要多久？2 分钟？1 分钟？不，只需要 30 秒！30 秒啊！那速度简直太快了，一个劲的酸爽，真能到达极限了。下来之后，感觉整个人都接受了全身的按摩，浑身的酥麻感觉，也是爽到不行不行的！ 火流星，真是名副其实，就像太空穿梭一遍回来了一样，无法比拟的刺激。嗯，坐完这个心里就踏实了。哈哈。 后来就是几个比较放松的项目了，海螺湾，生命之光，转转杯，放松体验一下，最后爬了一下方特城堡，也算是圆满了。 晚上在方特门口拍了拍照，买了个西部牛仔帽子，留作纪念。方特之旅正式圆满结束！偶也！ 最后 PO 图几张，留作纪念！真是开心！愉快！ 再见！方特！再见！泰安！么么哒！ <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150504221857-e1430749176983.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150504221857-e1430749176983.png" alt="QQ截图20150504221857"></a> <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150504222004.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150504222004.png" alt="QQ截图20150504222004"></a> <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150504222028.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150504222028.png" alt="QQ截图20150504222028"></a><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/05/QQ截图20150504221741-e1430749091293.png" alt="QQ截图20150504221741"></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-05-04 13:43:58" itemprop="dateCreated datePublished" datetime="2015-05-04T13:43:58+08:00">2015-05-04</time>
                </span>
                <span id="/1722.html" class="post-meta-item leancloud_visitors" data-flag-title="记一次泰安方特之旅" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>5.9k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>5 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1711.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> Other <i class="label-arrow"></i>
                  </a>
                  <a href="/1711.html" class="post-title-link" itemprop="url">良好的代码风格养成记</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>优秀的代码风格如同一身得体的打扮，能够给人以良好的印象。初学程序设计，首先必须建立良好的编程习惯，这其中就包括代码风格。本文就代码风格中的几个重点问题进行了讨论，并在文后给出了一份优秀的代码作为风格模板。代码风格不必花费太多专门的时间研究，在使用中不断模仿模板代码，轻轻松松就能写出“专业的代码”。</p>
                  <h2 id="80字符，代码行极限"><a href="#80字符，代码行极限" class="headerlink" title="80字符，代码行极限"></a>80字符，代码行极限</h2>
                  <p>无论时空怎么转变，世界怎样改变，一行80字符应始终铭记心间。古老的Unix终端以80列的格式显示文本，为了让源代码与手册具有最佳的可读性， Unix系统始终坚持着80列的传统。80列不多不少，足够写出一行有意义的代码，同时也足够显示在终端屏幕，足够打印在A4纸上。虽然时至今日，我们的屏幕分辨率早已足够高，一行能够显示的内容远超超过80字符，但我们的优秀传统已经形成──几乎所有的Unix/Linux内核源代码以及联机用户手册都严格地遵守着80列极限。如果你正好在使用Windows平台下的Dev C++，你是否有注意到代码编辑框里那条细细的灰色竖线？不错，那正是代码行极限。除了HTML、XML等冗长繁复的标记式语言，几乎所有的语言都需要严格遵守代码行极限，这包括C、C++、Java、C#、Python、PHP等等。不过有时，比如当PHP跟HTML打交道的时候，这个限制是可以暂时放松的。过长的代码行总是不好的，好的代码要始终保持苗条的身材。</p>
                  <h2 id="Tab还是Space，众说纷纭的缩进方式"><a href="#Tab还是Space，众说纷纭的缩进方式" class="headerlink" title="Tab还是Space，众说纷纭的缩进方式"></a>Tab还是Space，众说纷纭的缩进方式</h2>
                  <p>代码离不开缩进，关于缩进主要有两个争论，一个是该用空格（Space）还是用制表符（Tab），另外一个是该用4格缩进还是8格缩进甚至都不是。 先来谈谈Space与Tab的问题。坚持用Space的程序员会告诉你，如果你从来都不用Tab，那么你的代码放到所有的地方看都是一样的。没错，这是用Space缩进的优点，可惜的是，这是它唯一的优点。代码层次越多，内层代码最前面的缩进便越多，这意味着你需要敲很多很多次空格。即使你能忍受不厌其烦地按空格键直到它坏掉，你也一定会被IDE总是自作聪明地插入一些Tab字符的行为烦恼不已。建议总是使用Tab缩进，因为几乎所有的代码（不仅仅是C 代码）都在使用Tab缩进。 Tab到底是4格还是8格？这是Tab缩进会被某些人诟病的根源。当你写程序时使用的Tab大小与别人读程序时使用的Tab大小不同时，再漂亮的排版也会变得杂乱无章。标准的Tab是8格的，而不幸的是，几乎所有的Windows平台下的IDE，包括 Visual Studio、Dev C++，甚至跨平台的Eclipse等，都默认使用4格Tab。我使用的FreeBSD系统的所有的内核源代码都采用8格缩进，所以我一直坚持使用8格缩进。也许你不习惯太大的间距，如果不是在Unix平台下，或者不是C语言，那就采用4格Tab吧。如果你在Unix下编写C代码，使用8格的标准Tab是更好的习惯。</p>
                  <h2 id="折行原则，容易被忽略的角落"><a href="#折行原则，容易被忽略的角落" class="headerlink" title="折行原则，容易被忽略的角落"></a>折行原则，容易被忽略的角落</h2>
                  <p>既然有代码行极限，很多情况下我们不得不断开一个完整的代码行，这就带来了一个问题：折行后应该如何缩进？好的做法是，第一次折行后，在原来缩进的基础上增加1/2的Tab大小的空格，之后的折行全部对齐第二行。可能这样的文字描述过于晦涩了，还是举个例子罢（以8格缩进为例）：</p>
                  <figure class="highlight ceylon">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">if</span> (<span class="keyword">value</span> &gt; a &amp;&amp; <span class="keyword">value</span> &gt; b &amp;&amp; <span class="keyword">value</span> &gt; c &amp;&amp; <span class="keyword">value</span> &lt; d &amp;&amp; <span class="keyword">value</span> &lt; e &amp;&amp; <span class="keyword">value</span> &lt; f</span><br><span class="line">    <span class="keyword">value</span> &lt; h &amp;&amp; <span class="keyword">value</span> &lt; h) &#123; <span class="comment">/* 注意折行后的缩进 */</span></span><br><span class="line">        <span class="keyword">value</span> = <span class="keyword">value</span> + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">value</span> = <span class="keyword">value</span> * <span class="keyword">value</span> * <span class="keyword">value</span> * <span class="keyword">value</span> * <span class="keyword">value</span> * <span class="keyword">value</span> * <span class="keyword">value</span> * <span class="keyword">value</span></span><br><span class="line">            * <span class="keyword">value</span> * <span class="keyword">value</span> + <span class="keyword">value</span> * <span class="keyword">value</span> * <span class="keyword">value</span> * <span class="keyword">value</span> * <span class="keyword">value</span> * <span class="keyword">value</span></span><br><span class="line">            * <span class="keyword">value</span> * <span class="keyword">value</span>; <span class="comment">/* 注意再次折行后的缩进 */</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>显然这个段代码没有任何实际用处，只是为了说明折行缩进而编造的。</p>
                  <h2 id="无处不在的空格，无处不在的空行"><a href="#无处不在的空格，无处不在的空行" class="headerlink" title="无处不在的空格，无处不在的空行"></a>无处不在的空格，无处不在的空行</h2>
                  <p>需要空格的位置有：</p>
                  <ul>
                    <li>if、while、switch等关键字与之后的左括号(之间。</li>
                    <li>左花括号{之前。</li>
                    <li>双目运算符两侧，例如p == NULL。</li>
                    <li>逗号,与分号;之后，例如for (i = 0; i &lt; 10; i++)。</li>
                  </ul>
                  <p>不要空格的位置有：</p>
                  <ul>
                    <li>函数名与之后的左括号(，包括带参数的宏与之后的左括号(，例如max(a, b)。</li>
                    <li>分号;与冒号:之前。</li>
                    <li>左括号(右边，右括号)左边，例如if (p == NULL)。</li>
                  </ul>
                  <p>需要空行的位置有：</p>
                  <ul>
                    <li>函数的定义之前、函数的定义之后</li>
                    <li>一组联系紧密的代码段之前和之后</li>
                  </ul>
                  <p>这些规则并不完全，当你碰到上面没有列举出来的情况时，请参考本文提供的模板代码。</p>
                  <h2 id="左花括号的争议──换行乎？不换乎？"><a href="#左花括号的争议──换行乎？不换乎？" class="headerlink" title="左花括号的争议──换行乎？不换乎？"></a>左花括号的争议──换行乎？不换乎？</h2>
                  <p>这又是一个仁者见仁智者见智的问题了。从使代码更清晰的角度看，作为代码段开头标识的左花括号{应该另起一行：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">if</span> (p == NULL)</span><br><span class="line">&#123;</span><br><span class="line">        printf(<span class="string">"error!\n"</span>);</span><br><span class="line">        <span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可是，这看起来实在不够紧凑，所以大部分的C代码（至少Unix上如此）都采用了这样的方式：</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">if</span> (p == NULL) &#123;</span><br><span class="line">        printf(<span class="string">"error!\n"</span>);</span><br><span class="line">        <span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我的建议是采用后者，这会使你的代码显得更加紧凑，也更加专业。需要说明一个特例，在定义函数时，我们总是要给左花括号 { 换行：</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">maxint</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a &gt; b ? a : b;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>额，不过我还是不太习惯额</p>
                  <h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2>
                  <p>本文介绍了编程的代码风格，希望对大家有帮助 本文内容为转载，<a href="http://blog.csdn.net/tolys/article/details/1807360" target="_blank" rel="noopener">原文出处</a></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-04-30 23:47:18" itemprop="dateCreated datePublished" datetime="2015-04-30T23:47:18+08:00">2015-04-30</time>
                </span>
                <span id="/1711.html" class="post-meta-item leancloud_visitors" data-flag-title="良好的代码风格养成记" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.3k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1691.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> HTML <i class="label-arrow"></i>
                  </a>
                  <a href="/1691.html" class="post-title-link" itemprop="url">几款优秀的前端UI框架</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>目前响应式布局和扁平化越来越风靡，前端 UI 框架也是风生水起，在这里分享几款优秀的前端 UI 框架</p>
                  <h2 id="BootStrap"><a href="#BootStrap" class="headerlink" title="BootStrap"></a>BootStrap</h2>
                  <p>相比这个大家都听说过吧，Bootstrap，来自 Twitter，是目前最受欢迎的前端框架。Bootstrap 是基于 HTML、CSS、JAVASCRIPT 的，它简洁灵活，使得 Web 开发更加快捷。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150427144535.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150427144535.jpg" alt="20150427144535"></a> <a href="http://getbootstrap.com/" target="_blank" rel="noopener">官网链接</a> <a href="http://www.bootcss.com/" target="_blank" rel="noopener">中文链接</a></p>
                  <h2 id="Foundation"><a href="#Foundation" class="headerlink" title="Foundation"></a><strong>Foundation</strong></h2>
                  <p>与 Bootstrap 相比，Foundation 屈居第二，不过这并不能说明它不受欢迎。 ZURB 在后面强有力的支持，使得 Foundation 更加强大！Foundation 被各大网站使用，如 Facebook、Mozilla、Ebay、 Yahoo、美国国家地理网站等等。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150427154906.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150427154906.jpg" alt="20150427154906"></a> <a href="http://foundation.zurb.com/" target="_blank" rel="noopener">官网链接</a> <a href="http://www.foundcss.com/" target="_blank" rel="noopener">中文链接</a></p>
                  <h2 id="Semantic-Ui"><a href="#Semantic-Ui" class="headerlink" title="Semantic Ui"></a>Semantic Ui</h2>
                  <p>语义化设计的前端框架，为攻城师而制作的可复用的开源前端框架。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150427155432.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150427155432.jpg" alt="20150427155432"></a> <a href="http://semantic-ui.com/" target="_blank" rel="noopener">官网链接</a> <a href="http://www.semantic-ui.com.cn/" target="_blank" rel="noopener">中文链接</a></p>
                  <h2 id="Amaze-UI"><a href="#Amaze-UI" class="headerlink" title="Amaze UI"></a>Amaze UI</h2>
                  <p>Amaze UI 是一个移动优先的跨屏前端框架。… Amaze UI 以移动优先(Mobile first)为理念,从小屏逐步扩展到大屏,最终实现所有屏幕适配,适应移动互联潮流。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150427155625.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150427155625.jpg" alt="20150427155625"></a> <a href="http://amazeui.org/" target="_blank" rel="noopener">官网链接</a></p>
                  <h2 id="Purecss"><a href="#Purecss" class="headerlink" title="Purecss"></a>Purecss</h2>
                  <p>免费响应式 CSS 前端框架是有 Yahoo 发布的一个可以应用到所有 web 项目的小巧的、响应式的 CSS 模块集，Pure 是建立在 Normalize.css 的基础上的，对 HTML 元素提供了布局和样式，增加了一些公共的并且是你需要的 UI 组件。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150427160204.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150427160204.jpg" alt="20150427160204"></a> <a href="http://purecss.io/" target="_blank" rel="noopener">官网链接</a> <a href="http://pure-site.ap01.aws.af.cm/" target="_blank" rel="noopener">中文链接</a></p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-04-27 15:44:21" itemprop="dateCreated datePublished" datetime="2015-04-27T15:44:21+08:00">2015-04-27</time>
                </span>
                <span id="/1691.html" class="post-meta-item leancloud_visitors" data-flag-title="几款优秀的前端UI框架" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>580</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1687.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> JavaScript <i class="label-arrow"></i>
                  </a>
                  <a href="/1687.html" class="post-title-link" itemprop="url">JS对于Android和IOS平台的点击响应的适配</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>最近做项目的时候发现了一个非常奇怪的问题，就是对于click事件的响应。经过测试发现，对于IOS平台，直接监听click事件可能是没有响应的，而在Android和PC上则完全没有问题。所以通过获取设备信息实现了不同平台的不同监听。</p>
                  <h2 id="IOS监听"><a href="#IOS监听" class="headerlink" title="IOS监听"></a>IOS监听</h2>
                  <p>对于IOS设备，只监听click方法可能是没有响应的。解决方法就是监听 “touchend click”事件。 而对于Android和PC，则只监听click事件即可。</p>
                  <h2 id="平台检测"><a href="#平台检测" class="headerlink" title="平台检测"></a>平台检测</h2>
                  <p>我们利用userAgent来检测平台</p>
                  <figure class="highlight less">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">if</span> (/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)) &#123;</span><br><span class="line">    <span class="comment">//alert(navigator.userAgent);  </span></span><br><span class="line">    <span class="selector-tag">alert</span>(<span class="string">"iOS"</span>);</span><br><span class="line">&#125; <span class="selector-tag">else</span> <span class="selector-tag">if</span> (/(Android)/i.test(navigator.userAgent)) &#123;</span><br><span class="line">    <span class="comment">//alert(navigator.userAgent); </span></span><br><span class="line">    <span class="selector-tag">alert</span>(<span class="string">"Android"</span>);</span><br><span class="line">&#125; <span class="selector-tag">else</span> &#123;</span><br><span class="line">    <span class="selector-tag">alert</span>(<span class="string">"PC"</span>);</span><br><span class="line">&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>上面的JS代码可以检测三个平台。</p>
                  <h2 id="实现监听"><a href="#实现监听" class="headerlink" title="实现监听"></a>实现监听</h2>
                  <p>我们可以把方法自定义名字，比如</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">back_click</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		$(<span class="string">".group-names"</span>).show();</span><br><span class="line">		$(<span class="string">".groups:visible"</span>).hide();</span><br><span class="line">		$(<span class="keyword">this</span>).hide();</span><br><span class="line">	&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>然后跨平台实现监听</p>
                  <figure class="highlight arcade">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">/* bind the event */</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="regexp">/(iPhone|iPad|iPod|iOS)/i</span>.test(navigator.userAgent)) &#123;</span><br><span class="line">		$(<span class="string">".back"</span>).bind(&#123;<span class="string">"touchend click"</span>:back_click&#125;);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		$(<span class="string">".back"</span>).bind(&#123;<span class="string">"click"</span>:back_click&#125;);</span><br><span class="line">	&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过以上监听便没有问题了。</p>
                  <h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2>
                  <p>通过以上方法便可以实现不同平台的监听。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-04-26 13:02:48" itemprop="dateCreated datePublished" datetime="2015-04-26T13:02:48+08:00">2015-04-26</time>
                </span>
                <span id="/1687.html" class="post-meta-item leancloud_visitors" data-flag-title="JS对于Android和IOS平台的点击响应的适配" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>868</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1680.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> JavaScript <i class="label-arrow"></i>
                  </a>
                  <a href="/1680.html" class="post-title-link" itemprop="url">jQuery应用五之瀑布流效果的实现</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>这里我们来利用jQuery实现瀑布流效果。</p>
                  <h2 id="在线演示"><a href="#在线演示" class="headerlink" title="在线演示"></a>在线演示</h2>
                  <p>我们首先来在线演示一下效果，然后我们说一下是怎样的实现，点开链接进行预览吧 <a href="http://res.cuiqingcai.com/waterfall/" target="_blank" rel="noopener">在线预览</a></p>
                  <h2 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h2>
                  <p>首先我们在页面中加入了一些图片元素，都加到id为container的元素中，每一张图片都在一个class为box的容器里，然后里面是一张图片。</p>
                  <figure class="highlight applescript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;<span class="keyword">div</span> <span class="built_in">id</span>=<span class="string">"container"</span>&gt;</span><br><span class="line">        &lt;<span class="keyword">div</span> <span class="built_in">class</span>=<span class="string">"box"</span>&gt;</span><br><span class="line">            &lt;<span class="keyword">div</span> <span class="built_in">class</span>=<span class="string">"content"</span>&gt;</span><br><span class="line">                &lt;img src=<span class="string">"img/1.jpg"</span>&gt;</span><br><span class="line">            &lt;/<span class="keyword">div</span>&gt;</span><br><span class="line">        &lt;/<span class="keyword">div</span>&gt;</span><br><span class="line">&lt;/<span class="keyword">div</span>&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在JS中，我们遍历了每一个box，实现box的位置为上一行高度最小的box的位置。</p>
                  <figure class="highlight pgsql">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">function</span> imgLocation()&#123;</span><br><span class="line">    var <span class="type">box</span> = $(".box");</span><br><span class="line">    var boxWidth = <span class="type">box</span>.eq(<span class="number">0</span>).width();</span><br><span class="line">    var num = Math.floor($(<span class="keyword">window</span>).width()/boxWidth);</span><br><span class="line">    var boxArr=[];</span><br><span class="line">    <span class="type">box</span>.<span class="keyword">each</span>(<span class="keyword">function</span>(<span class="keyword">index</span>,<span class="keyword">value</span>)&#123;</span><br><span class="line">        var boxHeight = <span class="type">box</span>.eq(<span class="keyword">index</span>).height();</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">index</span>&lt;num)&#123;</span><br><span class="line">            boxArr[<span class="keyword">index</span>]= boxHeight;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            var minboxHeight = Math.min.apply(<span class="keyword">null</span>,boxArr);</span><br><span class="line">            var minboxIndex = $.inArray(minboxHeight,boxArr);</span><br><span class="line">            $(<span class="keyword">value</span>).css(&#123;</span><br><span class="line">                "position":"absolute",</span><br><span class="line">                "top":minboxHeight,</span><br><span class="line">                "left":<span class="type">box</span>.eq(minboxIndex).position().left</span><br><span class="line">            &#125;);</span><br><span class="line">            boxArr[minboxIndex]+=<span class="type">box</span>.eq(<span class="keyword">index</span>).height();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>最后实现了滚动条滑动时的动态加载</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">scrollside</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> box = $(<span class="string">".box"</span>);</span><br><span class="line">    <span class="keyword">var</span> lastboxHeight = box.last().get(<span class="number">0</span>).offsetTop+<span class="built_in">Math</span>.floor(box.last().height()/<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">var</span> documentHeight = $(<span class="built_in">document</span>).width();</span><br><span class="line">    <span class="keyword">var</span> scrollHeight = $(<span class="built_in">window</span>).scrollTop();</span><br><span class="line">    <span class="keyword">return</span> (lastboxHeight&lt;scrollHeight+documentHeight)?<span class="literal">true</span>:<span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>调用如下</p>
                  <figure class="highlight javascript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">window</span>.onscroll = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(scrollside())&#123;</span><br><span class="line">                $.each(dataImg.data,<span class="function"><span class="keyword">function</span>(<span class="params">index,value</span>)</span>&#123;</span><br><span class="line">                    <span class="keyword">var</span> box = $(<span class="string">"&lt;div&gt;"</span>).addClass(<span class="string">"box"</span>).appendTo($(<span class="string">"#container"</span>));</span><br><span class="line">                    <span class="keyword">var</span> content = $(<span class="string">"&lt;div&gt;"</span>).addClass(<span class="string">"content"</span>).appendTo(box);</span><br><span class="line">                    $(<span class="string">"&lt;img&gt;"</span>).attr(<span class="string">"src"</span>,<span class="string">"./img/"</span>+$(value).attr(<span class="string">"src"</span>)).appendTo(content);</span><br><span class="line">                &#125;);</span><br><span class="line">                imgLocation();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过上述简单的设置我们就实现了瀑布流的效果。</p>
                  <h2 id="源码下载"><a href="#源码下载" class="headerlink" title="源码下载"></a>源码下载</h2>
                  <p><a href="https://github.com/cqcre/waterfall" target="_blank" rel="noopener">源码下载</a></p>
                  <h2 id="综述-1"><a href="#综述-1" class="headerlink" title="综述"></a>综述</h2>
                  <p>以上便是瀑布流效果的实现，希望对大家有一定帮助！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-04-24 15:44:34" itemprop="dateCreated datePublished" datetime="2015-04-24T15:44:34+08:00">2015-04-24</time>
                </span>
                <span id="/1680.html" class="post-meta-item leancloud_visitors" data-flag-title="jQuery应用五之瀑布流效果的实现" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.6k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1658.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> C/C++ <i class="label-arrow"></i>
                  </a>
                  <a href="/1658.html" class="post-title-link" itemprop="url">OpenGL绘图实例五之平移缩放旋转</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>OpenGL 中的变换可以分为下面的三种： 即模型变换、投影变换、视口变换。 模型变换其实就相当于图形的几何变换，包括平移、缩放、旋转等操作，下面我们来详细研究一下 OpenGL 中三种操作的函数应用。</p>
                  <h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2>
                  <p>在变换前我们首先要做一下准备工作，首先我们需要调用 glMatrixMode 函数来设置变换模式。 该方法介绍如下 <strong>glMatrixMode(Glenum mode)</strong>，设置当前矩阵模式，它具有三个参数，分别为<strong>GL_MODELVIEW</strong>，<strong>GL_PROJECTION</strong>，<strong>GL_TEXTURE</strong>。三个参数的含义为：</p>
                  <blockquote>
                    <p><strong>GL_MODELVIEW</strong>,对模型视景矩阵堆栈应用随后的矩阵操作，也就是针对本节的模型几何变换设置的模式，本节所有内容均为此模式。 <strong>GL_PROJECTION</strong>,对投影矩阵应用随后的矩阵操作，在投影变换中设置的模式。 <strong>GL_TEXTURE</strong>,对纹理矩阵堆栈应用随后的矩阵操作，在设置动态纹理的过程中设置的模式。</p>
                  </blockquote>
                  <p>所以，在本节我们就需要设置如下的模式</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">glMatrixMode(<span class="name">GL_MODELVIEW</span>)<span class="comment">;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>接下来，我们需要设置</p>
                  <figure class="highlight abnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">glLoadIdentity()<span class="comment">;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这个方法的作用是设置将当前的用户坐标系的原点移到了屏幕中心，类似于一个复位操作。 好，设置好以上两个条件之后我们就可以来进行变换啦。主要有以下三个函数：</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">gl<span class="constructor">Rotatef(<span class="params">angle</span>,<span class="params">vx</span>,<span class="params">vy</span>,<span class="params">vz</span>)</span> <span class="comment">//绕向量(vx,vy,vz)为轴旋转角度angle</span></span><br><span class="line">gl<span class="constructor">Translate(<span class="params">dx</span>,<span class="params">dy</span>,<span class="params">dz</span>)</span> <span class="comment">//平移，位移量为向量(dx,dy,dz)</span></span><br><span class="line">gl<span class="constructor">Scalef(<span class="params">sx</span>,<span class="params">sy</span>,<span class="params">sz</span>)</span> <span class="comment">//比例缩放，x，y，z 方向的缩放因子分别为sx，sy，sz</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>下面我们来详细说明这三个函数的用法。</p>
                  <h2 id="平移"><a href="#平移" class="headerlink" title="平移"></a>平移</h2>
                  <p>三种变换中，平移变换是最简单的。 类库中提供了下面两个方法：</p>
                  <blockquote>
                    <p>glTranslated(GLdouble x,GLdouble y,GLdouble z) glTranslatef(GLfloat x,GLfloat y,GLfloat z)</p>
                  </blockquote>
                  <p>这两种方法是基本是等价的，一种方法是传入 double 类型的参数，另一个是传入 float 类型的参数。 方法的作用是<strong>将物体分别沿 x，y，z 轴平移 x，y，z 的单位长度</strong>。 利用上一节的机器人我们来感受一下</p>
                  <h3 id="1-向右平移-100-像素"><a href="#1-向右平移-100-像素" class="headerlink" title="1.向右平移 100 像素"></a><strong>1.向右平移 100 像素</strong></h3>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">glTranslated(<span class="number">100</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150422142910.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150422142910.jpg" alt="20150422142910"></a> 可以看到，机器人向右平移了 100 像素</p>
                  <h3 id="2-向左下分别平移-50-50-像素"><a href="#2-向左下分别平移-50-50-像素" class="headerlink" title="2.向左下分别平移 50,50 像素"></a><strong>2.向左下分别平移 50,50 像素</strong></h3>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">glTranslated(<span class="number">-50</span>,<span class="number">-50</span>,<span class="number">0</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150422143102.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150422143102.jpg" alt="20150422143102"></a> 可以看到，机器人分别向左和向下平移了 50 像素</p>
                  <h3 id="3-向左下分别平移-50-50，向前平移-100"><a href="#3-向左下分别平移-50-50，向前平移-100" class="headerlink" title="3.向左下分别平移 50,50，向前平移 100"></a><strong>3.向左下分别平移 50,50，向前平移 100</strong></h3>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">glTranslated(<span class="number">-50</span>,<span class="number">-50</span>,<span class="number">100</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150422143102.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150422143102.jpg" alt="20150422143102"></a> 哦，和上一个类似，也就是说在 z 轴上平移没有什么效果吗？难道因为我画的是二维平面图形？哦不，那不应该是距离我的视线更近了所以看到的更大了吗？好吧，事实好像不是这样的，我就姑且认为二维平面在 z 轴上的平移是没有影响的吧。 恩，这个函数基本用法就是这样，通过传入不同的 x，y，z 值实现平移即可。</p>
                  <h2 id="旋转"><a href="#旋转" class="headerlink" title="旋转"></a>旋转</h2>
                  <p>旋转的方法有下面两个：</p>
                  <blockquote>
                    <p>glRotatef(GLdouble angle,GLdouble x,GLdouble y,GLdouble z) glRotatef(GLfloat angle,GLfloat x,GLfloat y,GLfloat z)</p>
                  </blockquote>
                  <p>其中第一个参数是旋转的角度，后面三个参数 x,yz 参数确立了旋转轴，旋转轴是原点(0,0,0)与(x,y,z)的连线。 下面我们用几个例子来感受一下</p>
                  <h3 id="1-绕-x-轴旋转-60-度"><a href="#1-绕-x-轴旋转-60-度" class="headerlink" title="1.绕 x 轴旋转 60 度"></a><strong>1.绕 x 轴旋转 60 度</strong></h3>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">glRotated(<span class="number">60</span>,<span class="number">10</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150422144433.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150422144433.jpg" alt="20150422144433"></a> 恩，它变扁了，旋转中心在机器人的中心，也就是中间的小红点，设想一下，绕 x 轴旋转 60 度，的确我们看到的应该就是变扁的机器人</p>
                  <h3 id="2-绕-z-轴旋转-90-度"><a href="#2-绕-z-轴旋转-90-度" class="headerlink" title="2.绕 z 轴旋转 90 度"></a>2.绕 z 轴旋转 90 度</h3>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">glRotated(<span class="number">90</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">10</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150422144851.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150422144851.jpg" alt="20150422144851"></a> 可以看到，机器人绕中心点旋转了 90 度，是逆时针方向。</p>
                  <h3 id="3-旋转平移结合"><a href="#3-旋转平移结合" class="headerlink" title="3.旋转平移结合"></a>3.旋转平移结合</h3>
                  <p>感受完上面的两个例子之后，<strong>重头戏来了</strong>，上面的例子中旋转轴是(0,0,0)和(x,y,z)两点的连线，也就是旋转轴总是通过坐标原点的。 那如果我们要让物体绕特定的旋转轴来旋转，比如绕(1,2,3)和(4,5,6)来旋转怎么办？ 这里就要用到平移和旋转的组合了。</p>
                  <blockquote>
                    <p>如果旋转轴通过(xp,yp,zp)，而不通过坐标原点。假如旋转轴为(xp,yp,zp)和(xq,yq,zq)确立的。我们首先要将图形沿 x,y,z 方向分别平移-xp,-yp,-zp，然后旋转参数(x,y,z)分别传入(xq-xp,yq-yp,zq-zp)三个值，旋转完毕之后再把图形沿 x,y,z 方向分别平移 xp,yp,zp 个单位长度即可。</p>
                  </blockquote>
                  <p>在这里，<strong>我的教材和指导书中的内容又发生了冲突</strong>，教材中说的是先沿 x,y,z 方向分别平移<strong>-xp,-yp,-zp</strong>，再沿 x,y,z 方向分别平移<strong>xp,yp,zp</strong>还原。而指导书中则是先沿 x,y,z 方向分别平移<strong>xp,yp,zp</strong>，再沿 x,y,z 方向分别平移<strong>-xp,-yp,-zp</strong>还原，到底谁对谁错呢？我们来一个小例子验证一下。 如果觉得无聊，可以自行忽略下面小段内容。 为了直观地表示，我们统一设 z 坐标为 0，在 xy 平面中观察变换过程。 假设我们有一个点(2,2,0)，旋转的轴我们设为(1,2,0)和(4,5,0)的连线，那么该点绕轴旋转 180 度之后应该会是(1,3,0)，从图上可以很直观地看出 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/111.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/111.png" alt="111"></a> 那么在调用类库的时候，我们首先就要对这个点进行平移，然后旋转，然后再反平移恢复。</p>
                  <blockquote>
                    <p>首先，我们按照第一种说法，即先沿 x,y,z 方向分别平移-xp,-yp,-zp，即(2,2,0)减去(1,2,0)，变为了(1,0,0)，然后传入(xq-xp,yq-yp,zq-zp)实现绕(0,0,0)与(xq-xp,yq-yp,zq-zp)两点连线为旋转轴来旋转 180 度，显然是绕(0,0,0)与(3,3,0)的连线来旋转的，这个点变为了(0,1,0)，然后再沿 x,y,z 方向分别平移 xp,yp,zp 还原，即加(1,2,0)，即加得到的结果是(1,3,0)。确实与图中点的符合，所以这一种说法验证正确。 另一种说法，即先沿 x,y,z 方向分别平移 xp,yp,zp，即(2,2,0)加上(1,2,0)，变为了(3,4,0)，然后传入(xq-xp,yq-yp,zq-zp)实现绕(0,0,0)与(xq-xp,yq-yp,zq-zp)两点连线为旋转轴来旋转 180 度，显然是绕(0,0,0)与(3,3,0)的连线来旋转的，这个点变为了(4,3,0)，然后再沿 x,y,z 方向分别平移-xp,-yp,-zp 还原，即减去(1,2,0)，即加得到的结果是(3,1,0)。与图中的点不符，所以这一种说法验证失败。</p>
                  </blockquote>
                  <p>可见，我们得到的结果是</p>
                  <blockquote>
                    <p>如果旋转轴通过(xp,yp,zp)，而不通过坐标原点。假如旋转轴为(xp,yp,zp)和(xq,yq,zq)确立的。我们首先要将图形沿 x,y,z 方向分别平移-xp,-yp,-zp，然后旋转参数(x,y,z)分别传入(xq-xp,yq-yp,zq-zp)三个值，旋转完毕之后再把图形沿 x,y,z 方向分别平移 xp,yp,zp 个单位长度即可。</p>
                  </blockquote>
                  <p>所以，我们要实现机器人绕两点(10,20,30)和(40,50,60)定义的轴线旋转 45 度，代码实现如下</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">glTranslatef(<span class="number">-10</span>,<span class="number">-20</span>,<span class="number">-30</span>);</span><br><span class="line"><span class="comment">//(40,50,60)-(10,20,30)=(30,30,30)</span></span><br><span class="line">glRotatef(<span class="number">45</span>,<span class="number">30</span>,<span class="number">30</span>,<span class="number">30</span>);</span><br><span class="line">glTranslatef(<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/0150422151947.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/0150422151947.jpg" alt="0150422151947"></a> 运行结果可能不太直观，可以直接参考代码实现</p>
                  <h2 id="缩放"><a href="#缩放" class="headerlink" title="缩放"></a>缩放</h2>
                  <p>对于缩放，我们的方法也是有两个</p>
                  <blockquote>
                    <p>glScaled(GLdouble x,GLdouble y,GLdouble z) glScalef(GLfloat x,GLfloat y,GLfloat z)</p>
                  </blockquote>
                  <p>区别也就是一个参数为 double 类型，一个为 float 类型 函数的作用是将物体分别在 x,y,z 轴方向缩放为 x,y,z 倍，缩放中心为原点 下面我们来几个小例子感受一下</p>
                  <h3 id="1-沿-x-轴放大-2-倍"><a href="#1-沿-x-轴放大-2-倍" class="headerlink" title="1.沿 x 轴放大 2 倍"></a>1.沿 x 轴放大 2 倍</h3>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">glScaled(<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150422153045.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150422153045.jpg" alt="20150422153045"></a> 画面好美！</p>
                  <h3 id="2-沿-y-轴-z-轴分别放大-2-倍"><a href="#2-沿-y-轴-z-轴分别放大-2-倍" class="headerlink" title="2.沿 y 轴 z 轴分别放大 2 倍"></a>2.沿 y 轴 z 轴分别放大 2 倍</h3>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">glScaled(<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150422153914.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150422153914.jpg" alt="20150422153914"></a> 因为整个图形是一个平面图，所以我们只可以看出 z 轴放缩的效果</p>
                  <h3 id="3-放缩和平移的变换"><a href="#3-放缩和平移的变换" class="headerlink" title="3.放缩和平移的变换"></a>3.放缩和平移的变换</h3>
                  <p>和旋转的原理一样，默认的放缩中心是原点，在这里，如果我们的放缩中心如果不是原点，我们该怎样设置呢？ 假设放缩中心为(xp,yp,zp)，方法如下：</p>
                  <blockquote>
                    <p>如果我们的放缩中心设置为(xp,yp,zp)，而不是坐标原点。我们首先要将图形沿 x,y,z 方向分别平移-xp,-yp,-zp，然后放缩参数(x,y,z)分别传入三个值代表放缩比例，放缩完毕之后再把图形沿 x,y,z 方向分别平移 xp,yp,zp 个单位长度还原。</p>
                  </blockquote>
                  <p>下面，我们以(50,50,50)为放缩中心来对机器人的 xy 方向分别放缩 1.5 倍</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">glTranslated(<span class="number">-50</span>,<span class="number">-50</span>,<span class="number">0</span>);</span><br><span class="line">glScaled(<span class="number">1.5</span>,<span class="number">1.5</span>,<span class="number">0</span>);</span><br><span class="line">glTranslated(<span class="number">50</span>,<span class="number">50</span>,<span class="number">0</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150422155459.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150422155459.jpg" alt="20150422155459"></a> 这样，我们就实现了以(50,50,0)为放缩原点来进行放大 1.5 倍的操作。</p>
                  <h2 id="综述-1"><a href="#综述-1" class="headerlink" title="综述"></a>综述</h2>
                  <p>在本篇我们描述了 OpenGL 中的平移旋转放缩变换操作，以及一些实例演示，希望对大家有帮助！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-04-22 14:19:04" itemprop="dateCreated datePublished" datetime="2015-04-22T14:19:04+08:00">2015-04-22</time>
                </span>
                <span id="/1658.html" class="post-meta-item leancloud_visitors" data-flag-title="OpenGL绘图实例五之平移缩放旋转" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>3.7k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>3 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1649.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> C/C++ <i class="label-arrow"></i>
                  </a>
                  <a href="/1649.html" class="post-title-link" itemprop="url">OpenGL绘图实例四之区域颜色填充</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>上一节我们利用种子填充算法实现了机器人的区域填充，我们可以发现，种子填充需要一定是时间，并不能在第一时间填充完毕。这里我们介绍一种更加简单的方法，我们利用 glPolygonMode 来绘制机器人，感受一下。</p>
                  <h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2>
                  <p>我们曾经分别使用过类库和直线圆弧生成算法来绘制过机器人的线条。 类库绘制法：<a href="http://cuiqingcai.com/1597.html">OpenGL 绘图实例一之机器人的绘制</a> 算法绘制法：<a href="http://cuiqingcai.com/1613.html">OpenGL 绘图实例二之直线和圆弧的绘制</a> 填充算法也有两种，一种是种子填充算法，另一种就是本篇说的方法。 在这里我们可以归一下类，算法绘制线条方法和种子填充算法中的每一个点都是我们一点点绘制的，都是我们利用算法一点点计算的坐标来绘制，因此，可以把他俩归为一对。而类库绘制线条方法和本篇说的填充方法都是指定一部分点，类库为我们实现了填充，因此可以把他俩归为一对。下面就让我们来感受一下类库填充的魅力吧！</p>
                  <h2 id="函数说明"><a href="#函数说明" class="headerlink" title="函数说明"></a>函数说明</h2>
                  <h3 id="1-函数原型"><a href="#1-函数原型" class="headerlink" title="1.函数原型"></a><strong>1.函数原型</strong></h3>
                  <p>函数原型：void glPolygonMode(GLenum face, GLenum mode); 说明：控制一个多边形的正面和背面的绘图模式。表示多边形应该被画成点、轮廓还是填充形式。在默认情况下，多边形的正面和背面都被画成填充形式。 函数 glPolygonMode()用于改变当前的多边形绘制模式，它有两个参数。第一个参数指定哪些面将被这个调用，可能的值为 GL_FRONT、GL_BACK 或 GL_FRONT_AND_BACK，分别对应于前向多边形、后向多边形或两者。第二个参数指定将要使用的模式，可以为 GL_POINT、GL_LINE 或 GL_FILL。 下面我们来用一个小 Demo 来感受一下</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">glPolygonMode(GL_FRONT_AND_BACK, GL_FILL);</span><br><span class="line">glBegin(GL_TRIANGLES);</span><br><span class="line">glVertex3f(‐<span class="number">0.8f</span>,<span class="number">0.0f</span>,<span class="number">0.0f</span>);</span><br><span class="line">glVertex3f(‐<span class="number">0.6f</span>,<span class="number">0.0f</span>,<span class="number">0.0f</span>);</span><br><span class="line">glVertex3f(‐<span class="number">0.7f</span>,<span class="number">0.2f</span>,<span class="number">0.0f</span>);</span><br><span class="line">glEnd();</span><br><span class="line">glPolygonMode(GL_FRONT_AND_BACK, GL_LINE);</span><br><span class="line">glBegin(GL_TRIANGLES);</span><br><span class="line">glVertex3f(<span class="number">0.1f</span>,<span class="number">0.0f</span>,<span class="number">0.0f</span>);</span><br><span class="line">glVertex3f(‐<span class="number">0.1f</span>,<span class="number">0.0f</span>,<span class="number">0.0f</span>);</span><br><span class="line">glVertex3f(<span class="number">0.0f</span>,<span class="number">0.2f</span>,<span class="number">0.0f</span>);</span><br><span class="line">glEnd();</span><br><span class="line">glPolygonMode(GL_FRONT_AND_BACK, GL_POINT);</span><br><span class="line">glBegin(GL_TRIANGLES);</span><br><span class="line">glVertex3f(<span class="number">0.6f</span>,<span class="number">0.0f</span>,<span class="number">0.0f</span>);</span><br><span class="line">glVertex3f(<span class="number">0.8f</span>,<span class="number">0.0f</span>,<span class="number">0.0f</span>);</span><br><span class="line">glVertex3f(<span class="number">0.7f</span>,<span class="number">0.2f</span>,<span class="number">0.0f</span>);</span><br><span class="line">glEnd();</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上三种模式分别是绘制了填充的三角形，三角形的边界，三角形的三个点。</p>
                  <h3 id="2-画多边形"><a href="#2-画多边形" class="headerlink" title="2.画多边形"></a>2.画多边形</h3>
                  <p>在 glBegin 的参数传入 GL_POLYGON，绘制的时候所有的点就会连接而成一个多边形。</p>
                  <h3 id="3-线条的粗细"><a href="#3-线条的粗细" class="headerlink" title="3.线条的粗细"></a>3.线条的粗细</h3>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">glLineWidth(<span class="name">lineWidth</span>)<span class="comment">;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>利用这个方法，我们可以传入像素值大小，比如传入 2，画线的时候就是 2 像素的粗细。</p>
                  <h2 id="绘制机器人"><a href="#绘制机器人" class="headerlink" title="绘制机器人"></a>绘制机器人</h2>
                  <p>接下来我们利用这个方法来绘制机器人吧！我们可以注意到，定义了 glPolygonMode(GL_FRONT_AND_BACK, GL_FILL)之后， 如果 glBegin 传入的是 GL_LINE_LOOP，绘制的仍然是封闭的曲线，如果 glBegin 传入的是 GL_POLYGON，绘制的则是封闭的填充的图形。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/图片1.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/图片1.png" alt="图片1"></a> 如果要实现上图的机器人，我们既要绘制黑色的边线，又要绘制带颜色的区块。所以我们就需要分别调用两种绘制模式，绘制的过程是完全相同的。所以，我们可以把模式当做一个变量来传入参数中改变绘制模式。比如之前的绘制三角形的方法</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//画三角形，传入三个点的坐标</span></span><br><span class="line">void gl<span class="constructor">Tri(<span class="params">int</span> <span class="params">x1</span>,<span class="params">int</span> <span class="params">y1</span>,<span class="params">int</span> <span class="params">x2</span>,<span class="params">int</span> <span class="params">y2</span>,<span class="params">int</span> <span class="params">x3</span>,<span class="params">int</span> <span class="params">y3</span>)</span>&#123;</span><br><span class="line">	<span class="comment">//画封闭线</span></span><br><span class="line">    gl<span class="constructor">Begin(GL_LINE_LOOP)</span>;</span><br><span class="line">	<span class="comment">//一点</span></span><br><span class="line">	gl<span class="constructor">Vertex2d(<span class="params">x1</span>,<span class="params">y1</span>)</span>;</span><br><span class="line">	<span class="comment">//二点</span></span><br><span class="line">	gl<span class="constructor">Vertex2d(<span class="params">x2</span>,<span class="params">y2</span>)</span>;</span><br><span class="line">	<span class="comment">//三点</span></span><br><span class="line">	gl<span class="constructor">Vertex2d(<span class="params">x3</span>,<span class="params">y3</span>)</span>;</span><br><span class="line">	<span class="comment">//结束画线</span></span><br><span class="line">	gl<span class="constructor">End()</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>就可以改写为</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//画三角形，传入三个点的坐标</span></span><br><span class="line">void gl<span class="constructor">Tri(<span class="params">int</span> <span class="params">x1</span>,<span class="params">int</span> <span class="params">y1</span>,<span class="params">int</span> <span class="params">x2</span>,<span class="params">int</span> <span class="params">y2</span>,<span class="params">int</span> <span class="params">x3</span>,<span class="params">int</span> <span class="params">y3</span>,<span class="params">int</span> MODE)</span>&#123;</span><br><span class="line">	<span class="comment">//画封闭线</span></span><br><span class="line">    gl<span class="constructor">Begin(MODE)</span>;</span><br><span class="line">	<span class="comment">//一点</span></span><br><span class="line">	gl<span class="constructor">Vertex2d(<span class="params">x1</span>,<span class="params">y1</span>)</span>;</span><br><span class="line">	<span class="comment">//二点</span></span><br><span class="line">	gl<span class="constructor">Vertex2d(<span class="params">x2</span>,<span class="params">y2</span>)</span>;</span><br><span class="line">	<span class="comment">//三点</span></span><br><span class="line">	gl<span class="constructor">Vertex2d(<span class="params">x3</span>,<span class="params">y3</span>)</span>;</span><br><span class="line">	<span class="comment">//结束画线</span></span><br><span class="line">	gl<span class="constructor">End()</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在调用的时候我们只需要分别传入 GL_LINE_LOOP 和 GL_POLYGON 就可以了。 所有之前的方法改写如下</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//画矩形，传入的是左下角XY坐标和右上角XY坐标</span></span><br><span class="line"><span class="built_in">void</span> glRect(<span class="built_in">int</span> leftX,<span class="built_in">int</span> leftY,<span class="built_in">int</span> rightX,<span class="built_in">int</span> rightY,<span class="built_in">int</span> MODE)&#123;</span><br><span class="line">	<span class="comment">//画封闭曲线</span></span><br><span class="line">    glBegin(MODE);</span><br><span class="line">	<span class="comment">//左下角</span></span><br><span class="line">	glVertex2d(leftX,leftY);</span><br><span class="line">	<span class="comment">//右下角</span></span><br><span class="line">	glVertex2d(rightX,leftY);</span><br><span class="line">	<span class="comment">//右上角</span></span><br><span class="line">	glVertex2d(rightX,rightY);</span><br><span class="line">	<span class="comment">//左上角</span></span><br><span class="line">	glVertex2d(leftX,rightY);</span><br><span class="line">	<span class="comment">//结束画线</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//画圆角矩形，传入矩形宽高，角半径，矩形中心点坐标</span></span><br><span class="line"><span class="built_in">void</span> glRoundRec(<span class="built_in">int</span> centerX,<span class="built_in">int</span> centerY,<span class="built_in">int</span> width,<span class="built_in">int</span> height,<span class="built_in">float</span> cirR,<span class="built_in">int</span> MODE)&#123;</span><br><span class="line">	<span class="comment">//二分之PI，一个象限的角度</span></span><br><span class="line">	<span class="built_in">float</span> PI_HALF = PI/<span class="number">2</span>;</span><br><span class="line">	<span class="comment">//划分程度,值越大画得越精细</span></span><br><span class="line">	<span class="built_in">float</span> divide=<span class="number">20.0</span>;</span><br><span class="line">	<span class="comment">//圆角矩形的坐标</span></span><br><span class="line">    <span class="built_in">float</span> tx,ty;</span><br><span class="line">	<span class="comment">//画封闭曲线</span></span><br><span class="line">    glBegin(MODE);</span><br><span class="line">	<span class="comment">//四个象限不同的操作符</span></span><br><span class="line">    <span class="built_in">int</span> opX[<span class="number">4</span>]=&#123;<span class="number">1</span>,<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">1</span>&#125;;</span><br><span class="line">    <span class="built_in">int</span> opY[<span class="number">4</span>]=&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">-1</span>,<span class="number">-1</span>&#125;;</span><br><span class="line">	<span class="comment">//用来计数，从第一象限到第四象限</span></span><br><span class="line">    <span class="built_in">float</span> x=<span class="number">0</span>;</span><br><span class="line">	<span class="comment">//x自增时加的值</span></span><br><span class="line">	<span class="built_in">float</span> part=<span class="number">1</span>/divide;</span><br><span class="line">	<span class="comment">//计算内矩形宽高一半的数值</span></span><br><span class="line">	<span class="built_in">int</span> w=width/<span class="number">2</span>-cirR;</span><br><span class="line">	<span class="built_in">int</span> h=height/<span class="number">2</span>-cirR;</span><br><span class="line">	<span class="comment">//循环画线</span></span><br><span class="line">    <span class="keyword">for</span>(x=<span class="number">0</span>;x&lt;<span class="number">4</span>;x+=part)&#123;</span><br><span class="line">		<span class="comment">//求出弧度</span></span><br><span class="line">		<span class="built_in">float</span> rad = PI_HALF*x;</span><br><span class="line">		<span class="comment">//计算坐标值</span></span><br><span class="line">	    tx=cirR*cos(rad)+opX[(<span class="built_in">int</span>)x]*w+centerX;</span><br><span class="line">	    ty=cirR*sin(rad)+opY[(<span class="built_in">int</span>)x]*h+centerY;</span><br><span class="line">		<span class="comment">//传入坐标画线</span></span><br><span class="line">	    glVertex2f(tx,ty);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//结束画线</span></span><br><span class="line">   glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//画弧线，相对偏移量XY，开始的弧度，结束的弧度，半径</span></span><br><span class="line"><span class="built_in">void</span> glArc(<span class="built_in">double</span> x,<span class="built_in">double</span> y,<span class="built_in">double</span> start_angle,<span class="built_in">double</span> end_angle,<span class="built_in">double</span> radius,<span class="built_in">int</span> MODE)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//开始绘制曲线</span></span><br><span class="line">	glBegin(MODE);</span><br><span class="line">	<span class="comment">//每次画增加的弧度</span></span><br><span class="line">	<span class="built_in">double</span> delta_angle=PI/<span class="number">180</span>;</span><br><span class="line">	<span class="comment">//画圆弧</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="built_in">double</span> i=start_angle;i&lt;=end_angle;i+=delta_angle)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//绝对定位加三角函数值</span></span><br><span class="line">		<span class="built_in">double</span> vx=x+radius * cos(i);</span><br><span class="line">		<span class="built_in">double</span> vy=y+radius*sin(i);</span><br><span class="line">		glVertex2d(vx,vy);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//结束绘画</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//画圆</span></span><br><span class="line"><span class="built_in">void</span> glCircle(<span class="built_in">double</span> x, <span class="built_in">double</span> y, <span class="built_in">double</span> radius,<span class="built_in">int</span> MODE)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//画全圆</span></span><br><span class="line">    glArc(x,y,<span class="number">0</span>,<span class="number">2</span>*PI,radius,MODE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//画三角形，传入三个点的坐标</span></span><br><span class="line"><span class="built_in">void</span> glTri(<span class="built_in">int</span> x1,<span class="built_in">int</span> y1,<span class="built_in">int</span> x2,<span class="built_in">int</span> y2,<span class="built_in">int</span> x3,<span class="built_in">int</span> y3,<span class="built_in">int</span> MODE)&#123;</span><br><span class="line">	<span class="comment">//画封闭线</span></span><br><span class="line">    glBegin(MODE);</span><br><span class="line">	<span class="comment">//一点</span></span><br><span class="line">	glVertex2d(x1,y1);</span><br><span class="line">	<span class="comment">//二点</span></span><br><span class="line">	glVertex2d(x2,y2);</span><br><span class="line">	<span class="comment">//三点</span></span><br><span class="line">	glVertex2d(x3,y3);</span><br><span class="line">	<span class="comment">//结束画线</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//画线，传入两点坐标</span></span><br><span class="line"><span class="built_in">void</span> glLine(<span class="built_in">int</span> x1,<span class="built_in">int</span> y1,<span class="built_in">int</span> x2,<span class="built_in">int</span> y2)&#123;</span><br><span class="line">	<span class="comment">//画封闭线</span></span><br><span class="line">    glBegin(GL_LINE_STRIP);</span><br><span class="line">	<span class="comment">//一点</span></span><br><span class="line">	glVertex2d(x1,y1);</span><br><span class="line">	<span class="comment">//二点</span></span><br><span class="line">	glVertex2d(x2,y2);</span><br><span class="line">	<span class="comment">//结束画线</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>那么我们实现了上面的方法之后。比如我现在要画一个矩形，就要传入 GL_LINE_LOOP 绘制一个边缘，然后再传入 GL_POLYGON 绘制一个填充的矩形，其中这个矩形的长宽等于边缘的长宽减去线的宽度（经过探索发现，应该减去线宽的一半才对，因为线的基准点是在线宽的中心的） 所以，我们可以定义一个画带边矩形的方法，比如</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//画填充的矩形，传入左上角和右下角的坐标</span></span><br><span class="line">void gl<span class="constructor">FillRect(<span class="params">int</span> <span class="params">leftX</span>,<span class="params">int</span> <span class="params">leftY</span>,<span class="params">int</span> <span class="params">rightX</span>,<span class="params">int</span> <span class="params">rightY</span>,<span class="params">int</span> <span class="params">color</span>[3])</span>&#123;</span><br><span class="line">	gl<span class="constructor">Color3ub(<span class="params">border</span>[0],<span class="params">border</span>[1],<span class="params">border</span>[2])</span>;</span><br><span class="line">	gl<span class="constructor">Rect(<span class="params">leftX</span>,<span class="params">leftY</span>,<span class="params">rightX</span>,<span class="params">rightY</span>,GL_LINE_LOOP)</span>;</span><br><span class="line">	gl<span class="constructor">Color3ub(<span class="params">color</span>[0],<span class="params">color</span>[1],<span class="params">color</span>[2])</span>;</span><br><span class="line">	gl<span class="constructor">Rect(<span class="params">leftX</span>+<span class="params">lineWidth</span><span class="operator">/</span>2,<span class="params">leftY</span>-<span class="params">lineWidth</span><span class="operator">/</span>2,<span class="params">rightX</span>-<span class="params">lineWidth</span><span class="operator">/</span>2,<span class="params">rightY</span>+<span class="params">lineWidth</span><span class="operator">/</span>2,GL_POLYGON)</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们先定义了边界颜色绘制了边界，然后定义了图形的颜色来绘制填充的图形。其中 color 作为参数，可以传入不同的 RGB 值。 定义颜色 RGB 数组即可</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">int</span> border[<span class="number">3</span>]=&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line"><span class="built_in">int</span> grey[<span class="number">3</span>]=&#123;<span class="number">195</span>,<span class="number">195</span>,<span class="number">195</span>&#125;;</span><br><span class="line"><span class="built_in">int</span> yellow[<span class="number">3</span>]=&#123;<span class="number">255</span>,<span class="number">243</span>,<span class="number">0</span>&#125;;</span><br><span class="line"><span class="built_in">int</span> red[<span class="number">3</span>]=&#123;<span class="number">237</span>,<span class="number">28</span>,<span class="number">36</span>&#125;;</span><br><span class="line"><span class="built_in">int</span> darkGrey[<span class="number">3</span>]=&#123;<span class="number">126</span>,<span class="number">126</span>,<span class="number">126</span>&#125;;</span><br><span class="line"><span class="built_in">int</span> white[<span class="number">3</span>]=&#123;<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>调用的时候我们只需要</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">glFillRect(<span class="number">-108</span>,<span class="number">45</span>,<span class="number">-81</span>,<span class="number">0</span>,darkGrey);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>就可以绘制一个黑色边界的矩形了，填充色为暗灰色。 其他类似的方法实现如下</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//画填充的三角形，传值为逆时针，此法针对于机器人的正三角形</span></span><br><span class="line">void gl<span class="constructor">FillTri(<span class="params">int</span> <span class="params">x1</span>,<span class="params">int</span> <span class="params">y1</span>,<span class="params">int</span> <span class="params">x2</span>,<span class="params">int</span> <span class="params">y2</span>,<span class="params">int</span> <span class="params">x3</span>,<span class="params">int</span> <span class="params">y3</span>,<span class="params">int</span> <span class="params">color</span>[3])</span>&#123;</span><br><span class="line">	gl<span class="constructor">Color3ub(<span class="params">border</span>[0],<span class="params">border</span>[1],<span class="params">border</span>[2])</span>;</span><br><span class="line">	gl<span class="constructor">Tri(<span class="params">x1</span>,<span class="params">y1</span>,<span class="params">x2</span>,<span class="params">y2</span>,<span class="params">x3</span>,<span class="params">y3</span>,GL_LINE_LOOP)</span>;</span><br><span class="line">	gl<span class="constructor">Color3ub(<span class="params">color</span>[0],<span class="params">color</span>[1],<span class="params">color</span>[2])</span>;</span><br><span class="line">	gl<span class="constructor">Tri(<span class="params">x1</span>+<span class="params">lineWidth</span><span class="operator">/</span>2,<span class="params">y1</span>+<span class="params">lineWidth</span><span class="operator">/</span>2,<span class="params">x2</span>-<span class="params">lineWidth</span><span class="operator">/</span>2,<span class="params">y2</span>+<span class="params">lineWidth</span><span class="operator">/</span>2,<span class="params">x3</span>,<span class="params">y3</span>-<span class="params">lineWidth</span><span class="operator">/</span>2,GL_POLYGON)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//画填充的圆角矩形</span></span><br><span class="line">void gl<span class="constructor">FillRoundRec(<span class="params">int</span> <span class="params">centerX</span>,<span class="params">int</span> <span class="params">centerY</span>,<span class="params">int</span> <span class="params">width</span>,<span class="params">int</span> <span class="params">height</span>,<span class="params">float</span> <span class="params">cirR</span>,<span class="params">int</span> <span class="params">color</span>[3])</span>&#123;</span><br><span class="line">	gl<span class="constructor">Color3ub(<span class="params">border</span>[0],<span class="params">border</span>[1],<span class="params">border</span>[2])</span>;</span><br><span class="line">	gl<span class="constructor">RoundRec(<span class="params">centerX</span>,<span class="params">centerY</span>,<span class="params">width</span>,<span class="params">height</span>,<span class="params">cirR</span>,GL_LINE_LOOP)</span>;</span><br><span class="line">	gl<span class="constructor">Color3ub(<span class="params">color</span>[0],<span class="params">color</span>[1],<span class="params">color</span>[2])</span>;</span><br><span class="line">	gl<span class="constructor">RoundRec(<span class="params">centerX</span>,<span class="params">centerY</span>,<span class="params">width</span>-<span class="params">lineWidth</span><span class="operator">/</span>2,<span class="params">height</span>-<span class="params">lineWidth</span><span class="operator">/</span>2,<span class="params">cirR</span>,GL_POLYGON)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//画填充的圆形</span></span><br><span class="line">void gl<span class="constructor">FillCircle(<span class="params">double</span> <span class="params">x</span>, <span class="params">double</span> <span class="params">y</span>, <span class="params">double</span> <span class="params">radius</span>,<span class="params">int</span> <span class="params">color</span>[3])</span>&#123;</span><br><span class="line">	gl<span class="constructor">Color3ub(<span class="params">border</span>[0],<span class="params">border</span>[1],<span class="params">border</span>[2])</span>;</span><br><span class="line">	gl<span class="constructor">Circle(<span class="params">x</span>,<span class="params">y</span>,<span class="params">radius</span>,GL_LINE_LOOP)</span>;</span><br><span class="line">	gl<span class="constructor">Color3ub(<span class="params">color</span>[0],<span class="params">color</span>[1],<span class="params">color</span>[2])</span>;</span><br><span class="line">	gl<span class="constructor">Circle(<span class="params">x</span>,<span class="params">y</span>,<span class="params">radius</span>-<span class="params">lineWidth</span><span class="operator">/</span>2,GL_POLYGON)</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>恩，万事俱备只欠东风了，下面我们调用一下这几个函数直接进行绘制就好啦。 display 中的绘图调用如下</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//函数用来画图</span></span><br><span class="line"><span class="built_in">void</span> display(<span class="built_in">void</span>)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//GL_COLOR_BUFFER_BIT表示清除颜色</span></span><br><span class="line">	glClear(GL_COLOR_BUFFER_BIT);</span><br><span class="line">	glLineWidth(lineWidth);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//设置画线颜色</span></span><br><span class="line">    glColor3ub(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">	glPolygonMode(GL_FRONT_AND_BACK, GL_FILL);</span><br><span class="line">	<span class="comment">//画圆角矩形，大脸</span></span><br><span class="line">	glFillRoundRec(<span class="number">0</span>,<span class="number">113</span>,<span class="number">128</span>,<span class="number">74</span>,<span class="number">10</span>,grey);</span><br><span class="line">	<span class="comment">//两个眼睛</span></span><br><span class="line">	glFillCircle(<span class="number">-30</span>,<span class="number">111</span>,<span class="number">10</span>,white);</span><br><span class="line">	glFillCircle(<span class="number">30</span>,<span class="number">111</span>,<span class="number">10</span>,white);</span><br><span class="line">	<span class="comment">//黑色线</span></span><br><span class="line">	glColor3ub(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">	<span class="comment">//两条天线</span></span><br><span class="line">	glLine(<span class="number">-35</span>,<span class="number">150</span>,<span class="number">-35</span>,<span class="number">173</span>);</span><br><span class="line">	glLine(<span class="number">35</span>,<span class="number">150</span>,<span class="number">35</span>,<span class="number">173</span>);</span><br><span class="line">	<span class="comment">//圆弧，画嘴</span></span><br><span class="line">	glArc(<span class="number">0</span>,<span class="number">133</span>,<span class="number">11</span>*PI/<span class="number">8</span>,<span class="number">13</span>*PI/<span class="number">8</span>,<span class="number">45</span>,GL_LINE_STRIP);</span><br><span class="line">	<span class="comment">//画矩形，脖子</span></span><br><span class="line">	glFillRect(<span class="number">-25</span>,<span class="number">76</span>,<span class="number">25</span>,<span class="number">60</span>,grey);</span><br><span class="line">	<span class="comment">//圆角矩形，两个耳朵</span></span><br><span class="line">	glFillRoundRec(<span class="number">81</span>,<span class="number">115</span>,<span class="number">20</span>,<span class="number">34</span>,<span class="number">5</span>,darkGrey);</span><br><span class="line">	glFillRoundRec(<span class="number">-81</span>,<span class="number">115</span>,<span class="number">20</span>,<span class="number">34</span>,<span class="number">5</span>,darkGrey);</span><br><span class="line">	<span class="comment">//画圆角矩形，大肚子</span></span><br><span class="line">	glFillRoundRec(<span class="number">0</span>,<span class="number">0</span>,<span class="number">146</span>,<span class="number">120</span>,<span class="number">15</span>,grey);</span><br><span class="line">	<span class="comment">//画三角，肚子里的三角</span></span><br><span class="line">	glFillTri(<span class="number">-30</span>,<span class="number">-15</span>,<span class="number">30</span>,<span class="number">-15</span>,<span class="number">0</span>,<span class="number">28</span>,yellow);</span><br><span class="line">	<span class="comment">//画圆，中间小圈</span></span><br><span class="line">	glFillCircle(<span class="number">0</span>,<span class="number">0</span>,<span class="number">10</span>,red);</span><br><span class="line">	<span class="comment">//画矩形，胳膊连接处</span></span><br><span class="line">	glFillRect(<span class="number">-81</span>,<span class="number">43</span>,<span class="number">-73</span>,<span class="number">25</span>,grey);</span><br><span class="line">	glFillRect(<span class="number">73</span>,<span class="number">43</span>,<span class="number">81</span>,<span class="number">25</span>,grey);</span><br><span class="line">	<span class="comment">//画矩形，上臂</span></span><br><span class="line">	glFillRect(<span class="number">-108</span>,<span class="number">45</span>,<span class="number">-81</span>,<span class="number">0</span>,darkGrey);</span><br><span class="line">	glFillRect(<span class="number">81</span>,<span class="number">45</span>,<span class="number">108</span>,<span class="number">0</span>,darkGrey);</span><br><span class="line">	<span class="comment">//画矩形，中臂</span></span><br><span class="line">	glFillRect(<span class="number">-101</span>,<span class="number">0</span>,<span class="number">-88</span>,<span class="number">-4</span>,grey);</span><br><span class="line">	glFillRect(<span class="number">88</span>,<span class="number">0</span>,<span class="number">101</span>,<span class="number">-4</span>,grey);</span><br><span class="line">	<span class="comment">//画矩形，下臂</span></span><br><span class="line">	glFillRect(<span class="number">-108</span>,<span class="number">-4</span>,<span class="number">-81</span>,<span class="number">-37</span>,darkGrey);</span><br><span class="line">	glFillRect(<span class="number">81</span>,<span class="number">-4</span>,<span class="number">108</span>,<span class="number">-37</span>,darkGrey);</span><br><span class="line">	<span class="comment">//画圆形，手掌</span></span><br><span class="line">	glFillCircle(<span class="number">-95</span>,<span class="number">-47</span>,<span class="number">10</span>,grey);</span><br><span class="line">	glFillCircle(<span class="number">95</span>,<span class="number">-47</span>,<span class="number">10</span>,grey);</span><br><span class="line">	<span class="comment">//画腿连接处</span></span><br><span class="line">	glFillRect(<span class="number">-41</span>,<span class="number">-62</span>,<span class="number">-21</span>,<span class="number">-66</span>,grey);</span><br><span class="line">	glFillRect(<span class="number">21</span>,<span class="number">-62</span>,<span class="number">41</span>,<span class="number">-66</span>,grey);</span><br><span class="line">	<span class="comment">//画圆角矩形，大长腿</span></span><br><span class="line">	glFillRoundRec(<span class="number">-32</span>,<span class="number">-92</span>,<span class="number">38</span>,<span class="number">52</span>,<span class="number">10</span>,darkGrey);</span><br><span class="line">	glFillRoundRec(<span class="number">32</span>,<span class="number">-92</span>,<span class="number">38</span>,<span class="number">52</span>,<span class="number">10</span>,darkGrey);</span><br><span class="line">	<span class="comment">//画矩形，脚踝</span></span><br><span class="line">	glFillRect(<span class="number">-41</span>,<span class="number">-117</span>,<span class="number">-21</span>,<span class="number">-125</span>,grey);</span><br><span class="line">	glFillRect(<span class="number">21</span>,<span class="number">-117</span>,<span class="number">41</span>,<span class="number">-125</span>,grey);</span><br><span class="line">	<span class="comment">//画矩形，大脚掌</span></span><br><span class="line">	glFillRect(<span class="number">-59</span>,<span class="number">-125</span>,<span class="number">-8</span>,<span class="number">-137</span>,darkGrey);</span><br><span class="line">	glFillRect(<span class="number">8</span>,<span class="number">-125</span>,<span class="number">59</span>,<span class="number">-137</span>,darkGrey);</span><br><span class="line">	glFlush();</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>恩，这样就大功告成啦，是不是比种子填充算法简单多了？</p>
                  <h2 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h2>
                  <p><a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/QQ截图20150421000536.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/QQ截图20150421000536.jpg" alt="QQ截图20150421000536"></a> 恩，那些小白点就忽略吧！！这叫不拘小节！！哈哈哈！！</p>
                  <h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2>
                  <p>本节我们利用了类库的方法来实现了颜色填充，是不是很简单？</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-04-20 23:56:51" itemprop="dateCreated datePublished" datetime="2015-04-20T23:56:51+08:00">2015-04-20</time>
                </span>
                <span id="/1649.html" class="post-meta-item leancloud_visitors" data-flag-title="OpenGL绘图实例四之区域颜色填充" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>7.2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>7 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1640.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> C/C++ <i class="label-arrow"></i>
                  </a>
                  <a href="/1640.html" class="post-title-link" itemprop="url">OpenGL绘图实例三之种子填充算法</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>博主研究了一下午加一晚上，终于把种子填充算法实现出来并把机器人填充完毕，路途很艰辛，不过也学到了很多，在此和大家一起分享。</p>
                  <h2 id="吐槽"><a href="#吐槽" class="headerlink" title="吐槽"></a>吐槽</h2>
                  <p>与我不是同学的小伙伴，请自动忽略，我是来吐槽教材的。 在此不得不吐槽一下，不得不说教材实在太坑爹了。对于种子填充算法的后半部分，下一个种子点的寻找过程中，从 while(x&lt;=xright)开始，我实在无法搞懂它里面的神逻辑，最初我认为它是对的，后来按照它的思路实现之后，填充基本上是错误的，比如圆角矩形下方的部分，它就无法正常填充。根本原因还是它的下一步种子点找错了，而博主依然在固执地 DeBug，看看是不是我哪里编码有问题。后来，干脆放弃了书上的逻辑了，自己改写了搜寻下一个种子点的算法，最后终于成功。 另外，教材上的这些伪代码写得也是太伪，算了，这不是重点，言归正传。</p>
                  <h2 id="基本梳理"><a href="#基本梳理" class="headerlink" title="基本梳理"></a>基本梳理</h2>
                  <p>在博主的研究过程中，遇到了许许多多的小问题，在这里统一做一下总结，也希望大家少走弯路，吸取我的经验教训。</p>
                  <h3 id="1-点的定义"><a href="#1-点的定义" class="headerlink" title="1.点的定义"></a>1.点的定义</h3>
                  <p>在这里我们避免不了要使用点，一个点包括了 2 个元素，一个是横坐标一个是纵坐标，所以我们可以直接把它定义为一个结构体。</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Point</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="keyword">int</span> x;</span><br><span class="line">	<span class="keyword">int</span> y;</span><br><span class="line">&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样的话，我们就可以直接声明一个 Point 类型的变量使用了，既方便又直观。</p>
                  <h3 id="2-栈的使用"><a href="#2-栈的使用" class="headerlink" title="2.栈的使用"></a>2.栈的使用</h3>
                  <p>对于种子填充算法，肯定避免不了使用栈的，在这里博主分享一下一些使用心得。 <strong>栈的引入</strong> C++代码中，可以直接用下面的代码来导入</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>注意，这里一定记得加上 using namespace std 这句话，否则会出现 stack 未定义的错误，哈哈哈，深有体会。 <strong>栈的定义</strong> 引入了栈之后，我们就可以直接来声明一个栈了</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">stack</span>&lt;Point&gt; pixelStack;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中，需要加一个尖括号，尖括号中声明了 Point 类型，这样我们就可以使用它了 <strong>取栈顶元素</strong> C++中取栈顶元素是很坑的，有一个 top 方法，还有一个 pop 方法。 其中 top 方法是只取得栈顶的元素而不移除它，pop 方法是直接移除栈顶元素，没有返回值。 所以我们要想取出栈顶元素并移除的话，就要分别调用这两个方法</p>
                  <figure class="highlight arcade">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//获取最顶端的元素</span></span><br><span class="line"><span class="built_in">Point</span> tempPoint=pixelStack.top();</span><br><span class="line"><span class="comment">//删除最顶端的元素</span></span><br><span class="line">pixelStack.pop();</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>是不是不友好？不友好的话，那就自己去定义一个新方法吧，我就先不这么干啦。 <strong>判断栈非空</strong> 判断当前的栈是否已经为空，只需要调用 empty 方法就可以了</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="title">while</span><span class="params">(!pixelStack.empty()</span></span>)&#123;</span><br><span class="line"><span class="comment">//code</span></span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里是一个 while 循环，如果栈为非空的话不断循环。 <strong>关于栈置空</strong> 教材中的种子填充算法中用到了栈置空，不过我感觉没有必要这么做，因为在方法最前面是新声明的栈变量，它一定是空的。不过如果非要置空的话，可以利用下面的代码</p>
                  <figure class="highlight gcode">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">while</span><span class="comment">(!pixelStack.empty()</span>)&#123;</span><br><span class="line">    pixelStack.pop<span class="comment">()</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果栈不为空，就一直取元素，就可以把它置空啦。</p>
                  <h3 id="3-关于-glColor3b-和-glColor3ub"><a href="#3-关于-glColor3b-和-glColor3ub" class="headerlink" title="3.关于 glColor3b 和 glColor3ub"></a>3.关于 glColor3b 和 glColor3ub</h3>
                  <p>这的确也是坑得博主不浅，之前一直在用 glColor3b 这个方法来定义颜色，奇怪的是 glColor3b(255,0,0) 竟然不是红色，而是黑色！就是因为这个颜色问题，导致我在比对颜色的过程中走了很多弯路。在这里做一下说明 glColor3b()需要传入的是 byte 类型，它的数值范围是-128-127，也就是有符号数，我传入 255，由于越界了，255 这个数就相当于-128，难怪不变红啊。 glColor3ub()需要传入的是 unsigned byte 类型，范围是 0-255，无符号数，那么在这里我们传入 255,0,0 这三个数，就变成红色了。</p>
                  <h3 id="4-取得某像素颜色"><a href="#4-取得某像素颜色" class="headerlink" title="4.取得某像素颜色"></a>4.取得某像素颜色</h3>
                  <p>我想说的是，这也是个深坑啊，一下午的 Debug 全归它身上了。 获取某个像素的这个函数是</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">void gl<span class="constructor">ReadPixels(GLint <span class="params">x</span>,GLint <span class="params">y</span>,GLsizesi <span class="params">width</span>,GLsizei <span class="params">height</span>,GLenum <span class="params">format</span>,GLenum <span class="params">type</span>,GLvoid <span class="operator">*</span><span class="params">pixel</span>)</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>函数说明如下：</p>
                  <blockquote>
                    <p>该函数总共有七个参数。前四个参数可以得到一个矩形，该矩形所包括的像素都会被读取出来。（第一、二个参数表示了矩形的左下角横、纵坐标，坐标以窗口最左下角为零，最右上角为最大值；第三、四个参数表示了矩形的宽度和高度） 第五个参数表示读取的内容，例如：GL_RGB 就会依次读取像素的红、绿、蓝三种数据，GL_RGBA 则会依次读取像素的红、绿、蓝、alpha 四种数据，GL_RED 则只读取像素的红色数据（类似的还有 GL_GREEN，GL_BLUE，以及 GL_ALPHA）。如果采用的不是 RGBA 颜色模式，而是采用颜色索引模式，则也可以使用 GL_COLOR_INDEX 来读取像素的颜色索引。目前仅需要知道这些，但实际上还可以读取其它内容，例如深度缓冲区的深度数据等。 第六个参数表示读取的内容保存到内存时所使用的格式，例如：GL_UNSIGNED_BYTE 会把各种数据保存为 GLubyte，GL_FLOAT 会把各种数据保存为 GLfloat 等。 第七个参数表示一个指针，像素数据被读取后，将被保存到这个指针所表示的地址。注意，需要保证该地址有足够的可以使用的空间，以容纳读取的像素数据。例如一幅大小为 256*256 的图象，如果读取其 RGB 数据，且每一数据被保存为 GLubyte。</p>
                  </blockquote>
                  <p>好了，那么重点来了，这个方法的坐标基准点是在画布的左下角！！而我们绘图的基准点是在画布的正中心！！所以我在获取某个点的颜色的时候一直都是错误的结果，这样的话在使用的时候我们的 xy 坐标值就要加上画布宽高的一半才能正常获取到像素的颜色，希望大家一定注意！！ 那么我们如何来使用呢？实例如下，首先定义 GLByte 的数组</p>
                  <figure class="highlight abnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">GLubyte iPixel[<span class="number">3</span>]<span class="comment">;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>另外还有画布的宽度高度的一半变量</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">int</span> halfWidth,halfHeight;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们可以调用如下的方法来获取(x,y)这个点像素的值</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">gl<span class="constructor">ReadPixels(<span class="params">x</span>+<span class="params">halfWidth</span>,<span class="params">y</span>+<span class="params">halfHeight</span>,1,1,GL_RGB,GL_UNSIGNED_BYTE,&amp;<span class="params">iPixel</span>)</span>;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里第五个参数我们定义了 GL_RGB，第六个参数我们定义了 GL_UNSIGNED_BYTE，最后是传入了数组的引用。 所以在调用这个方法之后，iPixel 数组里面的三个值就已经赋值为了该点的 RGB 值，可以拿来做下一步的判断。 比如我们边界可以定义为</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">GLubyte oldColor[<span class="number">3</span>]=&#123;<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>&#125;;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在比较的时候就可以用下面的判别式</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">iPixel[<span class="number">0</span>]!=borderColor[<span class="number">0</span>]&amp;&amp;iPixel[<span class="number">1</span>]!=borderColor[<span class="number">1</span>]&amp;&amp;iPixel[<span class="number">2</span>]!=borderColor[<span class="number">2</span>]</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里我们是依次比较了三个 RGB 值是否与边界的 RGB 值相等，不过，有意思的是，识别颜色的这个方法，黑色的 RGB 值会识别成 1,1,1，而有时候在我调试的时候会识别为 0,1,1。我在想是不是系统计算误差问题，如果真是的话，因为这个小小的误差就影响了我们的判别条件岂不是亏大了？那么在这里我就定义了一个方法，允许一定的误差，这个误差姑且就称为 PS 里面的容差吧。</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//传入两个颜色的RGB值，比较是否相同，容差为dis</span></span><br><span class="line"><span class="built_in">bool</span> same<span class="constructor">Color(<span class="params">int</span> <span class="params">r1</span>,<span class="params">int</span> <span class="params">g1</span>,<span class="params">int</span> <span class="params">b1</span>,<span class="params">int</span> <span class="params">r2</span>,<span class="params">int</span> <span class="params">g2</span>,<span class="params">int</span> <span class="params">b2</span>)</span>&#123;</span><br><span class="line">	<span class="comment">//容差度</span></span><br><span class="line">	<span class="built_in">int</span> dis = <span class="number">10</span>;</span><br><span class="line">	<span class="keyword">if</span>(abs(r1-r2)&lt;=dis&amp;&amp;abs(g1-g2)&lt;=dis&amp;&amp;abs(b1-b2)&lt;=dis)&#123;</span><br><span class="line">		return <span class="literal">true</span>;</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		return <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>那么我们的判定条件就改为了</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">!same<span class="constructor">Color(<span class="params">iPixel</span>[0],<span class="params">iPixel</span>[1],<span class="params">iPixel</span>[2],<span class="params">borderColor</span>[0],<span class="params">borderColor</span>[1],<span class="params">borderColor</span>[2])</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这样系统误差便不会影响了。</p>
                  <h3 id="5-下一个种子点的选取"><a href="#5-下一个种子点的选取" class="headerlink" title="5.下一个种子点的选取"></a>5.下一个种子点的选取</h3>
                  <p>教材上的种子点选取算法有点搞不懂，我按照上面的思路实现出来，在填充的时候出现了一系列问题。后来干脆放弃了教材中的方法，自己改写了一下。 思路大体上是这样的。</p>
                  <blockquote>
                    <p>在填充完一行后，这一行最左边的像素点我们定义为(xLeft,y)，最右边的像素我们定义为(xRight,y)，扫描上一行找寻下一个种子点，这里 y 就要增加 1，如果(xRight,y+1)这个点不是边界不是已经填充的点，那么这个点就可以作为种子点压入堆栈。如果这个点是边界或者是已经填充的点，那么就继续往左搜索，如果找到既不是边界又未填充的点，那么这个点就是种子点，压入堆栈。如果一直往左找到 xLeft 还是没有找到的话，就不存在下一个种子点了。下一行扫描线也是同样的原理，y 要在这个基础上减去 2 即可。</p>
                  </blockquote>
                  <p>恩，不知道大家有没有看懂，这是我自己想出来的方法，<strong>不敢保证完全正确，在此仅供参考</strong>。 如果大家真的可以按照教材中的方法实现成功的话，希望告诉我一下，感激不尽。</p>
                  <h2 id="方法实现"><a href="#方法实现" class="headerlink" title="方法实现"></a>方法实现</h2>
                  <p>恩，重要的地方都已经点明了，下面就直接附上我的种子填充算法吧！</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//种子填充算法</span></span><br><span class="line">void zz<span class="constructor">Fill(<span class="params">int</span> <span class="params">startX</span>,<span class="params">int</span> <span class="params">startY</span>,<span class="params">int</span> <span class="params">r</span>,<span class="params">int</span> <span class="params">g</span>,<span class="params">int</span> <span class="params">b</span>)</span>&#123;</span><br><span class="line">	stack&lt;Point&gt; pixelStack;</span><br><span class="line">	<span class="comment">//x,y是给定的种子像素点，rgb就是要填充的颜色的RGB值</span></span><br><span class="line">	Point point  = &#123;startX,startY&#125;;</span><br><span class="line">	pixelStack.push(point);</span><br><span class="line">	<span class="built_in">int</span> saveX;</span><br><span class="line">	<span class="built_in">int</span> xRight,xLeft;</span><br><span class="line">	<span class="built_in">int</span> x,y;</span><br><span class="line">	<span class="comment">//如果栈不为空</span></span><br><span class="line">	<span class="keyword">while</span>(!pixelStack.empty<span class="literal">()</span>)&#123;</span><br><span class="line">		<span class="comment">//获取最顶端的元素</span></span><br><span class="line">		Point tempPoint=pixelStack.top<span class="literal">()</span>;</span><br><span class="line">		<span class="comment">//删除最顶端的元素</span></span><br><span class="line">		pixelStack.pop<span class="literal">()</span>;</span><br><span class="line">		saveX=tempPoint.x;</span><br><span class="line">		x=tempPoint.x;</span><br><span class="line">		y=tempPoint.y;</span><br><span class="line">		gl<span class="constructor">ReadPixels(<span class="params">x</span>+<span class="params">halfWidth</span>,<span class="params">y</span>+<span class="params">halfHeight</span>,1,1,GL_RGB,GL_UNSIGNED_BYTE,&amp;<span class="params">iPixel</span>)</span>;</span><br><span class="line">		<span class="comment">//如果没有到达右边界，就填充</span></span><br><span class="line">		<span class="keyword">while</span>(!same<span class="constructor">Color(<span class="params">iPixel</span>[0],<span class="params">iPixel</span>[1],<span class="params">iPixel</span>[2],<span class="params">borderColor</span>[0],<span class="params">borderColor</span>[1],<span class="params">borderColor</span>[2])</span>)&#123;</span><br><span class="line">			gl<span class="constructor">Point(<span class="params">x</span>,<span class="params">y</span>,<span class="params">r</span>,<span class="params">g</span>,<span class="params">b</span>)</span>;</span><br><span class="line">			x=x+<span class="number">1</span>;</span><br><span class="line">			gl<span class="constructor">ReadPixels(<span class="params">x</span>+<span class="params">halfWidth</span>,<span class="params">y</span>+<span class="params">halfHeight</span>,1,1,GL_RGB,GL_UNSIGNED_BYTE,&amp;<span class="params">iPixel</span>)</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		xRight=x-<span class="number">1</span>;</span><br><span class="line">		x=saveX-<span class="number">1</span>;</span><br><span class="line">		gl<span class="constructor">ReadPixels(<span class="params">x</span>+<span class="params">halfWidth</span>,<span class="params">y</span>+<span class="params">halfWidth</span>,1,1,GL_RGB,GL_UNSIGNED_BYTE,&amp;<span class="params">iPixel</span>)</span>;</span><br><span class="line">		<span class="comment">//如果没有到达左边界，就填充</span></span><br><span class="line">		<span class="keyword">while</span>(!same<span class="constructor">Color(<span class="params">iPixel</span>[0],<span class="params">iPixel</span>[1],<span class="params">iPixel</span>[2],<span class="params">borderColor</span>[0],<span class="params">borderColor</span>[1],<span class="params">borderColor</span>[2])</span>)&#123;</span><br><span class="line">			gl<span class="constructor">Point(<span class="params">x</span>,<span class="params">y</span>,<span class="params">r</span>,<span class="params">g</span>,<span class="params">b</span>)</span>;</span><br><span class="line">			x=x-<span class="number">1</span>;</span><br><span class="line">			gl<span class="constructor">ReadPixels(<span class="params">x</span>+<span class="params">halfWidth</span>,<span class="params">y</span>+<span class="params">halfWidth</span>,1,1,GL_RGB,GL_UNSIGNED_BYTE,&amp;<span class="params">iPixel</span>)</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//保存左端点</span></span><br><span class="line">		xLeft=x+<span class="number">1</span>;</span><br><span class="line">		<span class="comment">//从右边的点开始</span></span><br><span class="line">		x=xRight;</span><br><span class="line">		<span class="comment">//检查上端的扫描线</span></span><br><span class="line">		y=y+<span class="number">1</span>;</span><br><span class="line">		<span class="keyword">while</span>(x&gt;=xLeft)&#123;</span><br><span class="line">			gl<span class="constructor">ReadPixels(<span class="params">x</span>+<span class="params">halfWidth</span>,<span class="params">y</span>+<span class="params">halfWidth</span>,1,1,GL_RGB,GL_UNSIGNED_BYTE,&amp;<span class="params">iPixel</span>)</span>;</span><br><span class="line">			<span class="keyword">if</span>(!same<span class="constructor">Color(<span class="params">iPixel</span>[0],<span class="params">iPixel</span>[1],<span class="params">iPixel</span>[2],<span class="params">borderColor</span>[0],<span class="params">borderColor</span>[1],<span class="params">borderColor</span>[2])</span>&amp;&amp;!same<span class="constructor">Color(<span class="params">iPixel</span>[0],<span class="params">iPixel</span>[1],<span class="params">iPixel</span>[2],<span class="params">r</span>,<span class="params">g</span>,<span class="params">b</span>)</span>)&#123;</span><br><span class="line">				<span class="comment">//如果上方的点不是边界点，直接压入</span></span><br><span class="line">				Point p=&#123;x,y&#125;;</span><br><span class="line">				pixelStack.push(p);</span><br><span class="line">				<span class="comment">//压入之后停止循环</span></span><br><span class="line">				break;</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				x--;</span><br><span class="line">				gl<span class="constructor">ReadPixels(<span class="params">x</span>+<span class="params">halfWidth</span>,<span class="params">y</span>+<span class="params">halfWidth</span>,1,1,GL_RGB,GL_UNSIGNED_BYTE,&amp;<span class="params">iPixel</span>)</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//检查下端的扫描线</span></span><br><span class="line">		y=y-<span class="number">2</span>;</span><br><span class="line">		<span class="comment">//从右边的点开始</span></span><br><span class="line">		x=xRight;</span><br><span class="line">		<span class="keyword">while</span>(x&gt;=xLeft)&#123;</span><br><span class="line">			gl<span class="constructor">ReadPixels(<span class="params">x</span>+<span class="params">halfWidth</span>,<span class="params">y</span>+<span class="params">halfWidth</span>,1,1,GL_RGB,GL_UNSIGNED_BYTE,&amp;<span class="params">iPixel</span>)</span>;</span><br><span class="line">			<span class="keyword">if</span>(!same<span class="constructor">Color(<span class="params">iPixel</span>[0],<span class="params">iPixel</span>[1],<span class="params">iPixel</span>[2],<span class="params">borderColor</span>[0],<span class="params">borderColor</span>[1],<span class="params">borderColor</span>[2])</span>&amp;&amp;!same<span class="constructor">Color(<span class="params">iPixel</span>[0],<span class="params">iPixel</span>[1],<span class="params">iPixel</span>[2],<span class="params">r</span>,<span class="params">g</span>,<span class="params">b</span>)</span>)&#123;</span><br><span class="line">				<span class="comment">//如果上方的点不是边界点，直接压入</span></span><br><span class="line">				Point p=&#123;x,y&#125;;</span><br><span class="line">				<span class="comment">//压入之后停止循环</span></span><br><span class="line">				pixelStack.push(p);</span><br><span class="line">				break;</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				x--;</span><br><span class="line">				gl<span class="constructor">ReadPixels(<span class="params">x</span>+<span class="params">halfWidth</span>,<span class="params">y</span>+<span class="params">halfWidth</span>,1,1,GL_RGB,GL_UNSIGNED_BYTE,&amp;<span class="params">iPixel</span>)</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上便是我实现的种子填充算法，仅供参考 在这里我们用到了 glPoint 画点的方法，这是我们定义的，方法如下，为了便于调试，每画一个点刷新一下，这样我们就可以看到绘制的全部动态效果。</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//画点</span></span><br><span class="line">void gl<span class="constructor">Point(<span class="params">int</span> <span class="params">x</span>,<span class="params">int</span> <span class="params">y</span>,<span class="params">int</span> <span class="params">r</span>,<span class="params">int</span> <span class="params">g</span>,<span class="params">int</span> <span class="params">b</span>)</span>&#123;</span><br><span class="line">	glColor3ub (r,g,b);</span><br><span class="line">	gl<span class="constructor">PointSize(1)</span>;</span><br><span class="line">	gl<span class="constructor">Begin(GL_POINTS)</span>;</span><br><span class="line">	gl<span class="constructor">Vertex2i(<span class="params">x</span>,<span class="params">y</span>)</span>;</span><br><span class="line">	gl<span class="constructor">End()</span>;</span><br><span class="line">	gl<span class="constructor">Flush()</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上便是画点的函数</p>
                  <h2 id="方法使用"><a href="#方法使用" class="headerlink" title="方法使用"></a>方法使用</h2>
                  <p>种子填充算法肯定要在我们绘制完机器人之后使用，任意选取某个四连通区域的点，传入 xy 坐标值还有要填充的颜色的 RGB 值，就可以成功实现填充。 在上一篇机器人的基础上，我们在画机器人的方法最后加入下面的代码，即可实现填充。</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//灰色:195,195,195</span></span><br><span class="line"><span class="comment">//黄色:255,243,0</span></span><br><span class="line"><span class="comment">//红色:237,28,36</span></span><br><span class="line"><span class="comment">//深灰色:126,126,126</span></span><br><span class="line"><span class="comment">//脖子</span></span><br><span class="line">zzFill(<span class="number">0</span>,<span class="number">70</span>,<span class="number">195</span>,<span class="number">195</span>,<span class="number">195</span>);</span><br><span class="line"><span class="comment">//头</span></span><br><span class="line">zzFill(<span class="number">-50</span>,<span class="number">110</span>,<span class="number">195</span>,<span class="number">195</span>,<span class="number">195</span>);</span><br><span class="line">zzFill(<span class="number">0</span>,<span class="number">93</span>,<span class="number">195</span>,<span class="number">195</span>,<span class="number">195</span>);</span><br><span class="line"><span class="comment">//肚子</span></span><br><span class="line">zzFill(<span class="number">-50</span>,<span class="number">0</span>,<span class="number">195</span>,<span class="number">195</span>,<span class="number">195</span>);</span><br><span class="line"><span class="comment">//耳朵</span></span><br><span class="line">zzFill(<span class="number">-80</span>,<span class="number">115</span>,<span class="number">126</span>,<span class="number">126</span>,<span class="number">126</span>);</span><br><span class="line">zzFill(<span class="number">80</span>,<span class="number">115</span>,<span class="number">126</span>,<span class="number">126</span>,<span class="number">126</span>);</span><br><span class="line"><span class="comment">//肚子三角</span></span><br><span class="line">zzFill(<span class="number">-20</span>,<span class="number">-10</span>,<span class="number">255</span>,<span class="number">243</span>,<span class="number">0</span>);</span><br><span class="line"><span class="comment">//肚子红色圆</span></span><br><span class="line">zzFill(<span class="number">0</span>,<span class="number">0</span>,<span class="number">237</span>,<span class="number">28</span>,<span class="number">36</span>);</span><br><span class="line"><span class="comment">//zzFill(-50,0,128,255,33);</span></span><br><span class="line"><span class="comment">//大臂</span></span><br><span class="line">zzFill(<span class="number">-90</span>,<span class="number">30</span>,<span class="number">126</span>,<span class="number">126</span>,<span class="number">126</span>);</span><br><span class="line">zzFill(<span class="number">90</span>,<span class="number">30</span>,<span class="number">126</span>,<span class="number">126</span>,<span class="number">126</span>);</span><br><span class="line"><span class="comment">//小臂</span></span><br><span class="line">zzFill(<span class="number">-90</span>,<span class="number">-20</span>,<span class="number">126</span>,<span class="number">126</span>,<span class="number">126</span>);</span><br><span class="line">zzFill(<span class="number">90</span>,<span class="number">-20</span>,<span class="number">126</span>,<span class="number">126</span>,<span class="number">126</span>);</span><br><span class="line"><span class="comment">//手</span></span><br><span class="line">zzFill(<span class="number">-75</span>,<span class="number">40</span>,<span class="number">195</span>,<span class="number">195</span>,<span class="number">195</span>);</span><br><span class="line">zzFill(<span class="number">75</span>,<span class="number">40</span>,<span class="number">195</span>,<span class="number">195</span>,<span class="number">195</span>);</span><br><span class="line"><span class="comment">//手</span></span><br><span class="line">zzFill(<span class="number">-95</span>,<span class="number">-47</span>,<span class="number">195</span>,<span class="number">195</span>,<span class="number">195</span>);</span><br><span class="line">zzFill(<span class="number">95</span>,<span class="number">-47</span>,<span class="number">195</span>,<span class="number">195</span>,<span class="number">195</span>);</span><br><span class="line"><span class="comment">//大腿连接处</span></span><br><span class="line">zzFill(<span class="number">-40</span>,<span class="number">-64</span>,<span class="number">195</span>,<span class="number">195</span>,<span class="number">195</span>);</span><br><span class="line">zzFill(<span class="number">40</span>,<span class="number">-64</span>,<span class="number">195</span>,<span class="number">195</span>,<span class="number">195</span>);</span><br><span class="line"><span class="comment">//大腿</span></span><br><span class="line">zzFill(<span class="number">-40</span>,<span class="number">-100</span>,<span class="number">126</span>,<span class="number">126</span>,<span class="number">126</span>);</span><br><span class="line">zzFill(<span class="number">40</span>,<span class="number">-100</span>,<span class="number">126</span>,<span class="number">126</span>,<span class="number">126</span>);</span><br><span class="line"><span class="comment">//脚踝</span></span><br><span class="line">zzFill(<span class="number">-40</span>,<span class="number">-121</span>,<span class="number">195</span>,<span class="number">195</span>,<span class="number">195</span>);</span><br><span class="line">zzFill(<span class="number">40</span>,<span class="number">-121</span>,<span class="number">195</span>,<span class="number">195</span>,<span class="number">195</span>);</span><br><span class="line"><span class="comment">//脚掌</span></span><br><span class="line">zzFill(<span class="number">-40</span>,<span class="number">-130</span>,<span class="number">126</span>,<span class="number">126</span>,<span class="number">126</span>);</span><br><span class="line">zzFill(<span class="number">40</span>,<span class="number">-130</span>,<span class="number">126</span>,<span class="number">126</span>,<span class="number">126</span>);</span><br><span class="line">system(<span class="string">"pause"</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>注意，有个很奇怪地方是绘制完了之后机器人就不见了，所以在这里加入了 system(“pause”)方法来暂停一下就好啦。 其他的代码基本都是上一篇中的了，大家自行整理。</p>
                  <h2 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h2>
                  <p>运行结果截图如下 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150419015002.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150419015002.jpg" alt="20150419015002"></a> 恩，就是这样！</p>
                  <h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2>
                  <p>以上便是博主利用种子填充算法来实现的机器人的颜色填充，在此分享给大家，希望对大家有帮助！ 如有问题和错误，欢迎大家给予我批评和指正，谢谢！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-04-19 02:00:00" itemprop="dateCreated datePublished" datetime="2015-04-19T02:00:00+08:00">2015-04-19</time>
                </span>
                <span id="/1640.html" class="post-meta-item leancloud_visitors" data-flag-title="OpenGL绘图实例三之种子填充算法" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>7.4k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>7 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1622.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 福利专区 <i class="label-arrow"></i>
                  </a>
                  <a href="/1622.html" class="post-title-link" itemprop="url">福利！还在用控制面板来隐藏文件夹？来试试这个吧！</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>小伙伴们总要有一些秘密是不能让别人知道的，之前我们使用的设置隐藏文件夹然后在控制面板设置不显示隐藏文件夹的方式都弱爆了，下面我们来用一种更高级的办法来设置隐藏文件夹，感受一下。</p>
                  <h2 id="设置隐藏"><a href="#设置隐藏" class="headerlink" title="设置隐藏"></a>设置隐藏</h2>
                  <p>首先我们创建一个文件夹，比如名字叫 SECRET，如图所示 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150415114405.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150415114405.jpg" alt="20150415114405"></a> 接下来我们打开命令行，输入如下命令</p>
                  <figure class="highlight dos">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">attrib</span> +s +h e:/SECRET</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150415114811.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150415114811.jpg" alt="20150415114811"></a> 输入命令之后，我们再查看一下 E 盘的内容，<strong>刷新一下，记得刷新！</strong>。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150415120601.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150415120601.jpg" alt="20150415120601"></a> 恩，那个文件夹已经不见了，有人说设置一下控制面板就显示出来了。 好，我们试试，控制面板<strong>设置显示隐藏的文件夹</strong> <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150415120426.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150415120426.jpg" alt="20150415120426"></a> 恩，我们再看看，它依然是找不到的，就是这样！ <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150415120601.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150415120601.jpg" alt="20150415120601"></a> 那么我们怎么找到它？很简单，访问的时候只要在输入文件夹名称就会找到它了。 比如，我在地址栏中输入 E:/SECRET，就可以找到它了 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150415115101.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150415115101-e1429070400267.jpg" alt="20150415115101"></a> 下面我们来介绍一下这个命令的用法</p>
                  <blockquote>
                    <p>attrib 命令用来显示或更改文件属性。</p>
                    <p>ATTRIB [+R | -R] [+A | -A ] [+S | -S] [+H | -H] [[drive:] [path] filename] [/S [/D]] + 设置属性。 - 清除属性。 R 只读文件属性。 A 存档文件属性。 S 系统文件属性。 H 隐藏文件属性。 [drive:][path][filename] 指定要处理的文件属性。 /S 处理当前文件夹及其子文件夹中的匹配文件。 /D 也处理文件夹。</p>
                  </blockquote>
                  <p>比如</p>
                  <figure class="highlight dos">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">attrib</span> +a +s +r +h e:/SECRET</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这句命令就是设置 E 盘的 SECRET 文件夹为存档文件、系统文件、只读文件、隐藏文件。</p>
                  <p>在这里我们只要设置为隐藏文件盒系统文件属性就可以完成文件夹的隐藏，是不是很酷炫？</p>
                  <h2 id="取消隐藏"><a href="#取消隐藏" class="headerlink" title="取消隐藏"></a>取消隐藏</h2>
                  <p>了解了上面的命令，取消隐藏就很简单啦，我们只需要输入下面的命令</p>
                  <figure class="highlight dos">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="built_in">attrib</span> -h -s e:/SECRET</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>再刷新一下目录，SECRET 目录就又出现了。</p>
                  <p><a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150415115831.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150415115831.jpg" alt="20150415115831"></a></p>
                  <p>恩，会了吧，小伙伴们还不赶紧试试。不用谢我，请叫我雷锋！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-04-15 12:01:37" itemprop="dateCreated datePublished" datetime="2015-04-15T12:01:37+08:00">2015-04-15</time>
                </span>
                <span id="/1622.html" class="post-meta-item leancloud_visitors" data-flag-title="福利！还在用控制面板来隐藏文件夹？来试试这个吧！" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>752</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1613.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> C/C++ <i class="label-arrow"></i>
                  </a>
                  <a href="/1613.html" class="post-title-link" itemprop="url">OpenGL绘图实例二之直线和圆弧的绘制</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>在上一篇文章我们介绍了利用类库来完成一个机器人绘制的过程，这里我们一起来看一下怎样直接利用直线和圆弧生成算法来进行图形的绘制。 <strong>P.S. 本篇文章针对《计算机图形学》张彩明 版来探讨学习。关于书中的详细算法不会再赘述。</strong> <strong>P.P.S. 本篇文章算法扩展思路及代码实现为博主原创内容，如存在纰漏和错误，希望大家指正。</strong></p>
                  <h2 id="直线生成算法"><a href="#直线生成算法" class="headerlink" title="直线生成算法"></a>直线生成算法</h2>
                  <h3 id="1-DDA-算法"><a href="#1-DDA-算法" class="headerlink" title="1.DDA 算法"></a>1.DDA 算法</h3>
                  <p>DDA 算法是最基本的一种直线生成算法了，代码实现简单，不过缺点是计算量比较大，画一个点要两次加法，两次取整运算。另外，DDA 算法还包括了除法运算。不仅算法复杂，而且硬件实现上有一定的难度。优点就是程序简单易懂，在这里实现如下</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//画直线的DDA算法</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dda</span><span class="params">(<span class="keyword">int</span> x1,<span class="keyword">int</span> y1,<span class="keyword">int</span> x2,<span class="keyword">int</span> y2)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> k,i;</span><br><span class="line">	<span class="keyword">float</span> x,y,dx,dy;</span><br><span class="line">	<span class="comment">//使k等于横纵坐标差值的较大者</span></span><br><span class="line">	k = <span class="built_in">abs</span>(x2-x1);</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">abs</span>(y2-y1)&gt;k)</span><br><span class="line">		k = <span class="built_in">abs</span>(y2-y1);</span><br><span class="line">	<span class="comment">//直线被划分为每一小段的长度</span></span><br><span class="line">	dx = <span class="keyword">float</span>(x2-x1)/k;</span><br><span class="line">	dy = <span class="keyword">float</span>(y2-y1)/k;</span><br><span class="line">	x = <span class="keyword">float</span>(x1);</span><br><span class="line">	y = <span class="keyword">float</span>(y1);</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>;i&lt;k;i++)&#123;</span><br><span class="line">		<span class="comment">//此处先加0.5再取整的作用是四舍五入</span></span><br><span class="line">		gl_Point((<span class="keyword">int</span>)(x+<span class="number">0.5</span>),(<span class="keyword">int</span>)(y+<span class="number">0.5</span>));</span><br><span class="line">		<span class="comment">//x和y分别增加相应的单位</span></span><br><span class="line">		x = x+dx;</span><br><span class="line">		y = y+dy;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>解释一下这里的 gl_Point 方法，这个方法并不是直接调用类库的方法，而是我们自己来实现的画点的方法。</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//画点</span></span><br><span class="line">void gl<span class="constructor">_Point(<span class="params">int</span> <span class="params">x</span>,<span class="params">int</span> <span class="params">y</span>)</span>&#123;</span><br><span class="line">	gl<span class="constructor">Begin(GL_POINTS)</span>;</span><br><span class="line">	gl<span class="constructor">Vertex2i(<span class="params">x</span>,<span class="params">y</span>)</span>;</span><br><span class="line">	gl<span class="constructor">End()</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>用来画点的话，我们必须要在 glBegin 方法传入 GL_POINTS 参数，然后利用类库中画点的方法来绘制点。</p>
                  <h3 id="2-正负法"><a href="#2-正负法" class="headerlink" title="2.正负法"></a>2.正负法</h3>
                  <p>在教材中只讨论了斜率在 0-1 之间的情况，代码的实现也是仅仅只有 0-1 一种情况，对于斜率大于 1，斜率在-1 和 0 之间以及斜率小于-1 的情况没有加以讨论。 如果我们直接拿来教材中的代码来用，我们会发现只能绘制出 0-1 斜率的直线，对于其他的情况，均绘制错误。 所以我们需要分四种情况来讨论，直线方程 F(x,y)=ax+by+c=0，其中 a=ys-ye，b=xe-xs 设直线的斜率为 k，讨论分类如下 <strong>（1）k∈[0,1)</strong> 此时有 a<0，b>0 d=F(M)=F(x+1,y+0.5)=a(x+1)+b(y+0.5)+c 当 d&gt;=0 时，Q 在 M 点下方，取右下方的点，d1=F(x+2,y+0.5)=a(x+2)+b(y+0.5)+c=d+a 当 d<0 时，Q 在 M 点上方，取右上方的点，d2=F(x+2,y+1.5)=a(x+2)+b(y+1.5)+c=d+a+b 此时 d 的初始值 d0=F(xs+1,ys+0.5)=a+0.5b **（2）k∈[1,+∞]** 此时有 a<0，b>0 d=F(M)=F(x+0.5,y+1)=a(x+0.5)+b(y+1)+c 当 d&gt;=0 时，Q 在 M 点右侧，取右上方的点，d1=F(x+1.5,y+2)=a(x+1.5)+b(y+2)+c=a+b+d 当 d<0 时，Q 在 M 点左侧，取左上方的点，d2=F(x+0.5,y+2)=b+d 此时 d 的初始值 d0=F(xs+0.5,ys+1)=0.5a+b **（3）k∈[-1,0)** 此时有 a>0，b&gt;0 d=F(M)=F(x+1,y-0.5)=a(x+1)+b(y-0.5)+c 当 d&gt;=0 时，Q 在 M 点下方，取右下方的点，d1=F(x+2,y-1.5)=a(x+2)+b(y-1.5)+c=a-b+d 当 d<0 时，Q 在 M 点上方，取右上方的点，d2=F(x+2,y-0.5)=a(x+2)+b(y-0.5)+c=a+d 此时 d 的初始值 d0=F(xs+1,ys-0.5)=a-0.5b **（4）k∈[-∞,-1)** 此时有 a>0，b&gt;0 d=F(M)=F(x+0.5,y-1)=a(x+0.5)+b(y-1)+c 当 d&gt;=0 时，Q 在 M 点左方，取左下方的点，d1=F(x+0.5,y-2)=a(x+0.5)+b(y-2)+c=d-b 当 d&lt;0 时，Q 在 M 点右方，取右下方的点，d2=F(x+1.5,y-2)=a(x+1.5)+b(y-2)+c=a-b+d 此时 d 的初始值 d0=F(xs+0.5,ys-1)=0.5a-b <strong>注意：上面的 a 和 b 的符号，是在默认起点在终点的左侧来看待的</strong> 所以，如果我们传入参数时，第二个点在第一个点的左侧时，我们可能就不会得到正确的结果。所以当我们发现第二个点不在第一个点右侧时，就需要把二者的横纵坐标交换。 代码实现如下，此实现<strong>仅供参考</strong>，未经优化。</p>
                  <figure class="highlight sas">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">//画直线的正负法</span><br><span class="line">void midPointLine(int xs,int ys,int xe,int ye)&#123;</span><br><span class="line">	<span class="meta">if</span>(xs&gt;xe)&#123;</span><br><span class="line">		swap(xs,xe);</span><br><span class="line">		swap(ys,ye);</span><br><span class="line">	&#125;</span><br><span class="line">	float a,b,dt1,dt2,d,<span class="meta">x</span>,y;</span><br><span class="line">	a=ys-ye;</span><br><span class="line">	b=xe-xs;</span><br><span class="line">	float k =(float)(ye-ys)/(xe-xs);</span><br><span class="line">	<span class="meta">if</span>(k&gt;=0<span class="variable">&amp;&amp;k</span>&lt;1)&#123;</span><br><span class="line">		d=2<span class="comment">*a+b;</span></span><br><span class="line">		dt1=2<span class="comment">*a;</span></span><br><span class="line">		dt2=2<span class="comment">*(a+b);</span></span><br><span class="line">	&#125;<span class="meta">else</span> <span class="meta">if</span>(k&gt;=1)&#123;</span><br><span class="line">		d=a+2<span class="comment">*b;</span></span><br><span class="line">		dt1=2<span class="comment">*(a+b);</span></span><br><span class="line">		dt2=2<span class="comment">*b;</span></span><br><span class="line">	&#125;<span class="meta">else</span> <span class="meta">if</span>(k&lt;0<span class="variable">&amp;&amp;k</span>&gt;=-1)&#123;</span><br><span class="line">		d=2<span class="comment">*a-b;</span></span><br><span class="line">		dt1=2<span class="comment">*(a-b);</span></span><br><span class="line">		dt2=2<span class="comment">*a;</span></span><br><span class="line">	&#125;<span class="meta">else</span> <span class="meta">if</span>(k&lt;-1)&#123;</span><br><span class="line">		d=a-2<span class="comment">*b;</span></span><br><span class="line">		dt1=-2<span class="comment">*b;</span></span><br><span class="line">		dt2=2<span class="comment">*(a-b);</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">x</span>=xs;y=ys;</span><br><span class="line">	gl<span class="meta">_Point(</span><span class="meta">x</span>,y);</span><br><span class="line">	<span class="meta">if</span>(k&gt;=0<span class="variable">&amp;&amp;k</span>&lt;1)&#123;</span><br><span class="line">		<span class="meta">while</span>(<span class="meta">x</span>&lt;xe)&#123;</span><br><span class="line">			<span class="meta">if</span>(d&lt;0)&#123;</span><br><span class="line">				<span class="meta">x</span>++;y++;d+=dt2;</span><br><span class="line">			&#125;<span class="meta">else</span>&#123;</span><br><span class="line">				<span class="meta">x</span>++;d+=dt1;</span><br><span class="line">			&#125;</span><br><span class="line">			gl<span class="meta">_Point(</span><span class="meta">x</span>,y);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;<span class="meta">else</span> <span class="meta">if</span>(k&gt;=1)&#123;</span><br><span class="line">		<span class="meta">while</span>(y&lt;ye)&#123;</span><br><span class="line">			<span class="meta">if</span>(d&lt;0)&#123;</span><br><span class="line">				y++;d+=dt2;</span><br><span class="line">			&#125;<span class="meta">else</span>&#123;</span><br><span class="line">				y++;<span class="meta">x</span>++;d+=dt1;</span><br><span class="line">			&#125;</span><br><span class="line">			gl<span class="meta">_Point(</span><span class="meta">x</span>,y);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;<span class="meta">else</span> <span class="meta">if</span>(k&lt;0<span class="variable">&amp;&amp;k</span>&gt;=-1)&#123;</span><br><span class="line">		<span class="meta">while</span>(<span class="meta">x</span>&lt;xe)&#123;</span><br><span class="line">			<span class="meta">if</span>(d&lt;0)&#123;</span><br><span class="line">				<span class="meta">x</span>++;d+=dt2;</span><br><span class="line">			&#125;<span class="meta">else</span>&#123;</span><br><span class="line">				<span class="meta">x</span>++;y--;d+=dt1;</span><br><span class="line">			&#125;</span><br><span class="line">			gl<span class="meta">_Point(</span><span class="meta">x</span>,y);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;<span class="meta">else</span> <span class="meta">if</span>(k&lt;-1)&#123;</span><br><span class="line">		<span class="meta">while</span>(y&gt;ye)&#123;</span><br><span class="line">			<span class="meta">if</span>(d&lt;0)&#123;</span><br><span class="line">				y--;<span class="meta">x</span>++;d+=dt2;</span><br><span class="line">			&#125;<span class="meta">else</span>&#123;</span><br><span class="line">				y--;d+=dt1;</span><br><span class="line">			&#125;</span><br><span class="line">			gl<span class="meta">_Point(</span><span class="meta">x</span>,y);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在一开始我们用到了 swap 方法，是用来交换两个数字的，实现如下</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//交换两个数字</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> &amp;x1,<span class="keyword">int</span> &amp;x2)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> temp = x2;</span><br><span class="line">	x2=x1;</span><br><span class="line">	x1=temp;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上便是正负法的实现，代码仅供参考。</p>
                  <h3 id="3-Bresenham-算法"><a href="#3-Bresenham-算法" class="headerlink" title="3.Bresenham 算法"></a>3.Bresenham 算法</h3>
                  <p>在教材中，同样是只针对斜率在 0-1 之间讨论。对于教材中的程序，我们也只能绘制斜率为 0-1 的直线，所以我们需要对另外三种情况进行扩充。 分类讨论如下 <strong>（1）k∈[0,1)</strong> 即教材中的讲解方法 <strong>（2）k∈[1,+∞]</strong> 需要把 x 和 y 互换即可 <strong>（3）k∈[-1,0)</strong> x 不变，y 换为-y <strong>（4）k∈[-∞,-1)</strong> x 换为-y，y 换为 x 程序实现如下</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//画直线的Bresenham方法</span></span><br><span class="line"><span class="built_in">void</span> bresen(<span class="built_in">int</span> x1,<span class="built_in">int</span> y1,<span class="built_in">int</span> x2,<span class="built_in">int</span> y2)&#123;</span><br><span class="line">	<span class="keyword">if</span>(x2&lt;x1)&#123;</span><br><span class="line">		swap(x1,x2);</span><br><span class="line">		swap(y1,y2);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">float</span> dx=x2-x1;</span><br><span class="line">	<span class="built_in">float</span> dy=y2-y1;</span><br><span class="line">	<span class="built_in">float</span> k=dy/dx;</span><br><span class="line">	<span class="built_in">float</span> m,e;<span class="built_in">int</span> i;</span><br><span class="line">	<span class="built_in">float</span> x=x1,y=y1;</span><br><span class="line">	<span class="keyword">if</span>(k&gt;=<span class="number">0</span>&amp;&amp;k&lt;<span class="number">1</span>)&#123;</span><br><span class="line">		<span class="comment">//斜率为0到1</span></span><br><span class="line">		m=dy/dx;</span><br><span class="line">		e=m<span class="number">-0.5</span>;</span><br><span class="line">		<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;dx;i++)&#123;</span><br><span class="line">			gl_Point(x,y);</span><br><span class="line">			<span class="keyword">if</span>(e&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">				y+=<span class="number">1</span>;e-=<span class="number">1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			x+=<span class="number">1</span>;e+=m;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;<span class="keyword">else</span> <span class="keyword">if</span>(k&gt;=<span class="number">1</span>)&#123;</span><br><span class="line">		<span class="comment">//x换为y,y换为x</span></span><br><span class="line">		m=dx/dy;</span><br><span class="line">		e=m<span class="number">-0.5</span>;</span><br><span class="line">		<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;dy;i++)&#123;</span><br><span class="line">			gl_Point(x,y);</span><br><span class="line">			<span class="keyword">if</span>(e&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">				x+=<span class="number">1</span>;e-=<span class="number">1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			y+=<span class="number">1</span>;e+=m;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;<span class="keyword">else</span> <span class="keyword">if</span>(k&lt;<span class="number">0</span>&amp;&amp;k&gt;=<span class="number">-1</span>)&#123;</span><br><span class="line">		<span class="comment">//x不变，y换为-y</span></span><br><span class="line">		m=-dy/dx;</span><br><span class="line">		e=m+<span class="number">0.5</span>;</span><br><span class="line">		<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;dx;i++)&#123;</span><br><span class="line">			gl_Point(x,y);</span><br><span class="line">			<span class="keyword">if</span>(e&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">				y-=<span class="number">1</span>;e+=<span class="number">1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			x+=<span class="number">1</span>;e-=m;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="comment">//将x换为-y,y换为x</span></span><br><span class="line">		m=-dx/dy;</span><br><span class="line">		e=m+<span class="number">0.5</span>;</span><br><span class="line">		<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;-dy;i++)&#123;</span><br><span class="line">			gl_Point(x,y);</span><br><span class="line">			<span class="keyword">if</span>(e&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">				x+=<span class="number">1</span>;e+=<span class="number">1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			y-=<span class="number">1</span>;e-=m;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上便是 Bresenham 算法，经测试通过。</p>
                  <h2 id="圆弧生成算法"><a href="#圆弧生成算法" class="headerlink" title="圆弧生成算法"></a>圆弧生成算法</h2>
                  <h3 id="1-正负法"><a href="#1-正负法" class="headerlink" title="1.正负法"></a>1.正负法</h3>
                  <p>教材中只讨论了圆弧在第一象限的情况，不过有趣的是，圆是具有对称性的，在绘制圆形时，我们如果把 x 换为-x，就可以绘制第二象限的图形，把 y 换为-y，就可以绘制第四象限的图形，代码也不需要改动很多。只需要在 gl_Point 上面下功夫即可。 另外，教材中圆弧生成算法中没有指定圆的中心点的坐标，我们可以把它当做参数来传递进来，然后传入 gl_Point 绘图函数即可，相当方便。 注：此方法不需要再繁琐地分类讨论。 在这里给出博主写出的两种方法，一种是如上所介绍的思路，利用对称性，另一种是分类讨论的思想。 <strong>（1）利用对称性实现</strong></p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//正负法画圆</span></span><br><span class="line">void pnarc<span class="constructor">Arc(<span class="params">int</span> <span class="params">radius</span>,<span class="params">int</span> <span class="params">centerX</span>,<span class="params">int</span> <span class="params">centerY</span>,<span class="params">int</span> <span class="params">area</span>)</span>&#123;</span><br><span class="line">	<span class="built_in">int</span> x,y,f;</span><br><span class="line">	x=<span class="number">0</span>;y=<span class="number">0</span>+radius;f=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(y&gt;<span class="number">0</span>)&#123;</span><br><span class="line">		switch(area)&#123;</span><br><span class="line">		case <span class="number">1</span>:</span><br><span class="line">			gl<span class="constructor">_Point(<span class="params">x</span>+<span class="params">centerX</span>,<span class="params">y</span>+<span class="params">centerY</span>)</span>;</span><br><span class="line">			break;</span><br><span class="line">		case <span class="number">2</span>:</span><br><span class="line">			gl<span class="constructor">_Point(-<span class="params">x</span>+<span class="params">centerX</span>,<span class="params">y</span>+<span class="params">centerY</span>)</span>;</span><br><span class="line">			break;</span><br><span class="line">		case <span class="number">3</span>:</span><br><span class="line">			gl<span class="constructor">_Point(-<span class="params">x</span>+<span class="params">centerX</span>,-<span class="params">y</span>+<span class="params">centerY</span>)</span>;</span><br><span class="line">			break;</span><br><span class="line">		case <span class="number">4</span>:</span><br><span class="line">			gl<span class="constructor">_Point(<span class="params">x</span>+<span class="params">centerX</span>,-<span class="params">y</span>+<span class="params">centerY</span>)</span>;</span><br><span class="line">			break;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(f&gt;<span class="number">0</span>)&#123;</span><br><span class="line">			f=f-<span class="number">2</span>*y+<span class="number">1</span>;</span><br><span class="line">			y=y-<span class="number">1</span>;</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			f=f+<span class="number">2</span>*x+<span class="number">1</span>;</span><br><span class="line">			x=x+<span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(y==centerY)&#123;</span><br><span class="line">		gl<span class="constructor">_Point(<span class="params">x</span>,<span class="params">y</span>)</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p><strong>（2）分类讨论思想</strong></p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//正负法画圆3</span></span><br><span class="line"><span class="built_in">void</span> pnarcArc(<span class="built_in">int</span> radius,<span class="built_in">int</span> centerX,<span class="built_in">int</span> centerY,<span class="built_in">int</span> area)&#123;</span><br><span class="line">	<span class="built_in">int</span> x,y,f;</span><br><span class="line">	<span class="built_in">int</span> tag[<span class="number">4</span>]=&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">-1</span>,<span class="number">-1</span>&#125;;</span><br><span class="line">	<span class="built_in">int</span> tagX[<span class="number">4</span>]=&#123;<span class="number">1</span>,<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">1</span>&#125;;</span><br><span class="line">	<span class="built_in">int</span> tagY[<span class="number">4</span>]=&#123;<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">1</span>,<span class="number">1</span>&#125;;</span><br><span class="line">	x=<span class="number">0</span>;y=tag[area<span class="number">-1</span>]*radius;f=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(tag[area<span class="number">-1</span>]*y&gt;<span class="number">0</span>)&#123;</span><br><span class="line">		gl_Point(x+centerX,y+centerY);</span><br><span class="line">		<span class="keyword">if</span>(f&gt;<span class="number">0</span>)&#123;</span><br><span class="line">			f=f+tagY[area<span class="number">-1</span>]*<span class="number">2</span>*y+<span class="number">1</span>;</span><br><span class="line">			y=y+tagY[area<span class="number">-1</span>];</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			f=f+tagX[area<span class="number">-1</span>]*<span class="number">2</span>*x+<span class="number">1</span>;</span><br><span class="line">			x=x+tagX[area<span class="number">-1</span>];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(y==centerY)&#123;</span><br><span class="line">		gl_Point(x,y);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在上面的代码中，我们传入了 centerX 和 centerY 以及 area 参数。其中 centerX 和 centerY 是圆弧中心点的坐标，area 是所在的<strong>象限</strong>，传入的参数需要是 1,2,3,4 中的一个数字，如果传入其他数字则不会绘制出任何图形。 注：此方法只能一次性绘制一个四分之一圆弧，局限性比较大，如果要融入弧度，改动量比较大。</p>
                  <h3 id="2-Bresenham-算法"><a href="#2-Bresenham-算法" class="headerlink" title="2.Bresenham 算法"></a>2.Bresenham 算法</h3>
                  <p>和上面方法类似，我们的实现同样非常简单，即使教材中只讨论了八分之一圆，我们可以利用对称的思想来实现画圆。另外我们添加了圆弧中心点坐标已经所在的区块。 从（π/4,π/2）这个区块开始，编号为 1，角度为 45°，顺时针旋转（0,π/4）的编号为 2，以此类推，参数变量为 area 代码实现如下</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//Bresenham画圆算法</span></span><br><span class="line">void bresenham<span class="constructor">Arc(<span class="params">int</span> R,<span class="params">int</span> <span class="params">centerX</span>,<span class="params">int</span> <span class="params">centerY</span>,<span class="params">int</span> <span class="params">area</span>)</span>&#123;</span><br><span class="line">	<span class="built_in">int</span> x,y,d;</span><br><span class="line">	x=<span class="number">0</span>;y=R;d=<span class="number">3</span>-<span class="number">2</span>*R;</span><br><span class="line">	<span class="keyword">while</span>(x&lt;y)&#123;</span><br><span class="line">		switch(area)&#123;</span><br><span class="line">		case <span class="number">1</span>:</span><br><span class="line">			gl<span class="constructor">_Point(<span class="params">x</span>+<span class="params">centerX</span>,<span class="params">y</span>+<span class="params">centerY</span>)</span>;</span><br><span class="line">			break;</span><br><span class="line">		case <span class="number">2</span>:</span><br><span class="line">			gl<span class="constructor">_Point(<span class="params">y</span>+<span class="params">centerX</span>,<span class="params">x</span>+<span class="params">centerY</span>)</span>;</span><br><span class="line">			break;</span><br><span class="line">		case <span class="number">3</span>:</span><br><span class="line">			gl<span class="constructor">_Point(<span class="params">y</span>+<span class="params">centerX</span>,-<span class="params">x</span>+<span class="params">centerY</span>)</span>;</span><br><span class="line">			break;</span><br><span class="line">		case <span class="number">4</span>:</span><br><span class="line">			gl<span class="constructor">_Point(<span class="params">x</span>+<span class="params">centerX</span>,-<span class="params">y</span>+<span class="params">centerY</span>)</span>;</span><br><span class="line">			break;</span><br><span class="line">		case <span class="number">5</span>:</span><br><span class="line">			gl<span class="constructor">_Point(-<span class="params">x</span>+<span class="params">centerX</span>,-<span class="params">y</span>+<span class="params">centerY</span>)</span>;</span><br><span class="line">			break;</span><br><span class="line">		case <span class="number">6</span>:</span><br><span class="line">			gl<span class="constructor">_Point(-<span class="params">y</span>+<span class="params">centerX</span>,-<span class="params">x</span>+<span class="params">centerY</span>)</span>;</span><br><span class="line">			break;</span><br><span class="line">		case <span class="number">7</span>:</span><br><span class="line">			gl<span class="constructor">_Point(-<span class="params">y</span>+<span class="params">centerX</span>,<span class="params">x</span>+<span class="params">centerY</span>)</span>;</span><br><span class="line">			break;</span><br><span class="line">		case <span class="number">8</span>:</span><br><span class="line">			gl<span class="constructor">_Point(-<span class="params">x</span>+<span class="params">centerX</span>,<span class="params">y</span>+<span class="params">centerY</span>)</span>;</span><br><span class="line">			break;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(d&lt;<span class="number">0</span>)&#123;</span><br><span class="line">			d=d+<span class="number">4</span>*x+<span class="number">6</span>;</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			d=d+<span class="number">4</span>*(x-y)+<span class="number">10</span>;</span><br><span class="line">			y=y-<span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		x=x+<span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(x==y)&#123;</span><br><span class="line">		gl<span class="constructor">_Point(<span class="params">x</span>,<span class="params">y</span>)</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>此段代码亲测可用，仅供参考。</p>
                  <h2 id="终极目标"><a href="#终极目标" class="headerlink" title="终极目标"></a>终极目标</h2>
                  <p>上一节我们实现了用类库的方法和 sin，cos 方法来定位坐标绘制机器人，在这一节我们就利用上述的直线和圆弧生成算法，对上一篇中的机器人进行绘制。 在这里只贴出最核心的部分，那就是绘画的函数了，只是简单地传入坐标点然后调用刚才实现的一些方法，比较繁琐，但是比较简单，核心代码如下</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//myDisplay函数用来画图</span></span><br><span class="line"><span class="built_in">void</span> myDisplay(<span class="built_in">void</span>)&#123;</span><br><span class="line">	<span class="comment">//清除。GL_COLOR_BUFFER_BIT表示清除颜色，glClear函数还可以清除其它的东西</span></span><br><span class="line">	glClear(GL_COLOR_BUFFER_BIT);</span><br><span class="line">	<span class="comment">//设置黑色颜色</span></span><br><span class="line">	glColor3f (<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>);</span><br><span class="line">	<span class="comment">//中心的圆圈，四个象限，半径为10</span></span><br><span class="line">	pnarcArc(<span class="number">10</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line">	pnarcArc(<span class="number">10</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>);</span><br><span class="line">	pnarcArc(<span class="number">10</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">3</span>);</span><br><span class="line">	pnarcArc(<span class="number">10</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">4</span>);</span><br><span class="line">	<span class="comment">//肚子中三角形，利用了DDA绘制</span></span><br><span class="line">	dda(<span class="number">-30</span>,<span class="number">-15</span>,<span class="number">30</span>,<span class="number">-15</span>);</span><br><span class="line">	dda(<span class="number">-30</span>,<span class="number">-15</span>,<span class="number">0</span>,<span class="number">28</span>);</span><br><span class="line">	dda(<span class="number">0</span>,<span class="number">28</span>,<span class="number">30</span>,<span class="number">-15</span>);</span><br><span class="line">	<span class="comment">//肚子，四条直线</span></span><br><span class="line">	midPointLine(<span class="number">-60</span>,<span class="number">60</span>,<span class="number">60</span>,<span class="number">60</span>);</span><br><span class="line">	midPointLine(<span class="number">-60</span>,<span class="number">-60</span>,<span class="number">60</span>,<span class="number">-60</span>);</span><br><span class="line">	midPointLine(<span class="number">-74</span>,<span class="number">46</span>,<span class="number">-74</span>,<span class="number">-46</span>);</span><br><span class="line">	midPointLine(<span class="number">74</span>,<span class="number">46</span>,<span class="number">74</span>,<span class="number">-46</span>);</span><br><span class="line">	<span class="comment">//肚子，四个半圆</span></span><br><span class="line">	pnarcArc(<span class="number">14</span>,<span class="number">60</span>,<span class="number">46</span>,<span class="number">1</span>);</span><br><span class="line">	pnarcArc(<span class="number">14</span>,<span class="number">-60</span>,<span class="number">46</span>,<span class="number">2</span>);</span><br><span class="line">	pnarcArc(<span class="number">14</span>,<span class="number">-60</span>,<span class="number">-46</span>,<span class="number">3</span>);</span><br><span class="line">	pnarcArc(<span class="number">14</span>,<span class="number">60</span>,<span class="number">-46</span>,<span class="number">4</span>);</span><br><span class="line">	<span class="comment">//脖子,两条直线</span></span><br><span class="line">	bresen(<span class="number">-25</span>,<span class="number">76</span>,<span class="number">-25</span>,<span class="number">60</span>);</span><br><span class="line">	bresen(<span class="number">26</span>,<span class="number">76</span>,<span class="number">25</span>,<span class="number">60</span>);</span><br><span class="line">	<span class="comment">//脸，四条直线</span></span><br><span class="line">	midPointLine(<span class="number">-54</span>,<span class="number">150</span>,<span class="number">54</span>,<span class="number">150</span>);</span><br><span class="line">	midPointLine(<span class="number">-54</span>,<span class="number">76</span>,<span class="number">54</span>,<span class="number">76</span>);</span><br><span class="line">	midPointLine(<span class="number">-64</span>,<span class="number">140</span>,<span class="number">-64</span>,<span class="number">86</span>);</span><br><span class="line">	midPointLine(<span class="number">64</span>,<span class="number">140</span>,<span class="number">64</span>,<span class="number">86</span>);</span><br><span class="line">	<span class="comment">//脸，四个圆弧</span></span><br><span class="line">	pnarcArc(<span class="number">10</span>,<span class="number">54</span>,<span class="number">140</span>,<span class="number">1</span>);</span><br><span class="line">	pnarcArc(<span class="number">10</span>,<span class="number">-54</span>,<span class="number">140</span>,<span class="number">2</span>);</span><br><span class="line">	pnarcArc(<span class="number">10</span>,<span class="number">-54</span>,<span class="number">86</span>,<span class="number">3</span>);</span><br><span class="line">	pnarcArc(<span class="number">10</span>,<span class="number">54</span>,<span class="number">86</span>,<span class="number">4</span>);</span><br><span class="line">	<span class="comment">//眼睛，两个正圆</span></span><br><span class="line">	pnarcArc(<span class="number">10</span>,<span class="number">-30</span>,<span class="number">111</span>,<span class="number">1</span>);</span><br><span class="line">	pnarcArc(<span class="number">10</span>,<span class="number">-30</span>,<span class="number">111</span>,<span class="number">2</span>);</span><br><span class="line">	pnarcArc(<span class="number">10</span>,<span class="number">-30</span>,<span class="number">111</span>,<span class="number">3</span>);</span><br><span class="line">	pnarcArc(<span class="number">10</span>,<span class="number">-30</span>,<span class="number">111</span>,<span class="number">4</span>);</span><br><span class="line">	pnarcArc(<span class="number">10</span>,<span class="number">30</span>,<span class="number">111</span>,<span class="number">1</span>);</span><br><span class="line">	pnarcArc(<span class="number">10</span>,<span class="number">30</span>,<span class="number">111</span>,<span class="number">2</span>);</span><br><span class="line">	pnarcArc(<span class="number">10</span>,<span class="number">30</span>,<span class="number">111</span>,<span class="number">3</span>);</span><br><span class="line">	pnarcArc(<span class="number">10</span>,<span class="number">30</span>,<span class="number">111</span>,<span class="number">4</span>);</span><br><span class="line">	<span class="comment">//嘴巴，两个八分之一圆</span></span><br><span class="line">	bresenhamArc(<span class="number">20</span>,<span class="number">0</span>,<span class="number">111</span>,<span class="number">4</span>);</span><br><span class="line">	bresenhamArc(<span class="number">20</span>,<span class="number">0</span>,<span class="number">111</span>,<span class="number">5</span>);</span><br><span class="line">	<span class="comment">//天线</span></span><br><span class="line">	dda(<span class="number">-35</span>,<span class="number">150</span>,<span class="number">-35</span>,<span class="number">173</span>);</span><br><span class="line">	dda(<span class="number">35</span>,<span class="number">150</span>,<span class="number">35</span>,<span class="number">173</span>);</span><br><span class="line">	<span class="comment">//右耳朵，四条直线</span></span><br><span class="line">	bresen(<span class="number">88</span>,<span class="number">98</span>,<span class="number">88</span>,<span class="number">131</span>);</span><br><span class="line">	bresen(<span class="number">67</span>,<span class="number">98</span>,<span class="number">67</span>,<span class="number">131</span>);</span><br><span class="line">	bresen(<span class="number">70</span>,<span class="number">95</span>,<span class="number">85</span>,<span class="number">95</span>);</span><br><span class="line">	bresen(<span class="number">70</span>,<span class="number">134</span>,<span class="number">85</span>,<span class="number">134</span>);</span><br><span class="line">	<span class="comment">//右耳朵，四个圆弧</span></span><br><span class="line">	pnarcArc(<span class="number">3</span>,<span class="number">85</span>,<span class="number">131</span>,<span class="number">1</span>);</span><br><span class="line">	pnarcArc(<span class="number">3</span>,<span class="number">70</span>,<span class="number">131</span>,<span class="number">2</span>);</span><br><span class="line">	pnarcArc(<span class="number">3</span>,<span class="number">70</span>,<span class="number">98</span>,<span class="number">3</span>);</span><br><span class="line">	pnarcArc(<span class="number">3</span>,<span class="number">85</span>,<span class="number">98</span>,<span class="number">4</span>);</span><br><span class="line">	<span class="comment">//左耳朵，四条直线</span></span><br><span class="line">	bresen(<span class="number">-88</span>,<span class="number">98</span>,<span class="number">-88</span>,<span class="number">131</span>);</span><br><span class="line">	bresen(<span class="number">-67</span>,<span class="number">98</span>,<span class="number">-67</span>,<span class="number">131</span>);</span><br><span class="line">	bresen(<span class="number">-70</span>,<span class="number">95</span>,<span class="number">-85</span>,<span class="number">95</span>);</span><br><span class="line">	bresen(<span class="number">-70</span>,<span class="number">134</span>,<span class="number">-85</span>,<span class="number">134</span>);</span><br><span class="line">	<span class="comment">//左耳朵，四个圆弧</span></span><br><span class="line">	pnarcArc(<span class="number">3</span>,<span class="number">-70</span>,<span class="number">131</span>,<span class="number">1</span>);</span><br><span class="line">	pnarcArc(<span class="number">3</span>,<span class="number">-85</span>,<span class="number">131</span>,<span class="number">2</span>);</span><br><span class="line">	pnarcArc(<span class="number">3</span>,<span class="number">-85</span>,<span class="number">98</span>,<span class="number">3</span>);</span><br><span class="line">	pnarcArc(<span class="number">3</span>,<span class="number">-70</span>,<span class="number">98</span>,<span class="number">4</span>);</span><br><span class="line">	<span class="comment">//左胳膊衔接处</span></span><br><span class="line">	bresen(<span class="number">-73</span>,<span class="number">25</span>,<span class="number">-80</span>,<span class="number">25</span>);</span><br><span class="line">	bresen(<span class="number">-73</span>,<span class="number">43</span>,<span class="number">-80</span>,<span class="number">43</span>);</span><br><span class="line">	<span class="comment">//右胳膊衔接处</span></span><br><span class="line">	bresen(<span class="number">73</span>,<span class="number">25</span>,<span class="number">80</span>,<span class="number">25</span>);</span><br><span class="line">	bresen(<span class="number">73</span>,<span class="number">43</span>,<span class="number">80</span>,<span class="number">43</span>);</span><br><span class="line">	<span class="comment">//左大臂</span></span><br><span class="line">	dda(<span class="number">-108</span>,<span class="number">45</span>,<span class="number">-108</span>,<span class="number">0</span>);</span><br><span class="line">	dda(<span class="number">-81</span>,<span class="number">45</span>,<span class="number">-81</span>,<span class="number">0</span>);</span><br><span class="line">	dda(<span class="number">-108</span>,<span class="number">45</span>,<span class="number">-81</span>,<span class="number">45</span>);</span><br><span class="line">	dda(<span class="number">-108</span>,<span class="number">0</span>,<span class="number">-81</span>,<span class="number">0</span>);</span><br><span class="line">	<span class="comment">//右大臂</span></span><br><span class="line">	dda(<span class="number">108</span>,<span class="number">45</span>,<span class="number">108</span>,<span class="number">0</span>);</span><br><span class="line">	dda(<span class="number">81</span>,<span class="number">45</span>,<span class="number">81</span>,<span class="number">0</span>);</span><br><span class="line">	dda(<span class="number">108</span>,<span class="number">45</span>,<span class="number">81</span>,<span class="number">45</span>);</span><br><span class="line">	dda(<span class="number">108</span>,<span class="number">0</span>,<span class="number">81</span>,<span class="number">0</span>);</span><br><span class="line">	<span class="comment">//左中臂</span></span><br><span class="line">	bresen(<span class="number">-101</span>,<span class="number">0</span>,<span class="number">-101</span>,<span class="number">-4</span>);</span><br><span class="line">	bresen(<span class="number">-88</span>,<span class="number">0</span>,<span class="number">-88</span>,<span class="number">-4</span>);</span><br><span class="line">	<span class="comment">//右中臂</span></span><br><span class="line">	bresen(<span class="number">101</span>,<span class="number">0</span>,<span class="number">101</span>,<span class="number">-4</span>);</span><br><span class="line">	bresen(<span class="number">88</span>,<span class="number">0</span>,<span class="number">88</span>,<span class="number">-4</span>);</span><br><span class="line">	<span class="comment">//左小臂</span></span><br><span class="line">	dda(<span class="number">-108</span>,<span class="number">-4</span>,<span class="number">-108</span>,<span class="number">-37</span>);</span><br><span class="line">	dda(<span class="number">-81</span>,<span class="number">-4</span>,<span class="number">-81</span>,<span class="number">-37</span>);</span><br><span class="line">	dda(<span class="number">-108</span>,<span class="number">-4</span>,<span class="number">-81</span>,<span class="number">-4</span>);</span><br><span class="line">	dda(<span class="number">-108</span>,<span class="number">-37</span>,<span class="number">-81</span>,<span class="number">-37</span>);</span><br><span class="line">	<span class="comment">//右小臂</span></span><br><span class="line">	dda(<span class="number">108</span>,<span class="number">-4</span>,<span class="number">108</span>,<span class="number">-37</span>);</span><br><span class="line">	dda(<span class="number">81</span>,<span class="number">-4</span>,<span class="number">81</span>,<span class="number">-37</span>);</span><br><span class="line">	dda(<span class="number">108</span>,<span class="number">-4</span>,<span class="number">81</span>,<span class="number">-4</span>);</span><br><span class="line">	dda(<span class="number">108</span>,<span class="number">-37</span>,<span class="number">81</span>,<span class="number">-37</span>);</span><br><span class="line">	<span class="comment">//左手</span></span><br><span class="line">	pnarcArc(<span class="number">10</span>,<span class="number">-95</span>,<span class="number">-47</span>,<span class="number">1</span>);</span><br><span class="line">	pnarcArc(<span class="number">10</span>,<span class="number">-95</span>,<span class="number">-47</span>,<span class="number">2</span>);</span><br><span class="line">	pnarcArc(<span class="number">10</span>,<span class="number">-95</span>,<span class="number">-47</span>,<span class="number">3</span>);</span><br><span class="line">	pnarcArc(<span class="number">10</span>,<span class="number">-95</span>,<span class="number">-47</span>,<span class="number">4</span>);</span><br><span class="line">	<span class="comment">//右手</span></span><br><span class="line">	pnarcArc(<span class="number">10</span>,<span class="number">95</span>,<span class="number">-47</span>,<span class="number">1</span>);</span><br><span class="line">	pnarcArc(<span class="number">10</span>,<span class="number">95</span>,<span class="number">-47</span>,<span class="number">2</span>);</span><br><span class="line">	pnarcArc(<span class="number">10</span>,<span class="number">95</span>,<span class="number">-47</span>,<span class="number">3</span>);</span><br><span class="line">	pnarcArc(<span class="number">10</span>,<span class="number">95</span>,<span class="number">-47</span>,<span class="number">4</span>);</span><br><span class="line">	<span class="comment">//左腿衔接处</span></span><br><span class="line">	dda(<span class="number">-43</span>,<span class="number">-62</span>,<span class="number">-43</span>,<span class="number">-69</span>);</span><br><span class="line">	dda(<span class="number">-25</span>,<span class="number">-62</span>,<span class="number">-25</span>,<span class="number">-69</span>);</span><br><span class="line">	<span class="comment">//右腿衔接处</span></span><br><span class="line">	dda(<span class="number">43</span>,<span class="number">-62</span>,<span class="number">43</span>,<span class="number">-69</span>);</span><br><span class="line">	dda(<span class="number">25</span>,<span class="number">-62</span>,<span class="number">25</span>,<span class="number">-69</span>);</span><br><span class="line">	<span class="comment">//左大腿，四条直线</span></span><br><span class="line">	bresen(<span class="number">-47</span>,<span class="number">-69</span>,<span class="number">-21</span>,<span class="number">-69</span>);</span><br><span class="line">	bresen(<span class="number">-47</span>,<span class="number">-117</span>,<span class="number">-21</span>,<span class="number">-117</span>);</span><br><span class="line">	bresen(<span class="number">-51</span>,<span class="number">-70</span>,<span class="number">-51</span>,<span class="number">-113</span>);</span><br><span class="line">	bresen(<span class="number">-17</span>,<span class="number">-70</span>,<span class="number">-17</span>,<span class="number">-113</span>);</span><br><span class="line">	<span class="comment">//左大腿，四条圆弧</span></span><br><span class="line">	pnarcArc(<span class="number">4</span>,<span class="number">-21</span>,<span class="number">-73</span>,<span class="number">1</span>);</span><br><span class="line">	pnarcArc(<span class="number">4</span>,<span class="number">-47</span>,<span class="number">-73</span>,<span class="number">2</span>);</span><br><span class="line">	pnarcArc(<span class="number">4</span>,<span class="number">-47</span>,<span class="number">-113</span>,<span class="number">3</span>);</span><br><span class="line">	pnarcArc(<span class="number">4</span>,<span class="number">-21</span>,<span class="number">-113</span>,<span class="number">4</span>);</span><br><span class="line">	<span class="comment">//右大腿，四条直线</span></span><br><span class="line">	bresen(<span class="number">47</span>,<span class="number">-69</span>,<span class="number">21</span>,<span class="number">-69</span>);</span><br><span class="line">	bresen(<span class="number">47</span>,<span class="number">-117</span>,<span class="number">21</span>,<span class="number">-117</span>);</span><br><span class="line">	bresen(<span class="number">51</span>,<span class="number">-70</span>,<span class="number">51</span>,<span class="number">-113</span>);</span><br><span class="line">	bresen(<span class="number">17</span>,<span class="number">-70</span>,<span class="number">17</span>,<span class="number">-113</span>);</span><br><span class="line">	<span class="comment">//右大腿，四条圆弧</span></span><br><span class="line">	pnarcArc(<span class="number">4</span>,<span class="number">47</span>,<span class="number">-73</span>,<span class="number">1</span>);</span><br><span class="line">	pnarcArc(<span class="number">4</span>,<span class="number">21</span>,<span class="number">-73</span>,<span class="number">2</span>);</span><br><span class="line">	pnarcArc(<span class="number">4</span>,<span class="number">21</span>,<span class="number">-113</span>,<span class="number">3</span>);</span><br><span class="line">	pnarcArc(<span class="number">4</span>,<span class="number">47</span>,<span class="number">-113</span>,<span class="number">4</span>);</span><br><span class="line">	<span class="comment">//左脚踝</span></span><br><span class="line">	dda(<span class="number">-43</span>,<span class="number">-118</span>,<span class="number">-43</span>,<span class="number">-125</span>);</span><br><span class="line">	dda(<span class="number">-25</span>,<span class="number">-118</span>,<span class="number">-25</span>,<span class="number">-125</span>);</span><br><span class="line">	<span class="comment">//右腿衔接处</span></span><br><span class="line">	dda(<span class="number">43</span>,<span class="number">-118</span>,<span class="number">43</span>,<span class="number">-125</span>);</span><br><span class="line">	dda(<span class="number">25</span>,<span class="number">-118</span>,<span class="number">25</span>,<span class="number">-125</span>);</span><br><span class="line">	<span class="comment">//左脚</span></span><br><span class="line">	bresen(<span class="number">-59</span>,<span class="number">-125</span>,<span class="number">-8</span>,<span class="number">-125</span>);</span><br><span class="line">	bresen(<span class="number">-59</span>,<span class="number">-137</span>,<span class="number">-8</span>,<span class="number">-137</span>);</span><br><span class="line">	bresen(<span class="number">-59</span>,<span class="number">-125</span>,<span class="number">-59</span>,<span class="number">-137</span>);</span><br><span class="line">	bresen(<span class="number">-8</span>,<span class="number">-125</span>,<span class="number">-8</span>,<span class="number">-137</span>);</span><br><span class="line">	<span class="comment">//右脚</span></span><br><span class="line">	bresen(<span class="number">59</span>,<span class="number">-125</span>,<span class="number">8</span>,<span class="number">-125</span>);</span><br><span class="line">	bresen(<span class="number">59</span>,<span class="number">-137</span>,<span class="number">8</span>,<span class="number">-137</span>);</span><br><span class="line">	bresen(<span class="number">59</span>,<span class="number">-125</span>,<span class="number">59</span>,<span class="number">-137</span>);</span><br><span class="line">	bresen(<span class="number">8</span>,<span class="number">-125</span>,<span class="number">8</span>,<span class="number">-137</span>);</span><br><span class="line">	<span class="comment">//刷新机器人</span></span><br><span class="line">	glFlush();</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其他的部分不再赘述，都十分基础。</p>
                  <h2 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h2>
                  <p>直接贴图如下 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/QQ截图20150413005949.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/QQ截图20150413005949.jpg" alt="QQ截图20150413005949"></a> 嘿嘿，我们直接用生成算法绘制的图形是不是更好看一些呢？</p>
                  <h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2>
                  <p>本节介绍了各种直线生成算法和圆弧生成算法，以及利用该算法重新绘制机器人，希望对大家有帮助！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-04-13 01:03:08" itemprop="dateCreated datePublished" datetime="2015-04-13T01:03:08+08:00">2015-04-13</time>
                </span>
                <span id="/1613.html" class="post-meta-item leancloud_visitors" data-flag-title="OpenGL绘图实例二之直线和圆弧的绘制" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>1.1k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>1 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1597.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> C/C++ <i class="label-arrow"></i>
                  </a>
                  <a href="/1597.html" class="post-title-link" itemprop="url">OpenGL绘图实例一之机器人的绘制</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>计算机图形学教材中有多种绘图方法，如直线的 DDA 算法、正负法、Bresenham 算法和画圆弧的正负法和 Bresenham 算法。 同样，OpenGL 类库也为我们提供了多种绘图方法，比如 glVertex2d，在这里我们用类库的方法来实现一个机器人的绘制。DDA 等算法实现之后我们再替换类库的 glVertex2d 方法。</p>
                  <h2 id="绘制要求"><a href="#绘制要求" class="headerlink" title="绘制要求"></a>绘制要求</h2>
                  <p>利用 glVertex2d 和 glVertex2f 在二维平面上绘制如下的机器人。所以我们现在不需要三维的绘图方法，仅在平面绘制即可。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150410115231.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150410115231.jpg" alt="20150410115231"></a></p>
                  <h2 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h2>
                  <p>经过观察我们发现，图中包含了圆角矩形，矩形，直线，圆形，弧形，三角形，而对于 glVertex2d 的方法，只是定位好坐标点，然后利用坐标点连线或者形成封闭图形来绘制。所以，对于圆角矩形，弧形等，我们可以利用三角函数来求取坐标，并连线即可。</p>
                  <h3 id="1-圆角矩形的解决方案"><a href="#1-圆角矩形的解决方案" class="headerlink" title="1.圆角矩形的解决方案"></a>1.圆角矩形的解决方案</h3>
                  <p>对于圆角矩形，顾名思义每个角是由一个四分之一圆弧组成的。我们定义这个圆弧的半径为 cirR，整个圆角矩形的宽度为 width，高度为 height，那么抛出四个角的圆弧，就会在圆角矩形内部形成一个小的矩形，我们定义它的宽高分别为 w，h。另外，圆角矩形的中心点为(centerX,centerY)，如下图所示 （博主原创图，盗图必究） <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/11-e1428648703474.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/11-e1428648703474.png" alt=""></a> 在 OpenGL 中，可以定义一个绘图模式</p>
                  <figure class="highlight lisp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">glBegin(<span class="name">GL_LINE_LOOP</span>)<span class="comment">;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以绘制封闭曲线，也就是说，我们所有调用的 glVertex2f 函数绘制的点均可以自动连接成一个封闭曲线。 所以，我们要做的就是找出圆角的坐标，利用 C++ 中的三角函数来计算右上角小圆所在的路径，我们设角度为 X，所以圆弧的 x 方向延伸长度为 cirRcosX，在 y 方向延伸长度为 cirRsinX 对于右上角的四分之一圆弧，它所在的路径 x 坐标便是 centerX+w/2+cirRcosX = centerX+width/2-cirR+cirRcosX，同理，y 路径坐标便是 centerY+h/2+cirRsinX = centerY+height/2-cirR+cirRsinX 当然对于其他的角，是加 w/2 还是减 w/2 就要看它所在的象限了。 另外对于精确度的问题，我们可以定义一个 divide 变量，将四分之一圆弧分成若干个点来绘制，当然分的份数越多，越精细，分的份数的值就是 divide，所以每次增加的弧度便是 PI/(2*divide) 方法最终实现如下，我们传入矩形的宽高，矩形中心的坐标，圆角半径即可进行绘制。</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//画圆角矩形，传入矩形中心点坐标，矩形宽高，角半径</span></span><br><span class="line"><span class="built_in">void</span> glRoundRec(<span class="built_in">int</span> centerX,<span class="built_in">int</span> centerY,<span class="built_in">int</span> width,<span class="built_in">int</span> height,<span class="built_in">float</span> cirR)&#123;</span><br><span class="line">	<span class="comment">//二分之PI，一个象限的角度</span></span><br><span class="line">	<span class="built_in">float</span> PI_HALF = PI/<span class="number">2</span>;</span><br><span class="line">	<span class="comment">//划分程度,值越大画得越精细</span></span><br><span class="line">	<span class="built_in">float</span> divide=<span class="number">20.0</span>;</span><br><span class="line">	<span class="comment">//圆角矩形的坐标</span></span><br><span class="line">    <span class="built_in">float</span> tx,ty;</span><br><span class="line">	<span class="comment">//画封闭曲线</span></span><br><span class="line">    glBegin(GL_LINE_LOOP);</span><br><span class="line">	<span class="comment">//四个象限不同的操作符</span></span><br><span class="line">    <span class="built_in">int</span> opX[<span class="number">4</span>]=&#123;<span class="number">1</span>,<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">1</span>&#125;;</span><br><span class="line">    <span class="built_in">int</span> opY[<span class="number">4</span>]=&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">-1</span>,<span class="number">-1</span>&#125;;</span><br><span class="line">	<span class="comment">//用来计数，从第一象限到第四象限</span></span><br><span class="line">    <span class="built_in">float</span> x=<span class="number">0</span>;</span><br><span class="line">	<span class="comment">//x自增时加的值</span></span><br><span class="line">	<span class="built_in">float</span> part=<span class="number">1</span>/divide;</span><br><span class="line">	<span class="comment">//计算内矩形宽高一半的数值</span></span><br><span class="line">	<span class="built_in">int</span> w=width/<span class="number">2</span>-cirR;</span><br><span class="line">	<span class="built_in">int</span> h=height/<span class="number">2</span>-cirR;</span><br><span class="line">	<span class="comment">//循环画线</span></span><br><span class="line">    <span class="keyword">for</span>(x=<span class="number">0</span>;x&lt;<span class="number">4</span>;x+=part)&#123;</span><br><span class="line">		<span class="comment">//求出弧度</span></span><br><span class="line">		<span class="built_in">float</span> rad = PI_HALF*x;</span><br><span class="line">		<span class="comment">//计算坐标值</span></span><br><span class="line">	    tx=cirR*cos(rad)+opX[(<span class="built_in">int</span>)x]*w+centerX;</span><br><span class="line">	    ty=cirR*sin(rad)+opY[(<span class="built_in">int</span>)x]*h+centerY;</span><br><span class="line">		<span class="comment">//传入坐标画线</span></span><br><span class="line">	    glVertex2f(tx,ty);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//结束画线</span></span><br><span class="line">   glEnd();</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>例如我们可以调用</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">glRoundRec(<span class="number">0</span>,<span class="number">0</span>,<span class="number">146</span>,<span class="number">120</span>,<span class="number">15</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>可以绘制如下的圆角矩形 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/0150410150933-e1428649832943.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/0150410150933-e1428649832943.jpg" alt=""></a></p>
                  <h3 id="2-圆弧的解决方案"><a href="#2-圆弧的解决方案" class="headerlink" title="2.圆弧的解决方案"></a>2.圆弧的解决方案</h3>
                  <p>对于圆弧的画法，我们也可以利用三角函数来解决，所以我们需要知道的参数就有半径，起始角度，还有圆弧的中心点。 代码实现如下</p>
                  <figure class="highlight cpp">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//画弧线，相对偏移量XY，开始的弧度，结束的弧度，半径</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">glArc</span><span class="params">(<span class="keyword">double</span> x,<span class="keyword">double</span> y,<span class="keyword">double</span> start_angle,<span class="keyword">double</span> end_angle,<span class="keyword">double</span> radius)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//开始绘制曲线</span></span><br><span class="line">	glBegin(GL_LINE_STRIP);</span><br><span class="line">	<span class="comment">//每次画增加的弧度</span></span><br><span class="line">	<span class="keyword">double</span> delta_angle=PI/<span class="number">180</span>;</span><br><span class="line">	<span class="comment">//画圆弧</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">double</span> i=start_angle;i&lt;=end_angle;i+=delta_angle)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//绝对定位加三角函数值</span></span><br><span class="line">		<span class="keyword">double</span> vx=x+radius * <span class="built_in">cos</span>(i);</span><br><span class="line">		<span class="keyword">double</span> vy=y+radius*<span class="built_in">sin</span>(i);</span><br><span class="line">		glVertex2d(vx,vy);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//结束绘画</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>至于画圆，我们只需要画一个弧度为 0 至 2PI 的圆弧即可。</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="comment">//画圆</span></span><br><span class="line">void gl<span class="constructor">Circle(<span class="params">double</span> <span class="params">x</span>, <span class="params">double</span> <span class="params">y</span>, <span class="params">double</span> <span class="params">radius</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//画全圆</span></span><br><span class="line">    gl<span class="constructor">Arc(<span class="params">x</span>,<span class="params">y</span>,0,2<span class="operator">*</span>PI,<span class="params">radius</span>)</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <h3 id="3-其他图形的解决方案"><a href="#3-其他图形的解决方案" class="headerlink" title="3.其他图形的解决方案"></a>3.其他图形的解决方案</h3>
                  <p>对于直线，三角形，矩形等等，就没有那么复杂了，只需要绘制几个端点即可完成绘制。在此不再赘述。</p>
                  <h3 id="4-坐标的解决方案"><a href="#4-坐标的解决方案" class="headerlink" title="4.坐标的解决方案"></a>4.坐标的解决方案</h3>
                  <p>要画图，最重要的便是坐标点，在此博主对图上的某些坐标进行了测量，假设总宽度为 300，对应的坐标值标注如下图所示，当然比例不一样的话，坐标会有成比例的变化，在此仅作参考。 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/robot-e1428650596530.png" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/robot-e1428650596530.png" alt="robot"></a> 在图中，某些点的坐标已做好标注，仅供参考。</p>
                  <h2 id="完整程序"><a href="#完整程序" class="headerlink" title="完整程序"></a>完整程序</h2>
                  <p>完整的画机器人的程序实现如下</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">#include &lt;glut.h&gt;</span><br><span class="line">#include &lt;math.h&gt;</span><br><span class="line">#define PI <span class="number">3.1415926</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//画矩形，传入的是左下角XY坐标和右上角XY坐标</span></span><br><span class="line"><span class="built_in">void</span> glRect(<span class="built_in">int</span> leftX,<span class="built_in">int</span> leftY,<span class="built_in">int</span> rightX,<span class="built_in">int</span> rightY)&#123;</span><br><span class="line">	<span class="comment">//画封闭曲线</span></span><br><span class="line">    glBegin(GL_LINE_LOOP);</span><br><span class="line">	<span class="comment">//左下角</span></span><br><span class="line">	glVertex2d(leftX,leftY);</span><br><span class="line">	<span class="comment">//右下角</span></span><br><span class="line">	glVertex2d(rightX,leftY);</span><br><span class="line">	<span class="comment">//右上角</span></span><br><span class="line">	glVertex2d(rightX,rightY);</span><br><span class="line">	<span class="comment">//左上角</span></span><br><span class="line">	glVertex2d(leftX,rightY);</span><br><span class="line">	<span class="comment">//结束画线</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//画圆角矩形，传入矩形宽高，角半径，矩形中心点坐标</span></span><br><span class="line"><span class="built_in">void</span> glRoundRec(<span class="built_in">int</span> centerX,<span class="built_in">int</span> centerY,<span class="built_in">int</span> width,<span class="built_in">int</span> height,<span class="built_in">float</span> cirR)&#123;</span><br><span class="line">	<span class="comment">//二分之PI，一个象限的角度</span></span><br><span class="line">	<span class="built_in">float</span> PI_HALF = PI/<span class="number">2</span>;</span><br><span class="line">	<span class="comment">//划分程度,值越大画得越精细</span></span><br><span class="line">	<span class="built_in">float</span> divide=<span class="number">20.0</span>;</span><br><span class="line">	<span class="comment">//圆角矩形的坐标</span></span><br><span class="line">    <span class="built_in">float</span> tx,ty;</span><br><span class="line">	<span class="comment">//画封闭曲线</span></span><br><span class="line">    glBegin(GL_LINE_LOOP);</span><br><span class="line">	<span class="comment">//四个象限不同的操作符</span></span><br><span class="line">    <span class="built_in">int</span> opX[<span class="number">4</span>]=&#123;<span class="number">1</span>,<span class="number">-1</span>,<span class="number">-1</span>,<span class="number">1</span>&#125;;</span><br><span class="line">    <span class="built_in">int</span> opY[<span class="number">4</span>]=&#123;<span class="number">1</span>,<span class="number">1</span>,<span class="number">-1</span>,<span class="number">-1</span>&#125;;</span><br><span class="line">	<span class="comment">//用来计数，从第一象限到第四象限</span></span><br><span class="line">    <span class="built_in">float</span> x=<span class="number">0</span>;</span><br><span class="line">	<span class="comment">//x自增时加的值</span></span><br><span class="line">	<span class="built_in">float</span> part=<span class="number">1</span>/divide;</span><br><span class="line">	<span class="comment">//计算内矩形宽高一半的数值</span></span><br><span class="line">	<span class="built_in">int</span> w=width/<span class="number">2</span>-cirR;</span><br><span class="line">	<span class="built_in">int</span> h=height/<span class="number">2</span>-cirR;</span><br><span class="line">	<span class="comment">//循环画线</span></span><br><span class="line">    <span class="keyword">for</span>(x=<span class="number">0</span>;x&lt;<span class="number">4</span>;x+=part)&#123;</span><br><span class="line">		<span class="comment">//求出弧度</span></span><br><span class="line">		<span class="built_in">float</span> rad = PI_HALF*x;</span><br><span class="line">		<span class="comment">//计算坐标值</span></span><br><span class="line">	    tx=cirR*cos(rad)+opX[(<span class="built_in">int</span>)x]*w+centerX;</span><br><span class="line">	    ty=cirR*sin(rad)+opY[(<span class="built_in">int</span>)x]*h+centerY;</span><br><span class="line">		<span class="comment">//传入坐标画线</span></span><br><span class="line">	    glVertex2f(tx,ty);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//结束画线</span></span><br><span class="line">   glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//画弧线，相对偏移量XY，开始的弧度，结束的弧度，半径</span></span><br><span class="line"><span class="built_in">void</span> glArc(<span class="built_in">double</span> x,<span class="built_in">double</span> y,<span class="built_in">double</span> start_angle,<span class="built_in">double</span> end_angle,<span class="built_in">double</span> radius)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//开始绘制曲线</span></span><br><span class="line">	glBegin(GL_LINE_STRIP);</span><br><span class="line">	<span class="comment">//每次画增加的弧度</span></span><br><span class="line">	<span class="built_in">double</span> delta_angle=PI/<span class="number">180</span>;</span><br><span class="line">	<span class="comment">//画圆弧</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="built_in">double</span> i=start_angle;i&lt;=end_angle;i+=delta_angle)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//绝对定位加三角函数值</span></span><br><span class="line">		<span class="built_in">double</span> vx=x+radius * cos(i);</span><br><span class="line">		<span class="built_in">double</span> vy=y+radius*sin(i);</span><br><span class="line">		glVertex2d(vx,vy);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//结束绘画</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//画圆</span></span><br><span class="line"><span class="built_in">void</span> glCircle(<span class="built_in">double</span> x, <span class="built_in">double</span> y, <span class="built_in">double</span> radius)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//画全圆</span></span><br><span class="line">    glArc(x,y,<span class="number">0</span>,<span class="number">2</span>*PI,radius);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//画三角形，传入三个点的坐标</span></span><br><span class="line"><span class="built_in">void</span> glTri(<span class="built_in">int</span> x1,<span class="built_in">int</span> y1,<span class="built_in">int</span> x2,<span class="built_in">int</span> y2,<span class="built_in">int</span> x3,<span class="built_in">int</span> y3)&#123;</span><br><span class="line">	<span class="comment">//画封闭线</span></span><br><span class="line">    glBegin(GL_LINE_LOOP);</span><br><span class="line">	<span class="comment">//一点</span></span><br><span class="line">	glVertex2d(x1,y1);</span><br><span class="line">	<span class="comment">//二点</span></span><br><span class="line">	glVertex2d(x2,y2);</span><br><span class="line">	<span class="comment">//三点</span></span><br><span class="line">	glVertex2d(x3,y3);</span><br><span class="line">	<span class="comment">//结束画线</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//画线，传入两点坐标</span></span><br><span class="line"><span class="built_in">void</span> glLine(<span class="built_in">int</span> x1,<span class="built_in">int</span> y1,<span class="built_in">int</span> x2,<span class="built_in">int</span> y2)&#123;</span><br><span class="line">	<span class="comment">//画封闭线</span></span><br><span class="line">    glBegin(GL_LINE_STRIP);</span><br><span class="line">	<span class="comment">//一点</span></span><br><span class="line">	glVertex2d(x1,y1);</span><br><span class="line">	<span class="comment">//二点</span></span><br><span class="line">	glVertex2d(x2,y2);</span><br><span class="line">	<span class="comment">//结束画线</span></span><br><span class="line">	glEnd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//函数用来画图</span></span><br><span class="line"><span class="built_in">void</span> display(<span class="built_in">void</span>)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//GL_COLOR_BUFFER_BIT表示清除颜色</span></span><br><span class="line">	glClear(GL_COLOR_BUFFER_BIT);</span><br><span class="line">	<span class="comment">//设置画线颜色</span></span><br><span class="line">    glColor3f(<span class="number">0.5</span>,<span class="number">0.5</span>,<span class="number">0.5</span>);</span><br><span class="line">	<span class="comment">//画点大小</span></span><br><span class="line">	glPointSize(<span class="number">2</span>);</span><br><span class="line">	<span class="comment">//画圆角矩形，大肚子</span></span><br><span class="line">	glRoundRec(<span class="number">0</span>,<span class="number">0</span>,<span class="number">146</span>,<span class="number">120</span>,<span class="number">15</span>);</span><br><span class="line">	<span class="comment">//画圆，中间小圈</span></span><br><span class="line">	glCircle(<span class="number">0</span>,<span class="number">0</span>,<span class="number">10</span>);</span><br><span class="line">	<span class="comment">//画矩形，脖子</span></span><br><span class="line">	glRect(<span class="number">-25</span>,<span class="number">60</span>,<span class="number">25</span>,<span class="number">76</span>);</span><br><span class="line">	<span class="comment">//画圆角矩形，大脸</span></span><br><span class="line">	glRoundRec(<span class="number">0</span>,<span class="number">113</span>,<span class="number">128</span>,<span class="number">74</span>,<span class="number">10</span>);</span><br><span class="line">	<span class="comment">//两个眼睛</span></span><br><span class="line">	glCircle(<span class="number">-30</span>,<span class="number">111</span>,<span class="number">10</span>);</span><br><span class="line">	glCircle(<span class="number">30</span>,<span class="number">111</span>,<span class="number">10</span>);</span><br><span class="line">	<span class="comment">//两条天线</span></span><br><span class="line">	glLine(<span class="number">-35</span>,<span class="number">150</span>,<span class="number">-35</span>,<span class="number">173</span>);</span><br><span class="line">	glLine(<span class="number">35</span>,<span class="number">150</span>,<span class="number">35</span>,<span class="number">173</span>);</span><br><span class="line">	<span class="comment">//圆角矩形，两个耳朵</span></span><br><span class="line">	glRoundRec(<span class="number">81</span>,<span class="number">115</span>,<span class="number">20</span>,<span class="number">34</span>,<span class="number">5</span>);</span><br><span class="line">	glRoundRec(<span class="number">-81</span>,<span class="number">115</span>,<span class="number">20</span>,<span class="number">34</span>,<span class="number">5</span>);</span><br><span class="line">	<span class="comment">//圆弧，画嘴</span></span><br><span class="line">	glArc(<span class="number">0</span>,<span class="number">133</span>,<span class="number">11</span>*PI/<span class="number">8</span>,<span class="number">13</span>*PI/<span class="number">8</span>,<span class="number">45</span>);</span><br><span class="line">	<span class="comment">//画三角，肚子里的三角</span></span><br><span class="line">	glTri(<span class="number">-30</span>,<span class="number">-15</span>,<span class="number">30</span>,<span class="number">-15</span>,<span class="number">0</span>,<span class="number">28</span>);</span><br><span class="line">	<span class="comment">//画矩形，胳膊连接处</span></span><br><span class="line">	glRect(<span class="number">-81</span>,<span class="number">43</span>,<span class="number">-73</span>,<span class="number">25</span>);</span><br><span class="line">	glRect(<span class="number">81</span>,<span class="number">43</span>,<span class="number">73</span>,<span class="number">25</span>);</span><br><span class="line">	<span class="comment">//画矩形，上臂</span></span><br><span class="line">	glRect(<span class="number">-108</span>,<span class="number">45</span>,<span class="number">-81</span>,<span class="number">0</span>);</span><br><span class="line">	glRect(<span class="number">108</span>,<span class="number">45</span>,<span class="number">81</span>,<span class="number">0</span>);</span><br><span class="line">	<span class="comment">//画矩形，中臂</span></span><br><span class="line">	glRect(<span class="number">-101</span>,<span class="number">0</span>,<span class="number">-88</span>,<span class="number">-4</span>);</span><br><span class="line">	glRect(<span class="number">101</span>,<span class="number">0</span>,<span class="number">88</span>,<span class="number">-4</span>);</span><br><span class="line">	<span class="comment">//画矩形，下臂</span></span><br><span class="line">	glRect(<span class="number">-108</span>,<span class="number">-4</span>,<span class="number">-81</span>,<span class="number">-37</span>);</span><br><span class="line">	glRect(<span class="number">108</span>,<span class="number">-4</span>,<span class="number">81</span>,<span class="number">-37</span>);</span><br><span class="line">	<span class="comment">//画圆形，手掌</span></span><br><span class="line">	glCircle(<span class="number">-95</span>,<span class="number">-47</span>,<span class="number">10</span>);</span><br><span class="line">	glCircle(<span class="number">95</span>,<span class="number">-47</span>,<span class="number">10</span>);</span><br><span class="line">	<span class="comment">//画腿连接处</span></span><br><span class="line">	glRect(<span class="number">-41</span>,<span class="number">-62</span>,<span class="number">-21</span>,<span class="number">-66</span>);</span><br><span class="line">	glRect(<span class="number">41</span>,<span class="number">-62</span>,<span class="number">21</span>,<span class="number">-66</span>);</span><br><span class="line">	<span class="comment">//画圆角矩形，大长腿</span></span><br><span class="line">	glRoundRec(<span class="number">-32</span>,<span class="number">-92</span>,<span class="number">38</span>,<span class="number">52</span>,<span class="number">10</span>);</span><br><span class="line">	glRoundRec(<span class="number">32</span>,<span class="number">-92</span>,<span class="number">38</span>,<span class="number">52</span>,<span class="number">10</span>);</span><br><span class="line">	<span class="comment">//画矩形，脚踝</span></span><br><span class="line">	glRect(<span class="number">-41</span>,<span class="number">-125</span>,<span class="number">-21</span>,<span class="number">-117</span>);</span><br><span class="line">	glRect(<span class="number">41</span>,<span class="number">-125</span>,<span class="number">21</span>,<span class="number">-117</span>);</span><br><span class="line">	<span class="comment">//画矩形，大脚掌</span></span><br><span class="line">	glRect(<span class="number">-59</span>,<span class="number">-125</span>,<span class="number">-8</span>,<span class="number">-137</span>);</span><br><span class="line">	glRect(<span class="number">59</span>,<span class="number">-125</span>,<span class="number">8</span>,<span class="number">-137</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//保证前面的OpenGL命令立即执行，而不是让它们在缓冲区中等待</span></span><br><span class="line">	glFlush();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//窗口大小变化时调用的函数</span></span><br><span class="line"><span class="built_in">void</span> ChangeSize(GLsizei w,GLsizei h)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//避免高度为0</span></span><br><span class="line">    <span class="keyword">if</span>(h==<span class="number">0</span>) &#123;</span><br><span class="line">        h=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//定义视口大小，宽高一致</span></span><br><span class="line">    glViewport(<span class="number">0</span>,<span class="number">0</span>,w,h);</span><br><span class="line">	<span class="built_in">int</span> half = <span class="number">200</span>;</span><br><span class="line">	<span class="comment">//重置坐标系统，使投影变换复位</span></span><br><span class="line">    glMatrixMode(GL_PROJECTION);</span><br><span class="line">	<span class="comment">//将当前的用户坐标系的原点移到了屏幕中心</span></span><br><span class="line">    glLoadIdentity();</span><br><span class="line">   <span class="comment">//定义正交视域体</span></span><br><span class="line">    <span class="keyword">if</span>(w&lt;h) &#123;</span><br><span class="line">		<span class="comment">//如果高度大于宽度，则将高度视角扩大，图形显示居中</span></span><br><span class="line">        glOrtho(-half,half,-half*h/w,half*h/w,-half,half);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">//如果宽度大于高度，则将宽度视角扩大，图形显示居中</span></span><br><span class="line">        glOrtho(-half*w/h,half*w/h,-half,half,-half,half);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//程序入口</span></span><br><span class="line"><span class="built_in">int</span> main(<span class="built_in">int</span> argc, char *argv[])&#123;</span><br><span class="line">	<span class="comment">//对GLUT进行初始化，并处理所有的命令行参数</span></span><br><span class="line">	glutInit(&amp;argc, argv);</span><br><span class="line">	<span class="comment">//指定RGB颜色模式和单缓冲窗口</span></span><br><span class="line">	glutInitDisplayMode(GLUT_RGB | GLUT_SINGLE);</span><br><span class="line">	<span class="comment">//定义窗口的位置</span></span><br><span class="line">	glutInitWindowPosition(<span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">	<span class="comment">//定义窗口的大小</span></span><br><span class="line">	glutInitWindowSize(<span class="number">400</span>, <span class="number">400</span>);</span><br><span class="line">	<span class="comment">//创建窗口，同时为之命名</span></span><br><span class="line">	glutCreateWindow(<span class="string">"OpenGL"</span>);</span><br><span class="line">	<span class="comment">//设置窗口清除颜色为白色</span></span><br><span class="line">	glClearColor(<span class="number">1.0f</span>,<span class="number">1.0f</span>,<span class="number">1.0f</span>,<span class="number">1.0f</span>);</span><br><span class="line">	<span class="comment">//参数为一个函数，绘图时这个函数就会被调用</span></span><br><span class="line">	glutDisplayFunc(&amp;display);</span><br><span class="line">	<span class="comment">//参数为一个函数，当窗口大小改变时会被调用</span></span><br><span class="line">	glutReshapeFunc(ChangeSize);</span><br><span class="line">	<span class="comment">//该函数让GLUT框架开始运行，所有设置的回调函数开始工作，直到用户终止程序为止</span></span><br><span class="line">	glutMainLoop();</span><br><span class="line">	<span class="comment">//程序返回</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行效果如下图所示 <a href="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150410152854.jpg" target="_blank" rel="noopener"><img src="http://cdn.cuiqingcai.com/wp-content/uploads/2015/04/20150410152854.jpg" alt="20150410152854"></a></p>
                  <h2 id="综述-1"><a href="#综述-1" class="headerlink" title="综述"></a>综述</h2>
                  <p>当然，这里直接调用了类库中的画线方法，而且用的是三角函数定位坐标。对于 DDA 算法等实现还没有进行替换，等实现 DDA 算法之后，再将绘制直线，圆弧等等的算法替换掉。同样可以实现机器人的绘制。 希望对大家有帮助！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-04-10 15:37:08" itemprop="dateCreated datePublished" datetime="2015-04-10T15:37:08+08:00">2015-04-10</time>
                </span>
                <span id="/1597.html" class="post-meta-item leancloud_visitors" data-flag-title="OpenGL绘图实例一之机器人的绘制" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>6.7k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>6 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1592.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> JavaScript <i class="label-arrow"></i>
                  </a>
                  <a href="/1592.html" class="post-title-link" itemprop="url">jQuery应用四之图片局部放大插件jQZoom</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>我们都见过淘宝上的宝贝，把鼠标放上去，会有局部放大的功能，现在我们可以利用一个叫jQZoom的插件，来实现图片的局部放大，让我们来感受一下</p>
                  <h2 id="在线演示"><a href="#在线演示" class="headerlink" title="在线演示"></a>在线演示</h2>
                  <p>我们首先来在线演示一下效果，然后我们说一下是怎样的实现，点开链接进行预览吧 <a href="http://res.cuiqingcai.com/jqplugins/jqzoom/" target="_blank" rel="noopener">在线预览</a></p>
                  <h2 id="插件文件"><a href="#插件文件" class="headerlink" title="插件文件"></a>插件文件</h2>
                  <ul>
                    <li><a href="http://res.cuiqingcai.com/jqplugins/jqzoom/js/jquery.min.js" target="_blank" rel="noopener">jquery.min.js</a></li>
                    <li><a href="http://res.cuiqingcai.com/jqplugins/jqzoom/js/jquery.jqzoom.js" target="_blank" rel="noopener">jquery.jqzoom.js</a></li>
                    <li><a href="http://res.cuiqingcai.com/jqplugins/jqzoom/css/jquery.jqzoom.css" target="_blank" rel="noopener">jquery.jqzoom.css</a></li>
                  </ul>
                  <p>其中包含了两个JS文件，一个是jQuery库，另一个就是jqzoom插件文件。另外还有一个css文件，主要作用是给图片放缩规定样式</p>
                  <h2 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h2>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>JQZoom放大镜<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/jquery.jqzoom.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"css/jquery.jqzoom.css"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span></span><br><span class="line"><span class="css">           <span class="selector-tag">body</span>&#123;<span class="attribute">font-size</span>:<span class="number">13px</span>&#125;</span></span><br><span class="line"><span class="css">           <span class="selector-tag">span</span>&#123;<span class="attribute">color</span>:Red;<span class="attribute">font-size</span>:<span class="number">12px</span>&#125;</span></span><br><span class="line"><span class="css">           <span class="selector-class">.divFrame</span>&#123;<span class="attribute">width</span>:<span class="number">260px</span>;<span class="attribute">border</span>:solid <span class="number">1px</span> <span class="number">#666</span>&#125;</span></span><br><span class="line"><span class="css">           <span class="selector-class">.divFrame</span> <span class="selector-class">.divTitle</span>&#123;<span class="attribute">padding</span>:<span class="number">5px</span>;<span class="attribute">background-color</span>:<span class="number">#eee</span>;<span class="attribute">font-weight</span>:bold&#125;</span></span><br><span class="line"><span class="css">           <span class="selector-class">.divFrame</span> <span class="selector-class">.divContent</span>&#123;<span class="attribute">padding</span>:<span class="number">8px</span>;<span class="attribute">line-height</span>:<span class="number">1.6em</span>&#125;</span></span><br><span class="line"><span class="css">           <span class="selector-class">.divFrame</span> <span class="selector-class">.divContent</span> <span class="selector-tag">img</span>&#123;<span class="attribute">border</span>:<span class="number">1px</span> solid <span class="number">#ccc</span>&#125;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">        $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            $(<span class="string">"#jqzoom"</span>).jqzoom( <span class="comment">//绑定图片放大插件jqzoom</span></span></span><br><span class="line">                 &#123;</span><br><span class="line">                     zoomWidth: 230,</span><br><span class="line">                     zoomHeight: 230,</span><br><span class="line"><span class="actionscript">                     position: <span class="string">'right'</span></span></span><br><span class="line">                 &#125;</span><br><span class="line">            );</span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"divFrame"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"divTitle"</span>&gt;</span></span><br><span class="line">              图片放大镜</span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"divContent"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"images/bag.jpg"</span> <span class="attr">id</span>=<span class="string">"jqzoom"</span> <span class="attr">title</span>=<span class="string">"我的背包"</span>&gt;</span></span><br><span class="line">		         <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"images/bagsmall.jpg"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>Demo的代码如上所示，下面我们来分析一下代码调用</p>
                  <h2 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h2>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"images/bag.jpg"</span> <span class="attr">id</span>=<span class="string">"jqzoom"</span> <span class="attr">title</span>=<span class="string">"我的背包"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"images/bagsmall.jpg"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>最主要的部分如上所示，是一个超链接包含了一张图片。超链接的href是图片的大图，里面的img的src是小图。 利用插件时，只需要取到超链接这个元素，然后调用jqzoom方法就可以了</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="string">$("#jqzoom").jqzoom(</span> <span class="string">//绑定图片放大插件jqzoom</span></span><br><span class="line">	 <span class="string">&#123;</span></span><br><span class="line">		 <span class="attr">zoomWidth:</span> <span class="number">230</span><span class="string">,</span></span><br><span class="line">		 <span class="attr">zoomHeight:</span> <span class="number">230</span><span class="string">,</span></span><br><span class="line">		 <span class="attr">position:</span> <span class="string">'right'</span></span><br><span class="line">	 <span class="string">&#125;</span></span><br><span class="line"><span class="string">);</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>用法很简单，只需要传入一些参数就可以了。</p>
                  <h2 id="参数详解"><a href="#参数详解" class="headerlink" title="参数详解"></a>参数详解</h2>
                  <p><strong>下面是所有的参数详解</strong></p>
                  <ul>
                    <li>zoomType，默认值：’standard’，另一个值是’reverse’，是否将原图用半透明图层遮盖。</li>
                    <li>zoomWidth，默认值：200，放大窗口的宽度。</li>
                    <li>zoomHeight，默认值：200，放大窗口的高度。</li>
                    <li>xOffset，默认值：10，放大窗口相对于原图的x轴偏移值，可以为负。</li>
                    <li>yOffset，默认值：0，放大窗口相对于原图的y轴偏移值，可以为负。</li>
                    <li>position，默认值：’right’，放大窗口的位置，值还可以是:’right’ ,’left’ ,’top’ ,’bottom’。</li>
                    <li>lens，默认值：true，若为false，则不在原图上显示镜头。</li>
                    <li>imageOpacity，默认值：0.2，当zoomType的值为’reverse’时，这个参数用于指定遮罩的透明度。</li>
                    <li>title，默认值：true，在放大窗口中显示标题，值可以为a标记的title值，若无，则为原图的title值。</li>
                    <li>showEffect，默认值：’show’，显示放大窗口时的效果，值可以为: ‘show’ ,’fadein’。</li>
                    <li>hideEffect，默认值：’hide’，隐藏放大窗口时的效果: ‘hide’ ,’fadeout’。</li>
                    <li>fadeinSpeed，默认值：’fast’，放大窗口的渐显速度(选项: ‘fast’,’slow’,’medium’)。</li>
                    <li>fadeoutSpeed，默认值：’slow’，放大窗口的渐隐速度(选项: ‘fast’,’slow’,’medium’)。</li>
                    <li>showPreload，默认值：true，是否显示加载提示Loading zoom(选项: ‘true’,’false’)。</li>
                    <li>preloadText，默认值：’Loading zoom’，自定义加载提示文本。</li>
                    <li>preloadPosition，默认值：’center’，加载提示的位置，值也可以为’bycss’，以通过css指定位置。</li>
                  </ul>
                  <p>大家可以尝试设置上面的参数来达到想要的效果。</p>
                  <h2 id="综述-1"><a href="#综述-1" class="headerlink" title="综述"></a>综述</h2>
                  <p>通过jQZoom这个插件我们可以很方便地实现图片的局部放缩预览，希望对大家有帮助。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-04-09 13:04:04" itemprop="dateCreated datePublished" datetime="2015-04-09T13:04:04+08:00">2015-04-09</time>
                </span>
                <span id="/1592.html" class="post-meta-item leancloud_visitors" data-flag-title="jQuery应用四之图片局部放大插件jQZoom" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.6k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1585.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> JavaScript <i class="label-arrow"></i>
                  </a>
                  <a href="/1585.html" class="post-title-link" itemprop="url">jQuery应用三之图片浏览插件LightBox</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>我们肯定用过QQ空间吧，看到QQ空间里面的照片，点一下就会出现一个悬浮框，显示放大后的图片，而且可以点击左右箭头来查看上一张和下一张照片，怎样？这种效果，想不想实现一下。 在这里，我们就引用一个jQuery插件来帮助我们完成这件事情，让我们拭目以待吧</p>
                  <h2 id="在线演示"><a href="#在线演示" class="headerlink" title="在线演示"></a>在线演示</h2>
                  <p>我们首先来在线演示一下效果，然后我们说一下是怎样的实现，点开链接进行预览吧 <a href="http://res.cuiqingcai.com/jqplugins/lightbox/" target="_blank" rel="noopener">在线预览</a></p>
                  <h2 id="插件文件"><a href="#插件文件" class="headerlink" title="插件文件"></a>插件文件</h2>
                  <ul>
                    <li><a href="http://res.cuiqingcai.com/jqplugins/lightbox/js/jquery-1.4.2.min.js" target="_blank" rel="noopener">jquery-1.4.2.min.js</a></li>
                    <li><a href="http://res.cuiqingcai.com/jqplugins/lightbox/js/jquery.notesforlightbox.js" target="_blank" rel="noopener">jquery.notesforlightbox.js</a></li>
                    <li><a href="http://res.cuiqingcai.com/jqplugins/lightbox/css/jquery.notesforlightbox.css" target="_blank" rel="noopener">jquery.notesforlightbox.css</a></li>
                  </ul>
                  <p>其中包含了两个JS文件，一个是jQuery库，另一个就是lightbox插件文件。另外还有一个css文件，主要作用是给图片浏览器规定样式</p>
                  <h2 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h2>
                  <p>我们写一个DEMO，包含了六张图片，用一个ul列表呈现出来</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">&lt;!DOCTYPE&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>notesforlightbox实例<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/jquery-1.4.2.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/jquery.notesforlightbox.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"css/jquery.notesforlightbox.css"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span></span><br><span class="line"><span class="css">           <span class="selector-tag">body</span>&#123;<span class="attribute">font-size</span>:<span class="number">13px</span>&#125;</span></span><br><span class="line"><span class="css">           <span class="selector-class">.divFrame</span>&#123;<span class="attribute">width</span>:<span class="number">380px</span>;<span class="attribute">border</span>:solid <span class="number">1px</span> <span class="number">#666</span>&#125;</span></span><br><span class="line"><span class="css">           <span class="selector-class">.divFrame</span> <span class="selector-class">.divTitle</span>&#123;<span class="attribute">padding</span>:<span class="number">5px</span>;<span class="attribute">background-color</span>:<span class="number">#eee</span>;<span class="attribute">font-weight</span>:bold&#125;</span></span><br><span class="line"><span class="css">           <span class="selector-class">.divFrame</span> <span class="selector-class">.divContent</span>&#123;<span class="attribute">padding</span>:<span class="number">8px</span>;<span class="attribute">line-height</span>:<span class="number">1.6em</span>&#125;</span></span><br><span class="line"><span class="css">           <span class="selector-class">.divFrame</span> <span class="selector-class">.divContent</span> <span class="selector-class">.divPics</span>&#123;<span class="attribute">background-color</span>: <span class="number">#777</span>;<span class="attribute">padding</span>: <span class="number">10px</span>;<span class="attribute">width</span>: <span class="number">344px</span>&#125;</span></span><br><span class="line"><span class="css">           <span class="selector-class">.divFrame</span> <span class="selector-class">.divContent</span> <span class="selector-class">.divPics</span> <span class="selector-tag">ul</span>&#123;<span class="attribute">list-style</span>: none;<span class="attribute">padding</span>:<span class="number">0px</span>;<span class="attribute">margin</span>:<span class="number">0px</span>&#125;</span></span><br><span class="line"><span class="css">           <span class="selector-class">.divFrame</span> <span class="selector-class">.divContent</span> <span class="selector-class">.divPics</span> <span class="selector-tag">ul</span> <span class="selector-tag">li</span>&#123;<span class="attribute">display</span>: inline;&#125;</span></span><br><span class="line"><span class="css">           <span class="selector-class">.divFrame</span> <span class="selector-class">.divContent</span> <span class="selector-class">.divPics</span> <span class="selector-tag">ul</span> <span class="selector-tag">img</span>&#123;<span class="attribute">border</span>: <span class="number">5px</span> solid <span class="number">#444</span>;<span class="attribute">border-width</span>: <span class="number">5px</span>;<span class="attribute">width</span>:<span class="number">100px</span>;<span class="attribute">height</span>:<span class="number">100px</span>&#125;</span></span><br><span class="line"><span class="css">           <span class="selector-class">.divFrame</span> <span class="selector-class">.divContent</span> <span class="selector-class">.divPics</span> <span class="selector-tag">ul</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> <span class="selector-tag">img</span>&#123;<span class="attribute">border</span>:<span class="number">5px</span> solid <span class="number">#fff</span>;<span class="attribute">border-width</span>: <span class="number">5px</span>;<span class="attribute">color</span>: <span class="number">#fff</span>;&#125;</span></span><br><span class="line"><span class="css">           <span class="selector-class">.divFrame</span> <span class="selector-class">.divContent</span> <span class="selector-class">.divPics</span> <span class="selector-tag">ul</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span>&#123;<span class="attribute">color</span>: <span class="number">#fff</span>;&#125;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">        $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            $(<span class="string">'.divPics a'</span>).lightBox(&#123;</span></span><br><span class="line"><span class="actionscript">                overlayBgColor: <span class="string">"#666"</span>, <span class="comment">//浏览图片时的背景色</span></span></span><br><span class="line"><span class="actionscript">                overlayOpacity: <span class="number">0.5</span>, <span class="comment">//背景色的透明度</span></span></span><br><span class="line"><span class="actionscript">                containerResizeSpeed: <span class="number">600</span> <span class="comment">//图片切换时的速度;</span></span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"divFrame"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"divTitle"</span>&gt;</span></span><br><span class="line">              我的相册</span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"divContent"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"divPics"</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"images/img01.jpg"</span> <span class="attr">title</span>=<span class="string">"第1篇风景图片"</span>&gt;</span></span><br><span class="line">                             <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"images/img01.jpg"</span> <span class="attr">alt</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">                      <span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"images/img02.jpg"</span> <span class="attr">title</span>=<span class="string">"第2篇风景图片"</span>&gt;</span></span><br><span class="line">                             <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"images/img02.jpg"</span> <span class="attr">alt</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">                      <span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"images/img03.jpg"</span> <span class="attr">title</span>=<span class="string">"第3篇风景图片"</span>&gt;</span></span><br><span class="line">                             <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"images/img03.jpg"</span> <span class="attr">alt</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">                      <span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"images/img04.jpg"</span> <span class="attr">title</span>=<span class="string">"第4篇风景图片"</span>&gt;</span></span><br><span class="line">                             <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"images/img04.jpg"</span> <span class="attr">alt</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">                      <span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"images/img05.jpg"</span> <span class="attr">title</span>=<span class="string">"第5篇风景图片"</span>&gt;</span></span><br><span class="line">                             <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"images/img05.jpg"</span> <span class="attr">alt</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">                      <span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                      <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"images/img06.jpg"</span> <span class="attr">title</span>=<span class="string">"第6篇风景图片"</span>&gt;</span></span><br><span class="line">                             <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"images/img06.jpg"</span> <span class="attr">alt</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">                      <span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其中images文件夹中存在了六张图片，其中每一个中的超链接的href链接是一张图片，超链接中还包含了img标签。这样可以保证点击图片的时候可以呼出一张大图。</p>
                  <h2 id="功能简析"><a href="#功能简析" class="headerlink" title="功能简析"></a>功能简析</h2>
                  <figure class="highlight arcade">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            $(<span class="string">'.divPics a'</span>).lightBox(&#123;</span><br><span class="line">                overlayBgColor: <span class="string">"#666"</span>, <span class="comment">//浏览图片时的背景色</span></span><br><span class="line">                overlayOpacity: <span class="number">0.5</span>, <span class="comment">//背景色的透明度</span></span><br><span class="line">                containerResizeSpeed: <span class="number">600</span> <span class="comment">//图片切换时的速度;</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们取到了所有的超链接元素，然后调用了lightBox方法，参数是一系列集合，在这里定义了</p>
                  <figure class="highlight dts">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">overlayBgColor:</span> <span class="string">"#666"</span>, <span class="comment">//浏览图片时的背景色</span></span><br><span class="line"><span class="symbol">overlayOpacity:</span> <span class="number">0.5</span>, <span class="comment">//背景色的透明度</span></span><br><span class="line"><span class="symbol">containerResizeSpeed:</span> <span class="number">600</span> <span class="comment">//图片切换时的速度;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里给出所有的<strong>参数说明</strong></p>
                  <p>名称</p>
                  <p>默认值</p>
                  <p>说明</p>
                  <p>overlayBgColor</p>
                  <h1 id="000"><a href="#000" class="headerlink" title="000"></a>000</h1>
                  <p>背景色</p>
                  <p>overlayOpacity</p>
                  <p>0.8</p>
                  <p>背景色透明度</p>
                  <p>fixedNavigation</p>
                  <p>false</p>
                  <p>是否始终显示上一张、下一张按钮</p>
                  <p>imageLoading</p>
                  <p>images/lightbox-ico-loading.gif</p>
                  <p>加载图片时显示的图片</p>
                  <p>imageBtnPrev</p>
                  <p>images/lightbox-btn-prev.gif</p>
                  <p>上一张按钮的图片</p>
                  <p>imageBtnNext</p>
                  <p>images/lightbox-btn-next.gif</p>
                  <p>下一张按钮的图片</p>
                  <p>imageBtnClose</p>
                  <p>images/lightbox-btn-close.gif</p>
                  <p>关闭按钮的图片</p>
                  <p>imageBlank</p>
                  <p>images/lightbox-blank.gif</p>
                  <p>上一张、下一张按钮周围空白部分的图片（默认透明）</p>
                  <p>containerBorderSize</p>
                  <p>10</p>
                  <p>展示图片的边框宽度</p>
                  <p>containerResizeSpeed</p>
                  <p>400</p>
                  <p>展示过程切换的速度</p>
                  <p>txtImage</p>
                  <p>Image</p>
                  <p>页码辅助文字</p>
                  <p>txtOf</p>
                  <p>of</p>
                  <p>页码辅助文字</p>
                  <p>keyToClose</p>
                  <p>c</p>
                  <p>关闭展示的快捷键</p>
                  <p>keyToPrev</p>
                  <p>p</p>
                  <p>上一张的快捷键</p>
                  <p>keyToNext</p>
                  <p>n</p>
                  <p>下一张的快捷键</p>
                  <p>值得注意的地方是</p>
                  <p>imageLoading</p>
                  <p>‘images/lightbox-ico-loading.gif’</p>
                  <p>加载图片时显示的图片</p>
                  <p>imageBtnPrev</p>
                  <p>‘images/lightbox-btn-prev.gif’</p>
                  <p>上一张按钮的图片</p>
                  <p>imageBtnNext</p>
                  <p>‘images/lightbox-btn-next.gif’</p>
                  <p>下一张按钮的图片</p>
                  <p>imageBtnClose</p>
                  <p>‘images/lightbox-btn-close.gif’</p>
                  <p>关闭按钮的图片</p>
                  <p>这几张张图片，我们如果不定义，则会使用JS中默认的定义路径 在 <a href="http://res.cuiqingcai.com/jqplugins/lightbox/js/jquery.notesforlightbox.js" target="_blank" rel="noopener">jquery.notesforlightbox.js</a> 中，如下程序便实现了上一张图片和下一张图片等按钮的定义</p>
                  <figure class="highlight groovy">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="string">imageLoading:</span> <span class="string">'images/loading.gif'</span>,</span><br><span class="line"><span class="string">imageBtnPrev:</span> <span class="string">'images/prev.png'</span>,</span><br><span class="line"><span class="string">imageBtnNext:</span> <span class="string">'images/next.png'</span>,</span><br><span class="line"><span class="string">imageBtnClose:</span> <span class="string">'images/close.png'</span>,</span><br><span class="line"><span class="string">imageBlank:</span> <span class="string">'images/lightbox-blank.gif'</span>,</span><br><span class="line"><span class="string">imageBtnBottomPrev:</span> <span class="string">'images/btm_prev.gif'</span>,</span><br><span class="line"><span class="string">imageBtnBottomNext:</span> <span class="string">'images/btm_next.gif'</span>,</span><br><span class="line"><span class="string">imageBtnPlay:</span> <span class="string">'images/start.png'</span>,</span><br><span class="line"><span class="string">imageBtnStop:</span> <span class="string">'images/pause.png'</span>,</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>所以，如果发现图片不正常显示可以检查一下这里的路径设置问题</p>
                  <h2 id="代码下载"><a href="#代码下载" class="headerlink" title="代码下载"></a>代码下载</h2>
                  <p><a href="https://github.com/cqcre/lightbox" target="_blank" rel="noopener">源码下载</a> 代码已部署在GitHub，可以下载查看</p>
                  <h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2>
                  <p>通过这个插件我们可以方便地实现图片的加载预览，效果也比较酷炫，希望对大家有帮助！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-04-07 22:59:58" itemprop="dateCreated datePublished" datetime="2015-04-07T22:59:58+08:00">2015-04-07</time>
                </span>
                <span id="/1585.html" class="post-meta-item leancloud_visitors" data-flag-title="jQuery应用三之图片浏览插件LightBox" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>4.3k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>4 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1573.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> JavaScript <i class="label-arrow"></i>
                  </a>
                  <a href="/1573.html" class="post-title-link" itemprop="url">jQuery应用二之邮箱下拉列表自动补全</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>我想大家一定见到过，在某个网站填写邮箱的时候，还没有填写完，就会出现一系列下拉列表，帮你自动补全邮箱的功能。现在我们就用jQuery来实现一下。 博主原创代码，如有代码写的不完善的地方还望大家多多指教。</p>
                  <h2 id="功能简述"><a href="#功能简述" class="headerlink" title="功能简述"></a>功能简述</h2>
                  <ul>
                    <li>填写邮箱名字，出现下拉列表，自动补全邮箱</li>
                    <li>点击上下按键，选取下拉列表邮箱</li>
                    <li>按回车键，选中列表内容，隐藏下拉列表</li>
                    <li>鼠标经过，下拉列表选项设置为高亮</li>
                    <li>鼠标点击，选中下拉列表选项，隐藏下拉列表</li>
                  </ul>
                  <h2 id="在线演示"><a href="#在线演示" class="headerlink" title="在线演示"></a>在线演示</h2>
                  <p>在此直接插入一个iframe进行演示 链接为 <a href="http://res.cuiqingcai.com/jqplugins/emailcomplete/" target="_blank" rel="noopener">在线演示</a></p>
                  <h2 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h2>
                  <p>HTML代码很简单，我们就一个简单的输入框，然后一个ul标签，在内部可以放好多li标签。</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"js/main.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"css/style.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"content"</span>&gt;</span></span><br><span class="line">		   <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"email"</span> <span class="attr">id</span>=<span class="string">"email"</span> <span class="attr">placeholder</span>=<span class="string">"请输入您的邮箱"</span>/&gt;</span></span><br><span class="line">		   <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"list"</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上便是HTML代码</p>
                  <h2 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h2>
                  <p>在CSS中，定义也比较简单，其中有一个 lilight 的 class，可以使背景变色，通过 remove 和 add 这个 class，我们可以轻松地实现下拉列表元素是否选中的区分。 CSS所有样式如下</p>
                  <figure class="highlight scss">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-class">.content</span> <span class="selector-tag">input</span>&#123;</span><br><span class="line">	<span class="attribute">padding</span>:<span class="number">5px</span> <span class="number">10px</span>;</span><br><span class="line">	<span class="attribute">width</span>:<span class="number">200px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">ul</span><span class="selector-class">.list</span>&#123;</span><br><span class="line">	<span class="attribute">list-style</span>:none;</span><br><span class="line">	<span class="attribute">padding</span>:<span class="number">0px</span>;</span><br><span class="line">	<span class="attribute">margin</span>:<span class="number">0px</span>;</span><br><span class="line">	<span class="attribute">overflow</span>:hidden;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">ul</span><span class="selector-class">.list</span> <span class="selector-tag">li</span>&#123;</span><br><span class="line">	<span class="attribute">border</span>:<span class="number">1px</span> solid <span class="number">#EEE</span>;</span><br><span class="line">	<span class="attribute">width</span>:<span class="number">180px</span>;</span><br><span class="line">	<span class="attribute">padding</span>:<span class="number">5px</span> <span class="number">10px</span>;</span><br><span class="line">	<span class="attribute">margin</span>:<span class="number">0px</span>;</span><br><span class="line">	<span class="attribute">text-overflow</span>:ellipsis;  <span class="comment">//溢出时变为省略</span></span><br><span class="line">	<span class="attribute">overflow</span>:hidden;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.lilight</span>&#123;</span><br><span class="line">	<span class="attribute">background-color</span>:<span class="number">#fafafa</span>;</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上便是CSS代码</p>
                  <h2 id="JS"><a href="#JS" class="headerlink" title="JS"></a>JS</h2>
                  <p>我们引入 jQuery 来实现对元素的操作，实现了按键和鼠标监听，代码如下</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="constructor">$(<span class="params">function</span>()</span>&#123;</span><br><span class="line">		<span class="comment">//声明所有的电子邮件变量</span></span><br><span class="line">		var mail=<span class="keyword">new</span> <span class="constructor">Array(<span class="string">"sina.com.cn"</span>,<span class="string">"126.com"</span>,<span class="string">"163.com"</span>,<span class="string">"gmail.com"</span>,<span class="string">"qq.com"</span>,<span class="string">"vip.qq.com"</span>,<span class="string">"hotmail.com"</span>,<span class="string">"sohu.com"</span>,<span class="string">"139.com"</span>,<span class="string">"vip.sina.com"</span>,<span class="string">"cuiqingcai.com"</span>)</span>;</span><br><span class="line">		<span class="comment">//生成一个个li，并加入到ul中</span></span><br><span class="line">		for(var i=<span class="number">0</span>;i&lt;mail.length;i++)&#123;</span><br><span class="line">			var liElement=<span class="constructor">$(<span class="string">"&lt;li class=\"autoli\"&gt;&lt;span class=\"ex\"&gt;&lt;/span&gt;&lt;span class=\"at\"&gt;@&lt;/span&gt;&lt;span class=\"tail\"&gt;"</span>+<span class="params">mail</span>[<span class="params">i</span>]+<span class="string">"&lt;/span&gt;&lt;/li&gt;"</span>)</span>;</span><br><span class="line">			liElement.append<span class="constructor">To(<span class="string">"ul.list"</span>)</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//首先让list隐藏起来</span></span><br><span class="line">		<span class="constructor">$(<span class="string">"ul.list"</span>)</span>.hide<span class="literal">()</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="constructor">$(<span class="string">"#email"</span>)</span>.keyup(<span class="keyword">function</span>(event)&#123;</span><br><span class="line">			<span class="comment">//键入的内容不是上下箭头和回车</span></span><br><span class="line">			<span class="keyword">if</span>(event.keyCode!=<span class="number">38</span>&amp;&amp;event.keyCode!=<span class="number">40</span>&amp;&amp;event.keyCode!=<span class="number">13</span>)&#123;</span><br><span class="line">				<span class="comment">//如果输入的值不是空或者不以空格开头</span></span><br><span class="line">				<span class="keyword">if</span>($.trim(<span class="constructor">$(<span class="params">this</span>)</span>.<span class="keyword">val</span><span class="literal">()</span>)!=<span class="string">""</span>&amp;&amp; $.trim(<span class="constructor">$(<span class="params">this</span>)</span>.<span class="keyword">val</span><span class="literal">()</span>).<span class="keyword">match</span>(/^@/)==null)&#123;</span><br><span class="line">					<span class="constructor">$(<span class="string">"ul.list"</span>)</span>.show<span class="literal">()</span>;</span><br><span class="line">					<span class="comment">//如果当前有已经高亮的下拉选项卡，那么将其移除</span></span><br><span class="line">					<span class="keyword">if</span>(<span class="constructor">$(<span class="string">"ul.list li:visible"</span>)</span>.has<span class="constructor">Class(<span class="string">"lilight"</span>)</span>)&#123;</span><br><span class="line">						<span class="constructor">$(<span class="string">"ul.list li"</span>)</span>.remove<span class="constructor">Class(<span class="string">"lilight"</span>)</span>;</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="comment">//如果还存在下拉选项卡，那么将其高亮</span></span><br><span class="line">					<span class="keyword">if</span>(<span class="constructor">$(<span class="string">"ul.list li:visible"</span>)</span>)&#123;</span><br><span class="line">						<span class="constructor">$(<span class="string">"ul.list li:visible:eq(0)"</span>)</span>.add<span class="constructor">Class(<span class="string">"lilight"</span>)</span>;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="comment">//否则不进行显示</span></span><br><span class="line">					<span class="constructor">$(<span class="string">"ul.list"</span>)</span>.hide<span class="literal">()</span>;</span><br><span class="line">					<span class="constructor">$(<span class="string">"ul.list li"</span>)</span>.remove<span class="constructor">Class(<span class="string">"lilight"</span>)</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="comment">//输入的内容还没有包括@符号</span></span><br><span class="line">				<span class="keyword">if</span>($.trim(<span class="constructor">$(<span class="params">this</span>)</span>.<span class="keyword">val</span><span class="literal">()</span>).<span class="keyword">match</span>(/.*@/)==null)&#123;</span><br><span class="line">					<span class="constructor">$(<span class="string">".list li .ex"</span>)</span>.text(<span class="constructor">$(<span class="params">this</span>)</span>.<span class="keyword">val</span><span class="literal">()</span>);</span><br><span class="line">				&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="comment">//输入的符号已经包含了@</span></span><br><span class="line">					var str = <span class="constructor">$(<span class="params">this</span>)</span>.<span class="keyword">val</span><span class="literal">()</span>;</span><br><span class="line">					var strs = str.split(<span class="string">"@"</span>);</span><br><span class="line">					<span class="constructor">$(<span class="string">".list li .ex"</span>)</span>.text(strs<span class="literal">[<span class="number">0</span>]</span>);</span><br><span class="line">					<span class="keyword">if</span>(<span class="constructor">$(<span class="params">this</span>)</span>.<span class="keyword">val</span><span class="literal">()</span>.length&gt;=strs<span class="literal">[<span class="number">0</span>]</span>.length+<span class="number">1</span>)&#123;</span><br><span class="line">						tail=str.substr(strs<span class="literal">[<span class="number">0</span>]</span>.length+<span class="number">1</span>);</span><br><span class="line">						<span class="constructor">$(<span class="string">".list li .tail"</span>)</span>.each(<span class="keyword">function</span><span class="literal">()</span>&#123;</span><br><span class="line">							<span class="comment">//如果数组中的元素是以文本中的后缀开头，那么就显示，否则不显示</span></span><br><span class="line">							<span class="keyword">if</span>(!(<span class="constructor">$(<span class="params">this</span>)</span>.text<span class="literal">()</span>.<span class="keyword">match</span>(tail)!=null&amp;&amp;<span class="constructor">$(<span class="params">this</span>)</span>.text<span class="literal">()</span>.index<span class="constructor">Of(<span class="params">tail</span>)</span>==<span class="number">0</span>))&#123;</span><br><span class="line">								<span class="comment">//隐藏其他的li</span></span><br><span class="line">								<span class="constructor">$(<span class="params">this</span>)</span>.parent<span class="literal">()</span>.hide<span class="literal">()</span>;</span><br><span class="line">							&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">								<span class="comment">//显示所在的li</span></span><br><span class="line">								<span class="constructor">$(<span class="params">this</span>)</span>.parent<span class="literal">()</span>.show<span class="literal">()</span>;</span><br><span class="line">							&#125;</span><br><span class="line">						&#125;);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//按了回车时，将当前选中的元素写入到文本框中</span></span><br><span class="line">			<span class="keyword">if</span>(event.keyCode==<span class="number">13</span>)&#123;</span><br><span class="line">				<span class="constructor">$(<span class="string">"#email"</span>)</span>.<span class="keyword">val</span>(<span class="constructor">$(<span class="string">"ul.list li.lilight:visible"</span>)</span>.text<span class="literal">()</span>);</span><br><span class="line">				<span class="constructor">$(<span class="string">"ul.list"</span>)</span>.hide<span class="literal">()</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//监听上下方向键</span></span><br><span class="line">		<span class="constructor">$(<span class="string">"#email"</span>)</span>.keydown(<span class="keyword">function</span>(event)&#123;</span><br><span class="line">			<span class="comment">//下方向键按下了</span></span><br><span class="line">			<span class="keyword">if</span>(event.keyCode==<span class="number">40</span>)&#123;</span><br><span class="line">				<span class="keyword">if</span>(<span class="constructor">$(<span class="string">"ul.list li"</span>)</span>.is(<span class="string">".lilight"</span>))&#123;</span><br><span class="line">					<span class="keyword">if</span>(<span class="constructor">$(<span class="string">"ul.list li.lilight"</span>)</span>.next<span class="constructor">All()</span>.is(<span class="string">"li:visible"</span>))&#123;</span><br><span class="line">						<span class="constructor">$(<span class="string">"ul.list li.lilight"</span>)</span>.remove<span class="constructor">Class(<span class="string">"lilight"</span>)</span>.next(<span class="string">"li"</span>).add<span class="constructor">Class(<span class="string">"lilight"</span>)</span>;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//下方向键按下了</span></span><br><span class="line">			<span class="keyword">if</span>(event.keyCode==<span class="number">38</span>)&#123;</span><br><span class="line">				<span class="keyword">if</span>(<span class="constructor">$(<span class="string">"ul.list li"</span>)</span>.is(<span class="string">".lilight"</span>))&#123;</span><br><span class="line">					<span class="keyword">if</span>(<span class="constructor">$(<span class="string">"ul.list li.lilight"</span>)</span>.prev<span class="constructor">All()</span>.is(<span class="string">"li:visible"</span>))&#123;</span><br><span class="line">						<span class="constructor">$(<span class="string">"ul.list li.lilight"</span>)</span>.remove<span class="constructor">Class(<span class="string">"lilight"</span>)</span>.prev(<span class="string">"li"</span>).add<span class="constructor">Class(<span class="string">"lilight"</span>)</span>;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//当鼠标点击某个下拉项时，选中该项，下拉列表隐藏</span></span><br><span class="line">		<span class="constructor">$(<span class="string">"ul.list li"</span>)</span>.click(<span class="keyword">function</span><span class="literal">()</span>&#123;</span><br><span class="line">			<span class="constructor">$(<span class="string">"#email"</span>)</span>.<span class="keyword">val</span>(<span class="constructor">$(<span class="params">this</span>)</span>.text<span class="literal">()</span>);</span><br><span class="line">			<span class="constructor">$(<span class="string">"ul.list"</span>)</span>.hide<span class="literal">()</span>;</span><br><span class="line">		&#125;);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//当鼠标划过某个下拉项时，选中该项，下拉列表隐藏</span></span><br><span class="line">		<span class="constructor">$(<span class="string">"ul.list li"</span>)</span>.hover(<span class="keyword">function</span><span class="literal">()</span>&#123;</span><br><span class="line">			<span class="constructor">$(<span class="string">"ul.list li"</span>)</span>.remove<span class="constructor">Class(<span class="string">"lilight"</span>)</span>;</span><br><span class="line">			<span class="constructor">$(<span class="params">this</span>)</span>.add<span class="constructor">Class(<span class="string">"lilight"</span>)</span>;</span><br><span class="line">		&#125;);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//当鼠标点击其他位置，下拉列表隐藏</span></span><br><span class="line">		<span class="constructor">$(<span class="params">document</span>)</span>.click(<span class="keyword">function</span><span class="literal">()</span>&#123;</span><br><span class="line">			<span class="constructor">$(<span class="string">"ul.list"</span>)</span>.hide<span class="literal">()</span>;</span><br><span class="line">		&#125;);			</span><br><span class="line">	&#125;);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上便是 jQuery 代码</p>
                  <h2 id="源码下载"><a href="#源码下载" class="headerlink" title="源码下载"></a>源码下载</h2>
                  <p><a href="https://github.com/cqcre/EmailComplete" target="_blank" rel="noopener">源码下载</a></p>
                  <h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2>
                  <p>其实还有一个比较强大的插件，叫autocomplete，同样可以实现下拉列表的自动补全，功能更加完善，如果大家有兴趣可以去试一下。不过感觉最常用的就是邮箱自动补齐，而且直接用 jQuery 就可以比较方便地实现，所以博主就没有使用autocomplete插件，而是自己写了一下，一来练习一下，二来对这种功能的实现了解得更加透彻。 大家也可以尝试下，希望小伙伴们有帮助，加油！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-04-06 00:55:23" itemprop="dateCreated datePublished" datetime="2015-04-06T00:55:23+08:00">2015-04-06</time>
                </span>
                <span id="/1573.html" class="post-meta-item leancloud_visitors" data-flag-title="jQuery应用二之邮箱下拉列表自动补全" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>4.2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>4 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1544.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> JavaScript <i class="label-arrow"></i>
                  </a>
                  <a href="/1544.html" class="post-title-link" itemprop="url">jQuery应用一之验证插件validate的使用</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <p>validate是一个用来验证表单提交的插件，应用十分广泛，具有如下的几个功能</p>
                  <ul>
                    <li>自带了基本的验证规则</li>
                    <li>提供了丰富的验证信息提示功能</li>
                    <li>多种事件触发验证</li>
                    <li>自定义验证规则</li>
                  </ul>
                  <p>下面我们就来感受一下这个插件的强大之处吧</p>
                  <h2 id="插件下载"><a href="#插件下载" class="headerlink" title="插件下载"></a>插件下载</h2>
                  <p>在这里我们需要用到的插件文件有</p>
                  <ul>
                    <li><a href="http://res.cuiqingcai.com/js/jquery.validate.js" target="_blank" rel="noopener">jquery.validate.js</a> </li>
                    <li><a href="http://res.cuiqingcai.com/js/jquery.validate.messages_cn.js" target="_blank" rel="noopener">jquery.validate.messages_cn.js</a></li>
                    <li><a href="http://res.cuiqingcai.com/js/jquery.min.js" target="_blank" rel="noopener">jquery.min.js</a></li>
                  </ul>
                  <p>一个是表单验证的主文件，另一个是设置中文提示的文件。</p>
                  <h2 id="实例引入"><a href="#实例引入" class="headerlink" title="实例引入"></a>实例引入</h2>
                  <p>我们先用一个小例子来感受一下使用 validate 插件的便捷之处，这个例子中加入了表单合法性验证和错误提示，代码如下</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">&lt;!DOCTYPE&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>validate验证插件<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> </span></span><br><span class="line"><span class="tag">            <span class="attr">src</span>=<span class="string">"http://res.cuiqingcai.com/js/jquery.min.js"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> </span></span><br><span class="line"><span class="tag">            <span class="attr">src</span>=<span class="string">"http://res.cuiqingcai.com/js/jquery.validate.js"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> </span></span><br><span class="line"><span class="tag">            <span class="attr">src</span>=<span class="string">"http://res.cuiqingcai.com/js/jquery.validate.messages_cn.js"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"http://res.cuiqingcai.com/jqplugins/validate/style.css"</span>&gt;</span><span class="tag">&lt;/<span class="name">link</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">        $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            $(<span class="string">"#frmV"</span>).validate(</span></span><br><span class="line">              &#123;</span><br><span class="line"><span class="actionscript">                  <span class="comment">/*自定义验证规则*/</span></span></span><br><span class="line">                  rules: &#123;</span><br><span class="line"><span class="actionscript">                      username: &#123; required: <span class="literal">true</span>, minlength: <span class="number">6</span> &#125;,</span></span><br><span class="line"><span class="actionscript">                      email: &#123; required: <span class="literal">true</span>, email: <span class="literal">true</span> &#125;</span></span><br><span class="line">                  &#125;,</span><br><span class="line"><span class="actionscript">                  <span class="comment">/*错误提示位置*/</span></span></span><br><span class="line"><span class="actionscript">                  errorPlacement: <span class="function"><span class="keyword">function</span><span class="params">(error, element)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                      error.appendTo(element.siblings(<span class="string">"span"</span>));</span></span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            );</span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"frmV"</span> <span class="attr">method</span>=<span class="string">"get"</span> <span class="attr">action</span>=<span class="string">"#"</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"divFrame"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"divTitle"</span>&gt;</span></span><br><span class="line">              请输入下列资料</span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"divContent"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">              用户名：<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"username"</span> <span class="attr">name</span>=<span class="string">"username"</span> </span></span><br><span class="line"><span class="tag">                     <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"txt"</span> /&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">"red"</span>&gt;</span>*<span class="tag">&lt;/<span class="name">font</span>&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">              邮箱：<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"email"</span> <span class="attr">name</span>=<span class="string">"email"</span> </span></span><br><span class="line"><span class="tag">                     <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"txt"</span> /&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">"red"</span>&gt;</span>*<span class="tag">&lt;/<span class="name">font</span>&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"divBtn"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"sbtUser"</span> <span class="attr">type</span>=<span class="string">"submit"</span> </span></span><br><span class="line"><span class="tag">                     <span class="attr">value</span>=<span class="string">"提交"</span> <span class="attr">class</span>=<span class="string">"btn"</span> /&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下 在这里我们定义了 rules 来控制表单的合法性，通过 errorPlacement 来控制错误的输出位置。</p>
                  <h2 id="校验规则"><a href="#校验规则" class="headerlink" title="校验规则"></a>校验规则</h2>
                  <p>下面我们详细说一下关于rules的相关知识，将校检规则总结如下</p>
                  <p>序号</p>
                  <p>规则</p>
                  <p>描述</p>
                  <p>1</p>
                  <p>required:true</p>
                  <p>必须输入的字段。</p>
                  <p>2</p>
                  <p>remote:”check.php”</p>
                  <p>使用 ajax 方法调用 check.php 验证输入值。</p>
                  <p>3</p>
                  <p>email:true</p>
                  <p>必须输入正确格式的电子邮件。</p>
                  <p>4</p>
                  <p>url:true</p>
                  <p>必须输入正确格式的网址。</p>
                  <p>5</p>
                  <p>date:true</p>
                  <p>必须输入正确格式的日期。日期校验 ie6 出错，慎用。</p>
                  <p>6</p>
                  <p>dateISO:true</p>
                  <p>必须输入正确格式的日期（ISO），例如：2009-06-23，1998/01/22。只验证格式，不验证有效性。</p>
                  <p>7</p>
                  <p>number:true</p>
                  <p>必须输入合法的数字（负数，小数）。</p>
                  <p>8</p>
                  <p>digits:true</p>
                  <p>必须输入整数。</p>
                  <p>9</p>
                  <p>creditcard:</p>
                  <p>必须输入合法的信用卡号。</p>
                  <p>10</p>
                  <p>equalTo:”#field”</p>
                  <p>输入值必须和 #field 相同。</p>
                  <p>11</p>
                  <p>accept:</p>
                  <p>输入拥有合法后缀名的字符串（上传文件的后缀）。</p>
                  <p>12</p>
                  <p>maxlength:5</p>
                  <p>输入长度最多是 5 的字符串（汉字算一个字符）。</p>
                  <p>13</p>
                  <p>minlength:10</p>
                  <p>输入长度最小是 10 的字符串（汉字算一个字符）。</p>
                  <p>14</p>
                  <p>rangelength:[5,10]</p>
                  <p>输入长度必须介于 5 和 10 之间的字符串（汉字算一个字符）。</p>
                  <p>15</p>
                  <p>range:[5,10]</p>
                  <p>输入值必须介于 5 和 10 之间。</p>
                  <p>16</p>
                  <p>max:5</p>
                  <p>输入值不能大于 5。</p>
                  <p>17</p>
                  <p>min:10</p>
                  <p>输入值不能小于 10。</p>
                  <p>比如我们针对 email 这个表单就可以定义为</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">email:</span> <span class="string">&#123;</span> <span class="attr">required:</span> <span class="literal">true</span><span class="string">,</span> <span class="attr">email:</span> <span class="literal">true</span> <span class="string">&#125;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>针对url的这个输入表单就可以定义为</p>
                  <figure class="highlight yaml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attr">url:</span> <span class="string">&#123;</span> <span class="attr">required:</span> <span class="literal">true</span><span class="string">,</span> <span class="attr">url:</span> <span class="literal">true</span> <span class="string">&#125;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上便是校验规则的相关内容。</p>
                  <h2 id="消息提示"><a href="#消息提示" class="headerlink" title="消息提示"></a>消息提示</h2>
                  <p>在 jquery.validate.js 这个文件中，定义了默认的消息提示，不过它是英文的提示，默认的提示如下</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">messages</span>: &#123;</span><br><span class="line">    <span class="attribute">required</span>: <span class="string">"This field is required."</span>,</span><br><span class="line">    remote: <span class="string">"Please fix this field."</span>,</span><br><span class="line">    email: <span class="string">"Please enter a valid email address."</span>,</span><br><span class="line">    url: <span class="string">"Please enter a valid URL."</span>,</span><br><span class="line">    date: <span class="string">"Please enter a valid date."</span>,</span><br><span class="line">    dateISO: <span class="string">"Please enter a valid date (ISO)."</span>,</span><br><span class="line">    dateDE: <span class="string">"Bitte geben Sie ein gültiges Datum ein."</span>,</span><br><span class="line">    number: <span class="string">"Please enter a valid number."</span>,</span><br><span class="line">    numberDE: <span class="string">"Bitte geben Sie eine Nummer ein."</span>,</span><br><span class="line">    digits: <span class="string">"Please enter only digits"</span>,</span><br><span class="line">    creditcard: <span class="string">"Please enter a valid credit card number."</span>,</span><br><span class="line">    equalTo: <span class="string">"Please enter the same value again."</span>,</span><br><span class="line">    accept: <span class="string">"Please enter a value with a valid extension."</span>,</span><br><span class="line">    maxlength: $.validator.<span class="built_in">format</span>(<span class="string">"Please enter no more than &#123;0&#125; characters."</span>),</span><br><span class="line">    minlength: $.validator.<span class="built_in">format</span>(<span class="string">"Please enter at least &#123;0&#125; characters."</span>),</span><br><span class="line">    rangelength: $.validator.<span class="built_in">format</span>(<span class="string">"Please enter a value between &#123;0&#125; and &#123;1&#125; characters long."</span>),</span><br><span class="line">    range: $.validator.<span class="built_in">format</span>(<span class="string">"Please enter a value between &#123;0&#125; and &#123;1&#125;."</span>),</span><br><span class="line">    max: $.validator.<span class="built_in">format</span>(<span class="string">"Please enter a value less than or equal to &#123;0&#125;."</span>),</span><br><span class="line">    min: $.validator.<span class="built_in">format</span>(<span class="string">"Please enter a value greater than or equal to &#123;0&#125;."</span>)</span><br><span class="line">&#125;,</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>比如，如果遇到 email 校验有问题，那么便会提示</p>
                  <figure class="highlight ebnf">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="attribute">Please enter a valid email address</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>不过我们通过引入 jquery.validate.messages_cn.js 这个文件，写入了如下代码，将默认的提示修改为中文</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">jQuery</span><span class="selector-class">.extend</span>(<span class="selector-tag">jQuery</span><span class="selector-class">.validator</span><span class="selector-class">.messages</span>, &#123;</span><br><span class="line">        <span class="attribute">required</span>: <span class="string">"必选字段"</span>,</span><br><span class="line">		remote: <span class="string">"请修正该字段"</span>,</span><br><span class="line">		email: <span class="string">"请输入正确格式的电子邮件"</span>,</span><br><span class="line">		url: <span class="string">"请输入合法的网址"</span>,</span><br><span class="line">		date: <span class="string">"请输入合法的日期"</span>,</span><br><span class="line">		dateISO: <span class="string">"请输入合法的日期 (ISO)."</span>,</span><br><span class="line">		number: <span class="string">"请输入合法的数字"</span>,</span><br><span class="line">		digits: <span class="string">"只能输入整数"</span>,</span><br><span class="line">		creditcard: <span class="string">"请输入合法的信用卡号"</span>,</span><br><span class="line">		equalTo: <span class="string">"请再次输入相同的值"</span>,</span><br><span class="line">		accept: <span class="string">"请输入拥有合法后缀名的字符串"</span>,</span><br><span class="line">		maxlength: jQuery.<span class="built_in">format</span>(<span class="string">"请输入一个长度最多是 &#123;0&#125; 的字符串"</span>),</span><br><span class="line">		minlength: jQuery.<span class="built_in">format</span>(<span class="string">"请输入一个长度最少是 &#123;0&#125; 的字符串"</span>),</span><br><span class="line">		rangelength: jQuery.<span class="built_in">format</span>(<span class="string">"请输入一个长度介于 &#123;0&#125; 和 &#123;1&#125; 之间的字符串"</span>),</span><br><span class="line">		range: jQuery.<span class="built_in">format</span>(<span class="string">"请输入一个介于 &#123;0&#125; 和 &#123;1&#125; 之间的值"</span>),</span><br><span class="line">		max: jQuery.<span class="built_in">format</span>(<span class="string">"请输入一个最大为 &#123;0&#125; 的值"</span>),</span><br><span class="line">		min: jQuery.<span class="built_in">format</span>(<span class="string">"请输入一个最小为 &#123;0&#125; 的值"</span>)</span><br><span class="line">&#125;);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>当然，以上的设置都是默认的提示，我们还可以通过 messages 来设置提示，举一个小例子，加入 messages 选项</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">&lt;!DOCTYPE&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>validate验证插件<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> </span></span><br><span class="line"><span class="tag">            <span class="attr">src</span>=<span class="string">"http://res.cuiqingcai.com/js/jquery.min.js"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> </span></span><br><span class="line"><span class="tag">            <span class="attr">src</span>=<span class="string">"http://res.cuiqingcai.com/js/jquery.validate.js"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> </span></span><br><span class="line"><span class="tag">            <span class="attr">src</span>=<span class="string">"http://res.cuiqingcai.com/js/jquery.validate.messages_cn.js"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"http://res.cuiqingcai.com/jqplugins/validate/style.css"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">        $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            $(<span class="string">"#frmV"</span>).validate(</span></span><br><span class="line">              &#123;</span><br><span class="line"><span class="actionscript">                  <span class="comment">/*自定义验证规则*/</span></span></span><br><span class="line">                  rules: &#123;</span><br><span class="line"><span class="actionscript">					  username: &#123; required: <span class="literal">true</span>, minlength: <span class="number">6</span> &#125;,</span></span><br><span class="line"><span class="actionscript">                      email: &#123; required: <span class="literal">true</span>, email: <span class="literal">true</span> &#125;</span></span><br><span class="line">                  &#125;,</span><br><span class="line"><span class="actionscript">                  <span class="comment">/*错误提示位置*/</span></span></span><br><span class="line"><span class="actionscript">                  errorPlacement: <span class="function"><span class="keyword">function</span><span class="params">(error, element)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                      error.appendTo(element.siblings(<span class="string">"span"</span>));</span></span><br><span class="line">                  &#125;,</span><br><span class="line">				  messages: &#123;</span><br><span class="line"><span class="actionscript">					  username: &#123; required: <span class="string">"请输入姓名"</span>, minlength: <span class="string">"长度不可小于6"</span> &#125;,</span></span><br><span class="line"><span class="actionscript">                      email: &#123; required: <span class="string">"请输入电子邮件"</span>, email: <span class="string">"请输入正确格式"</span> &#125;</span></span><br><span class="line">				  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            );</span><br><span class="line">        &#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"frmV"</span> <span class="attr">method</span>=<span class="string">"get"</span> <span class="attr">action</span>=<span class="string">"#"</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"divFrame"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"divTitle"</span>&gt;</span></span><br><span class="line">              请输入下列资料</span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"divContent"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">              用户名：<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"username"</span> <span class="attr">name</span>=<span class="string">"username"</span> </span></span><br><span class="line"><span class="tag">                     <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"txt"</span> /&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">"red"</span>&gt;</span>*<span class="tag">&lt;/<span class="name">font</span>&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">              邮箱：<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"email"</span> <span class="attr">name</span>=<span class="string">"email"</span> </span></span><br><span class="line"><span class="tag">                     <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"txt"</span> /&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">"red"</span>&gt;</span>*<span class="tag">&lt;/<span class="name">font</span>&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"divBtn"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"sbtUser"</span> <span class="attr">type</span>=<span class="string">"submit"</span> </span></span><br><span class="line"><span class="tag">                     <span class="attr">value</span>=<span class="string">"提交"</span> <span class="attr">class</span>=<span class="string">"btn"</span> /&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果如下</p>
                  <h2 id="失败验证"><a href="#失败验证" class="headerlink" title="失败验证"></a>失败验证</h2>
                  <figure class="highlight xquery">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">  errorPlacement: <span class="keyword">function</span><span class="built_in">(error</span>, <span class="keyword">element</span>) &#123;</span><br><span class="line">error.appendTo(<span class="keyword">element</span>.siblings("span"));</span><br><span class="line">&#125;,</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>我们用 errorPlacement 来处理验证失败后的处理，方法有两个参数，一个是error，一个是element。 其中error是字符串，保存了messages中返回的错误信息，element是验证失败的input元素。 比如上面这一句</p>
                  <figure class="highlight reasonml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">error.append<span class="constructor">To(<span class="params">element</span>.<span class="params">siblings</span>(<span class="string">"span"</span>)</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>就代表把错误加入到input元素同级的span元素中，从而在<span>标签内部显示错误的内容。 其他的情况我们可以灵活处理。</p>
                  <h2 id="成功验证"><a href="#成功验证" class="headerlink" title="成功验证"></a>成功验证</h2>
                  <p>有失败就有成功，在这里我们可以用一个函数来实现成功的验证</p>
                  <figure class="highlight subunit">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">success: </span>function(label) &#123;</span><br><span class="line">label.html("OK");</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这里的label指的是发生错误时那个标签，就是上面例子中的span，通过html()方法可以实现标签内容的变化。例如下面的例子</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">&lt;!DOCTYPE&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>validate验证插件<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> </span></span><br><span class="line"><span class="tag">            <span class="attr">src</span>=<span class="string">"http://res.cuiqingcai.com/js/jquery.min.js"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> </span></span><br><span class="line"><span class="tag">            <span class="attr">src</span>=<span class="string">"http://res.cuiqingcai.com/js/jquery.validate.js"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> </span></span><br><span class="line"><span class="tag">            <span class="attr">src</span>=<span class="string">"http://res.cuiqingcai.com/js/jquery.validate.messages_cn.js"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"http://res.cuiqingcai.com/jqplugins/validate/style.css"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">        $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            $(<span class="string">"#frmV"</span>).validate(</span></span><br><span class="line">              &#123;</span><br><span class="line"><span class="actionscript">                  <span class="comment">/*自定义验证规则*/</span></span></span><br><span class="line">                  rules: &#123;</span><br><span class="line"><span class="actionscript">					  username: &#123; required: <span class="literal">true</span>, minlength: <span class="number">6</span> &#125;,</span></span><br><span class="line"><span class="actionscript">                      email: &#123; required: <span class="literal">true</span>, email: <span class="literal">true</span> &#125;</span></span><br><span class="line">                  &#125;,</span><br><span class="line"><span class="actionscript">                  <span class="comment">/*错误提示位置*/</span></span></span><br><span class="line"><span class="actionscript">                  errorPlacement: <span class="function"><span class="keyword">function</span><span class="params">(error, element)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">                      error.appendTo(element.siblings(<span class="string">"span"</span>));</span></span><br><span class="line">                  &#125;,</span><br><span class="line">				  messages: &#123;</span><br><span class="line"><span class="actionscript">					  username: &#123; required: <span class="string">"请输入姓名"</span>, minlength: <span class="string">"长度不可小于6"</span> &#125;,</span></span><br><span class="line"><span class="actionscript">                      email: &#123; required: <span class="string">"请输入电子邮件"</span>, email: <span class="string">"请输入正确格式"</span> &#125;</span></span><br><span class="line">				  &#125;,</span><br><span class="line"><span class="actionscript">				  success: <span class="function"><span class="keyword">function</span><span class="params">(label)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">					  label.html(<span class="string">"OK"</span>);</span></span><br><span class="line">				  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            );</span><br><span class="line">        &#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"frmV"</span> <span class="attr">method</span>=<span class="string">"get"</span> <span class="attr">action</span>=<span class="string">"#"</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"divFrame"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"divTitle"</span>&gt;</span></span><br><span class="line">              请输入下列资料</span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"divContent"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">              用户名：<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"username"</span> <span class="attr">name</span>=<span class="string">"username"</span> </span></span><br><span class="line"><span class="tag">                     <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"txt"</span> /&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">"red"</span>&gt;</span>*<span class="tag">&lt;/<span class="name">font</span>&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span>&gt;</span>呵呵<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">              邮箱：<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"email"</span> <span class="attr">name</span>=<span class="string">"email"</span> </span></span><br><span class="line"><span class="tag">                     <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"txt"</span> /&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">"red"</span>&gt;</span>*<span class="tag">&lt;/<span class="name">font</span>&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"divBtn"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"sbtUser"</span> <span class="attr">type</span>=<span class="string">"submit"</span> </span></span><br><span class="line"><span class="tag">                     <span class="attr">value</span>=<span class="string">"提交"</span> <span class="attr">class</span>=<span class="string">"btn"</span> /&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>上面就是验证成功之后的效果，在相应提示的地方会显示OK。</p>
                  <h2 id="异步验证"><a href="#异步验证" class="headerlink" title="异步验证"></a>异步验证</h2>
                  <p>有时候我们需要用到异步验证，我们可以在rules中加入remote进行远程验证，例子如下</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="meta">&lt;!DOCTYPE&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>validate验证插件<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> </span></span><br><span class="line"><span class="tag">            <span class="attr">src</span>=<span class="string">"http://res.cuiqingcai.com/js/jquery.min.js"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> </span></span><br><span class="line"><span class="tag">            <span class="attr">src</span>=<span class="string">"http://res.cuiqingcai.com/js/jquery.validate.js"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> </span></span><br><span class="line"><span class="tag">            <span class="attr">src</span>=<span class="string">"http://res.cuiqingcai.com/js/jquery.validate.messages_cn.js"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"http://res.cuiqingcai.com/jqplugins/validate/style.css"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">        $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            $(<span class="string">"#frmV"</span>).validate(</span></span><br><span class="line">				&#123;</span><br><span class="line"><span class="actionscript">					<span class="comment">/*自定义验证规则*/</span></span></span><br><span class="line">					rules: &#123; </span><br><span class="line"><span class="actionscript">						username: &#123; required: <span class="literal">true</span>, minlength: <span class="number">6</span> &#125;,</span></span><br><span class="line">						phone: &#123; </span><br><span class="line"><span class="actionscript">							required: <span class="literal">true</span>, </span></span><br><span class="line">							remote:&#123;</span><br><span class="line"><span class="actionscript">								url: <span class="string">"check_phone.php"</span>,     <span class="comment">//后台处理程序</span></span></span><br><span class="line"><span class="actionscript">								type: <span class="string">"post"</span>,               <span class="comment">//数据发送方式</span></span></span><br><span class="line"><span class="actionscript">								dataType: <span class="string">"json"</span>,           <span class="comment">//接受数据格式   </span></span></span><br><span class="line"><span class="actionscript">								data: &#123;                     <span class="comment">//要传递的数据</span></span></span><br><span class="line"><span class="actionscript">									phone: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span></span><br><span class="line"><span class="javascript">										<span class="keyword">return</span> $(<span class="string">"#phone"</span>).val();</span></span><br><span class="line">									&#125;</span><br><span class="line">								&#125;</span><br><span class="line">							&#125;</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;,</span><br><span class="line"><span class="actionscript">					<span class="comment">/*错误提示位置*/</span></span></span><br><span class="line"><span class="actionscript">					errorPlacement: <span class="function"><span class="keyword">function</span><span class="params">(error, element)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">					  error.appendTo(element.siblings(<span class="string">"span"</span>));</span></span><br><span class="line">					&#125;,</span><br><span class="line">					messages: &#123;</span><br><span class="line"><span class="actionscript">					  username: &#123; required: <span class="string">"请输入姓名"</span>, minlength: <span class="string">"长度不可小于6"</span> &#125;,</span></span><br><span class="line"><span class="actionscript">					  phone: &#123; required: <span class="string">"请输入电话"</span>, remote: <span class="string">"请输入正确格式"</span> &#125;</span></span><br><span class="line">					&#125;,</span><br><span class="line"><span class="actionscript">					success: <span class="function"><span class="keyword">function</span><span class="params">(label)</span> </span>&#123;</span></span><br><span class="line"><span class="actionscript">					  label.html(<span class="string">"OK"</span>);</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">            );</span><br><span class="line">        &#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"frmV"</span> <span class="attr">method</span>=<span class="string">"get"</span> <span class="attr">action</span>=<span class="string">"#"</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"divFrame"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"divTitle"</span>&gt;</span></span><br><span class="line">              请输入下列资料</span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"divContent"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">              用户名：<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"username"</span> <span class="attr">name</span>=<span class="string">"username"</span> </span></span><br><span class="line"><span class="tag">                     <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"txt"</span> /&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">"red"</span>&gt;</span>*<span class="tag">&lt;/<span class="name">font</span>&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">              电话号码：<span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"phone"</span> <span class="attr">name</span>=<span class="string">"phone"</span> </span></span><br><span class="line"><span class="tag">                     <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"txt"</span> /&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">"red"</span>&gt;</span>*<span class="tag">&lt;/<span class="name">font</span>&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"divBtn"</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"sbtUser"</span> <span class="attr">type</span>=<span class="string">"submit"</span> </span></span><br><span class="line"><span class="tag">                     <span class="attr">value</span>=<span class="string">"提交"</span> <span class="attr">class</span>=<span class="string">"btn"</span> /&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>PHP处理程序，注意这里的返回值只能是true或者false，并且需要加引号。</p>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="php"><span class="meta">&lt;?php</span> </span></span><br><span class="line"><span class="php">	$phone = $_POST[<span class="string">'phone'</span>];</span></span><br><span class="line"><span class="php">	<span class="keyword">if</span>((strlen($phone) != <span class="number">11</span>) || !(preg_match(<span class="string">"/13[0123456789]&#123;1&#125;\d&#123;8&#125;|15[012356789]\d&#123;8&#125;|18[0123456789]\d&#123;8&#125;|17[0678]\d&#123;8&#125;|14[57]\d&#123;8&#125;/"</span>,$phone)))&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">echo</span> <span class="string">"false"</span>;</span></span><br><span class="line"><span class="php">	 &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">echo</span> <span class="string">"true"</span>;</span></span><br><span class="line"><span class="php">	 &#125;</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>演示如下 上面就是进行ajax异步验证的处理方式</p>
                  <h2 id="自定义方法"><a href="#自定义方法" class="headerlink" title="自定义方法"></a>自定义方法</h2>
                  <p>有时候我们需要自定义一些验证方法，我们就需要用到addMethod方法，介绍如下 addMethod(name,method,message)方法</p>
                  <blockquote>
                    <p>参数name 是添加的方法的名字 参数method是一个函数,接收三个参数(value,element,param) value 是元素的值,element是元素本身 param是参数,我们可以用addMethod 来添加除built-in Validation methods 之外的验证方法</p>
                  </blockquote>
                  <p>例如手机号码的验证如下</p>
                  <figure class="highlight angelscript">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">$.validator.addMethod(<span class="string">"phone"</span>,function(value,element,params)&#123;</span><br><span class="line">		 <span class="keyword">if</span>((value.length != <span class="number">11</span>) || (!value.match(/^(<span class="number">13</span>[<span class="number">0</span><span class="number">-9</span>]|<span class="number">14</span>[<span class="number">5</span>|<span class="number">7</span>]|<span class="number">15</span>[<span class="number">0</span>|<span class="number">1</span>|<span class="number">2</span>|<span class="number">3</span>|<span class="number">5</span>|<span class="number">6</span>|<span class="number">7</span>|<span class="number">8</span>|<span class="number">9</span>]|<span class="number">17</span>[<span class="number">0</span>|<span class="number">6</span>|<span class="number">7</span>|<span class="number">8</span>]|<span class="number">18</span>[<span class="number">0</span><span class="number">-9</span>])\d&#123;<span class="number">8</span>&#125;$/)))&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		 &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;,<span class="string">"请输入正确的手机号"</span>);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>使用时如下</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">rules</span>:&#123;</span><br><span class="line">			<span class="attribute">phone</span>:&#123;</span><br><span class="line">				required:true,phone:true</span><br><span class="line">			&#125;,</span><br><span class="line">		&#125;,</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>有一个字段,只能输一个字母,范围是a-f,写法如下</p>
                  <figure class="highlight cs">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">$.validator.addMethod(“af”,function(<span class="keyword">value</span>,element,<span class="keyword">params</span>)&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">value</span>.length&gt;<span class="number">1</span>)&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">value</span>&gt;=<span class="keyword">params</span>[<span class="number">0</span>] &amp;&amp; <span class="keyword">value</span>&lt;=<span class="keyword">params</span>[<span class="number">1</span>])&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;,”必须是一个字母,且a-f”);</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>使用时如下</p>
                  <figure class="highlight css">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="selector-tag">rules</span>:&#123;</span><br><span class="line">			<span class="attribute">username</span>:&#123; af:[<span class="string">"a"</span>,<span class="string">"f"</span>] &#125;</span><br><span class="line">		&#125;,</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>以上便是自定义验证方法的方式</p>
                  <h2 id="DeBug模式"><a href="#DeBug模式" class="headerlink" title="DeBug模式"></a>DeBug模式</h2>
                  <p>开启DeBug模式后，不会进行提交，只需要在代码中加入</p>
                  <figure class="highlight d">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="keyword">debug</span>:<span class="literal">true</span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>即可，这样不论怎样，都不会提交表单，对于调试十分有用。</p>
                  <h2 id="验证通过提交"><a href="#验证通过提交" class="headerlink" title="验证通过提交"></a>验证通过提交</h2>
                  <p>在上面的例子中，我们没有设置表单验证通过之后才提交，通过加入以下代码，可以实现验证之后才提交的效果</p>
                  <figure class="highlight fortran">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">submitHandler:<span class="function"><span class="keyword">function</span><span class="params">(form)</span></span>&#123; </span><br><span class="line"><span class="keyword">form</span>.submit();</span><br><span class="line">&#125;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过设置上面的内容，我们就可以避免验证不成功submit跳转了</p>
                  <h2 id="忽略元素"><a href="#忽略元素" class="headerlink" title="忽略元素"></a>忽略元素</h2>
                  <p>有时候，我们想跳过某些元素不进行验证，可以通过加入如下代码来实现，举例如下</p>
                  <figure class="highlight avrasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">ignore:</span><span class="string">"input"</span>,</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>忽略所有input元素</p>
                  <figure class="highlight avrasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">ignore:</span><span class="string">"#username"</span>,</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>忽略id为username的元素</p>
                  <figure class="highlight avrasm">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="symbol">ignore:</span><span class="string">".input"</span>,</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>忽略所有class为input的元素</p>
                  <h2 id="响应事件"><a href="#响应事件" class="headerlink" title="响应事件"></a>响应事件</h2>
                  <p>在默认的响应事件是 submit 提交事件，我们还可以通过设置来改变事件的响应，比如失去焦点时验证等等，举例如下 Onubmit：类型 Boolean，默认 true，指定是否提交时验证。</p>
                  <figure class="highlight arcade">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">$(<span class="string">".selector"</span>).validate(&#123;   	<span class="attr">onsubmit</span>:<span class="literal">false</span> &#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>onfocusout：类型 Boolean，默认 true，指定是否在获取焦点时验证。</p>
                  <figure class="highlight arcade">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">$(<span class="string">".selector"</span>).validate(&#123;     <span class="attr">onfocusout</span>:<span class="literal">false</span> &#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>onkeyup：类型 Boolean，默认 true，指定是否在敲击键盘时验证。</p>
                  <figure class="highlight arcade">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">$(<span class="string">".selector"</span>).validate(&#123;    <span class="attr">onkeyup</span>:<span class="literal">false</span> &#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>onclick：类型 Boolean，默认 true，指定是否在鼠标点击时验证（一般验证 checkbox、radiobox）。</p>
                  <figure class="highlight arcade">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">$(<span class="string">".selector"</span>).validate(&#123;    <span class="attr">onclick</span>:<span class="literal">false</span> &#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>focusInvalid：类型 Boolean，默认 true。提交表单后，未通过验证的表单（第一个或提交之前获得焦点的未通过验证的表单）会获得焦点。</p>
                  <figure class="highlight arcade">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">$(<span class="string">".selector"</span>).validate(&#123;    <span class="attr">focusInvalid</span>:<span class="literal">false</span> &#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>focusCleanup：类型 Boolean，默认 false。当未通过验证的元素获得焦点时，移除错误提示（避免和 focusInvalid 一起使用）。</p>
                  <figure class="highlight arcade">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">$(<span class="string">".selector"</span>).validate(&#123;    <span class="attr">focusCleanup</span>:<span class="literal">true</span> &#125;)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>上面的响应事件一般不太常用，仅作了解即可。</p>
                  <h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2>
                  <p>以上便是jQuery插件validate的用法，利用好这款插件对于编写将有极其大的帮助，希望大家能好好学习！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-04-04 20:50:38" itemprop="dateCreated datePublished" datetime="2015-04-04T20:50:38+08:00">2015-04-04</time>
                </span>
                <span id="/1544.html" class="post-meta-item leancloud_visitors" data-flag-title="jQuery应用一之验证插件validate的使用" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>13k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>12 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1547.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> 个人随笔 <i class="label-arrow"></i>
                  </a>
                  <a href="/1547.html" class="post-title-link" itemprop="url">致那逝去的三月</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <p>4月4日，凌晨3点，我依旧无法入眠，心里想了很多，索性起床把现在的所想记录下来。也许，在一觉过后，这些情感或许就无法挥洒出来了。现在，借着那纯音乐，借着那静谧的夜，总结一下那逝去的三月。 三月一日开学，到现在已经有了一个月多一点的时间了，都说大三下是最难熬的一段时光，亲身经历之后才觉得真的是这样，这一个月，可以用浮躁两个字来形容。 浮躁之处在哪？学习，面试，备考，社交，做事还有其他，浮躁之气充斥在方方面面。 大三开始，不得不去考虑工作或是读研的事情，身边的朋友们，有的选择考研，有的选择工作。室友三个，选择的也都是工作。开学之初，各大公司的校招纷纷开始了，朋友们纷纷开始往各大公司投简历，BAT也不例外。当然BAT终究是BAT，不是省油的灯，一些朋友就在这条道路上遭遇了不少的坎坷，有的简历初审就被PASS，有的电面几轮之后也不幸失败，过程非常坎坷。其中有些朋友一份简历投上几十家公司，想碰运气，录用上哪一个是哪一个，而在我看来，这真的没有太大的意义。投一个公司，对该公司有全面的了解是至关重要，而且公司的理念文化适不适合自己去工作也是一个重要的因素，在我看来，这种碰运气的方法，实不可取。 而对于我自己，更加倾向于读研，鉴于自己的学习成绩还算不错，前百分之五，想申请一下保研，查找了各大学校的招生信息，对自己要复习和准备的东西也有了一些把握，可这一个月以来，自己难以静心去学习。其实说来，周围的朋友纷纷在准备找工作实习，而他们的焦点则就放在了填补一些职业相关的专业知识，掌握一些面试技巧，他们一轮轮的电面，也为自己的工作积累了经验。而我，也在想在大四的时候申请一份实习工作，就算没有拿到Offer，在面试的过程中也能积累一部分的经验，索性我也去试试吧。 制作了自己的一份简历，我也投上了BAT和一些其他公司，因为我本身对网页开发比较了解，尤其是后端开发，PHP部分。而像阿里这样的公司，他们的后端不是利用PHP处理的，所以我就报了前端开发的职位。但是自己的前端功底还不太强，所以我就开始补习JS，jQuery等等的知识，这一个月以来，大多数时间就在学习这些知识。对于找工作我可以说是试一试的态度，学习起来感觉沉不住气，而且可能觉得随时会有一个电话面试打过来，所以我觉得难以系统地，静心地去学习这些知识。 其实周围的朋友和我的情况是差不多的，我特意问过他们最近是怎样的状态，他们也回应说，感觉有些浮躁，完全是在一个应试的压力下在学习，对于一些知识只是修修补补，没有一个系统的把握。仔细想想，真的是这样，他们的路就是工作，谁也想进一个更好的公司，所以他们也在尽力提升着自己，可事实却是，太浮躁。 除了这些，我真的觉得在其他方面也应该好好反思一下自己。 这一个月的作息非常乱，在寒假时曾经做过打算，早睡早起，可慢慢地，睡得越来越晚，同样，起得也越来越晚。开学的前几天，坚持12点之前入睡，可慢慢地，拖到凌晨一两点钟才睡，而理所应当地，早上就难以起床，早起了也还是觉得萎靡不振。最初课程比较少，而且都集中在周二这一天，所以，除了周二，几乎每天都有机会睡个懒觉，由于这个原因，自己也经常早上起得很晚，有时甚至起床就是中午吃饭的时间了。这么一来，一上午的时光岂不是白白浪费了吗？这样的结果归咎于什么？我想，是自己的毅力问题，难以持之以恒，难以律己。 开学以来一个最不让我后悔的决定就是，健身。曾经的时候，一天没有什么活动，就坐在那学习，娱乐，一坐一玩就是一整天，自己的身体确实也难以承受得了，处在一个亚健康状态。开学之初，和好朋友一起去了学校对面的健身馆去办了一张健身年卡，几乎每天我们都去练上一个多小时，互相督促，一起锻炼。我的目标是增肌，自己真的是太瘦了，在健身房，跑上几千米后，尝试各种健身器材，锻炼胸肌等等，另外还有一套腹肌撕裂者的动作，几乎每天都这么坚持做下来。一个月的时间说长也长，说短也短，自己本身太瘦，也在努力多吃，不过现在腹肌和胸肌还没有明显的迹象。不管怎样，坚持长期练下去吧，我相信会有成果的。 另外，在待人处事方面，还是觉得自己不够稳重，现在是21岁了，也该变得成熟些了。在言谈举止方面，现在回想起这一个月自己曾经做过的事，真的有些好幼稚，好可笑。我想，尝试着去变得更稳重，考虑事情更加周全，做事更加细致，结果一定更好。 过去的一个月，我大部分时间都是在宿舍，学习啊，娱乐啊，都是宅在那里，室友也是一样。现在觉得，的确是有些懒散了，而且懒散得效率低下，作息不规律。清明回去之后，是该换一种学习环境了，找一个安静的自习室，在那里看看书，敲敲代码。学习累了，听听音乐，出去走走，望一望周围同学努力的身影，去感受一下这样的状态，告别懒散的生活方式，大胆做一番新的尝试吧。而且，是时候为自己的保研做好好的准备了，专业课知识，英语，真的挺重要。 最后，想说几句话。 为了自己的梦想和所喜欢的事而努力，这份动力是发自内心的。 一个成熟的人，有一颗强大的内心，有一种强大的毅力，做事稳重，注重细节，让自己变得更加稳重和成熟吧。 在做每一件事之前，好好想想怎样可以把这件事做得更好，好好想想自己以后会不会为自己的所作而感到后悔。 让自己变得更优秀，好好经营自己，自己所想要的，说不定会随之而来。 现在凌晨四点十九，写完之后，心中一丝畅然，晚安，世界。</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-04-04 04:21:08" itemprop="dateCreated datePublished" datetime="2015-04-04T04:21:08+08:00">2015-04-04</time>
                </span>
                <span id="/1547.html" class="post-meta-item leancloud_visitors" data-flag-title="致那逝去的三月" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>2.2k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>2 分钟</span>
                </span>
              </div>
            </article>
            <article itemscope itemtype="http://schema.org/Article" class="post-block index" lang="zh-CN">
              <link itemprop="mainEntityOfPage" href="https://cuiqingcai.com/1534.html">
              <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
                <meta itemprop="image" content="/images/avatar.png">
                <meta itemprop="name" content="崔庆才">
                <meta itemprop="description" content="静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。">
              </span>
              <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
                <meta itemprop="name" content="静觅">
              </span>
              <header class="post-header">
                <h2 class="post-title" itemprop="name headline">
                  <a class="label"> PHP <i class="label-arrow"></i>
                  </a>
                  <a href="/1534.html" class="post-title-link" itemprop="url">PHP高级特性八之mysqli函数库的使用</a>
                </h2>
              </header>
              <div class="post-body" itemprop="articleBody">
                <div class="thumb">
                  <img itemprop="contentUrl" class="random">
                </div>
                <div class="excerpt">
                  <p>
                  <h2 id="综述"><a href="#综述" class="headerlink" title="综述"></a>综述</h2>
                  <h3 id="1-什么是mysqli"><a href="#1-什么是mysqli" class="headerlink" title="1.什么是mysqli"></a>1.什么是mysqli</h3>
                  <p>PHP-MySQL 函数库是 PHP 操作 MySQL 资料库最原始的扩展库，PHP-MySQLi 的 i 代表 Improvement ，相当于前者的增强版，也包含了相对进阶的功能，另外本身也增加了安全性，比如可以大幅度减少 SQL 注入等问题的发生。</p>
                  <h3 id="2-mysql与mysqli的概念相关"><a href="#2-mysql与mysqli的概念相关" class="headerlink" title="2. mysql与mysqli的概念相关"></a>2. mysql与mysqli的概念相关</h3>
                  <p>（1）mysql与mysqli都是php方面的函数集，与mysql数据库关联不大。 （2）在php5版本之前，一般是用php的mysql函数去驱动mysql数据库的，比如mysql_query()的函数，属于面向过程 （3）在php5版本以后，增加了mysqli的函数功能，某种意义上讲，它是mysql系统函数的增强版，更稳定更高效更安全，与mysql_query()对应的有mysqli_query()，属于面向对象，用对象的方式操作驱动mysql数据库</p>
                  <h3 id="3-mysql与mysqli的主要区别"><a href="#3-mysql与mysqli的主要区别" class="headerlink" title="3. mysql与mysqli的主要区别"></a>3. mysql与mysqli的主要区别</h3>
                  <p>（1）mysql是非持继连接函数，mysql每次链接都会打开一个连接的进程，所以mysqli耗费资源少一些。 （2）mysqli是永远连接函数，mysqli多次运行mysqli将使用同一连接进程,从而减少了服务器的开销。mysqli封装了诸如事务等一些高级操作，同时封装了DB操作过程中的很多可用的方法。 （3）mysqli提供了面向对象编程方式和面向过程编程方式，而mysql则只可以面向过程。 例如如下代码分别是mysqli的面向对象编程方式和面向过程方式 面向对象方式</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;?php</span><br><span class="line"><span class="variable">$mysqli</span> = new mysqli(<span class="string">"localhost"</span>, <span class="string">"my_user"</span>, <span class="string">"my_password"</span>, <span class="string">"world"</span>);</span><br><span class="line"></span><br><span class="line"><span class="regexp">/* check connection */</span> </span><br><span class="line"><span class="keyword">if</span> (mysqli_connect_errno()) &#123;</span><br><span class="line">    printf(<span class="string">"Connect failed: %s\n"</span>, mysqli_connect_error());</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">printf(<span class="string">"Host information: %s\n"</span>, <span class="variable">$mysqli</span>-&gt;host_info);</span><br><span class="line"></span><br><span class="line"><span class="regexp">/* close connection */</span></span><br><span class="line"><span class="variable">$mysqli</span>-&gt;close();</span><br><span class="line">?&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>面向过程方式</p>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;?php</span><br><span class="line"><span class="variable">$link</span> = mysqli_connect(<span class="string">"localhost"</span>, <span class="string">"my_user"</span>, <span class="string">"my_password"</span>, <span class="string">"world"</span>);</span><br><span class="line"></span><br><span class="line"><span class="regexp">/* check connection */</span> </span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$link</span>) &#123;</span><br><span class="line">    printf(<span class="string">"Connect failed: %s\n"</span>, mysqli_connect_error());</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">printf(<span class="string">"Host information: %s\n"</span>, mysqli_get_host_info(<span class="variable">$link</span>));</span><br><span class="line"></span><br><span class="line"><span class="regexp">/* close connection */</span></span><br><span class="line">mysqli_close(<span class="variable">$link</span>);</span><br><span class="line">?&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>（4）mysqli 可以通过预处理语句来减少开销和SQL注入的风险，而mysql则做不到。 <strong>综上所述，如果大家用的是PHP5，而且mysql版本在5.0以上，希望大家以后能用mysqli的就尽量使用mqsqli，不仅高效，而且更安全，而且推荐大家使用面向对象编程方式。</strong> 在这里，我们也只介绍面向对象编程方式。</p>
                  <h2 id="函数使用"><a href="#函数使用" class="headerlink" title="函数使用"></a>函数使用</h2>
                  <h3 id="1-连接数据库并获取相关信息"><a href="#1-连接数据库并获取相关信息" class="headerlink" title="1. 连接数据库并获取相关信息"></a>1. 连接数据库并获取相关信息</h3>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">	$mysqli=@<span class="keyword">new</span> mysqli(<span class="string">"localhost"</span>, <span class="string">"root"</span>, <span class="string">""</span>, <span class="string">"mysql"</span>);</span></span><br><span class="line"><span class="php">	<span class="comment">//如果连接错误</span></span></span><br><span class="line"><span class="php">	<span class="keyword">if</span>(mysqli_connect_errno())&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">echo</span> <span class="string">"连接数据库失败："</span>.mysqli_connect_error();</span></span><br><span class="line"><span class="php">		$mysqli=<span class="keyword">null</span>;</span></span><br><span class="line"><span class="php">		<span class="keyword">exit</span>;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	<span class="comment">//获取当前字符集</span></span></span><br><span class="line"><span class="php">	<span class="keyword">echo</span> $mysqli-&gt;character_set_name().<span class="string">"&lt;br&gt;"</span>;</span></span><br><span class="line"><span class="php">	<span class="comment">//获取客户端信息</span></span></span><br><span class="line"><span class="php">	<span class="keyword">echo</span> $mysqli-&gt;get_client_info().<span class="string">"&lt;br&gt;"</span>;</span></span><br><span class="line"><span class="php">	<span class="comment">//获取mysql主机信息</span></span></span><br><span class="line"><span class="php">	<span class="keyword">echo</span> $mysqli-&gt;host_info.<span class="string">"&lt;br&gt;"</span>;</span></span><br><span class="line"><span class="php">	<span class="comment">//获取服务器信息</span></span></span><br><span class="line"><span class="php">	<span class="keyword">echo</span> $mysqli-&gt;server_info.<span class="string">"&lt;br&gt;"</span>;</span></span><br><span class="line"><span class="php">	<span class="comment">//获取服务器版本</span></span></span><br><span class="line"><span class="php">	<span class="keyword">echo</span> $mysqli-&gt;server_version.<span class="string">"&lt;br&gt;"</span>;</span></span><br><span class="line"><span class="php">	<span class="comment">//关闭数据库连接</span></span></span><br><span class="line"><span class="php">	$mysqli-&gt;close();</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果连接成功则运行结果</p>
                  <blockquote>
                    <p>latin1 mysqlnd 5.0.10 - 20111026 - $Id: e707c415db32080b3752b232487a435ee0372157 $ localhost via TCP/IP 5.6.12-log 50612</p>
                  </blockquote>
                  <p>如果连接失败则可能结果为</p>
                  <blockquote>
                    <p>连接数据库失败：Access denied for user ‘root’@’localhost’ (using password: YES) 连接数据库失败：Unknown database ‘hello’</p>
                  </blockquote>
                  <h3 id="2-查询数据"><a href="#2-查询数据" class="headerlink" title="2.查询数据"></a>2.查询数据</h3>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">	$mysqli=@<span class="keyword">new</span> mysqli(<span class="string">"localhost"</span>, <span class="string">"root"</span>, <span class="string">""</span>, <span class="string">"design"</span>);</span></span><br><span class="line"><span class="php">	<span class="comment">//如果连接错误</span></span></span><br><span class="line"><span class="php">	<span class="keyword">if</span>(mysqli_connect_errno())&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">echo</span> <span class="string">"连接数据库失败："</span>.mysqli_connect_error();</span></span><br><span class="line"><span class="php">		$mysqli=<span class="keyword">null</span>;</span></span><br><span class="line"><span class="php">		<span class="keyword">exit</span>;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	<span class="comment">//构造SQL语句</span></span></span><br><span class="line"><span class="php">	$query = <span class="string">"SELECT * FROM  designer order by ID LIMIT 3"</span>;</span></span><br><span class="line"><span class="php">	<span class="comment">//执行SQL语句</span></span></span><br><span class="line"><span class="php">	$result = $mysqli-&gt;query($query);</span></span><br><span class="line"><span class="php">	<span class="comment">//遍历结果</span></span></span><br><span class="line"><span class="php">	<span class="keyword">while</span>($row = $result-&gt;fetch_array(MYSQLI_BOTH))&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">echo</span> <span class="string">"id"</span>.$row[<span class="string">'id'</span>].<span class="string">"&lt;br&gt;"</span>;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	<span class="comment">//释放结果集</span></span></span><br><span class="line"><span class="php">	$result-&gt;free();</span></span><br><span class="line"><span class="php">	<span class="comment">//关闭数据库连接</span></span></span><br><span class="line"><span class="php">	$mysqli-&gt;close();</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>运行结果</p>
                  <figure class="highlight">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">id10062</span><br><span class="line">id10063</span><br><span class="line">id10064</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>在这里需要注意的是</p>
                  <figure class="highlight stylus">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="function"><span class="title">fetch_array</span><span class="params">(MYSQLI_BOTH)</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>这个方法，参数有三个，分别是 MYSQLI_BOTH，MYSQLI_NUM，MYSQLI_ASSOC。 如果参数传入了 MYSQLI_BOTH，返回数组的索引既包括数字和名称。</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">array (<span class="attribute">size</span>=26)</span><br><span class="line">  0 =&gt; string <span class="string">'10062'</span> (<span class="attribute">length</span>=5)</span><br><span class="line">  <span class="string">'id'</span> =&gt; string <span class="string">'10062'</span> (<span class="attribute">length</span>=5)</span><br><span class="line">  1 =&gt; string <span class="string">'??'</span> (<span class="attribute">length</span>=2)</span><br><span class="line">  <span class="string">'name'</span> =&gt; string <span class="string">'??'</span> (<span class="attribute">length</span>=2)</span><br><span class="line">  2 =&gt; string <span class="string">'1016903103@qq.com'</span> (<span class="attribute">length</span>=17)</span><br><span class="line">  <span class="string">'email'</span> =&gt; string <span class="string">'1016903103@qq.com'</span> (<span class="attribute">length</span>=17)</span><br><span class="line">  3 =&gt; string <span class="string">'18366119732'</span> (<span class="attribute">length</span>=11)</span><br><span class="line">  <span class="string">'phone'</span> =&gt; string <span class="string">'18366119732'</span> (<span class="attribute">length</span>=11)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果参数传入了 MYSQLI_NUM，返回数组的索引只包含数字。</p>
                  <figure class="highlight lsl">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">array (size=<span class="number">13</span>)</span><br><span class="line">  <span class="number">0</span> =&gt; <span class="type">string</span> '<span class="number">10062</span>' (length=<span class="number">5</span>)</span><br><span class="line">  <span class="number">1</span> =&gt; <span class="type">string</span> '??' (length=<span class="number">2</span>)</span><br><span class="line">  <span class="number">2</span> =&gt; <span class="type">string</span> '<span class="number">1016903103</span>@qq.com' (length=<span class="number">17</span>)</span><br><span class="line">  <span class="number">3</span> =&gt; <span class="type">string</span> '<span class="number">18366119732</span>' (length=<span class="number">11</span>)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果参数传入了 MYSQLI_BOTH，返回数组的索引只包含名称。</p>
                  <figure class="highlight routeros">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">array (<span class="attribute">size</span>=13)</span><br><span class="line">  <span class="string">'id'</span> =&gt; string <span class="string">'10062'</span> (<span class="attribute">length</span>=5)</span><br><span class="line">  <span class="string">'name'</span> =&gt; string <span class="string">'??'</span> (<span class="attribute">length</span>=2)</span><br><span class="line">  <span class="string">'email'</span> =&gt; string <span class="string">'1016903103@qq.com'</span> (<span class="attribute">length</span>=17)</span><br><span class="line">  <span class="string">'phone'</span> =&gt; string <span class="string">'18366119732'</span> (<span class="attribute">length</span>=11)</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>其实还有等价的方法 fetch_row()，fetch_assoc()</p>
                  <p>他们之间的关系如下</p>
                  <blockquote>
                    <p>$result-&gt;fetch_row() = mysql_fetch_row() = $result-&gt;fetch_array(MYSQLI_NUM) = mysql_fetch_array(MYSQLI_NUM) 返回索引数组</p>
                    <p>$result-&gt;fetch_assoc() = mysql_fetch_assoc() = $result-&gt;fetch_array(MYSQLI_ASSOC) = mysql_fetch_array(MYSQLI_ASSOC) 返回索引列名</p>
                  </blockquote>
                  <p>如果 fetch_array()方法什么也不传，则默认传入了 MYSQLI_BOTH</p>
                  <h3 id="3-插入数据"><a href="#3-插入数据" class="headerlink" title="3.插入数据"></a>3.插入数据</h3>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;?php</span><br><span class="line">	<span class="variable">$mysqli</span>=@new mysqli(<span class="string">"localhost"</span>, <span class="string">"root"</span>, <span class="string">""</span>, <span class="string">"design"</span>);</span><br><span class="line">	<span class="regexp">//</span>如果连接错误</span><br><span class="line">	<span class="keyword">if</span>(mysqli_connect_errno())&#123;</span><br><span class="line">		echo <span class="string">"连接数据库失败："</span>.mysqli_connect_error();</span><br><span class="line">		<span class="variable">$mysqli</span>=null;</span><br><span class="line">		<span class="keyword">exit</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="regexp">//</span>插入数据</span><br><span class="line">	<span class="variable">$sql</span>=<span class="string">"insert into designer(name,phone) values('hello','18352682923')"</span>;</span><br><span class="line">	<span class="regexp">//</span>执行插入语句</span><br><span class="line">	<span class="variable">$result</span>=<span class="variable">$mysqli</span>-&gt;query(<span class="variable">$sql</span>);</span><br><span class="line">	<span class="regexp">//</span>如果执行错误</span><br><span class="line">	<span class="keyword">if</span>(!<span class="variable">$result</span>)&#123;</span><br><span class="line">		echo <span class="string">"SQL语句有误&lt;br&gt;"</span>;</span><br><span class="line">		echo <span class="string">"ERROR:"</span>.<span class="variable">$mysqli</span>-&gt;errno.<span class="string">"|"</span>.<span class="variable">$mysqli</span>-&gt;error;</span><br><span class="line">		<span class="keyword">exit</span>;	</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="regexp">//</span>如果插入成功，则返回影响的行数</span><br><span class="line">	echo <span class="variable">$mysqli</span>-&gt;affected_rows;</span><br><span class="line">	<span class="regexp">//</span>关闭数据库连接</span><br><span class="line">	<span class="variable">$mysqli</span>-&gt;close();</span><br><span class="line">?&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果插入成功，那么结果则会是1，如果失败，则会报出错误。</p>
                  <h3 id="4-修改内容"><a href="#4-修改内容" class="headerlink" title="4.修改内容"></a>4.修改内容</h3>
                  <figure class="highlight awk">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">&lt;?php</span><br><span class="line">	<span class="variable">$mysqli</span>=@new mysqli(<span class="string">"localhost"</span>, <span class="string">"root"</span>, <span class="string">""</span>, <span class="string">"design"</span>);</span><br><span class="line">	<span class="regexp">//</span>如果连接错误</span><br><span class="line">	<span class="keyword">if</span>(mysqli_connect_errno())&#123;</span><br><span class="line">		echo <span class="string">"连接数据库失败："</span>.mysqli_connect_error();</span><br><span class="line">		<span class="variable">$mysqli</span>=null;</span><br><span class="line">		<span class="keyword">exit</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="regexp">//</span>插入数据</span><br><span class="line">	<span class="variable">$sql</span>=<span class="string">"update designer set name = 'hello' where id = 10062"</span>;</span><br><span class="line">	<span class="regexp">//</span>执行插入语句</span><br><span class="line">	<span class="variable">$result</span>=<span class="variable">$mysqli</span>-&gt;query(<span class="variable">$sql</span>);</span><br><span class="line">	<span class="regexp">//</span>如果执行错误</span><br><span class="line">	<span class="keyword">if</span>(!<span class="variable">$result</span>)&#123;</span><br><span class="line">		echo <span class="string">"SQL语句有误&lt;br&gt;"</span>;</span><br><span class="line">		echo <span class="string">"ERROR:"</span>.<span class="variable">$mysqli</span>-&gt;errno.<span class="string">"|"</span>.<span class="variable">$mysqli</span>-&gt;error;</span><br><span class="line">		<span class="keyword">exit</span>;	</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="regexp">//</span>如果插入成功，则返回影响的行数</span><br><span class="line">	echo <span class="variable">$mysqli</span>-&gt;affected_rows;</span><br><span class="line">	<span class="regexp">//</span>关闭数据库连接</span><br><span class="line">	<span class="variable">$mysqli</span>-&gt;close();</span><br><span class="line">?&gt;</span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>如果修改成功，同样返回被修改的行数。</p>
                  <h3 id="5-预处理语句"><a href="#5-预处理语句" class="headerlink" title="5.预处理语句"></a>5.预处理语句</h3>
                  <figure class="highlight xml">
                    <table>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php">	$mysqli = @<span class="keyword">new</span> mysqli(<span class="string">"localhost"</span>, <span class="string">"root"</span>, <span class="string">""</span>, <span class="string">"design"</span>);</span></span><br><span class="line"><span class="php">	<span class="comment">//如果连接错误</span></span></span><br><span class="line"><span class="php">	<span class="keyword">if</span>(mysqli_connect_errno())&#123;</span></span><br><span class="line"><span class="php">		<span class="keyword">echo</span> <span class="string">"连接数据库失败："</span>.mysqli_connect_error();</span></span><br><span class="line"><span class="php">		$mysqli=<span class="keyword">null</span>;</span></span><br><span class="line"><span class="php">		<span class="keyword">exit</span>;</span></span><br><span class="line"><span class="php">	&#125;</span></span><br><span class="line"><span class="php">	<span class="comment">//准备好一条语句放到服务器中，插入语句</span></span></span><br><span class="line"><span class="php">	$sql = <span class="string">"insert into designer(name, email) values(?, ?)"</span>;</span></span><br><span class="line"><span class="php">	<span class="comment">//生成预处理语句</span></span></span><br><span class="line"><span class="php">	$stmt = $mysqli-&gt;prepare($sql);</span></span><br><span class="line"><span class="php">	<span class="comment">//给占位符号每个?号传值（绑定参数） i  d  s  b，第一个参数为格式化字符，ss代表两个字符串，d代表数字</span></span></span><br><span class="line"><span class="php">	$stmt-&gt;bind_param(<span class="string">"ss"</span>, $name, $email);</span></span><br><span class="line"><span class="php">	<span class="comment">//为变量赋值</span></span></span><br><span class="line"><span class="php">	$name = <span class="string">"Mike"</span>;</span></span><br><span class="line"><span class="php">	$email = <span class="string">"mike@live.cn"</span>;</span></span><br><span class="line"><span class="php">	<span class="comment">//执行</span></span></span><br><span class="line"><span class="php">	$stmt-&gt;execute();</span></span><br><span class="line"><span class="php">	<span class="comment">//为变量赋值</span></span></span><br><span class="line"><span class="php">	$name = <span class="string">"Larry"</span>;</span></span><br><span class="line"><span class="php">	$email = <span class="string">"larry@live.cn"</span>;</span></span><br><span class="line"><span class="php">	<span class="comment">//执行</span></span></span><br><span class="line"><span class="php">	$stmt-&gt;execute();</span></span><br><span class="line"><span class="php">	<span class="comment">//最后输出</span></span></span><br><span class="line"><span class="php">	<span class="keyword">echo</span> <span class="string">"最后ID"</span>.$stmt-&gt;insert_id.<span class="string">"&lt;br&gt;"</span>;</span></span><br><span class="line"><span class="php">	<span class="keyword">echo</span> <span class="string">"影响了"</span>.$stmt-&gt;affected_rows.<span class="string">"行&lt;br&gt;"</span>;</span></span><br><span class="line"><span class="php">	<span class="comment">//关闭数据库连接</span></span></span><br><span class="line"><span class="php">	$mysqli-&gt;close();</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre>
                        </td>
                      </tr>
                    </table>
                  </figure>
                  <p>通过以上的预处理语句，我们也可以实现数据插入。 那么预处理语句有什么特点呢？</p>
                  <blockquote>
                    <p>1. 效率上更高， 就是如果执行多次相同的语句，只有语句数据不同， 因为将一条语句在服务器端准备好，然后将不同的值传给服务器，再让这条语句执行。相当于编译一次，使用多次。 2. 安全上：可以防止SQL注入（? 占位）这样就可以防止非正常的变量的注入。</p>
                  </blockquote>
                  <p>所以，推荐大家使用mysqli的预处理语句的方式，不仅效率高，而且更加安全。</p>
                  <h2 id="综述-1"><a href="#综述-1" class="headerlink" title="综述"></a>综述</h2>
                  <p>以上就是对mysqli的一些方法的介绍，更加详细的内容，请查看 PHP 手册。 希望对大家有帮助！</p>
                  </p>
                </div>
              </div>
              <div class="post-meta">
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-user"></i>
                  </span>
                  <span class="post-meta-item-text">作者</span>
                  <span><a href="/authors/崔庆才" class="author" itemprop="url" rel="index">崔庆才</a></span>
                </span>
                <span class="post-meta-item">
                  <span class="post-meta-item-icon">
                    <i class="far fa-calendar"></i>
                  </span>
                  <span class="post-meta-item-text">发表于</span>
                  <time title="创建时间：2015-03-30 17:04:27" itemprop="dateCreated datePublished" datetime="2015-03-30T17:04:27+08:00">2015-03-30</time>
                </span>
                <span id="/1534.html" class="post-meta-item leancloud_visitors" data-flag-title="PHP高级特性八之mysqli函数库的使用" title="阅读次数">
                  <span class="post-meta-item-icon">
                    <i class="fa fa-eye"></i>
                  </span>
                  <span class="post-meta-item-text">阅读次数：</span>
                  <span class="leancloud-visitors-count"></span>
                </span>
                <span class="post-meta-item" title="本文字数">
                  <span class="post-meta-item-icon">
                    <i class="far fa-file-word"></i>
                  </span>
                  <span class="post-meta-item-text">本文字数：</span>
                  <span>5.7k</span>
                </span>
                <span class="post-meta-item" title="阅读时长">
                  <span class="post-meta-item-icon">
                    <i class="far fa-clock"></i>
                  </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                  <span>5 分钟</span>
                </span>
              </div>
            </article>
            <script>
              document.querySelectorAll('.random').forEach(item => item.src = "https://picsum.photos/id/" + Math.floor(Math.random() * Math.floor(300)) + "/200/133")

            </script>
            <nav class="pagination">
              <a class="extend prev" rel="prev" href="/page/14/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><span class="page-number current">15</span><a class="page-number" href="/page/16/">16</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/16/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
            </nav>
          </div>
          <script>
            window.addEventListener('tabs:register', () =>
            {
              let
              {
                activeClass
              } = CONFIG.comments;
              if (CONFIG.comments.storage)
              {
                activeClass = localStorage.getItem('comments_active') || activeClass;
              }
              if (activeClass)
              {
                let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
                if (activeTab)
                {
                  activeTab.click();
                }
              }
            });
            if (CONFIG.comments.storage)
            {
              window.addEventListener('tabs:click', event =>
              {
                if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
                let commentClass = event.target.classList[1];
                localStorage.setItem('comments_active', commentClass);
              });
            }

          </script>
        </div>
        <div class="toggle sidebar-toggle">
          <span class="toggle-line toggle-line-first"></span>
          <span class="toggle-line toggle-line-middle"></span>
          <span class="toggle-line toggle-line-last"></span>
        </div>
        <aside class="sidebar">
          <div class="sidebar-inner">
            <ul class="sidebar-nav motion-element">
              <li class="sidebar-nav-toc"> 文章目录 </li>
              <li class="sidebar-nav-overview"> 站点概览 </li>
            </ul>
            <!--noindex-->
            <div class="post-toc-wrap sidebar-panel">
            </div>
            <!--/noindex-->
            <div class="site-overview-wrap sidebar-panel">
              <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <img class="site-author-image" itemprop="image" alt="崔庆才" src="/images/avatar.png">
                <p class="site-author-name" itemprop="name">崔庆才</p>
                <div class="site-description" itemprop="description">静觅丨崔庆才的个人站点专业为您提供爬虫教程,爬虫,Python,Python爬虫,Python爬虫教程,爬虫书的相关信息，想要了解更多详情，请联系我们。</div>
              </div>
              <div class="site-state-wrap motion-element">
                <nav class="site-state">
                  <div class="site-state-item site-state-posts">
                    <a href="/archives/">
                      <span class="site-state-item-count">685</span>
                      <span class="site-state-item-name">日志</span>
                    </a>
                  </div>
                  <div class="site-state-item site-state-categories">
                    <a href="/categories/">
                      <span class="site-state-item-count">32</span>
                      <span class="site-state-item-name">分类</span></a>
                  </div>
                  <div class="site-state-item site-state-tags">
                    <a href="/tags/">
                      <span class="site-state-item-count">246</span>
                      <span class="site-state-item-name">标签</span></a>
                  </div>
                </nav>
              </div>
              <div class="links-of-author motion-element">
                <span class="links-of-author-item">
                  <a href="https://github.com/Germey" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Germey" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
                </span>
                <span class="links-of-author-item">
                  <a href="mailto:cqc@cuiqingcai.com.com" title="邮件 → mailto:cqc@cuiqingcai.com.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>邮件</a>
                </span>
                <span class="links-of-author-item">
                  <a href="https://weibo.com/cuiqingcai" title="微博 → https:&#x2F;&#x2F;weibo.com&#x2F;cuiqingcai" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>微博</a>
                </span>
                <span class="links-of-author-item">
                  <a href="https://www.zhihu.com/people/Germey" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;Germey" rel="noopener" target="_blank"><i class="fa fa-magic fa-fw"></i>知乎</a>
                </span>
              </div>
            </div>
            <div style=" width: 100%;" class="sidebar-panel sidebar-panel-image sidebar-panel-active">
              <a href="https://item.jd.com/13527222.html" target="_blank" rel="noopener">
                <img src="https://cdn.cuiqingcai.com/ei5og.jpg" style=" width: 100%;">
              </a>
            </div>
            <div class="sidebar-panel sidebar-panel-categories sidebar-panel-active">
              <h4 class="name"> 分类 </h4>
              <div class="content">
                <ul class="category-list">
                  <li class="category-list-item"><a class="category-list-link" href="/categories/API/">API</a><span class="category-list-count">5</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/C-C/">C/C++</a><span class="category-list-count">23</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/HTML/">HTML</a><span class="category-list-count">14</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">5</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/">JavaScript</a><span class="category-list-count">26</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">14</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Luma/">Luma</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Markdown/">Markdown</a><span class="category-list-count">2</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Net/">Net</a><span class="category-list-count">4</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Nexior/">Nexior</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Other/">Other</a><span class="category-list-count">40</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a><span class="category-list-count">27</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Paper/">Paper</a><span class="category-list-count">2</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">303</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/TypeScript/">TypeScript</a><span class="category-list-count">2</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E5%B1%95%E7%A4%BA/">个人展示</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E6%97%A5%E8%AE%B0/">个人日记</a><span class="category-list-count">9</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E8%AE%B0%E5%BD%95/">个人记录</a><span class="category-list-count">6</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%B8%AA%E4%BA%BA%E9%9A%8F%E7%AC%94/">个人随笔</a><span class="category-list-count">21</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/">人工智能</a><span class="category-list-count">5</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/">安装配置</a><span class="category-list-count">59</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%9D%82%E8%B0%88/">技术杂谈</a><span class="category-list-count">96</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9C%AA%E5%88%86%E7%B1%BB/">未分类</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">深度学习</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E7%88%AC%E8%99%AB/">爬虫</a><span class="category-list-count">4</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E7%94%9F%E6%B4%BB%E7%AC%94%E8%AE%B0/">生活笔记</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E7%A6%8F%E5%88%A9%E4%B8%93%E5%8C%BA/">福利专区</a><span class="category-list-count">6</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E8%81%8C%E4%BD%8D%E6%8E%A8%E8%8D%90/">职位推荐</a><span class="category-list-count">1</span></li>
                  <li class="category-list-item"><a class="category-list-link" href="/categories/%E8%89%BA%E6%9C%AF%E4%BA%8C%E7%BB%B4%E7%A0%81/">艺术二维码</a><span class="category-list-count">1</span></li>
                </ul>
              </div>
            </div>
            <div class="sidebar-panel sidebar-panel-friends sidebar-panel-active">
              <h4 class="name"> 友情链接 </h4>
              <ul class="friends">
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/j2dub.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.findhao.net/" target="_blank" rel="noopener">FindHao</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/6apxu.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.51dev.com/" target="_blank" rel="noopener">IT技术社区</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/bqlbs.png">
                  </span>
                  <span class="link">
                    <a href="http://www.urselect.com/" target="_blank" rel="noopener">优社电商</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/8s88c.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.yuanrenxue.com/" target="_blank" rel="noopener">猿人学</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/2wgg5.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.yunlifang.cn/" target="_blank" rel="noopener">云立方</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="http://qianxunclub.com/favicon.png">
                  </span>
                  <span class="link">
                    <a href="http://qianxunclub.com/" target="_blank" rel="noopener">千寻啊千寻</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/0044u.jpg">
                  </span>
                  <span class="link">
                    <a href="http://kodcloud.com/" target="_blank" rel="noopener">可道云</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/ygnpn.jpg">
                  </span>
                  <span class="link">
                    <a href="http://www.kunkundashen.cn/" target="_blank" rel="noopener">坤坤大神</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/x714o.jpg">
                  </span>
                  <span class="link">
                    <a href="http://www.hubwiz.com/" target="_blank" rel="noopener">汇智网</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/44hxf.png">
                  </span>
                  <span class="link">
                    <a href="http://redstonewill.com/" target="_blank" rel="noopener">红色石头</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/wkaus.jpg">
                  </span>
                  <span class="link">
                    <a href="https://zhaoshuai.me/" target="_blank" rel="noopener">碎念</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/pgo0r.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.chenwenguan.com/" target="_blank" rel="noopener">陈文管的博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/kk82a.jpg">
                  </span>
                  <span class="link">
                    <a href="https://www.lxlinux.net/" target="_blank" rel="noopener">良许Linux教程网</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/lj0t2.jpg">
                  </span>
                  <span class="link">
                    <a href="https://tanqingbo.cn/" target="_blank" rel="noopener">IT码农</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/i8cdr.png">
                  </span>
                  <span class="link">
                    <a href="https://junyiseo.com/" target="_blank" rel="noopener">均益个人博客</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://cdn.cuiqingcai.com/chwv2.png">
                  </span>
                  <span class="link">
                    <a href="https://brucedone.com/" target="_blank" rel="noopener">大鱼的鱼塘</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://www.91vps.com/favicon.ico">
                  </span>
                  <span class="link">
                    <a href="http://www.91vps.com/" target="_blank" rel="noopener">91VPS</a>
                  </span>
                </li>
                <li class="friend">
                  <span class="logo">
                    <img src="https://webpage.qidian.qq.com/qidian/chatv3-gray/favicon.ico">
                  </span>
                  <span class="link">
                    <a href="https://www.qg.net/" target="_blank" rel="noopener">青果网络</a>
                  </span>
                </li>
              </ul>
            </div>
            <div class="sidebar-panel sidebar-panel-tags sidebar-panel-active">
              <h4 class="name"> 标签云 </h4>
              <div class="content">
                <a href="/tags/2022/" style="font-size: 20px;">2022</a> <a href="/tags/2048/" style="font-size: 10px;">2048</a> <a href="/tags/ADSL/" style="font-size: 10px;">ADSL</a> <a href="/tags/API/" style="font-size: 16px;">API</a> <a href="/tags/Ajax/" style="font-size: 12px;">Ajax</a> <a href="/tags/Bootstrap/" style="font-size: 11px;">Bootstrap</a> <a href="/tags/Bug/" style="font-size: 10px;">Bug</a> <a href="/tags/CDN/" style="font-size: 10px;">CDN</a> <a href="/tags/CQC/" style="font-size: 10px;">CQC</a> <a href="/tags/CSS/" style="font-size: 10px;">CSS</a> <a href="/tags/CSS-%E5%8F%8D%E7%88%AC%E8%99%AB/" style="font-size: 10px;">CSS 反爬虫</a> <a href="/tags/CV/" style="font-size: 10px;">CV</a> <a href="/tags/ChatGPT/" style="font-size: 10px;">ChatGPT</a> <a href="/tags/Cookie/" style="font-size: 10px;">Cookie</a> <a href="/tags/Django/" style="font-size: 10px;">Django</a> <a href="/tags/Eclipse/" style="font-size: 11px;">Eclipse</a> <a href="/tags/Elasticsearch/" style="font-size: 10px;">Elasticsearch</a> <a href="/tags/FTP/" style="font-size: 10px;">FTP</a> <a href="/tags/Flux/" style="font-size: 10px;">Flux</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/GitHub/" style="font-size: 13px;">GitHub</a> <a href="/tags/HTML5/" style="font-size: 10px;">HTML5</a> <a href="/tags/HTTP/" style="font-size: 10px;">HTTP</a> <a href="/tags/Hailuo/" style="font-size: 10px;">Hailuo</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/Hook/" style="font-size: 10px;">Hook</a> <a href="/tags/IP/" style="font-size: 10px;">IP</a> <a href="/tags/IT/" style="font-size: 10px;">IT</a> <a href="/tags/JSON/" style="font-size: 10px;">JSON</a> <a href="/tags/JSP/" style="font-size: 10px;">JSP</a> <a href="/tags/JavaScript/" style="font-size: 14px;">JavaScript</a> <a href="/tags/K8s/" style="font-size: 10px;">K8s</a> <a href="/tags/LOGO/" style="font-size: 10px;">LOGO</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/Luma/" style="font-size: 10px;">Luma</a> <a href="/tags/MIUI/" style="font-size: 10px;">MIUI</a> <a href="/tags/Markdown/" style="font-size: 10px;">Markdown</a> <a href="/tags/Midjourney/" style="font-size: 11px;">Midjourney</a> <a href="/tags/MongoDB/" style="font-size: 11px;">MongoDB</a> <a href="/tags/MySQL/" style="font-size: 10px;">MySQL</a> <a href="/tags/Mysql/" style="font-size: 10px;">Mysql</a> <a href="/tags/NBA/" style="font-size: 10px;">NBA</a> <a href="/tags/Nexior/" style="font-size: 10px;">Nexior</a> <a href="/tags/OCR/" style="font-size: 10px;">OCR</a> <a href="/tags/OpenCV/" style="font-size: 10px;">OpenCV</a> <a href="/tags/PHP/" style="font-size: 11px;">PHP</a> <a href="/tags/PPT/" style="font-size: 10px;">PPT</a> <a href="/tags/PS/" style="font-size: 10px;">PS</a> <a href="/tags/Pathlib/" style="font-size: 10px;">Pathlib</a> <a href="/tags/PhantomJS/" style="font-size: 10px;">PhantomJS</a> <a href="/tags/Playwright/" style="font-size: 10px;">Playwright</a> <a href="/tags/Python/" style="font-size: 17px;">Python</a> <a href="/tags/Python-%E7%88%AC%E8%99%AB/" style="font-size: 18px;">Python 爬虫</a> <a href="/tags/Python3/" style="font-size: 11px;">Python3</a> <a href="/tags/Python3%E7%88%AC%E8%99%AB%E6%95%99%E7%A8%8B/" style="font-size: 12px;">Python3爬虫教程</a> <a href="/tags/Pythonic/" style="font-size: 10px;">Pythonic</a> <a href="/tags/Python%E7%88%AC%E8%99%AB/" style="font-size: 19px;">Python爬虫</a> <a href="/tags/Python%E7%88%AC%E8%99%AB%E4%B9%A6/" style="font-size: 12px;">Python爬虫书</a> <a href="/tags/Python%E7%88%AC%E8%99%AB%E6%95%99%E7%A8%8B/" style="font-size: 15px;">Python爬虫教程</a> <a href="/tags/QQ/" style="font-size: 10px;">QQ</a> <a href="/tags/RabbitMQ/" style="font-size: 10px;">RabbitMQ</a> <a href="/tags/ReCAPTCHA/" style="font-size: 10px;">ReCAPTCHA</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/Riffusion/" style="font-size: 10px;">Riffusion</a> <a href="/tags/SAE/" style="font-size: 10px;">SAE</a> <a href="/tags/SSH/" style="font-size: 10px;">SSH</a> <a href="/tags/SVG/" style="font-size: 10px;">SVG</a> <a href="/tags/Scrapy-redis/" style="font-size: 10px;">Scrapy-redis</a> <a href="/tags/Scrapy%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 10px;">Scrapy分布式</a> <a href="/tags/Selenium/" style="font-size: 11px;">Selenium</a> <a href="/tags/Session/" style="font-size: 10px;">Session</a> <a href="/tags/Shell/" style="font-size: 10px;">Shell</a> <a href="/tags/Suno/" style="font-size: 10px;">Suno</a> <a href="/tags/TKE/" style="font-size: 10px;">TKE</a> <a href="/tags/TXT/" style="font-size: 10px;">TXT</a> <a href="/tags/Terminal/" style="font-size: 10px;">Terminal</a> <a href="/tags/Ubuntu/" style="font-size: 11px;">Ubuntu</a> <a href="/tags/VS-Code/" style="font-size: 10px;">VS Code</a> <a href="/tags/Veo/" style="font-size: 10px;">Veo</a> <a href="/tags/Vercel/" style="font-size: 10px;">Vercel</a> <a href="/tags/Vs-Code/" style="font-size: 10px;">Vs Code</a> <a href="/tags/Vue/" style="font-size: 11px;">Vue</a> <a href="/tags/Web/" style="font-size: 10px;">Web</a> <a href="/tags/Webpack/" style="font-size: 10px;">Webpack</a> <a href="/tags/Web%E7%BD%91%E9%A1%B5/" style="font-size: 10px;">Web网页</a> <a href="/tags/Windows/" style="font-size: 10px;">Windows</a> <a href="/tags/Winpcap/" style="font-size: 10px;">Winpcap</a> <a href="/tags/WordPress/" style="font-size: 13px;">WordPress</a> <a href="/tags/XPath/" style="font-size: 12px;">XPath</a> <a href="/tags/Youtube/" style="font-size: 11px;">Youtube</a> <a href="/tags/acedata/" style="font-size: 12px;">acedata</a> <a href="/tags/aiohttp/" style="font-size: 10px;">aiohttp</a> <a href="/tags/android/" style="font-size: 10px;">android</a> <a href="/tags/ansible/" style="font-size: 10px;">ansible</a> <a href="/tags/api/" style="font-size: 13px;">api</a> <a href="/tags/chatgpt/" style="font-size: 10px;">chatgpt</a> <a href="/tags/cocos2d-x/" style="font-size: 10px;">cocos2d-x</a> <a href="/tags/dummy-change/" style="font-size: 10px;">dummy change</a> <a href="/tags/e6/" style="font-size: 10px;">e6</a> <a href="/tags/fitvids/" style="font-size: 10px;">fitvids</a>
              </div>
              <script>
                const tagsColors = ['#00a67c', '#5cb85c', '#d9534f', '#567e95', '#b37333', '#f4843d', '#15a287']
                const tagsElements = document.querySelectorAll('.sidebar-panel-tags .content a')
                tagsElements.forEach((item) =>
                {
                  item.style.backgroundColor = tagsColors[Math.floor(Math.random() * tagsColors.length)]
                })

              </script>
            </div>
          </div>
        </aside>
        <div id="sidebar-dimmer"></div>
      </div>
    </main>
    <footer class="footer">
      <div class="footer-inner">
        <div class="copyright">
          <span class="author" itemprop="copyrightHolder">崔庆才丨静觅</span> &copy; <span itemprop="copyrightYear">2025</span>
          <span class="with-love">
            <i class="fa fa-heart"></i>
          </span>
          <a href="https://cuiqingcai.com/sitemap.xml" style="display:none" title="爬虫教程" target="_blank"><strong>爬虫教程</strong></a>
          <a href="https://cuiqingcai.com/sitemap.html" style="display:none" title="爬虫教程" target="_blank"><strong>爬虫教程</strong></a>
          <span class="post-meta-divider">|</span>
          <span class="post-meta-item-icon">
            <i class="fa fa-chart-area"></i>
          </span>
          <span title="站点总字数">3.3m</span>
          <span class="post-meta-divider">|</span>
          <span class="post-meta-item-icon">
            <i class="fa fa-coffee"></i>
          </span>
          <span title="站点阅读时长">49:35</span>
        </div>
        <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动 </div>
        <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">京ICP备18015597号-1 </a>
        </div>
        <script>
          (function ()
          {
            function leancloudSelector(url)
            {
              url = encodeURI(url);
              return document.getElementById(url).querySelector('.leancloud-visitors-count');
            }

            function addCount(Counter)
            {
              var visitors = document.querySelector('.leancloud_visitors');
              var url = decodeURI(visitors.id);
              var title = visitors.dataset.flagTitle;
              Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify(
              {
                url
              }))).then(response => response.json()).then((
              {
                results
              }) =>
              {
                if (results.length > 0)
                {
                  var counter = results[0];
                  leancloudSelector(url).innerText = counter.time + 1;
                  Counter('put', '/classes/Counter/' + counter.objectId,
                  {
                    time:
                    {
                      '__op': 'Increment',
                      'amount': 1
                    }
                  }).catch(error =>
                  {
                    console.error('Failed to save visitor count', error);
                  });
                }
                else
                {
                  Counter('post', '/classes/Counter',
                  {
                    title,
                    url,
                    time: 1
                  }).then(response => response.json()).then(() =>
                  {
                    leancloudSelector(url).innerText = 1;
                  }).catch(error =>
                  {
                    console.error('Failed to create', error);
                  });
                }
              }).catch(error =>
              {
                console.error('LeanCloud Counter Error', error);
              });
            }

            function showTime(Counter)
            {
              var visitors = document.querySelectorAll('.leancloud_visitors');
              var entries = [...visitors].map(element =>
              {
                return decodeURI(element.id);
              });
              Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify(
              {
                url:
                {
                  '$in': entries
                }
              }))).then(response => response.json()).then((
              {
                results
              }) =>
              {
                for (let url of entries)
                {
                  let target = results.find(item => item.url === url);
                  leancloudSelector(url).innerText = target ? target.time : 0;
                }
              }).catch(error =>
              {
                console.error('LeanCloud Counter Error', error);
              });
            }
            let
            {
              app_id,
              app_key,
              server_url
            } = {
              "enable": true,
              "app_id": "6X5dRQ0pnPWJgYy8SXOg0uID-gzGzoHsz",
              "app_key": "ziLDVEy73ne5HtFTiGstzHMS",
              "server_url": "https://6x5drq0p.lc-cn-n1-shared.com",
              "security": false
            };

            function fetchData(api_server)
            {
              var Counter = (method, url, data) =>
              {
                return fetch(`${api_server}/1.1${url}`,
                {
                  method,
                  headers:
                  {
                    'X-LC-Id': app_id,
                    'X-LC-Key': app_key,
                    'Content-Type': 'application/json',
                  },
                  body: JSON.stringify(data)
                });
              };
              if (CONFIG.page.isPost)
              {
                if (CONFIG.hostname !== location.hostname) return;
                addCount(Counter);
              }
              else if (document.querySelectorAll('.post-title-link').length >= 1)
              {
                showTime(Counter);
              }
            }
            let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;
            if (api_server)
            {
              fetchData(api_server);
            }
            else
            {
              fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id).then(response => response.json()).then((
              {
                api_server
              }) =>
              {
                fetchData('https://' + api_server);
              });
            }
          })();

        </script>
      </div>
      <div class="footer-stat">
        <span id="cnzz_stat_icon_1279355174"></span>
        <script type="text/javascript">
          document.write(unescape("%3Cspan id='cnzz_stat_icon_1279355174'%3E%3C/span%3E%3Cscript src='https://v1.cnzz.com/z_stat.php%3Fid%3D1279355174%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"));

        </script>
      </div>
    </footer>
  </div>
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script src="/js/utils.js"></script>
  <script src="/.js"></script>
  <script src="/js/schemes/pisces.js"></script>
  <script src="/.js"></script>
  <script src="/js/next-boot.js"></script>
  <script src="/.js"></script>
  <script>
    (function ()
    {
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x = document.getElementsByTagName("link");
      //Find the last canonical URL
      if (x.length > 0)
      {
        for (i = 0; i < x.length; i++)
        {
          if (x[i].rel.toLowerCase() == 'canonical' && x[i].href)
          {
            canonicalURL = x[i].href;
          }
        }
      }
      //Get protocol
      if (!canonicalURL)
      {
        curProtocol = window.location.protocol.split(':')[0];
      }
      else
      {
        curProtocol = canonicalURL.split(':')[0];
      }
      //Get current URL if the canonical URL does not exist
      if (!canonicalURL) canonicalURL = window.location.href;
      //Assign script content. Replace current URL with the canonical URL
      ! function ()
      {
        var e = /([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,
          r = canonicalURL,
          t = document.referrer;
        if (!e.test(r))
        {
          var n = (String(curProtocol).toLowerCase() === 'https') ? "https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif" : "//api.share.baidu.com/s.gif";
          t ? (n += "?r=" + encodeURIComponent(document.referrer), r && (n += "&l=" + r)) : r && (n += "?l=" + r);
          var i = new Image;
          i.src = n
        }
      }(window);
    })();

  </script>
  <script src="/js/local-search.js"></script>
  <script src="/.js"></script>
</body>

</html>
